window.__VUE_PROD_DEVTOOLS__=!1,window.__INTLIFY_PROD_DEVTOOLS__=!1,window.__VUE_I18N_FULL_INSTALL__=!0,window.__VUE_I18N_LEGACY_API__=!1;import*as e from'https://testingcf.jsdelivr.net/npm/klona/+esm';import*as n from'https://testingcf.jsdelivr.net/npm/pinia/+esm';import{createI18n as t,useI18n as a}from'https://testingcf.jsdelivr.net/npm/vue-i18n/+esm';var o={6:(e,n,t)=>{var a=t(957);a.__esModule&&(a=a.default),'string'==typeof a&&(a=[[e.id,a,'']]),a.locals&&(e.exports=a.locals);(0,t(424).A)('e71c3684',a,!1,{ssrId:!0})},15:(n,t,a)=>{n.exports=(e=>{var n={};return a.d(n,e),n})({klona:()=>e.klona})},35:(e,t,a)=>{e.exports=(e=>{var n={};return a.d(n,e),n})({createPinia:()=>n.createPinia,defineStore:()=>n.defineStore,storeToRefs:()=>n.storeToRefs})},54:e=>{e.exports=function(e){var n=[];return n.toString=function(){return this.map(function(n){var t='',a=void 0!==n[5];return n[4]&&(t+='@supports ('.concat(n[4],') {')),n[2]&&(t+='@media '.concat(n[2],' {')),a&&(t+='@layer'.concat(n[5].length>0?' '.concat(n[5]):'',' {')),t+=e(n),a&&(t+='}'),n[2]&&(t+='}'),n[4]&&(t+='}'),t}).join('')},n.i=function(e,t,a,o,r){'string'==typeof e&&(e=[[null,e,void 0]]);var s={};if(a)for(var i=0;i<this.length;i++){var l=this[i][0];null!=l&&(s[l]=!0)}for(var d=0;d<e.length;d++){var c=[].concat(e[d]);a&&s[c[0]]||(void 0!==r&&(void 0===c[5]||(c[1]='@layer'.concat(c[5].length>0?' '.concat(c[5]):'',' {').concat(c[1],'}')),c[5]=r),t&&(c[2]?(c[1]='@media '.concat(c[2],' {').concat(c[1],'}'),c[2]=t):c[2]=t),o&&(c[4]?(c[1]='@supports ('.concat(c[4],') {').concat(c[1],'}'),c[4]=o):c[4]=''.concat(o)),n.push(c))}},n}},61:e=>{e.exports=Vue},63:(e,n,t)=>{var a=t(314);a.__esModule&&(a=a.default),'string'==typeof a&&(a=[[e.id,a,'']]),a.locals&&(e.exports=a.locals);(0,t(424).A)('40832545',a,!1,{ssrId:!0})},80:(e,n,t)=>{t.r(n),t.d(n,{default:()=>i});var a=t(790),o=t.n(a),r=t(54),s=t.n(r)()(o());s.push([e.id,'@keyframes fadeIn-e3e6a546{from{opacity:0}to{opacity:1}}@keyframes slideUp-e3e6a546{from{transform:translateY(20px);opacity:0}to{transform:translateY(0);opacity:1}}@keyframes spin-e3e6a546{to{transform:rotate(360deg)}}.details-area[data-v-e3e6a546]::-webkit-scrollbar{width:6px}.details-area[data-v-e3e6a546]::-webkit-scrollbar-track{background:rgba(30,30,30,0.5);border-radius:3px}.details-area[data-v-e3e6a546]::-webkit-scrollbar-thumb{background:#4a9eff;border-radius:3px}.details-area[data-v-e3e6a546]::-webkit-scrollbar-thumb:hover{background:#5ab0ff}\n','',{version:3,sources:['webpack://./src/è®°å¿†_with_worldbook/components/ProgressDialog.vue'],names:[],mappings:'AA8OA,2BACE,KACE,SACF,CACA,GACE,SACF,CACF,CAEA,4BACE,KACE,0BAA2B,CAC3B,SACF,CACA,GACE,uBAAwB,CACxB,SACF,CACF,CAEA,yBACE,GACE,wBACF,CACF,CAGA,kDACE,SACF,CAEA,wDACE,6BAAiC,CACjC,iBACF,CAEA,wDACE,kBAAmB,CACnB,iBACF,CAEA,8DACE,kBACF',sourcesContent:['<template>\n  <div\n    v-if="show"\n    class="progress-overlay"\n    style="\n      position: fixed;\n      top: 0;\n      left: 0;\n      right: 0;\n      bottom: 0;\n      background: rgba(0, 0, 0, 0.85);\n      display: flex;\n      align-items: center;\n      justify-content: center;\n      z-index: 999999;\n      animation: fadeIn 0.2s ease;\n    "\n  >\n    <div\n      class="progress-card"\n      style="\n        background: linear-gradient(145deg, #2a2a2a, #1e1e1e);\n        border-radius: 16px;\n        padding: 35px;\n        width: 520px;\n        max-width: 90vw;\n        box-shadow: 0 10px 40px rgba(0, 0, 0, 0.5);\n        border: 1px solid #3a3a3a;\n        animation: slideUp 0.3s ease;\n      "\n    >\n      \x3c!-- æ ‡é¢˜ --\x3e\n      <div style="display: flex; align-items: center; gap: 12px; margin-bottom: 24px">\n        <div\n          class="spinner"\n          style="\n            width: 28px;\n            height: 28px;\n            border: 3px solid #3a3a3a;\n            border-top-color: #4a9eff;\n            border-radius: 50%;\n            animation: spin 0.8s linear infinite;\n          "\n        ></div>\n        <h3 style="margin: 0; color: #fff; font-size: 18px; font-weight: 600">\n          {{ title }}\n        </h3>\n      </div>\n\n      \x3c!-- è¿›åº¦æ¡ --\x3e\n      <div\n        class="progress-bar-container"\n        style="\n          width: 100%;\n          height: 10px;\n          background: rgba(30, 30, 30, 0.8);\n          border-radius: 5px;\n          overflow: hidden;\n          margin-bottom: 20px;\n          box-shadow: inset 0 1px 3px rgba(0, 0, 0, 0.3);\n        "\n      >\n        <div\n          class="progress-bar"\n          :style="{\n            width: progress + \'%\',\n            height: \'100%\',\n            background: \'linear-gradient(90deg, #4a9eff 0%, #7c3aed 50%, #10b981 100%)\',\n            transition: \'width 0.3s ease\',\n            boxShadow: \'0 0 10px rgba(74, 158, 255, 0.5)\',\n          }"\n        ></div>\n      </div>\n\n      \x3c!-- å½“å‰é˜¶æ®µ --\x3e\n      <div class="current-stage" style="color: #e0e0e0; font-size: 14px; margin-bottom: 12px; min-height: 20px">\n        {{ currentMessage }}\n      </div>\n\n      \x3c!-- è¯¦ç»†ä¿¡æ¯åŒºåŸŸ --\x3e\n      <div\n        v-if="details.length > 0"\n        class="details-area"\n        style="\n          max-height: 150px;\n          overflow-y: auto;\n          background: rgba(10, 10, 10, 0.5);\n          border-radius: 8px;\n          padding: 12px;\n          margin-bottom: 16px;\n          font-family: \'Consolas\', \'Monaco\', monospace;\n          font-size: 11px;\n          color: #a0a0a0;\n          line-height: 1.6;\n        "\n      >\n        <div v-for="(detail, i) in details" :key="i" style="margin-bottom: 4px">\n          <span style="color: #4a9eff">â€¢</span> {{ detail }}\n        </div>\n      </div>\n\n      \x3c!-- ç™¾åˆ†æ¯”å’Œè€—æ—¶ --\x3e\n      <div style="display: flex; justify-content: space-between; align-items: center">\n        <div class="progress-percent" style="color: #4a9eff; font-size: 16px; font-weight: 600">\n          {{ Math.round(progress) }}%\n        </div>\n\n        <div class="elapsed-time" style="color: #888; font-size: 12px">å·²è€—æ—¶: {{ elapsedSeconds }}ç§’</div>\n      </div>\n\n      \x3c!-- å–æ¶ˆæŒ‰é’®ï¼ˆå¯é€‰ï¼‰ --\x3e\n      <button\n        v-if="cancellable"\n        style="\n          width: 100%;\n          margin-top: 20px;\n          padding: 10px;\n          background: #3a3a3a;\n          border: 1px solid #4a4a4a;\n          border-radius: 8px;\n          color: #e0e0e0;\n          font-size: 13px;\n          cursor: pointer;\n          transition: all 0.2s;\n        "\n        @mouseenter="(e: any) => (e.currentTarget.style.background = \'#4a4a4a\')"\n        @mouseleave="(e: any) => (e.currentTarget.style.background = \'#3a3a3a\')"\n        @click="$emit(\'cancel\')"\n      >\n        å–æ¶ˆ\n      </button>\n    </div>\n  </div>\n</template>\n\n<script setup lang="ts">\nimport { ref, computed, watch, onUnmounted } from \'vue\';\n\ninterface Props {\n  show: boolean;\n  title?: string;\n  initialMessage?: string;\n  cancellable?: boolean;\n}\n\nconst props = withDefaults(defineProps<Props>(), {\n  title: \'AI æ­£åœ¨å¤„ç†\',\n  initialMessage: \'æ­£åœ¨å‡†å¤‡...\',\n  cancellable: false,\n});\n\ndefineEmits<{\n  (e: \'cancel\'): void;\n}>();\n\n// è¿›åº¦çŠ¶æ€\nconst progress = ref(0);\nconst currentMessage = ref(props.initialMessage);\nconst details = ref<string[]>([]);\nconst startTime = ref(0);\nconst elapsedSeconds = ref(0);\n\nlet elapsedInterval: number | null = null;\n\n// ç›‘å¬æ˜¾ç¤ºçŠ¶æ€\nwatch(\n  () => props.show,\n  newVal => {\n    if (newVal) {\n      // æ˜¾ç¤ºæ—¶é‡ç½®çŠ¶æ€\n      progress.value = 0;\n      currentMessage.value = props.initialMessage;\n      details.value = [];\n      startTime.value = Date.now();\n      elapsedSeconds.value = 0;\n\n      // å¯åŠ¨è®¡æ—¶å™¨\n      if (elapsedInterval) {\n        clearInterval(elapsedInterval);\n      }\n      elapsedInterval = window.setInterval(() => {\n        elapsedSeconds.value = Math.floor((Date.now() - startTime.value) / 1000);\n      }, 1000);\n    } else {\n      // éšè—æ—¶æ¸…ç†è®¡æ—¶å™¨\n      if (elapsedInterval) {\n        clearInterval(elapsedInterval);\n        elapsedInterval = null;\n      }\n    }\n  },\n);\n\nonUnmounted(() => {\n  if (elapsedInterval) {\n    clearInterval(elapsedInterval);\n  }\n});\n\n// æš´éœ²çš„æ–¹æ³•\nfunction setProgress(percent: number) {\n  progress.value = Math.min(100, Math.max(0, percent));\n}\n\nfunction setMessage(message: string) {\n  currentMessage.value = message;\n}\n\nfunction addDetail(detail: string) {\n  details.value.push(detail);\n  // è‡ªåŠ¨æ»šåŠ¨åˆ°åº•éƒ¨\n  setTimeout(() => {\n    const detailsArea = document.querySelector(\'.details-area\');\n    if (detailsArea) {\n      detailsArea.scrollTop = detailsArea.scrollHeight;\n    }\n  }, 50);\n}\n\nfunction clearDetails() {\n  details.value = [];\n}\n\nfunction complete() {\n  progress.value = 100;\n  currentMessage.value = \'å®Œæˆï¼\';\n}\n\ndefineExpose({\n  setProgress,\n  setMessage,\n  addDetail,\n  clearDetails,\n  complete,\n});\n<\/script>\n\n<style scoped>\n@keyframes fadeIn {\n  from {\n    opacity: 0;\n  }\n  to {\n    opacity: 1;\n  }\n}\n\n@keyframes slideUp {\n  from {\n    transform: translateY(20px);\n    opacity: 0;\n  }\n  to {\n    transform: translateY(0);\n    opacity: 1;\n  }\n}\n\n@keyframes spin {\n  to {\n    transform: rotate(360deg);\n  }\n}\n\n/* è‡ªå®šä¹‰æ»šåŠ¨æ¡ */\n.details-area::-webkit-scrollbar {\n  width: 6px;\n}\n\n.details-area::-webkit-scrollbar-track {\n  background: rgba(30, 30, 30, 0.5);\n  border-radius: 3px;\n}\n\n.details-area::-webkit-scrollbar-thumb {\n  background: #4a9eff;\n  border-radius: 3px;\n}\n\n.details-area::-webkit-scrollbar-thumb:hover {\n  background: #5ab0ff;\n}\n</style>\n'],sourceRoot:''}]);const i=s},86:(e,n,t)=>{t.r(n),t.d(n,{default:()=>i});var a=t(790),o=t.n(a),r=t(54),s=t.n(r)()(o());s.push([e.id,'@keyframes spin-c12ec546{to{transform:rotate(360deg)}}button[data-v-c12ec546]:disabled{cursor:not-allowed !important}button[data-v-c12ec546]:not(:disabled):hover{transform:translateY(-2px);box-shadow:0 4px 12px rgba(0,0,0,0.3)}div[data-v-c12ec546]::-webkit-scrollbar{width:8px}div[data-v-c12ec546]::-webkit-scrollbar-track{background:#1a1a1a}div[data-v-c12ec546]::-webkit-scrollbar-thumb{background:#667eea;border-radius:4px}div[data-v-c12ec546]::-webkit-scrollbar-thumb:hover{background:#5568d3}\n','',{version:3,sources:['webpack://./src/è®°å¿†_with_worldbook/components/AIGenerateDialog.vue'],names:[],mappings:'AAuKA,yBACE,GACE,wBACF,CACF,CAEA,iCACE,6BACF,CAEA,6CACE,0BAA2B,CAC3B,qCACF,CAGA,wCACE,SACF,CAEA,8CACE,kBACF,CAEA,8CACE,kBAAmB,CACnB,iBACF,CAEA,oDACE,kBACF',sourcesContent:['<template>\n  <div\n    v-if="show"\n    @click.self="handleClose"\n    style="\n      position: fixed;\n      top: 0;\n      left: 0;\n      right: 0;\n      bottom: 0;\n      background: rgba(0, 0, 0, 0.8);\n      z-index: 1000000;\n      display: flex;\n      align-items: center;\n      justify-content: center;\n      padding: 20px;\n    "\n  >\n    <div\n      style="\n        background: #2a2a2a;\n        border: 2px solid #667eea;\n        border-radius: 12px;\n        padding: 30px;\n        max-width: 500px;\n        width: 100%;\n        text-align: center;\n      "\n      @click.stop\n    >\n      <h3 style="color: #667eea; margin: 0 0 15px 0">\n        <i class="fa-solid fa-wand-magic-sparkles"></i>\n        {{ title || \'AI ç”Ÿæˆ\' }}\n      </h3>\n      <p style="color: #888; margin: 0 0 25px 0; line-height: 1.6">\n        {{ description || \'AI æ­£åœ¨ä¸ºä½ ç”Ÿæˆå†…å®¹...\' }}\n      </p>\n\n      \x3c!-- æ˜¾ç¤ºè¾“å…¥æ¡†ï¼ˆå¯é€‰ï¼‰ --\x3e\n      <textarea\n        v-if="showInput"\n        v-model="localInput"\n        :placeholder="placeholder || \'è¾“å…¥ä½ çš„éœ€æ±‚...\'"\n        style="\n          width: 100%;\n          min-height: 120px;\n          background: #1a1a1a;\n          color: #e0e0e0;\n          border: 1px solid #444;\n          border-radius: 4px;\n          padding: 12px;\n          font-size: 14px;\n          margin-bottom: 20px;\n          resize: vertical;\n          box-sizing: border-box;\n        "\n      ></textarea>\n\n      \x3c!-- åŠ è½½åŠ¨ç”» --\x3e\n      <div v-if="isGenerating" style="margin-bottom: 25px">\n        <div\n          style="\n            display: inline-block;\n            width: 50px;\n            height: 50px;\n            border: 4px solid #3a3a3a;\n            border-top-color: #667eea;\n            border-radius: 50%;\n            animation: spin 1s linear infinite;\n          "\n        ></div>\n        <p style="color: #888; margin-top: 15px; font-size: 14px">æ­£åœ¨ç”Ÿæˆä¸­ï¼Œè¯·ç¨å€™...</p>\n      </div>\n\n      <div style="display: flex; gap: 12px">\n        <button\n          v-if="!isGenerating"\n          @click="handleConfirm"\n          :disabled="showInput && !localInput"\n          style="\n            flex: 1;\n            background: #667eea;\n            color: white;\n            border: none;\n            padding: 12px 24px;\n            border-radius: 6px;\n            cursor: pointer;\n            font-size: 14px;\n            font-weight: 600;\n            transition: all 0.2s;\n          "\n          :style="{ opacity: showInput && !localInput ? 0.5 : 1 }"\n        >\n          <i class="fa-solid fa-check"></i>\n          ç¡®è®¤ç”Ÿæˆ\n        </button>\n        <button\n          @click="handleClose"\n          :disabled="isGenerating"\n          style="\n            flex: 1;\n            background: #666;\n            color: white;\n            border: none;\n            padding: 12px 24px;\n            border-radius: 6px;\n            cursor: pointer;\n            font-size: 14px;\n            font-weight: 600;\n            transition: all 0.2s;\n          "\n          :style="{ opacity: isGenerating ? 0.5 : 1 }"\n        >\n          {{ isGenerating ? \'ç”Ÿæˆä¸­...\' : \'å–æ¶ˆ\' }}\n        </button>\n      </div>\n    </div>\n  </div>\n</template>\n\n<script setup lang="ts">\nimport { ref, watch } from \'vue\';\n\nconst props = defineProps<{\n  show: boolean;\n  title?: string;\n  description?: string;\n  placeholder?: string;\n  isGenerating?: boolean;\n  showInput?: boolean; // æ˜¯å¦æ˜¾ç¤ºè¾“å…¥æ¡†\n}>();\n\nconst emit = defineEmits<{\n  (e: \'close\'): void;\n  (e: \'confirm\', input?: string): void;\n}>();\n\nconst localInput = ref(\'\');\n\n// å½“å¯¹è¯æ¡†æ˜¾ç¤ºæ—¶ï¼Œæ¸…ç©ºè¾“å…¥\nwatch(\n  () => props.show,\n  newVal => {\n    if (newVal) {\n      localInput.value = \'\';\n    }\n  },\n);\n\nconst handleConfirm = () => {\n  if (!props.isGenerating) {\n    if (props.showInput) {\n      emit(\'confirm\', localInput.value);\n    } else {\n      emit(\'confirm\');\n    }\n  }\n};\n\nconst handleClose = () => {\n  if (!props.isGenerating) {\n    emit(\'close\');\n  }\n};\n<\/script>\n\n<style scoped>\n@keyframes spin {\n  to {\n    transform: rotate(360deg);\n  }\n}\n\nbutton:disabled {\n  cursor: not-allowed !important;\n}\n\nbutton:not(:disabled):hover {\n  transform: translateY(-2px);\n  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);\n}\n\n/* æ»šåŠ¨æ¡æ ·å¼ */\ndiv::-webkit-scrollbar {\n  width: 8px;\n}\n\ndiv::-webkit-scrollbar-track {\n  background: #1a1a1a;\n}\n\ndiv::-webkit-scrollbar-thumb {\n  background: #667eea;\n  border-radius: 4px;\n}\n\ndiv::-webkit-scrollbar-thumb:hover {\n  background: #5568d3;\n}\n</style>\n'],sourceRoot:''}]);const i=s},99:(e,n,t)=>{t.r(n),t.d(n,{default:()=>i});var a=t(790),o=t.n(a),r=t(54),s=t.n(r)()(o());s.push([e.id,'.settings-tab{height:100%;overflow-y:auto;padding:25px !important;background:#1a1a1a !important;border:2px solid red !important}.config-section{padding:20px 25px !important;border-bottom:1px solid #3a3a3a;margin-bottom:5px}.config-section:last-child{border-bottom:none;margin-bottom:0}.config-section h3{margin:0 0 20px 0 !important;color:#fff;font-size:15px !important;font-weight:bold;display:flex;align-items:center;gap:8px}.form-group{margin-bottom:18px !important}.form-group label{display:block;margin-bottom:6px;color:#ccc;font-size:13px}.checkbox-label{display:flex;align-items:center;gap:8px}.flex-label{display:flex;justify-content:space-between;align-items:center}.form-group input[type=\'text\'],.form-group input[type=\'password\'],.form-group input[type=\'number\'],.form-group select{width:100%;padding:10px 12px;background:#2a2a2a;border:1px solid #3a3a3a;border-radius:6px;color:#e0e0e0;font-size:13px;transition:border-color 0.2s}.form-group input:focus,.form-group select:focus{outline:none;border-color:#4a9eff}.model-controls{display:flex;flex-direction:column;gap:10px}.button-group{display:flex;gap:12px;flex-wrap:wrap;margin-top:5px}.action-button{flex:1;min-width:120px;padding:12px 16px;border:none;border-radius:6px;cursor:pointer;font-weight:500;font-size:13px;transition:all 0.2s;display:flex;align-items:center;justify-content:center;gap:6px;background:#3a3a3a;color:#e0e0e0;border:1px solid #4a4a4a}.action-button:hover{background:#4a4a4a;border-color:#5a5a5a}.test-button{background:#3a3a3a;color:#e0e0e0;border:1px solid #4a4a4a}.test-button:hover{background:#4a4a4a;border-color:#5a5a5a}.fetch-button{background:#4a9eff;color:white;border:1px solid #5aaeff}.fetch-button:hover{background:#5aaeff;border-color:#6abeff}.summarize-button{background:#4a9eff;color:white;border:1px solid #5aaeff}.summarize-button:hover{background:#5aaeff;border-color:#6abeff}.create-button{background:#51cf66;color:white;border:1px solid #40c057}.create-button:hover{background:#40c057;border-color:#37b24d}.table-button{background:#4a9eff;color:white;border:1px solid #5aaeff}.table-button:hover{background:#5aaeff;border-color:#6abeff}.hide-button{background:#ff6b6b;color:white;border:1px solid #ff5252}.hide-button:hover{background:#ff5252;border-color:#ff4444}.unhide-button{background:#51cf66;color:white;border:1px solid #40c057}.unhide-button:hover{background:#40c057;border-color:#37b24d}.refresh-button{background:#ffd43b;color:#333;border:1px solid #ffcc02}.refresh-button:hover{background:#ffcc02;border-color:#ffb700}.action-button:disabled{opacity:0.5;cursor:not-allowed}.model-select{margin-top:8px}.hidden-messages-section{margin-top:20px}.hidden-messages-list{max-height:300px;overflow-y:auto;border-radius:6px;border:1px solid #3a3a3a;background:#1a1a1a}.hidden-message-item{padding:10px 12px;display:flex;align-items:center;gap:12px;border-bottom:1px solid #2a2a2a;transition:background 0.2s}.hidden-message-item:last-child{border-bottom:none}.hidden-message-item:hover{background:#2a2a2a}.message-info{display:flex;align-items:center;gap:10px;flex:1}.message-id{font-weight:bold;color:#4a9eff;font-size:13px;min-width:50px}.message-role{font-size:12px;padding:2px 8px;border-radius:4px;white-space:nowrap}.message-role.role-user{background:#3a5a3a;color:#90ee90}.message-role.role-assistant{background:#3a3a5a;color:#90a0ee}.message-role.role-system{background:#5a5a3a;color:#eea090}.message-preview{flex:1;color:#888;font-size:12px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.show-button{background:#4a9eff !important;color:white !important;padding:6px 12px;border:1px solid #5aaeff !important;border-radius:4px;cursor:pointer;font-size:12px;transition:all 0.2s;min-width:60px;text-align:center}.show-button:hover{background:#5aaeff !important;border-color:#6abeff !important}.mini-button{background:#666;color:white;border:1px solid #777;padding:6px 12px;border-radius:4px;cursor:pointer;font-size:12px;transition:all 0.2s}.mini-button:hover{background:#777;border-color:#888}.empty-state{margin-top:20px;padding:20px;background:#2a2a2a;border-radius:6px;text-align:center;color:#888;border:1px solid #3a3a3a}\n','',{version:3,sources:['webpack://./src/è®°å¿†_with_worldbook/components/SettingsTab.vue'],names:[],mappings:'AA6kFA,cACE,WAAY,CACZ,eAAgB,CAChB,uBAAwB,CACxB,6BAA8B,CAC9B,+BACF,CAEA,gBACE,4BAA6B,CAC7B,+BAAgC,CAChC,iBACF,CAEA,2BACE,kBAAmB,CACnB,eACF,CAEA,mBACE,4BAA6B,CAC7B,UAAW,CACX,yBAA0B,CAC1B,gBAAiB,CACjB,YAAa,CACb,kBAAmB,CACnB,OACF,CAEA,YACE,6BACF,CAEA,kBACE,aAAc,CACd,iBAAkB,CAClB,UAAW,CACX,cACF,CAEA,gBACE,YAAa,CACb,kBAAmB,CACnB,OACF,CAEA,YACE,YAAa,CACb,6BAA8B,CAC9B,kBACF,CAEA,sHAIE,UAAW,CACX,iBAAkB,CAClB,kBAAmB,CACnB,wBAAyB,CACzB,iBAAkB,CAClB,aAAc,CACd,cAAe,CACf,4BACF,CAEA,iDAEE,YAAa,CACb,oBACF,CAEA,gBACE,YAAa,CACb,qBAAsB,CACtB,QACF,CAEA,cACE,YAAa,CACb,QAAS,CACT,cAAe,CACf,cACF,CAEA,eACE,MAAO,CACP,eAAgB,CAChB,iBAAkB,CAClB,WAAY,CACZ,iBAAkB,CAClB,cAAe,CACf,eAAgB,CAChB,cAAe,CACf,mBAAoB,CACpB,YAAa,CACb,kBAAmB,CACnB,sBAAuB,CACvB,OAAQ,CACR,kBAAmB,CACnB,aAAc,CACd,wBACF,CAEA,qBACE,kBAAmB,CACnB,oBACF,CAEA,aACE,kBAAmB,CACnB,aAAc,CACd,wBACF,CAEA,mBACE,kBAAmB,CACnB,oBACF,CAEA,cACE,kBAAmB,CACnB,WAAY,CACZ,wBACF,CAEA,oBACE,kBAAmB,CACnB,oBACF,CAEA,kBACE,kBAAmB,CACnB,WAAY,CACZ,wBACF,CAEA,wBACE,kBAAmB,CACnB,oBACF,CAEA,eACE,kBAAmB,CACnB,WAAY,CACZ,wBACF,CAEA,qBACE,kBAAmB,CACnB,oBACF,CAEA,cACE,kBAAmB,CACnB,WAAY,CACZ,wBACF,CAEA,oBACE,kBAAmB,CACnB,oBACF,CAEA,aACE,kBAAmB,CACnB,WAAY,CACZ,wBACF,CAEA,mBACE,kBAAmB,CACnB,oBACF,CAEA,eACE,kBAAmB,CACnB,WAAY,CACZ,wBACF,CAEA,qBACE,kBAAmB,CACnB,oBACF,CAEA,gBACE,kBAAmB,CACnB,UAAW,CACX,wBACF,CAEA,sBACE,kBAAmB,CACnB,oBACF,CAEA,wBACE,WAAY,CACZ,kBACF,CAEA,cACE,cACF,CAEA,yBACE,eACF,CAEA,sBACE,gBAAiB,CACjB,eAAgB,CAChB,iBAAkB,CAClB,wBAAyB,CACzB,kBACF,CAEA,qBACE,iBAAkB,CAClB,YAAa,CACb,kBAAmB,CACnB,QAAS,CACT,+BAAgC,CAChC,0BACF,CAEA,gCACE,kBACF,CAEA,2BACE,kBACF,CAEA,cACE,YAAa,CACb,kBAAmB,CACnB,QAAS,CACT,MACF,CAEA,YACE,gBAAiB,CACjB,aAAc,CACd,cAAe,CACf,cACF,CAEA,cACE,cAAe,CACf,eAAgB,CAChB,iBAAkB,CAClB,kBACF,CAEA,wBACE,kBAAmB,CACnB,aACF,CAEA,6BACE,kBAAmB,CACnB,aACF,CAEA,0BACE,kBAAmB,CACnB,aACF,CAEA,iBACE,MAAO,CACP,UAAW,CACX,cAAe,CACf,eAAgB,CAChB,sBAAuB,CACvB,kBACF,CAEA,aACE,6BAA8B,CAC9B,sBAAuB,CACvB,gBAAiB,CACjB,mCAAoC,CACpC,iBAAkB,CAClB,cAAe,CACf,cAAe,CACf,mBAAoB,CACpB,cAAe,CACf,iBACF,CAEA,mBACE,6BAA8B,CAC9B,+BACF,CAEA,aACE,eAAgB,CAChB,WAAY,CACZ,qBAAsB,CACtB,gBAAiB,CACjB,iBAAkB,CAClB,cAAe,CACf,cAAe,CACf,mBACF,CAEA,mBACE,eAAgB,CAChB,iBACF,CAEA,aACE,eAAgB,CAChB,YAAa,CACb,kBAAmB,CACnB,iBAAkB,CAClB,iBAAkB,CAClB,UAAW,CACX,wBACF',sourcesContent:['<template>\n  <div class="settings-tab" style="padding: 25px !important; background: #1a1a1a !important">\n    \x3c!-- API é…ç½® --\x3e\n    <div\n      class="config-section"\n      style="padding: 20px 25px !important; border-bottom: 1px solid #3a3a3a; margin-bottom: 5px"\n    >\n      <div\n        style="\n          cursor: pointer;\n          user-select: none;\n          display: flex;\n          align-items: center;\n          justify-content: space-between;\n          padding: 20px 28px;\n          background: linear-gradient(\n            135deg,\n            rgba(30, 30, 30, 0.95) 0%,\n            rgba(38, 38, 38, 0.9) 50%,\n            rgba(30, 30, 30, 0.95) 100%\n          );\n          backdrop-filter: blur(12px);\n          border-radius: 14px;\n          margin-bottom: 20px;\n          border: 1px solid rgba(255, 255, 255, 0.06);\n          box-shadow:\n            0 3px 12px rgba(0, 0, 0, 0.3),\n            inset 0 1px 0 rgba(255, 255, 255, 0.04),\n            inset 0 -1px 0 rgba(0, 0, 0, 0.2);\n          position: relative;\n          overflow: hidden;\n          transition: all 0.25s cubic-bezier(0.4, 0, 0.2, 1);\n        "\n        @click="toggleSection(\'api\')"\n        @mouseenter="\n          ($event.currentTarget as HTMLElement).style.background =\n            \'linear-gradient(135deg, rgba(42, 42, 42, 0.98) 0%, rgba(50, 50, 50, 0.95) 50%, rgba(42, 42, 42, 0.98) 100%)\';\n          ($event.currentTarget as HTMLElement).style.transform = \'translateX(4px) scale(1.005)\';\n          ($event.currentTarget as HTMLElement).style.borderLeft = \'3px solid rgba(255, 193, 7, 0.6)\';\n        "\n        @mouseleave="\n          ($event.currentTarget as HTMLElement).style.background =\n            \'linear-gradient(135deg, rgba(30, 30, 30, 0.95) 0%, rgba(38, 38, 38, 0.9) 50%, rgba(30, 30, 30, 0.95) 100%)\';\n          ($event.currentTarget as HTMLElement).style.transform = \'none\';\n          ($event.currentTarget as HTMLElement).style.borderLeft = \'1px solid rgba(255, 255, 255, 0.06)\';\n        "\n      >\n        <h3\n          style="\n            position: relative;\n            z-index: 1;\n            display: flex;\n            align-items: center;\n            gap: 12px;\n            margin: 0;\n            color: #fff;\n            font-size: 16px;\n            font-weight: 600;\n            letter-spacing: 0.5px;\n            text-shadow: 0 1px 2px rgba(0, 0, 0, 0.5);\n          "\n        >\n          <i class="fa-solid fa-cog" style="color: #17a2b8; font-size: 18px"></i>\n          API é…ç½®\n        </h3>\n        <i\n          :class="expandedSections[\'api\'] ? \'fa-chevron-up\' : \'fa-chevron-down\'"\n          class="fa-solid"\n          style="color: rgba(255, 255, 255, 0.6); font-size: 14px; transition: transform 0.3s"\n        ></i>\n      </div>\n\n      <div v-show="expandedSections[\'api\']">\n        <div class="form-group" style="margin-bottom: 18px !important">\n          <label style="display: block; margin-bottom: 6px; color: #ccc; font-size: 13px">API æä¾›å•†</label>\n          <select\n            v-model="settings.api_provider"\n            @change="handleProviderChange"\n            style="\n              width: 100%;\n              padding: 10px 12px;\n              background: #2a2a2a;\n              border: 1px solid #3a3a3a;\n              border-radius: 6px;\n              color: #e0e0e0;\n              font-size: 13px;\n              transition: border-color 0.2s;\n              cursor: pointer;\n            "\n          >\n            <option value="openai">OpenAI</option>\n            <option value="gemini">Gemini AI Studio</option>\n          </select>\n        </div>\n\n        <div class="form-group" style="margin-bottom: 18px !important">\n          <label style="display: block; margin-bottom: 6px; color: #ccc; font-size: 13px">\n            API ç«¯ç‚¹\n            <span style="color: #888; font-size: 11px; margin-left: 8px"> (å…¼å®¹é…’é¦†æ ¼å¼ï¼Œå¡«å†™ base URL å³å¯) </span>\n          </label>\n          <input\n            v-model="settings.api_endpoint"\n            type="text"\n            placeholder="https://ä½ çš„æœåŠ¡å™¨/v1"\n            style="\n              width: 100%;\n              padding: 10px 12px;\n              background: #2a2a2a;\n              border: 1px solid #3a3a3a;\n              border-radius: 6px;\n              color: #e0e0e0;\n              font-size: 13px;\n              transition: border-color 0.2s;\n            "\n          />\n          <div\n            style="\n              margin-top: 8px;\n              padding: 8px 12px;\n              background: rgba(74, 158, 255, 0.1);\n              border-radius: 4px;\n              border-left: 3px solid #4a9eff;\n            "\n          >\n            <div style="color: #4a9eff; font-size: 12px; font-weight: bold; margin-bottom: 4px">\n              ğŸ“Œ å¸¸è§ç«¯ç‚¹ç¤ºä¾‹ï¼ˆä¸é…’é¦†æ ¼å¼ä¸€è‡´ï¼‰ï¼š\n            </div>\n            <div style="color: #999; font-size: 11px; line-height: 1.6">\n              â€¢ <strong>OpenAI å®˜æ–¹:</strong> https://api.openai.com/v1<br />\n              â€¢ <strong>Gemini AI Studio:</strong> https://generativelanguage.googleapis.com/v1beta/openai/<br />\n              â€¢ <strong>NewAPI / One API:</strong> https://ä½ çš„æœåŠ¡å™¨/v1<br />\n              â€¢ <strong>æœ¬åœ°æ¨¡å‹ (Ollama):</strong> http://localhost:11434/v1<br />\n              ğŸ’¡ <strong>æç¤ºï¼š</strong>ä¼šè‡ªåŠ¨è¡¥å…¨ /chat/completionsï¼Œä¹Ÿå¯ä»¥ç›´æ¥å¡«å®Œæ•´è·¯å¾„\n            </div>\n          </div>\n        </div>\n\n        <div class="form-group" style="margin-bottom: 18px !important">\n          <label style="display: block; margin-bottom: 6px; color: #ccc; font-size: 13px">API Key</label>\n          <input\n            v-model="settings.api_key"\n            type="password"\n            placeholder="sk-..."\n            style="\n              width: 100%;\n              padding: 10px 12px;\n              background: #2a2a2a;\n              border: 1px solid #3a3a3a;\n              border-radius: 6px;\n              color: #e0e0e0;\n              font-size: 13px;\n              transition: border-color 0.2s;\n            "\n          />\n        </div>\n\n        <div class="form-group">\n          <div class="model-controls" style="display: flex; flex-direction: column; gap: 10px">\n            <label style="display: block; margin-bottom: 6px; color: #ccc; font-size: 13px">\n              æ¨¡å‹åç§°\n              <span v-if="available_models.length === 0" style="color: #888; font-size: 11px; margin-left: 8px">\n                (æ‰‹åŠ¨è¾“å…¥æ¨¡å‹åç§°ï¼Œå¦‚ gpt-4o-mini)\n              </span>\n            </label>\n            <div class="button-group" style="display: flex; gap: 12px; flex-wrap: wrap; margin-top: 5px">\n              <button\n                :disabled="loading_models"\n                class="fetch-button"\n                style="\n                  flex: 1;\n                  min-width: 120px;\n                  padding: 12px 16px;\n                  border: 1px solid #5aaeff;\n                  border-radius: 6px;\n                  cursor: pointer;\n                  font-weight: 500;\n                  font-size: 13px;\n                  transition: all 0.2s;\n                  display: flex;\n                  align-items: center;\n                  justify-content: center;\n                  gap: 6px;\n                  background: linear-gradient(135deg, #4a9eff 0%, #3a8edf 100%);\n                  box-shadow:\n                    0 2px 8px rgba(74, 158, 255, 0.25),\n                    inset 0 1px 0 rgba(255, 255, 255, 0.15);\n                  color: white;\n                "\n                onmouseover="this.style.transform=\'translateY(-2px)\'; this.style.boxShadow=\'0 4px 12px rgba(74, 158, 255, 0.4), inset 0 1px 0 rgba(255, 255, 255, 0.15)\'"\n                onmouseout="this.style.transform=\'translateY(0)\'; this.style.boxShadow=\'0 2px 8px rgba(74, 158, 255, 0.25), inset 0 1px 0 rgba(255, 255, 255, 0.15)\'"\n                @click="handle_fetch_models"\n              >\n                {{ loading_models ? \'æ‹‰å–ä¸­...\' : \'ğŸ” æ‹‰å–æ¨¡å‹åˆ—è¡¨\' }}\n              </button>\n              <button\n                class="save-button"\n                style="\n                  flex: 1;\n                  min-width: 120px;\n                  padding: 12px 16px;\n                  border: 1px solid #28a745;\n                  border-radius: 6px;\n                  cursor: pointer;\n                  font-weight: 500;\n                  font-size: 13px;\n                  transition: all 0.2s;\n                  display: flex;\n                  align-items: center;\n                  justify-content: center;\n                  gap: 6px;\n                  background: linear-gradient(135deg, #51cf66 0%, #40c057 100%);\n                  box-shadow:\n                    0 2px 8px rgba(81, 207, 102, 0.25),\n                    inset 0 1px 0 rgba(255, 255, 255, 0.15);\n                  color: white;\n                "\n                onmouseover="this.style.transform=\'translateY(-2px)\'; this.style.boxShadow=\'0 4px 12px rgba(81, 207, 102, 0.4), inset 0 1px 0 rgba(255, 255, 255, 0.15)\'"\n                onmouseout="this.style.transform=\'translateY(0)\'; this.style.boxShadow=\'0 2px 8px rgba(81, 207, 102, 0.25), inset 0 1px 0 rgba(255, 255, 255, 0.15)\'"\n                @click="handleSaveApiConfig"\n              >\n                ğŸ’¾ ä¿å­˜é…ç½®\n              </button>\n            </div>\n          </div>\n          <input\n            v-if="available_models.length === 0"\n            v-model="settings.model"\n            type="text"\n            placeholder="gpt-4o-mini æˆ– deepseek-chat ç­‰"\n            style="\n              width: 100%;\n              padding: 10px 12px;\n              background: #2a2a2a;\n              border: 1px solid #3a3a3a;\n              border-radius: 6px;\n              color: #e0e0e0;\n              font-size: 13px;\n              transition: border-color 0.2s;\n            "\n          />\n          <select\n            v-else\n            v-model="settings.model"\n            class="model-select"\n            style="\n              width: 100%;\n              padding: 10px 12px;\n              background: #2a2a2a;\n              border: 1px solid #3a3a3a;\n              border-radius: 6px;\n              color: #e0e0e0;\n              font-size: 13px;\n              transition: border-color 0.2s;\n            "\n          >\n            <option v-for="model in available_models" :key="model" :value="model">{{ model }}</option>\n          </select>\n        </div>\n\n        <div class="form-group" style="margin-bottom: 18px !important">\n          <label style="display: block; margin-bottom: 6px; color: #ccc; font-size: 13px"\n            >æœ€å¤§ Token æ•°ï¼ˆå»ºè®®4000ä»¥ä¸Šè·å¾—æ›´è¯¦ç»†çš„æ€»ç»“ï¼‰</label\n          >\n          <input\n            v-model.number="settings.max_tokens"\n            type="number"\n            min="100"\n            max="16000"\n            style="\n              width: 100%;\n              padding: 10px 12px;\n              background: #2a2a2a;\n              border: 1px solid #3a3a3a;\n              border-radius: 6px;\n              color: #e0e0e0;\n              font-size: 13px;\n              transition: border-color 0.2s;\n            "\n          />\n        </div>\n\n        <div class="form-group" style="margin-bottom: 18px !important">\n          <label style="display: block; margin-bottom: 6px; color: #ccc; font-size: 13px">\n            Temperature (æ¸©åº¦) <span style="color: #888; font-size: 11px">(0-2ï¼Œæ¨è 0.7)</span>\n          </label>\n          <input\n            v-model.number="settings.temperature"\n            type="number"\n            min="0"\n            max="2"\n            step="0.1"\n            style="\n              width: 100%;\n              padding: 10px 12px;\n              background: #2a2a2a;\n              border: 1px solid #3a3a3a;\n              border-radius: 6px;\n              color: #e0e0e0;\n              font-size: 13px;\n              transition: border-color 0.2s;\n            "\n          />\n          <div style="margin-top: 4px; color: #888; font-size: 11px">\n            è¾ƒé«˜å€¼ï¼ˆå¦‚ 0.8ï¼‰ä½¿è¾“å‡ºæ›´éšæœºï¼Œè¾ƒä½å€¼ï¼ˆå¦‚ 0.2ï¼‰ä½¿å…¶æ›´ç¡®å®š\n          </div>\n        </div>\n\n        <div class="form-group" style="margin-bottom: 18px !important">\n          <label style="display: block; margin-bottom: 6px; color: #ccc; font-size: 13px">\n            Top P (æ ¸é‡‡æ ·) <span style="color: #888; font-size: 11px">(0-1ï¼Œæ¨è 1.0)</span>\n          </label>\n          <input\n            v-model.number="settings.top_p"\n            type="number"\n            min="0"\n            max="1"\n            step="0.01"\n            style="\n              width: 100%;\n              padding: 10px 12px;\n              background: #2a2a2a;\n              border: 1px solid #3a3a3a;\n              border-radius: 6px;\n              color: #e0e0e0;\n              font-size: 13px;\n              transition: border-color 0.2s;\n            "\n          />\n          <div style="margin-top: 4px; color: #888; font-size: 11px">\n            âš ï¸ ä¸€èˆ¬å»ºè®®åªæ”¹ Temperature æˆ– Top Pï¼Œä¸è¦åŒæ—¶ä¿®æ”¹\n          </div>\n        </div>\n\n        <div class="form-group" style="margin-bottom: 18px !important">\n          <label style="display: block; margin-bottom: 6px; color: #ccc; font-size: 13px">\n            Presence Penalty (å­˜åœ¨æƒ©ç½š) <span style="color: #888; font-size: 11px">(-2.0 to 2.0ï¼Œæ¨è 0)</span>\n          </label>\n          <input\n            v-model.number="settings.presence_penalty"\n            type="number"\n            min="-2"\n            max="2"\n            step="0.1"\n            style="\n              width: 100%;\n              padding: 10px 12px;\n              background: #2a2a2a;\n              border: 1px solid #3a3a3a;\n              border-radius: 6px;\n              color: #e0e0e0;\n              font-size: 13px;\n              transition: border-color 0.2s;\n            "\n          />\n          <div style="margin-top: 4px; color: #888; font-size: 11px">\n            æ­£å€¼æ ¹æ®æ ‡è®°æ˜¯å¦å‡ºç°è¿‡æ¥æƒ©ç½šï¼Œå¢åŠ è®¨è®ºæ–°ä¸»é¢˜çš„å¯èƒ½æ€§\n          </div>\n        </div>\n\n        <div class="form-group" style="margin-bottom: 18px !important">\n          <label style="display: block; margin-bottom: 6px; color: #ccc; font-size: 13px">\n            Frequency Penalty (é¢‘ç‡æƒ©ç½š) <span style="color: #888; font-size: 11px">(-2.0 to 2.0ï¼Œæ¨è 0)</span>\n          </label>\n          <input\n            v-model.number="settings.frequency_penalty"\n            type="number"\n            min="-2"\n            max="2"\n            step="0.1"\n            style="\n              width: 100%;\n              padding: 10px 12px;\n              background: #2a2a2a;\n              border: 1px solid #3a3a3a;\n              border-radius: 6px;\n              color: #e0e0e0;\n              font-size: 13px;\n              transition: border-color 0.2s;\n            "\n          />\n          <div style="margin-top: 4px; color: #888; font-size: 11px">\n            æ­£å€¼æ ¹æ®æ ‡è®°é¢‘ç‡æ¥æƒ©ç½šï¼Œé™ä½é€å­—é‡å¤åŒä¸€è¡Œçš„å¯èƒ½æ€§\n          </div>\n        </div>\n      </div>\n    </div>\n\n    \x3c!-- è‡ªåŠ¨æ€»ç»“ --\x3e\n    <div\n      class="config-section"\n      style="padding: 20px 25px !important; border-bottom: 1px solid #3a3a3a; margin-bottom: 5px"\n    >\n      <div\n        style="\n          cursor: pointer;\n          user-select: none;\n          display: flex;\n          align-items: center;\n          justify-content: space-between;\n          padding: 20px 28px;\n          background: linear-gradient(\n            135deg,\n            rgba(30, 30, 30, 0.95) 0%,\n            rgba(38, 38, 38, 0.9) 50%,\n            rgba(30, 30, 30, 0.95) 100%\n          );\n          backdrop-filter: blur(12px);\n          border-radius: 14px;\n          margin-bottom: 20px;\n          border: 1px solid rgba(255, 255, 255, 0.06);\n          box-shadow:\n            0 3px 12px rgba(0, 0, 0, 0.3),\n            inset 0 1px 0 rgba(255, 255, 255, 0.04),\n            inset 0 -1px 0 rgba(0, 0, 0, 0.2);\n          position: relative;\n          overflow: hidden;\n          transition: all 0.25s cubic-bezier(0.4, 0, 0.2, 1);\n        "\n        @click="toggleSection(\'autoSummary\')"\n        @mouseenter="\n          ($event.currentTarget as HTMLElement).style.background =\n            \'linear-gradient(135deg, rgba(42, 42, 42, 0.98) 0%, rgba(50, 50, 50, 0.95) 50%, rgba(42, 42, 42, 0.98) 100%)\';\n          ($event.currentTarget as HTMLElement).style.transform = \'translateX(4px) scale(1.005)\';\n          ($event.currentTarget as HTMLElement).style.borderLeft = \'3px solid rgba(255, 193, 7, 0.6)\';\n        "\n        @mouseleave="\n          ($event.currentTarget as HTMLElement).style.background =\n            \'linear-gradient(135deg, rgba(30, 30, 30, 0.95) 0%, rgba(38, 38, 38, 0.9) 50%, rgba(30, 30, 30, 0.95) 100%)\';\n          ($event.currentTarget as HTMLElement).style.transform = \'none\';\n          ($event.currentTarget as HTMLElement).style.borderLeft = \'1px solid rgba(255, 255, 255, 0.06)\';\n        "\n      >\n        <h3\n          style="\n            position: relative;\n            z-index: 1;\n            display: flex;\n            align-items: center;\n            gap: 12px;\n            margin: 0;\n            color: #fff;\n            font-size: 16px;\n            font-weight: 600;\n            letter-spacing: 0.5px;\n            text-shadow: 0 1px 2px rgba(0, 0, 0, 0.5);\n          "\n        >\n          <i class="fa-solid fa-bolt" style="color: #ffc107; font-size: 18px"></i>\n          è‡ªåŠ¨æ€»ç»“\n        </h3>\n        <i\n          :class="expandedSections[\'autoSummary\'] ? \'fa-chevron-up\' : \'fa-chevron-down\'"\n          class="fa-solid"\n          style="color: rgba(255, 255, 255, 0.6); font-size: 14px; transition: transform 0.3s"\n        ></i>\n      </div>\n\n      <div v-show="expandedSections[\'autoSummary\']">\n        <div class="form-group" style="margin-bottom: 18px !important">\n          <label\n            class="checkbox-label"\n            style="display: flex; align-items: center; gap: 8px; color: #ccc; font-size: 13px"\n          >\n            <input v-model="settings.auto_summarize_enabled" type="checkbox" style="width: 16px; height: 16px" />\n            å¯ç”¨è‡ªåŠ¨æ€»ç»“\n          </label>\n        </div>\n        <div v-if="settings.auto_summarize_enabled" class="form-group" style="margin-bottom: 18px !important">\n          <label style="display: block; margin-bottom: 6px; color: #ccc; font-size: 13px">æ¯å¤šå°‘æ¥¼å±‚æ€»ç»“ä¸€æ¬¡</label>\n          <input\n            v-model.number="settings.summarize_interval"\n            type="number"\n            min="1"\n            style="\n              width: 100%;\n              padding: 10px 12px;\n              background: #2a2a2a;\n              border: 1px solid #3a3a3a;\n              border-radius: 6px;\n              color: #e0e0e0;\n              font-size: 13px;\n              transition: border-color 0.2s;\n            "\n          />\n          <div style="margin-top: 10px; display: flex; gap: 10px">\n            <button\n              style="\n                padding: 8px 16px;\n                background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);\n                border: none;\n                border-radius: 6px;\n                color: white;\n                font-size: 12px;\n                cursor: pointer;\n                transition: all 0.3s ease;\n                box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);\n              "\n              onmouseover="this.style.transform=\'translateY(-1px)\'; this.style.boxShadow=\'0 4px 8px rgba(0,0,0,0.3)\'"\n              onmouseout="this.style.transform=\'translateY(0)\'; this.style.boxShadow=\'0 2px 4px rgba(0,0,0,0.2)\'"\n              @click="handleSaveSettings"\n            >\n              ğŸ’¾ ä¿å­˜è®¾ç½®\n            </button>\n            <button\n              style="\n                padding: 8px 16px;\n                background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);\n                border: none;\n                border-radius: 6px;\n                color: white;\n                font-size: 12px;\n                cursor: pointer;\n                transition: all 0.3s ease;\n                box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);\n              "\n              onmouseover="this.style.transform=\'translateY(-1px)\'; this.style.boxShadow=\'0 4px 8px rgba(0,0,0,0.3)\'"\n              onmouseout="this.style.transform=\'translateY(0)\'; this.style.boxShadow=\'0 2px 4px rgba(0,0,0,0.2)\'"\n              @click="handleReloadSettings"\n            >\n              ğŸ”„ é‡æ–°åŠ è½½\n            </button>\n            <button\n              style="\n                padding: 8px 16px;\n                background: linear-gradient(135deg, #ff9a9e 0%, #fecfef 100%);\n                border: none;\n                border-radius: 6px;\n                color: white;\n                font-size: 12px;\n                cursor: pointer;\n                transition: all 0.3s ease;\n                box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);\n              "\n              onmouseover="this.style.transform=\'translateY(-1px)\'; this.style.boxShadow=\'0 4px 8px rgba(0,0,0,0.3)\'"\n              onmouseout="this.style.transform=\'translateY(0)\'; this.style.boxShadow=\'0 2px 4px rgba(0,0,0,0.2)\'"\n              @click="handleResetAutoSummaryStart"\n            >\n              ğŸ”„ é‡ç½®èµ·å§‹æ¥¼å±‚\n            </button>\n          </div>\n        </div>\n      </div>\n    </div>\n\n    \x3c!-- æ‰‹åŠ¨æ€»ç»“ --\x3e\n    <div\n      class="config-section"\n      style="padding: 20px 25px !important; border-bottom: 1px solid #3a3a3a; margin-bottom: 5px"\n    >\n      <div\n        style="\n          cursor: pointer;\n          user-select: none;\n          display: flex;\n          align-items: center;\n          justify-content: space-between;\n          padding: 20px 28px;\n          background: linear-gradient(\n            135deg,\n            rgba(30, 30, 30, 0.95) 0%,\n            rgba(38, 38, 38, 0.9) 50%,\n            rgba(30, 30, 30, 0.95) 100%\n          );\n          backdrop-filter: blur(12px);\n          border-radius: 14px;\n          margin-bottom: 20px;\n          border: 1px solid rgba(255, 255, 255, 0.06);\n          box-shadow:\n            0 3px 12px rgba(0, 0, 0, 0.3),\n            inset 0 1px 0 rgba(255, 255, 255, 0.04),\n            inset 0 -1px 0 rgba(0, 0, 0, 0.2);\n          position: relative;\n          overflow: hidden;\n          transition: all 0.25s cubic-bezier(0.4, 0, 0.2, 1);\n        "\n        @click="toggleSection(\'manualSummary\')"\n        @mouseenter="\n          ($event.currentTarget as HTMLElement).style.background =\n            \'linear-gradient(135deg, rgba(42, 42, 42, 0.98) 0%, rgba(50, 50, 50, 0.95) 50%, rgba(42, 42, 42, 0.98) 100%)\';\n          ($event.currentTarget as HTMLElement).style.transform = \'translateX(4px) scale(1.005)\';\n          ($event.currentTarget as HTMLElement).style.borderLeft = \'3px solid rgba(255, 193, 7, 0.6)\';\n        "\n        @mouseleave="\n          ($event.currentTarget as HTMLElement).style.background =\n            \'linear-gradient(135deg, rgba(30, 30, 30, 0.95) 0%, rgba(38, 38, 38, 0.9) 50%, rgba(30, 30, 30, 0.95) 100%)\';\n          ($event.currentTarget as HTMLElement).style.transform = \'none\';\n          ($event.currentTarget as HTMLElement).style.borderLeft = \'1px solid rgba(255, 255, 255, 0.06)\';\n        "\n      >\n        <h3\n          style="\n            position: relative;\n            z-index: 1;\n            display: flex;\n            align-items: center;\n            gap: 12px;\n            margin: 0;\n            color: #fff;\n            font-size: 16px;\n            font-weight: 600;\n            letter-spacing: 0.5px;\n            text-shadow: 0 1px 2px rgba(0, 0, 0, 0.5);\n          "\n        >\n          <i class="fa-solid fa-pen-to-square" style="color: #28a745; font-size: 18px"></i>\n          æ‰‹åŠ¨æ€»ç»“\n        </h3>\n        <i\n          :class="expandedSections[\'manualSummary\'] ? \'fa-chevron-up\' : \'fa-chevron-down\'"\n          class="fa-solid"\n          style="color: rgba(255, 255, 255, 0.6); font-size: 14px; transition: transform 0.3s"\n        ></i>\n      </div>\n\n      <div v-show="expandedSections[\'manualSummary\']">\n        <div class="form-group" style="margin-bottom: 18px !important">\n          <label style="display: block; margin-bottom: 6px; color: #ccc; font-size: 13px">å¼€å§‹æ¥¼å±‚</label>\n          <input\n            v-model.number="settings.start_message_id"\n            type="number"\n            min="0"\n            style="\n              width: 100%;\n              padding: 10px 12px;\n              background: #2a2a2a;\n              border: 1px solid #3a3a3a;\n              border-radius: 6px;\n              color: #e0e0e0;\n              font-size: 13px;\n              transition: border-color 0.2s;\n            "\n          />\n        </div>\n        <div class="form-group" style="margin-bottom: 18px !important">\n          <label style="display: block; margin-bottom: 6px; color: #ccc; font-size: 13px">ç»“æŸæ¥¼å±‚</label>\n          <input\n            v-model.number="settings.end_message_id"\n            type="number"\n            min="0"\n            style="\n              width: 100%;\n              padding: 10px 12px;\n              background: #2a2a2a;\n              border: 1px solid #3a3a3a;\n              border-radius: 6px;\n              color: #e0e0e0;\n              font-size: 13px;\n              transition: border-color 0.2s;\n            "\n          />\n        </div>\n        <div class="button-group" style="display: flex; gap: 12px; flex-wrap: wrap; margin-top: 5px">\n          <button\n            class="action-button test-button"\n            :disabled="is_summarizing"\n            style="\n              flex: 1;\n              min-width: 120px;\n              padding: 12px 16px;\n              border: 1px solid #4a4a4a;\n              border-radius: 6px;\n              cursor: pointer;\n              font-weight: 500;\n              font-size: 13px;\n              transition: all 0.2s;\n              display: flex;\n              align-items: center;\n              justify-content: center;\n              gap: 6px;\n              background: #3a3a3a;\n              color: #e0e0e0;\n            "\n            @click="handle_test_connection"\n          >\n            <i class="fa-solid fa-plug"></i> æµ‹è¯•è¿æ¥\n          </button>\n          <button\n            class="action-button summarize-button"\n            :disabled="is_summarizing || !settings.api_key"\n            style="\n              flex: 1;\n              min-width: 120px;\n              padding: 12px 16px;\n              border: 1px solid #5aaeff;\n              border-radius: 6px;\n              cursor: pointer;\n              font-weight: 500;\n              font-size: 13px;\n              transition: all 0.2s;\n              display: flex;\n              align-items: center;\n              justify-content: center;\n              gap: 6px;\n              background: linear-gradient(135deg, #4a9eff 0%, #3a8edf 100%);\n              box-shadow:\n                0 2px 8px rgba(74, 158, 255, 0.25),\n                inset 0 1px 0 rgba(255, 255, 255, 0.15);\n              color: white;\n            "\n            @click="handle_summarize"\n          >\n            <i v-if="!is_summarizing" class="fa-solid fa-magic"></i>\n            <i v-else class="fa-solid fa-spinner fa-spin"></i>\n            {{ is_summarizing ? \'æ­£åœ¨æ€»ç»“...\' : \'æ‰‹åŠ¨æ€»ç»“\' }}\n          </button>\n        </div>\n      </div>\n    </div>\n\n    \x3c!-- è¡¨æ ¼ç”Ÿæˆ --\x3e\n    <div\n      class="config-section"\n      style="padding: 20px 25px !important; border-bottom: 1px solid #3a3a3a; margin-bottom: 5px"\n    >\n      <div\n        style="\n          cursor: pointer;\n          user-select: none;\n          display: flex;\n          align-items: center;\n          justify-content: space-between;\n          padding: 20px 28px;\n          background: linear-gradient(\n            135deg,\n            rgba(30, 30, 30, 0.95) 0%,\n            rgba(38, 38, 38, 0.9) 50%,\n            rgba(30, 30, 30, 0.95) 100%\n          );\n          backdrop-filter: blur(12px);\n          border-radius: 14px;\n          margin-bottom: 20px;\n          border: 1px solid rgba(255, 255, 255, 0.06);\n          box-shadow:\n            0 3px 12px rgba(0, 0, 0, 0.3),\n            inset 0 1px 0 rgba(255, 255, 255, 0.04),\n            inset 0 -1px 0 rgba(0, 0, 0, 0.2);\n          position: relative;\n          overflow: hidden;\n          transition: all 0.25s cubic-bezier(0.4, 0, 0.2, 1);\n        "\n        @click="toggleSection(\'tableGeneration\')"\n        @mouseenter="\n          ($event.currentTarget as HTMLElement).style.background =\n            \'linear-gradient(135deg, rgba(42, 42, 42, 0.98) 0%, rgba(50, 50, 50, 0.95) 50%, rgba(42, 42, 42, 0.98) 100%)\';\n          ($event.currentTarget as HTMLElement).style.transform = \'translateX(4px) scale(1.005)\';\n          ($event.currentTarget as HTMLElement).style.borderLeft = \'3px solid rgba(255, 193, 7, 0.6)\';\n        "\n        @mouseleave="\n          ($event.currentTarget as HTMLElement).style.background =\n            \'linear-gradient(135deg, rgba(30, 30, 30, 0.95) 0%, rgba(38, 38, 38, 0.9) 50%, rgba(30, 30, 30, 0.95) 100%)\';\n          ($event.currentTarget as HTMLElement).style.transform = \'none\';\n          ($event.currentTarget as HTMLElement).style.borderLeft = \'1px solid rgba(255, 255, 255, 0.06)\';\n        "\n      >\n        <h3\n          style="\n            position: relative;\n            z-index: 1;\n            display: flex;\n            align-items: center;\n            gap: 12px;\n            margin: 0;\n            color: #fff;\n            font-size: 16px;\n            font-weight: 600;\n            letter-spacing: 0.5px;\n            text-shadow: 0 1px 2px rgba(0, 0, 0, 0.5);\n          "\n        >\n          <i class="fa-solid fa-table" style="color: #6f42c1; font-size: 18px"></i>\n          è¡¨æ ¼ç”Ÿæˆ\n        </h3>\n        <i\n          :class="expandedSections[\'tableGeneration\'] ? \'fa-chevron-up\' : \'fa-chevron-down\'"\n          class="fa-solid"\n          style="color: rgba(255, 255, 255, 0.6); font-size: 14px; transition: transform 0.3s"\n        ></i>\n      </div>\n\n      <div v-show="expandedSections[\'tableGeneration\']">\n        <div class="form-group" style="margin-bottom: 18px !important">\n          <label style="display: block; margin-bottom: 6px; color: #ccc; font-size: 13px">å¼€å§‹æ¥¼å±‚</label>\n          <input\n            v-model.number="settings.table_start_message_id"\n            type="number"\n            min="0"\n            style="\n              width: 100%;\n              padding: 10px 12px;\n              background: #2a2a2a;\n              border: 1px solid #3a3a3a;\n              border-radius: 6px;\n              color: #e0e0e0;\n              font-size: 13px;\n              transition: border-color 0.2s;\n            "\n          />\n        </div>\n        <div class="form-group" style="margin-bottom: 18px !important">\n          <label style="display: block; margin-bottom: 6px; color: #ccc; font-size: 13px">ç»“æŸæ¥¼å±‚</label>\n          <input\n            v-model.number="settings.table_end_message_id"\n            type="number"\n            min="0"\n            style="\n              width: 100%;\n              padding: 10px 12px;\n              background: #2a2a2a;\n              border: 1px solid #3a3a3a;\n              border-radius: 6px;\n              color: #e0e0e0;\n              font-size: 13px;\n              transition: border-color 0.2s;\n            "\n          />\n        </div>\n        <div class="form-group" style="margin-bottom: 18px !important">\n          <label style="display: block; margin-bottom: 6px; color: #ccc; font-size: 13px">è¡¨æ ¼åˆ—å¤´æ¨¡æ¿</label>\n          <div style="display: flex; gap: 8px; margin-bottom: 8px">\n            <select\n              v-model="selectedTemplate"\n              style="\n                flex: 1;\n                padding: 8px 12px;\n                background: #2a2a2a;\n                border: 1px solid #3a3a3a;\n                border-radius: 6px;\n                color: #e0e0e0;\n                font-size: 13px;\n              "\n              @change="loadTemplate"\n            >\n              <option value="">é€‰æ‹©æ¨¡æ¿...</option>\n              <option v-for="(template, index) in headerTemplates" :key="index" :value="index">\n                {{ template.name }}\n              </option>\n            </select>\n            <button\n              style="\n                padding: 8px 12px;\n                background: #4a9eff;\n                border: none;\n                border-radius: 6px;\n                color: white;\n                cursor: pointer;\n                font-size: 12px;\n                white-space: nowrap;\n              "\n              @click="showAddTemplateDialog"\n            >\n              <i class="fa-solid fa-plus"></i> æ·»åŠ \n            </button>\n          </div>\n          <div v-if="selectedTemplate !== \'\'" style="display: flex; gap: 8px">\n            <input\n              v-model="currentTemplate.name"\n              type="text"\n              placeholder="æ¨¡æ¿åç§°"\n              style="\n                flex: 1;\n                padding: 8px 12px;\n                background: #2a2a2a;\n                border: 1px solid #3a3a3a;\n                border-radius: 6px;\n                color: #e0e0e0;\n                font-size: 13px;\n              "\n            />\n            <input\n              v-model="currentTemplate.headers"\n              type="text"\n              placeholder="åˆ—å¤´ï¼ˆç”¨é€—å·åˆ†éš”ï¼‰"\n              style="\n                flex: 2;\n                padding: 8px 12px;\n                background: #2a2a2a;\n                border: 1px solid #3a3a3a;\n                border-radius: 6px;\n                color: #e0e0e0;\n                font-size: 13px;\n              "\n            />\n            <button\n              style="\n                padding: 8px 12px;\n                background: #28a745;\n                border: none;\n                border-radius: 6px;\n                color: white;\n                cursor: pointer;\n                font-size: 12px;\n                white-space: nowrap;\n              "\n              @click="saveTemplate"\n            >\n              <i class="fa-solid fa-save"></i> ä¿å­˜\n            </button>\n            <button\n              style="\n                padding: 8px 12px;\n                background: #dc3545;\n                border: none;\n                border-radius: 6px;\n                color: white;\n                cursor: pointer;\n                font-size: 12px;\n                white-space: nowrap;\n              "\n              @click="deleteTemplate"\n            >\n              <i class="fa-solid fa-trash"></i> åˆ é™¤\n            </button>\n          </div>\n        </div>\n\n        \x3c!-- ç”ŸæˆçŠ¶æ€æ˜¾ç¤º --\x3e\n        <div class="form-group" style="margin-bottom: 18px !important">\n          <label style="display: block; margin-bottom: 6px; color: #ccc; font-size: 13px">ç”ŸæˆçŠ¶æ€</label>\n          <div style="display: flex; gap: 12px; align-items: center">\n            <div style="display: flex; align-items: center; gap: 6px">\n              <div\n                :style="{\n                  width: \'8px\',\n                  height: \'8px\',\n                  borderRadius: \'50%\',\n                  backgroundColor: is_summarizing ? \'#ff6b6b\' : \'#4caf50\',\n                  transition: \'background-color 0.3s\',\n                }"\n              ></div>\n              <span style="color: #ccc; font-size: 12px">æ€»ç»“ç”Ÿæˆ</span>\n            </div>\n            <div style="display: flex; align-items: center; gap: 6px">\n              <div\n                :style="{\n                  width: \'8px\',\n                  height: \'8px\',\n                  borderRadius: \'50%\',\n                  backgroundColor: is_generating_table ? \'#ff6b6b\' : \'#4caf50\',\n                  transition: \'background-color 0.3s\',\n                }"\n              ></div>\n              <span style="color: #ccc; font-size: 12px">è¡¨æ ¼ç”Ÿæˆ</span>\n            </div>\n            <div v-if="is_summarizing || is_generating_table" style="margin-left: auto">\n              <button\n                style="\n                  padding: 4px 8px;\n                  background: #dc3545;\n                  border: none;\n                  border-radius: 4px;\n                  color: white;\n                  cursor: pointer;\n                  font-size: 11px;\n                "\n                @click="stopGeneration"\n              >\n                <i class="fa-solid fa-stop"></i> åœæ­¢ç”Ÿæˆ\n              </button>\n            </div>\n          </div>\n        </div>\n\n        <div class="button-group" style="display: flex; gap: 12px; flex-wrap: wrap; margin-top: 5px">\n          <button\n            class="action-button summarize-button"\n            :disabled="is_generating_table || !settings.api_key"\n            style="\n              flex: 1;\n              min-width: 120px;\n              padding: 12px 16px;\n              border: 1px solid #5aaeff;\n              border-radius: 6px;\n              cursor: pointer;\n              font-weight: 500;\n              font-size: 13px;\n              transition: all 0.2s;\n              display: flex;\n              align-items: center;\n              justify-content: center;\n              gap: 6px;\n              background: linear-gradient(135deg, #4a9eff 0%, #3a8edf 100%);\n              box-shadow:\n                0 2px 8px rgba(74, 158, 255, 0.25),\n                inset 0 1px 0 rgba(255, 255, 255, 0.15);\n              color: white;\n            "\n            @click="handle_generate_table"\n          >\n            <i v-if="!is_generating_table" class="fa-solid fa-robot"></i>\n            <i v-else class="fa-solid fa-spinner fa-spin"></i>\n            {{ is_generating_table ? \'AIå¡«å……ä¸­...\' : \'AIå¡«å……è¡¨æ ¼\' }}\n          </button>\n          <button\n            class="action-button create-button"\n            style="\n              flex: 1;\n              min-width: 120px;\n              padding: 12px 16px;\n              border: 1px solid #40c057;\n              border-radius: 6px;\n              cursor: pointer;\n              font-weight: 500;\n              font-size: 13px;\n              transition: all 0.2s;\n              display: flex;\n              align-items: center;\n              justify-content: center;\n              gap: 6px;\n              background: linear-gradient(135deg, #51cf66 0%, #40c057 100%);\n              box-shadow:\n                0 2px 8px rgba(81, 207, 102, 0.25),\n                inset 0 1px 0 rgba(255, 255, 255, 0.15);\n              color: white;\n            "\n            @click="handle_create_table"\n          >\n            <i class="fa-solid fa-plus"></i> åˆ›å»ºç©ºè¡¨æ ¼\n          </button>\n        </div>\n      </div>\n    </div>\n\n    \x3c!-- æ¥¼å±‚ç®¡ç† --\x3e\n    <div\n      class="config-section"\n      style="padding: 20px 25px !important; border-bottom: 1px solid #3a3a3a; margin-bottom: 5px"\n    >\n      <div\n        style="\n          cursor: pointer;\n          user-select: none;\n          display: flex;\n          align-items: center;\n          justify-content: space-between;\n          padding: 20px 28px;\n          background: linear-gradient(\n            135deg,\n            rgba(30, 30, 30, 0.95) 0%,\n            rgba(38, 38, 38, 0.9) 50%,\n            rgba(30, 30, 30, 0.95) 100%\n          );\n          backdrop-filter: blur(12px);\n          border-radius: 14px;\n          margin-bottom: 20px;\n          border: 1px solid rgba(255, 255, 255, 0.06);\n          box-shadow:\n            0 3px 12px rgba(0, 0, 0, 0.3),\n            inset 0 1px 0 rgba(255, 255, 255, 0.04),\n            inset 0 -1px 0 rgba(0, 0, 0, 0.2);\n          position: relative;\n          overflow: hidden;\n          transition: all 0.25s cubic-bezier(0.4, 0, 0.2, 1);\n        "\n        @click="toggleSection(\'messageManagement\')"\n        @mouseenter="\n          ($event.currentTarget as HTMLElement).style.background =\n            \'linear-gradient(135deg, rgba(42, 42, 42, 0.98) 0%, rgba(50, 50, 50, 0.95) 50%, rgba(42, 42, 42, 0.98) 100%)\';\n          ($event.currentTarget as HTMLElement).style.transform = \'translateX(4px) scale(1.005)\';\n          ($event.currentTarget as HTMLElement).style.borderLeft = \'3px solid rgba(255, 193, 7, 0.6)\';\n        "\n        @mouseleave="\n          ($event.currentTarget as HTMLElement).style.background =\n            \'linear-gradient(135deg, rgba(30, 30, 30, 0.95) 0%, rgba(38, 38, 38, 0.9) 50%, rgba(30, 30, 30, 0.95) 100%)\';\n          ($event.currentTarget as HTMLElement).style.transform = \'none\';\n          ($event.currentTarget as HTMLElement).style.borderLeft = \'1px solid rgba(255, 255, 255, 0.06)\';\n        "\n      >\n        <h3\n          style="\n            position: relative;\n            z-index: 1;\n            display: flex;\n            align-items: center;\n            gap: 12px;\n            margin: 0;\n            color: #fff;\n            font-size: 16px;\n            font-weight: 600;\n            letter-spacing: 0.5px;\n            text-shadow: 0 1px 2px rgba(0, 0, 0, 0.5);\n          "\n        >\n          <i class="fa-solid fa-layer-group" style="color: #dc3545; font-size: 18px"></i>\n          æ¥¼å±‚ç®¡ç†\n        </h3>\n        <i\n          :class="expandedSections[\'messageManagement\'] ? \'fa-chevron-up\' : \'fa-chevron-down\'"\n          class="fa-solid"\n          style="color: rgba(255, 255, 255, 0.6); font-size: 14px; transition: transform 0.3s"\n        ></i>\n      </div>\n\n      <div v-show="expandedSections[\'messageManagement\']">\n        <div class="form-group" style="margin-bottom: 18px !important">\n          <label style="display: block; margin-bottom: 6px; color: #ccc; font-size: 13px"\n            >éšè—æ¥¼å±‚èŒƒå›´ï¼ˆå¦‚ï¼š1-10 æˆ–å•ä¸ªæ¥¼å±‚å¦‚ï¼š5ï¼‰</label\n          >\n          <input\n            v-model="hide_range"\n            type="text"\n            placeholder="1-10"\n            style="\n              width: 100%;\n              padding: 10px 12px;\n              background: #2a2a2a;\n              border: 1px solid #3a3a3a;\n              border-radius: 6px;\n              color: #e0e0e0;\n              font-size: 13px;\n              transition: border-color 0.2s;\n            "\n          />\n        </div>\n        <div class="button-group" style="display: flex; gap: 12px; flex-wrap: wrap; margin-top: 5px">\n          <button\n            class="action-button"\n            style="\n              flex: 1;\n              min-width: 120px;\n              padding: 12px 16px;\n              border: 1px solid #ff5252;\n              border-radius: 6px;\n              cursor: pointer;\n              font-weight: 500;\n              font-size: 13px;\n              transition: all 0.2s;\n              display: flex;\n              align-items: center;\n              justify-content: center;\n              gap: 6px;\n              background: #ff6b6b;\n              color: white;\n            "\n            @click="handle_hide_messages"\n          >\n            <i class="fa-solid fa-eye-slash"></i> éšè—æ¥¼å±‚\n          </button>\n          <button\n            class="action-button"\n            style="\n              flex: 1;\n              min-width: 120px;\n              padding: 12px 16px;\n              border: 1px solid #40c057;\n              border-radius: 6px;\n              cursor: pointer;\n              font-weight: 500;\n              font-size: 13px;\n              transition: all 0.2s;\n              display: flex;\n              align-items: center;\n              justify-content: center;\n              gap: 6px;\n              background: linear-gradient(135deg, #51cf66 0%, #40c057 100%);\n              box-shadow:\n                0 2px 8px rgba(81, 207, 102, 0.25),\n                inset 0 1px 0 rgba(255, 255, 255, 0.15);\n              color: white;\n            "\n            :disabled="!hide_range.trim()"\n            @click="handle_show_messages"\n          >\n            <i class="fa-solid fa-eye"></i> æ˜¾ç¤ºæ¥¼å±‚\n          </button>\n          <button\n            class="action-button"\n            style="\n              flex: 1;\n              min-width: 120px;\n              padding: 12px 16px;\n              border: 1px solid #ffcc02;\n              border-radius: 6px;\n              cursor: pointer;\n              font-weight: 500;\n              font-size: 13px;\n              transition: all 0.2s;\n              display: flex;\n              align-items: center;\n              justify-content: center;\n              gap: 6px;\n              background: #ffd43b;\n              color: #333;\n            "\n            @click="() => handle_refresh_hidden(true)"\n          >\n            <i class="fa-solid fa-refresh"></i> åˆ·æ–°\n          </button>\n        </div>\n\n        \x3c!-- æ˜¾ç¤ºéšè—çš„æ¥¼å±‚åˆ—è¡¨ --\x3e\n        <div v-if="hidden_messages.length > 0" class="hidden-messages-section">\n          <div class="form-group">\n            <label class="flex-label">\n              <span>å·²éšè—çš„æ¥¼å±‚ ({{ hidden_messages.length }} ä¸ª)</span>\n              <button class="mini-button" @click="hidden_display_expanded = !hidden_display_expanded">\n                {{ hidden_display_expanded ? \'æ”¶èµ·\' : \'å±•å¼€\' }}\n              </button>\n            </label>\n          </div>\n          <div v-if="hidden_display_expanded" class="hidden-messages-list">\n            <div v-for="msg in hidden_messages" :key="msg.message_id" class="hidden-message-item">\n              <div class="message-info">\n                <span class="message-id">#{{ msg.message_id }}</span>\n                <span class="message-role" :class="\'role-\' + msg.role">\n                  {{ msg.role === \'user\' ? \'ğŸ‘¤\' : msg.role === \'assistant\' ? \'ğŸ¤–\' : \'âš™ï¸\' }}\n                  {{ msg.name }}\n                </span>\n                <span class="message-preview">\n                  {{ msg.message.substring(0, 50) }}{{ msg.message.length > 50 ? \'...\' : \'\' }}\n                </span>\n              </div>\n              <button class="show-button" @click="() => handle_unhide_single(msg.message_id)">æ˜¾ç¤º</button>\n            </div>\n          </div>\n        </div>\n        <div v-else class="empty-state">æš‚æ— éšè—çš„æ¥¼å±‚</div>\n      </div>\n    </div>\n\n    \x3c!-- è¿›åº¦å¯¹è¯æ¡† --\x3e\n    <ProgressDialog ref="progressDialogRef" :show="showProgress" title="AI æ­£åœ¨å¤„ç†" />\n  </div>\n</template>\n\n<script setup lang="ts">\nimport { storeToRefs } from \'pinia\';\nimport { onMounted, ref } from \'vue\';\nimport { useSettingsStore, useSummaryHistoryStore } from \'../settings\';\nimport { getChatIdSafe, getScriptIdSafe } from \'../utils\';\nimport ProgressDialog from \'./ProgressDialog.vue\';\n\nconst settingsStore = useSettingsStore();\nconst { settings } = storeToRefs(settingsStore);\nconst summaryHistoryStore = useSummaryHistoryStore();\n\n// æŠ˜å å±•å¼€çŠ¶æ€\nconst expandedSections = ref<Record<string, boolean>>({\n  api: true,\n  autoSummary: true,\n  manualSummary: true,\n  tableGeneration: true,\n  messageManagement: true,\n});\n\n// åˆ‡æ¢åˆ†ç±»å±•å¼€/æŠ˜å \nconst toggleSection = (section: string) => {\n  expandedSections.value[section] = !expandedSections.value[section];\n};\n\n// å¯¼å…¥é…’é¦†APIå‡½æ•°\n// setChatMessages æ˜¯å…¨å±€å‡½æ•°ï¼Œä¸éœ€è¦å¯¼å…¥\n\n// è§£ææ¥¼å±‚èŒƒå›´çš„è¾…åŠ©å‡½æ•°\nconst parseMessageRange = (range: string): number[] => {\n  if (!range.trim()) return [];\n\n  const messageIds: number[] = [];\n  const parts = range.split(\',\');\n\n  for (const part of parts) {\n    const trimmed = part.trim();\n    if (!trimmed) continue;\n\n    if (trimmed.includes(\'-\')) {\n      // å¤„ç†èŒƒå›´ï¼Œå¦‚ "1-10"\n      const [start, end] = trimmed.split(\'-\').map(s => parseInt(s.trim()));\n      if (!isNaN(start) && !isNaN(end) && start >= 0 && end >= 0) {\n        for (let i = start; i <= end; i++) {\n          messageIds.push(i);\n        }\n      }\n    } else {\n      // å¤„ç†å•ä¸ªæ¥¼å±‚ï¼Œå¦‚ "5" æˆ– "0"\n      const id = parseInt(trimmed);\n      if (!isNaN(id) && id >= 0) {\n        messageIds.push(id);\n      }\n    }\n  }\n\n  return messageIds;\n};\n\n// å“åº”å¼æ•°æ®\nconst available_models = ref<string[]>([]);\nconst loading_models = ref(false);\nconst hide_range = ref<string>(\'\');\nconst hidden_messages = ref<Array<{ message_id: number; name: string; role: string; message: string }>>([]);\nconst hidden_display_expanded = ref(false);\n\n// æŒä¹…åŒ–ç”ŸæˆçŠ¶æ€\nconst is_summarizing = ref(false);\nconst is_generating_table = ref(false);\n\n// è¿›åº¦å¯¹è¯æ¡†\nconst showProgress = ref(false);\nconst progressDialogRef = ref<InstanceType<typeof ProgressDialog> | null>(null);\n\n// è¡¨æ ¼åˆ—å¤´æ¨¡æ¿ç›¸å…³\nconst headerTemplates = ref<Array<{ name: string; headers: string }>>([]);\nconst selectedTemplate = ref<string>(\'\');\nconst currentTemplate = ref<{ name: string; headers: string }>({ name: \'\', headers: \'\' });\n\n// ç”ŸæˆçŠ¶æ€ç®¡ç†\nconst loadGenerationStatus = () => {\n  try {\n    const scriptId = getScriptIdSafe();\n    if (!scriptId) {\n      console.warn(\'script_id ä¸ºç©ºï¼Œæ— æ³•åŠ è½½ç”ŸæˆçŠ¶æ€\');\n      return;\n    }\n    const scriptVars = getVariables({ type: \'script\', script_id: scriptId });\n    is_summarizing.value = scriptVars.is_summarizing || false;\n    is_generating_table.value = scriptVars.is_generating_table || false;\n    console.log(\'å·²åŠ è½½ç”ŸæˆçŠ¶æ€:\', { summarizing: is_summarizing.value, generating_table: is_generating_table.value });\n  } catch (error) {\n    console.error(\'åŠ è½½ç”ŸæˆçŠ¶æ€å¤±è´¥:\', error);\n    is_summarizing.value = false;\n    is_generating_table.value = false;\n  }\n};\n\nconst saveGenerationStatus = () => {\n  try {\n    const scriptId = getScriptIdSafe();\n    if (!scriptId) {\n      console.warn(\'script_id ä¸ºç©ºï¼Œæ— æ³•ä¿å­˜ç”ŸæˆçŠ¶æ€\');\n      return;\n    }\n    insertOrAssignVariables(\n      {\n        is_summarizing: is_summarizing.value,\n        is_generating_table: is_generating_table.value,\n      },\n      { type: \'script\', script_id: scriptId },\n    );\n    console.log(\'å·²ä¿å­˜ç”ŸæˆçŠ¶æ€\');\n  } catch (error) {\n    console.error(\'ä¿å­˜ç”ŸæˆçŠ¶æ€å¤±è´¥:\', error);\n  }\n};\n\nconst stopGeneration = () => {\n  if (is_summarizing.value || is_generating_table.value) {\n    is_summarizing.value = false;\n    is_generating_table.value = false;\n    saveGenerationStatus();\n    window.toastr.info(\'å·²åœæ­¢æ‰€æœ‰ç”Ÿæˆä»»åŠ¡\');\n  }\n};\n\n// è¡¨æ ¼åˆ—å¤´æ¨¡æ¿ç®¡ç†\nconst loadHeaderTemplates = () => {\n  try {\n    const scriptId = getScriptIdSafe();\n    if (!scriptId) {\n      console.warn(\'script_id ä¸ºç©ºï¼Œæ— æ³•åŠ è½½åˆ—å¤´æ¨¡æ¿\');\n      return;\n    }\n    const scriptVars = getVariables({ type: \'script\', script_id: scriptId });\n    // å…¼å®¹ header_templates å¯èƒ½ä¸º nullã€undefinedã€å­—ç¬¦ä¸²ç­‰ç±»å‹\n    let templates = scriptVars.header_templates;\n    // å°† nullã€undefined æˆ–ä¸ä¸ºæ•°ç»„çš„æƒ…å†µéƒ½å½’ä¸º []\n    if (!Array.isArray(templates)) {\n      templates = [];\n    }\n    headerTemplates.value = templates;\n    console.log(\'å·²åŠ è½½åˆ—å¤´æ¨¡æ¿:\', headerTemplates.value.length, \'ä¸ª\');\n  } catch (error) {\n    console.error(\'åŠ è½½åˆ—å¤´æ¨¡æ¿å¤±è´¥:\', error);\n    headerTemplates.value = [];\n  }\n};\n\nconst saveHeaderTemplates = () => {\n  try {\n    const scriptId = getScriptIdSafe();\n    if (!scriptId) {\n      console.warn(\'script_id ä¸ºç©ºï¼Œæ— æ³•ä¿å­˜åˆ—å¤´æ¨¡æ¿\');\n      return;\n    }\n    insertOrAssignVariables(klona({ header_templates: headerTemplates.value }), {\n      type: \'script\',\n      script_id: scriptId,\n    });\n    console.log(\'å·²ä¿å­˜åˆ—å¤´æ¨¡æ¿\');\n  } catch (error) {\n    console.error(\'ä¿å­˜åˆ—å¤´æ¨¡æ¿å¤±è´¥:\', error);\n  }\n};\n\nconst loadTemplate = () => {\n  if (selectedTemplate.value !== \'\') {\n    const index = parseInt(selectedTemplate.value);\n    if (index >= 0 && index < headerTemplates.value.length) {\n      currentTemplate.value = { ...headerTemplates.value[index] };\n    }\n  }\n};\n\nconst showAddTemplateDialog = () => {\n  const name = window.prompt(\'è¯·è¾“å…¥æ¨¡æ¿åç§°ï¼š\');\n  if (name && name.trim()) {\n    const headers = window.prompt(\'è¯·è¾“å…¥åˆ—å¤´ï¼ˆç”¨é€—å·åˆ†éš”ï¼‰ï¼š\');\n    if (headers && headers.trim()) {\n      headerTemplates.value.push({ name: name.trim(), headers: headers.trim() });\n      saveHeaderTemplates();\n      selectedTemplate.value = (headerTemplates.value.length - 1).toString();\n      loadTemplate();\n      window.toastr.success(\'æ¨¡æ¿æ·»åŠ æˆåŠŸ\');\n    }\n  }\n};\n\nconst saveTemplate = () => {\n  if (selectedTemplate.value !== \'\' && currentTemplate.value.name.trim() && currentTemplate.value.headers.trim()) {\n    const index = parseInt(selectedTemplate.value);\n    if (index >= 0 && index < headerTemplates.value.length) {\n      headerTemplates.value[index] = { ...currentTemplate.value };\n      saveHeaderTemplates();\n      window.toastr.success(\'æ¨¡æ¿ä¿å­˜æˆåŠŸ\');\n    }\n  } else {\n    window.toastr.warning(\'è¯·å¡«å†™æ¨¡æ¿åç§°å’Œåˆ—å¤´\');\n  }\n};\n\nconst deleteTemplate = () => {\n  if (selectedTemplate.value !== \'\') {\n    if (confirm(\'ç¡®å®šè¦åˆ é™¤è¿™ä¸ªæ¨¡æ¿å—ï¼Ÿ\')) {\n      const index = parseInt(selectedTemplate.value);\n      if (index >= 0 && index < headerTemplates.value.length) {\n        headerTemplates.value.splice(index, 1);\n        saveHeaderTemplates();\n        selectedTemplate.value = \'\';\n        currentTemplate.value = { name: \'\', headers: \'\' };\n        window.toastr.success(\'æ¨¡æ¿åˆ é™¤æˆåŠŸ\');\n      }\n    }\n  }\n};\n\n// ä»é…’é¦†å˜é‡åŠ è½½éšè—æ¥¼å±‚æ•°æ®\nconst loadHiddenMessages = () => {\n  try {\n    const scriptId = getScriptIdSafe();\n    if (!scriptId) {\n      console.warn(\'script_id ä¸ºç©ºï¼Œæ— æ³•åŠ è½½éšè—æ¥¼å±‚æ•°æ®\');\n      return;\n    }\n    console.log(\'è„šæœ¬ID:\', scriptId);\n\n    const saved = getVariables({ type: \'script\', script_id: scriptId });\n    console.log(\'ä»é…’é¦†å˜é‡åŠ è½½çš„æ•°æ®:\', saved);\n    console.log(\'æ£€æŸ¥ hidden_messages å­—æ®µ:\', saved?.hidden_messages);\n\n    if (saved && saved.hidden_messages) {\n      hidden_messages.value = saved.hidden_messages;\n      console.log(\'æˆåŠŸåŠ è½½éšè—æ¥¼å±‚æ•°æ®:\', hidden_messages.value.length, \'ä¸ª\');\n    } else {\n      console.log(\'æ²¡æœ‰æ‰¾åˆ°éšè—æ¥¼å±‚æ•°æ®ï¼Œå°è¯•å…¶ä»–å­—æ®µå...\');\n      // å°è¯•å…¶ä»–å¯èƒ½çš„å­—æ®µå\n      const possibleFields = [\'hiddenMessages\', \'hidden_floors\', \'hiddenFloors\', \'floor_data\'];\n      for (const field of possibleFields) {\n        if (saved && saved[field]) {\n          console.log(`æ‰¾åˆ°å­—æ®µ ${field}:`, saved[field]);\n          hidden_messages.value = saved[field];\n          break;\n        }\n      }\n    }\n  } catch (error) {\n    console.error(\'åŠ è½½éšè—æ¥¼å±‚æ•°æ®å¤±è´¥:\', error);\n  }\n};\n\n// ä¿å­˜éšè—æ¥¼å±‚æ•°æ®åˆ°é…’é¦†å˜é‡\nconst saveHiddenMessages = () => {\n  try {\n    const scriptId = getScriptIdSafe();\n    if (!scriptId) {\n      console.warn(\'script_id ä¸ºç©ºï¼Œæ— æ³•ä¿å­˜éšè—æ¥¼å±‚æ•°æ®\');\n      return;\n    }\n    console.log(\'ä¿å­˜åˆ°è„šæœ¬ID:\', scriptId);\n    console.log(\'è¦ä¿å­˜çš„æ•°æ®:\', klona(hidden_messages.value));\n\n    const dataToSave = {\n      hidden_messages: hidden_messages.value,\n    };\n    console.log(\'å‡†å¤‡ä¿å­˜çš„æ•°æ®å¯¹è±¡:\', klona(dataToSave));\n\n    insertOrAssignVariables(klona(dataToSave), { type: \'script\', script_id: scriptId });\n    console.log(\'æˆåŠŸä¿å­˜éšè—æ¥¼å±‚æ•°æ®:\', hidden_messages.value.length, \'ä¸ª\');\n\n    // éªŒè¯ä¿å­˜æ˜¯å¦æˆåŠŸ\n    setTimeout(() => {\n      const saved = getVariables({ type: \'script\', script_id: scriptId });\n      console.log(\'éªŒè¯ä¿å­˜ç»“æœ:\', saved);\n      console.log(\'éªŒè¯ hidden_messages å­—æ®µ:\', saved?.hidden_messages);\n    }, 100);\n  } catch (error) {\n    console.error(\'ä¿å­˜éšè—æ¥¼å±‚æ•°æ®å¤±è´¥:\', error);\n  }\n};\n\n// åˆå§‹åŒ– API æä¾›å•†ï¼ˆæ ¹æ®å½“å‰ç«¯ç‚¹è‡ªåŠ¨åˆ¤æ–­ï¼‰\nconst initApiProvider = () => {\n  if (!settings.value.api_provider || settings.value.api_provider === \'\') {\n    const endpoint = settings.value.api_endpoint || \'\';\n    if (endpoint.includes(\'generativelanguage.googleapis.com\')) {\n      settings.value.api_provider = \'gemini\';\n    } else if (endpoint.includes(\'open.bigmodel.cn\')) {\n      settings.value.api_provider = \'zhipu\';\n    } else {\n      settings.value.api_provider = \'openai\';\n    }\n  }\n};\n\n// ç»„ä»¶æŒ‚è½½æ—¶åŠ è½½æ•°æ®\nonMounted(() => {\n  console.log(\'SettingsTab ç»„ä»¶å·²æŒ‚è½½ï¼Œå¼€å§‹åŠ è½½æ•°æ®\');\n  initApiProvider(); // åˆå§‹åŒ– API æä¾›å•†\n  loadHiddenMessages();\n  loadHeaderTemplates();\n  loadGenerationStatus();\n});\n\n// æµ‹è¯•æŒ‰é’®å¤„ç†å‡½æ•°\nconst handleTestButton = () => {\n  console.log(\'åŸç”Ÿç‚¹å‡» - Vueäº‹ä»¶ç»‘å®šå·¥ä½œæ­£å¸¸\');\n  window.toastr.success(\'Vueäº‹ä»¶ç»‘å®šå·¥ä½œæ­£å¸¸ï¼\');\n};\n\n// è®¾ç½®ç®¡ç†å‡½æ•°\nconst handleSaveSettings = () => {\n  console.log(\'ğŸ’¾ æ‰‹åŠ¨ä¿å­˜è®¾ç½®...\');\n  const success = settingsStore.saveSettings();\n  if (success) {\n    console.log(\'âœ… è®¾ç½®ä¿å­˜æˆåŠŸ\');\n  } else {\n    console.error(\'âŒ è®¾ç½®ä¿å­˜å¤±è´¥\');\n  }\n};\n\nconst handleReloadSettings = () => {\n  console.log(\'ğŸ”„ é‡æ–°åŠ è½½è®¾ç½®...\');\n  const success = settingsStore.reloadSettings();\n  if (success) {\n    console.log(\'âœ… è®¾ç½®é‡æ–°åŠ è½½æˆåŠŸ\');\n  } else {\n    console.error(\'âŒ è®¾ç½®é‡æ–°åŠ è½½å¤±è´¥\');\n  }\n};\n\nconst handleResetAutoSummaryStart = () => {\n  console.log(\'ğŸ”„ é‡ç½®è‡ªåŠ¨æ€»ç»“èµ·å§‹æ¥¼å±‚...\');\n  try {\n    // è°ƒç”¨å…¨å±€å‡½æ•°\n    if (typeof (window as any).resetAutoSummaryStart === \'function\') {\n      (window as any).resetAutoSummaryStart();\n    } else {\n      window.toastr.error(\'é‡ç½®å‡½æ•°ä¸å¯ç”¨ï¼Œè¯·åˆ·æ–°é¡µé¢åé‡è¯•\');\n    }\n  } catch (error) {\n    console.error(\'âŒ é‡ç½®èµ·å§‹æ¥¼å±‚å¤±è´¥:\', error);\n    window.toastr.error(\'é‡ç½®å¤±è´¥: \' + (error as Error).message);\n  }\n};\n\n// API æä¾›å•†åˆ‡æ¢å¤„ç†\nconst handleProviderChange = () => {\n  const provider = settings.value.api_provider;\n  const providerEndpoints: Record<string, string> = {\n    openai: \'https://api.openai.com/v1\',\n    gemini: \'https://generativelanguage.googleapis.com/v1beta/openai\',\n  };\n\n  if (providerEndpoints[provider]) {\n    settings.value.api_endpoint = providerEndpoints[provider];\n    window.toastr.success(`å·²åˆ‡æ¢åˆ° ${provider === \'openai\' ? \'OpenAI\' : \'Gemini AI Studio\'}`);\n  }\n};\n\n// å…¶ä»–å¤„ç†å‡½æ•°ï¼ˆè¿™é‡Œéœ€è¦ä»åŸç»„ä»¶ä¸­å¤åˆ¶ç›¸åº”çš„é€»è¾‘ï¼‰\n// ä¿å­˜APIé…ç½®\nconst handleSaveApiConfig = () => {\n  try {\n    // éªŒè¯å¿…å¡«é¡¹\n    if (!settings.value.api_endpoint || !settings.value.api_key) {\n      window.toastr.warning(\'è¯·å…ˆå¡«å†™ API ç«¯ç‚¹å’Œ API Key\');\n      return;\n    }\n\n    // ç«‹å³ä¿å­˜é…ç½®\n    const success = settingsStore.saveSettings();\n    if (success) {\n      console.log(\'API é…ç½®å·²ä¿å­˜:\', {\n        endpoint: settings.value.api_endpoint,\n        model: settings.value.model,\n        provider: settings.value.api_provider,\n        // ä¸æ‰“å°å®Œæ•´çš„ API Key\n        api_key: settings.value.api_key ? \'***\' + settings.value.api_key.slice(-4) : \'\',\n      });\n    }\n  } catch (error) {\n    console.error(\'ä¿å­˜ API é…ç½®å¤±è´¥:\', error);\n    window.toastr.error(\'ä¿å­˜å¤±è´¥ï¼š\' + (error as Error).message);\n  }\n};\n\n// ä»é…’é¦†å¯¼å…¥é…ç½®ï¼ˆå·²åºŸå¼ƒï¼Œä»…ä¿ç•™ç”¨äºå‚è€ƒï¼‰\nconst handleImportFromTavern = async () => {\n  try {\n    console.log(\'ğŸ“¥ å¼€å§‹ä»é…’é¦†å¯¼å…¥é…ç½®...\');\n\n    // æ£€æŸ¥å¿…è¦çš„å‡½æ•°æ˜¯å¦å¯ç”¨\n    if (typeof triggerSlash === \'undefined\') {\n      window.toastr.error(\'æ— æ³•è®¿é—®é…’é¦†å‘½ä»¤ï¼Œè¯·ç¡®ä¿åœ¨é…’é¦†ç¯å¢ƒä¸­è¿è¡Œ\');\n      return;\n    }\n\n    console.log(\'ğŸ” ä½¿ç”¨æ–œæ å‘½ä»¤è¯»å–è¿æ¥é…ç½®æ–‡ä»¶...\');\n\n    // æ­¥éª¤ 1: è·å–å½“å‰é…ç½®æ–‡ä»¶åç§°\n    console.log(\'1ï¸âƒ£ æ‰§è¡Œ /profile è·å–å½“å‰é…ç½®æ–‡ä»¶...\');\n    const currentProfileResult = await triggerSlash(\'/profile\', \'\');\n    console.log(\'å½“å‰é…ç½®æ–‡ä»¶è¿”å›:\', currentProfileResult);\n\n    // å¦‚æœæ²¡æœ‰é…ç½®æ–‡ä»¶ï¼Œå°è¯•ç›´æ¥è¯»å–å…¨å±€é…ç½®\n    if (\n      !currentProfileResult ||\n      currentProfileResult === \'No connection profile selected.\' ||\n      currentProfileResult.includes(\'æœªé€‰æ‹©\')\n    ) {\n      console.log(\'âš ï¸ æœªé€‰æ‹©è¿æ¥é…ç½®æ–‡ä»¶ï¼Œå°è¯•è¯»å–å…¨å±€é…ç½®...\');\n\n      // å›é€€åˆ°è¯»å–çˆ¶çª—å£çš„å…¨å±€å˜é‡\n      const parentWin = window.parent || window.top || window;\n      const powerUser = (parentWin as any).power_user;\n      const secretState = (parentWin as any).secret_state;\n\n      let endpoint = \'\';\n      let apiKey = \'\';\n      let model = \'\';\n\n      if (powerUser) {\n        endpoint = powerUser.custom_chat_url || powerUser.reverse_proxy || \'\';\n        model = powerUser.custom_model || powerUser.openai_model || \'\';\n      }\n\n      if (secretState) {\n        apiKey = secretState.api_key_custom || secretState.custom || secretState.openai || \'\';\n      }\n\n      if (!endpoint && !apiKey && !model) {\n        window.toastr.warning(\n          \'æœªèƒ½è¯»å–åˆ° API é…ç½®ã€‚\\n\\n\' +\n            \'ğŸ’¡ å»ºè®®ï¼šåœ¨é…’é¦†ä¸»ç•Œé¢åˆ›å»ºä¸€ä¸ªè¿æ¥é…ç½®æ–‡ä»¶\\n\' +\n            \'ï¼ˆAPI è¿æ¥èœå• â†’ è¿æ¥é…ç½®æ–‡ä»¶ â†’ åˆ›å»ºï¼‰\',\n        );\n        return;\n      }\n\n      // ä½¿ç”¨å…¨å±€é…ç½®\n      if (endpoint) settings.value.api_endpoint = endpoint;\n      if (apiKey) settings.value.api_key = apiKey;\n      if (model) settings.value.model = model;\n\n      await settingsStore.saveSettings();\n\n      window.toastr.success(\n        `âœ… ä»å…¨å±€é…ç½®å¯¼å…¥æˆåŠŸï¼\\n\\n` +\n          (endpoint ? `â€¢ ç«¯ç‚¹: ${endpoint}\\n` : \'\') +\n          (apiKey ? `â€¢ Key: ***${apiKey.slice(-4)}\\n` : \'\') +\n          (model ? `â€¢ æ¨¡å‹: ${model}` : \'\'),\n      );\n\n      return;\n    }\n\n    // æ­¥éª¤ 2: è·å–é…ç½®æ–‡ä»¶è¯¦æƒ…\n    const profileName = currentProfileResult.trim();\n    console.log(`2ï¸âƒ£ è·å–é…ç½®æ–‡ä»¶è¯¦æƒ…: ${profileName}`);\n\n    const profileDetailsResult = await triggerSlash(\'/profile-get\', profileName);\n    console.log(\'é…ç½®æ–‡ä»¶è¯¦æƒ…è¿”å›:\', profileDetailsResult);\n\n    // è§£æ JSON\n    let profileData: any;\n    try {\n      profileData = JSON.parse(profileDetailsResult);\n      console.log(\'âœ… è§£æé…ç½®æ–‡ä»¶æ•°æ®:\', profileData);\n    } catch (parseError) {\n      console.error(\'âŒ è§£æé…ç½®æ–‡ä»¶ JSON å¤±è´¥:\', parseError);\n      window.toastr.error(\'æ— æ³•è§£æé…ç½®æ–‡ä»¶æ•°æ®\');\n      return;\n    }\n\n    // æå–é…ç½®\n    let endpoint = \'\';\n    let apiKey = \'\';\n    let model = \'\';\n\n    // API ç«¯ç‚¹ï¼ˆå¯èƒ½æ˜¯ api-url æˆ– server_urlï¼‰\n    if (profileData[\'api-url\']) {\n      endpoint = profileData[\'api-url\'];\n      console.log(\'âœ… æ‰¾åˆ° API ç«¯ç‚¹ (api-url):\', endpoint);\n    } else if (profileData.server_url) {\n      endpoint = profileData.server_url;\n      console.log(\'âœ… æ‰¾åˆ° API ç«¯ç‚¹ (server_url):\', endpoint);\n    }\n\n    // API Key - å°è¯•è¯»å–ï¼ˆé€šå¸¸ä¸å¯ç”¨ï¼Œå­˜å‚¨åœ¨æœåŠ¡å™¨ç«¯ï¼‰\n    if (profileData[\'secret-id\']) {\n      const secretId = profileData[\'secret-id\'];\n      console.log(\'â„¹ï¸ é…ç½®æ–‡ä»¶åŒ…å« secret-id:\', secretId);\n      console.log(\'â„¹ï¸ API Key å­˜å‚¨åœ¨æœåŠ¡å™¨ç«¯ï¼Œæ— æ³•ä»å‰ç«¯è¯»å–ï¼ˆè¿™æ˜¯æ­£å¸¸çš„å®‰å…¨æªæ–½ï¼‰\');\n    } else if (profileData.key) {\n      apiKey = profileData.key;\n      console.log(\'âœ… æ‰¾åˆ° API Key (key)\');\n    }\n\n    // æ¨¡å‹ï¼ˆmodelï¼‰\n    if (profileData.model) {\n      model = profileData.model;\n      console.log(\'âœ… æ‰¾åˆ°æ¨¡å‹:\', model);\n    }\n\n    // æ£€æŸ¥æ˜¯å¦æˆåŠŸè¯»å–ï¼ˆè‡³å°‘è¦æœ‰ç«¯ç‚¹æˆ–æ¨¡å‹ï¼‰\n    if (!endpoint && !model) {\n      window.toastr.warning(\n        \'é…ç½®æ–‡ä»¶ä¸­æœªæ‰¾åˆ° API é…ç½®ä¿¡æ¯ã€‚\\n\\n\' +\n          \'å¯èƒ½çš„åŸå› ï¼š\\n\' +\n          \'â€¢ é…ç½®æ–‡ä»¶æ ¼å¼ä¸ç¬¦åˆé¢„æœŸ\\n\' +\n          \'â€¢ é…ç½®æ–‡ä»¶æœªä¿å­˜å®Œæ•´ä¿¡æ¯\\n\\n\' +\n          \'ğŸ’¡ æŸ¥çœ‹æ§åˆ¶å°äº†è§£è¯¦ç»†æ•°æ®\',\n      );\n      console.warn(\'ğŸ“‹ é…ç½®æ–‡ä»¶å®Œæ•´æ•°æ®:\', profileData);\n      return;\n    }\n\n    // å¦‚æœæ²¡æœ‰è¯»å–åˆ° API Keyï¼ˆé€šå¸¸æƒ…å†µï¼‰\n    if (!apiKey) {\n      console.log(\'â„¹ï¸ API Key å­˜å‚¨åœ¨æœåŠ¡å™¨ç«¯ï¼Œéœ€è¦æ‰‹åŠ¨è¾“å…¥\');\n    }\n\n    // å¯¼å…¥é…ç½®\n    let importedCount = 0;\n    const importDetails: string[] = [];\n\n    if (endpoint) {\n      settings.value.api_endpoint = endpoint;\n      importedCount++;\n      importDetails.push(`â€¢ API ç«¯ç‚¹: ${endpoint}`);\n    }\n\n    if (apiKey) {\n      settings.value.api_key = apiKey;\n      importedCount++;\n      importDetails.push(`â€¢ API Key: ***${apiKey.slice(-4)}`);\n    }\n\n    if (model) {\n      settings.value.model = model;\n      importedCount++;\n      importDetails.push(`â€¢ æ¨¡å‹: ${model}`);\n    }\n\n    // è‡ªåŠ¨ä¿å­˜é…ç½®\n    await settingsStore.saveSettings();\n\n    // æ„å»ºæˆåŠŸæ¶ˆæ¯\n    let successMessage =\n      `ğŸ‰ æˆåŠŸä»é…’é¦†å¯¼å…¥ ${importedCount} é¡¹é…ç½®ï¼\\n\\n` +\n      `ğŸ“‹ é…ç½®æ–‡ä»¶: ${profileName}\\n\\n` +\n      `${importDetails.join(\'\\n\')}`;\n\n    // å¦‚æœæ²¡æœ‰å¯¼å…¥ API Keyï¼Œæ·»åŠ æç¤º\n    if (!apiKey) {\n      successMessage += `\\n\\nâš ï¸ API Key éœ€è¦æ‰‹åŠ¨è¾“å…¥\\nï¼ˆå‡ºäºå®‰å…¨è€ƒè™‘ï¼Œé…’é¦†ä¸åœ¨å‰ç«¯å­˜å‚¨ API Keyï¼‰`;\n    }\n\n    window.toastr.success(successMessage);\n\n    console.log(\'âœ… å¯¼å…¥é…ç½®æˆåŠŸ:\', {\n      profileName,\n      endpoint,\n      apiKey: apiKey ? \'***\' + apiKey.slice(-4) : \'\',\n      model,\n    });\n  } catch (error) {\n    console.error(\'âŒ ä»é…’é¦†å¯¼å…¥é…ç½®å¤±è´¥:\', error);\n    window.toastr.error(\'å¯¼å…¥å¤±è´¥ï¼š\' + (error as Error).message);\n  }\n};\n\nconst handle_fetch_models = async () => {\n  if (loading_models.value) return;\n\n  try {\n    loading_models.value = true;\n    console.log(\'ğŸš€ å¼€å§‹æ‹‰å–æ¨¡å‹åˆ—è¡¨...\');\n    console.log(\'ğŸ“ API ç«¯ç‚¹:\', settings.value.api_endpoint);\n    console.log(\'ğŸ”‘ API Key:\', settings.value.api_key ? \'***\' + settings.value.api_key.slice(-4) : \'æœªè®¾ç½®\');\n\n    // éªŒè¯ API é…ç½®\n    if (!settings.value.api_endpoint || !settings.value.api_key) {\n      window.toastr.warning(\'è¯·å…ˆé…ç½® API ç«¯ç‚¹å’Œ API Key\');\n      return;\n    }\n\n    window.toastr.info(\'æ­£åœ¨æ‹‰å–æ¨¡å‹åˆ—è¡¨ï¼Œè¯·æŸ¥çœ‹æ§åˆ¶å°äº†è§£è¯¦ç»†è¿‡ç¨‹...\');\n\n    // è°ƒç”¨æ‹‰å–æ¨¡å‹å‡½æ•°\n    const { fetchAvailableModels } = await import(\'../æ€»ç»“åŠŸèƒ½\');\n    const models = await fetchAvailableModels();\n\n    console.log(\'âœ… æœ€ç»ˆè·å–åˆ°çš„æ¨¡å‹åˆ—è¡¨:\', models);\n\n    if (models.length > 0) {\n      // æ›´æ–°æ¨¡å‹åˆ—è¡¨\n      available_models.value = models;\n      window.toastr.success(\n        `ğŸ‰ æˆåŠŸè·å– ${models.length} ä¸ªæ¨¡å‹ï¼\\n` +\n          `æ¨¡å‹åˆ—è¡¨: ${models.slice(0, 3).join(\', \')}${models.length > 3 ? \'...\' : \'\'}`,\n      );\n\n      // å¦‚æœæœ‰æ¨¡å‹ï¼Œè‡ªåŠ¨é€‰æ‹©ç¬¬ä¸€ä¸ª\n      if (!settings.value.model && models[0]) {\n        settings.value.model = models[0];\n        console.log(\'âœ… è‡ªåŠ¨é€‰æ‹©æ¨¡å‹:\', models[0]);\n      }\n    } else {\n      window.toastr.warning(\'æœªæ‰¾åˆ°å¯ç”¨æ¨¡å‹ï¼Œè¯·æ‰‹åŠ¨è¾“å…¥\');\n    }\n  } catch (error) {\n    console.error(\'âŒ æ‹‰å–æ¨¡å‹å¤±è´¥:\', error);\n\n    // æ˜¾ç¤ºè¯¦ç»†çš„é”™è¯¯ä¿¡æ¯\n    const errorMessage = (error as Error).message;\n\n    // å¦‚æœé”™è¯¯ä¿¡æ¯å¾ˆé•¿ï¼Œæ˜¾ç¤ºç®€çŸ­ç‰ˆæœ¬\n    if (errorMessage.length > 200) {\n      window.toastr.error(\n        \'âŒ æ‹‰å–æ¨¡å‹å¤±è´¥\\n\\n\' +\n          \'è¯·æ‰“å¼€æµè§ˆå™¨æ§åˆ¶å°ï¼ˆF12ï¼‰æŸ¥çœ‹è¯¦ç»†çš„è°ƒè¯•ä¿¡æ¯\\n\\n\' +\n          \'å¯èƒ½çš„åŸå› ï¼š\\n\' +\n          \'â€¢ API ä¸æ”¯æŒ /v1/models æ¥å£\\n\' +\n          \'â€¢ API Key æƒé™ä¸è¶³\\n\' +\n          \'â€¢ ç½‘ç»œè¿æ¥é—®é¢˜æˆ– CORS é™åˆ¶\',\n      );\n    } else {\n      window.toastr.error(`âŒ æ‹‰å–æ¨¡å‹å¤±è´¥\\n\\n${errorMessage}`);\n    }\n\n    console.error(\'ğŸ“‹ å®Œæ•´é”™è¯¯ä¿¡æ¯:\', errorMessage);\n  } finally {\n    loading_models.value = false;\n  }\n};\n\nconst handle_test_connection = async () => {\n  try {\n    console.log(\'æµ‹è¯•è¿æ¥...\');\n\n    // éªŒè¯ API é…ç½®\n    if (!settings.value.api_endpoint || !settings.value.api_key) {\n      window.toastr.warning(\'è¯·å…ˆé…ç½® API ç«¯ç‚¹å’Œ API Key\');\n      return;\n    }\n\n    window.toastr.info(\'æ­£åœ¨æµ‹è¯•è¿æ¥ï¼Œè¯·ç¨å€™...\');\n\n    // å¯¼å…¥è§„èŒƒåŒ–å‡½æ•°\n    const { normalizeApiEndpoint } = await import(\'../settings\');\n    const apiUrl = normalizeApiEndpoint(settings.value.api_endpoint);\n    console.log(\'ğŸ“ è§„èŒƒåŒ–çš„ç«¯ç‚¹:\', apiUrl);\n\n    // ä½¿ç”¨ OpenAI æ ‡å‡†æ ¼å¼çš„è¿æ¥æµ‹è¯•\n    const response = await fetch(apiUrl, {\n      method: \'POST\',\n      headers: {\n        \'Content-Type\': \'application/json\',\n        Authorization: `Bearer ${settings.value.api_key}`,\n      },\n      body: JSON.stringify({\n        model: settings.value.model || \'gpt-3.5-turbo\',\n        messages: [{ role: \'user\', content: \'Hello\' }],\n        max_tokens: 5,\n        temperature: settings.value.temperature,\n        top_p: settings.value.top_p,\n        presence_penalty: settings.value.presence_penalty,\n        frequency_penalty: settings.value.frequency_penalty,\n      }),\n    });\n\n    if (response.ok) {\n      const data = await response.json();\n      console.log(\'API æµ‹è¯•å“åº”:\', data);\n\n      // æå–å“åº”å†…å®¹å’Œæ¨¡å‹ä¿¡æ¯\n      const reply = data.choices?.[0]?.message?.content || \'(æ— å†…å®¹)\';\n      const modelUsed = data.model || settings.value.model;\n\n      window.toastr.success(`âœ… è¿æ¥æˆåŠŸï¼\\n` + `ğŸ“¦ æ¨¡å‹: ${modelUsed}\\n` + `ğŸ’¬ å›å¤: ${reply.substring(0, 50)}...`);\n    } else {\n      const errorText = await response.text();\n      console.error(\'API é”™è¯¯å“åº”:\', errorText);\n      window.toastr.error(`âŒ è¿æ¥å¤±è´¥ (${response.status})\\n` + `è¯¦æƒ…: ${errorText.substring(0, 100)}`);\n    }\n  } catch (error) {\n    console.error(\'è¿æ¥æµ‹è¯•å¤±è´¥:\', error);\n    window.toastr.error(\'è¿æ¥æµ‹è¯•å¤±è´¥: \' + (error as Error).message);\n  }\n};\n\nconst handle_summarize = async () => {\n  try {\n    if (is_summarizing.value) return;\n\n    console.log(\'å¼€å§‹æ‰‹åŠ¨æ€»ç»“...\');\n    is_summarizing.value = true;\n    saveGenerationStatus();\n\n    // éªŒè¯ API é…ç½®\n    if (!settings.value.api_endpoint || !settings.value.api_key) {\n      window.toastr.warning(\'è¯·å…ˆé…ç½® API ç«¯ç‚¹å’Œ API Key\');\n      return;\n    }\n\n    // éªŒè¯æ¥¼å±‚èŒƒå›´\n    if (settings.value.start_message_id === undefined || settings.value.end_message_id === undefined) {\n      window.toastr.warning(\'è¯·è®¾ç½®å¼€å§‹æ¥¼å±‚å’Œç»“æŸæ¥¼å±‚\');\n      return;\n    }\n\n    // éªŒè¯æ¥¼å±‚èŒƒå›´çš„æœ‰æ•ˆæ€§\n    if (settings.value.start_message_id < 0 || settings.value.end_message_id < settings.value.start_message_id) {\n      window.toastr.warning(\'æ¥¼å±‚èŒƒå›´æ— æ•ˆï¼Œè¯·ç¡®ä¿ç»“æŸæ¥¼å±‚å¤§äºç­‰äºå¼€å§‹æ¥¼å±‚\');\n      return;\n    }\n\n    console.log(`æ€»ç»“èŒƒå›´: ${settings.value.start_message_id} - ${settings.value.end_message_id}`);\n\n    // æ˜¾ç¤ºè¿›åº¦å¯¹è¯æ¡†\n    showProgress.value = true;\n    progressDialogRef.value?.setProgress(10);\n    progressDialogRef.value?.setMessage(\'æ­£åœ¨å‡†å¤‡ç”Ÿæˆæ€»ç»“...\');\n    progressDialogRef.value?.addDetail(\n      `æ¥¼å±‚èŒƒå›´: ${settings.value.start_message_id} - ${settings.value.end_message_id}`,\n    );\n\n    progressDialogRef.value?.setProgress(30);\n    progressDialogRef.value?.setMessage(\'æ­£åœ¨è°ƒç”¨ AI ç”Ÿæˆæ€»ç»“...\');\n    progressDialogRef.value?.addDetail(\'è¿™å¯èƒ½éœ€è¦ 10-30 ç§’ï¼Œè¯·è€å¿ƒç­‰å¾…\');\n\n    // è°ƒç”¨æ€»ç»“åŠŸèƒ½\n    const { summarizeMessages } = await import(\'../æ€»ç»“åŠŸèƒ½\');\n    const summary = await summarizeMessages(settings.value.start_message_id, settings.value.end_message_id);\n\n    progressDialogRef.value?.setProgress(90);\n    progressDialogRef.value?.setMessage(\'æ­£åœ¨ä¿å­˜æ€»ç»“ç»“æœ...\');\n\n    console.log(\'æ€»ç»“å®Œæˆ:\', summary);\n\n    // ä¿å­˜æ€»ç»“ç»“æœåˆ°è„šæœ¬å˜é‡\n    const scriptId = getScriptIdSafe();\n    if (scriptId) {\n      insertOrAssignVariables(klona({ last_summary: summary }), { type: \'script\', script_id: scriptId });\n    }\n\n    // ä¿å­˜åˆ°å½“å‰èŠå¤©çš„æ€»ç»“å†å²\n    summaryHistoryStore.addSummary(\n      settings.value.start_message_id ?? 0,\n      settings.value.end_message_id ?? settings.value.start_message_id ?? 0,\n      summary,\n    );\n\n    // é€šçŸ¥å…¶ä»–ç»„ä»¶æ›´æ–°\n    window.dispatchEvent(new CustomEvent(\'summary-history-updated\'));\n\n    progressDialogRef.value?.setProgress(100);\n    progressDialogRef.value?.setMessage(\'âœ… æ€»ç»“å®Œæˆï¼\');\n    progressDialogRef.value?.addDetail(\'æ€»ç»“å·²ä¿å­˜åˆ°å†å²è®°å½•\');\n\n    setTimeout(() => {\n      showProgress.value = false;\n      window.toastr.success(\'æ€»ç»“å®Œæˆå¹¶å·²ä¿å­˜åˆ°å†å²ï¼\');\n    }, 800);\n  } catch (error) {\n    console.error(\'æ€»ç»“å¤±è´¥:\', error);\n    showProgress.value = false;\n    window.toastr.error(\'æ€»ç»“å¤±è´¥: \' + (error as Error).message);\n  } finally {\n    is_summarizing.value = false;\n    saveGenerationStatus();\n  }\n};\n\nconst handle_generate_table = async () => {\n  try {\n    if (is_generating_table.value) return;\n\n    console.log(\'å¼€å§‹ç”Ÿæˆè¡¨æ ¼...\');\n    is_generating_table.value = true;\n    saveGenerationStatus();\n\n    // éªŒè¯ API é…ç½®\n    if (!settings.value.api_endpoint || !settings.value.api_key) {\n      window.toastr.warning(\'è¯·å…ˆé…ç½® API ç«¯ç‚¹å’Œ API Key\');\n      return;\n    }\n\n    // æ˜¾ç¤ºè¿›åº¦å¯¹è¯æ¡†\n    showProgress.value = true;\n    progressDialogRef.value?.setProgress(5);\n    progressDialogRef.value?.setMessage(\'æ­£åœ¨å‡†å¤‡ç”Ÿæˆè¡¨æ ¼...\');\n\n    // éªŒè¯è¡¨æ ¼å‚æ•°\n    if (!settings.value.table_start_message_id || !settings.value.table_end_message_id) {\n      window.toastr.warning(\'è¯·è®¾ç½®å¼€å§‹æ¥¼å±‚å’Œç»“æŸæ¥¼å±‚\');\n      return;\n    }\n\n    // è®©ç”¨æˆ·è¾“å…¥è¡¨æ ¼åˆ—å¤´ï¼ˆä¼˜å…ˆä½¿ç”¨æ¨¡æ¿ï¼‰\n    let headersInput: string | null = null;\n\n    if (currentTemplate.value.headers.trim()) {\n      // å¦‚æœå½“å‰æœ‰é€‰ä¸­çš„æ¨¡æ¿ï¼Œè¯¢é—®æ˜¯å¦ä½¿ç”¨\n      const useTemplate = confirm(\n        `æ˜¯å¦ä½¿ç”¨æ¨¡æ¿"${currentTemplate.value.name}"çš„åˆ—å¤´ï¼Ÿ\\nåˆ—å¤´ï¼š${currentTemplate.value.headers}`,\n      );\n      if (useTemplate) {\n        headersInput = currentTemplate.value.headers;\n      }\n    }\n\n    if (!headersInput) {\n      // å¦‚æœæ²¡æœ‰ä½¿ç”¨æ¨¡æ¿ï¼Œè®©ç”¨æˆ·æ‰‹åŠ¨è¾“å…¥\n      headersInput = window.prompt(\'è¯·è¾“å…¥è¡¨æ ¼åˆ—å¤´ï¼ˆç”¨é€—å·åˆ†éš”ï¼Œå¦‚ï¼šæ—¶é—´,äº‹ä»¶,åœ°ç‚¹,äººç‰©ï¼‰ï¼š\');\n    }\n\n    if (!headersInput || !headersInput.trim()) {\n      window.toastr.warning(\'è¯·è®¾ç½®è¡¨æ ¼åˆ—å¤´\');\n      return;\n    }\n\n    const headers: string[] = headersInput\n      .split(\',\')\n      .map((h: string) => h.trim())\n      .filter((h: string) => h);\n\n    if (headers.length === 0) {\n      window.toastr.warning(\'è¯·è®¾ç½®æœ‰æ•ˆçš„è¡¨æ ¼åˆ—å¤´\');\n      return;\n    }\n\n    progressDialogRef.value?.setProgress(15);\n    progressDialogRef.value?.setMessage(\'æ­£åœ¨è·å–èŠå¤©æ¶ˆæ¯...\');\n    progressDialogRef.value?.addDetail(\n      `æ¥¼å±‚èŒƒå›´: ${settings.value.table_start_message_id} - ${settings.value.table_end_message_id}`,\n    );\n\n    // è·å–æŒ‡å®šèŒƒå›´çš„æ¶ˆæ¯\n    let chatMessages;\n    try {\n      const messageRange = `${settings.value.table_start_message_id}-${settings.value.table_end_message_id}`;\n      console.log(\'è·å–æ¶ˆæ¯èŒƒå›´:\', messageRange);\n      chatMessages = getChatMessages(messageRange, { hide_state: \'all\' });\n      console.log(\'è·å–åˆ°çš„æ¶ˆæ¯æ•°é‡:\', chatMessages.length);\n\n      progressDialogRef.value?.addDetail(`è·å–åˆ° ${chatMessages.length} æ¡æ¶ˆæ¯`);\n    } catch (error) {\n      console.error(\'è·å–èŠå¤©æ¶ˆæ¯å¤±è´¥:\', error);\n      showProgress.value = false;\n      window.toastr.error(\'è·å–èŠå¤©æ¶ˆæ¯å¤±è´¥: \' + (error as Error).message);\n      return;\n    }\n\n    if (!chatMessages || chatMessages.length === 0) {\n      window.toastr.warning(\'æŒ‡å®šèŒƒå›´å†…æ²¡æœ‰æ¶ˆæ¯\');\n      return;\n    }\n\n    // å‡†å¤‡AIè¯·æ±‚æ•°æ®\n    const messagesText = chatMessages\n      .map(msg => {\n        const role = msg.role === \'user\' ? \'ç”¨æˆ·\' : \'AI\';\n        return `${role}: ${msg.message}`;\n      })\n      .join(\'\\n\\n\');\n\n    const aiPrompt = `è¯·æ ¹æ®ä»¥ä¸‹èŠå¤©å†…å®¹ï¼Œç”Ÿæˆè¡¨æ ¼æ•°æ®ã€‚è¡¨æ ¼åˆ—å¤´ä¸ºï¼š${headers.join(\', \')}\n\nèŠå¤©å†…å®¹ï¼š\n${messagesText}\n\n**é‡è¦è¦æ±‚**ï¼š\n1. æ ¹æ®èŠå¤©å†…å®¹æå–ç›¸å…³ä¿¡æ¯å¡«å…¥è¡¨æ ¼\n2. ä¸¥æ ¼æŒ‰ç…§æä¾›çš„åˆ—å¤´é¡ºåºç”Ÿæˆæ•°æ®ï¼š${headers.join(\', \')}\n3. æ¯è¡Œæ•°æ®åº”è¯¥æ˜¯æœ‰æ„ä¹‰çš„ç›¸å…³ä¿¡æ¯\n4. å¦‚æœæŸä¸ªå­—æ®µæ²¡æœ‰ç›¸å…³ä¿¡æ¯ï¼Œå¡«å†™"æ— "æˆ–"-"\n5. å¿…é¡»è¿”å›çº¯JSONæ ¼å¼ï¼Œä¸è¦æ·»åŠ ä»»ä½•markdownæ ‡è®°æˆ–å…¶ä»–æ–‡å­—è¯´æ˜\n6. åªè¿”å›dataæ•°ç»„å³å¯ï¼Œheadersæˆ‘å·²ç»æœ‰äº†\n\n**è¾“å‡ºæ ¼å¼ï¼ˆåªè¿”å›è¿™ä¸ªJSONï¼Œä¸è¦å…¶ä»–å†…å®¹ï¼‰**ï¼š\n{\n  "data": [\n    ["æ•°æ®1", "æ•°æ®2", "æ•°æ®3"],\n    ["æ•°æ®4", "æ•°æ®5", "æ•°æ®6"]\n  ]\n}\n\næ³¨æ„ï¼šdataæ•°ç»„ä¸­æ¯ä¸ªå­æ•°ç»„çš„é•¿åº¦å¿…é¡»ç­‰äº${headers.length}ï¼Œå¯¹åº”åˆ—å¤´ï¼š${headers.join(\', \')}`;\n\n    console.log(\'å‘é€AIè¯·æ±‚...\');\n\n    progressDialogRef.value?.setProgress(30);\n    progressDialogRef.value?.setMessage(\'æ­£åœ¨å‘é€è¯·æ±‚åˆ° AI æœåŠ¡å™¨...\');\n    progressDialogRef.value?.addDetail(`è¡¨æ ¼åˆ—å¤´: ${headers.join(\', \')}`);\n\n    // å¯¼å…¥è§„èŒƒåŒ–å‡½æ•°\n    const { normalizeApiEndpoint } = await import(\'../settings\');\n    const apiUrl = normalizeApiEndpoint(settings.value.api_endpoint);\n\n    progressDialogRef.value?.setProgress(40);\n    progressDialogRef.value?.setMessage(\'ç­‰å¾… AI åˆ†æå¹¶ç”Ÿæˆè¡¨æ ¼...\');\n    progressDialogRef.value?.addDetail(\'è¿™å¯èƒ½éœ€è¦ 10-30 ç§’ï¼Œè¯·è€å¿ƒç­‰å¾…\');\n\n    // è°ƒç”¨AIç”Ÿæˆè¡¨æ ¼\n    const response = await fetch(apiUrl, {\n      method: \'POST\',\n      headers: {\n        \'Content-Type\': \'application/json\',\n        Authorization: `Bearer ${settings.value.api_key}`,\n      },\n      body: JSON.stringify({\n        model: settings.value.model,\n        messages: [\n          {\n            role: \'user\',\n            content: aiPrompt,\n          },\n        ],\n        max_tokens: settings.value.max_tokens,\n        temperature: settings.value.temperature,\n        top_p: settings.value.top_p,\n        presence_penalty: settings.value.presence_penalty,\n        frequency_penalty: settings.value.frequency_penalty,\n      }),\n    });\n\n    if (!response.ok) {\n      throw new Error(`APIè¯·æ±‚å¤±è´¥: ${response.status} ${response.statusText}`);\n    }\n\n    progressDialogRef.value?.setProgress(70);\n    progressDialogRef.value?.setMessage(\'æ­£åœ¨æ¥æ”¶ AI å“åº”...\');\n\n    const result = await response.json();\n    console.log(\'AIå“åº”:\', result);\n\n    if (!result.choices || !result.choices[0] || !result.choices[0].message) {\n      throw new Error(\'AIå“åº”æ ¼å¼é”™è¯¯\');\n    }\n\n    const aiResponse = result.choices[0].message.content;\n    console.log(\'AIè¿”å›å†…å®¹:\', aiResponse);\n\n    progressDialogRef.value?.setProgress(85);\n    progressDialogRef.value?.setMessage(\'æ­£åœ¨è§£æè¡¨æ ¼æ•°æ®...\');\n\n    // è§£æAIè¿”å›çš„JSON\n    let aiTableData;\n    try {\n      // å°è¯•æå–JSONéƒ¨åˆ†ï¼ˆç§»é™¤å¯èƒ½çš„markdownä»£ç å—æ ‡è®°ï¼‰\n      let jsonText = aiResponse.trim();\n\n      // ç§»é™¤markdownä»£ç å—\n      jsonText = jsonText\n        .replace(/^```json\\s*/i, \'\')\n        .replace(/^```\\s*/, \'\')\n        .replace(/```\\s*$/, \'\');\n\n      // æå–JSONå¯¹è±¡\n      const jsonMatch = jsonText.match(/\\{[\\s\\S]*\\}/);\n      if (jsonMatch) {\n        aiTableData = JSON.parse(jsonMatch[0]);\n      } else {\n        throw new Error(\'æ— æ³•æ‰¾åˆ°JSONæ ¼å¼çš„è¡¨æ ¼æ•°æ®\');\n      }\n    } catch (parseError) {\n      console.error(\'è§£æAIå“åº”å¤±è´¥:\', parseError);\n      console.log(\'AIåŸå§‹å“åº”:\', aiResponse);\n      window.toastr.error(\'AIè¿”å›çš„æ•°æ®æ ¼å¼ä¸æ­£ç¡®ï¼Œè¯·é‡è¯•\');\n      return;\n    }\n\n    // éªŒè¯è¡¨æ ¼æ•°æ®\n    if (!aiTableData.data || !Array.isArray(aiTableData.data)) {\n      window.toastr.error(\'AIè¿”å›çš„è¡¨æ ¼æ•°æ®æ ¼å¼ä¸æ­£ç¡®ï¼šç¼ºå°‘dataæ•°ç»„\');\n      return;\n    }\n\n    // éªŒè¯æ¯è¡Œæ•°æ®çš„åˆ—æ•°æ˜¯å¦æ­£ç¡®\n    for (let i = 0; i < aiTableData.data.length; i++) {\n      if (!Array.isArray(aiTableData.data[i])) {\n        window.toastr.error(`ç¬¬${i + 1}è¡Œæ•°æ®æ ¼å¼é”™è¯¯ï¼šä¸æ˜¯æ•°ç»„`);\n        return;\n      }\n      if (aiTableData.data[i].length !== headers.length) {\n        window.toastr.error(`ç¬¬${i + 1}è¡Œæ•°æ®åˆ—æ•°ä¸åŒ¹é…ï¼šæœŸæœ›${headers.length}åˆ—ï¼Œå®é™…${aiTableData.data[i].length}åˆ—`);\n        console.log(`æœŸæœ›åˆ—å¤´:`, headers);\n        console.log(`å®é™…æ•°æ®:`, aiTableData.data[i]);\n        return;\n      }\n    }\n\n    // ç»„è£…å®Œæ•´çš„è¡¨æ ¼æ•°æ®ï¼ˆä½¿ç”¨ç”¨æˆ·æä¾›çš„headersï¼‰\n    const tableData = {\n      headers: headers,\n      data: aiTableData.data,\n    };\n\n    // ä¿å­˜è¡¨æ ¼åˆ°èŠå¤©å˜é‡\n    const chat_id = getChatIdSafe();\n    if (chat_id) {\n      const chat_vars = getVariables({ type: \'chat\' });\n      const table_history = chat_vars.table_history || [];\n\n      table_history.push({\n        start_id: settings.value.table_start_message_id,\n        end_id: settings.value.table_end_message_id,\n        headers: tableData.headers,\n        data: tableData.data,\n      });\n\n      insertOrAssignVariables(klona({ table_history }), { type: \'chat\' });\n\n      progressDialogRef.value?.setProgress(100);\n      progressDialogRef.value?.setMessage(\'âœ… è¡¨æ ¼ç”Ÿæˆå®Œæˆï¼\');\n      progressDialogRef.value?.addDetail(`å…±ç”Ÿæˆ ${tableData.data.length} è¡Œæ•°æ®`);\n\n      setTimeout(() => {\n        showProgress.value = false;\n        window.toastr.success(`è¡¨æ ¼ç”ŸæˆæˆåŠŸï¼å…±${tableData.data.length}è¡Œæ•°æ®`);\n      }, 800);\n\n      console.log(\'è¡¨æ ¼å·²ä¿å­˜åˆ°èŠå¤©å˜é‡:\', table_history);\n    } else {\n      showProgress.value = false;\n      window.toastr.warning(\'æ— æ³•è·å–èŠå¤©IDï¼Œè¡¨æ ¼ç”Ÿæˆå¤±è´¥\');\n    }\n  } catch (error) {\n    console.error(\'ç”Ÿæˆè¡¨æ ¼å¤±è´¥:\', error);\n    showProgress.value = false;\n    window.toastr.error(\'ç”Ÿæˆè¡¨æ ¼å¤±è´¥: \' + (error as Error).message);\n  } finally {\n    is_generating_table.value = false;\n    saveGenerationStatus();\n  }\n};\n\nconst handle_create_table = () => {\n  try {\n    // éªŒè¯è¡¨æ ¼å‚æ•°\n    if (!settings.value.table_start_message_id || !settings.value.table_end_message_id) {\n      window.toastr.warning(\'è¯·è®¾ç½®å¼€å§‹æ¥¼å±‚å’Œç»“æŸæ¥¼å±‚\');\n      return;\n    }\n\n    // è®©ç”¨æˆ·è¾“å…¥è¡¨æ ¼åˆ—å¤´\n    const headersInput: string | null = window.prompt(\'è¯·è¾“å…¥è¡¨æ ¼åˆ—å¤´ï¼ˆç”¨é€—å·åˆ†éš”ï¼Œå¦‚ï¼šæ—¶é—´,äº‹ä»¶,åœ°ç‚¹,äººç‰©ï¼‰ï¼š\');\n    if (!headersInput || !headersInput.trim()) {\n      window.toastr.warning(\'è¯·è®¾ç½®è¡¨æ ¼åˆ—å¤´\');\n      return;\n    }\n\n    // è§£æåˆ—å¤´\n    const headers: string[] = headersInput\n      .split(\',\')\n      .map((h: string) => h.trim())\n      .filter((h: string) => h);\n\n    if (headers.length === 0) {\n      window.toastr.warning(\'è¯·è®¾ç½®æœ‰æ•ˆçš„è¡¨æ ¼åˆ—å¤´\');\n      return;\n    }\n\n    // åˆ›å»ºç©ºè¡¨æ ¼æ•°æ®\n    const emptyTableData = {\n      start_id: settings.value.table_start_message_id,\n      end_id: settings.value.table_end_message_id,\n      headers: headers,\n      data: [], // ç©ºæ•°æ®ï¼Œç”¨æˆ·å¯ä»¥æ‰‹åŠ¨å¡«å……\n    };\n\n    // ä¿å­˜è¡¨æ ¼åˆ°èŠå¤©å˜é‡\n    const chat_id = getChatIdSafe();\n    if (chat_id) {\n      const chat_vars = getVariables({ type: \'chat\' });\n      const table_history = chat_vars.table_history || [];\n\n      table_history.push(emptyTableData);\n      insertOrAssignVariables(klona({ table_history }), { type: \'chat\' });\n\n      window.toastr.success(`ç©ºè¡¨æ ¼åˆ›å»ºæˆåŠŸï¼åˆ—å¤´ï¼š${headers.join(\', \')}`);\n      console.log(\'ç©ºè¡¨æ ¼å·²ä¿å­˜åˆ°èŠå¤©å˜é‡:\', emptyTableData);\n    } else {\n      window.toastr.warning(\'æ— æ³•è·å–èŠå¤©IDï¼Œè¡¨æ ¼åˆ›å»ºå¤±è´¥\');\n    }\n  } catch (error) {\n    console.error(\'åˆ›å»ºè¡¨æ ¼å¤±è´¥:\', error);\n    window.toastr.error(\'åˆ›å»ºè¡¨æ ¼å¤±è´¥: \' + (error as Error).message);\n  }\n};\n\nconst handle_hide_messages = async () => {\n  try {\n    console.log(\'éšè—æ¥¼å±‚...\');\n\n    if (!hide_range.value.trim()) {\n      window.toastr.warning(\'è¯·è¾“å…¥è¦éšè—çš„æ¥¼å±‚èŒƒå›´\');\n      return;\n    }\n\n    // è§£ææ¥¼å±‚èŒƒå›´\n    const ranges = hide_range.value.split(\',\').map(range => range.trim());\n    const messageIds: number[] = [];\n\n    for (const range of ranges) {\n      if (range.includes(\'-\')) {\n        // èŒƒå›´æ ¼å¼ï¼š1-10\n        const [start, end] = range.split(\'-\').map(Number);\n        if (start && end && start <= end) {\n          for (let i = start; i <= end; i++) {\n            messageIds.push(i);\n          }\n        }\n      } else {\n        // å•ä¸ªæ¥¼å±‚ï¼š5\n        const id = Number(range);\n        if (id) {\n          messageIds.push(id);\n        }\n      }\n    }\n\n    if (messageIds.length === 0) {\n      window.toastr.warning(\'è¯·è¾“å…¥æœ‰æ•ˆçš„æ¥¼å±‚èŒƒå›´\');\n      return;\n    }\n\n    // è·å–å½“å‰èŠå¤©çš„æ¶ˆæ¯\n    let chatMessages;\n    try {\n      const lastMessageId = getLastMessageId();\n      console.log(\'æœ€æ–°æ¶ˆæ¯ID:\', lastMessageId);\n      chatMessages = getChatMessages(`0-${lastMessageId}`, { hide_state: \'all\' });\n      console.log(\'è·å–åˆ°çš„æ¶ˆæ¯æ•°é‡:\', chatMessages.length);\n    } catch (error) {\n      console.error(\'è·å–èŠå¤©æ¶ˆæ¯å¤±è´¥:\', error);\n      window.toastr.error(\'è·å–èŠå¤©æ¶ˆæ¯å¤±è´¥: \' + (error as Error).message);\n      return;\n    }\n\n    if (!chatMessages || chatMessages.length === 0) {\n      window.toastr.warning(\'å½“å‰èŠå¤©æ²¡æœ‰æ¶ˆæ¯\');\n      return;\n    }\n\n    // éšè—æŒ‡å®šçš„æ¥¼å±‚\n    let hiddenCount = 0;\n    const messagesToHide = [];\n\n    for (const messageId of messageIds) {\n      // æ£€æŸ¥æ˜¯å¦å·²ç»åœ¨éšè—åˆ—è¡¨ä¸­\n      const alreadyHidden = hidden_messages.value.some(msg => msg.message_id === messageId);\n      if (alreadyHidden) {\n        console.log(`æ¥¼å±‚ ${messageId} å·²ç»è¢«éšè—ï¼Œè·³è¿‡`);\n        continue;\n      }\n\n      const message = chatMessages.find(msg => msg.message_id === messageId);\n      if (message) {\n        // å‡†å¤‡è¦éšè—çš„æ¶ˆæ¯æ•°æ®\n        messagesToHide.push({\n          message_id: messageId,\n          is_hidden: true,\n        });\n\n        // æ·»åŠ åˆ°éšè—åˆ—è¡¨\n        hidden_messages.value.push({\n          message_id: messageId,\n          name: message.name || \'Unknown\',\n          role: message.role || \'user\',\n          message: message.message || \'\',\n        });\n        hiddenCount++;\n      }\n    }\n\n    // è°ƒç”¨é…’é¦†APIçœŸæ­£éšè—æ¥¼å±‚\n    if (messagesToHide.length > 0) {\n      try {\n        console.log(\'å‡†å¤‡è°ƒç”¨ slash å‘½ä»¤éšè—æ¥¼å±‚:\', messageIds);\n\n        // ä½¿ç”¨ slash å‘½ä»¤éšè—æ¥¼å±‚\n        for (const messageId of messageIds) {\n          try {\n            await triggerSlash(`/hide ${messageId}`);\n            console.log(`æˆåŠŸéšè—æ¥¼å±‚ ${messageId}`);\n          } catch (error) {\n            console.error(`éšè—æ¥¼å±‚ ${messageId} å¤±è´¥:`, error);\n          }\n        }\n\n        window.toastr.success(\'æ¥¼å±‚å·²çœŸæ­£éšè—\');\n      } catch (error) {\n        console.error(\'è°ƒç”¨éšè—APIå¤±è´¥:\', error);\n        window.toastr.error(\'éšè—æ¥¼å±‚APIè°ƒç”¨å¤±è´¥: \' + (error as Error).message);\n      }\n    }\n\n    if (hiddenCount > 0) {\n      // ä¿å­˜åˆ°é…’é¦†å˜é‡\n      saveHiddenMessages();\n      window.toastr.success(`æˆåŠŸéšè— ${hiddenCount} ä¸ªæ¥¼å±‚`);\n      hide_range.value = \'\'; // æ¸…ç©ºè¾“å…¥æ¡†\n    } else {\n      window.toastr.warning(\'æœªæ‰¾åˆ°è¦éšè—çš„æ¥¼å±‚\');\n    }\n  } catch (error) {\n    console.error(\'éšè—æ¥¼å±‚å¤±è´¥:\', error);\n    window.toastr.error(\'éšè—æ¥¼å±‚å¤±è´¥: \' + (error as Error).message);\n  }\n};\n\nconst handle_show_messages = async () => {\n  try {\n    console.log(\'æ˜¾ç¤ºæŒ‡å®šæ¥¼å±‚...\');\n\n    if (!hide_range.value.trim()) {\n      window.toastr.warning(\'è¯·è¾“å…¥è¦æ˜¾ç¤ºçš„æ¥¼å±‚èŒƒå›´\');\n      return;\n    }\n\n    // è§£ææ¥¼å±‚èŒƒå›´\n    const messageIds = parseMessageRange(hide_range.value.trim());\n    if (messageIds.length === 0) {\n      window.toastr.warning(\'è¯·è¾“å…¥æœ‰æ•ˆçš„æ¥¼å±‚èŒƒå›´\');\n      return;\n    }\n\n    // è·å–å½“å‰èŠå¤©çš„æ¶ˆæ¯\n    let chatMessages;\n    try {\n      const lastMessageId = getLastMessageId();\n      console.log(\'æœ€æ–°æ¶ˆæ¯ID:\', lastMessageId);\n      chatMessages = getChatMessages(`0-${lastMessageId}`, { hide_state: \'all\' });\n      console.log(\'è·å–åˆ°çš„æ¶ˆæ¯æ•°é‡:\', chatMessages.length);\n    } catch (error) {\n      console.error(\'è·å–èŠå¤©æ¶ˆæ¯å¤±è´¥:\', error);\n      window.toastr.error(\'è·å–èŠå¤©æ¶ˆæ¯å¤±è´¥: \' + (error as Error).message);\n      return;\n    }\n\n    if (!chatMessages || chatMessages.length === 0) {\n      window.toastr.warning(\'å½“å‰èŠå¤©æ²¡æœ‰æ¶ˆæ¯\');\n      return;\n    }\n\n    // å‡†å¤‡è¦æ˜¾ç¤ºçš„æ¶ˆæ¯æ•°æ®\n    const messagesToShow = [];\n    let shownCount = 0;\n\n    for (const messageId of messageIds) {\n      const message = chatMessages.find(msg => msg.message_id === messageId);\n      if (message) {\n        messagesToShow.push({\n          message_id: messageId,\n          is_hidden: false,\n        });\n        shownCount++;\n      }\n    }\n\n    if (messagesToShow.length === 0) {\n      window.toastr.warning(\'æœªæ‰¾åˆ°è¦æ˜¾ç¤ºçš„æ¥¼å±‚\');\n      return;\n    }\n\n    // è°ƒç”¨é…’é¦†APIçœŸæ­£æ˜¾ç¤ºæ¥¼å±‚\n    try {\n      // ä½¿ç”¨ slash å‘½ä»¤æ˜¾ç¤ºæ¥¼å±‚\n      for (const messageId of messageIds) {\n        try {\n          await triggerSlash(`/unhide ${messageId}`);\n          console.log(`æˆåŠŸæ˜¾ç¤ºæ¥¼å±‚ ${messageId}`);\n        } catch (error) {\n          console.error(`æ˜¾ç¤ºæ¥¼å±‚ ${messageId} å¤±è´¥:`, error);\n        }\n      }\n    } catch (error) {\n      console.error(\'è°ƒç”¨æ˜¾ç¤ºAPIå¤±è´¥:\', error);\n      window.toastr.error(\'æ˜¾ç¤ºæ¥¼å±‚APIè°ƒç”¨å¤±è´¥: \' + (error as Error).message);\n      return;\n    }\n\n    // ä»éšè—åˆ—è¡¨ä¸­ç§»é™¤å·²æ˜¾ç¤ºçš„æ¥¼å±‚\n    hidden_messages.value = hidden_messages.value.filter(hiddenMsg => !messageIds.includes(hiddenMsg.message_id));\n\n    // ä¿å­˜åˆ°é…’é¦†å˜é‡\n    saveHiddenMessages();\n\n    window.toastr.success(`æˆåŠŸæ˜¾ç¤º ${shownCount} ä¸ªæ¥¼å±‚`);\n    hide_range.value = \'\'; // æ¸…ç©ºè¾“å…¥æ¡†\n  } catch (error) {\n    console.error(\'æ˜¾ç¤ºæ¥¼å±‚å¤±è´¥:\', error);\n    window.toastr.error(\'æ˜¾ç¤ºæ¥¼å±‚å¤±è´¥: \' + (error as Error).message);\n  }\n};\n\nconst handle_refresh_hidden = async (showToast: boolean = false) => {\n  try {\n    console.log(\'åˆ·æ–°éšè—æ¥¼å±‚\', showToast);\n\n    // å…ˆåŠ è½½éšè—æ¥¼å±‚æ•°æ®ï¼ˆå¦‚æœè¿˜æ²¡æœ‰åŠ è½½çš„è¯ï¼‰\n    if (hidden_messages.value.length === 0) {\n      console.log(\'éšè—æ¥¼å±‚åˆ—è¡¨ä¸ºç©ºï¼Œå…ˆåŠ è½½æ•°æ®...\');\n      loadHiddenMessages();\n    }\n\n    // è·å–å½“å‰èŠå¤©çš„æ¶ˆæ¯\n    let chatMessages;\n    try {\n      const lastMessageId = getLastMessageId();\n      console.log(\'æœ€æ–°æ¶ˆæ¯ID:\', lastMessageId);\n      chatMessages = getChatMessages(`0-${lastMessageId}`, { hide_state: \'all\' });\n      console.log(\'è·å–åˆ°çš„æ¶ˆæ¯æ•°é‡:\', chatMessages.length);\n    } catch (error) {\n      console.error(\'è·å–èŠå¤©æ¶ˆæ¯å¤±è´¥:\', error);\n      if (showToast) {\n        window.toastr.error(\'è·å–èŠå¤©æ¶ˆæ¯å¤±è´¥: \' + (error as Error).message);\n      }\n      return;\n    }\n\n    if (!chatMessages || chatMessages.length === 0) {\n      if (showToast) {\n        window.toastr.warning(\'å½“å‰èŠå¤©æ²¡æœ‰æ¶ˆæ¯\');\n      }\n      return;\n    }\n\n    // é‡æ–°éªŒè¯éšè—åˆ—è¡¨ä¸­çš„æ¥¼å±‚æ˜¯å¦ä»ç„¶å­˜åœ¨\n    const validHiddenMessages = [];\n    let removedCount = 0;\n\n    for (const hiddenMsg of hidden_messages.value) {\n      const message = chatMessages.find(msg => msg.message_id === hiddenMsg.message_id);\n      if (message) {\n        // æ›´æ–°æ¶ˆæ¯å†…å®¹ï¼ˆå¯èƒ½å·²ç»æ”¹å˜ï¼‰\n        validHiddenMessages.push({\n          message_id: hiddenMsg.message_id,\n          name: message.name || hiddenMsg.name,\n          role: message.role || hiddenMsg.role,\n          message: message.message || hiddenMsg.message,\n        });\n      } else {\n        // æ¥¼å±‚ä¸å­˜åœ¨äº†ï¼Œä»éšè—åˆ—è¡¨ä¸­ç§»é™¤\n        removedCount++;\n      }\n    }\n\n    // æ›´æ–°éšè—åˆ—è¡¨\n    hidden_messages.value = validHiddenMessages;\n\n    // ä¿å­˜æ›´æ–°åçš„æ•°æ®åˆ°é…’é¦†å˜é‡\n    saveHiddenMessages();\n\n    if (showToast) {\n      if (removedCount > 0) {\n        window.toastr.success(`åˆ·æ–°å®Œæˆï¼Œç§»é™¤äº† ${removedCount} ä¸ªä¸å­˜åœ¨çš„æ¥¼å±‚`);\n      } else {\n        window.toastr.success(\'åˆ·æ–°å®Œæˆï¼Œæ‰€æœ‰éšè—æ¥¼å±‚ä»ç„¶æœ‰æ•ˆ\');\n      }\n    }\n\n    console.log(`åˆ·æ–°å®Œæˆï¼š${validHiddenMessages.length} ä¸ªæœ‰æ•ˆéšè—æ¥¼å±‚ï¼Œ${removedCount} ä¸ªå·²ç§»é™¤`);\n  } catch (error) {\n    console.error(\'åˆ·æ–°éšè—æ¥¼å±‚å¤±è´¥:\', error);\n    if (showToast) {\n      window.toastr.error(\'åˆ·æ–°éšè—æ¥¼å±‚å¤±è´¥: \' + (error as Error).message);\n    }\n  }\n};\n\nconst handle_unhide_single = async (messageId: number) => {\n  try {\n    console.log(\'æ˜¾ç¤ºå•ä¸ªæ¥¼å±‚\', messageId);\n\n    // æ£€æŸ¥æ¥¼å±‚æ˜¯å¦åœ¨éšè—åˆ—è¡¨ä¸­\n    const index = hidden_messages.value.findIndex(msg => msg.message_id === messageId);\n    if (index === -1) {\n      window.toastr.warning(`æ¥¼å±‚ #${messageId} ä¸åœ¨éšè—åˆ—è¡¨ä¸­`);\n      return;\n    }\n\n    // è°ƒç”¨é…’é¦†APIçœŸæ­£æ˜¾ç¤ºæ¥¼å±‚\n    try {\n      // ä½¿ç”¨ slash å‘½ä»¤æ˜¾ç¤ºæ¥¼å±‚\n      await triggerSlash(`/unhide ${messageId}`);\n      console.log(\'æˆåŠŸæ˜¾ç¤ºæ¥¼å±‚:\', messageId);\n    } catch (error) {\n      console.error(\'è°ƒç”¨æ˜¾ç¤ºAPIå¤±è´¥:\', error);\n      window.toastr.warning(\'æ˜¾ç¤ºæ¥¼å±‚APIè°ƒç”¨å¤±è´¥\');\n      return;\n    }\n\n    // ä»éšè—åˆ—è¡¨ä¸­ç§»é™¤æŒ‡å®šçš„æ¥¼å±‚\n    hidden_messages.value.splice(index, 1);\n\n    // ä¿å­˜åˆ°é…’é¦†å˜é‡\n    saveHiddenMessages();\n\n    window.toastr.success(`å·²æ˜¾ç¤ºæ¥¼å±‚ #${messageId}`);\n  } catch (error) {\n    console.error(\'æ˜¾ç¤ºå•ä¸ªæ¥¼å±‚å¤±è´¥:\', error);\n    window.toastr.error(\'æ˜¾ç¤ºå•ä¸ªæ¥¼å±‚å¤±è´¥: \' + (error as Error).message);\n  }\n};\n<\/script>\n\n<style>\n.settings-tab {\n  height: 100%;\n  overflow-y: auto;\n  padding: 25px !important;\n  background: #1a1a1a !important;\n  border: 2px solid red !important;\n}\n\n.config-section {\n  padding: 20px 25px !important;\n  border-bottom: 1px solid #3a3a3a;\n  margin-bottom: 5px;\n}\n\n.config-section:last-child {\n  border-bottom: none;\n  margin-bottom: 0;\n}\n\n.config-section h3 {\n  margin: 0 0 20px 0 !important;\n  color: #fff;\n  font-size: 15px !important;\n  font-weight: bold;\n  display: flex;\n  align-items: center;\n  gap: 8px;\n}\n\n.form-group {\n  margin-bottom: 18px !important;\n}\n\n.form-group label {\n  display: block;\n  margin-bottom: 6px;\n  color: #ccc;\n  font-size: 13px;\n}\n\n.checkbox-label {\n  display: flex;\n  align-items: center;\n  gap: 8px;\n}\n\n.flex-label {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n}\n\n.form-group input[type=\'text\'],\n.form-group input[type=\'password\'],\n.form-group input[type=\'number\'],\n.form-group select {\n  width: 100%;\n  padding: 10px 12px;\n  background: #2a2a2a;\n  border: 1px solid #3a3a3a;\n  border-radius: 6px;\n  color: #e0e0e0;\n  font-size: 13px;\n  transition: border-color 0.2s;\n}\n\n.form-group input:focus,\n.form-group select:focus {\n  outline: none;\n  border-color: #4a9eff;\n}\n\n.model-controls {\n  display: flex;\n  flex-direction: column;\n  gap: 10px;\n}\n\n.button-group {\n  display: flex;\n  gap: 12px;\n  flex-wrap: wrap;\n  margin-top: 5px;\n}\n\n.action-button {\n  flex: 1;\n  min-width: 120px;\n  padding: 12px 16px;\n  border: none;\n  border-radius: 6px;\n  cursor: pointer;\n  font-weight: 500;\n  font-size: 13px;\n  transition: all 0.2s;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  gap: 6px;\n  background: #3a3a3a;\n  color: #e0e0e0;\n  border: 1px solid #4a4a4a;\n}\n\n.action-button:hover {\n  background: #4a4a4a;\n  border-color: #5a5a5a;\n}\n\n.test-button {\n  background: #3a3a3a;\n  color: #e0e0e0;\n  border: 1px solid #4a4a4a;\n}\n\n.test-button:hover {\n  background: #4a4a4a;\n  border-color: #5a5a5a;\n}\n\n.fetch-button {\n  background: #4a9eff;\n  color: white;\n  border: 1px solid #5aaeff;\n}\n\n.fetch-button:hover {\n  background: #5aaeff;\n  border-color: #6abeff;\n}\n\n.summarize-button {\n  background: #4a9eff;\n  color: white;\n  border: 1px solid #5aaeff;\n}\n\n.summarize-button:hover {\n  background: #5aaeff;\n  border-color: #6abeff;\n}\n\n.create-button {\n  background: #51cf66;\n  color: white;\n  border: 1px solid #40c057;\n}\n\n.create-button:hover {\n  background: #40c057;\n  border-color: #37b24d;\n}\n\n.table-button {\n  background: #4a9eff;\n  color: white;\n  border: 1px solid #5aaeff;\n}\n\n.table-button:hover {\n  background: #5aaeff;\n  border-color: #6abeff;\n}\n\n.hide-button {\n  background: #ff6b6b;\n  color: white;\n  border: 1px solid #ff5252;\n}\n\n.hide-button:hover {\n  background: #ff5252;\n  border-color: #ff4444;\n}\n\n.unhide-button {\n  background: #51cf66;\n  color: white;\n  border: 1px solid #40c057;\n}\n\n.unhide-button:hover {\n  background: #40c057;\n  border-color: #37b24d;\n}\n\n.refresh-button {\n  background: #ffd43b;\n  color: #333;\n  border: 1px solid #ffcc02;\n}\n\n.refresh-button:hover {\n  background: #ffcc02;\n  border-color: #ffb700;\n}\n\n.action-button:disabled {\n  opacity: 0.5;\n  cursor: not-allowed;\n}\n\n.model-select {\n  margin-top: 8px;\n}\n\n.hidden-messages-section {\n  margin-top: 20px;\n}\n\n.hidden-messages-list {\n  max-height: 300px;\n  overflow-y: auto;\n  border-radius: 6px;\n  border: 1px solid #3a3a3a;\n  background: #1a1a1a;\n}\n\n.hidden-message-item {\n  padding: 10px 12px;\n  display: flex;\n  align-items: center;\n  gap: 12px;\n  border-bottom: 1px solid #2a2a2a;\n  transition: background 0.2s;\n}\n\n.hidden-message-item:last-child {\n  border-bottom: none;\n}\n\n.hidden-message-item:hover {\n  background: #2a2a2a;\n}\n\n.message-info {\n  display: flex;\n  align-items: center;\n  gap: 10px;\n  flex: 1;\n}\n\n.message-id {\n  font-weight: bold;\n  color: #4a9eff;\n  font-size: 13px;\n  min-width: 50px;\n}\n\n.message-role {\n  font-size: 12px;\n  padding: 2px 8px;\n  border-radius: 4px;\n  white-space: nowrap;\n}\n\n.message-role.role-user {\n  background: #3a5a3a;\n  color: #90ee90;\n}\n\n.message-role.role-assistant {\n  background: #3a3a5a;\n  color: #90a0ee;\n}\n\n.message-role.role-system {\n  background: #5a5a3a;\n  color: #eea090;\n}\n\n.message-preview {\n  flex: 1;\n  color: #888;\n  font-size: 12px;\n  overflow: hidden;\n  text-overflow: ellipsis;\n  white-space: nowrap;\n}\n\n.show-button {\n  background: #4a9eff !important;\n  color: white !important;\n  padding: 6px 12px;\n  border: 1px solid #5aaeff !important;\n  border-radius: 4px;\n  cursor: pointer;\n  font-size: 12px;\n  transition: all 0.2s;\n  min-width: 60px;\n  text-align: center;\n}\n\n.show-button:hover {\n  background: #5aaeff !important;\n  border-color: #6abeff !important;\n}\n\n.mini-button {\n  background: #666;\n  color: white;\n  border: 1px solid #777;\n  padding: 6px 12px;\n  border-radius: 4px;\n  cursor: pointer;\n  font-size: 12px;\n  transition: all 0.2s;\n}\n\n.mini-button:hover {\n  background: #777;\n  border-color: #888;\n}\n\n.empty-state {\n  margin-top: 20px;\n  padding: 20px;\n  background: #2a2a2a;\n  border-radius: 6px;\n  text-align: center;\n  color: #888;\n  border: 1px solid #3a3a3a;\n}\n</style>\n'],sourceRoot:''}]);const i=s},127:(e,n,t)=>{var a=t(892);a.__esModule&&(a=a.default),'string'==typeof a&&(a=[[e.id,a,'']]),a.locals&&(e.exports=a.locals);(0,t(424).A)('70dcd538',a,!1,{ssrId:!0})},139:(e,n,t)=>{t.r(n),t.d(n,{default:()=>i});var a=t(790),o=t.n(a),r=t(54),s=t.n(r)()(o());s.push([e.id,'.tool-section[data-v-6329201c]{margin-bottom:20px}.tool-content[data-v-6329201c]{padding:0 20px 20px 20px}.form-group[data-v-6329201c]{margin-bottom:15px}.generate-btn:hover .shimmer-effect[data-v-6329201c]{left:100%}.output-section[data-v-6329201c]{margin-top:15px;padding-top:15px;border-top:1px solid rgba(255,255,255,0.1)}.code-output[data-v-6329201c]{background:#1a1a1a;border:1px solid #3a3a3a;border-radius:6px;padding:15px;position:relative;max-height:400px;overflow-y:auto}.code-output pre[data-v-6329201c]{margin:0;color:#e0e0e0;font-family:\'Courier New\',monospace;font-size:12px;white-space:pre-wrap;word-wrap:break-word}.copy-btn-abs[data-v-6329201c]{position:absolute;top:8px;right:8px;background:linear-gradient(135deg,rgba(74,158,255,0.2),rgba(102,126,234,0.3));border:1px solid rgba(74,158,255,0.4);border-radius:6px;color:#4a9eff;padding:8px 14px;cursor:pointer;font-size:12px;font-weight:600;transition:all 0.3s ease;box-shadow:0 2px 8px rgba(74,158,255,0.2)}.copy-btn-abs[data-v-6329201c]:hover{background:linear-gradient(135deg,rgba(74,158,255,0.35),rgba(102,126,234,0.45));border-color:rgba(74,158,255,0.6);box-shadow:0 4px 12px rgba(74,158,255,0.35);transform:translateY(-2px);color:#fff}\n','',{version:3,sources:['webpack://./src/è®°å¿†_with_worldbook/components/MvuBetaTab.vue'],names:[],mappings:'AA6rDA,+BACE,kBACF,CAEA,+BACE,wBACF,CAEA,6BACE,kBACF,CAEA,qDACE,SACF,CAEA,iCACE,eAAgB,CAChB,gBAAiB,CACjB,0CACF,CAEA,8BACE,kBAAmB,CACnB,wBAAyB,CACzB,iBAAkB,CAClB,YAAa,CACb,iBAAkB,CAClB,gBAAiB,CACjB,eACF,CAEA,kCACE,QAAS,CACT,aAAc,CACd,mCAAqC,CACrC,cAAe,CACf,oBAAqB,CACrB,oBACF,CAEA,+BACE,iBAAkB,CAClB,OAAQ,CACR,SAAU,CACV,6EAAsF,CACtF,qCAAyC,CACzC,iBAAkB,CAClB,aAAc,CACd,gBAAiB,CACjB,cAAe,CACf,cAAe,CACf,eAAgB,CAChB,wBAAyB,CACzB,yCACF,CAEA,qCACE,+EAAwF,CACxF,iCAAqC,CACrC,2CAA+C,CAC/C,0BAA2B,CAC3B,UACF',sourcesContent:['<template>\n  <div class="tools-tab" style="padding: 25px !important; background: #1a1a1a !important">\n    \x3c!-- å˜é‡ç»“æ„ç”Ÿæˆå™¨ --\x3e\n    <div class="tool-section">\n      <div\n        class="section-header"\n        style="\n          display: flex;\n          justify-content: space-between;\n          align-items: center;\n          padding: 15px 20px;\n          background: linear-gradient(\n            135deg,\n            rgba(30, 30, 30, 0.95) 0%,\n            rgba(38, 38, 38, 0.9) 50%,\n            rgba(30, 30, 30, 0.95) 100%\n          );\n          backdrop-filter: blur(12px);\n          border-radius: 12px;\n          margin-bottom: 15px;\n          border: 1px solid rgba(255, 255, 255, 0.06);\n          box-shadow:\n            0 3px 12px rgba(0, 0, 0, 0.3),\n            inset 0 1px 0 rgba(255, 255, 255, 0.04),\n            inset 0 -1px 0 rgba(0, 0, 0, 0.2);\n          cursor: pointer;\n          transition: all 0.3s ease;\n        "\n        @click="toggleExpanded(\'structure\')"\n        @mouseenter="(e: any) => (e.currentTarget.style.transform = \'translateY(-1px)\')"\n        @mouseleave="(e: any) => (e.currentTarget.style.transform = \'translateY(0)\')"\n      >\n        <h4\n          style="\n            margin: 0;\n            color: #fff;\n            font-size: 16px;\n            font-weight: 600;\n            display: flex;\n            align-items: center;\n            gap: 10px;\n          "\n        >\n          <i class="fa-solid fa-database" style="color: #4a9eff; font-size: 18px"></i>\n          [InitVar] å˜é‡ç»“æ„ç”Ÿæˆå™¨\n        </h4>\n        <i\n          :class="expanded.structure ? \'fa-solid fa-chevron-up\' : \'fa-solid fa-chevron-down\'"\n          style="color: #ccc; transition: transform 0.3s ease; font-size: 14px"\n        ></i>\n      </div>\n\n      <div v-if="expanded.structure" class="tool-content">\n        <div class="tool-instructions" style="margin-bottom: 15px">\n          <p style="margin: 0 0 8px 0; color: #ccc; font-size: 12px">\n            <i class="fa-solid fa-info-circle" style="margin-right: 6px; color: #17a2b8"></i>\n            ç”Ÿæˆç¬¦åˆ MVU Beta è§„èŒƒçš„ <strong style="color: #4a9eff">[InitVar]</strong> åˆå§‹åŒ–æ•°æ®ã€‚\n          </p>\n          <p\n            style="\n              margin: 0;\n              color: #ffa500;\n              font-size: 11px;\n              background: #1a1a1a;\n              padding: 6px;\n              border-radius: 4px;\n              border-left: 3px solid #ffa500;\n            "\n          >\n            âš ï¸ é‡è¦ï¼šInitVar JSON ä¸­<strong>ä¸è¦åŒ…å« "stat_data" æ ¹èŠ‚ç‚¹</strong>ï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨æ·»åŠ \n          </p>\n        </div>\n\n        \x3c!-- AIæ™ºèƒ½ç”ŸæˆåŒºåŸŸ --\x3e\n        <div\n          style="\n            background: linear-gradient(135deg, rgba(102, 126, 234, 0.08), rgba(118, 75, 162, 0.08));\n            border: 1px solid rgba(102, 126, 234, 0.3);\n            border-radius: 8px;\n            padding: 15px;\n            margin-bottom: 20px;\n          "\n        >\n          <h4 style="color: #667eea; font-size: 14px; margin: 0 0 12px 0; display: flex; align-items: center; gap: 8px">\n            <i class="fa-solid fa-wand-magic-sparkles"></i>\n            AI æ™ºèƒ½ç”Ÿæˆï¼ˆæ¨èï¼‰\n          </h4>\n\n          <div class="form-group" style="margin: 0 0 12px 0">\n            <label style="display: block; margin-bottom: 8px; color: #ccc; font-size: 13px; font-weight: 500">\n              æè¿°ä½ çš„å˜é‡éœ€æ±‚ï¼š\n            </label>\n            <textarea\n              v-model="aiStructurePrompt"\n              placeholder="ä¾‹å¦‚ï¼šæˆ‘éœ€è¦ä¸€ä¸ªè§’è‰²å±æ€§ç³»ç»Ÿï¼ŒåŒ…å«åå­—ï¼ˆå­—ç¬¦ä¸²ï¼‰ã€ç­‰çº§ï¼ˆæ•°å­—ï¼Œåˆå§‹ä¸º1ï¼‰ã€å¥½æ„Ÿåº¦ï¼ˆæ•°å­—ï¼ŒèŒƒå›´-30åˆ°100ï¼‰ã€èƒŒåŒ…ï¼ˆå¯æ‰©å±•æ•°ç»„ï¼‰ã€æˆå°±ï¼ˆå¯æ‰©å±•å¯¹è±¡ï¼‰"\n              rows="4"\n              style="\n                width: 100%;\n                padding: 12px;\n                background: #2a2a2a;\n                border: 1px solid #3a3a3a;\n                border-radius: 6px;\n                color: #e0e0e0;\n                font-size: 13px;\n                resize: vertical;\n                line-height: 1.5;\n                transition: all 0.2s ease;\n              "\n              @focus="(e: any) => (e.target.style.borderColor = \'#667eea\')"\n              @blur="(e: any) => (e.target.style.borderColor = \'#3a3a3a\')"\n            ></textarea>\n          </div>\n\n          <button\n            class="ai-generate-btn"\n            :disabled="isGeneratingAI || !aiStructurePrompt.trim()"\n            style="\n              padding: 12px 24px;\n              background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);\n              border: none;\n              border-radius: 8px;\n              color: white;\n              font-size: 13px;\n              font-weight: 600;\n              cursor: pointer;\n              transition: all 0.3s ease;\n              box-shadow: 0 3px 12px rgba(102, 126, 234, 0.3);\n              position: relative;\n              overflow: hidden;\n            "\n            :style="{\n              opacity: isGeneratingAI || !aiStructurePrompt.trim() ? 0.6 : 1,\n              cursor: isGeneratingAI || !aiStructurePrompt.trim() ? \'not-allowed\' : \'pointer\',\n            }"\n            @click="handleAIGenerateStructure"\n            @mouseenter="\n              (e: any) => {\n                if (!isGeneratingAI && aiStructurePrompt.trim()) {\n                  e.currentTarget.style.transform = \'translateY(-2px)\';\n                  e.currentTarget.style.boxShadow = \'0 6px 20px rgba(102, 126, 234, 0.4)\';\n                }\n              }\n            "\n            @mouseleave="\n              (e: any) => {\n                e.currentTarget.style.transform = \'translateY(0)\';\n                e.currentTarget.style.boxShadow = \'0 3px 12px rgba(102, 126, 234, 0.3)\';\n              }\n            "\n          >\n            <div\n              style="\n                position: absolute;\n                top: 0;\n                left: -100%;\n                width: 100%;\n                height: 100%;\n                background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);\n                transition: left 0.5s;\n              "\n              class="shimmer-effect"\n            ></div>\n            <i\n              class="fa-solid fa-wand-magic-sparkles"\n              style="font-size: 14px; margin-right: 6px; position: relative; z-index: 1"\n            ></i>\n            <span style="position: relative; z-index: 1">{{ isGeneratingAI ? \'AI ç”Ÿæˆä¸­...\' : \'AI æ™ºèƒ½ç”Ÿæˆ\' }}</span>\n          </button>\n\n          \x3c!-- AI ä¿®æ”¹æŒ‰é’® --\x3e\n          <button\n            v-if="generatedStructure && originalStructurePrompt"\n            style="\n              margin-left: 12px;\n              padding: 10px 20px;\n              background: linear-gradient(135deg, rgba(251, 191, 36, 0.2), rgba(245, 158, 11, 0.3));\n              border: 1px solid rgba(251, 191, 36, 0.4);\n              border-radius: 8px;\n              color: #fbbf24;\n              font-size: 13px;\n              font-weight: 600;\n              cursor: pointer;\n              transition: all 0.3s ease;\n              box-shadow: 0 2px 8px rgba(251, 191, 36, 0.2);\n            "\n            @click="showStructureModifyDialog = true"\n            @mouseenter="\n              (e: any) => {\n                e.currentTarget.style.background =\n                  \'linear-gradient(135deg, rgba(251, 191, 36, 0.35), rgba(245, 158, 11, 0.45))\';\n                e.currentTarget.style.borderColor = \'rgba(251, 191, 36, 0.6)\';\n                e.currentTarget.style.transform = \'translateY(-2px)\';\n                e.currentTarget.style.boxShadow = \'0 4px 12px rgba(251, 191, 36, 0.35)\';\n              }\n            "\n            @mouseleave="\n              (e: any) => {\n                e.currentTarget.style.background =\n                  \'linear-gradient(135deg, rgba(251, 191, 36, 0.2), rgba(245, 158, 11, 0.3))\';\n                e.currentTarget.style.borderColor = \'rgba(251, 191, 36, 0.4)\';\n                e.currentTarget.style.transform = \'translateY(0)\';\n                e.currentTarget.style.boxShadow = \'0 2px 8px rgba(251, 191, 36, 0.2)\';\n              }\n            "\n          >\n            <i class="fa-solid fa-edit" style="margin-right: 6px"></i>\n            AI ä¿®æ”¹\n          </button>\n\n          <p style="color: #888; font-size: 11px; margin: 8px 0 0 0">\n            ğŸ’¡ AI ä¼šæ ¹æ®ä½ çš„æè¿°è‡ªåŠ¨ç”Ÿæˆç»“æ„ã€é€‰æ‹©ç±»å‹ã€é…ç½® $meta\n          </p>\n        </div>\n\n        <div style="text-align: center; margin: 20px 0; position: relative">\n          <span\n            style="background: #1a1a1a; padding: 0 12px; color: #666; font-size: 12px; position: relative; z-index: 1"\n            >æˆ–æ‰‹åŠ¨é…ç½®</span\n          >\n          <div\n            style="\n              position: absolute;\n              top: 50%;\n              left: 0;\n              right: 0;\n              height: 1px;\n              background: rgba(255, 255, 255, 0.1);\n              z-index: 0;\n            "\n          ></div>\n        </div>\n\n        <div class="form-group" style="margin: 15px 0">\n          <label style="display: block; margin-bottom: 8px; color: #ccc; font-size: 13px; font-weight: 500">\n            å˜é‡åç§°ï¼š\n          </label>\n          <input\n            v-model="varName"\n            type="text"\n            placeholder="ä¾‹å¦‚ï¼šè§’è‰²ã€èƒŒåŒ…ã€æŠ€èƒ½"\n            style="\n              width: 100%;\n              padding: 12px;\n              background: #2a2a2a;\n              border: 1px solid #3a3a3a;\n              border-radius: 6px;\n              color: #e0e0e0;\n              font-size: 13px;\n              transition: all 0.2s ease;\n            "\n            @focus="(e: any) => (e.target.style.borderColor = \'#4a9eff\')"\n            @blur="(e: any) => (e.target.style.borderColor = \'#3a3a3a\')"\n          />\n        </div>\n\n        <div class="form-group" style="margin: 15px 0">\n          <label style="display: block; margin-bottom: 8px; color: #ccc; font-size: 13px; font-weight: 500">\n            å­å­—æ®µï¼ˆæ¯è¡Œä¸€ä¸ªï¼Œæ ¼å¼ï¼šå­—æ®µå:ç±»å‹:æè¿°ï¼‰ï¼š\n          </label>\n          <textarea\n            v-model="subFields"\n            placeholder="ä¾‹å¦‚ï¼š&#10;å¥½æ„Ÿåº¦:number:[-30,100]ä¹‹é—´ï¼Œä¸è§’è‰²äº¤æµæ—¶å˜åŒ–&#10;åå­—:string:è§’è‰²åç§°&#10;èƒŒåŒ…:array:è·å¾—æˆ–ä½¿ç”¨ç‰©å“æ—¶æ›´æ–°"\n            rows="5"\n            style="\n              width: 100%;\n              height: 120px;\n              padding: 12px;\n              background: #2a2a2a;\n              border: 1px solid #3a3a3a;\n              border-radius: 6px;\n              color: #e0e0e0;\n              font-size: 13px;\n              resize: vertical;\n              font-family: \'Courier New\', monospace;\n              line-height: 1.5;\n              transition: all 0.2s ease;\n            "\n            @focus="(e: any) => (e.target.style.borderColor = \'#4a9eff\')"\n            @blur="(e: any) => (e.target.style.borderColor = \'#3a3a3a\')"\n          ></textarea>\n          <p style="color: #888; font-size: 11px; margin: 6px 0 0 0">ğŸ’¡ æ”¯æŒç±»å‹ï¼šnumberã€stringã€arrayã€object</p>\n        </div>\n\n        <button\n          class="generate-btn"\n          style="\n            padding: 12px 24px;\n            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);\n            border: none;\n            border-radius: 8px;\n            color: white;\n            font-size: 13px;\n            font-weight: 600;\n            cursor: pointer;\n            transition: all 0.3s ease;\n            box-shadow: 0 3px 12px rgba(102, 126, 234, 0.3);\n            position: relative;\n            overflow: hidden;\n          "\n          @click="generateStructure"\n          @mouseenter="\n            (e: any) => {\n              e.currentTarget.style.transform = \'translateY(-2px)\';\n              e.currentTarget.style.boxShadow = \'0 6px 20px rgba(102, 126, 234, 0.4)\';\n            }\n          "\n          @mouseleave="\n            (e: any) => {\n              e.currentTarget.style.transform = \'translateY(0)\';\n              e.currentTarget.style.boxShadow = \'0 3px 12px rgba(102, 126, 234, 0.3)\';\n            }\n          "\n        >\n          <div\n            style="\n              position: absolute;\n              top: 0;\n              left: -100%;\n              width: 100%;\n              height: 100%;\n              background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);\n              transition: left 0.5s;\n            "\n            class="shimmer-effect"\n          ></div>\n          <i class="fa-solid fa-magic" style="font-size: 14px; margin-right: 6px; position: relative; z-index: 1"></i>\n          <span style="position: relative; z-index: 1">ç”Ÿæˆ [InitVar] ç»“æ„</span>\n        </button>\n\n        <div v-if="generatedStructure" class="output-section">\n          <h4 style="color: #4a9eff; font-size: 14px; margin-bottom: 10px">ç”Ÿæˆçš„ [InitVar] ç»“æ„ï¼š</h4>\n          <div class="code-output">\n            <pre>{{ generatedStructure }}</pre>\n            <button class="copy-btn-abs" @click="copyGenerated">\n              <i class="fa-solid fa-copy"></i>\n            </button>\n          </div>\n\n          \x3c!-- å¿«æ·æ“ä½œ --\x3e\n          <div\n            style="\n              margin-top: 15px;\n              padding: 12px;\n              background: rgba(74, 158, 255, 0.05);\n              border: 1px solid rgba(74, 158, 255, 0.2);\n              border-radius: 8px;\n            "\n          >\n            <p style="margin: 0 0 10px 0; color: #4a9eff; font-size: 12px; font-weight: 600">\n              <i class="fa-solid fa-link"></i> åŸºäºæ­¤ç»“æ„ç»§ç»­ç”Ÿæˆï¼š\n            </p>\n            <div style="display: flex; gap: 10px; flex-wrap: wrap">\n              <button\n                style="\n                  flex: 1;\n                  min-width: 140px;\n                  padding: 8px 16px;\n                  background: linear-gradient(135deg, rgba(16, 185, 129, 0.2), rgba(5, 150, 105, 0.3));\n                  color: #10b981;\n                  border: 1px solid rgba(16, 185, 129, 0.4);\n                  border-radius: 6px;\n                  font-size: 12px;\n                  cursor: pointer;\n                  transition: all 0.2s;\n                "\n                @click="autoGeneratePrompt"\n                @mouseenter="\n                  (e: any) => {\n                    e.currentTarget.style.transform = \'translateY(-1px)\';\n                    e.currentTarget.style.boxShadow = \'0 4px 12px rgba(16, 185, 129, 0.3)\';\n                  }\n                "\n                @mouseleave="\n                  (e: any) => {\n                    e.currentTarget.style.transform = \'translateY(0)\';\n                    e.currentTarget.style.boxShadow = \'none\';\n                  }\n                "\n              >\n                <i class="fa-solid fa-file-alt"></i> ç”Ÿæˆ COT æç¤ºè¯\n              </button>\n              <button\n                style="\n                  flex: 1;\n                  min-width: 140px;\n                  padding: 8px 16px;\n                  background: linear-gradient(135deg, rgba(245, 158, 11, 0.2), rgba(217, 119, 6, 0.3));\n                  color: #f59e0b;\n                  border: 1px solid rgba(245, 158, 11, 0.4);\n                  border-radius: 6px;\n                  font-size: 12px;\n                  cursor: pointer;\n                  transition: all 0.2s;\n                "\n                @click="exportWorldbook"\n                @mouseenter="\n                  (e: any) => {\n                    e.currentTarget.style.transform = \'translateY(-1px)\';\n                    e.currentTarget.style.boxShadow = \'0 4px 12px rgba(245, 158, 11, 0.3)\';\n                  }\n                "\n                @mouseleave="\n                  (e: any) => {\n                    e.currentTarget.style.transform = \'translateY(0)\';\n                    e.currentTarget.style.boxShadow = \'none\';\n                  }\n                "\n              >\n                <i class="fa-solid fa-book"></i> å¯¼å‡ºä¸–ç•Œä¹¦ JSON\n              </button>\n            </div>\n          </div>\n        </div>\n      </div>\n    </div>\n\n    \x3c!-- COT æç¤ºè¯ç”Ÿæˆå™¨ --\x3e\n    <div class="tool-section">\n      <div\n        class="section-header"\n        style="\n          display: flex;\n          justify-content: space-between;\n          align-items: center;\n          padding: 15px 20px;\n          background: linear-gradient(\n            135deg,\n            rgba(30, 30, 30, 0.95) 0%,\n            rgba(38, 38, 38, 0.9) 50%,\n            rgba(30, 30, 30, 0.95) 100%\n          );\n          backdrop-filter: blur(12px);\n          border-radius: 12px;\n          margin-bottom: 15px;\n          border: 1px solid rgba(255, 255, 255, 0.06);\n          box-shadow:\n            0 3px 12px rgba(0, 0, 0, 0.3),\n            inset 0 1px 0 rgba(255, 255, 255, 0.04),\n            inset 0 -1px 0 rgba(0, 0, 0, 0.2);\n          cursor: pointer;\n          transition: all 0.3s ease;\n        "\n        @click="toggleExpanded(\'prompt\')"\n        @mouseenter="(e: any) => (e.currentTarget.style.transform = \'translateY(-1px)\')"\n        @mouseleave="(e: any) => (e.currentTarget.style.transform = \'translateY(0)\')"\n      >\n        <h4\n          style="\n            margin: 0;\n            color: #fff;\n            font-size: 16px;\n            font-weight: 600;\n            display: flex;\n            align-items: center;\n            gap: 10px;\n          "\n        >\n          <i class="fa-solid fa-file-code" style="color: #fbbf24; font-size: 18px"></i>\n          COT æç¤ºè¯ç”Ÿæˆå™¨ï¼ˆ6 æ­¥æ€ç»´é“¾ï¼‰\n        </h4>\n        <i\n          :class="expanded.prompt ? \'fa-solid fa-chevron-up\' : \'fa-solid fa-chevron-down\'"\n          style="color: #ccc; transition: transform 0.3s ease; font-size: 14px"\n        ></i>\n      </div>\n\n      <div v-if="expanded.prompt" class="tool-content">\n        <div class="tool-instructions" style="margin-bottom: 15px">\n          <p style="margin: 0 0 8px 0; color: #ccc; font-size: 12px">\n            <i class="fa-solid fa-info-circle" style="margin-right: 6px; color: #17a2b8"></i>\n            ç”Ÿæˆé€‚ç”¨äº MVU Beta çš„ <strong style="color: #fbbf24">COTï¼ˆæ€ç»´é“¾ï¼‰æç¤ºè¯æ¨¡æ¿</strong>ï¼ŒåŒ…å« 6 æ­¥åˆ†ææµç¨‹ã€‚\n          </p>\n        </div>\n\n        \x3c!-- AIæ™ºèƒ½ç”ŸæˆåŒºåŸŸ --\x3e\n        <div\n          style="\n            background: linear-gradient(135deg, rgba(251, 191, 36, 0.08), rgba(245, 158, 11, 0.08));\n            border: 1px solid rgba(251, 191, 36, 0.3);\n            border-radius: 8px;\n            padding: 15px;\n            margin-bottom: 20px;\n          "\n        >\n          <h4 style="color: #fbbf24; font-size: 14px; margin: 0 0 12px 0; display: flex; align-items: center; gap: 8px">\n            <i class="fa-solid fa-wand-magic-sparkles"></i>\n            AI æ™ºèƒ½ç”Ÿæˆï¼ˆæ¨èï¼‰\n          </h4>\n\n          <div class="form-group" style="margin: 0 0 12px 0">\n            <label style="display: block; margin-bottom: 8px; color: #ccc; font-size: 13px; font-weight: 500">\n              æè¿°ä½ çš„å˜é‡ç³»ç»Ÿå’Œä½¿ç”¨åœºæ™¯ï¼š\n            </label>\n            <textarea\n              v-model="aiPromptDescription"\n              placeholder="ä¾‹å¦‚ï¼šæˆ‘çš„è§’è‰²å¡æœ‰ä¸€ä¸ªå¥½æ„Ÿåº¦ç³»ç»Ÿå’Œæ—¶é—´ç³»ç»Ÿï¼Œéœ€è¦ AI åœ¨æ¯æ¬¡äº’åŠ¨åæ›´æ–°æ—¶é—´å’Œå¥½æ„Ÿåº¦"\n              rows="4"\n              style="\n                width: 100%;\n                padding: 12px;\n                background: #2a2a2a;\n                border: 1px solid #3a3a3a;\n                border-radius: 6px;\n                color: #e0e0e0;\n                font-size: 13px;\n                resize: vertical;\n                line-height: 1.5;\n                transition: all 0.2s ease;\n              "\n              @focus="(e: any) => (e.target.style.borderColor = \'#fbbf24\')"\n              @blur="(e: any) => (e.target.style.borderColor = \'#3a3a3a\')"\n            ></textarea>\n          </div>\n\n          <button\n            class="ai-generate-btn"\n            :disabled="isGeneratingPrompt || !aiPromptDescription.trim()"\n            style="\n              padding: 12px 24px;\n              background: linear-gradient(135deg, #fbbf24 0%, #f59e0b 100%);\n              border: none;\n              border-radius: 8px;\n              color: white;\n              font-size: 13px;\n              font-weight: 600;\n              cursor: pointer;\n              transition: all 0.3s ease;\n              box-shadow: 0 3px 12px rgba(251, 191, 36, 0.3);\n              position: relative;\n              overflow: hidden;\n            "\n            :style="{\n              opacity: isGeneratingPrompt || !aiPromptDescription.trim() ? 0.6 : 1,\n              cursor: isGeneratingPrompt || !aiPromptDescription.trim() ? \'not-allowed\' : \'pointer\',\n            }"\n            @click="handleAIGeneratePrompt"\n            @mouseenter="\n              (e: any) => {\n                if (!isGeneratingPrompt && aiPromptDescription.trim()) {\n                  e.currentTarget.style.transform = \'translateY(-2px)\';\n                  e.currentTarget.style.boxShadow = \'0 6px 20px rgba(251, 191, 36, 0.4)\';\n                }\n              }\n            "\n            @mouseleave="\n              (e: any) => {\n                e.currentTarget.style.transform = \'translateY(0)\';\n                e.currentTarget.style.boxShadow = \'0 3px 12px rgba(251, 191, 36, 0.3)\';\n              }\n            "\n          >\n            <div\n              style="\n                position: absolute;\n                top: 0;\n                left: -100%;\n                width: 100%;\n                height: 100%;\n                background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);\n                transition: left 0.5s;\n              "\n              class="shimmer-effect"\n            ></div>\n            <i\n              class="fa-solid fa-wand-magic-sparkles"\n              style="font-size: 14px; margin-right: 6px; position: relative; z-index: 1"\n            ></i>\n            <span style="position: relative; z-index: 1">{{\n              isGeneratingPrompt ? \'AI ç”Ÿæˆä¸­...\' : \'AI æ™ºèƒ½ç”Ÿæˆ\'\n            }}</span>\n          </button>\n\n          \x3c!-- AI ä¿®æ”¹æŒ‰é’® --\x3e\n          <button\n            v-if="generatedPrompt && originalPromptDescription"\n            style="\n              margin-left: 12px;\n              padding: 10px 20px;\n              background: linear-gradient(135deg, rgba(251, 191, 36, 0.2), rgba(245, 158, 11, 0.3));\n              border: 1px solid rgba(251, 191, 36, 0.4);\n              border-radius: 8px;\n              color: #fbbf24;\n              font-size: 13px;\n              font-weight: 600;\n              cursor: pointer;\n              transition: all 0.3s ease;\n              box-shadow: 0 2px 8px rgba(251, 191, 36, 0.2);\n            "\n            @click="showPromptModifyDialog = true"\n            @mouseenter="\n              (e: any) => {\n                e.currentTarget.style.background =\n                  \'linear-gradient(135deg, rgba(251, 191, 36, 0.35), rgba(245, 158, 11, 0.45))\';\n                e.currentTarget.style.borderColor = \'rgba(251, 191, 36, 0.6)\';\n                e.currentTarget.style.transform = \'translateY(-2px)\';\n                e.currentTarget.style.boxShadow = \'0 4px 12px rgba(251, 191, 36, 0.35)\';\n              }\n            "\n            @mouseleave="\n              (e: any) => {\n                e.currentTarget.style.background =\n                  \'linear-gradient(135deg, rgba(251, 191, 36, 0.2), rgba(245, 158, 11, 0.3))\';\n                e.currentTarget.style.borderColor = \'rgba(251, 191, 36, 0.4)\';\n                e.currentTarget.style.transform = \'translateY(0)\';\n                e.currentTarget.style.boxShadow = \'0 2px 8px rgba(251, 191, 36, 0.2)\';\n              }\n            "\n          >\n            <i class="fa-solid fa-edit" style="margin-right: 6px"></i>\n            AI ä¿®æ”¹\n          </button>\n\n          <p style="color: #888; font-size: 11px; margin: 8px 0 0 0">\n            ğŸ’¡ AI ä¼šæ ¹æ®ä½ çš„æè¿°è‡ªåŠ¨ç”Ÿæˆå®Œæ•´çš„ 6 æ­¥ COT æç¤ºè¯\n          </p>\n        </div>\n\n        <div style="text-align: center; margin: 20px 0; position: relative">\n          <span\n            style="background: #1a1a1a; padding: 0 12px; color: #666; font-size: 12px; position: relative; z-index: 1"\n            >æˆ–æ‰‹åŠ¨é…ç½®</span\n          >\n          <div\n            style="\n              position: absolute;\n              top: 50%;\n              left: 0;\n              right: 0;\n              height: 1px;\n              background: rgba(255, 255, 255, 0.1);\n              z-index: 0;\n            "\n          ></div>\n        </div>\n\n        <div v-if="generatedStructure" class="form-group" style="margin: 15px 0">\n          <label style="display: block; margin-bottom: 8px; color: #ccc; font-size: 13px; font-weight: 500">\n            å˜é‡åˆ†ç±»ï¼ˆç”¨äº STEP 3ï¼Œæ¯è¡Œä¸€ä¸ªåˆ†ç±»ï¼‰ï¼š\n          </label>\n          <textarea\n            v-model="variableCategories"\n            placeholder="ä¾‹å¦‚ï¼š&#10;åŸºç¡€ä¿¡æ¯ - 3 fields&#10;äººç‰©å…³ç³» - 2 fields&#10;é‡è¦è®°å¿† - 1 field"\n            rows="4"\n            style="\n              width: 100%;\n              padding: 12px;\n              background: #2a2a2a;\n              border: 1px solid #3a3a3a;\n              border-radius: 6px;\n              color: #e0e0e0;\n              font-size: 13px;\n              resize: vertical;\n              font-family: \'Courier New\', monospace;\n              line-height: 1.5;\n              transition: all 0.2s ease;\n            "\n            @focus="(e: any) => (e.target.style.borderColor = \'#fbbf24\')"\n            @blur="(e: any) => (e.target.style.borderColor = \'#3a3a3a\')"\n          ></textarea>\n          <p style="color: #888; font-size: 11px; margin: 6px 0 0 0">ğŸ’¡ AI ä¼šåœ¨ STEP 3 ä¸­æŒ‰ç…§è¿™äº›åˆ†ç±»é€ä¸ªæ£€æŸ¥å˜é‡</p>\n        </div>\n\n        <button\n          class="generate-btn"\n          style="\n            margin-top: 10px;\n            padding: 12px 24px;\n            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);\n            border: none;\n            border-radius: 8px;\n            color: white;\n            font-size: 13px;\n            font-weight: 600;\n            cursor: pointer;\n            transition: all 0.3s ease;\n            box-shadow: 0 3px 12px rgba(102, 126, 234, 0.3);\n            position: relative;\n            overflow: hidden;\n          "\n          @click="generatePrompt"\n          @mouseenter="\n            (e: any) => {\n              e.currentTarget.style.transform = \'translateY(-2px)\';\n              e.currentTarget.style.boxShadow = \'0 6px 20px rgba(102, 126, 234, 0.4)\';\n            }\n          "\n          @mouseleave="\n            (e: any) => {\n              e.currentTarget.style.transform = \'translateY(0)\';\n              e.currentTarget.style.boxShadow = \'0 3px 12px rgba(102, 126, 234, 0.3)\';\n            }\n          "\n        >\n          <div\n            style="\n              position: absolute;\n              top: 0;\n              left: -100%;\n              width: 100%;\n              height: 100%;\n              background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);\n              transition: left 0.5s;\n            "\n            class="shimmer-effect"\n          ></div>\n          <i class="fa-solid fa-magic" style="font-size: 14px; margin-right: 6px; position: relative; z-index: 1"></i>\n          <span style="position: relative; z-index: 1">ç”Ÿæˆ COT æç¤ºè¯</span>\n        </button>\n\n        <div v-if="generatedPrompt" class="output-section">\n          <h4 style="color: #fbbf24; font-size: 14px; margin-bottom: 10px">ç”Ÿæˆçš„ COT æç¤ºè¯ï¼š</h4>\n          <div class="code-output">\n            <pre>{{ generatedPrompt }}</pre>\n            <button class="copy-btn-abs" @click="copyPrompt">\n              <i class="fa-solid fa-copy"></i>\n            </button>\n          </div>\n        </div>\n      </div>\n    </div>\n  </div>\n\n  \x3c!-- AI ä¿®æ”¹å¯¹è¯æ¡† - ç»“æ„ --\x3e\n  <AIModifyDialog\n    :show="showStructureModifyDialog"\n    :is-modifying="isModifyingStructure"\n    title="AI ä¿®æ”¹ [InitVar] ç»“æ„"\n    description="å‘Šè¯‰ AI ä½ æƒ³å¦‚ä½•ä¿®æ”¹å½“å‰çš„ MVU ç»“æ„"\n    :examples="[\n      \'å¢åŠ ä¸€ä¸ªã€å¥åº·å€¼ã€‘å­—æ®µï¼Œç±»å‹ä¸º number\',\n      \'åˆ é™¤ã€èƒŒåŒ…ã€‘å­—æ®µ\',\n      \'å°†ã€å¥½æ„Ÿåº¦ã€‘çš„æè¿°æ”¹ä¸ºæ›´è¯¦ç»†çš„è¯´æ˜\',\n      \'è°ƒæ•´å­—æ®µé¡ºåºï¼ŒæŠŠã€æ—¶é—´ã€‘æ”¾åˆ°æœ€å‰é¢\',\n    ]"\n    @close="showStructureModifyDialog = false"\n    @confirm="modifyStructureWithAI"\n  />\n\n  \x3c!-- AI ä¿®æ”¹å¯¹è¯æ¡† - æç¤ºè¯ --\x3e\n  <AIModifyDialog\n    :show="showPromptModifyDialog"\n    :is-modifying="isModifyingPrompt"\n    title="AI ä¿®æ”¹ COT æç¤ºè¯"\n    description="å‘Šè¯‰ AI ä½ æƒ³å¦‚ä½•ä¿®æ”¹å½“å‰çš„æç¤ºè¯"\n    :examples="[\n      \'åœ¨ STEP 2 ä¸­æ·»åŠ å¯¹åœºæ™¯å˜åŒ–çš„æ£€æŸ¥\',\n      \'å¼ºè°ƒæ—¶é—´å¿…é¡»ç²¾ç¡®åˆ°åˆ†é’Ÿ\',\n      \'å¢åŠ å¯¹ç‰¹æ®ŠçŠ¶æ€çš„å¤„ç†è¯´æ˜\',\n      \'ç®€åŒ– STEP 3 çš„åˆ†ææ­¥éª¤\',\n    ]"\n    @close="showPromptModifyDialog = false"\n    @confirm="modifyPromptWithAI"\n  />\n</template>\n\n<script setup lang="ts">\nimport { storeToRefs } from \'pinia\';\nimport { onMounted, ref, watch } from \'vue\';\nimport { normalizeApiEndpoint, useSettingsStore } from \'../settings\';\nimport { getScriptIdSafe } from \'../utils\';\nimport AIModifyDialog from \'./AIModifyDialog.vue\';\n\nconst settingsStore = useSettingsStore();\nconst { settings } = storeToRefs(settingsStore);\n\nconst expanded = ref({\n  structure: true,\n  prompt: false,\n});\n\nfunction toggleExpanded(key: keyof typeof expanded.value) {\n  expanded.value[key] = !expanded.value[key];\n}\n\n// AIç”Ÿæˆç›¸å…³\nconst aiStructurePrompt = ref(\'\');\nconst isGeneratingAI = ref(false);\nconst aiPromptDescription = ref(\'\');\nconst isGeneratingPrompt = ref(false);\n\n// åŸå§‹è¾“å…¥ï¼ˆç”¨äºå¢é‡ä¿®æ”¹ï¼‰\nconst originalStructurePrompt = ref(\'\');\nconst originalPromptDescription = ref(\'\');\n\n// ä¿®æ”¹å¯¹è¯æ¡†çŠ¶æ€\nconst showStructureModifyDialog = ref(false);\nconst isModifyingStructure = ref(false);\nconst showPromptModifyDialog = ref(false);\nconst isModifyingPrompt = ref(false);\n\n// è¡¨å•æ•°æ®\nconst varName = ref(\'\');\nconst subFields = ref(\'\');\nconst generatedStructure = ref(\'\');\nconst variableCategories = ref(\'\');\nconst generatedPrompt = ref(\'\');\n\nfunction copyToClipboard(text: string) {\n  navigator.clipboard.writeText(text).then(() => {\n    window.toastr.success(\'å·²å¤åˆ¶åˆ°å‰ªè´´æ¿\');\n  });\n}\n\nfunction generateStructure() {\n  if (!varName.value.trim()) {\n    window.toastr.error(\'è¯·è¾“å…¥å˜é‡åç§°\');\n    return;\n  }\n\n  const result: any = {\n    $meta: {\n      extensible: false,\n      strictSet: true,\n    },\n  };\n\n  result[varName.value] = parseSubFields();\n  generatedStructure.value = JSON.stringify(result, null, 2);\n}\n\nfunction parseSubFields(): any {\n  const lines = subFields.value.split(\'\\n\').filter(l => l.trim());\n  const obj: any = {};\n\n  lines.forEach(line => {\n    const parts = line.split(\':\').map(s => s.trim());\n    const name = parts[0];\n    const type = parts[1] || \'string\';\n    const desc = parts[2] || \'æè¿°...\';\n\n    if (!name) return;\n\n    if (type === \'number\') {\n      obj[name] = [0, desc];\n    } else if (type === \'string\') {\n      obj[name] = [\'\', desc];\n    } else if (type === \'array\') {\n      obj[name] = [[], desc];\n    } else if (type === \'object\') {\n      obj[name] = [{}, desc];\n    } else {\n      obj[name] = [null, desc];\n    }\n  });\n\n  return obj;\n}\n\nfunction copyGenerated() {\n  copyToClipboard(generatedStructure.value);\n}\n\n// AIæ™ºèƒ½ç”Ÿæˆç»“æ„\nasync function handleAIGenerateStructure() {\n  if (!aiStructurePrompt.value.trim()) {\n    window.toastr.error(\'è¯·è¾“å…¥éœ€æ±‚æè¿°\');\n    return;\n  }\n\n  if (!settings.value.api_endpoint || !settings.value.api_key) {\n    window.toastr.error(\'è¯·å…ˆåœ¨è®¾ç½®é¡µé¢é…ç½® API ç«¯ç‚¹å’Œ API Key\');\n    return;\n  }\n\n  // ä¿å­˜åŸå§‹è¾“å…¥ï¼ˆç”¨äºå¢é‡ä¿®æ”¹ï¼‰\n  originalStructurePrompt.value = aiStructurePrompt.value;\n\n  isGeneratingAI.value = true;\n\n  try {\n    const systemPrompt = `ä½ æ˜¯ MVU Beta ä¸“å®¶ã€‚ç”Ÿæˆ [InitVar] JSONã€‚\n\nè§„åˆ™ï¼š\n1. ä¸åŒ…å« "stat_data" æ ¹èŠ‚ç‚¹\n2. æ‰€æœ‰å­—æ®µ: [å€¼, "æè¿°"]\n3. $meta åœ¨æ ¹çº§åˆ«\n4. å­—ç¬¦ä¸²åœ¨ä¸€è¡Œå†…\n5. æè¿°ç®€çŸ­ï¼ˆ20å­—å†…ï¼‰\n\næ ¼å¼ï¼š\n{\n  "$meta": {"extensible": false, "strictSet": true},\n  "å˜é‡å": {\n    "å­—æ®µ": [é»˜è®¤å€¼, "ç®€çŸ­æè¿°"]\n  }\n}\n\nåªè¾“å‡º JSONã€‚`;\n\n    const apiUrl = normalizeApiEndpoint(settings.value.api_endpoint);\n    const response = await fetch(apiUrl, {\n      method: \'POST\',\n      headers: {\n        \'Content-Type\': \'application/json\',\n        Authorization: `Bearer ${settings.value.api_key}`,\n      },\n      body: JSON.stringify({\n        model: settings.value.model,\n        messages: [\n          { role: \'system\', content: systemPrompt },\n          { role: \'user\', content: `éœ€æ±‚ï¼š${aiStructurePrompt.value}\\n\\nè¯·ç”Ÿæˆ [InitVar] JSONã€‚` },\n        ],\n        temperature: settings.value.temperature || 0.7,\n        max_tokens: settings.value.max_tokens || 4000,\n      }),\n    });\n\n    // å…ˆè¯»å–å“åº”æ–‡æœ¬\n    const responseText = await response.text();\n\n    if (!response.ok) {\n      // å°è¯•è§£æé”™è¯¯ä¿¡æ¯\n      let errorMessage = `API é”™è¯¯: ${response.status}`;\n      try {\n        const errorData = JSON.parse(responseText);\n        if (errorData.error) {\n          errorMessage = `${errorMessage} - ${errorData.error.message || JSON.stringify(errorData.error)}`;\n        } else if (errorData.message) {\n          errorMessage = `${errorMessage} - ${errorData.message}`;\n        } else {\n          errorMessage = `${errorMessage} - ${JSON.stringify(errorData)}`;\n        }\n      } catch (e) {\n        errorMessage = `${errorMessage} - ${responseText.slice(0, 200)}`;\n      }\n      console.error(\'API è¯·æ±‚å¤±è´¥:\', errorMessage);\n      console.error(\'è¯·æ±‚ URL:\', settings.value.api_endpoint);\n      console.error(\n        \'è¯·æ±‚ä½“:\',\n        JSON.stringify(\n          {\n            model: settings.value.model,\n            messages: [\n              { role: \'system\', content: systemPrompt.substring(0, 100) + \'...\' },\n              { role: \'user\', content: `éœ€æ±‚ï¼š${aiStructurePrompt.value.substring(0, 100)}...` },\n            ],\n            temperature: settings.value.temperature || 0.7,\n            max_tokens: settings.value.max_tokens || 4000,\n          },\n          null,\n          2,\n        ),\n      );\n      throw new Error(errorMessage);\n    }\n\n    // è§£ææˆåŠŸå“åº”\n    const data = JSON.parse(responseText);\n    // å°è¯•ä»ä¸åŒçš„å“åº”æ ¼å¼ä¸­æå–å†…å®¹\n    let result = \'\';\n    if (data.choices && data.choices[0] && data.choices[0].message) {\n      result = data.choices[0].message.content || \'\';\n    } else if (data.data && data.data.choices && data.data.choices[0]) {\n      // æŸäº› API å¯èƒ½è¿”å› data.data.choices æ ¼å¼\n      result = data.data.choices[0].message?.content || \'\';\n    } else if (data.content) {\n      result = typeof data.content === \'string\' ? data.content : JSON.stringify(data.content);\n    }\n\n    console.log(\'AI è¿”å›å†…å®¹:\', result);\n\n    // æå– JSON\n    let jsonText = result;\n\n    // ç§»é™¤ä»£ç å—æ ‡è®°\n    jsonText = jsonText.replace(/```json\\s*/gi, \'\').replace(/```\\s*$/g, \'\');\n\n    // æå–ç¬¬ä¸€ä¸ª JSON å¯¹è±¡ï¼ˆå¯èƒ½ä¸å®Œæ•´ï¼‰\n    const jsonMatch = jsonText.match(/\\{[\\s\\S]*$/);\n    if (!jsonMatch) {\n      throw new Error(\'æœªæ‰¾åˆ° JSON å¯¹è±¡\');\n    }\n\n    jsonText = jsonMatch[0];\n\n    // å°è¯•è¡¥å…¨ä¸å®Œæ•´çš„ JSON\n    let bracketCount = 0;\n    let inString = false;\n    let escapeNext = false;\n    let lastValidPos = jsonText.length;\n\n    for (let i = 0; i < jsonText.length; i++) {\n      const char = jsonText[i];\n\n      if (escapeNext) {\n        escapeNext = false;\n        continue;\n      }\n\n      if (char === \'\\\\\') {\n        escapeNext = true;\n        continue;\n      }\n\n      if (char === \'"\' && !inString) {\n        inString = true;\n        continue;\n      } else if (char === \'"\' && inString) {\n        inString = false;\n        continue;\n      }\n\n      if (inString) continue;\n\n      if (char === \'{\') bracketCount++;\n      else if (char === \'}\') bracketCount--;\n\n      if (bracketCount === 0) {\n        lastValidPos = i + 1;\n        break;\n      }\n    }\n\n    jsonText = jsonText.substring(0, lastValidPos);\n\n    // å¦‚æœæ‹¬å·ä¸åŒ¹é…ï¼Œå°è¯•è¡¥å…¨\n    if (bracketCount > 0) {\n      console.warn(`JSON ä¸å®Œæ•´ï¼Œç¼ºå°‘ ${bracketCount} ä¸ªé—­åˆæ‹¬å·ï¼Œå°è¯•è¡¥å…¨...`);\n      jsonText += \'}\'.repeat(bracketCount);\n    }\n\n    // æ¸…ç† JSON\n    // ç§»é™¤å°¾éšé€—å·\n    jsonText = jsonText.replace(/,(\\s*[}\\]])/g, \'$1\');\n    // ç§»é™¤æ³¨é‡Š\n    jsonText = jsonText.replace(/\\/\\/[^\\n]*/g, \'\');\n    jsonText = jsonText.replace(/\\/\\*[\\s\\S]*?\\*\\//g, \'\');\n\n    let parsed;\n    try {\n      parsed = JSON.parse(jsonText);\n    } catch (e) {\n      console.error(\'JSON è§£æå¤±è´¥ï¼ŒåŸå§‹å†…å®¹:\', jsonText);\n      throw new Error(`JSON è§£æå¤±è´¥: ${(e as Error).message}ã€‚è¯·è®© AI è¾“å‡ºæ­£ç¡®çš„ JSONï¼ˆå­—ç¬¦ä¸²åœ¨ä¸€è¡Œå†…ï¼Œæ— å°¾éšé€—å·ï¼‰`);\n    }\n    const varNameParsed = Object.keys(parsed).find(k => k !== \'$meta\') || \'myVar\';\n    varName.value = varNameParsed;\n\n    const varData = parsed[varNameParsed] || {};\n    const fields: string[] = [];\n\n    for (const key in varData) {\n      if (key === \'$meta\') continue;\n      const value = varData[key];\n      if (Array.isArray(value) && value.length === 2) {\n        const val = value[0];\n        const type =\n          typeof val === \'number\'\n            ? \'number\'\n            : typeof val === \'string\'\n              ? \'string\'\n              : Array.isArray(val)\n                ? \'array\'\n                : \'object\';\n        const desc = value[1] || \'æè¿°...\';\n        fields.push(`${key}:${type}:${desc}`);\n      }\n    }\n\n    subFields.value = fields.join(\'\\n\');\n    generatedStructure.value = JSON.stringify(parsed, null, 2);\n    window.toastr.success(\'AI ç”ŸæˆæˆåŠŸï¼\');\n  } catch (error: any) {\n    console.error(\'AIç”Ÿæˆå¤±è´¥:\', error);\n    window.toastr.error(`AIç”Ÿæˆå¤±è´¥: ${error.message}`);\n  } finally {\n    isGeneratingAI.value = false;\n  }\n}\n\nfunction autoGeneratePrompt() {\n  if (!generatedStructure.value) {\n    window.toastr.error(\'è¯·å…ˆç”Ÿæˆ [InitVar] ç»“æ„\');\n    return;\n  }\n\n  try {\n    const structure = JSON.parse(generatedStructure.value);\n    const varNameParsed = Object.keys(structure).find(k => k !== \'$meta\') || \'myVar\';\n\n    const varData = structure[varNameParsed] || {};\n    let fieldCount = 0;\n\n    for (const key in varData) {\n      if (key === \'$meta\') continue;\n      fieldCount++;\n    }\n\n    variableCategories.value = `${varNameParsed} - ${fieldCount} fields`;\n    expanded.value.prompt = true;\n    generatePrompt();\n    window.toastr.success(\'å·²åŸºäºç»“æ„è‡ªåŠ¨ç”Ÿæˆ COT æç¤ºè¯\');\n\n    setTimeout(() => {\n      const promptSection = document.querySelector(\'.tool-section:nth-child(2)\');\n      promptSection?.scrollIntoView({ behavior: \'smooth\', block: \'nearest\' });\n    }, 100);\n  } catch (error: any) {\n    console.error(\'ç”Ÿæˆæç¤ºè¯å¤±è´¥:\', error);\n    window.toastr.error(\'ç”Ÿæˆå¤±è´¥ï¼Œè¯·æ£€æŸ¥å˜é‡ç»“æ„æ ¼å¼\');\n  }\n}\n\nfunction generatePrompt() {\n  const categories = variableCategories.value.trim() || \'å˜é‡åˆ†ç±» - X fields\';\n\n  const promptTemplate = `<%_ setLocalVar(\'initialized_lorebooks.-YourLorebook[0]\', true); _%>\nã€å˜é‡æ›´æ–°ã€‘\nåœ¨æ‰€æœ‰æ–‡æœ¬çš„æœ€åï¼Œè¿›è¡Œå˜é‡æ›´æ–°ã€‚\n\nä»¥ä¸‹æ˜¯æ•…äº‹ä¸­éœ€è¦è¿½è¸ªçš„å…³é”®å˜é‡ï¼Œå½“å‰çŠ¶æ€ä»¥è¿™äº›å˜é‡çš„å€¼ä¸ºå‡†ã€‚\n\n<status_current_variables>\n{{get_message_variable::stat_data}}\n</status_current_variables>\n\nä¸¥æ ¼æŒ‰ç…§ä»¥ä¸‹è§„åˆ™å’Œæ ¼å¼è¿›è¡Œè¾“å‡ºï¼Œå¹¶ç¡®å®šæ¯ä¸€ä¸ªå˜é‡æ˜¯å¦éœ€è¦æ›´æ–°ï¼Œä¸è¦é—æ¼ï¼š\n\nrule:\n  description:\n    - Output update analysis at the end of response\n    - Variable updates are omitted in context but you must still add them\n    - **CRITICAL**: For MVU format [value, description], ALWAYS use [0] suffix to access the value part\n    - 4 commands available: \\\\\\`_.set\\\\\\` (2-3 args), \\\\\\`_.insert\\\\\\` (2-3 args), \\\\\\`_.remove\\\\\\` (1-2 args), \\\\\\`_.add\\\\\\` (2 args)\n    - **RECOMMENDED**: Use \\\\\\`_.insert\\\\\\` instead of \\\\\\`_.assign\\\\\\`\n    - strictSet enabled: [0] suffix is mandatory for all value access\n\n  command_usage:\n    - \\\\\\`_.set(\'path[0]\', old?, new);//reason\\\\\\` - Replace value\n    - \\\\\\`_.add(\'path[0]\', delta);//reason\\\\\\` - Add/subtract numbers only\n    - \\\\\\`_.insert(\'path[0]\', value);//reason\\\\\\` - Add to array end\n    - \\\\\\`_.insert(\'path[0]\', index, value);//reason\\\\\\` - Insert to array at position\n    - \\\\\\`_.insert(\'path\', key, value);//reason\\\\\\` - Add key-value to object\n    - \\\\\\`_.remove(\'path[0]\', value);//reason\\\\\\` - Remove from array/object\n\n  analysis:\n    You MUST follow this Chain-of-Thought (COT) analysis process step by step:\n\n    **STEP 1: Scene Analysis (50 words max, IN ENGLISH)**\n    - Identify current scene/stage/phase\n    - Describe what happened\n    - Determine what changes occurred (time/location/status/progress)\n\n    **STEP 2: Time & Key Status Check**\n    - Extract current time/status from story context\n    - Read key variables from <status_current_variables>\n    - Calculate changes\n    - Decision: What needs to be updated?\n\n    **STEP 3: Systematic Variable Review (check EVERY variable category)**\n    Go through each variable category systematically and mark Y or N:\n\n    ${categories}:\n      - å˜é‡1[0]: [Y/N] - explain\n      - å˜é‡2[0]: [Y/N] - explain\n\n    **STEP 4: Command Selection**\n    For each variable marked Y, determine which command to use\n\n    **STEP 5: Analyze Other Variable Systems**\n    - stat_data detailed COT: COMPLETED\n    - Other variable groups? [YES/NO]\n\n    **STEP 6: Final Validation Checklist**\n    - All [0] suffixes present? [YES/NO]\n    - All Y variables have corresponding commands? [YES/NO]\n    - All commands have clear Chinese comments? [YES/NO]\n\n  format: |-\n    <UpdateVariable>\n        <ThinkingProcess>\n            **STEP 1: Scene Analysis**\n            [50 words]\n\n            **STEP 2: Time & Key Status Check**\n            - Current status: ...\n            - Stored variable[0]: ...\n            - Changes: ...\n            - Update decision: ...\n\n            **STEP 3: Variable Review (stat_data)**\n            [List categories with Y/N]\n\n            **STEP 4: Command Selection**\n            [For each Y variable, state which command]\n\n            **STEP 5: Other Systems**\n            - stat_data COT: COMPLETED\n            - Other groups? NO\n\n            **STEP 6: Final Check**\n            - [0] suffixes? YES\n            - All Y have commands? YES\n            - Chinese comments? YES\n        </ThinkingProcess>\n\n        _.set(\'path[0]\', old?, new);//reason\n        _.add(\'path[0]\', delta);//reason\n        _.insert(\'path[0]\', value);//reason\n        _.remove(\'path[0]\', value);//reason\n    </UpdateVariable>\n\n  example: |-\n    <UpdateVariable>\n        <ThinkingProcess>\n            **STEP 1: Scene Analysis**\n            User and character had conversation at library. User helped find a book. Time advanced from 10:00 to 10:30. Character\'s impression improved.\n\n            **STEP 2: Time & Key Status Check**\n            - Current time: 10:30\n            - Stored æ—¶é—´[0]: "10:00"\n            - Time passed: 30 minutes\n            - Update decision: Time, Favor\n\n            **STEP 3: Variable Review (stat_data)**\n            åŸºç¡€ä¿¡æ¯ - 3 fields:\n              - æ—¶é—´[0]: Y - Time advanced\n              - æ—¥æœŸ[0]: N - Same day\n              - å½“å‰ä½ç½®[0]: N - Still at library\n\n            äººç‰©å…³ç³» - 1 field:\n              - å¥½æ„Ÿåº¦[0]: Y - Positive interaction\n\n            **STEP 4: Command Selection**\n            - æ—¶é—´: use _.set\n            - å¥½æ„Ÿåº¦: use _.add\n\n            **STEP 5: Other Systems**\n            - stat_data COT: COMPLETED\n            - Other groups? NO\n\n            **STEP 6: Final Check**\n            - [0] suffixes? YES\n            - All Y have commands? YES\n            - Chinese comments? YES\n        </ThinkingProcess>\n\n        _.set(\'æ—¶é—´[0]\', \'10:00\', \'10:30\');//æ—¶é—´æ¨è¿›30åˆ†é’Ÿ\n        _.add(\'è§’è‰².å¥½æ„Ÿåº¦[0]\', 3);//æ„‰å¿«çš„äº¤æµï¼Œå¥½æ„Ÿåº¦å°å¹…æå‡\n    </UpdateVariable>\n\n  specific_rules:\n    - æ—¶é—´æ¨è¿›ï¼šæ¯æ¬¡äº’åŠ¨åæ›´æ–°å…·ä½“æ—¶é—´ï¼Œä½¿ç”¨ _.set æ›´æ–°\n    - çŠ¶æ€åˆ‡æ¢ï¼šå½“çŠ¶æ€/é˜¶æ®µåˆ‡æ¢æ—¶ï¼Œå¿…é¡»æ›´æ–°å¯¹åº”çš„çŠ¶æ€å˜é‡\n    - è®¡æ•°å™¨ï¼šä½¿ç”¨ _.add å¢åŠ æˆ–å‡å°‘è®¡æ•°\n    - æ•°ç»„æ“ä½œï¼šæ·»åŠ å…ƒç´ å¿…é¡»ç”¨ _.insertï¼Œåˆ é™¤å…ƒç´ å¿…é¡»ç”¨ _.remove\n    - [0]åç¼€ï¼šæ‰€æœ‰å˜é‡è®¿é—®éƒ½å¿…é¡»åŠ [0]åç¼€\n    - æ‰©å±•æ•°ç»„ï¼šå¸¦æœ‰ $__META_EXTENSIBLE__$ æ ‡è®°çš„æ•°ç»„ä½¿ç”¨ _.insert æ·»åŠ å…ƒç´ \n    - å¯¹è±¡æ·»åŠ é”®å€¼ï¼šä½¿ç”¨ _.insert(\'è·¯å¾„\', é”®å, å€¼) å‘å¯¹è±¡æ·»åŠ æ–°çš„é”®å€¼å¯¹`;\n\n  generatedPrompt.value = promptTemplate;\n}\n\nfunction copyPrompt() {\n  copyToClipboard(generatedPrompt.value);\n}\n\n// AIæ™ºèƒ½ç”Ÿæˆæç¤ºè¯\nasync function handleAIGeneratePrompt() {\n  if (!aiPromptDescription.value.trim()) {\n    window.toastr.error(\'è¯·è¾“å…¥åœºæ™¯æè¿°\');\n    return;\n  }\n\n  if (!settings.value.api_endpoint || !settings.value.api_key) {\n    window.toastr.error(\'è¯·å…ˆåœ¨è®¾ç½®é¡µé¢é…ç½® API ç«¯ç‚¹å’Œ API Key\');\n    return;\n  }\n\n  // ä¿å­˜åŸå§‹è¾“å…¥ï¼ˆç”¨äºå¢é‡ä¿®æ”¹ï¼‰\n  originalPromptDescription.value = aiPromptDescription.value;\n\n  isGeneratingPrompt.value = true;\n\n  try {\n    const systemPrompt = `ä½ æ˜¯ MVU Beta COT æç¤ºè¯ä¸“å®¶ã€‚ç”Ÿæˆå®Œæ•´çš„ 6 æ­¥æ€ç»´é“¾æç¤ºè¯ã€‚\n\n## è¦æ±‚ï¼š\n1. åŒ…å« {{get_message_variable::stat_data}}\n2. ä½¿ç”¨ _.insert è€Œé _.assign\n3. æ‰€æœ‰è·¯å¾„ä½¿ç”¨ [0] åç¼€\n4. 6 æ­¥ COT æµç¨‹å®Œæ•´\n\nç›´æ¥è¾“å‡º EJS æ ¼å¼çš„æç¤ºè¯å†…å®¹ã€‚`;\n\n    const apiUrl = normalizeApiEndpoint(settings.value.api_endpoint);\n    const response = await fetch(apiUrl, {\n      method: \'POST\',\n      headers: {\n        \'Content-Type\': \'application/json\',\n        Authorization: `Bearer ${settings.value.api_key}`,\n      },\n      body: JSON.stringify({\n        model: settings.value.model,\n        messages: [\n          { role: \'system\', content: systemPrompt },\n          { role: \'user\', content: `åœºæ™¯ï¼š${aiPromptDescription.value}\\n\\nè¯·ç”Ÿæˆ COT æç¤ºè¯ã€‚` },\n        ],\n        temperature: settings.value.temperature || 0.7,\n        max_tokens: settings.value.max_tokens || 3000,\n      }),\n    });\n\n    // å…ˆè¯»å–å“åº”æ–‡æœ¬\n    const responseText2 = await response.text();\n\n    if (!response.ok) {\n      // å°è¯•è§£æé”™è¯¯ä¿¡æ¯\n      let errorMessage = `API é”™è¯¯: ${response.status}`;\n      try {\n        const errorData = JSON.parse(responseText2);\n        if (errorData.error) {\n          errorMessage = `${errorMessage} - ${errorData.error.message || JSON.stringify(errorData.error)}`;\n        } else if (errorData.message) {\n          errorMessage = `${errorMessage} - ${errorData.message}`;\n        } else {\n          errorMessage = `${errorMessage} - ${JSON.stringify(errorData)}`;\n        }\n      } catch (e) {\n        errorMessage = `${errorMessage} - ${responseText2.slice(0, 200)}`;\n      }\n      console.error(\'API è¯·æ±‚å¤±è´¥:\', errorMessage);\n      console.error(\'è¯·æ±‚ URL:\', settings.value.api_endpoint);\n      console.error(\n        \'è¯·æ±‚ä½“:\',\n        JSON.stringify(\n          {\n            model: settings.value.model,\n            messages: [\n              { role: \'system\', content: systemPrompt.substring(0, 100) + \'...\' },\n              { role: \'user\', content: `åœºæ™¯ï¼š${aiPromptDescription.value.substring(0, 100)}...` },\n            ],\n            temperature: settings.value.temperature || 0.7,\n            max_tokens: settings.value.max_tokens || 3000,\n          },\n          null,\n          2,\n        ),\n      );\n      throw new Error(errorMessage);\n    }\n\n    // è§£ææˆåŠŸå“åº”\n    const data = JSON.parse(responseText2);\n    // å°è¯•ä»ä¸åŒçš„å“åº”æ ¼å¼ä¸­æå–å†…å®¹\n    let result = \'\';\n    if (data.choices && data.choices[0] && data.choices[0].message) {\n      result = data.choices[0].message.content || \'\';\n    } else if (data.data && data.data.choices && data.data.choices[0]) {\n      // æŸäº› API å¯èƒ½è¿”å› data.data.choices æ ¼å¼\n      result = data.data.choices[0].message?.content || \'\';\n    } else if (data.content) {\n      result = typeof data.content === \'string\' ? data.content : JSON.stringify(data.content);\n    }\n\n    generatedPrompt.value = result.trim();\n    window.toastr.success(\'AI ç”ŸæˆæˆåŠŸï¼\');\n  } catch (error: any) {\n    console.error(\'AIç”Ÿæˆå¤±è´¥:\', error);\n    window.toastr.error(`AIç”Ÿæˆå¤±è´¥: ${error.message}`);\n  } finally {\n    isGeneratingPrompt.value = false;\n  }\n}\n\n// AI ä¿®æ”¹ç»“æ„ï¼ˆå¢é‡ä¿®æ”¹ï¼‰\nasync function modifyStructureWithAI(modifyInstruction: string) {\n  if (!originalStructurePrompt.value) {\n    window.toastr.warning(\'è¯·å…ˆç”Ÿæˆç»“æ„\');\n    return;\n  }\n\n  isModifyingStructure.value = true;\n\n  try {\n    window.toastr.info(\'AI æ­£åœ¨ä¿®æ”¹ä¸­...\');\n\n    const systemPrompt = `ä½ æ˜¯ MVU Beta ä¸“å®¶ã€‚æ ¹æ®åŸå§‹éœ€æ±‚å’Œä¿®æ”¹å»ºè®®ï¼Œé‡æ–°ç”Ÿæˆ [InitVar] JSONã€‚\n\nè§„åˆ™ï¼š\n1. ä¸åŒ…å« "stat_data" æ ¹èŠ‚ç‚¹\n2. æ‰€æœ‰å­—æ®µ: [å€¼, "æè¿°"]\n3. $meta åœ¨æ ¹çº§åˆ«\n4. å­—ç¬¦ä¸²åœ¨ä¸€è¡Œå†…\n5. æè¿°ç®€çŸ­ï¼ˆ20å­—å†…ï¼‰\n\nåªè¾“å‡º JSONã€‚`;\n\n    const userPrompt = `# åŸå§‹éœ€æ±‚ï¼š\n${originalStructurePrompt.value}\n\n# ä¿®æ”¹å»ºè®®ï¼š\n${modifyInstruction}\n\nè¯·æ ¹æ®åŸå§‹éœ€æ±‚å’Œä¿®æ”¹å»ºè®®ï¼Œé‡æ–°ç”Ÿæˆ [InitVar] JSONã€‚`;\n\n    const apiUrl = normalizeApiEndpoint(settings.value.api_endpoint);\n    const response = await fetch(apiUrl, {\n      method: \'POST\',\n      headers: {\n        \'Content-Type\': \'application/json\',\n        Authorization: `Bearer ${settings.value.api_key}`,\n      },\n      body: JSON.stringify({\n        model: settings.value.model,\n        messages: [\n          { role: \'system\', content: systemPrompt },\n          { role: \'user\', content: userPrompt },\n        ],\n        temperature: settings.value.temperature || 0.7,\n        max_tokens: settings.value.max_tokens || 4000,\n      }),\n    });\n\n    if (!response.ok) {\n      throw new Error(`API é”™è¯¯: ${response.status}`);\n    }\n\n    const data = await response.json();\n    let result = data.choices?.[0]?.message?.content || \'\';\n\n    // æå– JSON\n    let jsonText = result.replace(/```json\\s*/gi, \'\').replace(/```\\s*$/g, \'\');\n    const jsonMatch = jsonText.match(/\\{[\\s\\S]*$/);\n    if (jsonMatch) {\n      jsonText = jsonMatch[0];\n    }\n\n    // æ¸…ç†å¹¶è§£æ\n    jsonText = jsonText.replace(/,(\\s*[}\\]])/g, \'$1\');\n    const parsed = JSON.parse(jsonText);\n\n    const varNameParsed = Object.keys(parsed).find(k => k !== \'$meta\') || \'myVar\';\n    varName.value = varNameParsed;\n\n    const varData = parsed[varNameParsed] || {};\n    const fields: string[] = [];\n\n    for (const key in varData) {\n      if (key === \'$meta\') continue;\n      const value = varData[key];\n      if (Array.isArray(value) && value.length === 2) {\n        const val = value[0];\n        const type =\n          typeof val === \'number\'\n            ? \'number\'\n            : typeof val === \'string\'\n              ? \'string\'\n              : Array.isArray(val)\n                ? \'array\'\n                : \'object\';\n        const desc = value[1] || \'æè¿°...\';\n        fields.push(`${key}:${type}:${desc}`);\n      }\n    }\n\n    subFields.value = fields.join(\'\\n\');\n    generatedStructure.value = JSON.stringify(parsed, null, 2);\n\n    // æ›´æ–°åŸå§‹è¾“å…¥ï¼ˆç´¯ç§¯ä¿®æ”¹ï¼‰\n    originalStructurePrompt.value += `\\n\\nã€å·²åº”ç”¨çš„ä¿®æ”¹ã€‘ï¼š${modifyInstruction}`;\n\n    window.toastr.success(\'âœ… AI ä¿®æ”¹å®Œæˆï¼\');\n    showStructureModifyDialog.value = false;\n  } catch (error: any) {\n    console.error(\'AI ä¿®æ”¹å¤±è´¥:\', error);\n    window.toastr.error(\'AI ä¿®æ”¹å¤±è´¥: \' + error.message);\n  } finally {\n    isModifyingStructure.value = false;\n  }\n}\n\n// AI ä¿®æ”¹æç¤ºè¯ï¼ˆå¢é‡ä¿®æ”¹ï¼‰\nasync function modifyPromptWithAI(modifyInstruction: string) {\n  if (!originalPromptDescription.value) {\n    window.toastr.warning(\'è¯·å…ˆç”Ÿæˆæç¤ºè¯\');\n    return;\n  }\n\n  isModifyingPrompt.value = true;\n\n  try {\n    window.toastr.info(\'AI æ­£åœ¨ä¿®æ”¹ä¸­...\');\n\n    const systemPrompt = `ä½ æ˜¯ MVU Beta COT æç¤ºè¯ä¸“å®¶ã€‚æ ¹æ®åŸå§‹åœºæ™¯æè¿°å’Œä¿®æ”¹å»ºè®®ï¼Œé‡æ–°ç”Ÿæˆ 6 æ­¥æ€ç»´é“¾æç¤ºè¯ã€‚\n\n## è¦æ±‚ï¼š\n1. åŒ…å« {{get_message_variable::stat_data}}\n2. ä½¿ç”¨ _.insert è€Œé _.assign\n3. æ‰€æœ‰è·¯å¾„ä½¿ç”¨ [0] åç¼€\n4. 6 æ­¥ COT æµç¨‹å®Œæ•´\n\nç›´æ¥è¾“å‡º EJS æ ¼å¼çš„æç¤ºè¯å†…å®¹ã€‚`;\n\n    const userPrompt = `# åŸå§‹åœºæ™¯æè¿°ï¼š\n${originalPromptDescription.value}\n\n# ä¿®æ”¹å»ºè®®ï¼š\n${modifyInstruction}\n\nè¯·æ ¹æ®åŸå§‹åœºæ™¯æè¿°å’Œä¿®æ”¹å»ºè®®ï¼Œé‡æ–°ç”Ÿæˆ COT æç¤ºè¯ã€‚`;\n\n    const apiUrl = normalizeApiEndpoint(settings.value.api_endpoint);\n    const response = await fetch(apiUrl, {\n      method: \'POST\',\n      headers: {\n        \'Content-Type\': \'application/json\',\n        Authorization: `Bearer ${settings.value.api_key}`,\n      },\n      body: JSON.stringify({\n        model: settings.value.model,\n        messages: [\n          { role: \'system\', content: systemPrompt },\n          { role: \'user\', content: userPrompt },\n        ],\n        temperature: settings.value.temperature || 0.7,\n        max_tokens: settings.value.max_tokens || 3000,\n      }),\n    });\n\n    if (!response.ok) {\n      throw new Error(`API é”™è¯¯: ${response.status}`);\n    }\n\n    const data = await response.json();\n    let result = data.choices?.[0]?.message?.content || \'\';\n\n    generatedPrompt.value = result.trim();\n\n    // æ›´æ–°åŸå§‹è¾“å…¥ï¼ˆç´¯ç§¯ä¿®æ”¹ï¼‰\n    originalPromptDescription.value += `\\n\\nã€å·²åº”ç”¨çš„ä¿®æ”¹ã€‘ï¼š${modifyInstruction}`;\n\n    window.toastr.success(\'âœ… AI ä¿®æ”¹å®Œæˆï¼\');\n    showPromptModifyDialog.value = false;\n  } catch (error: any) {\n    console.error(\'AI ä¿®æ”¹å¤±è´¥:\', error);\n    window.toastr.error(\'AI ä¿®æ”¹å¤±è´¥: \' + error.message);\n  } finally {\n    isModifyingPrompt.value = false;\n  }\n}\n\nfunction exportWorldbook() {\n  if (!generatedStructure.value) {\n    window.toastr.error(\'è¯·å…ˆç”Ÿæˆ [InitVar] ç»“æ„\');\n    return;\n  }\n\n  if (!generatedPrompt.value) {\n    autoGeneratePrompt();\n  }\n\n  setTimeout(() => {\n    exportAsWorldbook();\n  }, 100);\n}\n\nfunction exportAsWorldbook() {\n  if (!generatedStructure.value || !generatedPrompt.value) {\n    window.toastr.error(\'è¯·å…ˆç”Ÿæˆ [InitVar] ç»“æ„å’Œ COT æç¤ºè¯\');\n    return;\n  }\n\n  let varNameParsed = \'myVar\';\n  try {\n    const structure = JSON.parse(generatedStructure.value);\n    varNameParsed = Object.keys(structure).find(k => k !== \'$meta\') || \'myVar\';\n  } catch (e) {\n    console.error(\'è§£æå˜é‡åå¤±è´¥:\', e);\n  }\n\n  const worldbookEntries = [\n    {\n      uid: generateUID(),\n      key: [],\n      keysecondary: [],\n      comment: \'[InitVar]\',\n      content: generatedStructure.value,\n      constant: false,\n      vectorized: false,\n      selective: true,\n      selectiveLogic: 0,\n      addMemo: false,\n      order: 100,\n      position: 0,\n      disable: false,\n      excludeRecursion: false,\n      delayUntilRecursion: false,\n      probability: 100,\n      useProbability: true,\n      depth: 4,\n      group: \'\',\n      groupOverride: false,\n      groupWeight: 100,\n      scanDepth: null,\n      caseSensitive: null,\n      matchWholeWords: null,\n      useGroupScoring: false,\n      automationId: \'\',\n      role: 0,\n      sticky: 0,\n      cooldown: 0,\n      delay: 0,\n    },\n    {\n      uid: generateUID(),\n      key: [],\n      keysecondary: [],\n      comment: \'å˜é‡\',\n      content: generatedPrompt.value,\n      constant: true,\n      vectorized: false,\n      selective: false,\n      selectiveLogic: 0,\n      addMemo: false,\n      order: 100,\n      position: 1,\n      disable: false,\n      excludeRecursion: false,\n      delayUntilRecursion: false,\n      probability: 100,\n      useProbability: true,\n      depth: 0,\n      group: \'\',\n      groupOverride: false,\n      groupWeight: 100,\n      scanDepth: null,\n      caseSensitive: null,\n      matchWholeWords: null,\n      useGroupScoring: false,\n      automationId: \'\',\n      role: 0,\n      sticky: 0,\n      cooldown: 0,\n      delay: 0,\n    },\n  ];\n\n  const jsonStr = JSON.stringify(worldbookEntries, null, 2);\n  const blob = new Blob([jsonStr], { type: \'application/json\' });\n  const url = URL.createObjectURL(blob);\n  const a = document.createElement(\'a\');\n  a.href = url;\n  a.download = `${varNameParsed}_MVU_worldbook.json`;\n  document.body.appendChild(a);\n  a.click();\n  document.body.removeChild(a);\n  URL.revokeObjectURL(url);\n\n  window.toastr.success(`âœ… å·²å¯¼å‡ºä¸–ç•Œä¹¦ JSONï¼š[InitVar] + å˜é‡è§„åˆ™`);\n}\n\nfunction generateUID(): number {\n  return Date.now() + Math.floor(Math.random() * 1000);\n}\n\n// ==================== æ•°æ®æŒä¹…åŒ– ====================\n\n// åŠ è½½ä¿å­˜çš„é…ç½®\nfunction loadSavedData() {\n  try {\n    const scriptId = getScriptIdSafe();\n    if (!scriptId) {\n      console.warn(\'script_id ä¸ºç©ºï¼Œæ— æ³•åŠ è½½ MVU é…ç½®\');\n      return;\n    }\n\n    const scriptVars = getVariables({ type: \'script\', script_id: scriptId });\n    const savedData = scriptVars.mvu_beta_config;\n\n    if (savedData) {\n      if (savedData.varName) varName.value = savedData.varName;\n      if (savedData.subFields) subFields.value = savedData.subFields;\n      if (savedData.generatedStructure) generatedStructure.value = savedData.generatedStructure;\n      if (savedData.variableCategories) variableCategories.value = savedData.variableCategories;\n      if (savedData.generatedPrompt) generatedPrompt.value = savedData.generatedPrompt;\n      console.log(\'âœ… å·²åŠ è½½ä¿å­˜çš„ MVU Beta é…ç½®\');\n    }\n  } catch (error) {\n    console.error(\'åŠ è½½ MVU Beta é…ç½®å¤±è´¥:\', error);\n  }\n}\n\n// ä¿å­˜é…ç½®\nfunction saveData() {\n  try {\n    const scriptId = getScriptIdSafe();\n    if (!scriptId) {\n      console.warn(\'script_id ä¸ºç©ºï¼Œæ— æ³•ä¿å­˜ MVU é…ç½®\');\n      return;\n    }\n\n    insertOrAssignVariables(\n      {\n        mvu_beta_config: {\n          varName: varName.value,\n          subFields: subFields.value,\n          generatedStructure: generatedStructure.value,\n          variableCategories: variableCategories.value,\n          generatedPrompt: generatedPrompt.value,\n        },\n      },\n      { type: \'script\', script_id: scriptId },\n    );\n  } catch (error) {\n    console.error(\'ä¿å­˜ MVU Beta é…ç½®å¤±è´¥:\', error);\n  }\n}\n\n// ç»„ä»¶æŒ‚è½½æ—¶åŠ è½½\nonMounted(() => {\n  loadSavedData();\n});\n\n// ç›‘å¬æ•°æ®å˜åŒ–ï¼Œè‡ªåŠ¨ä¿å­˜ï¼ˆé˜²æŠ–ï¼‰\nlet saveTimer: number | null = null;\nwatch([varName, subFields, generatedStructure, variableCategories, generatedPrompt], () => {\n  if (saveTimer) clearTimeout(saveTimer);\n  saveTimer = window.setTimeout(() => {\n    saveData();\n  }, 1000); // 1ç§’åä¿å­˜\n});\n<\/script>\n\n<style scoped>\n.tool-section {\n  margin-bottom: 20px;\n}\n\n.tool-content {\n  padding: 0 20px 20px 20px;\n}\n\n.form-group {\n  margin-bottom: 15px;\n}\n\n.generate-btn:hover .shimmer-effect {\n  left: 100%;\n}\n\n.output-section {\n  margin-top: 15px;\n  padding-top: 15px;\n  border-top: 1px solid rgba(255, 255, 255, 0.1);\n}\n\n.code-output {\n  background: #1a1a1a;\n  border: 1px solid #3a3a3a;\n  border-radius: 6px;\n  padding: 15px;\n  position: relative;\n  max-height: 400px;\n  overflow-y: auto;\n}\n\n.code-output pre {\n  margin: 0;\n  color: #e0e0e0;\n  font-family: \'Courier New\', monospace;\n  font-size: 12px;\n  white-space: pre-wrap;\n  word-wrap: break-word;\n}\n\n.copy-btn-abs {\n  position: absolute;\n  top: 8px;\n  right: 8px;\n  background: linear-gradient(135deg, rgba(74, 158, 255, 0.2), rgba(102, 126, 234, 0.3));\n  border: 1px solid rgba(74, 158, 255, 0.4);\n  border-radius: 6px;\n  color: #4a9eff;\n  padding: 8px 14px;\n  cursor: pointer;\n  font-size: 12px;\n  font-weight: 600;\n  transition: all 0.3s ease;\n  box-shadow: 0 2px 8px rgba(74, 158, 255, 0.2);\n}\n\n.copy-btn-abs:hover {\n  background: linear-gradient(135deg, rgba(74, 158, 255, 0.35), rgba(102, 126, 234, 0.45));\n  border-color: rgba(74, 158, 255, 0.6);\n  box-shadow: 0 4px 12px rgba(74, 158, 255, 0.35);\n  transform: translateY(-2px);\n  color: #fff;\n}\n</style>\n'],sourceRoot:''}]);const i=s},163:(e,n,t)=>{t.r(n),t.d(n,{default:()=>i});var a=t(790),o=t.n(a),r=t(54),s=t.n(r)()(o());s.push([e.id,'.statusbar-generator[data-v-22fa8ffd]{padding:20px;height:100%;display:flex;flex-direction:column;gap:20px;background:#1a1a1a}\n','',{version:3,sources:['webpack://./src/è®°å¿†_with_worldbook/components/StatusBarGenerator.vue'],names:[],mappings:'AA43FA,sCACE,YAAa,CACb,WAAY,CACZ,YAAa,CACb,qBAAsB,CACtB,QAAS,CACT,kBACF',sourcesContent:['<template>\n  <div class="statusbar-generator">\n    \x3c!-- é¡¶éƒ¨æ“ä½œæ  --\x3e\n    <div\n      class="section-header"\n      style="\n        display: flex;\n        justify-content: space-between;\n        align-items: center;\n        padding: 20px 28px;\n        background: linear-gradient(\n          135deg,\n          rgba(30, 30, 30, 0.95) 0%,\n          rgba(38, 38, 38, 0.9) 50%,\n          rgba(30, 30, 30, 0.95) 100%\n        );\n        backdrop-filter: blur(12px);\n        border-radius: 14px;\n        margin-bottom: 20px;\n        border: 1px solid rgba(255, 255, 255, 0.06);\n        box-shadow:\n          0 3px 12px rgba(0, 0, 0, 0.3),\n          inset 0 1px 0 rgba(255, 255, 255, 0.04),\n          inset 0 -1px 0 rgba(0, 0, 0, 0.2);\n      "\n    >\n      <h3\n        style="\n          margin: 0;\n          color: #fff;\n          font-size: 16px !important;\n          font-weight: 600;\n          display: flex;\n          align-items: center;\n          gap: 12px;\n          letter-spacing: 0.5px;\n          text-shadow: 0 1px 2px rgba(0, 0, 0, 0.5);\n        "\n      >\n        <i class="fa-solid fa-chart-bar" style="color: #4a9eff; font-size: 18px"></i>\n        çŠ¶æ€æ ç”Ÿæˆå™¨\n      </h3>\n      <div style="display: flex; gap: 10px; flex-wrap: wrap">\n        <button\n          style="\n            padding: 8px 16px;\n            background: linear-gradient(135deg, #10b981 0%, #059669 100%);\n            border: none;\n            border-radius: 8px;\n            color: white;\n            font-size: 13px;\n            font-weight: 600;\n            cursor: pointer;\n            transition: all 0.3s ease;\n          "\n          @click="loadTemplate(\'abo\')"\n          @mouseenter="(e: any) => (e.currentTarget.style.transform = \'translateY(-2px)\')"\n          @mouseleave="(e: any) => (e.currentTarget.style.transform = \'translateY(0)\')"\n        >\n          <i class="fa-solid fa-magic" style="margin-right: 6px"></i>\n          å¿«é€ŸåŠ è½½ ABO æ¨¡æ¿\n        </button>\n        <button\n          style="\n            padding: 8px 16px;\n            background: linear-gradient(135deg, #8b5cf6 0%, #7c3aed 100%);\n            border: none;\n            border-radius: 8px;\n            color: white;\n            font-size: 13px;\n            font-weight: 600;\n            cursor: pointer;\n            transition: all 0.3s ease;\n          "\n          @click="showAIDialog"\n          @mouseenter="(e: any) => (e.currentTarget.style.transform = \'translateY(-2px)\')"\n          @mouseleave="(e: any) => (e.currentTarget.style.transform = \'translateY(0)\')"\n        >\n          <i class="fa-solid fa-wand-magic-sparkles" style="margin-right: 6px"></i>\n          AI æ™ºèƒ½ç¼–è¾‘\n        </button>\n        <button\n          style="\n            padding: 8px 16px;\n            background: linear-gradient(135deg, #06b6d4 0%, #0891b2 100%);\n            border: none;\n            border-radius: 8px;\n            color: white;\n            font-size: 13px;\n            font-weight: 600;\n            cursor: pointer;\n            transition: all 0.3s ease;\n          "\n          @click="exportRegex"\n          @mouseenter="(e: any) => (e.currentTarget.style.transform = \'translateY(-2px)\')"\n          @mouseleave="(e: any) => (e.currentTarget.style.transform = \'translateY(0)\')"\n        >\n          <i class="fa-solid fa-download" style="margin-right: 6px"></i>\n          å¯¼å‡ºæ­£åˆ™ JSON\n        </button>\n      </div>\n    </div>\n\n    \x3c!-- ä¸»å†…å®¹åŒºï¼šä¸‰åˆ—å¸ƒå±€ --\x3e\n    <div style="display: grid; grid-template-columns: 280px 1fr 500px; gap: 20px; min-height: 600px">\n      \x3c!-- å·¦ä¾§ï¼šå­—æ®µé…ç½® --\x3e\n      <div\n        style="\n          background: #2a2a2a;\n          border-radius: 12px;\n          padding: 15px;\n          border: 1px solid #3a3a3a;\n          display: flex;\n          flex-direction: column;\n          overflow-y: auto;\n        "\n      >\n        <h4\n          style="\n            margin: 0 0 15px 0;\n            color: #fff;\n            font-size: 14px;\n            font-weight: 600;\n            display: flex;\n            align-items: center;\n            gap: 8px;\n          "\n        >\n          <i class="fa-solid fa-cog" style="color: #4a9eff"></i>\n          å­—æ®µé…ç½®\n        </h4>\n\n        \x3c!-- è§¦å‘æ­£åˆ™ --\x3e\n        <div style="margin-bottom: 15px">\n          <label style="display: block; margin-bottom: 8px; color: #c0c0c0; font-size: 12px; font-weight: 600"\n            >è§¦å‘æ­£åˆ™</label\n          >\n          <input\n            v-model="config.findRegex"\n            type="text"\n            placeholder="<-CHARACTER_STATUS->"\n            style="\n              width: 100%;\n              padding: 8px 12px;\n              background: #1e1e1e;\n              border: 1px solid #3a3a3a;\n              border-radius: 6px;\n              color: #e0e0e0;\n              font-size: 12px;\n            "\n          />\n        </div>\n\n        \x3c!-- å­—æ®µåˆ—è¡¨ --\x3e\n        <div style="flex: 1; display: flex; flex-direction: column; gap: 10px; margin-bottom: 15px">\n          <div\n            v-for="(field, index) in config.fields"\n            :key="index"\n            style="padding: 10px; background: #1e1e1e; border-radius: 6px; border: 1px solid #3a3a3a"\n          >\n            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px">\n              <span style="color: #4a9eff; font-size: 11px; font-weight: 600">å­—æ®µ {{ index + 1 }}</span>\n              <button\n                :disabled="config.fields.length <= 1"\n                :style="{\n                  padding: \'4px 8px\',\n                  background: \'#ef4444\',\n                  border: \'none\',\n                  borderRadius: \'4px\',\n                  color: \'white\',\n                  fontSize: \'10px\',\n                  cursor: \'pointer\',\n                  opacity: config.fields.length <= 1 ? 0.4 : 1,\n                }"\n                @click="removeField(index)"\n              >\n                åˆ é™¤\n              </button>\n            </div>\n            <input\n              v-model="field.name"\n              type="text"\n              placeholder="å­—æ®µåç§°"\n              style="\n                width: 100%;\n                padding: 6px 10px;\n                background: #2a2a2a;\n                border: 1px solid #3a3a3a;\n                border-radius: 4px;\n                color: #e0e0e0;\n                font-size: 11px;\n                margin-bottom: 6px;\n              "\n            />\n            <input\n              v-model="field.label"\n              type="text"\n              placeholder="æ˜¾ç¤ºåç§°"\n              style="\n                width: 100%;\n                padding: 6px 10px;\n                background: #2a2a2a;\n                border: 1px solid #3a3a3a;\n                border-radius: 4px;\n                color: #e0e0e0;\n                font-size: 11px;\n                margin-bottom: 6px;\n              "\n            />\n            <div style="display: flex; gap: 6px; align-items: center">\n              <input\n                v-model="field.icon"\n                type="text"\n                placeholder="å›¾æ ‡ç±»åï¼ˆå¯é€‰ï¼Œå¦‚ï¼šfa-solid fa-userï¼‰"\n                style="\n                  flex: 1;\n                  padding: 6px 10px;\n                  background: #2a2a2a;\n                  border: 1px solid #3a3a3a;\n                  border-radius: 4px;\n                  color: #e0e0e0;\n                  font-size: 11px;\n                  font-family: monospace;\n                "\n              />\n              <button\n                style="\n                  padding: 6px 10px;\n                  background: #3a3a3a;\n                  border: 1px solid #4a4a4a;\n                  border-radius: 4px;\n                  color: #fff;\n                  font-size: 12px;\n                  cursor: pointer;\n                  min-width: 36px;\n                "\n                title="é€‰æ‹©å›¾æ ‡"\n                @click="showIconPicker(index)"\n              >\n                <i v-if="field.icon" :class="field.icon"></i>\n                <i v-else class="fa-solid fa-icons"></i>\n              </button>\n            </div>\n          </div>\n        </div>\n\n        <button\n          style="\n            width: 100%;\n            padding: 8px;\n            background: linear-gradient(135deg, #8b5cf6 0%, #7c3aed 100%);\n            border: none;\n            border-radius: 6px;\n            color: white;\n            font-size: 12px;\n            font-weight: 600;\n            cursor: pointer;\n          "\n          @click="addField"\n        >\n          <i class="fa-solid fa-plus" style="margin-right: 6px"></i>\n          æ·»åŠ å­—æ®µ\n        </button>\n\n        <button\n          style="\n            width: 100%;\n            padding: 8px;\n            margin-top: 10px;\n            background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);\n            border: none;\n            border-radius: 6px;\n            color: white;\n            font-size: 12px;\n            font-weight: 600;\n            cursor: pointer;\n          "\n          @click="showXmlParseDialog"\n        >\n          <i class="fa-solid fa-code" style="margin-right: 6px"></i>\n          AI è§£æ XML ç”Ÿæˆå­—æ®µ\n        </button>\n\n        <button\n          style="\n            width: 100%;\n            padding: 8px;\n            margin-top: 10px;\n            background: linear-gradient(135deg, #10b981 0%, #059669 100%);\n            border: none;\n            border-radius: 6px;\n            color: white;\n            font-size: 12px;\n            font-weight: 600;\n            cursor: pointer;\n          "\n          @click="showAiFieldGeneratorDialog"\n        >\n          <i class="fa-solid fa-wand-magic-sparkles" style="margin-right: 6px"></i>\n          AI æ™ºèƒ½ç”Ÿæˆå­—æ®µ\n        </button>\n\n        <button\n          style="\n            width: 100%;\n            padding: 8px;\n            margin-top: 10px;\n            background: linear-gradient(135deg, #10b981 0%, #059669 100%);\n            border: none;\n            border-radius: 6px;\n            color: white;\n            font-size: 12px;\n            font-weight: 600;\n            cursor: pointer;\n          "\n          @click="generateFromFields"\n        >\n          <i class="fa-solid fa-sparkles" style="margin-right: 6px"></i>\n          æ ¹æ®å­—æ®µç”Ÿæˆæ¨¡æ¿\n        </button>\n      </div>\n\n      \x3c!-- ä¸­é—´ï¼šä»£ç ç¼–è¾‘å™¨ --\x3e\n      <div\n        style="\n          background: #2a2a2a;\n          border-radius: 12px;\n          padding: 15px;\n          border: 1px solid #3a3a3a;\n          display: flex;\n          flex-direction: column;\n        "\n      >\n        \x3c!-- æ–‡ä»¶æ ‡ç­¾ --\x3e\n        <div\n          style="display: flex; gap: 8px; margin-bottom: 12px; border-bottom: 1px solid #3a3a3a; padding-bottom: 8px"\n        >\n          <div\n            v-for="file in files"\n            :key="file.path"\n            :style="{\n              padding: \'6px 14px\',\n              background: currentFile?.path === file.path ? \'#4a9eff\' : \'#1e1e1e\',\n              color: currentFile?.path === file.path ? \'#fff\' : \'#c0c0c0\',\n              borderRadius: \'6px\',\n              fontSize: \'12px\',\n              fontWeight: \'600\',\n              cursor: \'pointer\',\n              transition: \'all 0.2s ease\',\n            }"\n            @click="currentFile = file"\n          >\n            {{ file.path }}\n          </div>\n        </div>\n\n        \x3c!-- ä»£ç ç¼–è¾‘å™¨ --\x3e\n        <textarea\n          v-if="currentFile"\n          v-model="currentFile.content"\n          style="\n            flex: 1;\n            width: 100%;\n            padding: 12px;\n            background: #1e1e1e;\n            border: 1px solid #3a3a3a;\n            border-radius: 8px;\n            color: #e0e0e0;\n            font-size: 13px;\n            font-family: \'Consolas\', \'Monaco\', monospace;\n            line-height: 1.6;\n            resize: none;\n            min-height: 400px;\n          "\n          @input="updatePreview"\n        ></textarea>\n      </div>\n\n      \x3c!-- å³ä¾§ï¼šé¢„è§ˆå’Œä¸–ç•Œä¹¦ --\x3e\n      <div style="display: flex; flex-direction: column; gap: 15px; overflow-y: auto">\n        \x3c!-- ä¸–ç•Œä¹¦æ¡ç›® --\x3e\n        <div style="background: #2a2a2a; border-radius: 12px; padding: 15px; border: 1px solid #3a3a3a">\n          <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px">\n            <h4\n              style="\n                margin: 0;\n                color: #fff;\n                font-size: 14px;\n                font-weight: 600;\n                display: flex;\n                align-items: center;\n                gap: 8px;\n              "\n            >\n              <i class="fa-solid fa-book" style="color: #4a9eff"></i>\n              ä¸–ç•Œä¹¦æ¡ç›®\n            </h4>\n            <button\n              style="\n                padding: 6px 12px;\n                background: linear-gradient(135deg, #10b981 0%, #059669 100%);\n                border: none;\n                border-radius: 6px;\n                color: white;\n                font-size: 12px;\n                font-weight: 600;\n                cursor: pointer;\n              "\n              @click="copyWorldbook"\n            >\n              <i class="fa-solid fa-copy" style="margin-right: 4px"></i>\n              å¤åˆ¶\n            </button>\n          </div>\n          <div\n            style="\n              background: #1e1e1e;\n              border-radius: 8px;\n              padding: 12px;\n              border: 1px solid #3a3a3a;\n              overflow: auto;\n              max-height: 200px;\n            "\n          >\n            <pre\n              style="\n                margin: 0;\n                color: #e0e0e0;\n                font-size: 11px;\n                line-height: 1.6;\n                white-space: pre-wrap;\n                word-wrap: break-word;\n                font-family: \'Consolas\', \'Monaco\', monospace;\n              "\n              >{{ worldbookContent }}</pre\n            >\n          </div>\n        </div>\n\n        \x3c!-- çŠ¶æ€æ é¢„è§ˆ --\x3e\n        <div style="background: #2a2a2a; border-radius: 12px; padding: 15px; border: 1px solid #3a3a3a; flex: 1">\n          <h4\n            style="\n              margin: 0 0 12px 0;\n              color: #fff;\n              font-size: 14px;\n              font-weight: 600;\n              display: flex;\n              align-items: center;\n              gap: 8px;\n            "\n          >\n            <i class="fa-solid fa-eye" style="color: #4a9eff"></i>\n            å®æ—¶é¢„è§ˆ\n          </h4>\n          <div\n            style="\n              background: #1e1e1e;\n              border-radius: 8px;\n              padding: 20px;\n              min-height: 400px;\n              border: 1px solid #3a3a3a;\n              overflow: auto;\n            "\n            v-html="previewHtml"\n          ></div>\n        </div>\n      </div>\n    </div>\n\n    \x3c!-- å›¾æ ‡é€‰æ‹©å™¨å¯¹è¯æ¡† --\x3e\n    <div\n      v-if="showIconPickerFor !== null"\n      style="\n        position: fixed;\n        top: 0;\n        left: 0;\n        right: 0;\n        bottom: 0;\n        background: rgba(0, 0, 0, 0.8);\n        display: flex;\n        align-items: center;\n        justify-content: center;\n        z-index: 10000;\n      "\n      @click.self="showIconPickerFor = null"\n    >\n      <div\n        style="\n          background: #2a2a2a;\n          border-radius: 12px;\n          padding: 20px;\n          width: 600px;\n          max-width: 90vw;\n          border: 1px solid #3a3a3a;\n        "\n      >\n        <h3 style="margin: 0 0 16px 0; color: #fff; font-size: 15px; font-weight: 600">é€‰æ‹©å›¾æ ‡</h3>\n        <div\n          style="\n            display: grid;\n            grid-template-columns: repeat(8, 1fr);\n            gap: 8px;\n            margin-bottom: 16px;\n            max-height: 400px;\n            overflow-y: auto;\n          "\n        >\n          <div\n            v-for="(iconClass, idx) in iconList"\n            :key="idx"\n            :style="{\n              padding: \'14px\',\n              background: \'#1e1e1e\',\n              borderRadius: \'8px\',\n              cursor: \'pointer\',\n              textAlign: \'center\',\n              border: \'1px solid #3a3a3a\',\n              transition: \'all 0.2s ease\',\n              display: \'flex\',\n              alignItems: \'center\',\n              justifyContent: \'center\',\n            }"\n            :title="iconClass"\n            @click="selectIcon(iconClass)"\n            @mouseenter="\n              (e: any) => {\n                e.currentTarget.style.background = \'#3a3a3a\';\n                e.currentTarget.style.borderColor = \'#4a9eff\';\n                e.currentTarget.style.transform = \'scale(1.1)\';\n                e.currentTarget.style.boxShadow = \'0 4px 12px rgba(74, 158, 255, 0.3)\';\n              }\n            "\n            @mouseleave="\n              (e: any) => {\n                e.currentTarget.style.background = \'#1e1e1e\';\n                e.currentTarget.style.borderColor = \'#3a3a3a\';\n                e.currentTarget.style.transform = \'scale(1)\';\n                e.currentTarget.style.boxShadow = \'none\';\n              }\n            "\n          >\n            <i :class="iconClass" style="font-size: 20px; color: #4a9eff"></i>\n          </div>\n        </div>\n        <div style="display: flex; gap: 10px; justify-content: flex-end">\n          <button\n            style="\n              padding: 8px 16px;\n              background: #3a3a3a;\n              border: none;\n              border-radius: 6px;\n              color: #fff;\n              font-size: 13px;\n              font-weight: 600;\n              cursor: pointer;\n            "\n            @click="showIconPickerFor = null"\n          >\n            å–æ¶ˆ\n          </button>\n          <button\n            style="\n              padding: 8px 16px;\n              background: #ef4444;\n              border: none;\n              border-radius: 6px;\n              color: white;\n              font-size: 13px;\n              font-weight: 600;\n              cursor: pointer;\n            "\n            @click="\n              config.fields[showIconPickerFor!].icon = \'\';\n              showIconPickerFor = null;\n            "\n          >\n            æ¸…é™¤å›¾æ ‡\n          </button>\n        </div>\n      </div>\n    </div>\n\n    \x3c!-- AI ç¼–è¾‘å¯¹è¯æ¡† --\x3e\n    <div\n      v-if="showAI"\n      style="\n        position: fixed;\n        top: 0;\n        left: 0;\n        right: 0;\n        bottom: 0;\n        background: rgba(0, 0, 0, 0.8);\n        display: flex;\n        align-items: center;\n        justify-content: center;\n        z-index: 10000;\n      "\n      @click.self="showAI = false"\n    >\n      <div\n        style="\n          background: #2a2a2a;\n          border-radius: 12px;\n          padding: 24px;\n          width: 600px;\n          max-width: 90vw;\n          max-height: 90vh;\n          overflow-y: auto;\n          border: 1px solid #3a3a3a;\n        "\n      >\n        <h3 style="margin: 0 0 16px 0; color: #fff; font-size: 16px; font-weight: 600">AI æ™ºèƒ½ç¼–è¾‘</h3>\n\n        \x3c!-- å­—æ®µé…ç½®åŒºåŸŸï¼ˆå¯ç¼–è¾‘ï¼‰ --\x3e\n        <div\n          style="\n            background: linear-gradient(135deg, rgba(59, 130, 246, 0.15) 0%, rgba(37, 99, 235, 0.1) 100%);\n            border: 1px solid rgba(59, 130, 246, 0.3);\n            border-radius: 8px;\n            padding: 12px 16px;\n            margin-bottom: 16px;\n          "\n        >\n          <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 10px">\n            <div style="display: flex; align-items: center; gap: 10px">\n              <i class="fa-solid fa-cog" style="color: #60a5fa; font-size: 16px"></i>\n              <div style="color: #93c5fd; font-size: 13px; font-weight: 600">\n                å­—æ®µé…ç½®ï¼ˆå…± {{ config.fields.length }} ä¸ªï¼‰\n              </div>\n            </div>\n            <button\n              style="\n                padding: 4px 10px;\n                background: rgba(16, 185, 129, 0.2);\n                border: 1px solid rgba(16, 185, 129, 0.4);\n                border-radius: 4px;\n                color: #10b981;\n                font-size: 11px;\n                cursor: pointer;\n              "\n              @click="addFieldInDialog"\n            >\n              <i class="fa-solid fa-plus"></i> æ·»åŠ å­—æ®µ\n            </button>\n          </div>\n\n          <div v-if="config.fields.length > 0" style="display: flex; flex-direction: column; gap: 8px">\n            <div\n              v-for="(field, i) in config.fields"\n              :key="i"\n              style="\n                background: rgba(15, 23, 42, 0.6);\n                border: 1px solid rgba(148, 163, 184, 0.15);\n                border-radius: 6px;\n                padding: 8px 10px;\n                display: flex;\n                align-items: center;\n                gap: 8px;\n              "\n            >\n              <span style="color: #60a5fa; font-weight: 600; font-size: 11px; min-width: 50px">å­—æ®µ{{ i + 1 }}:</span>\n              <input\n                v-model="field.label"\n                type="text"\n                placeholder="æ˜¾ç¤ºåç§°"\n                style="\n                  flex: 1;\n                  padding: 4px 8px;\n                  background: #1e1e1e;\n                  border: 1px solid #3a3a3a;\n                  border-radius: 4px;\n                  color: #e0e0e0;\n                  font-size: 11px;\n                "\n              />\n              <input\n                v-model="field.name"\n                type="text"\n                placeholder="å˜é‡å"\n                style="\n                  flex: 1;\n                  padding: 4px 8px;\n                  background: #1e1e1e;\n                  border: 1px solid #3a3a3a;\n                  border-radius: 4px;\n                  color: #e0e0e0;\n                  font-size: 11px;\n                "\n              />\n              <button\n                v-if="field.icon"\n                style="\n                  padding: 4px 8px;\n                  background: rgba(139, 92, 246, 0.2);\n                  border: 1px solid rgba(139, 92, 246, 0.3);\n                  border-radius: 4px;\n                  color: #a78bfa;\n                  font-size: 11px;\n                  cursor: pointer;\n                  min-width: 30px;\n                "\n                title="ç§»é™¤å›¾æ ‡"\n                @click="field.icon = \'\'"\n              >\n                <i :class="field.icon"></i>\n              </button>\n              <button\n                :disabled="config.fields.length <= 1"\n                style="\n                  padding: 4px 8px;\n                  background: rgba(239, 68, 68, 0.2);\n                  border: 1px solid rgba(239, 68, 68, 0.3);\n                  border-radius: 4px;\n                  color: #ef4444;\n                  font-size: 11px;\n                  cursor: pointer;\n                "\n                :style="{\n                  opacity: config.fields.length <= 1 ? 0.4 : 1,\n                  cursor: config.fields.length <= 1 ? \'not-allowed\' : \'pointer\',\n                }"\n                title="åˆ é™¤å­—æ®µ"\n                @click="removeFieldInDialog(i)"\n              >\n                <i class="fa-solid fa-trash"></i>\n              </button>\n            </div>\n          </div>\n          <div v-else style="color: #fbbf24; font-size: 12px; padding: 8px 0">âš ï¸ æš‚æ— å­—æ®µï¼Œè¯·ç‚¹å‡»"æ·»åŠ å­—æ®µ"æŒ‰é’®</div>\n        </div>\n\n        <textarea\n          v-model="aiPrompt"\n          placeholder="æè¿°æ‚¨æƒ³è¦çš„æ ·å¼å’Œæ•ˆæœï¼Œä¾‹å¦‚ï¼š&#10;â€¢ ä¿æŒç°æœ‰æ ·å¼ï¼Œç¾åŒ–çŠ¶æ€æ ç•Œé¢&#10;â€¢ æŠŠèƒŒæ™¯è‰²æ”¹æˆæ·±è“è‰²æ¸å˜&#10;â€¢ æ·»åŠ åŠ¨ç”»æ•ˆæœï¼Œè®©å­—æ®µæ·¡å…¥æ˜¾ç¤º&#10;â€¢ ä½¿ç”¨å¡ç‰‡å¸ƒå±€ï¼Œæ¯ä¸ªå­—æ®µç‹¬ç«‹æ˜¾ç¤º&#10;&#10;âš ï¸ æ³¨æ„ï¼š&#10;â€¢ AI ä¼šåŸºäºä¸Šæ–¹é…ç½®çš„å­—æ®µç”Ÿæˆä»£ç ï¼Œä¸ä¼šæ”¹å˜å­—æ®µæ•°é‡å’Œé¡ºåº&#10;â€¢ ä»£ç ä¼šä½¿ç”¨é€šç”¨æ ¼å¼ï¼Œå¯è¿ç§»åˆ°ä»»ä½•è§’è‰²"\n          style="\n            width: 100%;\n            padding: 12px;\n            background: #1e1e1e;\n            border: 1px solid #3a3a3a;\n            border-radius: 6px;\n            color: #e0e0e0;\n            font-size: 13px;\n            min-height: 120px;\n            margin-bottom: 16px;\n            resize: vertical;\n          "\n        ></textarea>\n        <div style="display: flex; gap: 10px; justify-content: flex-end">\n          <button\n            style="\n              padding: 8px 16px;\n              background: #3a3a3a;\n              border: none;\n              border-radius: 6px;\n              color: #fff;\n              font-size: 13px;\n              font-weight: 600;\n              cursor: pointer;\n            "\n            @click="showAI = false"\n          >\n            å–æ¶ˆ\n          </button>\n          <button\n            style="\n              padding: 8px 16px;\n              background: linear-gradient(135deg, #8b5cf6 0%, #7c3aed 100%);\n              border: none;\n              border-radius: 6px;\n              color: white;\n              font-size: 13px;\n              font-weight: 600;\n              cursor: pointer;\n            "\n            @click="generateWithAI"\n          >\n            <i class="fa-solid fa-wand-magic-sparkles" style="margin-right: 6px"></i>\n            ç”Ÿæˆ\n          </button>\n        </div>\n        <div v-if="originalAiPrompt" style="margin-top: 16px; display: flex; gap: 10px; justify-content: flex-end">\n          <button\n            style="\n              padding: 10px 20px;\n              background: #ffc107;\n              border: none;\n              border-radius: 6px;\n              color: #000;\n              font-size: 13px;\n              font-weight: 600;\n              cursor: pointer;\n            "\n            :disabled="isModifyingAi"\n            @click="showAiModifyDialog = true"\n          >\n            <i class="fa-solid fa-edit" style="margin-right: 6px"></i>\n            {{ isModifyingAi ? \'ä¿®æ”¹ä¸­...\' : \'AI ä¿®æ”¹\' }}\n          </button>\n        </div>\n      </div>\n    </div>\n\n    \x3c!-- AI ä¿®æ”¹å¯¹è¯æ¡† --\x3e\n    <AIModifyDialog\n      :show="showAiModifyDialog"\n      :is-modifying="isModifyingAi"\n      title="AI ä¿®æ”¹ç•Œé¢ä»£ç "\n      description="æè¿°ä½ æƒ³è¦ä¿®æ”¹çš„åœ°æ–¹ï¼ŒAI ä¼šåœ¨å½“å‰ä»£ç çš„åŸºç¡€ä¸Šè¿›è¡Œè°ƒæ•´ã€‚"\n      :examples="[\n        \'æŠŠèƒŒæ™¯è‰²æ”¹æˆæ·±è“è‰²æ¸å˜\',\n        \'æ·»åŠ åŠ¨ç”»æ•ˆæœï¼Œè®©å­—æ®µæ·¡å…¥æ˜¾ç¤º\',\n        \'ä½¿ç”¨å¡ç‰‡å¸ƒå±€ï¼Œæ¯ä¸ªå­—æ®µç‹¬ç«‹æ˜¾ç¤º\',\n        \'å¢åŠ æ‚¬åœæ•ˆæœ\',\n      ]"\n      @close="showAiModifyDialog = false"\n      @confirm="modifyWithAI"\n    />\n\n    \x3c!-- XML è§£æå¯¹è¯æ¡† --\x3e\n    <div\n      v-if="showXmlDialog"\n      style="\n        position: fixed;\n        top: 0;\n        left: 0;\n        right: 0;\n        bottom: 0;\n        background: rgba(0, 0, 0, 0.7);\n        display: flex;\n        align-items: center;\n        justify-content: center;\n        z-index: 10000;\n      "\n      @click.self="showXmlDialog = false"\n    >\n      <div\n        style="\n          background: #2a2a2a;\n          border-radius: 12px;\n          padding: 24px;\n          width: 90%;\n          max-width: 700px;\n          max-height: 80vh;\n          overflow-y: auto;\n          box-shadow: 0 8px 32px rgba(0, 0, 0, 0.5);\n        "\n      >\n        <h3 style="margin: 0 0 16px 0; color: #f59e0b; font-size: 18px; font-weight: 600">\n          <i class="fa-solid fa-robot" style="margin-right: 8px"></i>\n          AI è§£æ XML ç”Ÿæˆå­—æ®µ\n        </h3>\n\n        <div\n          style="\n            background: rgba(251, 191, 36, 0.1);\n            border: 1px solid rgba(251, 191, 36, 0.3);\n            border-radius: 6px;\n            padding: 12px;\n            margin-bottom: 16px;\n          "\n        >\n          <p style="margin: 0; color: #fbbf24; font-size: 12px; line-height: 1.6">\n            <i class="fa-solid fa-circle-info" style="margin-right: 6px"></i>\n            <strong>æ¸©é¦¨æç¤ºï¼š</strong>æ­¤åŠŸèƒ½éœ€è¦è°ƒç”¨ AIï¼Œè¯·ç¡®ä¿å·²åœ¨å³ä¸Šè§’\n            <i class="fa-solid fa-cog"></i> è®¾ç½®ä¸­é…ç½®äº†æœ‰æ•ˆçš„ API å¯†é’¥ã€‚\n          </p>\n        </div>\n\n        <div style="margin-bottom: 16px">\n          <label style="display: block; margin-bottom: 8px; color: #e0e0e0; font-size: 13px">\n            ç²˜è´´ XML çŠ¶æ€æ ä»£ç ï¼š\n          </label>\n          <textarea\n            v-model="xmlInput"\n            placeholder="ä¾‹å¦‚ï¼š&#10;<state_bar>&#10;<i>ã€å†…å®¹ã€‘</i>&#10;<æ—¥æœŸ>ã€å½“å‰æ—¥æœŸã€‘</æ—¥æœŸ>&#10;<è§’è‰²ç”Ÿç†çŠ¶æ€>ã€æè¿°è§’è‰²å½“å‰ç”Ÿç†çŠ¶æ€ã€‘</è§’è‰²ç”Ÿç†çŠ¶æ€>&#10;</state_bar>"\n            style="\n              width: 100%;\n              min-height: 200px;\n              padding: 12px;\n              background: #1a1a1a;\n              border: 1px solid #404040;\n              border-radius: 6px;\n              color: #e0e0e0;\n              font-family: \'Consolas\', \'Monaco\', monospace;\n              font-size: 13px;\n              resize: vertical;\n            "\n          ></textarea>\n        </div>\n\n        <div style="display: flex; gap: 10px; justify-content: flex-end">\n          <button\n            style="\n              padding: 10px 20px;\n              background: #404040;\n              border: none;\n              border-radius: 6px;\n              color: white;\n              font-size: 13px;\n              cursor: pointer;\n            "\n            @click="showXmlDialog = false"\n          >\n            å–æ¶ˆ\n          </button>\n          <button\n            style="\n              padding: 10px 20px;\n              background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);\n              border: none;\n              border-radius: 6px;\n              color: white;\n              font-size: 13px;\n              cursor: pointer;\n              margin-right: 10px;\n            "\n            :disabled="!xmlInput.trim() || isParsingXml"\n            @click="parseXmlWithAI"\n          >\n            <i class="fa-solid fa-robot" style="margin-right: 6px"></i>\n            {{ isParsingXml ? \'AI è§£æä¸­...\' : \'å¼€å§‹è§£æ\' }}\n          </button>\n          <button\n            v-if="originalXmlInput"\n            style="\n              padding: 10px 20px;\n              background: #ffc107;\n              border: none;\n              border-radius: 6px;\n              color: #000;\n              font-size: 13px;\n              cursor: pointer;\n            "\n            :disabled="isModifyingXml"\n            @click="showXmlModifyDialog = true"\n          >\n            <i class="fa-solid fa-edit" style="margin-right: 6px"></i>\n            {{ isModifyingXml ? \'ä¿®æ”¹ä¸­...\' : \'AI ä¿®æ”¹\' }}\n          </button>\n        </div>\n      </div>\n    </div>\n\n    \x3c!-- XML ä¿®æ”¹å¯¹è¯æ¡† --\x3e\n    <AIModifyDialog\n      :show="showXmlModifyDialog"\n      :is-modifying="isModifyingXml"\n      title="AI ä¿®æ”¹ XML è§£æ"\n      description="æè¿°ä½ æƒ³è¦ä¿®æ”¹çš„å­—æ®µï¼ŒAI ä¼šåœ¨å½“å‰è§£æç»“æœçš„åŸºç¡€ä¸Šè¿›è¡Œè°ƒæ•´ã€‚"\n      :examples="[\n        \'æ·»åŠ ä¸€ä¸ªã€èº«é«˜ã€‘å­—æ®µ\',\n        \'åˆ é™¤ã€å¹´é¾„ã€‘å­—æ®µ\',\n        \'æŠŠã€ä½ç½®ã€‘æ”¹æˆã€æ‰€åœ¨åœ°ç‚¹ã€‘\',\n        \'å¢åŠ 3ä¸ªç”¨äºæè¿°å¤–è²Œçš„å­—æ®µ\',\n      ]"\n      @close="showXmlModifyDialog = false"\n      @confirm="modifyXmlWithAI"\n    />\n\n    \x3c!-- AI æ™ºèƒ½ç”Ÿæˆå­—æ®µå¯¹è¯æ¡† --\x3e\n    <div\n      v-if="showAiFieldDialog"\n      style="\n        position: fixed;\n        top: 0;\n        left: 0;\n        right: 0;\n        bottom: 0;\n        background: rgba(0, 0, 0, 0.7);\n        display: flex;\n        align-items: center;\n        justify-content: center;\n        z-index: 10000;\n      "\n      @click.self="showAiFieldDialog = false"\n    >\n      <div\n        style="\n          background: #2a2a2a;\n          border-radius: 12px;\n          padding: 24px;\n          width: 90%;\n          max-width: 700px;\n          max-height: 80vh;\n          overflow-y: auto;\n          box-shadow: 0 8px 32px rgba(0, 0, 0, 0.5);\n        "\n      >\n        <h3 style="margin: 0 0 16px 0; color: #10b981; font-size: 18px; font-weight: 600">\n          <i class="fa-solid fa-wand-magic-sparkles" style="margin-right: 8px"></i>\n          AI æ™ºèƒ½ç”Ÿæˆå­—æ®µ\n        </h3>\n\n        <div\n          style="\n            background: rgba(16, 185, 129, 0.1);\n            border: 1px solid rgba(16, 185, 129, 0.3);\n            border-radius: 6px;\n            padding: 12px;\n            margin-bottom: 16px;\n          "\n        >\n          <p style="margin: 0; color: #10b981; font-size: 12px; line-height: 1.6">\n            <i class="fa-solid fa-lightbulb" style="margin-right: 6px"></i>\n            <strong>ä½¿ç”¨è¯´æ˜ï¼š</strong>ç”¨è‡ªç„¶è¯­è¨€æè¿°ä½ æƒ³è¦çš„çŠ¶æ€æ ï¼ŒAI ä¼šè‡ªåŠ¨å¸®ä½ ç”Ÿæˆå­—æ®µé…ç½®ï¼\n          </p>\n        </div>\n\n        <div style="margin-bottom: 16px">\n          <label style="display: block; margin-bottom: 8px; color: #e0e0e0; font-size: 13px">\n            æè¿°ä½ æƒ³è¦çš„çŠ¶æ€æ ï¼š\n          </label>\n          <textarea\n            v-model="aiFieldDescription"\n            placeholder="ä¾‹å¦‚ï¼š&#10;å¸®æˆ‘ç”Ÿæˆä¸€ä¸ªä¿®ä»™æ¸¸æˆçš„çŠ¶æ€æ ï¼ŒåŒ…å«ä»¥ä¸‹å­—æ®µï¼š&#10;- è§’è‰²å§“å&#10;- ä¿®ç‚¼å¢ƒç•Œ&#10;- çµåŠ›å€¼&#10;- å½“å‰åŠŸæ³•&#10;- æ‰€åœ¨ä½ç½®&#10;- è§’è‰²çŠ¶æ€ï¼ˆå¦‚å—ä¼¤ã€ä¸­æ¯’ç­‰ï¼‰&#10;- å¥½æ„Ÿåº¦"\n            style="\n              width: 100%;\n              min-height: 180px;\n              padding: 12px;\n              background: #1a1a1a;\n              border: 1px solid #404040;\n              border-radius: 6px;\n              color: #e0e0e0;\n              font-size: 13px;\n              resize: vertical;\n              line-height: 1.6;\n            "\n          ></textarea>\n        </div>\n\n        <div style="display: flex; gap: 10px; justify-content: flex-end">\n          <button\n            style="\n              padding: 10px 20px;\n              background: #404040;\n              border: none;\n              border-radius: 6px;\n              color: white;\n              font-size: 13px;\n              cursor: pointer;\n            "\n            @click="showAiFieldDialog = false"\n          >\n            å–æ¶ˆ\n          </button>\n          <button\n            style="\n              padding: 10px 20px;\n              background: linear-gradient(135deg, #10b981 0%, #059669 100%);\n              border: none;\n              border-radius: 6px;\n              color: white;\n              font-size: 13px;\n              cursor: pointer;\n              margin-right: 10px;\n            "\n            :disabled="!aiFieldDescription.trim() || isGeneratingFields"\n            @click="generateFieldsWithAI"\n          >\n            <i class="fa-solid fa-wand-magic-sparkles" style="margin-right: 6px"></i>\n            {{ isGeneratingFields ? \'AI ç”Ÿæˆä¸­...\' : \'å¼€å§‹ç”Ÿæˆ\' }}\n          </button>\n          <button\n            v-if="originalFieldDescription"\n            style="\n              padding: 10px 20px;\n              background: #ffc107;\n              border: none;\n              border-radius: 6px;\n              color: #000;\n              font-size: 13px;\n              cursor: pointer;\n            "\n            :disabled="isModifyingField"\n            @click="showFieldModifyDialog = true"\n          >\n            <i class="fa-solid fa-edit" style="margin-right: 6px"></i>\n            {{ isModifyingField ? \'ä¿®æ”¹ä¸­...\' : \'AI ä¿®æ”¹\' }}\n          </button>\n        </div>\n      </div>\n    </div>\n\n    \x3c!-- å­—æ®µç”Ÿæˆä¿®æ”¹å¯¹è¯æ¡† --\x3e\n    <AIModifyDialog\n      :show="showFieldModifyDialog"\n      :is-modifying="isModifyingField"\n      title="AI ä¿®æ”¹å­—æ®µé…ç½®"\n      description="æè¿°ä½ æƒ³è¦ä¿®æ”¹çš„å­—æ®µï¼ŒAI ä¼šåœ¨å½“å‰å­—æ®µé…ç½®çš„åŸºç¡€ä¸Šè¿›è¡Œè°ƒæ•´ã€‚"\n      :examples="[\'æ·»åŠ ä¸€ä¸ªã€èº«é«˜ã€‘å­—æ®µ\', \'åˆ é™¤ç¬¬3ä¸ªå­—æ®µ\', \'æŠŠã€å¥½æ„Ÿåº¦ã€‘æ”¹æˆã€äº²å¯†åº¦ã€‘\', \'å¢åŠ 2ä¸ªç”¨äºæè¿°çŠ¶æ€çš„å­—æ®µ\']"\n      @close="showFieldModifyDialog = false"\n      @confirm="modifyFieldWithAI"\n    />\n\n    \x3c!-- è¿›åº¦å¯¹è¯æ¡† --\x3e\n    <ProgressDialog ref="progressDialogRef" :show="showProgress" title="AI æ­£åœ¨å¤„ç†" />\n  </div>\n</template>\n\n<script setup lang="ts">\nimport { storeToRefs } from \'pinia\';\nimport { computed, onMounted, ref, watch } from \'vue\';\nimport { normalizeApiEndpoint, useSettingsStore } from \'../settings\';\nimport { copyToClipboard, getScriptIdSafe } from \'../utils\';\nimport AIModifyDialog from \'./AIModifyDialog.vue\';\nimport ProgressDialog from \'./ProgressDialog.vue\';\n\ninterface Field {\n  name: string;\n  label: string;\n  icon: string;\n}\n\ninterface Config {\n  name: string;\n  findRegex: string;\n  fields: Field[];\n}\n\ninterface CodeFile {\n  path: string;\n  content: string;\n}\n\n// åˆå§‹åŒ– settings store\nconst settingsStore = useSettingsStore();\nconst { settings } = storeToRefs(settingsStore);\n\n// é¢„è®¾æ¨¡æ¿\nconst templates = {\n  simple: {\n    name: \'ç®€å•çŠ¶æ€æ \',\n    findRegex: \'<-CHARACTER_STATUS->\',\n    fields: [\n      { name: \'å§“å\', label: \'å§“å\', icon: \'fa-solid fa-user\' },\n      { name: \'æ€§åˆ«\', label: \'æ€§åˆ«\', icon: \'fa-solid fa-venus-mars\' },\n      { name: \'å¹´é¾„\', label: \'å¹´é¾„\', icon: \'fa-solid fa-cake-candles\' },\n      { name: \'å¥½æ„Ÿåº¦\', label: \'å¥½æ„Ÿåº¦\', icon: \'fa-solid fa-heart\' },\n    ],\n  },\n  abo: {\n    name: \'ABOè®¾å®šçŠ¶æ€æ \',\n    findRegex:\n      \'<-ENVIRONMENT_DATA->[\\\\r\\\\n]*\\\\|([^|]+)\\\\|([^|]+)\\\\|([^|]+)\\\\|([^|]+)\\\\|[\\\\r\\\\n]*<-CHARACTER_STATUS->[\\\\r\\\\n]*\\\\|([^|]+)\\\\|([^|]+)\\\\|([^|]+)\\\\|([^|]+)\\\\|[\\\\r\\\\n]*\',\n    fields: [\n      { name: \'æ—¥æœŸ\', label: \'æ—¥æœŸ\', icon: \'fa-solid fa-calendar\' },\n      { name: \'æ—¶é—´\', label: \'æ—¶é—´\', icon: \'fa-solid fa-clock\' },\n      { name: \'åœ°ç‚¹\', label: \'åœ°ç‚¹\', icon: \'fa-solid fa-location-dot\' },\n      { name: \'å¤©æ°”æ¸©åº¦\', label: \'å¤©æ°”æ¸©åº¦\', icon: \'fa-solid fa-cloud-sun\' },\n      { name: \'ç€è£…\', label: \'ç€è£…\', icon: \'fa-solid fa-shirt\' },\n      { name: \'é»äººç¨‹åº¦\', label: \'é»äººç¨‹åº¦\', icon: \'fa-solid fa-heart\' },\n      { name: \'å‘æƒ…çŠ¶æ€\', label: \'å‘æƒ…çŠ¶æ€\', icon: \'fa-solid fa-fire\' },\n      { name: \'æ ‡è®°æƒ…å†µ\', label: \'æ ‡è®°æƒ…å†µ\', icon: \'fa-solid fa-bookmark\' },\n    ],\n  },\n};\n\nconst config = ref<Config>({\n  name: \'è§’è‰²çŠ¶æ€æ \',\n  findRegex: \'<-CHARACTER_STATUS->\',\n  fields: [\n    { name: \'å§“å\', label: \'å§“å\', icon: \'fa-solid fa-user\' },\n    { name: \'æ€§åˆ«\', label: \'æ€§åˆ«\', icon: \'fa-solid fa-venus-mars\' },\n    { name: \'å¹´é¾„\', label: \'å¹´é¾„\', icon: \'fa-solid fa-cake-candles\' },\n    { name: \'å¥½æ„Ÿåº¦\', label: \'å¥½æ„Ÿåº¦\', icon: \'fa-solid fa-heart\' },\n  ],\n});\n\nconst files = ref<CodeFile[]>([\n  { path: \'index.html\', content: \'\' },\n  { path: \'style.css\', content: \'\' },\n  { path: \'script.js\', content: \'\' },\n]);\n\nconst currentFile = ref<CodeFile | null>(files.value[0]);\nconst showAI = ref(false);\nconst aiPrompt = ref(\'\');\nconst originalAiPrompt = ref(\'\'); // åŸå§‹AIæç¤ºï¼ˆç”¨äºå¢é‡ä¿®æ”¹ï¼‰\nconst showAiModifyDialog = ref(false); // æ˜¾ç¤ºAIä¿®æ”¹å¯¹è¯æ¡†\nconst isModifyingAi = ref(false); // AIä¿®æ”¹ä¸­\nconst showIconPickerFor = ref<number | null>(null);\n\n// è¿›åº¦å¯¹è¯æ¡†\nconst showProgress = ref(false);\nconst progressDialogRef = ref<InstanceType<typeof ProgressDialog> | null>(null);\n\n// XMLè§£æç›¸å…³\nconst originalXmlInput = ref(\'\'); // åŸå§‹XMLè¾“å…¥\nconst showXmlModifyDialog = ref(false);\nconst isModifyingXml = ref(false);\n\n// AIç”Ÿæˆå­—æ®µç›¸å…³\nconst originalFieldDescription = ref(\'\'); // åŸå§‹å­—æ®µæè¿°\nconst showFieldModifyDialog = ref(false);\nconst isModifyingField = ref(false);\n\n// XML è§£æç›¸å…³\nconst showXmlDialog = ref(false);\nconst xmlInput = ref(\'\');\nconst isParsingXml = ref(false);\n\n// AI æ™ºèƒ½ç”Ÿæˆå­—æ®µç›¸å…³\nconst showAiFieldDialog = ref(false);\nconst aiFieldDescription = ref(\'\');\nconst isGeneratingFields = ref(false);\n\n// Font Awesome å›¾æ ‡åˆ—è¡¨ï¼ˆä»…ä½¿ç”¨æœ€å¸¸ç”¨ç¡®å®šå­˜åœ¨çš„å›¾æ ‡ï¼‰\nconst iconList = [\n  // åŠ¨ç‰©\n  \'fa-solid fa-cat\',\n  \'fa-solid fa-dog\',\n  \'fa-solid fa-dove\',\n  \'fa-solid fa-fish\',\n  \'fa-solid fa-paw\',\n  \'fa-solid fa-spider\',\n  \'fa-solid fa-horse\',\n  // çˆ±å¿ƒ\n  \'fa-solid fa-heart\',\n  \'fa-solid fa-heart-pulse\',\n  // è¡¨æƒ…\n  \'fa-solid fa-face-smile\',\n  \'fa-solid fa-face-grin-stars\',\n  \'fa-solid fa-face-grin-beam\',\n  \'fa-solid fa-face-laugh\',\n  // æ˜Ÿæ˜Ÿ\n  \'fa-solid fa-star\',\n  // é­”æ³•\n  \'fa-solid fa-wand-magic-sparkles\',\n  \'fa-solid fa-hat-wizard\',\n  \'fa-solid fa-bolt\',\n  \'fa-solid fa-fire\',\n  \'fa-solid fa-meteor\',\n  \'fa-solid fa-rocket\',\n  // è‡ªç„¶\n  \'fa-solid fa-sun\',\n  \'fa-solid fa-moon\',\n  \'fa-solid fa-cloud\',\n  \'fa-solid fa-seedling\',\n  \'fa-solid fa-leaf\',\n  \'fa-solid fa-tree\',\n  \'fa-solid fa-snowflake\',\n  // é£Ÿç‰©\n  \'fa-solid fa-cake-candles\',\n  \'fa-solid fa-candy-cane\',\n  \'fa-solid fa-apple\',\n  \'fa-solid fa-ice-cream\',\n  // è£…é¥°\n  \'fa-solid fa-gem\',\n  \'fa-solid fa-crown\',\n  \'fa-solid fa-gift\',\n  \'fa-solid fa-ribbon\',\n  \'fa-solid fa-medal\',\n  \'fa-solid fa-trophy\',\n  // æ­¦å™¨\n  \'fa-solid fa-shield\',\n  \'fa-solid fa-scroll\',\n  // ä¹¦ç±\n  \'fa-solid fa-book\',\n  \'fa-solid fa-book-open\',\n  \'fa-solid fa-feather\',\n  \'fa-solid fa-pen\',\n  \'fa-solid fa-paintbrush\',\n  \'fa-solid fa-palette\',\n  // éŸ³ä¹æ¸¸æˆ\n  \'fa-solid fa-music\',\n  \'fa-solid fa-headphones\',\n  \'fa-solid fa-gamepad\',\n  \'fa-solid fa-chess\',\n  \'fa-solid fa-puzzle-piece\',\n  \'fa-solid fa-dice\',\n  // ç”µå­è®¾å¤‡\n  \'fa-solid fa-mobile-screen\',\n  \'fa-solid fa-tablet\',\n  \'fa-solid fa-laptop\',\n  \'fa-solid fa-camera\',\n  \'fa-solid fa-video\',\n  \'fa-solid fa-tv\',\n  // å…¶ä»–\n  \'fa-solid fa-bell\',\n  \'fa-solid fa-envelope\',\n];\n\n// ä¸–ç•Œä¹¦å†…å®¹\nconst worldbookContent = computed(() => {\n  // ç”Ÿæˆå ä½ç¬¦ï¼ˆ{{å­—æ®µå}}æ ¼å¼ï¼‰\n  const placeholders = config.value.fields.map(f => `{{${f.label || f.name}}}`).join(\'|\');\n\n  // ç”Ÿæˆå­—æ®µå®šä¹‰\n  const fieldDefinitions = config.value.fields\n    .map(f => {\n      const iconDesc = f.icon ? `<i class="${f.icon}"></i> ` : \'\';\n      const label = f.label || f.name;\n      return `  - ${iconDesc}${label}ï¼šæè¿°{{char}}çš„${label}çŠ¶æ€`;\n    })\n    .join(\'\\n\');\n\n  // ç”Ÿæˆç¤ºä¾‹å€¼ï¼ˆåªç”¨å­—æ®µåï¼Œä¸ç”¨å ä½ç¬¦è¯­æ³•ï¼‰\n  const exampleValues = config.value.fields.map(f => f.label || f.name || \'ç¤ºä¾‹å€¼\').join(\'|\');\n\n  // æ™ºèƒ½è§£ææ­£åˆ™ï¼Œç”Ÿæˆæ­£ç¡®çš„åˆ†æ®µæ ¼å¼\n  const parseRegexStructure = (regex: string, fields: Field[]): { formatExample: string; exampleOutput: string } => {\n    // æå–æ‰€æœ‰æ ‡è®°ï¼ˆå¦‚ <-ENVIRONMENT_DATA->ï¼‰\n    const triggerMatches = regex.match(/<-[^>]+->/g) || [];\n\n    if (triggerMatches.length === 0) {\n      // æ²¡æœ‰æ ‡è®°ï¼Œç®€å•æ ¼å¼\n      const placeholders = fields.map(f => `{{${f.label || f.name}}}`).join(\'|\');\n      const exampleValues = fields.map(f => f.label || f.name).join(\'|\');\n      return {\n        formatExample: `|${placeholders}|`,\n        exampleOutput: `|${exampleValues}|`,\n      };\n    }\n\n    // ç»Ÿä¸€æ­£åˆ™è¡¨è¾¾å¼çš„è½¬ä¹‰æ ¼å¼ï¼ˆå°†åŒé‡è½¬ä¹‰è½¬ä¸ºå•æ¬¡è½¬ä¹‰ï¼‰\n    let normalizedRegex = regex\n      .replace(/\\\\\\\\/g, \'\\\\\') // \\\\ -> \\\n      .replace(/\\\\\\|/g, \'|\') // \\| -> |\n      .replace(/\\\\\\(/g, \'(\') // \\( -> (\n      .replace(/\\\\\\)/g, \')\') // \\) -> )\n      .replace(/\\\\\\[/g, \'[\') // \\[ -> [\n      .replace(/\\\\\\]/g, \']\') // \\] -> ]\n      .replace(/\\\\\\+/g, \'+\'); // \\+ -> +\n\n    console.log(\'ğŸ” åŸå§‹æ­£åˆ™:\', regex);\n    console.log(\'ğŸ” è§„èŒƒåŒ–æ­£åˆ™:\', normalizedRegex);\n\n    // åˆ†ææ­£åˆ™ç»“æ„ï¼šæŒ‰æ ‡è®°åˆ†æ®µï¼Œç»Ÿè®¡æ¯æ®µåé¢çš„å­—æ®µæ•°\n    const lines: string[] = [];\n    const exampleLines: string[] = [];\n    let fieldIndex = 0;\n\n    // æŒ‰æ ‡è®°åˆ†å‰²æ­£åˆ™\n    const parts = normalizedRegex.split(/(<-[^>]+->)/);\n    console.log(\'ğŸ” åˆ†å‰²åçš„éƒ¨åˆ†:\', parts);\n\n    for (let i = 0; i < parts.length; i++) {\n      const part = parts[i];\n\n      // å¦‚æœæ˜¯æ ‡è®°\n      if (part.match(/<-[^>]+->/)) {\n        lines.push(part);\n        exampleLines.push(part);\n        console.log(`ğŸ“ æ ‡è®°: ${part}`);\n      }\n      // å¦‚æœæ˜¯å­—æ®µéƒ¨åˆ†ï¼ˆåŒ…å«æ•è·ç»„ï¼‰\n      else if (part.trim().length > 0 && !part.match(/<-[^>]+->/)) {\n        // ç»Ÿè®¡è¿™ä¸€æ®µæ€»å…±æœ‰å¤šå°‘ä¸ªæ•è·ç»„\n        const allCaptures = part.match(/\\([^\\)]+\\)/g) || [];\n        const totalCount = allCaptures.length;\n        console.log(`ğŸ”¢ éƒ¨åˆ†å†…å®¹ (å‰100å­—ç¬¦): "${part.substring(0, 100)}"`);\n        console.log(`ğŸ”¢ åŒ¹é…åˆ°çš„æ•è·ç»„:`, allCaptures);\n        console.log(`ğŸ”¢ æ•è·ç»„æ•°é‡: ${totalCount}, å½“å‰å­—æ®µç´¢å¼•: ${fieldIndex}, æ€»å­—æ®µæ•°: ${fields.length}`);\n\n        if (totalCount === 0) {\n          console.warn(`âš ï¸ æœªæ‰¾åˆ°æ•è·ç»„ï¼Œè·³è¿‡æ­¤éƒ¨åˆ†`);\n          continue;\n        }\n\n        // æ¯4ä¸ªå­—æ®µä¸ºä¸€è¡Œ\n        const perLine = 4;\n\n        for (let offset = 0; offset < totalCount; offset += perLine) {\n          const count = Math.min(perLine, totalCount - offset);\n          // ç§»é™¤ fieldIndex < fields.length çš„é™åˆ¶ï¼Œå…è®¸è¶…å‡ºå­—æ®µèŒƒå›´\n          if (count > 0) {\n            const segmentFields = fields.slice(fieldIndex, fieldIndex + count);\n            // å¦‚æœå­—æ®µä¸å¤Ÿï¼Œç”¨å ä½ç¬¦è¡¥é½\n            while (segmentFields.length < count) {\n              segmentFields.push({\n                name: `å­—æ®µ${fieldIndex + segmentFields.length + 1}`,\n                label: `å­—æ®µ${fieldIndex + segmentFields.length + 1}`,\n                icon: \'\',\n              });\n            }\n            const placeholders = segmentFields.map(f => `{{${f.label || f.name}}}`).join(\'|\');\n            const examples = segmentFields.map(f => f.label || f.name).join(\'|\');\n            lines.push(`|${placeholders}|`);\n            exampleLines.push(`|${examples}|`);\n            console.log(`âœ… æ·»åŠ å­—æ®µè¡Œ: |${examples}|`);\n            fieldIndex += count;\n          }\n        }\n      }\n    }\n\n    console.log(\'ğŸ“Š æœ€ç»ˆæ ¼å¼ç¤ºä¾‹:\', lines.join(\'\\n\'));\n    console.log(\'ğŸ“Š æœ€ç»ˆè¾“å‡ºç¤ºä¾‹:\', exampleLines.join(\'\\n\'));\n\n    return {\n      formatExample: lines.join(\'\\n\'),\n      exampleOutput: exampleLines.join(\'\\n\'),\n    };\n  };\n\n  const { formatExample, exampleOutput } = parseRegexStructure(config.value.findRegex, config.value.fields);\n\n  return `<status_rule>\n#æ¯ä¸€æ¬¡å›å¤éƒ½å¿…é¡»åœ¨æœ«å°¾åŠ ä¸Šå®Œæ•´çš„çŠ¶æ€æ ï¼Œå®æ—¶æ›´æ–°{{char}}çš„çŠ¶æ€ã€‚\n\n##çŠ¶æ€æ æ ¼å¼ï¼š\n<status>\n${formatExample}\n</status>\n\n##å­—æ®µè¯´æ˜\n${fieldDefinitions || \'  - æš‚æ— å­—æ®µï¼Œè¯·å…ˆåœ¨ç”Ÿæˆå™¨ä¸­æ·»åŠ å­—æ®µ\'}\n\n##è¾“å‡ºç¤ºä¾‹\næ­¤å¤„ä»…ä¸ºæ ¼å¼ç¤ºä¾‹ï¼Œå…·ä½“å†…å®¹éœ€æ ¹æ®å‰§æƒ…å¡«å†™\n<status>\n${exampleOutput}\n</status>\n\n##æ ¼å¼è¦æ±‚ï¼ˆå¿…è¯»ï¼‰ï¼š\n1. **å¿…é¡»åŒ…å« <status> æ ‡ç­¾**ï¼š\n   - âœ… å¼€å¤´ï¼š<status>\n   - âœ… ç»“å°¾ï¼š</status>\n   - âŒ ç¼ºå°‘æ ‡ç­¾å°†æ— æ³•æ­£ç¡®æ¸²æŸ“\n\n2. **ä¸¥æ ¼æŒ‰ç…§ä¸Šè¿°ç¤ºä¾‹æ ¼å¼è¾“å‡º**ï¼š\n   - æ¯ä¸ªæ ‡è®°ï¼ˆå¦‚ <-ENVIRONMENT_DATA->ï¼‰å¿…é¡»ç‹¬å ä¸€è¡Œ\n   - æ¯è¡Œå­—æ®µç”¨ç«–çº¿ | åˆ†éš”ï¼Œå­—æ®µæ•°é‡å¿…é¡»å®Œå…¨ä¸€è‡´\n   - ä¸è¦æ”¹å˜è¡Œæ•°ã€ä¸è¦åˆå¹¶è¡Œã€ä¸è¦è°ƒæ¢é¡ºåº\n   - å®Œå…¨æŒ‰ç…§ç¤ºä¾‹æ ¼å¼ï¼Œåªæ›¿æ¢å­—æ®µå†…å®¹\n\n3. **å­—æ®µå€¼æ ¼å¼**ï¼š\n   - âŒ é”™è¯¯ï¼š|ä¼´ä¾£: æ— |ä¿¡æ¯ç´ : é›ªåå†·æ‰|\n   - âœ… æ­£ç¡®ï¼š|æ— |é›ªåå†·æ‰|\n   - åªè¾“å‡ºå®é™…å€¼ï¼Œä¸è¦åŠ å­—æ®µåå‰ç¼€\n\n4. **æ¢è¡Œè¦æ±‚**ï¼š\n   - ä¸¥æ ¼éµå®ˆç¤ºä¾‹ä¸­çš„æ¢è¡Œ\n   - æ ‡è®°åå¿…é¡»æ¢è¡Œ\n   - æ¯è¡Œå­—æ®µåå¿…é¡»æ¢è¡Œ\n   - ç»ä¸æŠŠå¤šè¡Œåˆå¹¶æˆä¸€è¡Œ\n\n5. **å…¶ä»–è¦æ±‚**ï¼š\n   - çŠ¶æ€æ ç´§è´´æ­£æ–‡æœ€åä¸€å¥\n   - {{å­—æ®µå}} ä»…ä¸ºå ä½ç¬¦ï¼Œè¾“å‡ºæ—¶æ›¿æ¢ä¸ºå®é™…å†…å®¹\n   - è¿™æ˜¯ {{char}} çš„çŠ¶æ€ï¼Œä¸æ˜¯ {{user}} çš„çŠ¶æ€\n</status_rule>`;\n});\n\n// é¢„è§ˆ HTML\nconst previewHtml = computed(() => {\n  const htmlFile = files.value.find(f => f.path === \'index.html\');\n  const cssFile = files.value.find(f => f.path === \'style.css\');\n  const jsFile = files.value.find(f => f.path === \'script.js\');\n\n  if (!htmlFile) return \'\';\n\n  const scriptTag = \'script\';\n  const styleTag = \'style\';\n\n  // ä¸ºé¢„è§ˆæ›¿æ¢ $1, $2 ç­‰ä¸ºç¤ºä¾‹æ•°æ®\n  let previewContent = htmlFile.content || \'\';\n  config.value.fields.forEach((field, i) => {\n    const exampleValue = field.name || `ç¤ºä¾‹${i + 1}`;\n    previewContent = previewContent.replace(new RegExp(`\\\\$${i + 1}(?!\\\\d)`, \'g\'), exampleValue);\n  });\n\n  return `<!DOCTYPE html>\n<html>\n<head>\n  <meta charset="UTF-8">\n  <meta name="viewport" content="width=device-width, initial-scale=1.0">\n  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">\n  <${styleTag}>\n    html, body {\n      margin: 0;\n      padding: 0;\n      width: 100%;\n      height: auto;\n      min-height: 800px;\n      overflow: visible;\n    }\n    ${cssFile?.content || \'\'}\n  </${styleTag}>\n  <${scriptTag} src="https://code.jquery.com/jquery-3.7.1.min.js"></${scriptTag}>\n  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/toastr.min.css">\n  <${scriptTag} src="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/toastr.min.js"></${scriptTag}>\n  <${scriptTag} src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.5/gsap.min.js"></${scriptTag}>\n  <${scriptTag} src="https://cdnjs.cloudflare.com/ajax/libs/lodash.js/4.17.21/lodash.min.js"></${scriptTag}>\n</head>\n<body>\n  ${previewContent}\n  <${scriptTag}>${jsFile?.content || \'\'}</${scriptTag}>\n</body>\n</html>`;\n});\n\n// æ›´æ–°é¢„è§ˆ\nfunction updatePreview() {\n  // é¢„è§ˆä¼šè‡ªåŠ¨æ›´æ–°\n}\n\n// æ·»åŠ å­—æ®µ\nfunction addField() {\n  config.value.fields.push({ name: \'\', label: \'\', icon: \'\' });\n}\n\n// åˆ é™¤å­—æ®µ\nfunction removeField(index: number) {\n  config.value.fields.splice(index, 1);\n}\n\n// æ˜¾ç¤º XML è§£æå¯¹è¯æ¡†\nfunction showXmlParseDialog() {\n  showXmlDialog.value = true;\n  xmlInput.value = \'\';\n}\n\n// æ˜¾ç¤º AI æ™ºèƒ½ç”Ÿæˆå­—æ®µå¯¹è¯æ¡†\nfunction showAiFieldGeneratorDialog() {\n  showAiFieldDialog.value = true;\n  aiFieldDescription.value = \'\';\n}\n\n// AI è§£æ XML ç”Ÿæˆå­—æ®µ\nasync function parseXmlWithAI() {\n  if (!xmlInput.value.trim()) {\n    toastr.warning(\'è¯·å…ˆè¾“å…¥ XML ä»£ç \');\n    return;\n  }\n\n  // æ£€æŸ¥ API é…ç½®\n  if (!settings.value.api_endpoint || !settings.value.api_key) {\n    toastr.error(\'âš ï¸ API æœªé…ç½®ï¼è¯·ç‚¹å‡»å³ä¸Šè§’"âš™ï¸ è®¾ç½®"æ£€æŸ¥ API é…ç½®\', \'\', {\n      timeOut: 0,\n      extendedTimeOut: 0,\n      closeButton: true,\n    });\n    return;\n  }\n\n  // ä¿å­˜åŸå§‹è¾“å…¥ï¼ˆç”¨äºå¢é‡ä¿®æ”¹ï¼‰\n  originalXmlInput.value = xmlInput.value;\n\n  isParsingXml.value = true;\n  showProgress.value = true;\n\n  try {\n    progressDialogRef.value?.setProgress(10);\n    progressDialogRef.value?.setMessage(\'æ­£åœ¨å‡†å¤‡è§£æ XML...\');\n    progressDialogRef.value?.addDetail(`XML é•¿åº¦: ${xmlInput.value.length} å­—ç¬¦`);\n    const systemPrompt = `ä½ æ˜¯ä¸€ä¸ªä¸“ä¸šçš„ XML è§£æåŠ©æ‰‹ã€‚ç”¨æˆ·ä¼šç»™ä½ ä¸€ä¸ª XML æ ¼å¼çš„çŠ¶æ€æ ä»£ç ï¼Œä½ éœ€è¦ï¼š\n\n1. **è¯†åˆ«æ‰€æœ‰æ ‡ç­¾**ï¼šæå–æ‰€æœ‰çš„ XML æ ‡ç­¾åï¼ˆå¦‚ <i>ã€<2i>ã€<æ—¥æœŸ>ã€<è§’è‰²ç”Ÿç†çŠ¶æ€> ç­‰ï¼‰\n2. **åˆ†ææ ‡ç­¾å«ä¹‰**ï¼š\n   - å¦‚æœæ ‡ç­¾åæ˜¯ <i>ã€<2i>ã€<3i> ç­‰ï¼Œè¿™è¡¨ç¤ºç¼©è¿›å±‚çº§ï¼Œæ ‡ç­¾å†…å®¹æ‰æ˜¯å®é™…å­—æ®µå\n   - å¦‚æœæ ‡ç­¾åæ˜¯ä¸­æ–‡æˆ–è‹±æ–‡åç§°ï¼ˆå¦‚ <æ—¥æœŸ>ã€<è§’è‰²ç”Ÿç†çŠ¶æ€>ï¼‰ï¼Œè¿™æœ¬èº«å°±æ˜¯å­—æ®µå\n3. **ç”Ÿæˆå­—æ®µé…ç½®**ï¼šä¸ºæ¯ä¸ªå­—æ®µç”Ÿæˆ nameã€labelã€iconï¼ˆå¯é€‰ï¼‰\n\nè¯·**ä¸¥æ ¼æŒ‰ç…§ä»¥ä¸‹ JSON æ ¼å¼**è¾“å‡ºï¼Œä¸è¦æ·»åŠ ä»»ä½•å…¶ä»–æ–‡å­—ï¼š\n\n[\n  { "name": "å­—æ®µå1", "label": "å­—æ®µè¯´æ˜1", "icon": "fa-solid fa-xxx" },\n  { "name": "å­—æ®µå2", "label": "å­—æ®µè¯´æ˜2", "icon": "" }\n]\n\n**é‡è¦è§„åˆ™**ï¼š\n- name åº”è¯¥æ˜¯ç®€æ´çš„è‹±æ–‡æˆ–æ‹¼éŸ³ï¼ˆå¦‚ date, location, statusï¼‰\n- label åº”è¯¥æ˜¯ä¸­æ–‡æè¿°ï¼ˆå¦‚ æ—¥æœŸã€åœ°ç‚¹ã€è§’è‰²ç”Ÿç†çŠ¶æ€ï¼‰\n- icon å¯ä»¥ç•™ç©ºï¼Œæˆ–è€…æ ¹æ®å­—æ®µå«ä¹‰é€‰æ‹©åˆé€‚çš„ Font Awesome å›¾æ ‡\n- è¾“å‡º**å¿…é¡»**æ˜¯æœ‰æ•ˆçš„ JSON æ•°ç»„æ ¼å¼\n- **ç¦æ­¢**è¾“å‡ºä»»ä½•è§£é‡Šæ€§æ–‡å­—ï¼Œåªè¾“å‡º JSON\n\nç¤ºä¾‹è¾“å…¥ï¼š\n<state_bar>\n<i>ã€å†…å®¹ã€‘</i>\n<æ—¥æœŸ>ã€å½“å‰æ—¥æœŸã€‘</æ—¥æœŸ>\n<è§’è‰²ç”Ÿç†çŠ¶æ€>ã€æè¿°è§’è‰²å½“å‰ç”Ÿç†çŠ¶æ€ã€‘</è§’è‰²ç”Ÿç†çŠ¶æ€>\n</state_bar>\n\nç¤ºä¾‹è¾“å‡ºï¼š\n[\n  { "name": "content", "label": "å†…å®¹", "icon": "" },\n  { "name": "date", "label": "æ—¥æœŸ", "icon": "fa-solid fa-calendar" },\n  { "name": "physical_status", "label": "è§’è‰²ç”Ÿç†çŠ¶æ€", "icon": "fa-solid fa-heart-pulse" }\n]`;\n\n    const userPrompt = `è¯·è§£æä»¥ä¸‹ XML çŠ¶æ€æ ä»£ç ï¼Œç”Ÿæˆå­—æ®µé…ç½®ï¼š\n\n\\`\\`\\`xml\n${xmlInput.value.trim()}\n\\`\\`\\`\n\nè¯·ä¸¥æ ¼æŒ‰ç…§ JSON æ ¼å¼è¾“å‡ºï¼Œä¸è¦æ·»åŠ ä»»ä½•è§£é‡Šã€‚`;\n\n    console.log(\'ğŸ¤– å¼€å§‹ AI è§£æ XML...\');\n    console.log(\'ğŸ“ ä½¿ç”¨ API:\', settings.value.api_endpoint);\n    console.log(\'ğŸ¤– ä½¿ç”¨æ¨¡å‹:\', settings.value.model);\n\n    progressDialogRef.value?.setProgress(20);\n    progressDialogRef.value?.setMessage(\'æ­£åœ¨å‘é€ XML åˆ° AI æœåŠ¡å™¨...\');\n\n    // è§„èŒƒåŒ– API ç«¯ç‚¹\n    const apiUrl = normalizeApiEndpoint(settings.value.api_endpoint);\n    console.log(\'ğŸ”— è§„èŒƒåŒ–åçš„ç«¯ç‚¹:\', apiUrl);\n\n    // è°ƒç”¨ AI API\n    progressDialogRef.value?.setProgress(30);\n    progressDialogRef.value?.setMessage(\'ç­‰å¾… AI è§£æ XML ç»“æ„...\');\n\n    const response = await fetch(apiUrl, {\n      method: \'POST\',\n      headers: {\n        \'Content-Type\': \'application/json\',\n        Authorization: `Bearer ${settings.value.api_key}`,\n      },\n      body: JSON.stringify({\n        model: settings.value.model,\n        messages: [\n          {\n            role: \'system\',\n            content: systemPrompt,\n          },\n          {\n            role: \'user\',\n            content: userPrompt,\n          },\n        ],\n        max_tokens: 2000,\n        temperature: 0.7,\n      }),\n    });\n\n    if (!response.ok) {\n      const errorText = await response.text();\n      throw new Error(`APIè¯·æ±‚å¤±è´¥: ${response.status} ${response.statusText}\\n${errorText}`);\n    }\n\n    const result = await response.json();\n    console.log(\'âœ… AI å®Œæ•´å“åº”:\', result);\n\n    if (!result.choices || !result.choices[0] || !result.choices[0].message) {\n      throw new Error(\'AIå“åº”æ ¼å¼é”™è¯¯\');\n    }\n\n    const aiResponse = result.choices[0].message.content;\n    console.log(\'âœ… AI åŸå§‹è¿”å›:\', aiResponse);\n\n    // ===== é”™è¯¯æ£€æµ‹ =====\n    if (!aiResponse || typeof aiResponse !== \'string\') {\n      throw new Error(\'AI æœªè¿”å›æœ‰æ•ˆå†…å®¹\');\n    }\n\n    // æå– JSONï¼ˆå¤„ç†å¯èƒ½çš„ä»£ç å—åŒ…è£¹ï¼‰\n    let jsonText = aiResponse.trim();\n\n    // ç§»é™¤å¯èƒ½çš„ markdown ä»£ç å—æ ‡è®°\n    jsonText = jsonText.replace(/^```(?:json)?\\s*\\n?/i, \'\').replace(/\\n?```\\s*$/i, \'\');\n\n    // å°è¯•æå– JSON æ•°ç»„ï¼ˆå¯èƒ½ AI è¾“å‡ºäº†é¢å¤–çš„æ–‡å­—ï¼‰\n    const jsonMatch = jsonText.match(/\\[\\s*{[\\s\\S]*}\\s*\\]/);\n    if (jsonMatch) {\n      jsonText = jsonMatch[0];\n    }\n\n    // å°è¯•è§£æ JSON\n    let parsedFields: any;\n    try {\n      parsedFields = JSON.parse(jsonText);\n    } catch (parseError: any) {\n      throw new Error(\n        `AI è¿”å›çš„ä¸æ˜¯æœ‰æ•ˆçš„ JSON æ ¼å¼\\n\\nè¯·æ£€æŸ¥ AI é…ç½®ï¼Œæˆ–è€…æ‰‹åŠ¨æ·»åŠ å­—æ®µã€‚\\n\\nåŸå§‹è¿”å›ï¼ˆå‰200å­—ç¬¦ï¼‰:\\n${result.slice(0, 200)}`,\n      );\n    }\n\n    if (!Array.isArray(parsedFields)) {\n      throw new Error(\'AI è¿”å›çš„ä¸æ˜¯æœ‰æ•ˆçš„æ•°ç»„æ ¼å¼\');\n    }\n\n    // éªŒè¯å­—æ®µæ ¼å¼\n    const validFields = parsedFields.filter((field: any) => {\n      return field.name && field.label;\n    });\n\n    if (validFields.length === 0) {\n      throw new Error(\'æœªèƒ½ä» AI è¿”å›ä¸­è§£æå‡ºæœ‰æ•ˆçš„å­—æ®µ\');\n    }\n\n    // æ¸…ç©ºç°æœ‰å­—æ®µå¹¶æ·»åŠ æ–°å­—æ®µ\n    config.value.fields = validFields.map((field: any) => ({\n      name: field.name || \'\',\n      label: field.label || \'\',\n      icon: field.icon || \'\',\n    }));\n\n    progressDialogRef.value?.setProgress(100);\n    progressDialogRef.value?.setMessage(\'âœ… è§£æå®Œæˆï¼\');\n    progressDialogRef.value?.addDetail(`æˆåŠŸè§£æ ${validFields.length} ä¸ªå­—æ®µ`);\n\n    setTimeout(() => {\n      showProgress.value = false;\n      showXmlDialog.value = false;\n      xmlInput.value = \'\';\n      toastr.success(`æˆåŠŸè§£æ ${validFields.length} ä¸ªå­—æ®µï¼`);\n    }, 800);\n  } catch (error: any) {\n    console.error(\'âŒ XML è§£æå¤±è´¥:\', error);\n    showProgress.value = false;\n\n    // æ˜¾ç¤ºè¯¦ç»†é”™è¯¯ä¿¡æ¯\n    const errorMsg = error.message || \'æœªçŸ¥é”™è¯¯\';\n\n    // æ£€æŸ¥æ˜¯å¦æ˜¯ API ç›¸å…³é”™è¯¯\n    if (\n      errorMsg.includes(\'APIè¯·æ±‚å¤±è´¥\') ||\n      errorMsg.includes(\'403\') ||\n      errorMsg.includes(\'401\') ||\n      errorMsg.includes(\'Unauthorized\')\n    ) {\n      toastr.error(\'âš ï¸ API è¯·æ±‚å¤±è´¥ï¼è¯·æ£€æŸ¥ï¼š\\n1. API å¯†é’¥æ˜¯å¦æœ‰æ•ˆ\\n2. æ¨¡å‹åç§°æ˜¯å¦æ­£ç¡®\\n3. è´¦æˆ·ä½™é¢æ˜¯å¦å……è¶³\', \'\', {\n        timeOut: 0,\n        extendedTimeOut: 0,\n        closeButton: true,\n      });\n    } else {\n      toastr.error(`è§£æå¤±è´¥: ${errorMsg}`, \'\', {\n        timeOut: 8000,\n        closeButton: true,\n      });\n    }\n  } finally {\n    isParsingXml.value = false;\n  }\n}\n\n// AI ä¿®æ”¹ XML è§£æï¼ˆå¢é‡ä¿®æ”¹ï¼‰\nasync function modifyXmlWithAI(modifyInstruction: string) {\n  if (!originalXmlInput.value) {\n    window.toastr.warning(\'è¯·å…ˆè§£æ XML\');\n    return;\n  }\n\n  isModifyingXml.value = true;\n  showProgress.value = true;\n\n  try {\n    progressDialogRef.value?.setProgress(20);\n    progressDialogRef.value?.setMessage(\'æ­£åœ¨å‡†å¤‡ä¿®æ”¹å­—æ®µé…ç½®...\');\n    progressDialogRef.value?.addDetail(`ä¿®æ”¹æŒ‡ä»¤: ${modifyInstruction}`);\n\n    const systemPrompt = `ä½ æ˜¯ä¸€ä¸ªä¸“ä¸šçš„ XML è§£æåŠ©æ‰‹ã€‚æ ¹æ®ç”¨æˆ·çš„åŸå§‹ XML å’Œä¿®æ”¹å»ºè®®ï¼Œé‡æ–°è§£æå¹¶ç”Ÿæˆå­—æ®µé…ç½®ã€‚`;\n\n    const userPrompt = `# åŸå§‹ XMLï¼š\n${originalXmlInput.value}\n\n# ä¿®æ”¹å»ºè®®ï¼š\n${modifyInstruction}\n\nè¯·æ ¹æ®åŸå§‹ XML å’Œä¿®æ”¹å»ºè®®ï¼Œé‡æ–°ç”Ÿæˆå­—æ®µé…ç½®ã€‚\nè¾“å‡ºæ ¼å¼è¦æ±‚ï¼ˆJSON æ•°ç»„ï¼‰ï¼š\n[\n  { "name": "å­—æ®µå1", "label": "å­—æ®µè¯´æ˜1", "icon": "fa-solid fa-xxx" },\n  { "name": "å­—æ®µå2", "label": "å­—æ®µè¯´æ˜2", "icon": "" }\n]`;\n\n    progressDialogRef.value?.setProgress(40);\n    progressDialogRef.value?.setMessage(\'æ­£åœ¨è°ƒç”¨ AI ä¿®æ”¹...\');\n\n    const apiUrl = normalizeApiEndpoint(settings.value.api_endpoint);\n    const response = await fetch(apiUrl, {\n      method: \'POST\',\n      headers: {\n        \'Content-Type\': \'application/json\',\n        Authorization: `Bearer ${settings.value.api_key}`,\n      },\n      body: JSON.stringify({\n        model: settings.value.model,\n        messages: [\n          { role: \'system\', content: systemPrompt },\n          { role: \'user\', content: userPrompt },\n        ],\n        max_tokens: 2000,\n        temperature: 0.7,\n      }),\n    });\n\n    if (!response.ok) {\n      throw new Error(`API é”™è¯¯: ${response.statusText}`);\n    }\n\n    progressDialogRef.value?.setProgress(70);\n    progressDialogRef.value?.setMessage(\'æ­£åœ¨æ¥æ”¶ AI å“åº”...\');\n\n    const result = await response.json();\n    const aiResponse = result.choices[0]?.message?.content || \'\';\n\n    progressDialogRef.value?.setProgress(85);\n    progressDialogRef.value?.setMessage(\'æ­£åœ¨è§£æå­—æ®µé…ç½®...\');\n\n    // è§£æ JSON\n    let jsonText = aiResponse\n      .trim()\n      .replace(/^```(?:json)?\\s*\\n?/i, \'\')\n      .replace(/\\n?```\\s*$/i, \'\');\n    const jsonMatch = jsonText.match(/\\[\\s*{[\\s\\S]*}\\s*\\]/);\n    if (jsonMatch) {\n      jsonText = jsonMatch[0];\n    }\n\n    const parsedFields = JSON.parse(jsonText);\n    if (!Array.isArray(parsedFields)) {\n      throw new Error(\'AI è¿”å›çš„ä¸æ˜¯æœ‰æ•ˆçš„æ•°ç»„æ ¼å¼\');\n    }\n\n    // æ›´æ–°å­—æ®µ\n    config.value.fields = parsedFields.map((field: any) => ({\n      name: field.name || \'\',\n      label: field.label || field.name || \'\',\n      icon: field.icon || \'\',\n    }));\n\n    // æ›´æ–°åŸå§‹è¾“å…¥ï¼ˆç´¯ç§¯ä¿®æ”¹ï¼‰\n    originalXmlInput.value += `\\n\\nã€å·²åº”ç”¨çš„ä¿®æ”¹ã€‘ï¼š${modifyInstruction}`;\n\n    progressDialogRef.value?.setProgress(100);\n    progressDialogRef.value?.setMessage(\'âœ… ä¿®æ”¹å®Œæˆï¼\');\n    progressDialogRef.value?.addDetail(`å·²æ›´æ–° ${parsedFields.length} ä¸ªå­—æ®µ`);\n\n    setTimeout(() => {\n      showProgress.value = false;\n      showXmlModifyDialog.value = false;\n      window.toastr.success(\'âœ… AI ä¿®æ”¹å®Œæˆï¼\');\n    }, 800);\n  } catch (error: any) {\n    console.error(\'AI ä¿®æ”¹å¤±è´¥:\', error);\n    showProgress.value = false;\n    window.toastr.error(\'AI ä¿®æ”¹å¤±è´¥: \' + error.message);\n  } finally {\n    isModifyingXml.value = false;\n  }\n}\n\n// AI æ™ºèƒ½ç”Ÿæˆå­—æ®µ\nasync function generateFieldsWithAI() {\n  if (!aiFieldDescription.value.trim()) {\n    toastr.warning(\'è¯·å…ˆæè¿°ä½ æƒ³è¦çš„çŠ¶æ€æ \');\n    return;\n  }\n\n  // æ£€æŸ¥ API é…ç½®\n  if (!settings.value.api_endpoint || !settings.value.api_key) {\n    toastr.error(\'âš ï¸ API æœªé…ç½®ï¼è¯·ç‚¹å‡»å³ä¸Šè§’"âš™ï¸ è®¾ç½®"æ£€æŸ¥ API é…ç½®\', \'\', {\n      timeOut: 0,\n      extendedTimeOut: 0,\n      closeButton: true,\n    });\n    return;\n  }\n\n  // ä¿å­˜åŸå§‹è¾“å…¥ï¼ˆç”¨äºå¢é‡ä¿®æ”¹ï¼‰\n  originalFieldDescription.value = aiFieldDescription.value;\n\n  isGeneratingFields.value = true;\n  showProgress.value = true;\n\n  try {\n    progressDialogRef.value?.setProgress(10);\n    progressDialogRef.value?.setMessage(\'æ­£åœ¨å‡†å¤‡æ™ºèƒ½ç”Ÿæˆ...\');\n    progressDialogRef.value?.addDetail(\'AI æ­£åœ¨åˆ†æä½ çš„éœ€æ±‚\');\n    const systemPrompt = `ä½ æ˜¯ä¸€ä¸ªä¸“ä¸šçš„çŠ¶æ€æ å­—æ®µè®¾è®¡åŠ©æ‰‹ã€‚ç”¨æˆ·ä¼šç”¨è‡ªç„¶è¯­è¨€æè¿°ä»–ä»¬æƒ³è¦çš„çŠ¶æ€æ ï¼Œä½ éœ€è¦ï¼š\n\n1. **ç†è§£ç”¨æˆ·éœ€æ±‚**ï¼šåˆ†æç”¨æˆ·æè¿°çš„åœºæ™¯ã€ç±»å‹ï¼ˆå¦‚ä¿®ä»™ã€ç°ä»£ã€ABOç­‰ï¼‰\n2. **è®¾è®¡åˆç†çš„å­—æ®µ**ï¼šæ ¹æ®åœºæ™¯è®¾è®¡å®Œæ•´ã€å®ç”¨çš„å­—æ®µ\n3. **ç”Ÿæˆå­—æ®µé…ç½®**ï¼šä¸ºæ¯ä¸ªå­—æ®µç”Ÿæˆ nameã€labelã€icon\n\nè¯·**ä¸¥æ ¼æŒ‰ç…§ä»¥ä¸‹ JSON æ ¼å¼**è¾“å‡ºï¼Œä¸è¦æ·»åŠ ä»»ä½•å…¶ä»–æ–‡å­—ï¼š\n\n[\n  { "name": "å­—æ®µå1", "label": "å­—æ®µè¯´æ˜1", "icon": "fa-solid fa-xxx" },\n  { "name": "å­—æ®µå2", "label": "å­—æ®µè¯´æ˜2", "icon": "fa-solid fa-xxx" }\n]\n\n**é‡è¦è§„åˆ™**ï¼š\n- name åº”è¯¥æ˜¯ç®€æ´çš„è‹±æ–‡æˆ–æ‹¼éŸ³ï¼ˆå¦‚ realm, spiritual_power, locationï¼‰\n- label åº”è¯¥æ˜¯ä¸­æ–‡æè¿°ï¼ˆå¦‚ å¢ƒç•Œã€çµåŠ›ã€ä½ç½®ï¼‰\n- icon å¿…é¡»é€‰æ‹©åˆé€‚çš„ Font Awesome å›¾æ ‡ï¼ˆå¦‚ fa-solid fa-star, fa-solid fa-boltï¼‰\n- è¾“å‡º**å¿…é¡»**æ˜¯æœ‰æ•ˆçš„ JSON æ•°ç»„æ ¼å¼\n- **ç¦æ­¢**è¾“å‡ºä»»ä½•è§£é‡Šæ€§æ–‡å­—ï¼Œåªè¾“å‡º JSON\n\nå¸¸ç”¨å›¾æ ‡å‚è€ƒï¼š\n- äººç‰©ï¼šfa-solid fa-user, fa-solid fa-user-ninja, fa-solid fa-user-secret\n- çŠ¶æ€ï¼šfa-solid fa-heart, fa-solid fa-heart-pulse, fa-solid fa-star\n- ä½ç½®ï¼šfa-solid fa-location-dot, fa-solid fa-map-marker\n- æ—¶é—´ï¼šfa-solid fa-clock, fa-solid fa-calendar\n- èƒ½é‡ï¼šfa-solid fa-bolt, fa-solid fa-fire, fa-solid fa-droplet\n- ç‰©å“ï¼šfa-solid fa-book, fa-solid fa-wand-magic-sparkles, fa-solid fa-scroll\n- æƒ…æ„Ÿï¼šfa-solid fa-heart, fa-solid fa-face-smile, fa-solid fa-face-sad-tear\n\nç¤ºä¾‹ï¼š\nç”¨æˆ·ï¼š"å¸®æˆ‘ç”Ÿæˆä¸€ä¸ªä¿®ä»™æ¸¸æˆçš„çŠ¶æ€æ "\nè¾“å‡ºï¼š\n[\n  { "name": "name", "label": "å§“å", "icon": "fa-solid fa-user-ninja" },\n  { "name": "realm", "label": "å¢ƒç•Œ", "icon": "fa-solid fa-star" },\n  { "name": "spiritual_power", "label": "çµåŠ›", "icon": "fa-solid fa-bolt" },\n  { "name": "cultivation_method", "label": "åŠŸæ³•", "icon": "fa-solid fa-scroll" },\n  { "name": "location", "label": "ä½ç½®", "icon": "fa-solid fa-location-dot" },\n  { "name": "status", "label": "çŠ¶æ€", "icon": "fa-solid fa-heart-pulse" }\n]`;\n\n    const userPrompt = `è¯·æ ¹æ®ä»¥ä¸‹æè¿°ï¼Œç”ŸæˆçŠ¶æ€æ å­—æ®µé…ç½®ï¼š\n\n${aiFieldDescription.value.trim()}\n\nè¯·ä¸¥æ ¼æŒ‰ç…§ JSON æ ¼å¼è¾“å‡ºï¼Œä¸è¦æ·»åŠ ä»»ä½•è§£é‡Šã€‚`;\n\n    console.log(\'ğŸ¤– å¼€å§‹ AI æ™ºèƒ½ç”Ÿæˆå­—æ®µ...\');\n    console.log(\'ğŸ“ ä½¿ç”¨ API:\', settings.value.api_endpoint);\n    console.log(\'ğŸ¤– ä½¿ç”¨æ¨¡å‹:\', settings.value.model);\n\n    progressDialogRef.value?.setProgress(20);\n    progressDialogRef.value?.setMessage(\'æ­£åœ¨å‘é€éœ€æ±‚åˆ° AI...\');\n\n    // è§„èŒƒåŒ– API ç«¯ç‚¹\n    const apiUrl = normalizeApiEndpoint(settings.value.api_endpoint);\n    console.log(\'ğŸ”— è§„èŒƒåŒ–åçš„ç«¯ç‚¹:\', apiUrl);\n\n    progressDialogRef.value?.setProgress(30);\n    progressDialogRef.value?.setMessage(\'ç­‰å¾… AI è®¾è®¡å­—æ®µ...\');\n\n    // è°ƒç”¨ AI API\n    const response = await fetch(apiUrl, {\n      method: \'POST\',\n      headers: {\n        \'Content-Type\': \'application/json\',\n        Authorization: `Bearer ${settings.value.api_key}`,\n      },\n      body: JSON.stringify({\n        model: settings.value.model,\n        messages: [\n          {\n            role: \'system\',\n            content: systemPrompt,\n          },\n          {\n            role: \'user\',\n            content: userPrompt,\n          },\n        ],\n        max_tokens: 3000,\n        temperature: 0.8,\n      }),\n    });\n\n    if (!response.ok) {\n      const errorText = await response.text();\n      throw new Error(`APIè¯·æ±‚å¤±è´¥: ${response.status} ${response.statusText}\\n${errorText}`);\n    }\n\n    const result = await response.json();\n    console.log(\'âœ… AI å®Œæ•´å“åº”:\', result);\n\n    if (!result.choices || !result.choices[0] || !result.choices[0].message) {\n      throw new Error(\'AIå“åº”æ ¼å¼é”™è¯¯\');\n    }\n\n    const aiResponse = result.choices[0].message.content;\n    console.log(\'âœ… AI åŸå§‹è¿”å›:\', aiResponse);\n\n    // ===== é”™è¯¯æ£€æµ‹ =====\n    if (!aiResponse || typeof aiResponse !== \'string\') {\n      throw new Error(\'AI æœªè¿”å›æœ‰æ•ˆå†…å®¹\');\n    }\n\n    // æå– JSONï¼ˆå¤„ç†å¯èƒ½çš„ä»£ç å—åŒ…è£¹ï¼‰\n    let jsonText = aiResponse.trim();\n\n    // ç§»é™¤å¯èƒ½çš„ markdown ä»£ç å—æ ‡è®°\n    jsonText = jsonText.replace(/^```(?:json)?\\s*\\n?/i, \'\').replace(/\\n?```\\s*$/i, \'\');\n\n    // å°è¯•æå– JSON æ•°ç»„ï¼ˆå¯èƒ½ AI è¾“å‡ºäº†é¢å¤–çš„æ–‡å­—ï¼‰\n    const jsonMatch = jsonText.match(/\\[\\s*{[\\s\\S]*}\\s*\\]/);\n    if (jsonMatch) {\n      jsonText = jsonMatch[0];\n    }\n\n    // å°è¯•è§£æ JSON\n    let parsedFields: any;\n    try {\n      parsedFields = JSON.parse(jsonText);\n    } catch (parseError: any) {\n      throw new Error(\n        `AI è¿”å›çš„ä¸æ˜¯æœ‰æ•ˆçš„ JSON æ ¼å¼\\n\\nè¯·æ£€æŸ¥ AI é…ç½®ï¼Œæˆ–è€…æ‰‹åŠ¨æ·»åŠ å­—æ®µã€‚\\n\\nåŸå§‹è¿”å›ï¼ˆå‰200å­—ç¬¦ï¼‰:\\n${aiResponse.slice(0, 200)}`,\n      );\n    }\n\n    if (!Array.isArray(parsedFields)) {\n      throw new Error(\'AI è¿”å›çš„ä¸æ˜¯æœ‰æ•ˆçš„æ•°ç»„æ ¼å¼\');\n    }\n\n    // éªŒè¯å­—æ®µæ ¼å¼\n    const validFields = parsedFields.filter((field: any) => {\n      return field.name && field.label;\n    });\n\n    if (validFields.length === 0) {\n      throw new Error(\'æœªèƒ½ä» AI è¿”å›ä¸­è§£æå‡ºæœ‰æ•ˆçš„å­—æ®µ\');\n    }\n\n    // æ¸…ç©ºç°æœ‰å­—æ®µå¹¶æ·»åŠ æ–°å­—æ®µ\n    config.value.fields = validFields.map((field: any) => ({\n      name: field.name || \'\',\n      label: field.label || \'\',\n      icon: field.icon || \'\',\n    }));\n\n    progressDialogRef.value?.setProgress(100);\n    progressDialogRef.value?.setMessage(\'âœ… ç”Ÿæˆå®Œæˆï¼\');\n    progressDialogRef.value?.addDetail(`æˆåŠŸç”Ÿæˆ ${validFields.length} ä¸ªå­—æ®µ`);\n\n    setTimeout(() => {\n      showProgress.value = false;\n      showAiFieldDialog.value = false;\n      aiFieldDescription.value = \'\';\n      toastr.success(`æˆåŠŸç”Ÿæˆ ${validFields.length} ä¸ªå­—æ®µï¼`);\n    }, 800);\n  } catch (error: any) {\n    console.error(\'âŒ AI ç”Ÿæˆå­—æ®µå¤±è´¥:\', error);\n    showProgress.value = false;\n\n    // æ˜¾ç¤ºè¯¦ç»†é”™è¯¯ä¿¡æ¯\n    const errorMsg = error.message || \'æœªçŸ¥é”™è¯¯\';\n\n    // æ£€æŸ¥æ˜¯å¦æ˜¯ API ç›¸å…³é”™è¯¯\n    if (\n      errorMsg.includes(\'APIè¯·æ±‚å¤±è´¥\') ||\n      errorMsg.includes(\'403\') ||\n      errorMsg.includes(\'401\') ||\n      errorMsg.includes(\'Unauthorized\')\n    ) {\n      toastr.error(\'âš ï¸ API è¯·æ±‚å¤±è´¥ï¼è¯·æ£€æŸ¥ï¼š\\n1. API å¯†é’¥æ˜¯å¦æœ‰æ•ˆ\\n2. æ¨¡å‹åç§°æ˜¯å¦æ­£ç¡®\\n3. è´¦æˆ·ä½™é¢æ˜¯å¦å……è¶³\', \'\', {\n        timeOut: 0,\n        extendedTimeOut: 0,\n        closeButton: true,\n      });\n    } else {\n      toastr.error(`ç”Ÿæˆå¤±è´¥: ${errorMsg}`, \'\', {\n        timeOut: 8000,\n        closeButton: true,\n      });\n    }\n  } finally {\n    isGeneratingFields.value = false;\n  }\n}\n\n// æ˜¾ç¤ºå›¾æ ‡é€‰æ‹©å™¨\nfunction showIconPicker(index: number) {\n  showIconPickerFor.value = index;\n}\n\n// é€‰æ‹©å›¾æ ‡\nfunction selectIcon(iconClass: string) {\n  if (showIconPickerFor.value !== null) {\n    config.value.fields[showIconPickerFor.value].icon = iconClass;\n    showIconPickerFor.value = null;\n  }\n}\n\n// AI ä¿®æ”¹å­—æ®µç”Ÿæˆï¼ˆå¢é‡ä¿®æ”¹ï¼‰\nasync function modifyFieldWithAI(modifyInstruction: string) {\n  if (!originalFieldDescription.value) {\n    window.toastr.warning(\'è¯·å…ˆç”Ÿæˆå­—æ®µ\');\n    return;\n  }\n\n  isModifyingField.value = true;\n  showProgress.value = true;\n\n  try {\n    progressDialogRef.value?.setProgress(20);\n    progressDialogRef.value?.setMessage(\'æ­£åœ¨å‡†å¤‡ä¿®æ”¹å­—æ®µé…ç½®...\');\n    progressDialogRef.value?.addDetail(`ä¿®æ”¹æŒ‡ä»¤: ${modifyInstruction}`);\n\n    const systemPrompt = `ä½ æ˜¯ä¸€ä¸ªä¸“ä¸šçš„çŠ¶æ€æ å­—æ®µè®¾è®¡åŠ©æ‰‹ã€‚æ ¹æ®ç”¨æˆ·çš„åŸå§‹æè¿°å’Œä¿®æ”¹å»ºè®®ï¼Œé‡æ–°ç”Ÿæˆå­—æ®µé…ç½®ã€‚`;\n\n    const userPrompt = `# åŸå§‹æè¿°ï¼š\n${originalFieldDescription.value}\n\n# ä¿®æ”¹å»ºè®®ï¼š\n${modifyInstruction}\n\nè¯·æ ¹æ®åŸå§‹æè¿°å’Œä¿®æ”¹å»ºè®®ï¼Œé‡æ–°ç”Ÿæˆå­—æ®µé…ç½®ã€‚\nè¾“å‡ºæ ¼å¼è¦æ±‚ï¼ˆJSON æ•°ç»„ï¼‰ï¼š\n[\n  { "name": "å­—æ®µå1", "label": "å­—æ®µè¯´æ˜1", "icon": "fa-solid fa-xxx" },\n  { "name": "å­—æ®µå2", "label": "å­—æ®µè¯´æ˜2", "icon": "" }\n]`;\n\n    progressDialogRef.value?.setProgress(40);\n    progressDialogRef.value?.setMessage(\'æ­£åœ¨è°ƒç”¨ AI ä¿®æ”¹...\');\n\n    const apiUrl = normalizeApiEndpoint(settings.value.api_endpoint);\n    const response = await fetch(apiUrl, {\n      method: \'POST\',\n      headers: {\n        \'Content-Type\': \'application/json\',\n        Authorization: `Bearer ${settings.value.api_key}`,\n      },\n      body: JSON.stringify({\n        model: settings.value.model,\n        messages: [\n          { role: \'system\', content: systemPrompt },\n          { role: \'user\', content: userPrompt },\n        ],\n        max_tokens: 2000,\n        temperature: 0.7,\n      }),\n    });\n\n    if (!response.ok) {\n      throw new Error(`API é”™è¯¯: ${response.statusText}`);\n    }\n\n    progressDialogRef.value?.setProgress(70);\n    progressDialogRef.value?.setMessage(\'æ­£åœ¨æ¥æ”¶ AI å“åº”...\');\n\n    const result = await response.json();\n    const aiResponse = result.choices[0]?.message?.content || \'\';\n\n    progressDialogRef.value?.setProgress(85);\n    progressDialogRef.value?.setMessage(\'æ­£åœ¨è§£æå­—æ®µé…ç½®...\');\n\n    // è§£æ JSON\n    let jsonText = aiResponse\n      .trim()\n      .replace(/^```(?:json)?\\s*\\n?/i, \'\')\n      .replace(/\\n?```\\s*$/i, \'\');\n    const jsonMatch = jsonText.match(/\\[\\s*{[\\s\\S]*}\\s*\\]/);\n    if (jsonMatch) {\n      jsonText = jsonMatch[0];\n    }\n\n    const parsedFields = JSON.parse(jsonText);\n    if (!Array.isArray(parsedFields)) {\n      throw new Error(\'AI è¿”å›çš„ä¸æ˜¯æœ‰æ•ˆçš„æ•°ç»„æ ¼å¼\');\n    }\n\n    // æ›´æ–°å­—æ®µ\n    config.value.fields = parsedFields.map((field: any) => ({\n      name: field.name || \'\',\n      label: field.label || field.name || \'\',\n      icon: field.icon || \'\',\n    }));\n\n    // æ›´æ–°åŸå§‹è¾“å…¥ï¼ˆç´¯ç§¯ä¿®æ”¹ï¼‰\n    originalFieldDescription.value += `\\n\\nã€å·²åº”ç”¨çš„ä¿®æ”¹ã€‘ï¼š${modifyInstruction}`;\n\n    progressDialogRef.value?.setProgress(100);\n    progressDialogRef.value?.setMessage(\'âœ… ä¿®æ”¹å®Œæˆï¼\');\n    progressDialogRef.value?.addDetail(`å·²æ›´æ–° ${parsedFields.length} ä¸ªå­—æ®µ`);\n\n    setTimeout(() => {\n      showProgress.value = false;\n      showFieldModifyDialog.value = false;\n      window.toastr.success(\'âœ… AI ä¿®æ”¹å®Œæˆï¼\');\n    }, 800);\n  } catch (error: any) {\n    console.error(\'AI ä¿®æ”¹å¤±è´¥:\', error);\n    showProgress.value = false;\n    window.toastr.error(\'AI ä¿®æ”¹å¤±è´¥: \' + error.message);\n  } finally {\n    isModifyingField.value = false;\n  }\n}\n\n// æ ¹æ®å­—æ®µç”Ÿæˆæ¨¡æ¿\nfunction generateFromFields() {\n  const fields = config.value.fields;\n\n  // è‡ªåŠ¨ç”Ÿæˆå®Œæ•´çš„ findRegexï¼ˆæ™ºèƒ½åˆ†é…å­—æ®µåˆ°æ ‡è®°ï¼‰\n  const totalFields = fields.length;\n\n  if (totalFields === 0) {\n    config.value.findRegex = \'<-CHARACTER_STATUS->\';\n    console.log(\'âš ï¸ æ²¡æœ‰å­—æ®µï¼Œä½¿ç”¨é»˜è®¤æ ‡è®°\');\n    return;\n  }\n\n  if (totalFields <= 4) {\n    // å­—æ®µå°‘äºç­‰äº4ä¸ªï¼Œä½¿ç”¨å•æ ‡è®°\n    config.value.findRegex = `<-CHARACTER_STATUS->[\\\\r\\\\n]*\\\\|${fields.map(() => \'([^|]+)\').join(\'\\\\|\')}\\\\|[\\\\r\\\\n]*`;\n    console.log(\'âœ… è‡ªåŠ¨ç”Ÿæˆçš„ findRegex (å•æ ‡è®°):\', config.value.findRegex);\n    console.log(\'ğŸ“Š å­—æ®µæ•°é‡:\', totalFields);\n  } else {\n    // å­—æ®µå¤šäº4ä¸ªï¼Œä½¿ç”¨åŒæ ‡è®°ç»“æ„\n    // æ™ºèƒ½å†³å®šæ¯è¡Œå­—æ®µæ•°ï¼ˆä¼˜å…ˆ4ä¸ªï¼Œä½†ä¼šæ ¹æ®æ€»æ•°è°ƒæ•´ï¼‰\n    const perLine = totalFields <= 8 ? Math.ceil(totalFields / 2) : 4;\n\n    // ç¬¬ä¸€ä¸ªæ ‡è®°åˆ†é…çš„å­—æ®µæ•°ï¼ˆä¼˜å…ˆå‡åˆ†ï¼Œä½†ç¬¬ä¸€ä¸ªæ ‡è®°æœ€å¤šæ”¾æ€»æ•°çš„ä¸€åŠï¼‰\n    const firstHalf = Math.min(Math.ceil(totalFields / 2), totalFields <= 12 ? 4 : Math.ceil(totalFields / 3));\n\n    const lines: string[] = [];\n\n    // ç¬¬ä¸€ä¸ªæ ‡è®° + å‰åŠéƒ¨åˆ†å­—æ®µ\n    lines.push(\'<-ENVIRONMENT_DATA->[\\\\r\\\\n]*\');\n    for (let i = 0; i < firstHalf; i += perLine) {\n      const count = Math.min(perLine, firstHalf - i);\n      lines.push(\n        \'\\\\|\' +\n          fields\n            .slice(i, i + count)\n            .map(() => \'([^|]+)\')\n            .join(\'\\\\|\') +\n          \'\\\\|[\\\\r\\\\n]*\',\n      );\n    }\n\n    // ç¬¬äºŒä¸ªæ ‡è®° + ååŠéƒ¨åˆ†å­—æ®µï¼ˆæ¯perLineä¸ªä¸€è¡Œï¼‰\n    lines.push(\'<-CHARACTER_STATUS->[\\\\r\\\\n]*\');\n    for (let i = firstHalf; i < totalFields; i += perLine) {\n      const count = Math.min(perLine, totalFields - i);\n      lines.push(\n        \'\\\\|\' +\n          fields\n            .slice(i, i + count)\n            .map(() => \'([^|]+)\')\n            .join(\'\\\\|\') +\n          \'\\\\|[\\\\r\\\\n]*\',\n      );\n    }\n\n    config.value.findRegex = lines.join(\'\');\n\n    console.log(\'âœ… è‡ªåŠ¨ç”Ÿæˆçš„ findRegex (åŒæ ‡è®°):\', config.value.findRegex);\n    console.log(\'ğŸ“Š å­—æ®µæ•°é‡:\', totalFields);\n    console.log(\n      \'ğŸ“Š åˆ†é…æ–¹æ¡ˆ:\',\n      `ç¬¬ä¸€ä¸ªæ ‡è®°: ${firstHalf}ä¸ªå­—æ®µ, ç¬¬äºŒä¸ªæ ‡è®°: ${totalFields - firstHalf}ä¸ªå­—æ®µ, æ¯è¡Œ: ${perLine}ä¸ª`,\n    );\n  }\n\n  // ç”Ÿæˆ HTML\n  const fieldsHtml = fields\n    .map((f, i) => {\n      const iconPart = f.icon ? `<i class="${f.icon}"></i> ` : \'\';\n      return `        <div class="status-field">\n          <div class="field-label">${iconPart}${f.label || \'å­—æ®µ\' + (i + 1)}</div>\n          <div class="field-value">$${i + 1}</div>\n        </div>`;\n    })\n    .join(\'\\n\');\n\n  const htmlContent = `<details>\n<summary> ${config.value.name} </summary>\n<div class="status-card">\n    <div class="status-header">\n        <span>ğŸ“‹</span>\n        <span>${config.value.name}</span>\n    </div>\n    <div class="status-content">\n        <div class="status-grid">\n${fieldsHtml}\n        </div>\n    </div>\n</div>\n</details>`;\n\n  // ç”Ÿæˆ CSS\n  const cssContent = `.status-card {\n    font-family: \'Microsoft YaHei\', sans-serif;\n    background: linear-gradient(145deg, #1e293b, #334155);\n    border-radius: 14px;\n    margin: 16px 0;\n    box-shadow: 0 8px 25px rgba(15, 23, 42, 0.4);\n    overflow: hidden;\n    border: 1px solid rgba(148, 163, 184, 0.2);\n    max-width: 600px;\n}\n\n.status-header {\n    background: linear-gradient(135deg, #0f172a, #1e293b);\n    color: #e2e8f0;\n    padding: 12px 20px;\n    font-size: 15px;\n    font-weight: 600;\n    display: flex;\n    align-items: center;\n    gap: 8px;\n    border-bottom: 1px solid rgba(148, 163, 184, 0.15);\n}\n\n.status-content {\n    padding: 20px;\n    background: rgba(30, 41, 59, 0.5);\n}\n\n.status-grid {\n    display: grid;\n    grid-template-columns: repeat(2, 1fr);\n    gap: 16px;\n}\n\n.status-field {\n    background: rgba(30, 41, 59, 0.8);\n    padding: 16px;\n    border-radius: 10px;\n    border-left: 3px solid #6366f1;\n}\n\n.field-label {\n    font-size: 11px;\n    color: #94a3b8;\n    margin-bottom: 8px;\n    font-weight: 600;\n    text-transform: uppercase;\n}\n\n.field-value {\n    font-size: 14px;\n    color: #e2e8f0;\n    line-height: 1.5;\n    font-weight: 600;\n}`;\n\n  // ç”Ÿæˆ JS - ç®€å•çš„äº¤äº’è„šæœ¬\n  const jsContent = `// çŠ¶æ€æ äº¤äº’è„šæœ¬\n(function() {\n  // ç­‰å¾…å†…å®¹æ¸²æŸ“\n  setTimeout(function() {\n    console.log(\'${config.value.name} å·²åŠ è½½\');\n\n    // å¯ä»¥æ·»åŠ åŠ¨ç”»æ•ˆæœ\n    if (typeof gsap !== \'undefined\') {\n      gsap.from(\'.status-field\', {\n        opacity: 0,\n        y: 20,\n        duration: 0.5,\n        stagger: 0.1,\n        ease: \'power2.out\'\n      });\n\n      // é¼ æ ‡æ‚¬åœæ•ˆæœ\n      $(\'.status-field\').hover(\n        function() {\n          gsap.to($(this), { scale: 1.05, duration: 0.2 });\n        },\n        function() {\n          gsap.to($(this), { scale: 1, duration: 0.2 });\n        }\n      );\n    }\n  }, 100);\n})();`;\n\n  files.value[0].content = htmlContent;\n  files.value[1].content = cssContent;\n  files.value[2].content = jsContent;\n  currentFile.value = files.value[0];\n\n  window.toastr.success(\'âœ… æ¨¡æ¿å·²ç”Ÿæˆï¼\');\n}\n\n// æ˜¾ç¤º AI å¯¹è¯æ¡†\nfunction showAIDialog() {\n  showAI.value = true;\n  aiPrompt.value = \'\';\n}\n\n// åœ¨å¯¹è¯æ¡†ä¸­æ·»åŠ å­—æ®µ\nfunction addFieldInDialog() {\n  config.value.fields.push({\n    name: `å­—æ®µ${config.value.fields.length + 1}`,\n    label: `å­—æ®µ${config.value.fields.length + 1}`,\n    icon: \'\',\n  });\n}\n\n// åœ¨å¯¹è¯æ¡†ä¸­åˆ é™¤å­—æ®µ\nfunction removeFieldInDialog(index: number) {\n  if (config.value.fields.length <= 1) {\n    window.toastr.warning(\'è‡³å°‘éœ€è¦ä¿ç•™ä¸€ä¸ªå­—æ®µ\');\n    return;\n  }\n  config.value.fields.splice(index, 1);\n}\n\n// åŠ è½½é¢„è®¾æ¨¡æ¿\nfunction loadTemplate(templateKey: \'simple\' | \'abo\') {\n  const template = templates[templateKey];\n  if (template) {\n    config.value = JSON.parse(JSON.stringify(template)); // æ·±æ‹·è´\n    window.toastr.success(`âœ… å·²åŠ è½½"${template.name}"æ¨¡æ¿`);\n  }\n}\n\n// AI ç”Ÿæˆ\nasync function generateWithAI() {\n  if (!aiPrompt.value.trim()) {\n    window.toastr.error(\'è¯·è¾“å…¥ä¿®æ”¹éœ€æ±‚\');\n    return;\n  }\n\n  // ä¿å­˜åŸå§‹è¾“å…¥ï¼ˆç”¨äºå¢é‡ä¿®æ”¹ï¼‰\n  originalAiPrompt.value = aiPrompt.value;\n\n  // æ˜¾ç¤ºè¿›åº¦å¯¹è¯æ¡†\n  showProgress.value = true;\n\n  try {\n    // æ£€æŸ¥ API é…ç½®\n    if (!settings.value.api_endpoint || !settings.value.api_key) {\n      window.toastr.error(\'è¯·å…ˆåœ¨è®¾ç½®é¡µé¢é…ç½® API ç«¯ç‚¹å’Œ API Key\');\n      showProgress.value = false;\n      return;\n    }\n\n    // é˜¶æ®µ1: å‡†å¤‡è¯·æ±‚\n    progressDialogRef.value?.setProgress(10);\n    progressDialogRef.value?.setMessage(\'æ­£åœ¨å‡†å¤‡ AI è¯·æ±‚...\');\n    progressDialogRef.value?.addDetail(`å­—æ®µæ•°é‡: ${config.value.fields.length} ä¸ª`);\n    progressDialogRef.value?.addDetail(`æ¨¡å‹: ${settings.value.model}`);\n\n    // æ„å»ºå½“å‰ä»£ç å†…å®¹\n    const currentFiles = files.value.map(f => `=== ${f.path} ===\\n${f.content}`).join(\'\\n\\n\');\n\n    // æ„å»ºç³»ç»Ÿæç¤ºè¯\n    const systemPrompt = `ä½ æ˜¯ä¸€ä¸ªä¸“ä¸šçš„å‰ç«¯å¼€å‘åŠ©æ‰‹ï¼Œä¸“é—¨ä¸º SillyTavern çŠ¶æ€æ ç”Ÿæˆ HTML/CSS/JS ä»£ç ç‰‡æ®µã€‚\n\nã€é‡è¦ã€‘æœ€ç»ˆä»£ç ä¼šè¢«åµŒå…¥åˆ° Regex è„šæœ¬çš„ replaceString å­—æ®µä¸­ï¼Œç”¨äºæ›¿æ¢ AI è¾“å‡ºçš„çº¯æ–‡æœ¬çŠ¶æ€æ ã€‚\nã€é‡è¦ã€‘è¿™æ˜¯**{{char}}ï¼ˆè§’è‰²ï¼‰çš„çŠ¶æ€æ **ï¼Œç”¨äºæ˜¾ç¤ºè§’è‰²çš„çŠ¶æ€ä¿¡æ¯ï¼Œä¸æ˜¯{{user}}ï¼ˆç”¨æˆ·ï¼‰çš„çŠ¶æ€ã€‚\n\nå¯ç”¨ç¯å¢ƒï¼š\n- Font Awesome å›¾æ ‡åº“ï¼ˆå·²åŠ è½½ï¼‰\n- jQuery ($) - å·²å…¨å±€å¯ç”¨\n- toastrï¼ˆæ¶ˆæ¯æç¤ºï¼‰- å·²å…¨å±€å¯ç”¨\n- gsapï¼ˆåŠ¨ç”»åº“ï¼‰- å·²å…¨å±€å¯ç”¨\n- lodash (_) - å·²å…¨å±€å¯ç”¨\n\nå­—æ®µå ä½ç¬¦è§„åˆ™ï¼š\n- ç”¨ $1ã€$2ã€$3 ç­‰è¡¨ç¤ºæ­£åˆ™æ•è·çš„å­—æ®µå€¼\n- $1 ä»£è¡¨ç¬¬ä¸€ä¸ªå­—æ®µï¼Œ$2 ä»£è¡¨ç¬¬äºŒä¸ªå­—æ®µï¼Œä»¥æ­¤ç±»æ¨\n- ç”¨æˆ·ä¼šæ˜ç¡®å‘Šè¯‰ä½ æ¯ä¸ªå ä½ç¬¦å¯¹åº”çš„å­—æ®µåï¼Œä½ å¿…é¡»ä¸¥æ ¼æŒ‰ç…§ç”¨æˆ·çš„å­—æ®µé…ç½®æ¥ç”Ÿæˆä»£ç \n- **ç¦æ­¢**æ ¹æ®å½“å‰ä»£ç æ–‡ä»¶ä¸­çš„å­—æ®µæ¥æ¨æ–­ï¼Œå¿…é¡»ä½¿ç”¨ç”¨æˆ·æ˜ç¡®æä¾›çš„å­—æ®µåˆ—è¡¨\n\nè¾“å‡ºæ ¼å¼ï¼ˆä¸‰ä¸ªç‹¬ç«‹æ–‡ä»¶ï¼‰ï¼š\nFILE_START: index.html\n<details>\n<summary> çŠ¶æ€æ æ ‡é¢˜ </summary>\n<div class="status-card">\n  \x3c!-- ä½¿ç”¨ $1, $2, $3 ç­‰å ä½ç¬¦ï¼Œå¿…é¡»ä¸ç”¨æˆ·æä¾›çš„å­—æ®µä¸€ä¸€å¯¹åº” --\x3e\n  <div class="field-value">$1</div>\n</div>\n</details>\nFILE_END\n\nFILE_START: style.css\n.status-card {\n  /* å®Œæ•´æ ·å¼ */\n}\nFILE_END\n\nFILE_START: script.js\n(function() {\n  // ç«‹å³æ‰§è¡Œå‡½æ•°ï¼Œé¿å…å…¨å±€æ±¡æŸ“\n  // å¯ä»¥ç›´æ¥ä½¿ç”¨ $ å’Œ document\n})();\nFILE_END\n\nã€å…³é”®è¦æ±‚ã€‘ï¼š\n1. index.html å¿…é¡»ä»¥ <details> å¼€å¤´ï¼Œä»¥ </details> ç»“å°¾ï¼Œä¸è¦ <!DOCTYPE> å’Œ <html> æ ‡ç­¾\n2. FILE_START å’Œ FILE_END ä¹‹é—´ç›´æ¥å†™çº¯ä»£ç ï¼Œ**ç»å¯¹ç¦æ­¢**æ·»åŠ ä»£ç å—æ ‡è®°ï¼ˆ\\\\\\`\\\\\\`\\\\\\`htmlã€"""html ç­‰ï¼‰\n3. HTML ä¸­ä½¿ç”¨çš„å ä½ç¬¦ï¼ˆ$1, $2, $3...ï¼‰å¿…é¡»ä¸ç”¨æˆ·æä¾›çš„å­—æ®µé…ç½®å®Œå…¨ä¸€è‡´\n4. CSS æ ·å¼è¦å®Œæ•´ã€ç¾è§‚ï¼Œä½¿ç”¨ç°ä»£è®¾è®¡\n5. JS ä½¿ç”¨ç«‹å³æ‰§è¡Œå‡½æ•° (function() { ... })()ï¼Œä¸éœ€è¦ $(function() { ... })\n6. ä»£ç ä¼šç›´æ¥åµŒå…¥åˆ°èŠå¤©æ¶ˆæ¯ä¸­ï¼Œä¸éœ€è¦è€ƒè™‘ DOM åŠ è½½æ—¶æœº\n7. **æœ€é‡è¦**ï¼šå¦‚æœç”¨æˆ·æä¾›çš„å­—æ®µé…ç½®ä¸å½“å‰ä»£ç æ–‡ä»¶ä¸­çš„å­—æ®µä¸åŒï¼Œå¿…é¡»ä½¿ç”¨ç”¨æˆ·é…ç½®çš„å­—æ®µï¼Œåˆ é™¤ä»£ç ä¸­ä¸åœ¨ç”¨æˆ·é…ç½®åˆ—è¡¨é‡Œçš„å­—æ®µ`;\n\n    const userPrompt = `# ã€å¼ºåˆ¶è¦æ±‚ã€‘å­—æ®µé…ç½®ï¼ˆè¿™æ˜¯å”¯ä¸€çš„å­—æ®µæ¥æºï¼Œç¦æ­¢è‡ªè¡Œæ·»åŠ æˆ–åˆ é™¤å­—æ®µï¼‰ï¼š\n${config.value.fields.map((f, i) => `å­—æ®µ${i + 1}ï¼š${f.label} (å˜é‡å: ${f.name}) - å ä½ç¬¦: $${i + 1}${f.icon ? ` - å›¾æ ‡: ${f.icon}` : \'\'}`).join(\'\\n\')}\n\nã€âš ï¸ é‡è¦ã€‘ä½ çš„ä»»åŠ¡ï¼š\n1. HTML ä¸­å¿…é¡»ä¸”åªèƒ½åŒ…å«ä¸Šè¿° ${config.value.fields.length} ä¸ªå­—æ®µ\n2. å­—æ®µé¡ºåºå¿…é¡»ä¸¥æ ¼æŒ‰ç…§ï¼š$1 = ${config.value.fields[0]?.label || \'å­—æ®µ1\'}, $2 = ${config.value.fields[1]?.label || \'å­—æ®µ2\'}${config.value.fields[2] ? `, $3 = ${config.value.fields[2].label}` : \'\'}${config.value.fields[3] ? `, $4 = ${config.value.fields[3].label}` : \'\'}${config.value.fields[4] ? `, $5 = ${config.value.fields[4].label}` : \'\'}\n3. ç¦æ­¢æ·»åŠ ä»»ä½•é¢å¤–çš„å­—æ®µï¼ˆå¦‚"å§“å"ã€"æ€§åˆ«"ã€"å¹´é¾„"ç­‰ï¼Œé™¤éå®ƒä»¬åœ¨ä¸Šé¢çš„å­—æ®µåˆ—è¡¨ä¸­ï¼‰\n4. ç¦æ­¢ä½¿ç”¨ $${config.value.fields.length + 1} åŠä»¥ä¸Šçš„å ä½ç¬¦\n\n# ã€é‡è¦è¯´æ˜ã€‘çŠ¶æ€æ ç”¨é€”ï¼š\nè¿™æ˜¯**{{char}}ï¼ˆè§’è‰²ï¼‰çš„çŠ¶æ€æ **ï¼Œç”¨äºæ˜¾ç¤ºè§’è‰²çš„çŠ¶æ€ä¿¡æ¯ï¼ˆå¦‚æ—¶é—´ã€åœ°ç‚¹ã€ç€è£…ã€çŠ¶æ€ç­‰ï¼‰ï¼Œ**ä¸æ˜¯{{user}}ï¼ˆç”¨æˆ·ï¼‰çš„çŠ¶æ€**ã€‚\nçŠ¶æ€æ ä¼šé€šè¿‡MVU Betaå˜é‡ç³»ç»Ÿè¯»å–{{char}}çš„stat_dataå˜é‡ï¼Œæ˜¾ç¤ºåœ¨èŠå¤©æ¶ˆæ¯ä¸­ã€‚\n\n# è§¦å‘æ­£åˆ™ï¼š\n${config.value.findRegex}\n\n# ç”¨æˆ·éœ€æ±‚ï¼š\n${aiPrompt.value}\n\n# å½“å‰ä»£ç æ–‡ä»¶ï¼ˆä»…ä¾›å‚è€ƒæ ·å¼ï¼Œå­—æ®µå¿…é¡»æŒ‰ä¸Šé¢çš„é…ç½®ï¼‰ï¼š\n${currentFiles}\n\nã€è¾“å‡ºè¦æ±‚ã€‘ï¼š\n1. æ ¹æ®ç”¨æˆ·éœ€æ±‚è®¾è®¡çŠ¶æ€æ æ ·å¼å’Œå¸ƒå±€\n2. ä½¿ç”¨ä¸Šè¿° ${config.value.fields.length} ä¸ªå­—æ®µï¼Œæ¯ä¸ªå ä½ç¬¦ï¼ˆ$1, $2, $3...ï¼‰å¿…é¡»å‡ºç°åœ¨ HTML ä¸­\n3. å¯ä»¥ç¾åŒ–æ ·å¼ã€è°ƒæ•´å¸ƒå±€ã€æ·»åŠ åŠ¨ç”»æ•ˆæœ\n4. å¿…é¡»åŒæ—¶è¾“å‡º index.htmlã€style.cssã€script.js ä¸‰ä¸ªæ–‡ä»¶\n5. å¦‚æœå½“å‰ä»£ç ä¸­æœ‰å­—æ®µä¸åœ¨ä¸Šè¿°åˆ—è¡¨ä¸­ï¼Œè¯·åˆ é™¤å®ƒä»¬`;\n\n    // é˜¶æ®µ2: å‘é€è¯·æ±‚\n    progressDialogRef.value?.setProgress(20);\n    progressDialogRef.value?.setMessage(\'æ­£åœ¨å‘é€è¯·æ±‚åˆ° AI æœåŠ¡å™¨...\');\n    progressDialogRef.value?.addDetail(`API ç«¯ç‚¹: ${settings.value.api_endpoint}`);\n\n    const apiUrl = normalizeApiEndpoint(settings.value.api_endpoint);\n    const response = await fetch(apiUrl, {\n      method: \'POST\',\n      headers: {\n        \'Content-Type\': \'application/json\',\n        Authorization: `Bearer ${settings.value.api_key}`,\n      },\n      body: JSON.stringify({\n        model: settings.value.model,\n        messages: [\n          { role: \'system\', content: systemPrompt },\n          { role: \'user\', content: userPrompt },\n        ],\n        temperature: settings.value.temperature || 0.7,\n        max_tokens: settings.value.max_tokens || 65500,\n      }),\n    });\n\n    // é˜¶æ®µ3: ç­‰å¾…å“åº”\n    progressDialogRef.value?.setProgress(40);\n    progressDialogRef.value?.setMessage(\'ç­‰å¾… AI å“åº”...\');\n    progressDialogRef.value?.addDetail(\'è¿™å¯èƒ½éœ€è¦ 10-30 ç§’ï¼Œè¯·è€å¿ƒç­‰å¾…\');\n\n    if (!response.ok) {\n      throw new Error(`API é”™è¯¯: ${response.statusText}`);\n    }\n\n    const data = await response.json();\n    const resultText = data.choices[0]?.message?.content || \'\';\n\n    // é˜¶æ®µ4: è§£æç»“æœ\n    progressDialogRef.value?.setProgress(70);\n    progressDialogRef.value?.setMessage(\'æ­£åœ¨è§£æ AI ç”Ÿæˆçš„ä»£ç ...\');\n    progressDialogRef.value?.addDetail(`æ”¶åˆ°å“åº”ï¼Œé•¿åº¦: ${resultText.length} å­—ç¬¦`);\n\n    // è§£æ AI å›å¤\n    const FILE_START_REGEX = /FILE_START:\\s*([^\\n]+)\\n([\\s\\S]*?)(?=FILE_START:|FILE_END:|$)/g;\n    const matches = [...resultText.matchAll(FILE_START_REGEX)];\n\n    if (matches.length === 0) {\n      throw new Error(\'AI æœªè¿”å›ä»»ä½•æ–‡ä»¶ä¿®æ”¹\');\n    }\n\n    for (const match of matches) {\n      const rawPath = match[1].trim();\n      const normalizedPath = rawPath.replace(/^\\.\\//, \'\');\n      let content = sanitizeFileContent(normalizedPath, match[2]);\n\n      // ç§»é™¤æœ«å°¾çš„ FILE_END\n      if (content.endsWith(\'FILE_END\')) {\n        content = content.slice(0, -8).trim();\n      }\n\n      const file = files.value.find(f => f.path === normalizedPath);\n      if (file) {\n        file.content = content;\n      } else if (normalizedPath === \'index.html\' || normalizedPath === \'style.css\' || normalizedPath === \'script.js\') {\n        // å¦‚æœæ˜¯è¿™ä¸‰ä¸ªæ–‡ä»¶ä¹‹ä¸€ï¼Œæ·»åŠ åˆ°åˆ—è¡¨\n        files.value.push({ path: normalizedPath, content: content });\n      }\n    }\n\n    // ç»Ÿä¸€æ–‡ä»¶è·¯å¾„ï¼Œç§»é™¤å¯èƒ½å­˜åœ¨çš„ \'./\'\n    files.value.forEach(file => {\n      file.path = file.path.replace(/^\\.\\//, \'\');\n    });\n\n    // åŒä¸€æ–‡ä»¶å¯èƒ½å› è¿”å› \'./index.html\' è¢«é‡å¤è¿½åŠ ï¼Œè¿™é‡Œåšä¸€æ¬¡å»é‡ï¼Œä»¥æœ€åä¸€æ¬¡è¿”å›ä¸ºå‡†\n    const uniqueFiles = new Map<string, CodeFile>();\n    files.value.forEach(file => {\n      uniqueFiles.set(file.path, file);\n    });\n    files.value = Array.from(uniqueFiles.values());\n\n    // é˜¶æ®µ5: æ›´æ–°ç•Œé¢\n    progressDialogRef.value?.setProgress(90);\n    progressDialogRef.value?.setMessage(\'æ­£åœ¨æ›´æ–°é¢„è§ˆç•Œé¢...\');\n    progressDialogRef.value?.addDetail(`å·²ç”Ÿæˆ ${matches.length} ä¸ªæ–‡ä»¶`);\n\n    const htmlFile = files.value.find(f => f.path === \'index.html\') || files.value[0];\n    currentFile.value = htmlFile;\n    updatePreview();\n\n    // å®Œæˆ\n    progressDialogRef.value?.setProgress(100);\n    progressDialogRef.value?.setMessage(\'âœ… AI ç”Ÿæˆå®Œæˆï¼\');\n\n    setTimeout(() => {\n      showProgress.value = false;\n      showAI.value = false;\n      window.toastr.success(\'âœ… AI ç”Ÿæˆå®Œæˆï¼\');\n    }, 800);\n  } catch (error: any) {\n    console.error(\'AI ç”Ÿæˆå¤±è´¥:\', error);\n    showProgress.value = false;\n    window.toastr.error(\'AI ç”Ÿæˆå¤±è´¥: \' + error.message);\n  }\n}\n\n// AI ä¿®æ”¹ï¼ˆå¢é‡ä¿®æ”¹ï¼‰\nasync function modifyWithAI(modifyInstruction: string) {\n  if (!originalAiPrompt.value) {\n    window.toastr.warning(\'è¯·å…ˆç”Ÿæˆå†…å®¹\');\n    return;\n  }\n\n  isModifyingAi.value = true;\n  showProgress.value = true;\n\n  try {\n    // é˜¶æ®µ1: å‡†å¤‡ä¿®æ”¹\n    progressDialogRef.value?.setProgress(10);\n    progressDialogRef.value?.setMessage(\'æ­£åœ¨å‡†å¤‡ AI ä¿®æ”¹è¯·æ±‚...\');\n    progressDialogRef.value?.addDetail(`ä¿®æ”¹æŒ‡ä»¤: ${modifyInstruction}`);\n\n    const currentFiles = files.value.map(f => `=== ${f.path} ===\\n${f.content}`).join(\'\\n\\n\');\n\n    const systemPrompt = `ä½ æ˜¯ä¸€ä¸ªä¸“ä¸šçš„å‰ç«¯å¼€å‘åŠ©æ‰‹ï¼Œä¸“é—¨ä¸º SillyTavern çŠ¶æ€æ ç”Ÿæˆ HTML/CSS/JS ä»£ç ç‰‡æ®µã€‚\n\nã€å…³é”®è¦æ±‚ã€‘ï¼š\n1. **å¿…é¡»åŒæ—¶è¾“å‡º index.htmlã€style.cssã€script.js ä¸‰ä¸ªæ–‡ä»¶**\n2. å³ä½¿ç”¨æˆ·åªæåˆ°ä¿®æ”¹æ ·å¼ï¼Œä½ ä¹Ÿå¿…é¡»å®Œæ•´è¾“å‡ºæ‰€æœ‰ä¸‰ä¸ªæ–‡ä»¶\n3. ä¸è¦åªä¿®æ”¹ä¸€ä¸ªæ–‡ä»¶å°±åœæ­¢ï¼Œä¸€å®šè¦è¾“å‡ºå®Œæ•´çš„ä¸‰ä¸ªæ–‡ä»¶\n4. ä½¿ç”¨ FILE_START å’Œ FILE_END æ ¼å¼ä¸¥æ ¼æ ‡è®°æ¯ä¸ªæ–‡ä»¶\n\nè¯·æ ¹æ®ç”¨æˆ·çš„åŸå§‹éœ€æ±‚å’Œä¿®æ”¹å»ºè®®ï¼Œ**å®Œæ•´åœ°**é‡æ–°ç”Ÿæˆæ‰€æœ‰ä»£ç æ–‡ä»¶ã€‚`;\n\n    const userPrompt = `# åŸå§‹éœ€æ±‚ï¼š\n${originalAiPrompt.value}\n\n# ä¿®æ”¹å»ºè®®ï¼š\n${modifyInstruction}\n\n# å­—æ®µé…ç½®ï¼ˆå¿…é¡»ä¸¥æ ¼éµå®ˆï¼‰ï¼š\n${config.value.fields.map((f, i) => `å­—æ®µ${i + 1}ï¼š${f.label} (å˜é‡å: ${f.name}) - å ä½ç¬¦: $${i + 1}${f.icon ? ` - å›¾æ ‡: ${f.icon}` : \'\'}`).join(\'\\n\')}\n\n# å½“å‰ä»£ç ï¼ˆä½œä¸ºä¿®æ”¹åŸºç¡€ï¼‰ï¼š\n${currentFiles}\n\nã€âš ï¸ é‡è¦ã€‘è¯·æ ¹æ®ä¿®æ”¹å»ºè®®ï¼Œ**å®Œæ•´åœ°è¾“å‡ºä»¥ä¸‹ä¸‰ä¸ªæ–‡ä»¶**ï¼š\n\nFILE_START: index.html\n<details>\n  \x3c!-- å®Œæ•´çš„ HTMLï¼Œå¿…é¡»ä½¿ç”¨ $1, $2, $3 ç­‰å ä½ç¬¦ --\x3e\n</details>\nFILE_END\n\nFILE_START: style.css\n/* å®Œæ•´çš„ CSS æ ·å¼ */\nFILE_END\n\nFILE_START: script.js\n(function() {\n  // å®Œæ•´çš„ JS ä»£ç \n})();\nFILE_END\n\n**ä¸è¦é—æ¼ä»»ä½•æ–‡ä»¶**ï¼Œå³ä½¿æŸä¸ªæ–‡ä»¶æ²¡æœ‰ä¿®æ”¹ä¹Ÿè¦å®Œæ•´è¾“å‡ºï¼`;\n\n    // é˜¶æ®µ2: å‘é€è¯·æ±‚\n    progressDialogRef.value?.setProgress(20);\n    progressDialogRef.value?.setMessage(\'æ­£åœ¨å‘é€ä¿®æ”¹è¯·æ±‚åˆ° AI æœåŠ¡å™¨...\');\n    progressDialogRef.value?.addDetail(`å½“å‰æ–‡ä»¶æ•°: ${files.value.length} ä¸ª`);\n\n    const apiUrl = normalizeApiEndpoint(settings.value.api_endpoint);\n\n    progressDialogRef.value?.setProgress(30);\n    progressDialogRef.value?.setMessage(\'ç­‰å¾… AI ä¿®æ”¹ä»£ç ...\');\n    progressDialogRef.value?.addDetail(\'è¿™å¯èƒ½éœ€è¦ 10-30 ç§’ï¼Œè¯·è€å¿ƒç­‰å¾…\');\n\n    const response = await fetch(apiUrl, {\n      method: \'POST\',\n      headers: {\n        \'Content-Type\': \'application/json\',\n        Authorization: `Bearer ${settings.value.api_key}`,\n      },\n      body: JSON.stringify({\n        model: settings.value.model,\n        messages: [\n          { role: \'system\', content: systemPrompt },\n          { role: \'user\', content: userPrompt },\n        ],\n        temperature: 0.7,\n        max_tokens: 65500,\n      }),\n    });\n\n    if (!response.ok) {\n      throw new Error(`API é”™è¯¯: ${response.statusText}`);\n    }\n\n    // é˜¶æ®µ3: æ¥æ”¶å“åº”\n    progressDialogRef.value?.setProgress(60);\n    progressDialogRef.value?.setMessage(\'æ­£åœ¨æ¥æ”¶ AI å“åº”...\');\n\n    const data = await response.json();\n    const resultText = data.choices[0]?.message?.content || \'\';\n\n    // é˜¶æ®µ4: è§£ææ–‡ä»¶\n    progressDialogRef.value?.setProgress(80);\n    progressDialogRef.value?.setMessage(\'æ­£åœ¨è§£æä¿®æ”¹åçš„ä»£ç ...\');\n    progressDialogRef.value?.addDetail(`å“åº”é•¿åº¦: ${resultText.length} å­—ç¬¦`);\n\n    // è§£ææ–‡ä»¶\n    const FILE_START_REGEX = /FILE_START:\\s*([^\\n]+)\\n([\\s\\S]*?)(?=FILE_START:|FILE_END:|$)/g;\n    const matches = [...resultText.matchAll(FILE_START_REGEX)];\n\n    if (matches.length === 0) {\n      throw new Error(\'AI æœªè¿”å›ä»»ä½•æ–‡ä»¶ä¿®æ”¹ã€‚è¯·å°è¯•æ›´æ˜ç¡®çš„ä¿®æ”¹æŒ‡ä»¤ã€‚\');\n    }\n\n    progressDialogRef.value?.addDetail(`è§£æåˆ° ${matches.length} ä¸ªæ–‡ä»¶`);\n\n    // æ£€æŸ¥æ˜¯å¦ç”Ÿæˆäº†æ‰€æœ‰å¿…éœ€çš„æ–‡ä»¶\n    const generatedFiles = matches.map(m => m[1].trim().replace(/^\\.\\//, \'\'));\n    const requiredFiles = [\'index.html\', \'style.css\', \'script.js\'];\n    const missingFiles = requiredFiles.filter(f => !generatedFiles.includes(f));\n\n    if (missingFiles.length > 0) {\n      progressDialogRef.value?.addDetail(`âš ï¸ è­¦å‘Š: AI æœªç”Ÿæˆä»¥ä¸‹æ–‡ä»¶: ${missingFiles.join(\', \')}`);\n      window.toastr.warning(`AI å¯èƒ½åªç”Ÿæˆäº†éƒ¨åˆ†æ–‡ä»¶ï¼Œç¼ºå°‘: ${missingFiles.join(\', \')}`, \'\', {\n        timeOut: 5000,\n      });\n    }\n\n    if (matches.length > 0) {\n      for (const match of matches) {\n        const normalizedPath = match[1].trim().replace(/^\\.\\//, \'\');\n        let content = sanitizeFileContent(normalizedPath, match[2]);\n        if (content.endsWith(\'FILE_END\')) {\n          content = content.slice(0, -8).trim();\n        }\n        const file = files.value.find(f => f.path === normalizedPath);\n        if (file) {\n          file.content = content;\n          progressDialogRef.value?.addDetail(`âœ“ å·²æ›´æ–°: ${normalizedPath}`);\n        }\n      }\n    }\n\n    // é˜¶æ®µ5: æ›´æ–°ç•Œé¢\n    progressDialogRef.value?.setProgress(95);\n    progressDialogRef.value?.setMessage(\'æ­£åœ¨æ›´æ–°é¢„è§ˆ...\');\n\n    // æ›´æ–°åŸå§‹è¾“å…¥ï¼ˆç´¯ç§¯ä¿®æ”¹ï¼‰\n    originalAiPrompt.value += `\\n\\nã€å·²åº”ç”¨çš„ä¿®æ”¹ã€‘ï¼š${modifyInstruction}`;\n\n    updatePreview();\n\n    // å®Œæˆ\n    progressDialogRef.value?.setProgress(100);\n    progressDialogRef.value?.setMessage(\'âœ… AI ä¿®æ”¹å®Œæˆï¼\');\n\n    setTimeout(() => {\n      showProgress.value = false;\n      showAiModifyDialog.value = false;\n      window.toastr.success(`âœ… AI ä¿®æ”¹å®Œæˆï¼å·²æ›´æ–° ${matches.length} ä¸ªæ–‡ä»¶`);\n    }, 800);\n  } catch (error: any) {\n    console.error(\'AI ä¿®æ”¹å¤±è´¥:\', error);\n    showProgress.value = false;\n    window.toastr.error(\'AI ä¿®æ”¹å¤±è´¥: \' + error.message);\n  } finally {\n    isModifyingAi.value = false;\n  }\n}\n\n// å¤åˆ¶ä¸–ç•Œä¹¦\nasync function copyWorldbook() {\n  await copyToClipboard(worldbookContent.value, \'âœ… ä¸–ç•Œä¹¦å†…å®¹å·²å¤åˆ¶åˆ°å‰ªè´´æ¿ï¼\');\n}\n\nfunction sanitizeFileContent(filePath: string, raw: string): string {\n  let content = raw.trim();\n\n  // ç§»é™¤ markdown ä»£ç å—å›´æ ï¼ˆ```html ... ```ï¼‰\n  const fenceMatch = content.match(/^```[a-zA-Z0-9]*\\s*([\\s\\S]*?)\\s*```$/);\n  if (fenceMatch) {\n    content = fenceMatch[1].trim();\n  }\n\n  // ç§»é™¤ Python docstring é£æ ¼çš„ä¸‰å¼•å·ï¼ˆ"""html ... """ æˆ– \'\'\'html ... \'\'\'ï¼‰\n  const docstringMatch = content.match(/^("""|\'\'\')[a-zA-Z0-9]*\\s*([\\s\\S]*?)\\s*\\1$/);\n  if (docstringMatch) {\n    content = docstringMatch[2].trim();\n  }\n\n  // ç§»é™¤å¼€å¤´çš„å•è¡Œä»£ç å—æ ‡è®°ï¼ˆå¦‚é¦–è¡Œæ˜¯ """html æˆ– ```html ä½†æ²¡æœ‰ç»“æŸæ ‡è®°ï¼‰\n  content = content.replace(/^(```|"""|\'\'\')[a-zA-Z0-9]*\\s*\\n?/, \'\');\n  content = content.replace(/\\n?\\s*(```|"""|\'\'\')$/, \'\');\n\n  if (filePath.endsWith(\'.html\')) {\n    content = content.replace(/<!DOCTYPE html>/i, match => match.toUpperCase());\n  }\n\n  return content;\n}\n\n// å¯¼å‡ºæ­£åˆ™\nfunction exportRegex() {\n  const htmlFile = files.value.find(f => f.path === \'index.html\');\n  const cssFile = files.value.find(f => f.path === \'style.css\');\n  const jsFile = files.value.find(f => f.path === \'script.js\');\n\n  if (!htmlFile || htmlFile.content.trim() === \'\') {\n    window.toastr.error(\'è¯·å…ˆç”Ÿæˆæˆ–ç¼–è¾‘çŠ¶æ€æ ä»£ç \');\n    return;\n  }\n\n  const uuid = \'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx\'.replace(/[xy]/g, function (c) {\n    const r = (Math.random() * 16) | 0;\n    const v = c === \'x\' ? r : (r & 0x3) | 0x8;\n    return v.toString(16);\n  });\n\n  // æ„å»ºçŠ¶æ€æ ç‰‡æ®µï¼ˆ<details> æ ¼å¼ï¼Œç”¨äºåµŒå…¥èŠå¤©æ¶ˆæ¯ï¼‰\n  const scriptTag = \'script\';\n  const styleTag = \'style\';\n\n  // æ‹¼æ¥ä¸º <details> ç‰‡æ®µ\n  const detailsHtml = htmlFile.content.trim();\n  const replaceString = `${detailsHtml}\n<${styleTag}>\n${cssFile?.content || \'\'}\n</${styleTag}>\n\n<${scriptTag}>\n${jsFile?.content || \'\'}\n</${scriptTag}>`;\n\n  // æ„å»º findRegex\n  // å¦‚æœ findRegex ä¸­å·²ç»åŒ…å«æ•è·ç»„ï¼Œç›´æ¥ä½¿ç”¨å®ƒ\n  // å¦åˆ™ï¼Œè‡ªåŠ¨åœ¨åé¢è¿½åŠ å­—æ®µçš„æ•è·ç»„\n  let regexPattern = config.value.findRegex;\n\n  // æ£€æŸ¥ findRegex ä¸­æ˜¯å¦å·²ç»åŒ…å«æ•è·ç»„\n  const existingCaptureGroups = (regexPattern.match(/\\([^)]+\\)/g) || []).length;\n  const fieldCount = config.value.fields.length;\n\n  if (existingCaptureGroups === 0) {\n    // æ²¡æœ‰æ•è·ç»„ï¼Œéœ€è¦è‡ªåŠ¨ç”Ÿæˆ\n    regexPattern = `${regexPattern.replace(/[.*+?^${}()|[\\]\\\\]/g, \'\\\\$&\')}[\\\\r\\\\n]*${Array(fieldCount)\n      .fill(\'\\\\|([^|]+)\')\n      .join(\'\')}\\\\|[\\\\r\\\\n]*`;\n  }\n  // å¦‚æœå·²ç»æœ‰æ•è·ç»„ï¼Œç›´æ¥ä½¿ç”¨ï¼ˆç”¨æˆ·è‡ªå®šä¹‰çš„æ­£åˆ™ï¼‰\n\n  // æ ‡å‡†åŒ–æ¢è¡Œç¬¦\n  const cleanReplaceString = replaceString.replace(/\\r\\n/g, \'\\n\').replace(/\\r/g, \'\\n\');\n\n  const regexJson = {\n    id: uuid,\n    scriptName: config.value.name,\n    findRegex: regexPattern,\n    replaceString: cleanReplaceString,\n    trimStrings: [],\n    placement: [2],\n    disabled: false,\n    markdownOnly: true,\n    promptOnly: false,\n    runOnEdit: true,\n    substituteRegex: 0,\n    minDepth: null,\n    maxDepth: null,\n  };\n\n  // ä¸‹è½½ JSON\n  const blob = new Blob([JSON.stringify(regexJson, null, 2)], { type: \'application/json\' });\n  const url = URL.createObjectURL(blob);\n  const a = document.createElement(\'a\');\n  a.href = url;\n  a.download = `regex-${config.value.name}.json`;\n  a.click();\n  URL.revokeObjectURL(url);\n\n  window.toastr.success(\'âœ… æ­£åˆ™ JSON å·²å¯¼å‡ºæˆåŠŸï¼\');\n}\n\n// ==================== æ•°æ®æŒä¹…åŒ– ====================\n\n// åŠ è½½ä¿å­˜çš„é…ç½®\nfunction loadSavedConfig() {\n  try {\n    const scriptId = getScriptIdSafe();\n    if (!scriptId) {\n      console.warn(\'script_id ä¸ºç©ºï¼Œæ— æ³•åŠ è½½çŠ¶æ€æ é…ç½®\');\n      return;\n    }\n\n    const scriptVars = getVariables({ type: \'script\', script_id: scriptId });\n    const savedConfig = scriptVars.statusbar_generator_config;\n\n    if (savedConfig) {\n      config.value = { ...config.value, ...savedConfig };\n      console.log(\'âœ… å·²åŠ è½½ä¿å­˜çš„çŠ¶æ€æ é…ç½®\');\n    }\n  } catch (error) {\n    console.error(\'åŠ è½½çŠ¶æ€æ é…ç½®å¤±è´¥:\', error);\n  }\n}\n\n// ä¿å­˜é…ç½®\nfunction saveConfig() {\n  try {\n    const scriptId = getScriptIdSafe();\n    if (!scriptId) {\n      console.warn(\'script_id ä¸ºç©ºï¼Œæ— æ³•ä¿å­˜çŠ¶æ€æ é…ç½®\');\n      return;\n    }\n\n    insertOrAssignVariables({ statusbar_generator_config: config.value }, { type: \'script\', script_id: scriptId });\n  } catch (error) {\n    console.error(\'ä¿å­˜çŠ¶æ€æ é…ç½®å¤±è´¥:\', error);\n  }\n}\n\n// ç»„ä»¶æŒ‚è½½æ—¶åŠ è½½\nonMounted(() => {\n  loadSavedConfig();\n});\n\n// ç›‘å¬é…ç½®å˜åŒ–ï¼Œè‡ªåŠ¨ä¿å­˜\nwatch(\n  () => config.value,\n  () => {\n    saveConfig();\n  },\n  { deep: true },\n);\n<\/script>\n\n<style scoped>\n.statusbar-generator {\n  padding: 20px;\n  height: 100%;\n  display: flex;\n  flex-direction: column;\n  gap: 20px;\n  background: #1a1a1a;\n}\n</style>\n'],sourceRoot:''}]);const i=s},200:(e,n,t)=>{var a=t(871);a.__esModule&&(a=a.default),'string'==typeof a&&(a=[[e.id,a,'']]),a.locals&&(e.exports=a.locals);(0,t(424).A)('7bb1737c',a,!1,{ssrId:!0})},267:(e,n,t)=>{var a=t(700);a.__esModule&&(a=a.default),'string'==typeof a&&(a=[[e.id,a,'']]),a.locals&&(e.exports=a.locals);(0,t(424).A)('482d2d0e',a,!1,{ssrId:!0})},314:(e,n,t)=>{t.r(n),t.d(n,{default:()=>i});var a=t(790),o=t.n(a),r=t(54),s=t.n(r)()(o());s.push([e.id,'.memory-panel-container[data-v-67eefd1a]{display:flex;flex-direction:column;height:100%;background:#1a1a1a;color:#e0e0e0}.panel-header[data-v-67eefd1a]{padding:15px 20px;background:#2a2a2a;border-bottom:1px solid #3a3a3a;display:flex;justify-content:space-between;align-items:center;border-radius:8px 8px 0 0}.header-left[data-v-67eefd1a]{display:flex;align-items:center;gap:10px}.language-button[data-v-67eefd1a]{cursor:pointer;padding:5px 10px;border-radius:4px;transition:background 0.2s}.language-button[data-v-67eefd1a]:hover{background:rgba(74,158,255,0.2)}.minimize-button[data-v-67eefd1a]{cursor:pointer;padding:5px 10px;border-radius:4px;transition:background 0.2s}.minimize-button[data-v-67eefd1a]:hover{background:rgba(255,255,255,0.1)}.close-button[data-v-67eefd1a]{cursor:pointer;padding:5px 10px;border-radius:4px;transition:background 0.2s}.close-button[data-v-67eefd1a]:hover{background:rgba(255,255,255,0.1)}.panel-tabs[data-v-67eefd1a]{display:flex;background:#2a2a2a;border-bottom:1px solid #3a3a3a}.tab-item[data-v-67eefd1a]:hover{background:rgba(255,255,255,0.05) !important}.panel-content[data-v-67eefd1a]{flex:1;overflow-y:auto;overflow-x:hidden;padding:0;min-height:0}.panel-content[data-v-67eefd1a]::-webkit-scrollbar{width:8px}.panel-content[data-v-67eefd1a]::-webkit-scrollbar-track{background:#2a2a2a}.panel-content[data-v-67eefd1a]::-webkit-scrollbar-thumb{background:#4a9eff;border-radius:4px}.panel-content[data-v-67eefd1a]::-webkit-scrollbar-thumb:hover{background:#5ab0ff}\n','',{version:3,sources:['webpack://./src/è®°å¿†_with_worldbook/components/MainPanel.vue'],names:[],mappings:'AAqMA,yCACE,YAAa,CACb,qBAAsB,CACtB,WAAY,CACZ,kBAAmB,CACnB,aACF,CAEA,+BACE,iBAAkB,CAClB,kBAAmB,CACnB,+BAAgC,CAChC,YAAa,CACb,6BAA8B,CAC9B,kBAAmB,CACnB,yBACF,CAEA,8BACE,YAAa,CACb,kBAAmB,CACnB,QACF,CAEA,kCACE,cAAe,CACf,gBAAiB,CACjB,iBAAkB,CAClB,0BACF,CAEA,wCACE,+BACF,CAEA,kCACE,cAAe,CACf,gBAAiB,CACjB,iBAAkB,CAClB,0BACF,CAEA,wCACE,gCACF,CAEA,+BACE,cAAe,CACf,gBAAiB,CACjB,iBAAkB,CAClB,0BACF,CAEA,qCACE,gCACF,CAEA,6BACE,YAAa,CACb,kBAAmB,CACnB,+BACF,CAEA,iCACE,4CACF,CAEA,gCACE,MAAO,CACP,eAAgB,CAChB,iBAAkB,CAClB,SAAU,CACV,YACF,CAGA,mDACE,SACF,CAEA,yDACE,kBACF,CAEA,yDACE,kBAAmB,CACnB,iBACF,CAEA,+DACE,kBACF',sourcesContent:['<template>\n  <div\n    class="memory-panel-container"\n    style="display: flex; flex-direction: column; height: 100%; background: #1a1a1a; color: #e0e0e0"\n  >\n    \x3c!-- é¢æ¿å¤´éƒ¨ --\x3e\n    <div\n      class="panel-header"\n      style="\n        padding: 15px 20px;\n        background: #2a2a2a;\n        border-bottom: 1px solid #3a3a3a;\n        display: flex;\n        justify-content: space-between;\n        align-items: center;\n        border-radius: 8px 8px 0 0;\n        flex-shrink: 0;\n      "\n    >\n      <div class="header-left" style="display: flex; align-items: center; gap: 10px">\n        <span style="font-size: 24px">ğŸ±</span>\n        <b class="panel-title">{{ t(\'panel.title\') }}</b>\n        <b class="panel-title-mobile">{{ currentLocale === \'zh-CN\' ? \'çŒ«çŒ«çš„å°ç ´çƒ‚\' : "mzrodyu\'s Tool" }}</b>\n      </div>\n      <div style="display: flex; gap: 10px; align-items: center">\n        \x3c!-- è¯­è¨€åˆ‡æ¢æŒ‰é’® --\x3e\n        <div\n          class="language-button"\n          style="\n            cursor: pointer;\n            padding: 5px 10px;\n            border-radius: 4px;\n            transition: background 0.2s;\n            font-size: 14px;\n            display: flex;\n            align-items: center;\n            gap: 5px;\n          "\n          :title="currentLocale === \'zh-CN\' ? \'Switch to English\' : \'åˆ‡æ¢åˆ°ä¸­æ–‡\'"\n          @click="toggleLanguage"\n        >\n          <i class="fa-solid fa-language"></i>\n          <span>{{ currentLocale === \'zh-CN\' ? \'EN\' : \'ä¸­\' }}</span>\n        </div>\n        <div\n          class="minimize-button"\n          style="cursor: pointer; padding: 5px 10px; border-radius: 4px; transition: background 0.2s"\n          :title="t(\'panel.minimize\')"\n          @click="minimizePanel"\n        >\n          <i class="fa-solid fa-minus"></i>\n        </div>\n        <div\n          class="close-button"\n          style="cursor: pointer; padding: 5px 10px; border-radius: 4px; transition: background 0.2s"\n          :title="currentLocale === \'zh-CN\' ? \'å…³é—­\' : \'Close\'"\n          @click="closePanel"\n        >\n          <i class="fa-solid fa-times"></i>\n        </div>\n      </div>\n    </div>\n\n    \x3c!-- é¢æ¿æ ‡ç­¾æ  --\x3e\n    <div\n      class="panel-tabs"\n      style="display: flex; background: #2a2a2a; border-bottom: 1px solid #3a3a3a; flex-shrink: 0"\n    >\n      <div\n        v-for="tab in tabs"\n        :key="tab.key"\n        :class="{ \'tab-active\': activeTab === tab.key }"\n        class="tab-item"\n        :style="{\n          flex: \'1\',\n          padding: \'12px 20px\',\n          cursor: \'pointer\',\n          textAlign: \'center\',\n          transition: \'background 0.2s, color 0.2s\',\n          display: \'flex\',\n          alignItems: \'center\',\n          justifyContent: \'center\',\n          gap: \'8px\',\n          borderBottom: \'2px solid transparent\',\n          backgroundColor: activeTab === tab.key ? \'#1a1a1a\' : \'transparent\',\n          color: activeTab === tab.key ? \'#4a9eff\' : \'#e0e0e0\',\n          borderBottomColor: activeTab === tab.key ? \'#4a9eff\' : \'transparent\',\n        }"\n        @click="switchTab(tab.key)"\n      >\n        <i :class="tab.icon"></i>\n        <span class="tab-label">{{ tab.label }}</span>\n      </div>\n    </div>\n\n    \x3c!-- é¢æ¿å†…å®¹ --\x3e\n    <div\n      class="panel-content"\n      style="\n        flex: 1;\n        overflow-y: auto;\n        overflow-x: hidden;\n        padding: 0;\n        min-height: 0;\n        scrollbar-width: thin;\n        scrollbar-color: #4a9eff #2a2a2a;\n      "\n    >\n      <component :is="currentComponent" :key="activeTab" v-bind="componentProps" />\n    </div>\n  </div>\n</template>\n\n<script setup lang="ts">\nimport { computed, ref } from \'vue\';\nimport { useI18n } from \'vue-i18n\';\nimport { minimizeMemoryPanel } from \'../æµ®åŠ¨é¢æ¿\';\nimport GreetingsTab from \'./GreetingsTab.vue\';\nimport HelpTab from \'./HelpTab.vue\';\nimport MvuBetaTab from \'./MvuBetaTab.vue\';\nimport ProjectManager from \'./ProjectManager.vue\';\nimport RegexUIGenerator from \'./RegexUIGenerator.vue\';\nimport SettingsTab from \'./SettingsTab.vue\';\nimport StatusBarGenerator from \'./StatusBarGenerator.vue\';\nimport SummaryTab from \'./SummaryTab.vue\';\nimport TableTab from \'./TableTab.vue\';\nimport ToolsTab from \'./ToolsTab.vue\';\n\nconst { t, locale } = useI18n();\nconst currentLocale = computed(() => locale.value);\n\n// æ ‡ç­¾é¡µé…ç½®ï¼ˆä½¿ç”¨è®¡ç®—å±æ€§ä»¥å“åº”è¯­è¨€å˜åŒ–ï¼‰\nconst tabs = computed(() => [\n  { key: \'settings\', label: t(\'tabs.settings\'), icon: \'fa-solid fa-cog\' },\n  { key: \'summary\', label: t(\'tabs.history\'), icon: \'fa-solid fa-list\' },\n  { key: \'table\', label: t(\'tabs.table\'), icon: \'fa-solid fa-table\' },\n  { key: \'greetings\', label: t(\'tabs.greetings\'), icon: \'fa-solid fa-comments\' },\n  { key: \'regex\', label: t(\'tabs.regex\'), icon: \'fa-solid fa-code\' },\n  { key: \'status\', label: t(\'tabs.state\'), icon: \'fa-solid fa-chart-bar\' },\n  { key: \'project\', label: t(\'tabs.projects\'), icon: \'fa-solid fa-laptop-code\' },\n  { key: \'tools\', label: t(\'tabs.tools\'), icon: \'fa-solid fa-tools\' },\n  { key: \'mvu\', label: t(\'tabs.mvu\'), icon: \'fa-solid fa-flask\' },\n  { key: \'help\', label: t(\'tabs.help\'), icon: \'fa-solid fa-question-circle\' },\n]);\n\nconst activeTab = ref<\n  \'settings\' | \'summary\' | \'table\' | \'greetings\' | \'status\' | \'regex\' | \'project\' | \'tools\' | \'mvu\' | \'help\'\n>(\'settings\');\n\n// ç»„ä»¶æ˜ å°„\nconst componentMap = {\n  settings: SettingsTab,\n  summary: SummaryTab,\n  table: TableTab,\n  greetings: GreetingsTab,\n  status: StatusBarGenerator,\n  regex: RegexUIGenerator,\n  project: ProjectManager,\n  tools: ToolsTab,\n  mvu: MvuBetaTab,\n  help: HelpTab,\n};\n\n// å½“å‰ç»„ä»¶\nconst currentComponent = computed(() => componentMap[activeTab.value]);\n\n// ç»„ä»¶å±æ€§\nconst componentProps = computed(() => ({\n  activeTab: activeTab.value,\n}));\n\n// åˆ‡æ¢æ ‡ç­¾é¡µ\nconst switchTab = (tabKey: string) => {\n  console.log(\'åˆ‡æ¢æ ‡ç­¾é¡µ:\', tabKey);\n  activeTab.value = tabKey as any;\n};\n\n// åˆ‡æ¢è¯­è¨€\nconst toggleLanguage = () => {\n  const newLocale = locale.value === \'zh-CN\' ? \'en-US\' : \'zh-CN\';\n  locale.value = newLocale;\n  localStorage.setItem(\'maomao_tool_locale\', newLocale);\n  toastr.success(newLocale === \'zh-CN\' ? \'å·²åˆ‡æ¢åˆ°ä¸­æ–‡\' : \'Switched to English\');\n};\n\n// æœ€å°åŒ–é¢æ¿\nconst minimizePanel = () => {\n  minimizeMemoryPanel();\n};\n\n// å…³é—­é¢æ¿\nconst closePanel = () => {\n  $(\'#memoryManagementPanel\').fadeOut(200);\n};\n<\/script>\n\n<style scoped>\n.memory-panel-container {\n  display: flex;\n  flex-direction: column;\n  height: 100%;\n  background: #1a1a1a;\n  color: #e0e0e0;\n}\n\n.panel-header {\n  padding: 15px 20px;\n  background: #2a2a2a;\n  border-bottom: 1px solid #3a3a3a;\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  border-radius: 8px 8px 0 0;\n}\n\n.header-left {\n  display: flex;\n  align-items: center;\n  gap: 10px;\n}\n\n.language-button {\n  cursor: pointer;\n  padding: 5px 10px;\n  border-radius: 4px;\n  transition: background 0.2s;\n}\n\n.language-button:hover {\n  background: rgba(74, 158, 255, 0.2);\n}\n\n.minimize-button {\n  cursor: pointer;\n  padding: 5px 10px;\n  border-radius: 4px;\n  transition: background 0.2s;\n}\n\n.minimize-button:hover {\n  background: rgba(255, 255, 255, 0.1);\n}\n\n.close-button {\n  cursor: pointer;\n  padding: 5px 10px;\n  border-radius: 4px;\n  transition: background 0.2s;\n}\n\n.close-button:hover {\n  background: rgba(255, 255, 255, 0.1);\n}\n\n.panel-tabs {\n  display: flex;\n  background: #2a2a2a;\n  border-bottom: 1px solid #3a3a3a;\n}\n\n.tab-item:hover {\n  background: rgba(255, 255, 255, 0.05) !important;\n}\n\n.panel-content {\n  flex: 1;\n  overflow-y: auto;\n  overflow-x: hidden;\n  padding: 0;\n  min-height: 0;\n}\n\n/* è‡ªå®šä¹‰æ»šåŠ¨æ¡æ ·å¼ */\n.panel-content::-webkit-scrollbar {\n  width: 8px;\n}\n\n.panel-content::-webkit-scrollbar-track {\n  background: #2a2a2a;\n}\n\n.panel-content::-webkit-scrollbar-thumb {\n  background: #4a9eff;\n  border-radius: 4px;\n}\n\n.panel-content::-webkit-scrollbar-thumb:hover {\n  background: #5ab0ff;\n}\n</style>\n'],sourceRoot:''}]);const i=s},345:(e,n,t)=>{t.r(n),t.d(n,{default:()=>i});var a=t(790),o=t.n(a),r=t(54),s=t.n(r)()(o());s.push([e.id,'@keyframes fadeIn-7e37d274{from{opacity:0;transform:translateY(-10px)}to{opacity:1;transform:translateY(0)}}.update-list[data-v-7e37d274]{margin:5px 0;padding-left:20px;font-size:14px}.update-item[data-v-7e37d274]{margin-bottom:8px;line-height:1.6}\n','',{version:3,sources:['webpack://./src/è®°å¿†_with_worldbook/components/HelpTab.vue'],names:[],mappings:'AAypBA,2BACE,KACE,SAAU,CACV,2BACF,CACA,GACE,SAAU,CACV,uBACF,CACF,CAEA,8BACE,YAAa,CACb,iBAAkB,CAClB,cACF,CAEA,8BACE,iBAAkB,CAClB,eACF',sourcesContent:['<template>\n  <div class="help-tab" style="padding: 25px !important; background: #1a1a1a !important">\n    \x3c!-- ç‰ˆæœ¬ä¿¡æ¯ --\x3e\n    <div\n      style="\n        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);\n        padding: 35px 30px;\n        border-radius: 20px;\n        margin-bottom: 25px;\n        box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);\n        text-align: center;\n        position: relative;\n        overflow: hidden;\n      "\n    >\n      \x3c!-- è£…é¥°å…ƒç´  --\x3e\n      <div\n        style="\n          position: absolute;\n          top: -50px;\n          right: -50px;\n          width: 150px;\n          height: 150px;\n          background: rgba(255, 255, 255, 0.1);\n          border-radius: 50%;\n        "\n      ></div>\n      <div\n        style="\n          position: absolute;\n          bottom: -30px;\n          left: -30px;\n          width: 100px;\n          height: 100px;\n          background: rgba(255, 255, 255, 0.1);\n          border-radius: 50%;\n        "\n      ></div>\n\n      <div style="position: relative; z-index: 1">\n        <div style="font-size: 48px; margin-bottom: 10px">ğŸ±</div>\n        <h2 style="margin: 0 0 10px 0; color: white; font-size: 24px; font-weight: 600">\n          {{ currentLocale === \'zh-CN\' ? \'mzrodyuçŒ«çŒ«çš„å°ç ´çƒ‚\' : "mzrodyu\'s Tool" }}\n        </h2>\n        <div style="color: rgba(255, 255, 255, 0.9); font-size: 14px; margin-bottom: 15px" class="version-info">\n          {{ t(\'helpPage.version\') }} v1.34\n        </div>\n\n        \x3c!-- æŒ‰é’®ç»„ --\x3e\n        <div style="display: flex; gap: 12px; justify-content: center; flex-wrap: wrap">\n          <button\n            @click="checkUpdate"\n            style="\n              padding: 12px 24px;\n              background: white;\n              color: #667eea;\n              border: none;\n              border-radius: 10px;\n              font-size: 15px;\n              font-weight: 600;\n              cursor: pointer;\n              transition: all 0.3s;\n              box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);\n              display: flex;\n              align-items: center;\n              gap: 8px;\n            "\n            @mouseover="$event.target.style.transform = \'translateY(-2px)\'"\n            @mouseleave="$event.target.style.transform = \'\'"\n          >\n            <i class="fa-solid fa-rotate" style="margin-right: 6px"></i>\n            {{ t(\'helpPage.checkUpdate\') }}\n          </button>\n\n          <button\n            @click="downloadLatest"\n            style="\n              padding: 12px 24px;\n              background: rgba(255, 255, 255, 0.2);\n              color: white;\n              border: 1px solid rgba(255, 255, 255, 0.5);\n              border-radius: 10px;\n              font-size: 15px;\n              font-weight: 600;\n              cursor: pointer;\n              transition: all 0.3s;\n              display: flex;\n              align-items: center;\n              gap: 8px;\n            "\n            @mouseover="$event.target.style.background = \'rgba(255, 255, 255, 0.3)\'"\n            @mouseleave="$event.target.style.background = \'rgba(255, 255, 255, 0.2)\'"\n          >\n            <i class="fa-solid fa-download" style="margin-right: 6px"></i>\n            {{ t(\'helpPage.downloadLatest\') }}\n          </button>\n        </div>\n\n        \x3c!-- ç‰ˆæƒå£°æ˜ --\x3e\n        <div\n          style="\n            margin-top: 25px;\n            padding: 20px;\n            background: rgba(220, 53, 69, 0.15);\n            border: 2px solid rgba(220, 53, 69, 0.3);\n            border-radius: 12px;\n            backdrop-filter: blur(10px);\n          "\n        >\n          <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 10px; justify-content: center">\n            <i class="fa-solid fa-shield-halved" style="color: #ffc107; font-size: 16px"></i>\n            <span style="color: white; font-weight: 600; font-size: 14px">{{ t(\'helpPage.copyright\') }}</span>\n          </div>\n          <div style="color: rgba(255, 255, 255, 0.95); font-size: 13px; line-height: 1.8; text-align: left">\n            <div style="margin-bottom: 5px" v-html="t(\'helpPage.copyrightContent.line1\')"></div>\n            <div style="margin-bottom: 5px" v-html="t(\'helpPage.copyrightContent.line2\')"></div>\n            <div style="margin-bottom: 5px" v-html="t(\'helpPage.copyrightContent.line3\')"></div>\n            <div v-html="t(\'helpPage.copyrightContent.line4\')"></div>\n          </div>\n        </div>\n      </div>\n    </div>\n\n    \x3c!-- ä½¿ç”¨è¯´æ˜ --\x3e\n    <div\n      style="\n        background: linear-gradient(135deg, #1e1e1e 0%, #2a2a2a 100%);\n        padding: 25px;\n        border-radius: 16px;\n        margin-bottom: 20px;\n        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);\n        border: 1px solid rgba(74, 158, 255, 0.2);\n      "\n    >\n      <h3\n        style="\n          margin: 0 0 20px 0;\n          color: #4a9eff;\n          font-size: 20px;\n          font-weight: 600;\n          display: flex;\n          align-items: center;\n          gap: 12px;\n          cursor: pointer;\n          user-select: none;\n        "\n        @click="expandedSections.usage = !expandedSections.usage"\n      >\n        <i class="fa-solid fa-book-open" style="color: #4a9eff; font-size: 18px"></i>\n        {{ t(\'helpPage.usageGuide\') }}\n        <i\n          :class="expandedSections.usage ? \'fa-chevron-up\' : \'fa-chevron-down\'"\n          class="fa-solid"\n          style="margin-left: auto; font-size: 14px; transition: transform 0.3s; color: #888"\n        ></i>\n      </h3>\n\n      <div\n        v-show="expandedSections.usage"\n        style="color: #e0e0e0; font-size: 14px; line-height: 1.8; animation: fadeIn 0.3s ease-in"\n      >\n        <h4\n          style="color: #4a9eff; margin-top: 0; margin-bottom: 15px; font-size: 16px"\n          v-html="t(\'helpPage.features.title\')"\n        ></h4>\n        <ul style="margin: 5px 0; padding-left: 20px">\n          <li v-html="t(\'helpPage.features.summary\')"></li>\n          <li v-html="t(\'helpPage.features.cardAssist\')"></li>\n          <li v-html="t(\'helpPage.features.statusBar\')"></li>\n          <li v-html="t(\'helpPage.features.mvu\')"></li>\n          <li v-html="t(\'helpPage.features.others\')"></li>\n        </ul>\n\n        <h4\n          style="color: #4a9eff; margin-top: 25px; margin-bottom: 15px; font-size: 16px"\n          v-html="t(\'helpPage.usage.title\')"\n        ></h4>\n        <div\n          style="\n            background: rgba(220, 53, 69, 0.1);\n            border-left: 4px solid #dc3545;\n            padding: 15px;\n            border-radius: 8px;\n            margin-bottom: 15px;\n          "\n        >\n          <div\n            style="color: #dc3545; font-weight: 600; margin-bottom: 8px"\n            v-html="t(\'helpPage.usage.apiConfig\')"\n          ></div>\n          <div style="font-size: 13px; color: #e0e0e0; line-height: 1.6">\n            <div style="margin-bottom: 8px">\n              <span v-html="t(\'helpPage.usage.apiFormats\')"></span>\n              <ul style="margin: 5px 0; padding-left: 20px">\n                <li v-html="t(\'helpPage.usage.apiFormat1\')"></li>\n                <li v-html="t(\'helpPage.usage.apiFormat2\')"></li>\n                <li v-html="t(\'helpPage.usage.apiFormat3\')"></li>\n              </ul>\n            </div>\n            <div style="margin-bottom: 5px">\n              <span v-html="t(\'helpPage.usage.apiExample\')"></span>\n              <code style="background: rgba(220, 53, 69, 0.2); padding: 2px 6px; border-radius: 4px"\n                >https://api.openai.com</code\n              >\n            </div>\n          </div>\n        </div>\n        <ul style="margin: 5px 0; padding-left: 20px">\n          <li v-html="t(\'helpPage.usage.import\')"></li>\n          <li v-html="t(\'helpPage.usage.firstUse\')"></li>\n          <li v-html="t(\'helpPage.usage.autoSummary\')"></li>\n        </ul>\n      </div>\n    </div>\n\n    \x3c!-- æ›´æ–°æ—¥å¿— --\x3e\n    <div\n      style="\n        background: linear-gradient(135deg, #1e1e1e 0%, #2a2a2a 100%);\n        padding: 25px;\n        border-radius: 16px;\n        margin-bottom: 20px;\n        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);\n        border: 1px solid rgba(40, 167, 69, 0.2);\n      "\n    >\n      <h3\n        style="\n          margin: 0 0 20px 0;\n          color: #28a745;\n          font-size: 20px;\n          font-weight: 600;\n          display: flex;\n          align-items: center;\n          gap: 12px;\n          cursor: pointer;\n          user-select: none;\n        "\n        @click="expandedSections.changelog = !expandedSections.changelog"\n      >\n        <i class="fa-solid fa-clock-rotate-left" style="color: #28a745; font-size: 18px"></i>\n        {{ t(\'helpPage.changelog\') }}\n        <i\n          :class="expandedSections.changelog ? \'fa-chevron-up\' : \'fa-chevron-down\'"\n          class="fa-solid"\n          style="margin-left: auto; font-size: 14px; transition: transform 0.3s; color: #888"\n        ></i>\n      </h3>\n\n      <div\n        v-show="expandedSections.changelog"\n        style="color: #e0e0e0; font-size: 14px; line-height: 1.8; animation: fadeIn 0.3s ease-in"\n      >\n        \x3c!-- v1.34 --\x3e\n        <div\n          style="\n            padding: 20px;\n            background: rgba(76, 175, 80, 0.05);\n            border-left: 4px solid #4caf50;\n            border-radius: 8px;\n            margin-bottom: 15px;\n          "\n        >\n          <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px">\n            <div\n              style="font-size: 16px; font-weight: 600; color: #4caf50; display: flex; align-items: center; gap: 8px"\n            >\n              v1.34\n            </div>\n            <div style="font-size: 13px; color: #888">{{ t(\'helpPage.updates.v134.date\') }}</div>\n          </div>\n          <ul class="update-list">\n            <li v-for="feature in t(\'helpPage.updates.v134.features\')" :key="feature" class="update-item">\n              {{ feature }}\n            </li>\n          </ul>\n        </div>\n\n        \x3c!-- v1.33 --\x3e\n        <div\n          style="\n            padding: 20px;\n            background: rgba(255, 152, 0, 0.05);\n            border-left: 4px solid #ff9800;\n            border-radius: 8px;\n            margin-bottom: 15px;\n          "\n        >\n          <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px">\n            <div\n              style="font-size: 16px; font-weight: 600; color: #ff9800; display: flex; align-items: center; gap: 8px"\n            >\n              v1.33 - {{ t(\'helpPage.updates.v133.title\') }}\n            </div>\n            <div style="font-size: 13px; color: #888">{{ t(\'helpPage.updates.v133.date\') }}</div>\n          </div>\n          <ul class="update-list">\n            <li v-for="feature in t(\'helpPage.updates.v133.features\')" :key="feature" class="update-item">\n              {{ feature }}\n            </li>\n          </ul>\n        </div>\n\n        \x3c!-- v1.32 --\x3e\n        <div\n          style="\n            padding: 20px;\n            background: rgba(99, 102, 241, 0.05);\n            border-left: 4px solid #6366f1;\n            border-radius: 8px;\n            margin-bottom: 15px;\n          "\n        >\n          <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px">\n            <div style="font-size: 16px; font-weight: 600; color: #6366f1">v1.32</div>\n            <div style="font-size: 13px; color: #888">{{ t(\'helpPage.updates.v132.date\') }}</div>\n          </div>\n\n          <div style="margin-bottom: 15px">\n            <div style="color: #6366f1; font-weight: 600; margin-bottom: 8px">\n              {{ t(\'helpPage.updates.v132.optimize\') }}\n            </div>\n            <ul style="margin: 5px 0; padding-left: 20px; font-size: 14px">\n              <li v-for="opt in t(\'helpPage.updates.v132.optimizeFeatures\')" :key="opt">{{ opt }}</li>\n            </ul>\n          </div>\n        </div>\n\n        \x3c!-- v1.31 --\x3e\n        <div\n          style="\n            padding: 20px;\n            background: rgba(99, 102, 241, 0.05);\n            border-left: 4px solid #6366f1;\n            border-radius: 8px;\n            margin-bottom: 15px;\n          "\n        >\n          <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px">\n            <div style="font-size: 16px; font-weight: 600; color: #6366f1">v1.31</div>\n            <div style="font-size: 13px; color: #888">{{ t(\'helpPage.updates.v131.date\') }}</div>\n          </div>\n\n          <div style="margin-bottom: 15px">\n            <div style="color: #10b981; font-weight: 600; margin-bottom: 8px">\n              {{ t(\'helpPage.updates.v131.newFeatures\') }}\n            </div>\n            <ul style="margin: 5px 0; padding-left: 20px; font-size: 14px">\n              <li v-for="feature in t(\'helpPage.updates.v131.newFeaturesList\')" :key="feature">{{ feature }}</li>\n            </ul>\n          </div>\n          <div style="margin-bottom: 15px">\n            <div style="color: #6366f1; font-weight: 600; margin-bottom: 8px">\n              {{ t(\'helpPage.updates.v131.optimize\') }}\n            </div>\n            <ul style="margin: 5px 0; padding-left: 20px; font-size: 14px">\n              <li v-for="opt in t(\'helpPage.updates.v131.optimizeFeatures\')" :key="opt">{{ opt }}</li>\n            </ul>\n          </div>\n        </div>\n\n        \x3c!-- v1.30 --\x3e\n        <div\n          style="\n            padding: 20px;\n            background: rgba(99, 102, 241, 0.05);\n            border-left: 4px solid #6366f1;\n            border-radius: 8px;\n            margin-bottom: 15px;\n          "\n        >\n          <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px">\n            <div style="font-size: 16px; font-weight: 600; color: #6366f1">v1.30</div>\n            <div style="font-size: 13px; color: #888">{{ t(\'helpPage.updates.v130.date\') }}</div>\n          </div>\n\n          <div style="margin-bottom: 15px">\n            <div style="color: #10b981; font-weight: 600; margin-bottom: 8px">\n              {{ t(\'helpPage.updates.v130.newFeatures\') }}\n            </div>\n            <ul style="margin: 5px 0; padding-left: 20px; font-size: 14px">\n              <li v-for="feature in t(\'helpPage.updates.v130.newFeaturesList\')" :key="feature">{{ feature }}</li>\n            </ul>\n          </div>\n          <div style="margin-bottom: 15px">\n            <div style="color: #6366f1; font-weight: 600; margin-bottom: 8px">\n              {{ t(\'helpPage.updates.v130.optimize\') }}\n            </div>\n            <ul style="margin: 5px 0; padding-left: 20px; font-size: 14px">\n              <li v-for="opt in t(\'helpPage.updates.v130.optimizeFeatures\')" :key="opt">{{ opt }}</li>\n            </ul>\n          </div>\n        </div>\n\n        \x3c!-- v1.29 --\x3e\n        <div\n          style="\n            padding: 20px;\n            background: rgba(99, 102, 241, 0.05);\n            border-left: 4px solid #6366f1;\n            border-radius: 8px;\n            margin-bottom: 15px;\n          "\n        >\n          <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px">\n            <div style="font-size: 16px; font-weight: 600; color: #6366f1">v1.29</div>\n            <div style="font-size: 13px; color: #888">{{ t(\'helpPage.updates.v129.date\') }}</div>\n          </div>\n\n          <div style="margin-bottom: 15px">\n            <div style="color: #10b981; font-weight: 600; margin-bottom: 8px">\n              {{ t(\'helpPage.updates.v129.newFeatures\') }}\n            </div>\n            <ul style="margin: 5px 0; padding-left: 20px; font-size: 14px">\n              <li v-for="feature in t(\'helpPage.updates.v129.newFeaturesList\')" :key="feature">{{ feature }}</li>\n            </ul>\n          </div>\n        </div>\n\n        \x3c!-- v1.28 --\x3e\n        <div\n          style="\n            padding: 20px;\n            background: rgba(99, 102, 241, 0.05);\n            border-left: 4px solid #6366f1;\n            border-radius: 8px;\n            margin-bottom: 15px;\n          "\n        >\n          <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px">\n            <div style="font-size: 16px; font-weight: 600; color: #6366f1">v1.28</div>\n            <div style="font-size: 13px; color: #888">{{ t(\'helpPage.updates.v128.date\') }}</div>\n          </div>\n\n          <div style="margin-bottom: 15px">\n            <div style="color: #dc3545; font-weight: 600; margin-bottom: 8px">\n              {{ t(\'helpPage.updates.v128.majorUpdate\') }}\n            </div>\n            <ul style="margin: 5px 0; padding-left: 20px; font-size: 14px">\n              <li v-for="feature in t(\'helpPage.updates.v128.majorUpdateList\')" :key="feature">{{ feature }}</li>\n            </ul>\n          </div>\n        </div>\n\n        \x3c!-- v1.27 --\x3e\n        <div\n          style="\n            padding: 20px;\n            background: rgba(40, 167, 69, 0.05);\n            border-left: 4px solid #28a745;\n            border-radius: 8px;\n            margin-bottom: 15px;\n          "\n        >\n          <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px">\n            <div style="font-size: 16px; font-weight: 600; color: #28a745">v1.27</div>\n            <div style="font-size: 13px; color: #888">{{ t(\'helpPage.updates.v127.date\') }}</div>\n          </div>\n\n          <div style="margin-bottom: 15px">\n            <div style="color: #28a745; font-weight: 600; margin-bottom: 8px">\n              {{ t(\'helpPage.updates.v127.newFeatures\') }}\n            </div>\n            <ul style="margin: 5px 0; padding-left: 20px; font-size: 14px">\n              <li v-for="feature in t(\'helpPage.updates.v127.newFeaturesList\')" :key="feature">{{ feature }}</li>\n            </ul>\n          </div>\n        </div>\n\n        \x3c!-- v1.26 --\x3e\n        <div\n          style="\n            padding: 20px;\n            background: rgba(40, 167, 69, 0.05);\n            border-left: 4px solid #28a745;\n            border-radius: 8px;\n            margin-bottom: 15px;\n          "\n        >\n          <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px">\n            <div style="font-size: 16px; font-weight: 600; color: #28a745">v1.26</div>\n            <div style="font-size: 13px; color: #888">{{ t(\'helpPage.updates.v126.date\') }}</div>\n          </div>\n\n          <div style="margin-bottom: 15px">\n            <div style="color: #28a745; font-weight: 600; margin-bottom: 8px">\n              {{ t(\'helpPage.updates.v126.newFeatures\') }}\n            </div>\n            <ul style="margin: 5px 0; padding-left: 20px; font-size: 14px">\n              <li v-for="feature in t(\'helpPage.updates.v126.newFeaturesList\')" :key="feature">{{ feature }}</li>\n            </ul>\n          </div>\n        </div>\n\n        \x3c!-- v1.25 --\x3e\n        <div\n          style="\n            padding: 20px;\n            background: rgba(40, 167, 69, 0.05);\n            border-left: 4px solid #28a745;\n            border-radius: 8px;\n            margin-bottom: 15px;\n          "\n        >\n          <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px">\n            <div style="font-size: 16px; font-weight: 600; color: #28a745">v1.25</div>\n            <div style="font-size: 13px; color: #888">{{ t(\'helpPage.updates.v125.date\') }}</div>\n          </div>\n\n          <div style="margin-bottom: 15px">\n            <div style="color: #28a745; font-weight: 600; margin-bottom: 8px">\n              {{ t(\'helpPage.updates.v125.newFeatures\') }}\n            </div>\n            <ul style="margin: 5px 0; padding-left: 20px; font-size: 14px">\n              <li v-for="feature in t(\'helpPage.updates.v125.newFeaturesList\')" :key="feature">{{ feature }}</li>\n            </ul>\n          </div>\n        </div>\n\n        \x3c!-- v1.0.0 --\x3e\n        <div\n          style="\n            padding: 20px;\n            background: rgba(220, 53, 69, 0.05);\n            border-left: 4px solid #dc3545;\n            border-radius: 8px;\n            margin-bottom: 15px;\n          "\n        >\n          <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px">\n            <div style="font-size: 16px; font-weight: 600; color: #dc3545">v1.0.0</div>\n            <div style="font-size: 13px; color: #888">{{ t(\'helpPage.updates.v100.date\') }}</div>\n          </div>\n\n          <ul style="margin: 5px 0; padding-left: 20px; font-size: 14px">\n            <li v-for="feature in t(\'helpPage.updates.v100.features\')" :key="feature">{{ feature }}</li>\n          </ul>\n        </div>\n      </div>\n    </div>\n\n    \x3c!-- å…³äº --\x3e\n    <div\n      style="\n        text-align: center;\n        color: #888;\n        font-size: 13px;\n        padding: 20px;\n        border-top: 1px solid rgba(255, 255, 255, 0.1);\n      "\n    >\n      <div style="margin-bottom: 8px">\n        {{ t(\'helpPage.madeWith\') }} <span style="color: #dc3545">â¤ï¸</span> {{ t(\'helpPage.by\') }} mzrodyu\n      </div>\n      <div style="font-size: 12px">\n        {{ t(\'helpPage.basedOn\') }}\n        <a\n          href="https://github.com/SillyTavern/SillyTavern"\n          target="_blank"\n          style="color: #4a9eff; text-decoration: none"\n          >SillyTavern</a\n        >\n        {{ t(\'helpPage.and\') }}\n        <a\n          href="https://n0vi028.github.io/JS-Slash-Runner-Doc/"\n          target="_blank"\n          style="color: #4a9eff; text-decoration: none"\n          >Tavern Helper</a\n        >\n      </div>\n    </div>\n  </div>\n</template>\n\n<script setup lang="ts">\nimport { computed, ref } from \'vue\';\nimport { useI18n } from \'vue-i18n\';\nimport { checkForUpdates } from \'../version-checker\';\n\nconst { t, locale } = useI18n();\nconst currentLocale = computed(() => locale.value);\n\n// æŠ˜å å±•å¼€çŠ¶æ€\nconst expandedSections = ref({\n  usage: false,\n  changelog: false,\n});\n\n// æ£€æŸ¥æ›´æ–°\nconst checkUpdate = () => {\n  checkForUpdates(true);\n};\n\n// ä¸‹è½½æœ€æ–°ç‰ˆæœ¬\nconst downloadLatest = async () => {\n  try {\n    window.toastr.info(\n      currentLocale.value === \'zh-CN\' ? \'æ­£åœ¨è·å–æœ€æ–°ç‰ˆæœ¬ä¿¡æ¯...\' : \'Fetching latest version info...\',\n      currentLocale.value === \'zh-CN\' ? \'ä¸‹è½½ä¸­\' : \'Downloading\',\n      { timeOut: 2000 },\n    );\n\n    // 1. è·å–æœ€æ–°ç‰ˆæœ¬å·\n    const timestamp = Date.now();\n    const versionResponse = await fetch(\n      `https://testingcf.jsdelivr.net/gh/mzrodyu/maomao/dist/è®°å¿†_with_worldbook/version.json?_=${timestamp}`,\n    );\n\n    if (!versionResponse.ok) {\n      throw new Error(currentLocale.value === \'zh-CN\' ? \'æ— æ³•è·å–ç‰ˆæœ¬ä¿¡æ¯\' : \'Failed to fetch version info\');\n    }\n\n    const versionInfo = await versionResponse.json();\n    const version = versionInfo.version;\n\n    window.toastr.info(\n      currentLocale.value === \'zh-CN\' ? `æ­£åœ¨ä¸‹è½½ v${version}...` : `Downloading v${version}...`,\n      currentLocale.value === \'zh-CN\' ? \'ä¸‹è½½ä¸­\' : \'Downloading\',\n      { timeOut: 2000 },\n    );\n\n    // 2. ä¸‹è½½å¯¹åº”ç‰ˆæœ¬çš„ JSON æ–‡ä»¶\n    const jsonUrl = `https://testingcf.jsdelivr.net/gh/mzrodyu/maomao/dist/è®°å¿†_with_worldbook/çŒ«çŒ«çš„å†™å¡å°å·¥å…· v${version}.json?_=${timestamp}`;\n    const jsonResponse = await fetch(jsonUrl);\n\n    if (!jsonResponse.ok) {\n      throw new Error(\n        currentLocale.value === \'zh-CN\'\n          ? `ä¸‹è½½å¤±è´¥: HTTP ${jsonResponse.status}`\n          : `Download failed: HTTP ${jsonResponse.status}`,\n      );\n    }\n\n    const jsonContent = await jsonResponse.text();\n\n    // 3. åˆ›å»ºä¸‹è½½é“¾æ¥\n    const blob = new Blob([jsonContent], { type: \'application/json\' });\n    const url = URL.createObjectURL(blob);\n    const a = document.createElement(\'a\');\n    a.href = url;\n    a.download = `çŒ«çŒ«çš„å†™å¡å°å·¥å…· v${version}.json`;\n    document.body.appendChild(a);\n    a.click();\n    document.body.removeChild(a);\n    URL.revokeObjectURL(url);\n\n    window.toastr.success(\n      currentLocale.value === \'zh-CN\'\n        ? `v${version} å·²ä¸‹è½½å®Œæˆï¼Œè¯·åœ¨é…’é¦†è„šæœ¬åº“é‡æ–°å¯¼å…¥è¯¥æ–‡ä»¶`\n        : `v${version} downloaded successfully, please re-import the file in SillyTavern script library`,\n      currentLocale.value === \'zh-CN\' ? \'ä¸‹è½½æˆåŠŸ\' : \'Success\',\n      { timeOut: 8000 },\n    );\n  } catch (error: any) {\n    console.error(\'ä¸‹è½½å¤±è´¥:\', error);\n    window.toastr.error(\n      (currentLocale.value === \'zh-CN\' ? \'ä¸‹è½½å¤±è´¥: \' : \'Download failed: \') + error.message,\n      currentLocale.value === \'zh-CN\' ? \'é”™è¯¯\' : \'Error\',\n      { timeOut: 5000 },\n    );\n  }\n};\n<\/script>\n\n<style scoped>\n@keyframes fadeIn {\n  from {\n    opacity: 0;\n    transform: translateY(-10px);\n  }\n  to {\n    opacity: 1;\n    transform: translateY(0);\n  }\n}\n\n.update-list {\n  margin: 5px 0;\n  padding-left: 20px;\n  font-size: 14px;\n}\n\n.update-item {\n  margin-bottom: 8px;\n  line-height: 1.6;\n}\n</style>\n'],sourceRoot:''}]);const i=s},368:(e,n,t)=>{var a=t(831);a.__esModule&&(a=a.default),'string'==typeof a&&(a=[[e.id,a,'']]),a.locals&&(e.exports=a.locals);(0,t(424).A)('9e3a34be',a,!1,{ssrId:!0})},390:(e,n,t)=>{t.r(n),t.d(n,{default:()=>i});var a=t(790),o=t.n(a),r=t(54),s=t.n(r)()(o());s.push([e.id,'.regex-ui-generator[data-v-f1283e36]{height:100%;overflow-y:auto}button[data-v-f1283e36]:disabled{cursor:not-allowed !important;opacity:0.5 !important}button[data-v-f1283e36]:not(:disabled):hover{transform:translateY(-2px);box-shadow:0 4px 12px rgba(0,0,0,0.3)}code[data-v-f1283e36]{background:#1a1a1a;padding:2px 6px;border-radius:3px;font-family:\'Consolas\',monospace}pre[data-v-f1283e36]::-webkit-scrollbar{width:8px;height:8px}pre[data-v-f1283e36]::-webkit-scrollbar-track{background:#1a1a1a}pre[data-v-f1283e36]::-webkit-scrollbar-thumb{background:#4a9eff;border-radius:4px}pre[data-v-f1283e36]::-webkit-scrollbar-thumb:hover{background:#5ab0ff}\n','',{version:3,sources:['webpack://./src/è®°å¿†_with_worldbook/components/RegexUIGenerator.vue'],names:[],mappings:'AAuqBA,qCACE,WAAY,CACZ,eACF,CAEA,iCACE,6BAA8B,CAC9B,sBACF,CAEA,6CACE,0BAA2B,CAC3B,qCACF,CAEA,sBACE,kBAAmB,CACnB,eAAgB,CAChB,iBAAkB,CAClB,gCACF,CAEA,wCACE,SAAU,CACV,UACF,CAEA,8CACE,kBACF,CAEA,8CACE,kBAAmB,CACnB,iBACF,CAEA,oDACE,kBACF',sourcesContent:['<template>\n  <div class="regex-ui-generator" style="padding: 25px !important; background: #1a1a1a !important">\n    \x3c!-- æ ‡é¢˜ --\x3e\n    <div\n      style="\n        background: linear-gradient(135deg, rgba(102, 126, 234, 0.1) 0%, rgba(118, 75, 162, 0.1) 100%);\n        padding: 20px;\n        border-radius: 12px;\n        margin-bottom: 20px;\n        border: 1px solid rgba(102, 126, 234, 0.2);\n      "\n    >\n      <h3 style="color: #4a9eff; margin: 0 0 10px 0; font-size: 20px; font-weight: 600">ğŸ”§ é…’é¦†æ­£åˆ™ç•Œé¢ç”Ÿæˆå™¨</h3>\n      <p style="color: #888; margin: 0; font-size: 14px; line-height: 1.6">\n        AI è¾…åŠ©ç”Ÿæˆé…’é¦†æ­£åˆ™æ›¿æ¢ç•Œé¢ï¼Œç”¨è‡ªç„¶è¯­è¨€æè¿°å³å¯ç”Ÿæˆå®Œæ•´çš„ HTML/CSS/JS ä»£ç \n      </p>\n    </div>\n\n    \x3c!-- æ–°æ‰‹ä½¿ç”¨æµç¨‹ --\x3e\n    <div\n      style="\n        background: #2a2a2a;\n        padding: 20px;\n        border-radius: 8px;\n        margin-bottom: 20px;\n        border-left: 4px solid #ffc107;\n      "\n    >\n      <h4 style="color: #ffc107; margin: 0 0 15px 0; font-size: 16px; display: flex; align-items: center; gap: 8px">\n        <i class="fa-solid fa-lightbulb"></i>\n        æ–°æ‰‹ä½¿ç”¨æµç¨‹ï¼ˆè¶…ç®€å•ï¼ï¼‰ï¼š\n      </h4>\n      <ol style="margin: 0; padding-left: 20px; color: #ccc; line-height: 2">\n        <li>\n          <strong style="color: #fff">ç¬¬1æ­¥ï¼š</strong> è¾“å…¥è§¦å‘è¯ï¼ˆæ¯”å¦‚\n          <code style="background: #1a1a1a; padding: 2px 6px; border-radius: 3px; color: #4a9eff">ã€çŠ¶æ€æ ã€‘</code>\n          ï¼‰\n        </li>\n        <li><strong style="color: #fff">ç¬¬2æ­¥ï¼š</strong> ç”¨è‡ªç„¶è¯­è¨€æè¿°ä½ æƒ³è¦çš„ç•Œé¢ï¼ˆçœç•¥æŠ€æœ¯ç»†èŠ‚ï¼‰</li>\n        <li><strong style="color: #fff">ç¬¬3æ­¥ï¼š</strong> ç‚¹å‡»"AI ç”Ÿæˆ"ï¼Œç­‰å‡ ç§’é’Ÿï¼ŒAI è‡ªåŠ¨ç”Ÿæˆä»£ç </li>\n        <li>\n          <strong style="color: #fff">ç¬¬4æ­¥ï¼š</strong> çœ‹å³ä¾§<strong style="color: #51cf66">å®æ—¶é¢„è§ˆ</strong\n          >ï¼Œä¸æ»¡æ„å°±ç‚¹"AI ä¿®æ”¹"ç»§ç»­è°ƒæ•´\n        </li>\n        <li><strong style="color: #fff">ç¬¬5æ­¥ï¼š</strong> ç‚¹å‡»"å¤åˆ¶æ­£åˆ™"ï¼Œç›´æ¥ç²˜è´´åˆ°é…’é¦†æ­£åˆ™é‡Œå°±å®Œäº†ï¼</li>\n        <li>\n          <strong style="color: #fff">å®Œæˆï¼</strong> ç°åœ¨åœ¨èŠå¤©ä¸­è¾“å…¥\n          <code style="background: #1a1a1a; padding: 2px 6px; border-radius: 3px; color: #51cf66">ã€çŠ¶æ€æ ã€‘</code>\n          å°±ä¼šæ˜¾ç¤ºä½ çš„ç•Œé¢äº†ï¼\n        </li>\n      </ol>\n    </div>\n\n    \x3c!-- ä¸»å†…å®¹åŒºåŸŸï¼šå·¦å³åˆ†æ  --\x3e\n    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 20px">\n      \x3c!-- å·¦ä¾§ï¼šè¾“å…¥åŒºåŸŸ --\x3e\n      <div style="display: flex; flex-direction: column; gap: 20px">\n        \x3c!-- è§¦å‘å…³é”®è¯ --\x3e\n        <div style="background: #2a2a2a; padding: 20px; border-radius: 8px">\n          <h4 style="color: #4a9eff; margin: 0 0 15px 0; font-size: 16px">\n            <i class="fa-solid fa-key"></i>\n            è§¦å‘å…³é”®è¯:\n          </h4>\n          <input\n            v-model="triggerKeyword"\n            type="text"\n            placeholder="è¾“å…¥è§¦å‘è¯ï¼Œä¾‹å¦‚ï¼šã€å¼€åœºç™½ã€‘"\n            style="\n              width: 100%;\n              background: #1a1a1a;\n              color: #e0e0e0;\n              border: 1px solid #444;\n              border-radius: 4px;\n              padding: 12px;\n              font-size: 14px;\n            "\n          />\n        </div>\n\n        \x3c!-- ç•Œé¢æè¿°ï¼ˆAI ç”Ÿæˆï¼‰ --\x3e\n        <div\n          style="background: #2a2a2a; padding: 20px; border-radius: 8px; flex: 1; display: flex; flex-direction: column"\n        >\n          <h4 style="color: #4a9eff; margin: 0 0 15px 0; font-size: 16px">\n            <i class="fa-solid fa-magic"></i>\n            ç•Œé¢æè¿°ï¼ˆAI ç”Ÿæˆï¼‰:\n          </h4>\n          <p style="color: #888; margin: 0 0 10px 0; font-size: 13px">\n            ç”¨è‡ªç„¶è¯­è¨€æè¿°ä½ æƒ³è¦çš„ç•Œé¢ï¼Œæ¯”å¦‚ï¼šä¸€ä¸ªRPGæ¸¸æˆé£æ ¼çš„çŠ¶æ€æ ï¼Œæ˜¾ç¤ºç”Ÿå‘½å€¼ã€é­”åŠ›å€¼ã€ç»éªŒå€¼...\n          </p>\n          <textarea\n            v-model="interfaceDescription"\n            placeholder="è¯¦ç»†æè¿°ä½ æƒ³è¦çš„ç•Œé¢ï¼ˆè¶Šè¯¦ç»†è¶Šå¥½ï¼‰ï¼š&#10;- è¯´æ¸…æ¥šä½ æƒ³è¦ä»€ä¹ˆåŠŸèƒ½ï¼ˆå¦‚ï¼šç”Ÿå‘½å€¼ã€é­”åŠ›å€¼ã€ç»éªŒå€¼ï¼‰&#10;- è¯´æ¸…æ¥šä½ æƒ³è¦ä»€ä¹ˆæ ·å¼ï¼ˆå¦‚ï¼šRPGæ¸¸æˆé£æ ¼ã€èµ›åšæœ‹å…‹ã€å¯çˆ±é£ç­‰ï¼‰&#10;- å¦‚æœæƒ³è¦ç‰¹æ®Šæ•ˆæœï¼ˆå¦‚ï¼šè¿›åº¦æ¡ã€åŠ¨ç”»ã€æŒ‰é’®ï¼‰ï¼Œä¹Ÿå†™æ¸…æ¥š&#10;&#10;ä¾‹å¦‚ï¼š&#10;æˆ‘æƒ³è¦ä¸€ä¸ªç°ä»£ç®€æ´é£æ ¼çš„çŠ¶æ€æ ï¼Œæ˜¾ç¤ºå½“å‰æ—¥æœŸã€æ—¶é—´ã€åœ°ç‚¹ã€å¤©æ°”æ¸©åº¦ã€‚"\n            style="\n              width: 100%;\n              flex: 1;\n              min-height: 200px;\n              background: #1a1a1a;\n              color: #e0e0e0;\n              border: 1px solid #444;\n              border-radius: 4px;\n              padding: 12px;\n              font-size: 14px;\n              font-family: \'Consolas\', monospace;\n              resize: none;\n              line-height: 1.6;\n            "\n          />\n\n          \x3c!-- AI ç”Ÿæˆ/ä¿®æ”¹æŒ‰é’® --\x3e\n          <div style="display: flex; gap: 12px; margin-top: 15px">\n            <button\n              :disabled="!triggerKeyword || !interfaceDescription || isGenerating"\n              style="\n                flex: 1;\n                background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);\n                color: white;\n                border: none;\n                padding: 12px 24px;\n                border-radius: 6px;\n                cursor: pointer;\n                font-size: 14px;\n                font-weight: 600;\n                transition: all 0.3s;\n              "\n              :style="{ opacity: !triggerKeyword || !interfaceDescription || isGenerating ? 0.5 : 1 }"\n              @click="generateWithAI"\n            >\n              <i class="fa-solid fa-wand-magic-sparkles"></i>\n              {{ isGenerating ? \'AI ç”Ÿæˆä¸­...\' : generatedCode ? \'AI é‡æ–°ç”Ÿæˆ\' : \'AI ç”Ÿæˆç•Œé¢\' }}\n            </button>\n            <button\n              v-if="generatedCode"\n              :disabled="isModifying"\n              style="\n                flex: 1;\n                background: #ffc107;\n                color: #000;\n                border: none;\n                padding: 12px 24px;\n                border-radius: 6px;\n                cursor: pointer;\n                font-size: 14px;\n                font-weight: 600;\n                transition: all 0.3s;\n              "\n              :style="{ opacity: isModifying ? 0.5 : 1 }"\n              @click="showModifyDialog"\n            >\n              <i class="fa-solid fa-edit"></i>\n              {{ isModifying ? \'ä¿®æ”¹ä¸­...\' : \'AI ä¿®æ”¹ç•Œé¢\' }}\n            </button>\n          </div>\n        </div>\n      </div>\n\n      \x3c!-- å³ä¾§ï¼šå®æ—¶é¢„è§ˆ --\x3e\n      <div style="background: #2a2a2a; padding: 20px; border-radius: 8px; display: flex; flex-direction: column">\n        <h4 style="color: #51cf66; margin: 0 0 15px 0; font-size: 16px; display: flex; align-items: center; gap: 8px">\n          <i class="fa-solid fa-eye"></i>\n          å®æ—¶é¢„è§ˆ\n          <span\n            v-if="generatedCode"\n            style="\n              margin-left: auto;\n              background: #51cf66;\n              color: white;\n              padding: 4px 12px;\n              border-radius: 12px;\n              font-size: 12px;\n            "\n            >å·²ç”Ÿæˆ</span\n          >\n        </h4>\n        <div\n          style="\n            flex: 1;\n            background: #1a1a1a;\n            border: 2px solid #444;\n            border-radius: 6px;\n            overflow: hidden;\n            display: flex;\n            align-items: center;\n            justify-content: center;\n            min-height: 400px;\n          "\n        >\n          <div v-if="!generatedCode" style="text-align: center; color: #666; padding: 40px">\n            <i class="fa-solid fa-image" style="font-size: 64px; margin-bottom: 20px; opacity: 0.3"></i>\n            <p style="font-size: 16px; margin: 0">ç­‰å¾…ç”Ÿæˆ...</p>\n            <p style="font-size: 14px; margin: 10px 0 0 0">ç‚¹å‡»"AI ç”Ÿæˆç•Œé¢"åï¼Œé¢„è§ˆå°†æ˜¾ç¤ºåœ¨è¿™é‡Œ</p>\n          </div>\n          <iframe\n            v-else\n            ref="previewFrame"\n            :srcdoc="generatedCode"\n            style="width: 100%; height: 100%; border: none; background: white"\n          ></iframe>\n        </div>\n\n        \x3c!-- å¤åˆ¶æ­£åˆ™æŒ‰é’® --\x3e\n        <button\n          v-if="generatedCode"\n          style="\n            margin-top: 15px;\n            background: #51cf66;\n            color: white;\n            border: none;\n            padding: 12px 24px;\n            border-radius: 6px;\n            cursor: pointer;\n            font-size: 14px;\n            font-weight: 600;\n            transition: all 0.2s;\n          "\n          @click="copyRegex"\n        >\n          <i class="fa-solid fa-copy"></i> å¤åˆ¶æ­£åˆ™ä»£ç \n        </button>\n      </div>\n    </div>\n\n    \x3c!-- ç”Ÿæˆçš„æ­£åˆ™ä»£ç ï¼ˆå¯æŠ˜å ï¼‰ --\x3e\n    <div v-if="generatedRegex" style="background: #2a2a2a; padding: 20px; border-radius: 8px">\n      <div\n        style="display: flex; justify-content: space-between; align-items: center; cursor: pointer; margin-bottom: 15px"\n        @click="showCode = !showCode"\n      >\n        <h4 style="color: #4a9eff; margin: 0">\n          <i class="fa-solid fa-code"></i>\n          ç”Ÿæˆçš„æ­£åˆ™ä»£ç \n        </h4>\n        <i\n          :class="showCode ? \'fa-solid fa-chevron-up\' : \'fa-solid fa-chevron-down\'"\n          style="color: #888; transition: transform 0.3s"\n        ></i>\n      </div>\n      <div\n        v-if="showCode"\n        style="\n          background: #1a1a1a;\n          padding: 15px;\n          border-radius: 4px;\n          border: 1px solid #444;\n          max-height: 300px;\n          overflow-y: auto;\n        "\n      >\n        <pre\n          style="\n            margin: 0;\n            color: #e0e0e0;\n            font-family: \'Consolas\', monospace;\n            font-size: 13px;\n            white-space: pre-wrap;\n            word-wrap: break-word;\n          "\n          >{{ generatedRegex }}</pre\n        >\n      </div>\n    </div>\n\n    \x3c!-- AI ä¿®æ”¹å¯¹è¯æ¡† --\x3e\n    <div\n      v-if="showModify"\n      style="\n        position: fixed;\n        top: 0;\n        left: 0;\n        right: 0;\n        bottom: 0;\n        background: rgba(0, 0, 0, 0.8);\n        z-index: 1000000;\n        display: flex;\n        align-items: center;\n        justify-content: center;\n        padding: 20px;\n      "\n      @click.self="showModify = false"\n    >\n      <div\n        style="\n          background: #2a2a2a;\n          border: 2px solid #ffc107;\n          border-radius: 12px;\n          padding: 30px;\n          max-width: 600px;\n          width: 100%;\n        "\n        @click.stop\n      >\n        <h3 style="color: #ffc107; margin: 0 0 20px 0">\n          <i class="fa-solid fa-edit"></i>\n          AI ä¿®æ”¹ç•Œé¢\n        </h3>\n        <p style="color: #888; margin: 0 0 15px 0; line-height: 1.6">\n          æè¿°ä½ æƒ³è¦ä¿®æ”¹çš„åœ°æ–¹ï¼ŒAI ä¼šåœ¨å½“å‰ç•Œé¢çš„åŸºç¡€ä¸Šè¿›è¡Œè°ƒæ•´ã€‚ä¾‹å¦‚ï¼š\n        </p>\n        <ul style="color: #888; margin: 0 0 20px 0; padding-left: 20px; line-height: 1.8">\n          <li>æŠŠç”Ÿå‘½å€¼è¿›åº¦æ¡æ”¹æˆçº¢è‰²</li>\n          <li>å¢åŠ ä¸€ä¸ªé‡‘å¸æ˜¾ç¤º</li>\n          <li>è°ƒæ•´æ•´ä½“å¸ƒå±€ï¼Œæ”¹æˆç«–å‘æ’åˆ—</li>\n          <li>æ·»åŠ ä¸€ä¸ªæŒ‰é’®ï¼Œç‚¹å‡»åæ˜¾ç¤ºè¯¦ç»†ä¿¡æ¯</li>\n        </ul>\n        <textarea\n          v-model="modifyInstruction"\n          placeholder="è¾“å…¥ä¿®æ”¹å»ºè®®..."\n          style="\n            width: 100%;\n            min-height: 150px;\n            background: #1a1a1a;\n            color: #e0e0e0;\n            border: 1px solid #444;\n            border-radius: 4px;\n            padding: 12px;\n            font-size: 14px;\n            margin-bottom: 20px;\n            resize: vertical;\n          "\n        ></textarea>\n        <div style="display: flex; gap: 12px">\n          <button\n            :disabled="!modifyInstruction || isModifying"\n            style="\n              flex: 1;\n              background: #ffc107;\n              color: #000;\n              border: none;\n              padding: 12px 24px;\n              border-radius: 6px;\n              cursor: pointer;\n              font-size: 14px;\n              font-weight: 600;\n            "\n            :style="{ opacity: !modifyInstruction || isModifying ? 0.5 : 1 }"\n            @click="modifyWithAI"\n          >\n            <i class="fa-solid fa-wand-magic-sparkles"></i>\n            {{ isModifying ? \'ä¿®æ”¹ä¸­...\' : \'ç¡®è®¤ä¿®æ”¹\' }}\n          </button>\n          <button\n            style="\n              flex: 1;\n              background: #666;\n              color: white;\n              border: none;\n              padding: 12px 24px;\n              border-radius: 6px;\n              cursor: pointer;\n              font-size: 14px;\n              font-weight: 600;\n            "\n            @click="showModify = false"\n          >\n            å–æ¶ˆ\n          </button>\n        </div>\n      </div>\n    </div>\n  </div>\n</template>\n\n<script setup lang="ts">\nimport { ref } from \'vue\';\nimport { normalizeApiEndpoint, useSettingsStore } from \'../settings\';\nimport { copyToClipboard } from \'../utils\';\n\nconst settingsStore = useSettingsStore();\nconst settings = settingsStore.settings;\n\nconst triggerKeyword = ref(\'ã€å¼€åœºç™½ã€‘\');\nconst interfaceDescription = ref(\'\');\nconst generatedCode = ref(\'\');\nconst generatedRegex = ref(\'\');\nconst isGenerating = ref(false);\nconst isModifying = ref(false);\nconst showCode = ref(false);\nconst showModify = ref(false);\nconst modifyInstruction = ref(\'\');\nconst previewFrame = ref<HTMLIFrameElement | null>(null);\n\n// AI ç”Ÿæˆç•Œé¢ä»£ç \nconst generateWithAI = async () => {\n  if (!triggerKeyword.value || !interfaceDescription.value) {\n    window.toastr.warning(\'è¯·å¡«å†™è§¦å‘å…³é”®è¯å’Œç•Œé¢æè¿°\');\n    return;\n  }\n\n  isGenerating.value = true;\n\n  try {\n    const prompt = `ä½ æ˜¯ä¸€ä¸ªé…’é¦†æ­£åˆ™æ›¿æ¢ä¸“å®¶ã€‚è¯·æ ¹æ®ç”¨æˆ·çš„æè¿°ï¼Œç”Ÿæˆä¸€ä¸ªå®Œæ•´çš„ HTML ç•Œé¢ä»£ç ã€‚\n\nç”¨æˆ·æä¾›çš„è§¦å‘å…³é”®è¯ï¼š${triggerKeyword.value}\n\nç”¨æˆ·çš„ç•Œé¢æè¿°ï¼š\n${interfaceDescription.value}\n\nè¯·ç”Ÿæˆå®Œæ•´çš„ HTML ä»£ç ï¼ŒåŒ…å«ï¼š\n1. HTML ç»“æ„\n2. å†…åµŒçš„ <style> æ ‡ç­¾ï¼ˆCSS æ ·å¼ï¼‰\n3. å†…åµŒçš„ <script> æ ‡ç­¾ï¼ˆå¦‚æœéœ€è¦ JS åŠŸèƒ½ï¼‰\n\nè¦æ±‚ï¼š\n- HTML ä»£ç è¦ç¾è§‚ã€ç°ä»£åŒ–\n- CSS æ ·å¼è¦ç²¾ç¾ï¼Œç¬¦åˆç”¨æˆ·æè¿°çš„é£æ ¼\n- JS ä»£ç è¦ç®€æ´å®ç”¨ï¼ˆå¦‚æœéœ€è¦ï¼‰\n- æ•´ä½“ç•Œé¢è¦ç¬¦åˆç”¨æˆ·çš„æè¿°\n- ä»£ç è¦å®Œæ•´å¯ç”¨ï¼Œå¯ä»¥ç›´æ¥åœ¨æµè§ˆå™¨ä¸­è¿è¡Œ\n\nç›´æ¥è¾“å‡ºå®Œæ•´çš„ HTML ä»£ç ï¼Œä» <!DOCTYPE html> æˆ– <div> å¼€å§‹ï¼Œä¸è¦æœ‰å…¶ä»–è¯´æ˜æ–‡å­—ã€‚`;\n\n    const apiUrl = normalizeApiEndpoint(settings.api_endpoint);\n\n    const response = await fetch(apiUrl, {\n      method: \'POST\',\n      headers: {\n        \'Content-Type\': \'application/json\',\n        Authorization: `Bearer ${settings.api_key}`,\n      },\n      body: JSON.stringify({\n        model: settings.model,\n        messages: [\n          {\n            role: \'system\',\n            content: \'ä½ æ˜¯ä¸€ä¸ªä¸“ä¸šçš„å‰ç«¯å¼€å‘ä¸“å®¶ï¼Œæ“…é•¿ç”Ÿæˆç¾è§‚çš„ HTML/CSS/JS ä»£ç ã€‚è¯·æ ¹æ®ç”¨æˆ·æè¿°ç”Ÿæˆå®Œæ•´çš„ç•Œé¢ä»£ç ã€‚\',\n          },\n          { role: \'user\', content: prompt },\n        ],\n        temperature: 0.7,\n        max_tokens: 4000,\n      }),\n    });\n\n    if (!response.ok) {\n      throw new Error(`API è¯·æ±‚å¤±è´¥: ${response.status}`);\n    }\n\n    const data = await response.json();\n    let result = data.choices?.[0]?.message?.content || \'\';\n\n    console.log(\'ğŸ“ [ç•Œé¢ç”Ÿæˆ] AI åŸå§‹è¿”å›é•¿åº¦:\', result.length);\n    console.log(\'ğŸ“ [ç•Œé¢ç”Ÿæˆ] AI åŸå§‹è¿”å›å‰500å­—ç¬¦:\', result.substring(0, 500));\n\n    // ç§»é™¤å¯èƒ½çš„ markdown ä»£ç å—æ ‡è®°\n    result = result\n      .replace(/```html\\n?/g, \'\')\n      .replace(/```\\n?/g, \'\')\n      .trim();\n\n    // å°è¯•æå–HTMLä»£ç ï¼ˆå¤„ç†AIæ¨ç†è¿‡ç¨‹ï¼‰\n    // 1. å…ˆæŸ¥æ‰¾ <!DOCTYPE html å¼€å¤´çš„å®Œæ•´æ–‡æ¡£\n    const doctypeMatch = result.match(/<!DOCTYPE html>[\\s\\S]*/i);\n    if (doctypeMatch) {\n      result = doctypeMatch[0].trim();\n      console.log(\'âœ… [ç•Œé¢ç”Ÿæˆ] æå–åˆ°å®Œæ•´çš„HTMLæ–‡æ¡£ï¼ˆå«DOCTYPEï¼‰\');\n    } else {\n      // 2. å¦‚æœæ²¡æœ‰DOCTYPEï¼ŒæŸ¥æ‰¾ <html å¼€å¤´çš„éƒ¨åˆ†\n      const htmlMatch = result.match(/<html[\\s\\S]*/i);\n      if (htmlMatch) {\n        result = htmlMatch[0].trim();\n        console.log(\'âœ… [ç•Œé¢ç”Ÿæˆ] æå–åˆ°HTMLæ–‡æ¡£ï¼ˆä¸å«DOCTYPEï¼‰\');\n      } else if (result.includes(\'<\') && result.includes(\'>\')) {\n        // 3. å¦‚æœæ²¡æœ‰å®Œæ•´çš„htmlæ ‡ç­¾ï¼Œä½†åŒ…å«HTMLæ ‡ç­¾\n        console.log(\'âš ï¸ [ç•Œé¢ç”Ÿæˆ] åŒ…å«HTMLæ ‡ç­¾ä½†æ ¼å¼ä¸æ ‡å‡†ï¼Œå°è¯•åŒ…è£…\');\n        // å°è¯•åŒ…è£…æˆå®Œæ•´æ–‡æ¡£\n        if (!result.includes(\'<html\')) {\n          result = `<!DOCTYPE html>\n<html>\n<head>\n  <meta charset="UTF-8">\n  <meta name="viewport" content="width=device-width, initial-scale=1.0">\n</head>\n<body>\n${result}\n</body>\n</html>`;\n          console.log(\'âœ… [ç•Œé¢ç”Ÿæˆ] å·²è‡ªåŠ¨åŒ…è£…ä¸ºå®Œæ•´HTMLæ–‡æ¡£\');\n        }\n      } else {\n        // 4. å¦‚æœå®Œå…¨æ²¡æœ‰HTMLæ ‡ç­¾ï¼Œè¯´æ˜AIè¿”å›çš„æ˜¯çº¯æ–‡æœ¬æˆ–æ¨ç†è¿‡ç¨‹\n        console.error(\'âŒ [ç•Œé¢ç”Ÿæˆ] AIæœªè¿”å›æœ‰æ•ˆçš„HTMLä»£ç \');\n        console.error(\'AIè¿”å›å†…å®¹:\', result);\n        throw new Error(\'AIæœªè¿”å›æœ‰æ•ˆçš„HTMLä»£ç ï¼Œè¯·å°è¯•æ›´è¯¦ç»†çš„ç•Œé¢æè¿°æˆ–æ›´æ¢æ¨¡å‹\');\n      }\n    }\n\n    console.log(\'ğŸ“ [ç•Œé¢ç”Ÿæˆ] æœ€ç»ˆHTMLé•¿åº¦:\', result.length);\n\n    generatedCode.value = result;\n\n    // ç”Ÿæˆæ­£åˆ™é…ç½®ï¼ˆç¬¦åˆé…’é¦†æ­£åˆ™æ ¼å¼ï¼‰\n    const findRegex = triggerKeyword.value.replace(/[.*+?^${}()|[\\]\\\\]/g, \'\\\\$&\');\n    const regexJson = {\n      id: `regex_ui_${Date.now()}`,\n      scriptName: `ç•Œé¢_${triggerKeyword.value}`,\n      findRegex: findRegex,\n      replaceString: result,\n      trimStrings: [],\n      placement: [2], // AIè¾“å‡ºåå¤„ç†\n      disabled: false,\n      markdownOnly: true,\n      promptOnly: false,\n      runOnEdit: true,\n      substituteRegex: 0,\n      minDepth: null,\n      maxDepth: null,\n    };\n    generatedRegex.value = JSON.stringify(regexJson, null, 2);\n\n    window.toastr.success(\'AI ç”ŸæˆæˆåŠŸï¼\');\n  } catch (error) {\n    console.error(\'AI ç”Ÿæˆå¤±è´¥:\', error);\n    window.toastr.error(\'AI ç”Ÿæˆå¤±è´¥: \' + (error as Error).message);\n  } finally {\n    isGenerating.value = false;\n  }\n};\n\n// æ˜¾ç¤ºä¿®æ”¹å¯¹è¯æ¡†\nconst showModifyDialog = () => {\n  modifyInstruction.value = \'\';\n  showModify.value = true;\n};\n\n// AI ä¿®æ”¹ç•Œé¢ï¼ˆå¢é‡ä¿®æ”¹ï¼‰\nconst modifyWithAI = async () => {\n  if (!modifyInstruction.value) {\n    window.toastr.warning(\'è¯·è¾“å…¥ä¿®æ”¹å»ºè®®\');\n    return;\n  }\n\n  isModifying.value = true;\n\n  try {\n    // ä½¿ç”¨å¢é‡ä¿®æ”¹ï¼šåªå‘é€åŸå§‹æè¿° + ä¿®æ”¹å»ºè®®ï¼Œè®© AI é‡æ–°ç”Ÿæˆ\n    const prompt = `ä½ æ˜¯ä¸€ä¸ªé…’é¦†æ­£åˆ™æ›¿æ¢ä¸“å®¶ã€‚è¯·æ ¹æ®ç”¨æˆ·çš„ç•Œé¢æè¿°å’Œä¿®æ”¹å»ºè®®ï¼Œç”Ÿæˆå®Œæ•´çš„ HTML ç•Œé¢ä»£ç ã€‚\n\nç”¨æˆ·æä¾›çš„è§¦å‘å…³é”®è¯ï¼š${triggerKeyword.value}\n\nåŸå§‹ç•Œé¢æè¿°ï¼š\n${interfaceDescription.value}\n\nç”¨æˆ·çš„ä¿®æ”¹å»ºè®®ï¼š\n${modifyInstruction.value}\n\nè¯·æ ¹æ®åŸå§‹æè¿°å’Œä¿®æ”¹å»ºè®®ï¼Œç”Ÿæˆå®Œæ•´çš„ HTML ä»£ç ï¼ŒåŒ…å«ï¼š\n1. HTML ç»“æ„\n2. å†…åµŒçš„ <style> æ ‡ç­¾ï¼ˆCSS æ ·å¼ï¼‰\n3. å†…åµŒçš„ <script> æ ‡ç­¾ï¼ˆå¦‚æœéœ€è¦ JS åŠŸèƒ½ï¼‰\n\nè¦æ±‚ï¼š\n- åœ¨åŸå§‹æè¿°çš„åŸºç¡€ä¸Šï¼Œåº”ç”¨ç”¨æˆ·çš„ä¿®æ”¹å»ºè®®\n- HTML ä»£ç è¦ç¾è§‚ã€ç°ä»£åŒ–\n- CSS æ ·å¼è¦ç²¾ç¾\n- JS ä»£ç è¦ç®€æ´å®ç”¨ï¼ˆå¦‚æœéœ€è¦ï¼‰\n- ä»£ç è¦å®Œæ•´å¯ç”¨ï¼Œå¯ä»¥ç›´æ¥åœ¨æµè§ˆå™¨ä¸­è¿è¡Œ\n\nç›´æ¥è¾“å‡ºå®Œæ•´çš„ HTML ä»£ç ï¼Œä» <!DOCTYPE html> æˆ– <div> å¼€å§‹ï¼Œä¸è¦æœ‰å…¶ä»–è¯´æ˜æ–‡å­—ã€‚`;\n\n    const apiUrl = normalizeApiEndpoint(settings.api_endpoint);\n\n    const response = await fetch(apiUrl, {\n      method: \'POST\',\n      headers: {\n        \'Content-Type\': \'application/json\',\n        Authorization: `Bearer ${settings.api_key}`,\n      },\n      body: JSON.stringify({\n        model: settings.model,\n        messages: [\n          {\n            role: \'system\',\n            content:\n              \'ä½ æ˜¯ä¸€ä¸ªä¸“ä¸šçš„å‰ç«¯å¼€å‘ä¸“å®¶ï¼Œæ“…é•¿ç”Ÿæˆå’Œä¿®æ”¹ç¾è§‚çš„ HTML/CSS/JS ä»£ç ã€‚ä½ ä¼šæ ¹æ®ç”¨æˆ·çš„æè¿°å’Œä¿®æ”¹å»ºè®®ï¼Œç”Ÿæˆå®Œæ•´çš„ç•Œé¢ä»£ç ã€‚\',\n          },\n          { role: \'user\', content: prompt },\n        ],\n        temperature: 0.7,\n        max_tokens: 4000,\n      }),\n    });\n\n    if (!response.ok) {\n      throw new Error(`API è¯·æ±‚å¤±è´¥: ${response.status}`);\n    }\n\n    const data = await response.json();\n    let result = data.choices?.[0]?.message?.content || \'\';\n\n    console.log(\'ğŸ“ [ç•Œé¢ä¿®æ”¹] AI åŸå§‹è¿”å›é•¿åº¦:\', result.length);\n    console.log(\'ğŸ“ [ç•Œé¢ä¿®æ”¹] AI åŸå§‹è¿”å›å‰500å­—ç¬¦:\', result.substring(0, 500));\n\n    // ç§»é™¤å¯èƒ½çš„ markdown ä»£ç å—æ ‡è®°\n    result = result\n      .replace(/```html\\n?/g, \'\')\n      .replace(/```\\n?/g, \'\')\n      .trim();\n\n    // å°è¯•æå–HTMLä»£ç ï¼ˆå¤„ç†AIæ¨ç†è¿‡ç¨‹ï¼‰\n    // 1. å…ˆæŸ¥æ‰¾ <!DOCTYPE html å¼€å¤´çš„å®Œæ•´æ–‡æ¡£\n    const doctypeMatch = result.match(/<!DOCTYPE html>[\\s\\S]*/i);\n    if (doctypeMatch) {\n      result = doctypeMatch[0].trim();\n      console.log(\'âœ… [ç•Œé¢ä¿®æ”¹] æå–åˆ°å®Œæ•´çš„HTMLæ–‡æ¡£ï¼ˆå«DOCTYPEï¼‰\');\n    } else {\n      // 2. å¦‚æœæ²¡æœ‰DOCTYPEï¼ŒæŸ¥æ‰¾ <html å¼€å¤´çš„éƒ¨åˆ†\n      const htmlMatch = result.match(/<html[\\s\\S]*/i);\n      if (htmlMatch) {\n        result = htmlMatch[0].trim();\n        console.log(\'âœ… [ç•Œé¢ä¿®æ”¹] æå–åˆ°HTMLæ–‡æ¡£ï¼ˆä¸å«DOCTYPEï¼‰\');\n      } else if (result.includes(\'<\') && result.includes(\'>\')) {\n        // 3. å¦‚æœæ²¡æœ‰å®Œæ•´çš„htmlæ ‡ç­¾ï¼Œä½†åŒ…å«HTMLæ ‡ç­¾\n        console.log(\'âš ï¸ [ç•Œé¢ä¿®æ”¹] åŒ…å«HTMLæ ‡ç­¾ä½†æ ¼å¼ä¸æ ‡å‡†ï¼Œå°è¯•åŒ…è£…\');\n        // å°è¯•åŒ…è£…æˆå®Œæ•´æ–‡æ¡£\n        if (!result.includes(\'<html\')) {\n          result = `<!DOCTYPE html>\n<html>\n<head>\n  <meta charset="UTF-8">\n  <meta name="viewport" content="width=device-width, initial-scale=1.0">\n</head>\n<body>\n${result}\n</body>\n</html>`;\n          console.log(\'âœ… [ç•Œé¢ä¿®æ”¹] å·²è‡ªåŠ¨åŒ…è£…ä¸ºå®Œæ•´HTMLæ–‡æ¡£\');\n        }\n      } else {\n        // 4. å¦‚æœå®Œå…¨æ²¡æœ‰HTMLæ ‡ç­¾ï¼Œè¯´æ˜AIè¿”å›çš„æ˜¯çº¯æ–‡æœ¬æˆ–æ¨ç†è¿‡ç¨‹\n        console.error(\'âŒ [ç•Œé¢ä¿®æ”¹] AIæœªè¿”å›æœ‰æ•ˆçš„HTMLä»£ç \');\n        console.error(\'AIè¿”å›å†…å®¹:\', result);\n        throw new Error(\'AIæœªè¿”å›æœ‰æ•ˆçš„HTMLä»£ç ï¼Œè¯·å°è¯•æ›´è¯¦ç»†çš„ä¿®æ”¹å»ºè®®æˆ–æ›´æ¢æ¨¡å‹\');\n      }\n    }\n\n    console.log(\'ğŸ“ [ç•Œé¢ä¿®æ”¹] æœ€ç»ˆHTMLé•¿åº¦:\', result.length);\n\n    generatedCode.value = result;\n\n    // æ›´æ–°æ­£åˆ™é…ç½®ï¼ˆç¬¦åˆé…’é¦†æ­£åˆ™æ ¼å¼ï¼‰\n    const findRegex = triggerKeyword.value.replace(/[.*+?^${}()|[\\]\\\\]/g, \'\\\\$&\');\n    const regexJson = {\n      id: `regex_ui_${Date.now()}`,\n      scriptName: `ç•Œé¢_${triggerKeyword.value}`,\n      findRegex: findRegex,\n      replaceString: result,\n      trimStrings: [],\n      placement: [2], // AIè¾“å‡ºåå¤„ç†\n      disabled: false,\n      markdownOnly: true,\n      promptOnly: false,\n      runOnEdit: true,\n      substituteRegex: 0,\n      minDepth: null,\n      maxDepth: null,\n    };\n    generatedRegex.value = JSON.stringify(regexJson, null, 2);\n\n    // æ›´æ–°ç•Œé¢æè¿°ï¼ˆå°†ä¿®æ”¹å»ºè®®åˆå¹¶åˆ°åŸæè¿°ä¸­ï¼Œç”¨äºä¸‹æ¬¡ä¿®æ”¹ï¼‰\n    interfaceDescription.value = `${interfaceDescription.value}\\n\\nã€å·²åº”ç”¨çš„ä¿®æ”¹ã€‘ï¼š\\n${modifyInstruction.value}`;\n\n    window.toastr.success(\'AI ä¿®æ”¹æˆåŠŸï¼\');\n    showModify.value = false;\n  } catch (error) {\n    console.error(\'AI ä¿®æ”¹å¤±è´¥:\', error);\n    window.toastr.error(\'AI ä¿®æ”¹å¤±è´¥: \' + (error as Error).message);\n  } finally {\n    isModifying.value = false;\n  }\n};\n\n// å¤åˆ¶æ­£åˆ™ä»£ç \nconst copyRegex = () => {\n  copyToClipboard(generatedRegex.value, \'æ­£åˆ™ä»£ç å·²å¤åˆ¶åˆ°å‰ªè´´æ¿\');\n};\n<\/script>\n\n<style scoped>\n.regex-ui-generator {\n  height: 100%;\n  overflow-y: auto;\n}\n\nbutton:disabled {\n  cursor: not-allowed !important;\n  opacity: 0.5 !important;\n}\n\nbutton:not(:disabled):hover {\n  transform: translateY(-2px);\n  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);\n}\n\ncode {\n  background: #1a1a1a;\n  padding: 2px 6px;\n  border-radius: 3px;\n  font-family: \'Consolas\', monospace;\n}\n\npre::-webkit-scrollbar {\n  width: 8px;\n  height: 8px;\n}\n\npre::-webkit-scrollbar-track {\n  background: #1a1a1a;\n}\n\npre::-webkit-scrollbar-thumb {\n  background: #4a9eff;\n  border-radius: 4px;\n}\n\npre::-webkit-scrollbar-thumb:hover {\n  background: #5ab0ff;\n}\n</style>\n'],sourceRoot:''}]);const i=s},419:(e,n,t)=>{var a=t(784);a.__esModule&&(a=a.default),'string'==typeof a&&(a=[[e.id,a,'']]),a.locals&&(e.exports=a.locals);(0,t(424).A)('8b910c1a',a,!1,{ssrId:!0})},424:(e,n,t)=>{function a(e,n){for(var t=[],a={},o=0;o<n.length;o++){var r=n[o],s=r[0],i={id:e+':'+o,css:r[1],media:r[2],sourceMap:r[3]};a[s]?a[s].parts.push(i):t.push(a[s]={id:s,parts:[i]})}return t}t.d(n,{A:()=>m});var o='undefined'!=typeof document;if('undefined'!=typeof DEBUG&&DEBUG&&!o)throw new Error('vue-style-loader cannot be used in a non-browser environment. Use { target: \'node\' } in your Webpack config to indicate a server-rendering environment.');var r={},s=o&&(document.head||document.getElementsByTagName('head')[0]),i=null,l=0,d=!1,c=function(){},p=null,g='data-vue-ssr-id',u='undefined'!=typeof navigator&&/msie [6-9]\b/.test(navigator.userAgent.toLowerCase());function m(e,n,t,o){d=t,p=o||{};var s=a(e,n);return f(s),function(n){for(var t=[],o=0;o<s.length;o++){var i=s[o];(l=r[i.id]).refs--,t.push(l)}n?f(s=a(e,n)):s=[];for(o=0;o<t.length;o++){var l;if(0===(l=t[o]).refs){for(var d=0;d<l.parts.length;d++)l.parts[d]();delete r[l.id]}}}}function f(e){for(var n=0;n<e.length;n++){var t=e[n],a=r[t.id];if(a){a.refs++;for(var o=0;o<a.parts.length;o++)a.parts[o](t.parts[o]);for(;o<t.parts.length;o++)a.parts.push(b(t.parts[o]));a.parts.length>t.parts.length&&(a.parts.length=t.parts.length)}else{var s=[];for(o=0;o<t.parts.length;o++)s.push(b(t.parts[o]));r[t.id]={id:t.id,refs:1,parts:s}}}}function x(){var e=document.createElement('style');return e.type='text/css',s.appendChild(e),e}function b(e){var n,t,a=document.querySelector('style['+g+'~="'+e.id+'"]');if(a){if(d)return c;a.parentNode.removeChild(a)}if(u){var o=l++;a=i||(i=x()),n=v.bind(null,a,o,!1),t=v.bind(null,a,o,!0)}else a=x(),n=w.bind(null,a),t=function(){a.parentNode.removeChild(a)};return n(e),function(a){if(a){if(a.css===e.css&&a.media===e.media&&a.sourceMap===e.sourceMap)return;n(e=a)}else t()}}var h,y=(h=[],function(e,n){return h[e]=n,h.filter(Boolean).join('\n')});function v(e,n,t,a){var o=t?'':a.css;if(e.styleSheet)e.styleSheet.cssText=y(n,o);else{var r=document.createTextNode(o),s=e.childNodes;s[n]&&e.removeChild(s[n]),s.length?e.insertBefore(r,s[n]):e.appendChild(r)}}function w(e,n){var t=n.css,a=n.media,o=n.sourceMap;if(a&&e.setAttribute('media',a),p.ssrId&&e.setAttribute(g,n.id),o&&(t+='\n/*# sourceURL='+o.sources[0]+' */',t+='\n/*# sourceMappingURL=data:application/json;base64,'+btoa(unescape(encodeURIComponent(JSON.stringify(o))))+' */'),e.styleSheet)e.styleSheet.cssText=t;else{for(;e.firstChild;)e.removeChild(e.firstChild);e.appendChild(document.createTextNode(t))}}},472:(e,n,t)=>{t.d(n,{fetchAvailableModels:()=>r,summarizeMessages:()=>s});var a=t(507);async function o(e,n={}){try{const t=window.location.origin;console.log('ğŸ”„ å°è¯•é€šè¿‡é…’é¦†åç«¯ä»£ç†:',t);const a=await fetch(`${t}/api/proxy`,{method:'POST',headers:{'Content-Type':'application/json',...'undefined'!=typeof SillyTavern&&SillyTavern.getRequestHeaders?SillyTavern.getRequestHeaders():{}},body:JSON.stringify({url:e,method:n.method||'GET',headers:n.headers||{}})});if(a.ok)return console.log('âœ… æˆåŠŸé€šè¿‡é…’é¦†åç«¯ä»£ç†'),a;console.log('âš ï¸ é…’é¦†ä»£ç†ä¸å¯ç”¨ï¼Œå°è¯•ç›´æ¥è¯·æ±‚')}catch(e){console.log('âš ï¸ é…’é¦†ä»£ç†å¤±è´¥ï¼Œå°è¯•ç›´æ¥è¯·æ±‚:',e)}return fetch(e,n)}async function r(){const e=(0,a.C)().settings;if(!e.api_endpoint||''===e.api_endpoint.trim())throw new Error('API ç«¯ç‚¹æœªé…ç½®');const n=e.api_endpoint.trim();let t;console.log('ğŸ“ åŸå§‹ç«¯ç‚¹:',n);try{t=(0,a.normalizeApiEndpoint)(n,'/models'),console.log('ğŸ”— è§„èŒƒåŒ–çš„ models ç«¯ç‚¹:',t)}catch(e){throw new Error(`API ç«¯ç‚¹æ ¼å¼ä¸æ­£ç¡®: ${n}`)}try{new URL(t)}catch(e){throw new Error(`API ç«¯ç‚¹æ ¼å¼ä¸æ­£ç¡®: ${t}`)}const r=[t,n+(n.endsWith('/')?'models':'/models'),new URL(t).origin+'/v1/models',new URL(t).origin+'/models'];console.log('ğŸ” å°è¯•çš„æ¨¡å‹ç«¯ç‚¹:',r);const s=[];let i=!1;for(const n of r)try{console.log(`ğŸ“¡ æ­£åœ¨è¯·æ±‚: ${n}`);const t=await o(n,{method:'GET',headers:{'Content-Type':'application/json',Authorization:`Bearer ${e.api_key}`}});if(console.log(`ğŸ“Š å“åº”çŠ¶æ€: ${t.status} ${t.statusText}`),!t.ok){const e=await t.text();s.push(`${n}: ${t.status} - ${e.substring(0,100)}`),console.log(`âŒ ç«¯ç‚¹è¿”å›é”™è¯¯: ${t.status}`),console.log(`é”™è¯¯è¯¦æƒ…: ${e.substring(0,200)}`);continue}const a=t.headers.get('content-type');if(console.log(`ğŸ“„ å†…å®¹ç±»å‹: ${a}`),!a||!a.includes('application/json')){const e=await t.text();s.push(`${n}: é JSON å“åº” - ${e.substring(0,100)}`),console.log('âŒ è¿”å›é JSON å†…å®¹:',e.substring(0,200));continue}const r=await t.json();if(console.log('âœ… API è¿”å›æ•°æ®:',JSON.stringify(r,null,2)),r.data&&Array.isArray(r.data)){const e=r.data.map(e=>e.id||e.name||e).filter(Boolean);if(console.log(`ğŸ‰ æˆåŠŸè·å– ${e.length} ä¸ªæ¨¡å‹:`,e),e.length>0)return e}if(Array.isArray(r)){const e=r.map(e=>e.id||e.name||e).filter(Boolean);if(console.log(`ğŸ‰ æˆåŠŸè·å– ${e.length} ä¸ªæ¨¡å‹:`,e),e.length>0)return e}if(r.models&&Array.isArray(r.models)){const e=r.models.map(e=>e.id||e.name||e).filter(Boolean);if(console.log(`ğŸ‰ æˆåŠŸè·å– ${e.length} ä¸ªæ¨¡å‹:`,e),e.length>0)return e}s.push(`${n}: å“åº”æ ¼å¼æ— æ³•è¯†åˆ« - ${JSON.stringify(r).substring(0,100)}`),console.log('âŒ å“åº”æ ¼å¼æœªè¯†åˆ«')}catch(e){const t=e.message;(t.includes('Failed to fetch')||t.includes('CORS'))&&(i=!0),s.push(`${n}: ${t}`),console.log('âŒ è¯·æ±‚å¤±è´¥:',e);continue}console.error('âŒ æ‰€æœ‰ç«¯ç‚¹éƒ½å¤±è´¥äº†ï¼Œè¯¦ç»†é”™è¯¯:'),s.forEach((e,n)=>console.error(`  ${n+1}. ${e}`));let l=`æ— æ³•ä» API è·å–æ¨¡å‹åˆ—è¡¨ã€‚å°è¯•äº† ${r.length} ä¸ªç«¯ç‚¹å‡å¤±è´¥ã€‚\n\nè¯¦ç»†é”™è¯¯ä¿¡æ¯ï¼š\n${s.join('\n\n')}\n\nè¯·æ£€æŸ¥ï¼š\n1. API ç«¯ç‚¹æ˜¯å¦æ­£ç¡®ï¼ˆå½“å‰ï¼š${n}ï¼‰\n2. API Key æ˜¯å¦æœ‰æ•ˆ\n3. è¯¥ API æ˜¯å¦æ”¯æŒ /v1/models æ¥å£\n`;throw i&&(l+=`\nâš ï¸ æ£€æµ‹åˆ° CORS é”™è¯¯ï¼š\nè¿™æ˜¯å› ä¸ºä½ çš„ API æœåŠ¡å™¨ï¼ˆ${new URL(n).origin}ï¼‰æ²¡æœ‰é…ç½® CORS å¤´ã€‚\nè§£å†³æ–¹æ¡ˆï¼š\nâ€¢ åœ¨ Zeabur é¡¹ç›®è®¾ç½®ä¸­æ·»åŠ ç¯å¢ƒå˜é‡å¯ç”¨ CORS\nâ€¢ æˆ–åœ¨ä½ çš„ API æœåŠ¡å™¨ä»£ç ä¸­æ·»åŠ  CORS ä¸­é—´ä»¶\nâ€¢ æˆ–åœ¨é…’é¦†ä¸»ç•Œé¢é…ç½®ç›¸åŒçš„ APIï¼Œç„¶åæˆ‘ä»¬å¯ä»¥å¤ç”¨é…’é¦†çš„é…ç½®\n\n`),l+='å¦‚æœè¯¥ API ä¸æ”¯æŒæ¨¡å‹åˆ—è¡¨æ¥å£ï¼Œè¯·æ‰‹åŠ¨è¾“å…¥æ¨¡å‹åç§°ã€‚',new Error(l)}async function s(e,n){const t=(0,a.C)().settings;if(!t.api_endpoint||''===t.api_endpoint.trim())throw new Error('API ç«¯ç‚¹æœªé…ç½®');const o=t.api_endpoint.trim();let r;try{r=(0,a.normalizeApiEndpoint)(o),console.log('ğŸ“ åŸå§‹ç«¯ç‚¹:',o),console.log('ğŸ”— è§„èŒƒåŒ–çš„ API URL:',r)}catch(e){throw new Error(`API ç«¯ç‚¹æ ¼å¼ä¸æ­£ç¡®: ${o}`)}try{new URL(r)}catch(e){throw new Error(`API ç«¯ç‚¹æ ¼å¼ä¸æ­£ç¡®: ${r}`)}const s=[];for(let t=e;t<=n;t++){const e=getChatMessages(t);e.length>0&&s.push(...e)}if(0===s.length)throw new Error('æ²¡æœ‰å¯æ€»ç»“çš„æ¶ˆæ¯');const i=`ä½ æ˜¯ä¸€ä½ä¸“ä¸šçš„å‰§æƒ…æ€»ç»“åŠ©æ‰‹ã€‚è¯·å¯¹ä»¥ä¸‹å¯¹è¯å†…å®¹è¿›è¡Œæ€»ç»“ï¼Œ**é‡ç‚¹æ€»ç»“æ­£æ–‡å‰§æƒ…**ã€‚\n\næ€»ç»“è¦æ±‚ï¼š\n- æŒ‰æ—¶é—´é¡ºåºæˆ–é€»è¾‘é¡ºåºç»„ç»‡ä¿¡æ¯\n- ä¿ç•™å…³é”®äº‹ä»¶å’Œé‡è¦ç»†èŠ‚ï¼Œçœç•¥å†—ä½™æè¿°\n- ç›´æ¥é™ˆè¿°äº‹å®ï¼Œé¿å…ä¸»è§‚è¯„ä»·\n- ä½¿ç”¨ç®€æ´æ¸…æ™°çš„è¯­è¨€ï¼Œé¿å…è¿‡åº¦ä¿®é¥°\n- çªå‡ºäº‹ä»¶å‘å±•è„‰ç»œå’Œå…³é”®è½¬æŠ˜ç‚¹\n- ä¸ä½¿ç”¨ä»»ä½•XMLæ ‡ç­¾ï¼Œçº¯æ–‡å­—å™è¿°\n- ä¸å›é¿ä»»ä½•æ•æ„Ÿå†…å®¹ï¼Œä¿è¯è®°å½•å®Œå…¨è¿˜åŸå‰æ–‡\n- æ€»ç»“é•¿åº¦çº¦ ${t.max_tokens/4} å­—\n- **é‡è¦ï¼šç›´æ¥è¾“å‡ºæ€»ç»“å†…å®¹ï¼Œä¸è¦æ·»åŠ ä»»ä½•å›å¤è¯­ã€é—®å€™è¯­æˆ–è§£é‡Šæ€§æ–‡å­—**\n\næ€»ç»“å¿…é¡»ä½¿ç”¨ä»¥ä¸‹æ ¼å¼ï¼š\nã€å…³é”®äº‹ä»¶æ ‡é¢˜ã€‘\nå…³é”®äº‹ä»¶æ¦‚è¿°ã€‚\nå‘ç”Ÿåœ°ç‚¹: [åœ°ç‚¹]\nå…³é”®è§’è‰²: [è§’è‰²åˆ—è¡¨]\n\nâ€¢ åˆ†è§£äº‹ä»¶1ï¼ˆå°æ ‡é¢˜å½¢å¼ï¼‰: ç®€è¦æè¿°\nâ€¢ åˆ†è§£äº‹ä»¶2ï¼ˆå°æ ‡é¢˜å½¢å¼ï¼‰: ç®€è¦æè¿°\nâ€¢ åˆ†è§£äº‹ä»¶3ï¼ˆå°æ ‡é¢˜å½¢å¼ï¼‰: ç®€è¦æè¿°\n...\n\nå¯¹è¯å†…å®¹ï¼š\n${s.map(e=>`[${e.role}]: ${e.message}`).join('\n\n')}\n\nç›´æ¥è¾“å‡ºæ€»ç»“å†…å®¹ï¼Œä¸è¦ä»»ä½•å›å¤è¯­ï¼š`;let l;console.log('å‡†å¤‡è°ƒç”¨ APIï¼ŒURL:',r),console.log('è¯·æ±‚ä½“:',{model:t.model,messages:[{role:'user',content:i}],max_tokens:t.max_tokens,temperature:t.temperature});try{l=await fetch(r,{method:'POST',headers:{'Content-Type':'application/json',Authorization:`Bearer ${t.api_key}`},body:JSON.stringify({model:t.model,messages:[{role:'user',content:i}],max_tokens:t.max_tokens,temperature:t.temperature,top_p:t.top_p,presence_penalty:t.presence_penalty,frequency_penalty:t.frequency_penalty})})}catch(e){throw console.error('fetch è°ƒç”¨å¤±è´¥:',e),new Error(`æ— æ³•è¿æ¥åˆ° API: ${e.message}`)}if(!l.ok){let e=`API è¯·æ±‚å¤±è´¥: ${l.status}`,n='';try{const t=await l.json();e=t.error?.message||t.message||e,n=JSON.stringify(t,null,2)}catch(e){try{n=await l.text()}catch{}}let t=e;throw 500===l.status?t=`API æœåŠ¡å™¨å†…éƒ¨é”™è¯¯ (500)ï¼š${e}\n\nè¿™é€šå¸¸æ˜¯æš‚æ—¶æ€§é—®é¢˜ï¼Œè¯·ç¨åé‡è¯•ã€‚å¦‚æœé—®é¢˜æŒç»­ï¼Œè¯·æ£€æŸ¥ï¼š\nâ€¢ API æœåŠ¡çŠ¶æ€\nâ€¢ è´¦æˆ·é…é¢æ˜¯å¦å……è¶³\nâ€¢ è¯·æ±‚å†…å®¹æ˜¯å¦è¿‡é•¿`:429===l.status?t='API è¯·æ±‚é¢‘ç‡é™åˆ¶ (429)ï¼šè¯·æ±‚è¿‡äºé¢‘ç¹ï¼Œè¯·ç¨åå†è¯•ã€‚':401===l.status?t='API è®¤è¯å¤±è´¥ (401)ï¼šè¯·æ£€æŸ¥ API å¯†é’¥æ˜¯å¦æ­£ç¡®ã€‚':400===l.status&&(t=`API è¯·æ±‚å‚æ•°é”™è¯¯ (400)ï¼š${e}`),console.error('âŒ API è¯·æ±‚å¤±è´¥è¯¦æƒ…:',{status:l.status,statusText:l.statusText,errorMessage:e,errorDetails:n.substring(0,500)}),new Error(t)}const d=await l.json();if(!d.choices||!d.choices[0]||!d.choices[0].message?.content)throw new Error('API è¿”å›æ•°æ®æ ¼å¼é”™è¯¯');return d.choices[0].message.content}},507:(e,n,t)=>{t.d(n,{C:()=>c,l:()=>p,normalizeApiEndpoint:()=>l});var a=t(15),o=t(35),r=t(61),s=t(937);let z;try{z=t(707)}catch(e){console.warn('zod ä¸å¯ç”¨ï¼Œä½¿ç”¨å¤‡ç”¨æ–¹æ¡ˆ'),z={object:e=>({parse:e=>e,default:e=>({parse:n=>n||e})}),string:()=>({default:e=>({parse:n=>n||e})}),number:()=>({default:e=>({parse:n=>n||e})}),boolean:()=>({default:e=>({parse:n=>n||e})}),array:e=>({default:e=>({parse:n=>Array.isArray(n)?n:e})}),prefault:e=>({parse:n=>n||e})}}const i=z.object({api_provider:z.string().default('openai'),api_endpoint:z.string().default('https://api.openai.com/v1'),api_key:z.string().default(''),model:z.string().default('gpt-4o-mini'),max_tokens:z.number().default(4e3),temperature:z.number().default(.7),top_p:z.number().default(1),presence_penalty:z.number().default(0),frequency_penalty:z.number().default(0),auto_summarize_enabled:z.boolean().default(!1),summarize_interval:z.number().default(50),start_message_id:z.number().default(0),end_message_id:z.number().default(0),table_start_message_id:z.number().default(0),table_end_message_id:z.number().default(0),summary_history:z.array(z.object({start_id:z.number(),end_id:z.number(),content:z.string()})).default([])}).prefault({});function l(e,n='/chat/completions'){if(!e||''===e.trim())throw new Error('API ç«¯ç‚¹ä¸èƒ½ä¸ºç©º');const t=e.trim();if(t.includes('/chat/completions')||t.includes('/models'))return t;let a=t.endsWith('/')?t.slice(0,-1):t;return a.endsWith('/v1')||(a+='/v1'),a+n}const d='maomao_tool_settings',c=(0,o.defineStore)('settings',()=>{const e=()=>'function'!=typeof getVariables,n=(()=>{if(e()){console.warn('ğŸ”§ æœ¬åœ°è°ƒè¯•æ¨¡å¼ï¼šä½¿ç”¨ localStorage å­˜å‚¨è®¾ç½®');try{const e=localStorage.getItem('tavern_helper_settings');if(e)return(0,r.ref)(i.parse(JSON.parse(e)))}catch(e){console.warn('ä» localStorage è¯»å–è®¾ç½®å¤±è´¥:',e)}return(0,r.ref)(i.parse({}))}try{const e=getVariables({type:'global'})[d];if(e)return console.log('ğŸ“¦ ä»å…¨å±€å˜é‡åŠ è½½è®¾ç½®'),(0,r.ref)(i.parse(e))}catch(e){console.warn('è¯»å–å…¨å±€å˜é‡å¤±è´¥ï¼Œä½¿ç”¨é»˜è®¤è®¾ç½®:',e)}return(0,r.ref)(i.parse({}))})();setTimeout(()=>{if(e())console.log('ğŸ”§ æœ¬åœ°è°ƒè¯•æ¨¡å¼ï¼šè·³è¿‡é…’é¦†å˜é‡è¯»å–');else try{const e=getVariables({type:'global'})[d];e&&Object.keys(e).length>0&&(n.value=i.parse(e),console.log('âœ… ä»å…¨å±€å˜é‡é‡æ–°åŠ è½½è®¾ç½®æˆåŠŸ'))}catch(e){console.warn('è¯»å–çœŸå®å˜é‡å¤±è´¥ï¼Œä½¿ç”¨åˆå§‹å€¼:',e)}},200);const t=n=>{if(e())try{console.log('ğŸ’¾ æœ¬åœ°è°ƒè¯•ï¼šç«‹å³ä¿å­˜è®¾ç½®åˆ° localStorage:',(0,a.klona)(n)),localStorage.setItem('tavern_helper_settings',JSON.stringify((0,a.klona)(n))),console.log('âœ… è®¾ç½®å·²ä¿å­˜åˆ° localStorage')}catch(e){console.error('âŒ ä¿å­˜åˆ° localStorage å¤±è´¥:',e)}else try{console.log('ğŸ’¾ ç«‹å³ä¿å­˜è®¾ç½®åˆ°å…¨å±€å˜é‡:',(0,a.klona)(n)),insertOrAssignVariables({[d]:(0,a.klona)(n)},{type:'global'}),console.log('âœ… è®¾ç½®å·²ä¿å­˜')}catch(e){console.error('âŒ ä¿å­˜è®¾ç½®å¤±è´¥:',e),window.toastr?.error('è®¾ç½®ä¿å­˜å¤±è´¥: '+e.message)}};let o=null;(0,r.watch)(n,e=>{o&&clearTimeout(o),o=setTimeout(()=>{t(e)},300)},{immediate:!1,deep:!0}),'undefined'!=typeof window&&window.addEventListener('pagehide',()=>{console.log('âš ï¸ é¡µé¢å¸è½½ï¼Œç«‹å³ä¿å­˜è®¾ç½®'),t(n.value)});return{settings:n,saveSettings:()=>{if(e())try{return console.log('ğŸ’¾ æœ¬åœ°è°ƒè¯•ï¼šæ‰‹åŠ¨ä¿å­˜è®¾ç½®åˆ° localStorage:',(0,a.klona)(n.value)),localStorage.setItem('tavern_helper_settings',JSON.stringify((0,a.klona)(n.value))),window.toastr?.success('è®¾ç½®å·²ä¿å­˜ï¼ˆlocalStorageï¼‰'),!0}catch(e){return console.error('âŒ ä¿å­˜åˆ° localStorage å¤±è´¥:',e),window.toastr?.error('è®¾ç½®ä¿å­˜å¤±è´¥: '+e.message),!1}try{return console.log('ğŸ’¾ æ‰‹åŠ¨ä¿å­˜è®¾ç½®åˆ°å…¨å±€å˜é‡:',(0,a.klona)(n.value)),insertOrAssignVariables({[d]:(0,a.klona)(n.value)},{type:'global'}),window.toastr?.success('è®¾ç½®å·²ä¿å­˜'),!0}catch(e){return console.error('âŒ æ‰‹åŠ¨ä¿å­˜è®¾ç½®å¤±è´¥:',e),window.toastr?.error('è®¾ç½®ä¿å­˜å¤±è´¥: '+e.message),!1}},reloadSettings:()=>{if(e())return console.warn('æœ¬åœ°è°ƒè¯•æ¨¡å¼ï¼šæ— æ³•é‡æ–°åŠ è½½é…’é¦†å˜é‡'),!1;try{const e=getVariables({type:'global'})[d];if(e&&Object.keys(e).length>0)return n.value=i.parse(e),console.log('âœ… è®¾ç½®é‡æ–°åŠ è½½æˆåŠŸ:',n.value),window.toastr?.success('è®¾ç½®å·²é‡æ–°åŠ è½½'),!0}catch(e){console.error('âŒ é‡æ–°åŠ è½½è®¾ç½®å¤±è´¥:',e),window.toastr?.error('è®¾ç½®é‡æ–°åŠ è½½å¤±è´¥: '+e.message)}return!1}}}),p=(0,o.defineStore)('summaryHistory',()=>({addSummary:(e,n,t)=>{try{const o=(0,s.pA)();if(!o)return console.error('æ— æ³•è·å–èŠå¤© ID'),void window.toastr.error('æ— æ³•è·å–å½“å‰èŠå¤©ä¿¡æ¯');console.log('æ·»åŠ æ€»ç»“åˆ°èŠå¤©:',o);let r=[];try{const e=getVariables({type:'chat'});e&&e.summary_history&&(r=Array.isArray(e.summary_history)?e.summary_history:[])}catch(e){console.warn('è¯»å–èŠå¤©æ€»ç»“å†å²å¤±è´¥:',e)}r.unshift({start_id:e,end_id:n,content:t}),r.length>50&&(r=r.slice(0,50)),insertOrAssignVariables((0,a.klona)({summary_history:r}),{type:'chat'}),console.log('æ€»ç»“å·²ä¿å­˜åˆ°èŠå¤©å˜é‡:',o)}catch(e){console.error('ä¿å­˜æ€»ç»“å¤±è´¥:',e),window.toastr.error('ä¿å­˜æ€»ç»“å¤±è´¥: '+e.message)}},getSummaryHistory:()=>{try{if(!(0,s.pA)())return[];const e=getVariables({type:'chat'});return e&&e.summary_history&&Array.isArray(e.summary_history)?e.summary_history:[]}catch(e){return console.warn('è¯»å–èŠå¤©æ€»ç»“å†å²å¤±è´¥:',e),[]}}}))},508:(e,n,t)=>{var a=t(139);a.__esModule&&(a=a.default),'string'==typeof a&&(a=[[e.id,a,'']]),a.locals&&(e.exports=a.locals);(0,t(424).A)('cdbea3fc',a,!1,{ssrId:!0})},560:()=>{$(()=>{setTimeout(()=>{let e=!1;const n=()=>{if(!e){e=!0;try{const t=['#top-bar','#top-settings-holder','#topBar','.topBar','#navbar','.navbar','header','.header','#header','.top_header','.navigation'];let a=$(),o='';for(const e of t){const n=$(e);if(n.length>0){a=n,o=e,console.log(`æ‰¾åˆ°å¯¼èˆªæ : ${e}`);break}}if(0===a.length)return console.log('æœªæ‰¾åˆ°å¯¼èˆªæ ï¼Œ500msåé‡è¯•...'),void setTimeout(n,500);console.log(`ä½¿ç”¨å¯¼èˆªæ : ${o}`);const r=$('#memoryNavButton');r.length>0&&(console.log('mzrodyuçŒ«çŒ«çš„å°ç ´çƒ‚å¯¼èˆªæŒ‰é’®å·²å­˜åœ¨ï¼Œç§»é™¤åé‡æ–°æ·»åŠ '),r.remove());let s=a;if('#top-bar'===o){const e=$('#top-settings-holder');e.length>0&&(s=e,console.log('ä½¿ç”¨ top-settings-holder ä½œä¸ºå®¹å™¨'))}const i=$('<div id="memoryNavButton" class="interactable" style="\n            padding: 8px;\n            display: inline-flex;\n            align-items: center;\n            justify-content: center;\n            cursor: pointer;\n            color: inherit;\n            border-radius: 4px;\n            transition: background 0.2s;\n            position: relative;\n          " title="mzrodyuçŒ«çŒ«çš„å°ç ´çƒ‚">\n            <span style="font-size: 24px">ğŸ±</span>\n          </div>');if(console.log('ç›®æ ‡å®¹å™¨ç±»å‹:',s[0]?.id||'æœªæŒ‡å®š'),console.log('ç›®æ ‡å®¹å™¨HTML:',s[0]?.outerHTML?.substring(0,300)),'top-settings-holder'===s[0]?.id){console.log('æ·»åŠ åˆ° top-settings-holder æœ€å‰é¢');const e=s.children().first();e.length>0?i.insertBefore(e):s.prepend(i)}else console.log('æ·»åŠ åˆ°å®¹å™¨å‰é¢'),s.prepend(i);i.on('click',function(e){e.preventDefault(),e.stopPropagation(),console.log('ç‚¹å‡»mzrodyuçŒ«çŒ«çš„å°ç ´çƒ‚å¯¼èˆªæŒ‰é’®');const n=$('#memoryManagementPanel');n.length>0?n.is(':visible')?n.fadeOut(200):n.fadeIn(200):toastr.error('æµ®åŠ¨é¢æ¿æœªåŠ è½½')}),i.on('mouseenter',function(){$(this).css('background','rgba(255, 255, 255, 0.1)')}).on('mouseleave',function(){$(this).css('background','transparent')}),console.log('mzrodyuçŒ«çŒ«çš„å°ç ´çƒ‚å¯¼èˆªæŒ‰é’®å·²æ·»åŠ åˆ°:',s[0]?.id||'å®¹å™¨'),console.log('æŒ‰é’®ä½ç½®:',i[0]?.parentElement?.children?.[0]?.className||'å·²æ·»åŠ '),console.log('æŒ‰é’®å…ƒç´ :',i[0]),console.log('é¢æ¿å®¹å™¨é•¿åº¦:',$('#memoryManagementPanel').length),e=!1}catch(t){console.error('æ·»åŠ å¯¼èˆªæŒ‰é’®å¤±è´¥:',t),e=!1,setTimeout(n,500)}}};if(n(),setInterval(()=>{0!==$('#memoryNavButton').length||e||(console.log('æ£€æµ‹åˆ°æŒ‰é’®æ¶ˆå¤±ï¼Œé‡æ–°æ·»åŠ ...'),n())},2e3),'function'==typeof eventOn)try{eventOn(tavern_events.CHAT_CHANGED,()=>{console.log('èŠå¤©å˜åŒ–ï¼Œæ£€æŸ¥æŒ‰é’®...'),setTimeout(()=>{0!==$('#memoryNavButton').length||e||(console.log('èŠå¤©å˜åŒ–åæŒ‰é’®æ¶ˆå¤±ï¼Œé‡æ–°æ·»åŠ ...'),n())},500)})}catch(e){console.log('æ— æ³•ç›‘å¬äº‹ä»¶:',e)}},300)})},572:(e,n,t)=>{var a=t(163);a.__esModule&&(a=a.default),'string'==typeof a&&(a=[[e.id,a,'']]),a.locals&&(e.exports=a.locals);(0,t(424).A)('eb638316',a,!1,{ssrId:!0})},651:(e,n,t)=>{var a=t(80);a.__esModule&&(a=a.default),'string'==typeof a&&(a=[[e.id,a,'']]),a.locals&&(e.exports=a.locals);(0,t(424).A)('59403083',a,!1,{ssrId:!0})},661:(e,n,t)=>{var a=t(86);a.__esModule&&(a=a.default),'string'==typeof a&&(a=[[e.id,a,'']]),a.locals&&(e.exports=a.locals);(0,t(424).A)('273d6f03',a,!1,{ssrId:!0})},700:(e,n,t)=>{t.r(n),t.d(n,{default:()=>i});var a=t(790),o=t.n(a),r=t(54),s=t.n(r)()(o());s.push([e.id,'button[data-v-7890f262]:disabled{cursor:not-allowed !important}button[data-v-7890f262]:not(:disabled):hover{transform:translateY(-2px);box-shadow:0 4px 12px rgba(0,0,0,0.3)}div[data-v-7890f262]::-webkit-scrollbar{width:8px}div[data-v-7890f262]::-webkit-scrollbar-track{background:#1a1a1a}div[data-v-7890f262]::-webkit-scrollbar-thumb{background:#ffc107;border-radius:4px}div[data-v-7890f262]::-webkit-scrollbar-thumb:hover{background:#ffb300}.progress-bar[data-v-7890f262]{position:absolute;top:0;left:0;height:100%;width:100%;background:linear-gradient(90deg,#ffc107 0%,#ffb300 50%,#ffc107 100%);background-size:200% 100%;animation:progressMove-7890f262 2s linear infinite;box-shadow:0 0 10px rgba(255,193,7,0.5)}@keyframes progressMove-7890f262{0%{background-position:-200% 0}100%{background-position:200% 0}}@keyframes pulse-7890f262{0%,100%{opacity:1;transform:scale(1)}50%{opacity:0.7;transform:scale(1.1)}}.icon-spin[data-v-7890f262]{animation:spin-7890f262 1s linear infinite}@keyframes spin-7890f262{from{transform:rotate(0deg)}to{transform:rotate(360deg)}}\n','',{version:3,sources:['webpack://./src/è®°å¿†_with_worldbook/components/AIModifyDialog.vue'],names:[],mappings:'AAqKA,iCACE,6BACF,CAEA,6CACE,0BAA2B,CAC3B,qCACF,CAGA,wCACE,SACF,CAEA,8CACE,kBACF,CAEA,8CACE,kBAAmB,CACnB,iBACF,CAEA,oDACE,kBACF,CAGA,+BACE,iBAAkB,CAClB,KAAM,CACN,MAAO,CACP,WAAY,CACZ,UAAW,CACX,qEAAyE,CACzE,yBAA0B,CAC1B,kDAA0C,CAC1C,uCACF,CAEA,iCACE,GACE,2BACF,CACA,KACE,0BACF,CACF,CAGA,0BACE,QAEE,SAAU,CACV,kBACF,CACA,IACE,WAAY,CACZ,oBACF,CACF,CAGA,4BACE,0CACF,CAEA,yBACE,KACE,sBACF,CACA,GACE,wBACF,CACF',sourcesContent:['<template>\n  <div\n    v-if="show"\n    @click.self="$emit(\'close\')"\n    style="\n      position: fixed;\n      top: 0;\n      left: 0;\n      right: 0;\n      bottom: 0;\n      background: rgba(0, 0, 0, 0.8);\n      z-index: 1000000;\n      display: flex;\n      align-items: center;\n      justify-content: center;\n      padding: 20px;\n    "\n  >\n    <div\n      style="\n        background: #2a2a2a;\n        border: 2px solid #ffc107;\n        border-radius: 12px;\n        padding: 30px;\n        max-width: 600px;\n        width: 100%;\n        max-height: 80vh;\n        overflow-y: auto;\n      "\n      @click.stop\n    >\n      <h3 style="color: #ffc107; margin: 0 0 20px 0">\n        <i class="fa-solid fa-edit"></i>\n        {{ title || \'AI ä¿®æ”¹\' }}\n      </h3>\n      <p style="color: #888; margin: 0 0 15px 0; line-height: 1.6">\n        {{ description || \'æè¿°ä½ æƒ³è¦ä¿®æ”¹çš„åœ°æ–¹ï¼ŒAI ä¼šåœ¨å½“å‰åŸºç¡€ä¸Šè¿›è¡Œè°ƒæ•´ã€‚\' }}\n      </p>\n      <ul\n        v-if="examples && examples.length > 0"\n        style="color: #888; margin: 0 0 20px 0; padding-left: 20px; line-height: 1.8"\n      >\n        <li v-for="(example, index) in examples" :key="index">{{ example }}</li>\n      </ul>\n      <textarea\n        v-model="localInstruction"\n        :placeholder="placeholder || \'è¾“å…¥ä¿®æ”¹å»ºè®®...\'"\n        style="\n          width: 100%;\n          min-height: 150px;\n          background: #1a1a1a;\n          color: #e0e0e0;\n          border: 1px solid #444;\n          border-radius: 4px;\n          padding: 12px;\n          font-size: 14px;\n          margin-bottom: 20px;\n          resize: vertical;\n          box-sizing: border-box;\n        "\n      ></textarea>\n      \x3c!-- åŠ è½½è¿›åº¦æ¡ --\x3e\n      <div\n        v-if="isModifying"\n        style="margin-bottom: 20px; background: #1a1a1a; border-radius: 8px; padding: 15px; border: 1px solid #444"\n      >\n        <div style="display: flex; align-items: center; gap: 12px; margin-bottom: 10px">\n          <i\n            class="fa-solid fa-wand-magic-sparkles"\n            style="color: #ffc107; font-size: 18px; animation: pulse 1.5s infinite"\n          ></i>\n          <span style="color: #ffc107; font-weight: 600; font-size: 14px">AI æ­£åœ¨ç”Ÿæˆä¸­...</span>\n        </div>\n        <div\n          style="width: 100%; height: 6px; background: #333; border-radius: 3px; overflow: hidden; position: relative"\n        >\n          <div class="progress-bar"></div>\n        </div>\n        <p style="color: #888; font-size: 12px; margin: 8px 0 0 0; text-align: center">è¯·ç¨å€™ï¼Œè¿™å¯èƒ½éœ€è¦å‡ ç§’é’Ÿ</p>\n      </div>\n\n      <div style="display: flex; gap: 12px">\n        <button\n          @click="handleConfirm"\n          :disabled="!localInstruction || isModifying"\n          style="\n            flex: 1;\n            background: #ffc107;\n            color: #000;\n            border: none;\n            padding: 12px 24px;\n            border-radius: 6px;\n            cursor: pointer;\n            font-size: 14px;\n            font-weight: 600;\n            transition: all 0.2s;\n            position: relative;\n            overflow: hidden;\n          "\n          :style="{ opacity: !localInstruction || isModifying ? 0.5 : 1 }"\n        >\n          <i class="fa-solid fa-wand-magic-sparkles" :class="{ \'icon-spin\': isModifying }"></i>\n          {{ isModifying ? \'ç”Ÿæˆä¸­...\' : \'ç¡®è®¤ç”Ÿæˆ\' }}\n        </button>\n        <button\n          @click="$emit(\'close\')"\n          :disabled="isModifying"\n          style="\n            flex: 1;\n            background: #666;\n            color: white;\n            border: none;\n            padding: 12px 24px;\n            border-radius: 6px;\n            cursor: pointer;\n            font-size: 14px;\n            font-weight: 600;\n            transition: all 0.2s;\n          "\n          :style="{ opacity: isModifying ? 0.5 : 1 }"\n        >\n          å–æ¶ˆ\n        </button>\n      </div>\n    </div>\n  </div>\n</template>\n\n<script setup lang="ts">\nimport { ref, watch } from \'vue\';\n\nconst props = defineProps<{\n  show: boolean;\n  title?: string;\n  description?: string;\n  examples?: string[];\n  placeholder?: string;\n  isModifying?: boolean;\n}>();\n\nconst emit = defineEmits<{\n  (e: \'close\'): void;\n  (e: \'confirm\', instruction: string): void;\n}>();\n\nconst localInstruction = ref(\'\');\n\n// å½“å¯¹è¯æ¡†æ˜¾ç¤ºæ—¶ï¼Œæ¸…ç©ºè¾“å…¥\nwatch(\n  () => props.show,\n  newVal => {\n    if (newVal) {\n      localInstruction.value = \'\';\n    }\n  },\n);\n\nconst handleConfirm = () => {\n  if (localInstruction.value && !props.isModifying) {\n    emit(\'confirm\', localInstruction.value);\n  }\n};\n<\/script>\n\n<style scoped>\nbutton:disabled {\n  cursor: not-allowed !important;\n}\n\nbutton:not(:disabled):hover {\n  transform: translateY(-2px);\n  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);\n}\n\n/* æ»šåŠ¨æ¡æ ·å¼ */\ndiv::-webkit-scrollbar {\n  width: 8px;\n}\n\ndiv::-webkit-scrollbar-track {\n  background: #1a1a1a;\n}\n\ndiv::-webkit-scrollbar-thumb {\n  background: #ffc107;\n  border-radius: 4px;\n}\n\ndiv::-webkit-scrollbar-thumb:hover {\n  background: #ffb300;\n}\n\n/* è¿›åº¦æ¡åŠ¨ç”» */\n.progress-bar {\n  position: absolute;\n  top: 0;\n  left: 0;\n  height: 100%;\n  width: 100%;\n  background: linear-gradient(90deg, #ffc107 0%, #ffb300 50%, #ffc107 100%);\n  background-size: 200% 100%;\n  animation: progressMove 2s linear infinite;\n  box-shadow: 0 0 10px rgba(255, 193, 7, 0.5);\n}\n\n@keyframes progressMove {\n  0% {\n    background-position: -200% 0;\n  }\n  100% {\n    background-position: 200% 0;\n  }\n}\n\n/* è„‰å†²åŠ¨ç”» */\n@keyframes pulse {\n  0%,\n  100% {\n    opacity: 1;\n    transform: scale(1);\n  }\n  50% {\n    opacity: 0.7;\n    transform: scale(1.1);\n  }\n}\n\n/* å›¾æ ‡æ—‹è½¬åŠ¨ç”» */\n.icon-spin {\n  animation: spin 1s linear infinite;\n}\n\n@keyframes spin {\n  from {\n    transform: rotate(0deg);\n  }\n  to {\n    transform: rotate(360deg);\n  }\n}\n</style>\n'],sourceRoot:''}]);const i=s},705:(e,n,t)=>{var a=t(390);a.__esModule&&(a=a.default),'string'==typeof a&&(a=[[e.id,a,'']]),a.locals&&(e.exports=a.locals);(0,t(424).A)('edc8d058',a,!1,{ssrId:!0})},707:e=>{e.exports=z},784:(e,n,t)=>{t.r(n),t.d(n,{default:()=>i});var a=t(790),o=t.n(a),r=t(54),s=t.n(r)()(o());s.push([e.id,'.table-tab[data-v-170043aa]{height:100%;overflow-y:auto;padding:25px !important}.section-header[data-v-170043aa]{display:flex;justify-content:space-between;align-items:center;padding:20px 25px !important;border-bottom:1px solid #3a3a3a;margin-bottom:5px}.section-header h3[data-v-170043aa]{margin:0;color:#fff;font-size:15px !important;font-weight:bold;display:flex;align-items:center;gap:8px}.count-badge[data-v-170043aa]{background:#4a9eff;color:white;padding:4px 8px;border-radius:12px;font-size:12px}.empty-state[data-v-170043aa]{text-align:center;padding:40px 20px;color:#888}.empty-state i[data-v-170043aa]{font-size:48px;margin-bottom:10px;opacity:0.3}.empty-state p[data-v-170043aa]{margin:10px 0;font-size:14px}.empty-state small[data-v-170043aa]{color:#666;font-size:12px}.history-list[data-v-170043aa]{display:flex;flex-direction:column;gap:10px;padding:15px 20px}.history-item[data-v-170043aa]{background:#2a2a2a;border:1px solid #3a3a3a;border-radius:6px;overflow:hidden;transition:border-color 0.2s}.history-item[data-v-170043aa]:hover{border-color:#4a4a4a}.history-header[data-v-170043aa]{padding:12px 15px;background:#1a1a1a;display:flex;justify-content:space-between;align-items:center;cursor:pointer;-webkit-user-select:none;user-select:none;transition:background 0.2s}.history-header[data-v-170043aa]:hover{background:#2a2a2a}.history-info[data-v-170043aa]{display:flex;align-items:center;gap:10px;flex:1}.history-number[data-v-170043aa]{color:#4a9eff;font-weight:bold}.history-range[data-v-170043aa]{color:#888;font-size:12px}.expand-icon[data-v-170043aa]{color:#888;font-size:12px}.history-content[data-v-170043aa]{padding:15px;background:#2a2a2a}.history-actions[data-v-170043aa]{display:flex;gap:8px;margin-bottom:12px;padding-bottom:8px;border-bottom:1px solid #3a3a3a}.mini-button[data-v-170043aa]{flex:1;padding:6px 12px;background:#2a2a2a;border:1px solid #3a3a3a;border-radius:4px;color:#e0e0e0;cursor:pointer;font-size:12px;transition:background 0.2s}.mini-button[data-v-170043aa]:hover{background:#3a3a3a}.mini-button.delete-button[data-v-170043aa]:hover{background:#ff4444;border-color:#ff4444;color:white}.table-display[data-v-170043aa]{margin-top:15px;overflow-x:auto;max-height:400px;overflow-y:auto;border-radius:6px;background:#1a1a1a}.table-display table[data-v-170043aa]{width:100%;font-size:12px;border-collapse:collapse}.table-display th[data-v-170043aa],.table-display td[data-v-170043aa]{white-space:nowrap;overflow:hidden;text-overflow:ellipsis;max-width:200px;padding:8px;border:1px solid #444}.table-display th[data-v-170043aa]{background:#2a2a2a;font-weight:bold;color:#fff}.table-display td[data-v-170043aa]{color:#e0e0e0}.copy-button:hover .shimmer-effect[data-v-170043aa],.delete-button:hover .shimmer-effect[data-v-170043aa]{left:100%}.copy-button[data-v-170043aa]:hover{transform:translateY(-1px);box-shadow:0 5px 15px rgba(40,167,69,0.4)}.delete-button[data-v-170043aa]:hover{transform:translateY(-1px);box-shadow:0 5px 15px rgba(255,107,107,0.4)}\n','',{version:3,sources:['webpack://./src/è®°å¿†_with_worldbook/components/TableTab.vue'],names:[],mappings:'AAomBA,4BACE,WAAY,CACZ,eAAgB,CAChB,uBACF,CAEA,iCACE,YAAa,CACb,6BAA8B,CAC9B,kBAAmB,CACnB,4BAA6B,CAC7B,+BAAgC,CAChC,iBACF,CAEA,oCACE,QAAS,CACT,UAAW,CACX,yBAA0B,CAC1B,gBAAiB,CACjB,YAAa,CACb,kBAAmB,CACnB,OACF,CAEA,8BACE,kBAAmB,CACnB,WAAY,CACZ,eAAgB,CAChB,kBAAmB,CACnB,cACF,CAEA,8BACE,iBAAkB,CAClB,iBAAkB,CAClB,UACF,CAEA,gCACE,cAAe,CACf,kBAAmB,CACnB,WACF,CAEA,gCACE,aAAc,CACd,cACF,CAEA,oCACE,UAAW,CACX,cACF,CAEA,+BACE,YAAa,CACb,qBAAsB,CACtB,QAAS,CACT,iBACF,CAEA,+BACE,kBAAmB,CACnB,wBAAyB,CACzB,iBAAkB,CAClB,eAAgB,CAChB,4BACF,CAEA,qCACE,oBACF,CAEA,iCACE,iBAAkB,CAClB,kBAAmB,CACnB,YAAa,CACb,6BAA8B,CAC9B,kBAAmB,CACnB,cAAe,CACf,wBAAiB,CAAjB,gBAAiB,CACjB,0BACF,CAEA,uCACE,kBACF,CAEA,+BACE,YAAa,CACb,kBAAmB,CACnB,QAAS,CACT,MACF,CAEA,iCACE,aAAc,CACd,gBACF,CAEA,gCACE,UAAW,CACX,cACF,CAEA,8BACE,UAAW,CACX,cACF,CAEA,kCACE,YAAa,CACb,kBACF,CAEA,kCACE,YAAa,CACb,OAAQ,CACR,kBAAmB,CACnB,kBAAmB,CACnB,+BACF,CAEA,8BACE,MAAO,CACP,gBAAiB,CACjB,kBAAmB,CACnB,wBAAyB,CACzB,iBAAkB,CAClB,aAAc,CACd,cAAe,CACf,cAAe,CACf,0BACF,CAEA,oCACE,kBACF,CAEA,kDACE,kBAAmB,CACnB,oBAAqB,CACrB,WACF,CAEA,gCACE,eAAgB,CAChB,eAAgB,CAChB,gBAAiB,CACjB,eAAgB,CAChB,iBAAkB,CAClB,kBACF,CAEA,sCACE,UAAW,CACX,cAAe,CACf,wBACF,CAEA,sEAEE,kBAAmB,CACnB,eAAgB,CAChB,sBAAuB,CACvB,eAAgB,CAChB,WAAY,CACZ,qBACF,CAEA,mCACE,kBAAmB,CACnB,gBAAiB,CACjB,UACF,CAEA,mCACE,aACF,CAGA,0GAEE,SACF,CAEA,oCACE,0BAA2B,CAC3B,yCACF,CAEA,sCACE,0BAA2B,CAC3B,2CACF',sourcesContent:['<template>\n  <div class="table-tab" style="padding: 25px !important; background: #1a1a1a !important">\n    <div\n      class="section-header"\n      style="\n        display: flex;\n        justify-content: space-between;\n        align-items: center;\n        padding: 20px 25px !important;\n        border-bottom: 1px solid #3a3a3a;\n        margin-bottom: 5px;\n      "\n    >\n      <h3\n        style="\n          margin: 0;\n          color: #fff;\n          font-size: 15px !important;\n          font-weight: bold;\n          display: flex;\n          align-items: center;\n          gap: 8px;\n        "\n      >\n        ğŸ“Š è¡¨æ ¼åˆ†æ\n      </h3>\n      <span\n        v-if="table_history.length > 0"\n        class="count-badge"\n        style="background: #4a9eff; color: white; padding: 4px 8px; border-radius: 12px; font-size: 12px"\n        >{{ table_history.length }} æ¡è®°å½•</span\n      >\n    </div>\n\n    \x3c!-- è¡¨æ ¼å†å²åˆ—è¡¨ --\x3e\n    <div\n      v-if="table_history && table_history.length > 0"\n      class="history-list"\n      style="display: flex; flex-direction: column; gap: 15px; margin-top: 20px"\n    >\n      <div\n        v-for="(item, index) in table_history"\n        :key="index"\n        class="history-item"\n        style="\n          background: #2a2a2a;\n          border: 1px solid #444;\n          border-radius: 8px;\n          padding: 15px;\n          transition: all 0.3s ease;\n        "\n      >\n        <div\n          class="history-header"\n          style="\n            padding: 12px 15px;\n            background: #1a1a1a;\n            display: flex;\n            justify-content: space-between;\n            align-items: center;\n            cursor: pointer;\n            user-select: none;\n            transition: background 0.2s;\n            border-radius: 6px;\n          "\n          @click="toggleTableExpanded(index)"\n        >\n          <div class="history-info" style="display: flex; align-items: center; gap: 10px; flex: 1">\n            <span class="history-number" style="color: #4a9eff; font-weight: bold">#{{ index + 1 }}</span>\n            <span class="history-range" style="color: #888; font-size: 12px"\n              >æ¥¼å±‚ {{ item.start_id }} - {{ item.end_id }}</span\n            >\n          </div>\n          <span class="expand-icon" style="color: #888; font-size: 12px">{{\n            isTableExpanded(index) ? \'â–¼\' : \'â–¶\'\n          }}</span>\n        </div>\n        <div\n          v-if="isTableExpanded(index)"\n          class="history-content"\n          style="padding: 15px; background: #2a2a2a; border-radius: 0 0 6px 6px"\n        >\n          <div\n            class="history-actions"\n            style="\n              display: flex;\n              gap: 10px;\n              margin-bottom: 12px;\n              padding-bottom: 8px;\n              border-bottom: 1px solid #3a3a3a;\n              flex-wrap: wrap;\n            "\n          >\n            <button\n              class="copy-button"\n              style="\n                padding: 8px 16px;\n                background: linear-gradient(135deg, #28a745 0%, #20c997 100%);\n                border: none;\n                border-radius: 6px;\n                color: white;\n                cursor: pointer;\n                font-size: 12px;\n                font-weight: 600;\n                transition: all 0.3s ease;\n                display: flex;\n                align-items: center;\n                gap: 6px;\n                box-shadow: 0 3px 12px rgba(40, 167, 69, 0.3);\n                position: relative;\n                overflow: hidden;\n              "\n              @click="copyTable(item)"\n            >\n              <div\n                style="\n                  position: absolute;\n                  top: 0;\n                  left: -100%;\n                  width: 100%;\n                  height: 100%;\n                  background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);\n                  transition: left 0.5s;\n                "\n                class="shimmer-effect"\n              ></div>\n              <i class="fa-solid fa-copy" style="font-size: 12px"></i> å¤åˆ¶\n            </button>\n            <button\n              class="delete-button"\n              style="\n                padding: 8px 16px;\n                background: linear-gradient(135deg, #ff6b6b 0%, #ee5a52 100%);\n                border: none;\n                border-radius: 6px;\n                color: white;\n                cursor: pointer;\n                font-size: 12px;\n                font-weight: 600;\n                transition: all 0.3s ease;\n                display: flex;\n                align-items: center;\n                gap: 6px;\n                box-shadow: 0 3px 12px rgba(255, 107, 107, 0.3);\n                position: relative;\n                overflow: hidden;\n              "\n              @click="deleteTable(index)"\n            >\n              <div\n                style="\n                  position: absolute;\n                  top: 0;\n                  left: -100%;\n                  width: 100%;\n                  height: 100%;\n                  background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);\n                  transition: left 0.5s;\n                "\n                class="shimmer-effect"\n              ></div>\n              <i class="fa-solid fa-trash" style="font-size: 12px"></i> åˆ é™¤\n            </button>\n          </div>\n          <div class="table-display" style="overflow-x: auto; border-radius: 6px; border: 1px solid #3a3a3a">\n            <table style="width: 100%; border-collapse: collapse; background: #1a1a1a">\n              <thead style="background: #2a2a2a">\n                <tr>\n                  <th\n                    v-for="(header, idx) in item.headers"\n                    :key="idx"\n                    style="\n                      padding: 12px 16px;\n                      text-align: left;\n                      font-weight: bold;\n                      color: #fff;\n                      border-bottom: 2px solid #3a3a3a;\n                      border-right: 1px solid #3a3a3a;\n                    "\n                  >\n                    {{ header }}\n                  </th>\n                </tr>\n              </thead>\n              <tbody>\n                <tr v-for="(row, rowIdx) in item.data" :key="rowIdx" style="border-bottom: 1px solid #3a3a3a">\n                  <td\n                    v-for="(cell, cellIdx) in row"\n                    :key="cellIdx"\n                    style="padding: 10px 16px; color: #e0e0e0; border-right: 1px solid #3a3a3a"\n                  >\n                    {{ cell }}\n                  </td>\n                </tr>\n              </tbody>\n            </table>\n          </div>\n        </div>\n      </div>\n    </div>\n    <div v-else class="empty-state" style="text-align: center; padding: 40px 20px; color: #888">\n      <i class="fa-solid fa-table" style="font-size: 48px; margin-bottom: 10px; opacity: 0.3"></i>\n      <p style="margin: 10px 0; font-size: 16px">è¿˜æ²¡æœ‰è¡¨æ ¼è®°å½•</p>\n      <small style="font-size: 12px; color: #666">ä½¿ç”¨"è®¾ç½®"æ ‡ç­¾é¡µæ‰‹åŠ¨ç”Ÿæˆè¡¨æ ¼</small>\n    </div>\n  </div>\n</template>\n\n<script setup lang="ts">\nimport { ref } from \'vue\';\nimport { getChatIdSafe } from \'../utils\';\n\n// å“åº”å¼æ•°æ®\nconst table_history = ref<Array<{ start_id: number; end_id: number; headers: string[]; data: string[][] }>>([]);\nconst tableExpandedState = ref<Map<number, boolean>>(new Map());\n\n// æ›´æ–°è¡¨æ ¼å†å²çš„å‡½æ•°\nconst refreshTableHistory = () => {\n  try {\n    const chat_id = getChatIdSafe();\n    if (!chat_id) {\n      console.warn(\'æ— æ³•è·å–èŠå¤©IDï¼Œæ¸…ç©ºè¡¨æ ¼å†å²\');\n      table_history.value = [];\n      return;\n    }\n\n    const chat_vars = getVariables({ type: \'chat\' });\n    console.log(\'ä»èŠå¤©å˜é‡è¯»å–çš„æ•°æ®:\', chat_vars);\n    console.log(\'è¡¨æ ¼å†å²æ•°æ®:\', chat_vars.table_history);\n\n    table_history.value = chat_vars.table_history || [];\n    console.log(\'å·²åˆ·æ–°è¡¨æ ¼å†å²ï¼Œå½“å‰èŠå¤©è¡¨æ ¼æ•°:\', table_history.value.length);\n  } catch (e) {\n    console.error(\'åˆ·æ–°è¡¨æ ¼å†å²å¤±è´¥:\', e);\n    table_history.value = [];\n  }\n};\n\n// åˆ‡æ¢è¡¨æ ¼å±•å¼€çŠ¶æ€\nconst toggleTableExpanded = (index: number) => {\n  const current = tableExpandedState.value.get(index) || false;\n  tableExpandedState.value.set(index, !current);\n};\n\nconst isTableExpanded = (index: number) => {\n  return tableExpandedState.value.get(index) || false;\n};\n\n// ç»Ÿä¸€çš„å¤åˆ¶å‡½æ•° - é’ˆå¯¹iframeç¯å¢ƒä¼˜åŒ–\nconst copyToClipboard = async (text: string, successMessage: string = \'å†…å®¹å·²å¤åˆ¶åˆ°å‰ªè´´æ¿\') => {\n  console.log(\'å¼€å§‹å¤åˆ¶ï¼Œæ–‡æœ¬é•¿åº¦:\', text.length);\n\n  try {\n    // åœ¨iframeç¯å¢ƒä¸­ï¼Œä¼˜å…ˆå°è¯•åœ¨çˆ¶çª—å£ä¸­å¤åˆ¶\n    if (window.parent && window.parent !== window) {\n      console.log(\'æ£€æµ‹åˆ°iframeç¯å¢ƒï¼Œå°è¯•åœ¨çˆ¶çª—å£å¤åˆ¶\');\n      const parentSuccess = await tryParentWindowCopy(text);\n      if (parentSuccess) {\n        console.log(\'çˆ¶çª—å£å¤åˆ¶æˆåŠŸ\');\n        window.toastr.success(successMessage);\n        return;\n      }\n    }\n\n    // æ–¹æ³•1: å°è¯•ä½¿ç”¨ç°ä»£çš„ Clipboard APIï¼ˆä»…åœ¨å®‰å…¨ä¸Šä¸‹æ–‡ä¸­ï¼‰\n    if (navigator.clipboard && window.isSecureContext) {\n      console.log(\'ä½¿ç”¨ç°ä»£ Clipboard API\');\n      try {\n        await navigator.clipboard.writeText(text);\n        console.log(\'Clipboard API å¤åˆ¶æˆåŠŸ\');\n        window.toastr.success(successMessage);\n        return;\n      } catch (clipboardErr) {\n        console.warn(\'Clipboard API å¤±è´¥:\', clipboardErr);\n        // ç»§ç»­å°è¯•å…¶ä»–æ–¹æ³•\n      }\n    }\n\n    // æ–¹æ³•2: ä½¿ç”¨ä¼ ç»Ÿçš„ execCommand æ–¹æ³•\n    console.log(\'ä½¿ç”¨ execCommand æ–¹æ³•\');\n    const success = await execCommandCopy(text);\n    if (success) {\n      console.log(\'execCommand å¤åˆ¶æˆåŠŸ\');\n      window.toastr.success(successMessage);\n      return;\n    }\n\n    // æ–¹æ³•3: å¦‚æœéƒ½å¤±è´¥äº†ï¼Œæ˜¾ç¤ºæ–‡æœ¬æ¡†è®©ç”¨æˆ·æ‰‹åŠ¨å¤åˆ¶\n    console.log(\'æ‰€æœ‰è‡ªåŠ¨å¤åˆ¶æ–¹æ³•éƒ½å¤±è´¥ï¼Œæ˜¾ç¤ºæ‰‹åŠ¨å¤åˆ¶ç•Œé¢\');\n    showManualCopyDialog(text);\n  } catch (err) {\n    console.error(\'å¤åˆ¶å¼‚å¸¸:\', err);\n    // å‡ºé”™æ—¶ä¹Ÿæ˜¾ç¤ºæ‰‹åŠ¨å¤åˆ¶ç•Œé¢\n    showManualCopyDialog(text);\n  }\n};\n\n// åœ¨çˆ¶çª—å£ä¸­å°è¯•å¤åˆ¶\nconst tryParentWindowCopy = async (text: string): Promise<boolean> => {\n  return new Promise(resolve => {\n    try {\n      const parentDoc = window.parent.document;\n      const parentBody = window.parent.document.body;\n\n      // åˆ›å»ºä¸€ä¸ªä¸´æ—¶çš„ textarea å…ƒç´ åœ¨çˆ¶çª—å£ä¸­\n      const textarea = parentDoc.createElement(\'textarea\');\n      textarea.value = text;\n      textarea.style.cssText = `\n        position: fixed;\n        left: -9999px;\n        top: -9999px;\n        opacity: 0;\n        pointer-events: none;\n        z-index: -1000;\n      `;\n      textarea.setAttribute(\'readonly\', \'\');\n\n      parentBody.appendChild(textarea);\n\n      // é€‰ä¸­æ–‡æœ¬\n      textarea.focus();\n      textarea.select();\n      textarea.setSelectionRange(0, text.length);\n\n      // å°è¯•å¤åˆ¶\n      const success = parentDoc.execCommand(\'copy\');\n\n      // æ¸…ç†\n      parentBody.removeChild(textarea);\n\n      resolve(success);\n    } catch (err) {\n      console.error(\'çˆ¶çª—å£å¤åˆ¶å¤±è´¥:\', err);\n      resolve(false);\n    }\n  });\n};\n\n// execCommand å¤åˆ¶æ–¹æ³•\nconst execCommandCopy = async (text: string): Promise<boolean> => {\n  return new Promise(resolve => {\n    try {\n      // åˆ›å»ºä¸€ä¸ªä¸´æ—¶çš„ textarea å…ƒç´ \n      const textarea = document.createElement(\'textarea\');\n      textarea.value = text;\n      textarea.style.position = \'fixed\';\n      textarea.style.left = \'-9999px\';\n      textarea.style.top = \'-9999px\';\n      textarea.style.opacity = \'0\';\n      textarea.style.pointerEvents = \'none\';\n      textarea.setAttribute(\'readonly\', \'\');\n\n      document.body.appendChild(textarea);\n\n      // é€‰ä¸­æ–‡æœ¬\n      textarea.select();\n      textarea.setSelectionRange(0, text.length);\n\n      // å°è¯•å¤åˆ¶\n      const success = document.execCommand(\'copy\');\n\n      // æ¸…ç†\n      document.body.removeChild(textarea);\n\n      resolve(success);\n    } catch (err) {\n      console.error(\'execCommand å¤åˆ¶å¤±è´¥:\', err);\n      resolve(false);\n    }\n  });\n};\n\n// æ‰‹åŠ¨å¤åˆ¶å¯¹è¯æ¡† - æ›´å¯é çš„å®ç°\nconst showManualCopyDialog = (text: string) => {\n  console.log(\'æ˜¾ç¤ºæ‰‹åŠ¨å¤åˆ¶å¯¹è¯æ¡†ï¼Œæ–‡æœ¬é•¿åº¦:\', text.length);\n\n  try {\n    // ä½¿ç”¨çˆ¶çª—å£çš„documentæ¥åˆ›å»ºå…ƒç´ \n    const parentDoc = window.parent.document;\n    const parentBody = window.parent.document.body;\n\n    // ç§»é™¤å¯èƒ½å­˜åœ¨çš„æ—§å¯¹è¯æ¡†\n    const existingOverlay = parentDoc.getElementById(\'manual-copy-overlay\');\n    if (existingOverlay) {\n      parentBody.removeChild(existingOverlay);\n    }\n\n    // åˆ›å»ºé®ç½©å±‚\n    const overlay = parentDoc.createElement(\'div\');\n    overlay.id = \'manual-copy-overlay\';\n    overlay.style.cssText = `\n      position: fixed;\n      top: 0;\n      left: 0;\n      right: 0;\n      bottom: 0;\n      background: rgba(0, 0, 0, 0.95);\n      z-index: 999999;\n      display: flex;\n      align-items: center;\n      justify-content: center;\n      font-family: -apple-system, BlinkMacSystemFont, \'Segoe UI\', Roboto, sans-serif;\n    `;\n\n    // åˆ›å»ºä¸»å®¹å™¨\n    const container = parentDoc.createElement(\'div\');\n    container.style.cssText = `\n      background: #2a2a2a;\n      border: 2px solid #4a9eff;\n      border-radius: 12px;\n      padding: 25px;\n      max-width: 900px;\n      width: 95%;\n      max-height: 85vh;\n      display: flex;\n      flex-direction: column;\n      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);\n    `;\n\n    // åˆ›å»ºæ ‡é¢˜\n    const header = parentDoc.createElement(\'div\');\n    header.innerHTML = `\n      <h3 style="margin: 0 0 15px 0; color: #4a9eff; text-align: center; font-size: 18px; font-weight: 600;">\n        ğŸ“‹ æ‰‹åŠ¨å¤åˆ¶è¡¨æ ¼å†…å®¹\n      </h3>\n      <div style="background: #1a1a1a; border: 1px solid #444; border-radius: 6px; padding: 12px; margin-bottom: 15px;">\n        <p style="margin: 0 0 8px 0; color: #e0e0e0; font-size: 14px;">\n          <strong>æ“ä½œæ­¥éª¤ï¼š</strong>\n        </p>\n        <ol style="margin: 0; padding-left: 20px; color: #ccc; font-size: 13px; line-height: 1.6;">\n          <li>ç‚¹å‡»ä¸‹æ–¹æ–‡æœ¬æ¡†</li>\n          <li>æŒ‰ <kbd style="background: #444; padding: 2px 6px; border-radius: 3px; color: #fff;">Ctrl+A</kbd> å…¨é€‰æ–‡æœ¬</li>\n          <li>æŒ‰ <kbd style="background: #444; padding: 2px 6px; border-radius: 3px; color: #fff;">Ctrl+C</kbd> å¤åˆ¶åˆ°å‰ªè´´æ¿</li>\n          <li>ç‚¹å‡»"å…³é—­"æŒ‰é’®æˆ–æŒ‰ <kbd style="background: #444; padding: 2px 6px; border-radius: 3px; color: #fff;">Esc</kbd> å…³é—­å¯¹è¯æ¡†</li>\n        </ol>\n      </div>\n    `;\n\n    // åˆ›å»ºæ–‡æœ¬æ¡†\n    const textarea = parentDoc.createElement(\'textarea\');\n    textarea.value = text;\n    textarea.style.cssText = `\n      width: 100%;\n      height: 400px;\n      background: #1a1a1a;\n      border: 2px solid #444;\n      border-radius: 6px;\n      padding: 15px;\n      color: #e0e0e0;\n      font-family: \'Courier New\', \'Consolas\', monospace;\n      font-size: 13px;\n      line-height: 1.5;\n      resize: vertical;\n      white-space: pre-wrap;\n      word-wrap: break-word;\n      outline: none;\n      margin-bottom: 20px;\n      box-sizing: border-box;\n    `;\n\n    // åˆ›å»ºæŒ‰é’®å®¹å™¨\n    const buttonContainer = parentDoc.createElement(\'div\');\n    buttonContainer.style.cssText = `\n      display: flex;\n      gap: 12px;\n      justify-content: center;\n      align-items: center;\n    `;\n\n    // åˆ›å»ºå…³é—­æŒ‰é’®\n    const closeButton = parentDoc.createElement(\'button\');\n    closeButton.textContent = \'å…³é—­\';\n    closeButton.style.cssText = `\n      background: #4a9eff;\n      color: white;\n      border: none;\n      padding: 12px 24px;\n      border-radius: 6px;\n      cursor: pointer;\n      font-size: 14px;\n      font-weight: 500;\n      transition: background 0.2s;\n    `;\n    closeButton.onmouseover = () => {\n      closeButton.style.background = \'#5ba8ff\';\n    };\n    closeButton.onmouseout = () => {\n      closeButton.style.background = \'#4a9eff\';\n    };\n\n    // åˆ›å»ºå¤åˆ¶æŒ‰é’®ï¼ˆå¤‡ç”¨ï¼‰\n    const copyButton = parentDoc.createElement(\'button\');\n    copyButton.textContent = \'å°è¯•è‡ªåŠ¨å¤åˆ¶\';\n    copyButton.style.cssText = `\n      background: #28a745;\n      color: white;\n      border: none;\n      padding: 12px 24px;\n      border-radius: 6px;\n      cursor: pointer;\n      font-size: 14px;\n      font-weight: 500;\n      transition: background 0.2s;\n    `;\n    copyButton.onmouseover = () => {\n      copyButton.style.background = \'#218838\';\n    };\n    copyButton.onmouseout = () => {\n      copyButton.style.background = \'#28a745\';\n    };\n\n    // ç»„è£…å…ƒç´ \n    buttonContainer.appendChild(copyButton);\n    buttonContainer.appendChild(closeButton);\n\n    container.appendChild(header);\n    container.appendChild(textarea);\n    container.appendChild(buttonContainer);\n    overlay.appendChild(container);\n\n    // æ·»åŠ åˆ°é¡µé¢\n    parentBody.appendChild(overlay);\n\n    // äº‹ä»¶å¤„ç†\n    closeButton.onclick = () => {\n      console.log(\'å…³é—­æŒ‰é’®è¢«ç‚¹å‡»\');\n      parentBody.removeChild(overlay);\n    };\n\n    copyButton.onclick = async () => {\n      console.log(\'å°è¯•è‡ªåŠ¨å¤åˆ¶æŒ‰é’®è¢«ç‚¹å‡»\');\n      try {\n        // é€‰ä¸­æ–‡æœ¬\n        textarea.focus();\n        textarea.select();\n\n        // å°è¯•å¤åˆ¶\n        const success = document.execCommand(\'copy\');\n        if (success) {\n          window.toastr.success(\'è‡ªåŠ¨å¤åˆ¶æˆåŠŸï¼\');\n          parentBody.removeChild(overlay);\n        } else {\n          window.toastr.warning(\'è‡ªåŠ¨å¤åˆ¶å¤±è´¥ï¼Œè¯·æ‰‹åŠ¨å¤åˆ¶\');\n        }\n      } catch (err) {\n        console.error(\'è‡ªåŠ¨å¤åˆ¶å¤±è´¥:\', err);\n        window.toastr.warning(\'è‡ªåŠ¨å¤åˆ¶å¤±è´¥ï¼Œè¯·æ‰‹åŠ¨å¤åˆ¶\');\n      }\n    };\n\n    // ç‚¹å‡»èƒŒæ™¯å…³é—­\n    overlay.onclick = e => {\n      if (e.target === overlay) {\n        console.log(\'ç‚¹å‡»èƒŒæ™¯å…³é—­\');\n        parentBody.removeChild(overlay);\n      }\n    };\n\n    // é”®ç›˜äº‹ä»¶å¤„ç†\n    const handleKeyDown = (e: KeyboardEvent) => {\n      if (e.key === \'Escape\') {\n        console.log(\'æŒ‰ESCé”®å…³é—­\');\n        parentBody.removeChild(overlay);\n        parentDoc.removeEventListener(\'keydown\', handleKeyDown);\n      }\n    };\n    parentDoc.addEventListener(\'keydown\', handleKeyDown);\n\n    // è‡ªåŠ¨é€‰ä¸­æ–‡æœ¬\n    setTimeout(() => {\n      console.log(\'è‡ªåŠ¨é€‰ä¸­æ–‡æœ¬\');\n      textarea.focus();\n      textarea.select();\n    }, 200);\n\n    // æ˜¾ç¤ºæˆåŠŸæ¶ˆæ¯\n    window.toastr.info(\'æ‰‹åŠ¨å¤åˆ¶å¯¹è¯æ¡†å·²æ‰“å¼€ï¼Œè¯·æŒ‰ç…§æç¤ºæ“ä½œ\');\n  } catch (err) {\n    console.error(\'åˆ›å»ºæ‰‹åŠ¨å¤åˆ¶å¯¹è¯æ¡†å¤±è´¥:\', err);\n    window.toastr.error(\'æ— æ³•æ˜¾ç¤ºå¤åˆ¶å¯¹è¯æ¡†ï¼Œè¯·æ£€æŸ¥æµè§ˆå™¨æƒé™\');\n  }\n};\n\n// å¤åˆ¶è¡¨æ ¼ - ä½¿ç”¨ç»Ÿä¸€çš„å¤åˆ¶å‡½æ•°\nconst copyTable = (tableItem: { headers: string[]; data: string[][] }) => {\n  try {\n    // åˆ›å»ºè¡¨æ ¼çš„TSVæ ¼å¼\n    const tsv = [tableItem.headers.join(\'\\t\'), ...tableItem.data.map(row => row.join(\'\\t\'))].join(\'\\n\');\n    copyToClipboard(tsv, \'è¡¨æ ¼å·²å¤åˆ¶åˆ°å‰ªè´´æ¿\');\n  } catch (error) {\n    console.error(\'å¤åˆ¶è¡¨æ ¼å¤±è´¥:\', error);\n    window.toastr.error(\'å¤åˆ¶å¤±è´¥ï¼Œè¯·æ‰‹åŠ¨å¤åˆ¶\');\n  }\n};\n\n// åˆ é™¤è¡¨æ ¼\nconst deleteTable = (index: number) => {\n  if (confirm(\'ç¡®å®šè¦åˆ é™¤è¿™ä¸ªè¡¨æ ¼å—ï¼Ÿ\')) {\n    table_history.value.splice(index, 1);\n    const chat_id = getChatIdSafe();\n    if (chat_id) {\n      insertOrAssignVariables({ table_history: table_history.value }, { type: \'chat\' });\n      window.toastr.success(\'è¡¨æ ¼å·²åˆ é™¤\');\n    }\n  }\n};\n\n// åˆå§‹åŒ–\nrefreshTableHistory();\n<\/script>\n\n<style scoped>\n.table-tab {\n  height: 100%;\n  overflow-y: auto;\n  padding: 25px !important;\n}\n\n.section-header {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  padding: 20px 25px !important;\n  border-bottom: 1px solid #3a3a3a;\n  margin-bottom: 5px;\n}\n\n.section-header h3 {\n  margin: 0;\n  color: #fff;\n  font-size: 15px !important;\n  font-weight: bold;\n  display: flex;\n  align-items: center;\n  gap: 8px;\n}\n\n.count-badge {\n  background: #4a9eff;\n  color: white;\n  padding: 4px 8px;\n  border-radius: 12px;\n  font-size: 12px;\n}\n\n.empty-state {\n  text-align: center;\n  padding: 40px 20px;\n  color: #888;\n}\n\n.empty-state i {\n  font-size: 48px;\n  margin-bottom: 10px;\n  opacity: 0.3;\n}\n\n.empty-state p {\n  margin: 10px 0;\n  font-size: 14px;\n}\n\n.empty-state small {\n  color: #666;\n  font-size: 12px;\n}\n\n.history-list {\n  display: flex;\n  flex-direction: column;\n  gap: 10px;\n  padding: 15px 20px;\n}\n\n.history-item {\n  background: #2a2a2a;\n  border: 1px solid #3a3a3a;\n  border-radius: 6px;\n  overflow: hidden;\n  transition: border-color 0.2s;\n}\n\n.history-item:hover {\n  border-color: #4a4a4a;\n}\n\n.history-header {\n  padding: 12px 15px;\n  background: #1a1a1a;\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  cursor: pointer;\n  user-select: none;\n  transition: background 0.2s;\n}\n\n.history-header:hover {\n  background: #2a2a2a;\n}\n\n.history-info {\n  display: flex;\n  align-items: center;\n  gap: 10px;\n  flex: 1;\n}\n\n.history-number {\n  color: #4a9eff;\n  font-weight: bold;\n}\n\n.history-range {\n  color: #888;\n  font-size: 12px;\n}\n\n.expand-icon {\n  color: #888;\n  font-size: 12px;\n}\n\n.history-content {\n  padding: 15px;\n  background: #2a2a2a;\n}\n\n.history-actions {\n  display: flex;\n  gap: 8px;\n  margin-bottom: 12px;\n  padding-bottom: 8px;\n  border-bottom: 1px solid #3a3a3a;\n}\n\n.mini-button {\n  flex: 1;\n  padding: 6px 12px;\n  background: #2a2a2a;\n  border: 1px solid #3a3a3a;\n  border-radius: 4px;\n  color: #e0e0e0;\n  cursor: pointer;\n  font-size: 12px;\n  transition: background 0.2s;\n}\n\n.mini-button:hover {\n  background: #3a3a3a;\n}\n\n.mini-button.delete-button:hover {\n  background: #ff4444;\n  border-color: #ff4444;\n  color: white;\n}\n\n.table-display {\n  margin-top: 15px;\n  overflow-x: auto;\n  max-height: 400px;\n  overflow-y: auto;\n  border-radius: 6px;\n  background: #1a1a1a;\n}\n\n.table-display table {\n  width: 100%;\n  font-size: 12px;\n  border-collapse: collapse;\n}\n\n.table-display th,\n.table-display td {\n  white-space: nowrap;\n  overflow: hidden;\n  text-overflow: ellipsis;\n  max-width: 200px;\n  padding: 8px;\n  border: 1px solid #444;\n}\n\n.table-display th {\n  background: #2a2a2a;\n  font-weight: bold;\n  color: #fff;\n}\n\n.table-display td {\n  color: #e0e0e0;\n}\n\n/* ç¾åŒ–æŒ‰é’®çš„æ‚¬åœæ•ˆæœ */\n.copy-button:hover .shimmer-effect,\n.delete-button:hover .shimmer-effect {\n  left: 100%;\n}\n\n.copy-button:hover {\n  transform: translateY(-1px);\n  box-shadow: 0 5px 15px rgba(40, 167, 69, 0.4);\n}\n\n.delete-button:hover {\n  transform: translateY(-1px);\n  box-shadow: 0 5px 15px rgba(255, 107, 107, 0.4);\n}\n</style>\n'],sourceRoot:''}]);const i=s},790:e=>{e.exports=function(e){var n=e[1],t=e[3];if(!t)return n;if('function'==typeof btoa){var a=btoa(unescape(encodeURIComponent(JSON.stringify(t)))),o='sourceMappingURL=data:application/json;charset=utf-8;base64,'.concat(a),r='/*# '.concat(o,' */');return[n].concat([r]).join('\n')}return[n].join('\n')}},800:(e,n)=>{n.A=(e,n)=>{const t=e.__vccOpts||e;for(const[e,a]of n)t[e]=a;return t}},831:(e,n,t)=>{t.r(n),t.d(n,{default:()=>i});var a=t(790),o=t.n(a),r=t(54),s=t.n(r)()(o());s.push([e.id,'.tools-tab[data-v-14fcd832]{height:100%;overflow-y:auto;padding:25px !important}.section-header[data-v-14fcd832]{display:flex;align-items:center;justify-content:space-between;padding:15px 20px;background:linear-gradient(135deg,#2a2a2a 0%,#3a3a3a 100%);border-radius:8px;cursor:pointer;transition:all 0.3s ease;margin-bottom:15px;border:1px solid #3a3a3a}.section-header[data-v-14fcd832]:hover{background:linear-gradient(135deg,#3a3a3a 0%,#4a4a4a 100%);transform:translateY(-1px);box-shadow:0 4px 12px rgba(0,0,0,0.3)}.section-header-anti-cliche[data-v-14fcd832]{background:linear-gradient(135deg,rgba(42,42,42,0.95) 0%,rgba(58,58,58,0.95) 100%) !important;border:1px solid rgba(255,107,107,0.3) !important;box-shadow:0 2px 8px rgba(0,0,0,0.2),0 0 0 1px rgba(255,107,107,0.1) inset !important;backdrop-filter:blur(10px)}.section-header-anti-cliche[data-v-14fcd832]:hover{background:linear-gradient(135deg,rgba(255,107,107,0.2) 0%,rgba(238,90,36,0.2) 100%) !important;border-color:rgba(255,107,107,0.5) !important;box-shadow:0 4px 16px rgba(255,107,107,0.3),0 0 0 1px rgba(255,107,107,0.2) inset !important;transform:translateY(-2px) !important}.section-header-worldbook[data-v-14fcd832]{background:linear-gradient(135deg,rgba(42,42,42,0.95) 0%,rgba(58,58,58,0.95) 100%) !important;border:1px solid rgba(255,193,7,0.3) !important;box-shadow:0 2px 8px rgba(0,0,0,0.2),0 0 0 1px rgba(255,193,7,0.1) inset !important;backdrop-filter:blur(10px)}.section-header-worldbook[data-v-14fcd832]:hover{background:linear-gradient(135deg,rgba(255,193,7,0.2) 0%,rgba(255,152,0,0.2) 100%) !important;border-color:rgba(255,193,7,0.5) !important;box-shadow:0 4px 16px rgba(255,193,7,0.3),0 0 0 1px rgba(255,193,7,0.2) inset !important;transform:translateY(-2px) !important}.section-header-character[data-v-14fcd832]{background:linear-gradient(135deg,rgba(42,42,42,0.95) 0%,rgba(58,58,58,0.95) 100%) !important;border:1px solid rgba(23,162,184,0.3) !important;box-shadow:0 2px 8px rgba(0,0,0,0.2),0 0 0 1px rgba(23,162,184,0.1) inset !important;backdrop-filter:blur(10px)}.section-header-character[data-v-14fcd832]:hover{background:linear-gradient(135deg,rgba(23,162,184,0.2) 0%,rgba(19,132,150,0.2) 100%) !important;border-color:rgba(23,162,184,0.5) !important;box-shadow:0 4px 16px rgba(23,162,184,0.3),0 0 0 1px rgba(23,162,184,0.2) inset !important;transform:translateY(-2px) !important}.tool-section-anti-cliche[data-v-14fcd832],.tool-section-worldbook[data-v-14fcd832],.tool-section-character[data-v-14fcd832]{margin-bottom:20px;border-radius:12px;overflow:hidden;background:rgba(26,26,26,0.5);backdrop-filter:blur(5px)}.tool-content[data-v-14fcd832]{background:#1e1e1e;border:1px solid #3a3a3a;border-radius:8px;padding:20px;margin-bottom:20px}.tool-instructions[data-v-14fcd832]{background:#1a1a1a;border:1px solid #3a3a3a;border-radius:6px;padding:12px;color:#ccc;font-size:12px;margin-bottom:15px}.form-group[data-v-14fcd832]{margin-bottom:15px}.button-group[data-v-14fcd832]{display:flex;gap:12px;margin-bottom:20px}.output-section[data-v-14fcd832]{margin-top:20px}.output-content[data-v-14fcd832]{background:#1e1e1e;border:1px solid #3a3a3a;border-radius:6px;padding:15px;color:#e0e0e0;font-size:13px;line-height:1.6;white-space:pre-wrap;word-wrap:break-word;max-height:300px;overflow-y:auto}.output-actions[data-v-14fcd832]{margin-top:12px;display:flex;gap:12px}.process-button[data-v-14fcd832],.clear-button[data-v-14fcd832],.generate-button[data-v-14fcd832],.copy-button[data-v-14fcd832]{position:relative;overflow:hidden;transition:all 0.3s ease}.process-button[data-v-14fcd832]:hover:not(:disabled),.clear-button[data-v-14fcd832]:hover:not(:disabled),.generate-button[data-v-14fcd832]:hover:not(:disabled),.copy-button[data-v-14fcd832]:hover{transform:translateY(-2px);box-shadow:0 6px 20px rgba(0,0,0,0.3)}.copy-button[data-v-14fcd832]:hover{background:#218838 !important}.tool-instructions[data-v-14fcd832]{background:#1a1a1a;border:1px solid #3a3a3a;border-radius:6px;padding:12px;color:#ccc;font-size:12px;margin-bottom:15px}.process-button:hover:not(:disabled) .shimmer-effect[data-v-14fcd832],.clear-button:hover:not(:disabled) .shimmer-effect[data-v-14fcd832],.generate-button:hover:not(:disabled) .shimmer-effect[data-v-14fcd832],.copy-button:hover .shimmer-effect[data-v-14fcd832]{left:100%}.process-button[data-v-14fcd832]:hover:not(:disabled){transform:translateY(-2px);box-shadow:0 6px 20px rgba(102,126,234,0.4)}.clear-button[data-v-14fcd832]:hover:not(:disabled){transform:translateY(-2px);box-shadow:0 6px 20px rgba(255,107,107,0.4)}.generate-button[data-v-14fcd832]:hover:not(:disabled){transform:translateY(-2px);box-shadow:0 6px 20px rgba(23,162,184,0.4)}.copy-button[data-v-14fcd832]:hover{transform:translateY(-1px);box-shadow:0 5px 15px rgba(40,167,69,0.4)}.process-button[data-v-14fcd832]:disabled,.clear-button[data-v-14fcd832]:disabled,.generate-button[data-v-14fcd832]:disabled{opacity:0.6;cursor:not-allowed;transform:none}.process-button[data-v-14fcd832]:disabled:hover,.clear-button[data-v-14fcd832]:disabled:hover,.generate-button[data-v-14fcd832]:disabled:hover{transform:none;box-shadow:none}.output-content[data-v-14fcd832]::-webkit-scrollbar{width:6px}.output-content[data-v-14fcd832]::-webkit-scrollbar-track{background:#1a1a1a;border-radius:3px}.output-content[data-v-14fcd832]::-webkit-scrollbar-thumb{background:#3a3a3a;border-radius:3px}.output-content[data-v-14fcd832]::-webkit-scrollbar-thumb:hover{background:#4a4a4a}@media (max-width:768px){.button-group[data-v-14fcd832]{flex-direction:column}.output-actions[data-v-14fcd832]{flex-direction:column}}\n','',{version:3,sources:['webpack://./src/è®°å¿†_with_worldbook/components/ToolsTab.vue'],names:[],mappings:'AAqqHA,4BACE,WAAY,CACZ,eAAgB,CAChB,uBACF,CAEA,iCACE,YAAa,CACb,kBAAmB,CACnB,6BAA8B,CAC9B,iBAAkB,CAClB,0DAA6D,CAC7D,iBAAkB,CAClB,cAAe,CACf,wBAAyB,CACzB,kBAAmB,CACnB,wBACF,CAEA,uCACE,0DAA6D,CAC7D,0BAA2B,CAC3B,qCACF,CAGA,6CACE,6FAAsG,CACtG,iDAAqD,CACrD,qFAEqD,CACrD,0BACF,CAEA,mDACE,+FAAwG,CACxG,6CAAiD,CACjD,4FAEqD,CACrD,qCACF,CAGA,2CACE,6FAAsG,CACtG,+CAAmD,CACnD,mFAEmD,CACnD,0BACF,CAEA,iDACE,6FAAsG,CACtG,2CAA+C,CAC/C,wFAEmD,CACnD,qCACF,CAGA,2CACE,6FAAsG,CACtG,gDAAoD,CACpD,oFAEoD,CACpD,0BACF,CAEA,iDACE,+FAAwG,CACxG,4CAAgD,CAChD,0FAEoD,CACpD,qCACF,CAGA,6HAGE,kBAAmB,CACnB,kBAAmB,CACnB,eAAgB,CAChB,6BAAiC,CACjC,yBACF,CAEA,+BACE,kBAAmB,CACnB,wBAAyB,CACzB,iBAAkB,CAClB,YAAa,CACb,kBACF,CAEA,oCACE,kBAAmB,CACnB,wBAAyB,CACzB,iBAAkB,CAClB,YAAa,CACb,UAAW,CACX,cAAe,CACf,kBACF,CAEA,6BACE,kBACF,CAEA,+BACE,YAAa,CACb,QAAS,CACT,kBACF,CAEA,iCACE,eACF,CAEA,iCACE,kBAAmB,CACnB,wBAAyB,CACzB,iBAAkB,CAClB,YAAa,CACb,aAAc,CACd,cAAe,CACf,eAAgB,CAChB,oBAAqB,CACrB,oBAAqB,CACrB,gBAAiB,CACjB,eACF,CAEA,iCACE,eAAgB,CAChB,YAAa,CACb,QACF,CAGA,gIAIE,iBAAkB,CAClB,eAAgB,CAChB,wBACF,CAEA,qMAIE,0BAA2B,CAC3B,qCACF,CAEA,oCACE,6BACF,CAEA,oCACE,kBAAmB,CACnB,wBAAyB,CACzB,iBAAkB,CAClB,YAAa,CACb,UAAW,CACX,cAAe,CACf,kBACF,CAGA,qQAIE,SACF,CAEA,sDACE,0BAA2B,CAC3B,2CACF,CAEA,oDACE,0BAA2B,CAC3B,2CACF,CAEA,uDACE,0BAA2B,CAC3B,0CACF,CAEA,oCACE,0BAA2B,CAC3B,yCACF,CAEA,6HAGE,WAAY,CACZ,kBAAmB,CACnB,cACF,CAEA,+IAGE,cAAe,CACf,eACF,CAGA,oDACE,SACF,CAEA,0DACE,kBAAmB,CACnB,iBACF,CAEA,0DACE,kBAAmB,CACnB,iBACF,CAEA,gEACE,kBACF,CAGA,yBACE,+BACE,qBACF,CAEA,iCACE,qBACF,CACF',sourcesContent:['<template>\n  <div class="tools-tab" style="padding: 25px !important; background: #1a1a1a !important">\n    \x3c!-- åå…«è‚¡å·¥å…· --\x3e\n    <div class="tool-section">\n      <div\n        class="section-header"\n        style="\n          display: flex;\n          justify-content: space-between;\n          align-items: center;\n          padding: 15px 20px;\n          background: linear-gradient(\n            135deg,\n            rgba(30, 30, 30, 0.95) 0%,\n            rgba(38, 38, 38, 0.9) 50%,\n            rgba(30, 30, 30, 0.95) 100%\n          );\n          backdrop-filter: blur(12px);\n          border-radius: 12px;\n          margin-bottom: 15px;\n          border: 1px solid rgba(255, 255, 255, 0.06);\n          box-shadow:\n            0 3px 12px rgba(0, 0, 0, 0.3),\n            inset 0 1px 0 rgba(255, 255, 255, 0.04),\n            inset 0 -1px 0 rgba(0, 0, 0, 0.2);\n          cursor: pointer;\n          transition: all 0.3s ease;\n        "\n        @click="toggleToolExpanded(\'antiCliche\')"\n        @mouseenter="(e: any) => (e.currentTarget.style.transform = \'translateY(-1px)\')"\n        @mouseleave="(e: any) => (e.currentTarget.style.transform = \'translateY(0)\')"\n      >\n        <h4\n          style="\n            margin: 0;\n            color: #fff;\n            font-size: 16px;\n            font-weight: 600;\n            display: flex;\n            align-items: center;\n            gap: 10px;\n          "\n        >\n          <i class="fa-solid fa-broom" style="color: #ff6b6b; font-size: 18px"></i>\n          åå…«è‚¡å·¥å…·\n        </h4>\n        <i\n          :class="isToolExpanded(\'antiCliche\') ? \'fa-solid fa-chevron-up\' : \'fa-solid fa-chevron-down\'"\n          style="color: #ccc; transition: transform 0.3s ease; font-size: 14px"\n        ></i>\n      </div>\n\n      <div v-if="isToolExpanded(\'antiCliche\')" class="tool-content">\n        <div class="tool-instructions">\n          <p style="margin: 0 0 8px 0; color: #ccc; font-size: 12px">\n            <i class="fa-solid fa-info-circle" style="margin-right: 6px; color: #17a2b8"></i>\n            è§’è‰²å¡/ä¸–ç•Œä¹¦/å¼€åœºç™½å…«è‚¡æ¸…ç†å·¥å…·ï¼Œ<strong style="color: #10b981">é€‚åº¦æ¸…ç†</strong>æ˜æ˜¾å…«è‚¡ï¼Œä¿æŒåŸæ–‡ä¿¡æ¯é‡ã€‚\n          </p>\n          <p\n            style="\n              margin: 0 0 8px 0;\n              color: #ffa500;\n              font-size: 11px;\n              background: #1a1a1a;\n              padding: 6px;\n              border-radius: 4px;\n              border-left: 3px solid #ffa500;\n            "\n          >\n            ğŸ¯\n            <strong>æ¸…ç†é‡ç‚¹</strong\n            >ï¼šæ¨¡ç³Šè¯ï¼ˆä¸€ä¸ã€ä¼¼ä¹ï¼‰ã€åŠ¨ç‰©åŒ–æ¯”å–»ï¼ˆåƒå°å…½ï¼‰ã€å¦å®šå¥å¼ï¼ˆä¸æ˜¯è€Œæ˜¯ï¼‰ã€æç«¯æƒ…ç»ªã€å¤¸å¼ ä¿®è¾\n          </p>\n          <p\n            style="\n              margin: 0;\n              color: #10b981;\n              font-size: 11px;\n              background: #1a1a1a;\n              padding: 6px;\n              border-radius: 4px;\n              border-left: 3px solid #10b981;\n            "\n          >\n            âœ… <strong>ä¿æŒå†…å®¹</strong>ï¼šæ ¸å¿ƒè®¾å®šã€å¯¹è¯å†…å®¹ã€å…·ä½“åŠ¨ä½œã€é‡è¦ä¿¡æ¯ - è¾“å…¥å‡ æ®µè¾“å‡ºå‡ æ®µï¼\n          </p>\n        </div>\n\n        <div class="form-group" style="margin: 15px 0">\n          <label style="display: block; margin-bottom: 8px; color: #ccc; font-size: 13px; font-weight: 500">\n            è¾“å…¥æ–‡æœ¬ï¼š\n          </label>\n          <textarea\n            v-model="antiClicheInput"\n            placeholder="è¯·è¾“å…¥éœ€è¦æ¸…ç†çš„æ–‡æœ¬..."\n            style="\n              width: 100%;\n              height: 120px;\n              padding: 12px;\n              background: #2a2a2a;\n              border: 1px solid #3a3a3a;\n              border-radius: 6px;\n              color: #e0e0e0;\n              font-size: 13px;\n              resize: vertical;\n              font-family: inherit;\n            "\n          ></textarea>\n        </div>\n\n        \x3c!-- æµå¼ä¼ è¾“å¼€å…³ --\x3e\n        <div class="form-group" style="margin: 15px 0">\n          <label style="display: flex; align-items: center; gap: 8px; color: #ccc; font-size: 13px; cursor: pointer">\n            <input v-model="enableAntiClicheStreaming" type="checkbox" style="cursor: pointer" />\n            å¯ç”¨æµå¼ä¼ è¾“ï¼ˆå¯æŸ¥çœ‹æ¸…ç†è¿›åº¦ï¼‰\n          </label>\n        </div>\n\n        \x3c!-- è¿›åº¦æ¡ --\x3e\n        <div\n          v-if="isProcessingAntiCliche && antiClicheProgressPercent > 0"\n          class="progress-bar-container"\n          style="margin: 15px 0"\n        >\n          <div\n            class="progress-bar"\n            style="\n              width: 100%;\n              height: 8px;\n              background: #2a2a2a;\n              border-radius: 4px;\n              overflow: hidden;\n              position: relative;\n            "\n          >\n            <div\n              class="progress-fill"\n              :style="{\n                width: antiClicheProgressPercent + \'%\',\n                height: \'100%\',\n                background: \'linear-gradient(90deg, #667eea 0%, #764ba2 50%, #667eea 100%)\',\n                backgroundSize: \'200% 100%\',\n                animation: enableAntiClicheStreaming ? \'progress-slide 2s linear infinite\' : \'none\',\n                transition: \'width 0.3s ease\',\n              }"\n            ></div>\n          </div>\n          <div style="text-align: center; margin-top: 8px; color: #667eea; font-size: 12px; font-weight: 500">\n            æ¸…ç†ä¸­... {{ antiClicheProgressPercent.toFixed(0) }}%\n          </div>\n        </div>\n\n        <div class="button-group" style="display: flex; gap: 12px; margin-bottom: 20px">\n          <button\n            class="process-button"\n            :disabled="isProcessingAntiCliche || !antiClicheInput.trim()"\n            style="\n              padding: 12px 24px;\n              background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);\n              border: none;\n              border-radius: 8px;\n              color: white;\n              font-size: 13px;\n              font-weight: 600;\n              cursor: pointer;\n              transition: all 0.3s ease;\n              box-shadow: 0 3px 12px rgba(102, 126, 234, 0.3);\n              position: relative;\n              overflow: hidden;\n            "\n            @click="handleAntiClicheProcess"\n          >\n            <div\n              style="\n                position: absolute;\n                top: 0;\n                left: -100%;\n                width: 100%;\n                height: 100%;\n                background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);\n                transition: left 0.5s;\n              "\n              class="shimmer-effect"\n            ></div>\n            <i class="fa-solid fa-magic" style="font-size: 14px; margin-right: 6px"></i>\n            {{ isProcessingAntiCliche ? \'å¤„ç†ä¸­...\' : \'å¼€å§‹æ¸…ç†\' }}\n          </button>\n\n          <button\n            class="clear-button"\n            style="\n              padding: 12px 24px;\n              background: linear-gradient(135deg, #ff6b6b 0%, #ee5a24 100%);\n              border: none;\n              border-radius: 8px;\n              color: white;\n              font-size: 13px;\n              font-weight: 600;\n              cursor: pointer;\n              transition: all 0.3s ease;\n              box-shadow: 0 3px 12px rgba(255, 107, 107, 0.3);\n              position: relative;\n              overflow: hidden;\n            "\n            @click="clearAntiClicheForm"\n          >\n            <div\n              style="\n                position: absolute;\n                top: 0;\n                left: -100%;\n                width: 100%;\n                height: 100%;\n                background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);\n                transition: left 0.5s;\n              "\n              class="shimmer-effect"\n            ></div>\n            <i class="fa-solid fa-trash" style="font-size: 14px; margin-right: 6px"></i>\n            æ¸…ç©º\n          </button>\n        </div>\n\n        \x3c!-- è¾“å‡ºåŒºåŸŸ --\x3e\n        <div v-if="antiClicheOutput" class="output-section">\n          <h5 style="margin: 0 0 12px 0; color: #fff; font-size: 14px; font-weight: 600">\n            <i class="fa-solid fa-check-circle" style="margin-right: 6px; color: #28a745"></i>\n            æ¸…ç†ç»“æœï¼š\n          </h5>\n          <div\n            class="output-content"\n            style="\n              background: #1e1e1e;\n              border: 1px solid #3a3a3a;\n              border-radius: 6px;\n              padding: 15px;\n              color: #e0e0e0;\n              font-size: 13px;\n              line-height: 1.6;\n              white-space: pre-wrap;\n              word-wrap: break-word;\n              max-height: 300px;\n              overflow-y: auto;\n            "\n          >\n            {{ antiClicheOutput }}\n          </div>\n\n          <div class="output-actions" style="margin-top: 12px; display: flex; gap: 12px">\n            <button\n              class="copy-button"\n              style="\n                padding: 10px 20px;\n                background: linear-gradient(135deg, #28a745 0%, #20c997 100%);\n                border: none;\n                border-radius: 6px;\n                color: white;\n                font-size: 13px;\n                font-weight: 600;\n                cursor: pointer;\n                transition: all 0.3s ease;\n                display: flex;\n                align-items: center;\n                gap: 8px;\n                box-shadow: 0 3px 12px rgba(40, 167, 69, 0.3);\n                position: relative;\n                overflow: hidden;\n              "\n              @click="copyAntiClicheResult"\n            >\n              <div\n                style="\n                  position: absolute;\n                  top: 0;\n                  left: -100%;\n                  width: 100%;\n                  height: 100%;\n                  background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);\n                  transition: left 0.5s;\n                "\n                class="shimmer-effect"\n              ></div>\n              <i class="fa-solid fa-copy" style="font-size: 14px"></i> å¤åˆ¶ç»“æœ\n            </button>\n          </div>\n\n          \x3c!-- ä¿®æ”¹åŠŸèƒ½ --\x3e\n          <div style="margin-top: 20px; padding-top: 20px; border-top: 1px solid #3a3a3a">\n            <h5 style="margin: 0 0 12px 0; color: #fff; font-size: 14px; font-weight: 600">\n              <i class="fa-solid fa-wand-magic-sparkles" style="margin-right: 6px; color: #ffc107"></i>\n              AI ä¿®æ”¹æ¸…ç†ç»“æœ\n            </h5>\n            <div class="form-group" style="margin-bottom: 12px">\n              <textarea\n                v-model="antiClicheModifyRequest"\n                placeholder="æè¿°ä½ æƒ³è¦çš„ä¿®æ”¹ï¼Œä¾‹å¦‚ï¼šæŠŠè¿™æ®µè¯æ”¹å¾—æ›´ç®€æ´ä¸€äº›..."\n                style="\n                  width: 100%;\n                  height: 80px;\n                  padding: 12px;\n                  background: #2a2a2a;\n                  border: 1px solid #3a3a3a;\n                  border-radius: 6px;\n                  color: #e0e0e0;\n                  font-size: 13px;\n                  resize: vertical;\n                  font-family: inherit;\n                "\n              ></textarea>\n            </div>\n\n            <div style="display: flex; gap: 10px">\n              <button\n                :disabled="isModifyingAntiCliche || !antiClicheModifyRequest.trim()"\n                style="\n                  flex: 1;\n                  padding: 10px 20px;\n                  background: linear-gradient(135deg, #ffc107 0%, #ff9800 100%);\n                  border: none;\n                  border-radius: 6px;\n                  color: #1a1a1a;\n                  font-size: 13px;\n                  font-weight: 600;\n                  cursor: pointer;\n                  transition: all 0.3s ease;\n                  box-shadow: 0 3px 12px rgba(255, 193, 7, 0.3);\n                  opacity: 1;\n                "\n                :style="{\n                  opacity: isModifyingAntiCliche || !antiClicheModifyRequest.trim() ? 0.5 : 1,\n                  cursor: isModifyingAntiCliche || !antiClicheModifyRequest.trim() ? \'not-allowed\' : \'pointer\',\n                }"\n                @click="handleModifyAntiCliche"\n              >\n                <i class="fa-solid fa-wand-magic-sparkles" style="margin-right: 6px"></i>\n                {{ isModifyingAntiCliche ? \'ä¿®æ”¹ä¸­...\' : \'AI ä¿®æ”¹\' }}\n              </button>\n              <button\n                :disabled="!antiClicheModifyRequest.trim()"\n                style="\n                  padding: 10px 20px;\n                  background: #dc3545;\n                  border: none;\n                  border-radius: 6px;\n                  color: white;\n                  font-size: 13px;\n                  font-weight: 600;\n                  cursor: pointer;\n                  transition: all 0.3s ease;\n                "\n                :style="{\n                  opacity: !antiClicheModifyRequest.trim() ? 0.5 : 1,\n                  cursor: !antiClicheModifyRequest.trim() ? \'not-allowed\' : \'pointer\',\n                }"\n                @click="clearAntiClicheModifyRequest"\n              >\n                <i class="fa-solid fa-eraser" style="margin-right: 6px"></i>\n                æ¸…ç©ºä¿®æ”¹éœ€æ±‚\n              </button>\n            </div>\n          </div>\n        </div>\n      </div>\n    </div>\n\n    \x3c!-- ä¸–ç•Œä¹¦æ¡ç›®ç”Ÿæˆå·¥å…· --\x3e\n    <div class="tool-section">\n      <div\n        class="section-header"\n        style="\n          display: flex;\n          justify-content: space-between;\n          align-items: center;\n          padding: 15px 20px;\n          background: linear-gradient(\n            135deg,\n            rgba(30, 30, 30, 0.95) 0%,\n            rgba(38, 38, 38, 0.9) 50%,\n            rgba(30, 30, 30, 0.95) 100%\n          );\n          backdrop-filter: blur(12px);\n          border-radius: 12px;\n          margin-bottom: 15px;\n          border: 1px solid rgba(255, 255, 255, 0.06);\n          box-shadow:\n            0 3px 12px rgba(0, 0, 0, 0.3),\n            inset 0 1px 0 rgba(255, 255, 255, 0.04),\n            inset 0 -1px 0 rgba(0, 0, 0, 0.2);\n          cursor: pointer;\n          transition: all 0.3s ease;\n        "\n        @click="toggleToolExpanded(\'worldbookEntry\')"\n        @mouseenter="(e: any) => (e.currentTarget.style.transform = \'translateY(-1px)\')"\n        @mouseleave="(e: any) => (e.currentTarget.style.transform = \'translateY(0)\')"\n      >\n        <h4\n          style="\n            margin: 0;\n            color: #fff;\n            font-size: 16px;\n            font-weight: 600;\n            display: flex;\n            align-items: center;\n            gap: 10px;\n          "\n        >\n          <i class="fa-solid fa-book-atlas" style="color: #ffc107; font-size: 18px"></i>\n          ä¸–ç•Œä¹¦æ¡ç›®ç”Ÿæˆå·¥å…·\n        </h4>\n        <i\n          :class="isToolExpanded(\'worldbookEntry\') ? \'fa-solid fa-chevron-up\' : \'fa-solid fa-chevron-down\'"\n          style="color: #ccc; transition: transform 0.3s ease; font-size: 14px"\n        ></i>\n      </div>\n\n      <div v-if="isToolExpanded(\'worldbookEntry\')" class="tool-content">\n        <div class="tool-instructions">\n          <p style="margin: 0 0 8px 0; color: #ccc; font-size: 12px">\n            <i class="fa-solid fa-info-circle" style="margin-right: 6px; color: #ffc107"></i>\n            è¾“å…¥ä½ æƒ³è¦çš„ä¸–ç•Œä¹¦æ¡ç›®æè¿°ï¼ŒAI å°†è‡ªåŠ¨ç”Ÿæˆç¬¦åˆæ ¼å¼çš„æ¡ç›®ï¼Œå¹¶å¯æ’å…¥åˆ°æŒ‡å®šä¸–ç•Œä¹¦ä¸­ã€‚\n          </p>\n          <p\n            style="\n              margin: 0;\n              color: #4a9eff;\n              font-size: 11px;\n              background: #1a1a1a;\n              padding: 6px;\n              border-radius: 4px;\n              border-left: 3px solid #ffc107;\n            "\n          >\n            ğŸ’¡ ç¤ºä¾‹ï¼šã€Œç”Ÿæˆä¸€ä¸ªå…³äºé­”æ³•å­¦é™¢çš„æ¡ç›®ï¼ŒåŒ…å«å­¦é™¢å†å²å’Œè§„åˆ™ã€ã€ã€Œåˆ›å»ºè§’è‰²"è‰¾è‰ä¸"çš„èƒŒæ™¯æ¡ç›®ã€\n          </p>\n        </div>\n\n        <div class="form-group" style="margin: 15px 0">\n          <label style="display: block; margin-bottom: 8px; color: #ccc; font-size: 13px; font-weight: 500">\n            æ¡ç›®æè¿°ï¼š\n          </label>\n          <textarea\n            v-model="worldbookDescription"\n            placeholder="è¯·æè¿°ä½ æƒ³è¦ç”Ÿæˆçš„ä¸–ç•Œä¹¦æ¡ç›®å†…å®¹..."\n            style="\n              width: 100%;\n              height: 120px;\n              padding: 12px;\n              background: #2a2a2a;\n              border: 1px solid #3a3a3a;\n              border-radius: 6px;\n              color: #e0e0e0;\n              font-size: 13px;\n              resize: vertical;\n              font-family: inherit;\n            "\n          ></textarea>\n        </div>\n\n        \x3c!-- æµå¼ä¼ è¾“å¼€å…³ --\x3e\n        <div class="form-group" style="margin: 15px 0">\n          <label style="display: flex; align-items: center; gap: 8px; color: #ccc; font-size: 13px; cursor: pointer">\n            <input v-model="enableWorldbookStreaming" type="checkbox" style="cursor: pointer" />\n            å¯ç”¨æµå¼ä¼ è¾“ï¼ˆå¯æŸ¥çœ‹ç”Ÿæˆè¿›åº¦ï¼‰\n          </label>\n        </div>\n\n        \x3c!-- è¿›åº¦æ¡ --\x3e\n        <div\n          v-if="isGeneratingWorldbook && worldbookProgressPercent > 0"\n          class="progress-bar-container"\n          style="margin: 15px 0"\n        >\n          <div\n            class="progress-bar"\n            style="\n              width: 100%;\n              height: 8px;\n              background: #2a2a2a;\n              border-radius: 4px;\n              overflow: hidden;\n              position: relative;\n            "\n          >\n            <div\n              class="progress-fill"\n              :style="{\n                width: worldbookProgressPercent + \'%\',\n                height: \'100%\',\n                background: \'linear-gradient(90deg, #ffc107 0%, #ff9800 50%, #ffc107 100%)\',\n                backgroundSize: \'200% 100%\',\n                animation: enableWorldbookStreaming ? \'progress-slide 2s linear infinite\' : \'none\',\n                transition: \'width 0.3s ease\',\n              }"\n            ></div>\n          </div>\n          <div style="text-align: center; margin-top: 8px; color: #ffc107; font-size: 12px; font-weight: 500">\n            ç”Ÿæˆä¸­... {{ worldbookProgressPercent.toFixed(0) }}%\n          </div>\n        </div>\n\n        <div class="button-group" style="display: flex; gap: 12px; margin-bottom: 20px">\n          <button\n            class="generate-button"\n            :disabled="isGeneratingWorldbook || !worldbookDescription.trim()"\n            style="\n              padding: 12px 24px;\n              background: linear-gradient(135deg, #ffc107 0%, #ff9800 100%);\n              border: none;\n              border-radius: 8px;\n              color: white;\n              font-size: 13px;\n              font-weight: 600;\n              cursor: pointer;\n              transition: all 0.3s ease;\n              box-shadow: 0 3px 12px rgba(255, 193, 7, 0.3);\n              position: relative;\n              overflow: hidden;\n            "\n            @click="handleGenerateWorldbookEntry"\n          >\n            <div\n              style="\n                position: absolute;\n                top: 0;\n                left: -100%;\n                width: 100%;\n                height: 100%;\n                background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);\n                transition: left 0.5s;\n              "\n              class="shimmer-effect"\n            ></div>\n            <i class="fa-solid fa-magic" style="font-size: 14px; margin-right: 6px"></i>\n            {{ isGeneratingWorldbook ? \'ç”Ÿæˆä¸­...\' : \'ç”Ÿæˆæ¡ç›®\' }}\n          </button>\n\n          <button\n            class="clear-button"\n            style="\n              padding: 12px 24px;\n              background: linear-gradient(135deg, #ff6b6b 0%, #ee5a24 100%);\n              border: none;\n              border-radius: 8px;\n              color: white;\n              font-size: 13px;\n              font-weight: 600;\n              cursor: pointer;\n              transition: all 0.3s ease;\n              box-shadow: 0 3px 12px rgba(255, 107, 107, 0.3);\n              position: relative;\n              overflow: hidden;\n            "\n            @click="clearWorldbookForm"\n          >\n            <div\n              style="\n                position: absolute;\n                top: 0;\n                left: -100%;\n                width: 100%;\n                height: 100%;\n                background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);\n                transition: left 0.5s;\n              "\n              class="shimmer-effect"\n            ></div>\n            <i class="fa-solid fa-trash" style="font-size: 14px; margin-right: 6px"></i>\n            æ¸…ç©º\n          </button>\n        </div>\n\n        \x3c!-- è¾“å‡ºåŒºåŸŸ --\x3e\n        <div v-if="worldbookEntryOutput" class="output-section">\n          <h5 style="margin: 0 0 12px 0; color: #fff; font-size: 14px; font-weight: 600">\n            <i class="fa-solid fa-check-circle" style="margin-right: 6px; color: #28a745"></i>\n            ç”Ÿæˆçš„æ¡ç›®ï¼š\n          </h5>\n\n          \x3c!-- æ¡ç›®é¢„è§ˆ --\x3e\n          <div\n            class="entry-preview"\n            style="\n              background: #1e1e1e;\n              border: 1px solid #3a3a3a;\n              border-radius: 6px;\n              padding: 15px;\n              margin-bottom: 15px;\n            "\n          >\n            <div class="entry-field" style="margin-bottom: 10px">\n              <label style="color: #ffc107; font-size: 12px; font-weight: 600; display: block; margin-bottom: 4px"\n                >æ¡ç›®åç§°ï¼š</label\n              >\n              <div style="color: #e0e0e0; font-size: 13px">{{ worldbookEntryOutput.name || \'æœªå‘½å\' }}</div>\n            </div>\n\n            <div class="entry-field" style="margin-bottom: 10px">\n              <label style="color: #ffc107; font-size: 12px; font-weight: 600; display: block; margin-bottom: 4px"\n                >ä¸»è¦å…³é”®å­—ï¼š</label\n              >\n              <div style="color: #e0e0e0; font-size: 13px">\n                {{ worldbookEntryOutput.strategy?.keys?.join(\', \') || \'æ— \' }}\n              </div>\n            </div>\n\n            <div class="entry-field" style="margin-bottom: 10px">\n              <label style="color: #ffc107; font-size: 12px; font-weight: 600; display: block; margin-bottom: 4px"\n                >æ¡ç›®å†…å®¹ï¼š</label\n              >\n              <div\n                style="\n                  color: #e0e0e0;\n                  font-size: 13px;\n                  line-height: 1.6;\n                  white-space: pre-wrap;\n                  max-height: 200px;\n                  overflow-y: auto;\n                "\n              >\n                {{ worldbookEntryOutput.content }}\n              </div>\n            </div>\n\n            <div class="entry-field">\n              <label style="color: #ffc107; font-size: 12px; font-weight: 600; display: block; margin-bottom: 4px"\n                >æ¿€æ´»ç­–ç•¥ï¼š</label\n              >\n              <div style="color: #e0e0e0; font-size: 13px">\n                {{\n                  worldbookEntryOutput.strategy?.type === \'constant\'\n                    ? \'ğŸ”µ å¸¸é‡ (è“ç¯)\'\n                    : worldbookEntryOutput.strategy?.type === \'selective\'\n                      ? \'ğŸŸ¢ å¯é€‰é¡¹ (ç»¿ç¯)\'\n                      : \'ğŸ”— å‘é‡åŒ–\'\n                }}\n              </div>\n            </div>\n          </div>\n\n          \x3c!-- æ¡ç›®ä¿®æ”¹åŒºåŸŸ --\x3e\n          <div class="modify-section" style="margin-top: 25px; border-top: 2px dashed #3a3a3a; padding-top: 20px">\n            <h5 style="margin: 0 0 12px 0; color: #fff; font-size: 14px; font-weight: 600">\n              <i class="fa-solid fa-edit" style="margin-right: 6px; color: #ffa500"></i>\n              ä¿®æ”¹æ¡ç›®\n            </h5>\n            <div\n              class="modify-instructions"\n              style="\n                background: #1a1a1a;\n                border: 1px solid #3a3a3a;\n                border-radius: 6px;\n                padding: 10px;\n                margin-bottom: 15px;\n              "\n            >\n              <p style="margin: 0 0 6px 0; color: #ccc; font-size: 12px">\n                <i class="fa-solid fa-lightbulb" style="margin-right: 6px; color: #ffa500"></i>\n                æè¿°ä½ æƒ³è¦ä¿®æ”¹çš„å†…å®¹ï¼ŒAIä¼šæ ¹æ®ä½ çš„éœ€æ±‚è°ƒæ•´æ¡ç›®ã€‚ä¾‹å¦‚ï¼š"å¢åŠ æ›´å¤šç»†èŠ‚"ã€"æ”¹ä¸ºå¥³æ€§è§’è‰²"ã€"æ·»åŠ æŠ€èƒ½è¯´æ˜"ç­‰ã€‚\n              </p>\n              <p style="margin: 0; color: #ffa500; font-size: 11px">âš ï¸ ä¿®æ”¹åä¼šä¿æŒ JSON æ ¼å¼ã€‚</p>\n            </div>\n\n            <div class="form-group" style="margin: 15px 0">\n              <label style="display: block; margin-bottom: 8px; color: #ccc; font-size: 13px; font-weight: 500">\n                ä¿®æ”¹éœ€æ±‚ï¼š\n              </label>\n              <textarea\n                v-model="worldbookModifyRequest"\n                placeholder="è¯·æè¿°ä½ æƒ³è¦ä¿®æ”¹çš„å†…å®¹..."\n                style="\n                  width: 100%;\n                  height: 80px;\n                  padding: 12px;\n                  background: #2a2a2a;\n                  border: 1px solid #3a3a3a;\n                  border-radius: 6px;\n                  color: #e0e0e0;\n                  font-size: 13px;\n                  resize: vertical;\n                  font-family: inherit;\n                "\n              ></textarea>\n            </div>\n\n            \x3c!-- ä¿®æ”¹è¿›åº¦æ¡ --\x3e\n            <div\n              v-if="isModifyingWorldbook && worldbookProgressPercent > 0"\n              class="progress-bar-container"\n              style="margin: 12px 0"\n            >\n              <div\n                class="progress-bar"\n                style="\n                  width: 100%;\n                  height: 8px;\n                  background: #2a2a2a;\n                  border-radius: 4px;\n                  overflow: hidden;\n                  position: relative;\n                "\n              >\n                <div\n                  class="progress-fill"\n                  :style="{\n                    width: worldbookProgressPercent + \'%\',\n                    height: \'100%\',\n                    background: \'linear-gradient(90deg, #ffa500 0%, #ff8c00 50%, #ffa500 100%)\',\n                    backgroundSize: \'200% 100%\',\n                    animation: enableWorldbookStreaming ? \'progress-slide 2s linear infinite\' : \'none\',\n                    transition: \'width 0.3s ease\',\n                  }"\n                ></div>\n              </div>\n              <div style="text-align: center; margin-top: 8px; color: #ffa500; font-size: 12px; font-weight: 500">\n                ä¿®æ”¹ä¸­... {{ worldbookProgressPercent.toFixed(0) }}%\n              </div>\n            </div>\n\n            <div class="button-group" style="display: flex; gap: 12px; margin-bottom: 15px">\n              <button\n                class="modify-button"\n                :disabled="isModifyingWorldbook || !worldbookModifyRequest.trim()"\n                style="\n                  padding: 12px 24px;\n                  background: linear-gradient(135deg, #ffa500 0%, #ff8c00 100%);\n                  border: none;\n                  border-radius: 8px;\n                  color: white;\n                  font-size: 13px;\n                  font-weight: 600;\n                  cursor: pointer;\n                  transition: all 0.3s ease;\n                  box-shadow: 0 3px 12px rgba(255, 165, 0, 0.3);\n                  position: relative;\n                  overflow: hidden;\n                "\n                @click="handleModifyWorldbookEntry"\n              >\n                <div\n                  style="\n                    position: absolute;\n                    top: 0;\n                    left: -100%;\n                    width: 100%;\n                    height: 100%;\n                    background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);\n                    transition: left 0.5s;\n                  "\n                  class="shimmer-effect"\n                ></div>\n                <i class="fa-solid fa-wand-magic-sparkles" style="font-size: 14px; margin-right: 6px"></i>\n                {{ isModifyingWorldbook ? \'ä¿®æ”¹ä¸­...\' : \'AIä¿®æ”¹\' }}\n              </button>\n\n              <button\n                class="clear-modify-button"\n                style="\n                  padding: 12px 24px;\n                  background: linear-gradient(135deg, #6c757d 0%, #5a6268 100%);\n                  border: none;\n                  border-radius: 8px;\n                  color: white;\n                  font-size: 13px;\n                  font-weight: 600;\n                  cursor: pointer;\n                  transition: all 0.3s ease;\n                  box-shadow: 0 3px 12px rgba(108, 117, 125, 0.3);\n                  position: relative;\n                  overflow: hidden;\n                "\n                @click="clearWorldbookModifyRequest"\n              >\n                <div\n                  style="\n                    position: absolute;\n                    top: 0;\n                    left: -100%;\n                    width: 100%;\n                    height: 100%;\n                    background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);\n                    transition: left 0.5s;\n                  "\n                  class="shimmer-effect"\n                ></div>\n                <i class="fa-solid fa-eraser" style="font-size: 14px; margin-right: 6px"></i>\n                æ¸…ç©ºä¿®æ”¹éœ€æ±‚\n              </button>\n            </div>\n          </div>\n\n          \x3c!-- ä¸–ç•Œä¹¦é€‰æ‹©å’Œæ’å…¥ --\x3e\n          <div class="insert-section" style="background: #1a1a1a; padding: 15px; border-radius: 6px; margin-top: 20px">\n            <h5 style="margin: 0 0 12px 0; color: #fff; font-size: 14px; font-weight: 600">\n              <i class="fa-solid fa-file-import" style="margin-right: 6px; color: #17a2b8"></i>\n              æ’å…¥åˆ°ä¸–ç•Œä¹¦\n            </h5>\n\n            <div class="form-group" style="margin-bottom: 12px">\n              <label style="display: block; margin-bottom: 8px; color: #ccc; font-size: 13px; font-weight: 500">\n                é€‰æ‹©ä¸–ç•Œä¹¦ï¼š\n              </label>\n              <select\n                v-model="selectedWorldbook"\n                style="\n                  width: 100%;\n                  padding: 10px;\n                  background: #2a2a2a;\n                  border: 1px solid #3a3a3a;\n                  border-radius: 6px;\n                  color: #e0e0e0;\n                  font-size: 13px;\n                "\n              >\n                <option value="" disabled>è¯·é€‰æ‹©ä¸–ç•Œä¹¦</option>\n                <option v-for="wb in availableWorldbooks" :key="wb" :value="wb">{{ wb }}</option>\n              </select>\n            </div>\n\n            <div class="output-actions" style="display: flex; gap: 12px">\n              <button\n                class="insert-button"\n                :disabled="!selectedWorldbook || isInsertingEntry"\n                style="\n                  padding: 10px 20px;\n                  background: linear-gradient(135deg, #28a745 0%, #20c997 100%);\n                  border: none;\n                  border-radius: 6px;\n                  color: white;\n                  font-size: 13px;\n                  font-weight: 600;\n                  cursor: pointer;\n                  transition: all 0.3s ease;\n                  display: flex;\n                  align-items: center;\n                  gap: 8px;\n                  box-shadow: 0 3px 12px rgba(40, 167, 69, 0.3);\n                  position: relative;\n                  overflow: hidden;\n                "\n                @click="handleInsertEntry"\n              >\n                <div\n                  style="\n                    position: absolute;\n                    top: 0;\n                    left: -100%;\n                    width: 100%;\n                    height: 100%;\n                    background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);\n                    transition: left 0.5s;\n                  "\n                  class="shimmer-effect"\n                ></div>\n                <i class="fa-solid fa-plus-circle" style="font-size: 14px"></i>\n                {{ isInsertingEntry ? \'æ’å…¥ä¸­...\' : \'æ’å…¥æ¡ç›®\' }}\n              </button>\n\n              <button\n                class="copy-button"\n                style="\n                  padding: 10px 20px;\n                  background: linear-gradient(135deg, #17a2b8 0%, #138496 100%);\n                  border: none;\n                  border-radius: 6px;\n                  color: white;\n                  font-size: 13px;\n                  font-weight: 600;\n                  cursor: pointer;\n                  transition: all 0.3s ease;\n                  display: flex;\n                  align-items: center;\n                  gap: 8px;\n                  box-shadow: 0 3px 12px rgba(23, 162, 184, 0.3);\n                  position: relative;\n                  overflow: hidden;\n                "\n                @click="copyWorldbookEntry"\n              >\n                <div\n                  style="\n                    position: absolute;\n                    top: 0;\n                    left: -100%;\n                    width: 100%;\n                    height: 100%;\n                    background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);\n                    transition: left 0.5s;\n                  "\n                  class="shimmer-effect"\n                ></div>\n                <i class="fa-solid fa-copy" style="font-size: 14px"></i> å¤åˆ¶ JSON\n              </button>\n            </div>\n          </div>\n        </div>\n      </div>\n    </div>\n\n    \x3c!-- ä¸–ç•Œä¹¦æ¡ç›®æŸ¥çœ‹å™¨ --\x3e\n    <div class="tool-section">\n      <div\n        class="section-header viewer-header"\n        style="\n          display: flex;\n          justify-content: space-between;\n          align-items: center;\n          padding: 15px 20px;\n          background: linear-gradient(\n            135deg,\n            rgba(30, 30, 30, 0.95) 0%,\n            rgba(38, 38, 38, 0.9) 50%,\n            rgba(30, 30, 30, 0.95) 100%\n          );\n          backdrop-filter: blur(12px);\n          border-radius: 12px;\n          margin-bottom: 15px;\n          border: 1px solid rgba(255, 255, 255, 0.06);\n          box-shadow:\n            0 3px 12px rgba(0, 0, 0, 0.3),\n            inset 0 1px 0 rgba(255, 255, 255, 0.04),\n            inset 0 -1px 0 rgba(0, 0, 0, 0.2);\n          cursor: pointer;\n          transition: all 0.3s ease;\n        "\n        @click="toggleToolExpanded(\'worldbookViewer\')"\n        @mouseenter="(e: any) => (e.currentTarget.style.transform = \'translateY(-1px)\')"\n        @mouseleave="(e: any) => (e.currentTarget.style.transform = \'translateY(0)\')"\n      >\n        <h4\n          style="\n            margin: 0;\n            color: #fff;\n            font-size: 16px;\n            font-weight: 600;\n            display: flex;\n            align-items: center;\n            gap: 10px;\n          "\n        >\n          <i class="fa-solid fa-list" style="color: #20c997; font-size: 18px"></i>\n          ä¸–ç•Œä¹¦æ¡ç›®æŸ¥çœ‹å™¨\n        </h4>\n        <i\n          :class="isToolExpanded(\'worldbookViewer\') ? \'fa-solid fa-chevron-up\' : \'fa-solid fa-chevron-down\'"\n          style="color: #888; font-size: 14px; transition: transform 0.3s ease"\n        ></i>\n      </div>\n\n      <div v-if="isToolExpanded(\'worldbookViewer\')" class="tool-content">\n        <div\n          class="tool-instructions"\n          style="\n            background: rgba(32, 201, 151, 0.1);\n            border-left: 3px solid #20c997;\n            padding: 12px 15px;\n            border-radius: 6px;\n            margin-bottom: 20px;\n          "\n        >\n          <p style="margin: 0; color: #a0f0e0; font-size: 13px; display: flex; align-items: center; gap: 8px">\n            <i class="fa-solid fa-info-circle" style="color: #20c997"></i>\n            é€‰æ‹©ä¸€ä¸ªä¸–ç•Œä¹¦ï¼ŒæŸ¥çœ‹å…¶ä¸­æ‰€æœ‰æ¡ç›®çš„è¯¦ç»†ä¿¡æ¯ï¼Œæ”¯æŒæœç´¢å’Œç­›é€‰ã€‚\n          </p>\n        </div>\n\n        \x3c!-- é€‰æ‹©ä¸–ç•Œä¹¦ --\x3e\n        <div class="form-group" style="margin-bottom: 20px">\n          <label\n            style="\n              display: block;\n              margin-bottom: 10px;\n              color: #e0e0e0;\n              font-size: 14px;\n              font-weight: 500;\n              letter-spacing: 0.3px;\n            "\n          >\n            é€‰æ‹©ä¸–ç•Œä¹¦ï¼š\n          </label>\n          <select\n            v-model="selectedViewerWorldbook"\n            style="\n              width: 100%;\n              padding: 12px 15px;\n              background: #2a2a2a;\n              border: 1px solid rgba(255, 255, 255, 0.1);\n              border-radius: 8px;\n              color: #e0e0e0;\n              font-size: 14px;\n              cursor: pointer;\n              transition: all 0.3s ease;\n              box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.2);\n            "\n            @change="loadWorldbookEntries"\n            @focus="(e: any) => (e.target.style.borderColor = \'#20c997\')"\n            @blur="(e: any) => (e.target.style.borderColor = \'rgba(255, 255, 255, 0.1)\')"\n          >\n            <option value="">è¯·é€‰æ‹©ä¸–ç•Œä¹¦</option>\n            <option v-for="wb in availableWorldbooks" :key="wb" :value="wb">\n              {{ wb }}\n            </option>\n          </select>\n        </div>\n\n        \x3c!-- æœç´¢æ¡ç›® --\x3e\n        <div v-if="selectedViewerWorldbook" class="form-group" style="margin-bottom: 20px">\n          <label\n            style="\n              display: block;\n              margin-bottom: 10px;\n              color: #e0e0e0;\n              font-size: 14px;\n              font-weight: 500;\n              letter-spacing: 0.3px;\n            "\n          >\n            æœç´¢æ¡ç›®ï¼š\n          </label>\n          <input\n            v-model="viewerSearchQuery"\n            type="text"\n            placeholder="æœç´¢æ¡ç›®åç§°ã€å…³é”®å­—æˆ–å†…å®¹..."\n            style="\n              width: 100%;\n              padding: 12px 15px;\n              background: #2a2a2a;\n              border: 1px solid rgba(255, 255, 255, 0.1);\n              border-radius: 8px;\n              color: #e0e0e0;\n              font-size: 14px;\n              transition: all 0.3s ease;\n              box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.2);\n            "\n            @focus="(e: any) => (e.target.style.borderColor = \'#20c997\')"\n            @blur="(e: any) => (e.target.style.borderColor = \'rgba(255, 255, 255, 0.1)\')"\n          />\n        </div>\n\n        \x3c!-- æ’åº --\x3e\n        <div\n          v-if="selectedViewerWorldbook && worldbookEntries.length > 0"\n          style="display: flex; gap: 10px; margin-bottom: 15px"\n        >\n          <button\n            :style="{\n              padding: \'8px 16px\',\n              background: viewerSortBy === \'original\' ? \'#20c997\' : \'#444\',\n              border: \'none\',\n              borderRadius: \'6px\',\n              color: \'white\',\n              fontSize: \'12px\',\n              cursor: \'pointer\',\n              transition: \'all 0.2s\',\n            }"\n            @click="viewerSortBy = \'original\'"\n          >\n            åŸå§‹é¡ºåº\n          </button>\n          <button\n            :style="{\n              padding: \'8px 16px\',\n              background: viewerSortBy === \'enabled\' ? \'#28a745\' : \'#444\',\n              border: \'none\',\n              borderRadius: \'6px\',\n              color: \'white\',\n              fontSize: \'12px\',\n              cursor: \'pointer\',\n              transition: \'all 0.2s\',\n            }"\n            @click="viewerSortBy = \'enabled\'"\n          >\n            âœ“ å…¨é€‰\n          </button>\n          <button\n            :style="{\n              padding: \'8px 16px\',\n              background: viewerSortBy === \'disabled\' ? \'#dc3545\' : \'#444\',\n              border: \'none\',\n              borderRadius: \'6px\',\n              color: \'white\',\n              fontSize: \'12px\',\n              cursor: \'pointer\',\n              transition: \'all 0.2s\',\n            }"\n            @click="viewerSortBy = \'disabled\'"\n          >\n            âœ• å–æ¶ˆå…¨é€‰\n          </button>\n        </div>\n\n        \x3c!-- æ‰¾åˆ°çš„æ¡ç›®ç»Ÿè®¡ --\x3e\n        <div v-if="selectedViewerWorldbook" style="margin-bottom: 15px; color: #888; font-size: 12px">\n          <span v-if="filteredWorldbookEntries.length > 0"> å…±æ‰¾åˆ° {{ filteredWorldbookEntries.length }} ä¸ªæ¡ç›® </span>\n          <span v-else style="color: #ff6b6b">æœªæ‰¾åˆ°æ¡ç›®</span>\n        </div>\n\n        \x3c!-- æ¡ç›®åˆ—è¡¨ --\x3e\n        <div v-if="filteredWorldbookEntries.length > 0" style="display: flex; flex-direction: column; gap: 12px">\n          <div\n            v-for="(entry, index) in filteredWorldbookEntries"\n            :key="index"\n            style="\n              background: #2a2a2a;\n              border: 1px solid #3a3a3a;\n              border-radius: 8px;\n              padding: 15px;\n              transition: all 0.3s ease;\n            "\n          >\n            \x3c!-- æ¡ç›®å¤´éƒ¨ --\x3e\n            <div\n              style="\n                display: flex;\n                justify-content: space-between;\n                align-items: flex-start;\n                cursor: pointer;\n                user-select: none;\n              "\n              @click="toggleEntryExpanded(index)"\n            >\n              \x3c!-- ä¸‰è¡Œæ ¼å¼æ˜¾ç¤º --\x3e\n              <div style="flex: 1; line-height: 1.6">\n                \x3c!-- ç¬¬ä¸€è¡Œï¼šçŠ¶æ€ç¯ + æ¡ç›®åç§° --\x3e\n                <div style="display: flex; align-items: center; gap: 6px; margin-bottom: 8px">\n                  <span v-if="entry.strategy?.type === \'constant\'" style="font-size: 14px">ğŸ”µ</span>\n                  <span v-else-if="entry.strategy?.type === \'selective\'" style="font-size: 14px">ğŸŸ¢</span>\n                  <span v-else style="font-size: 14px">âšª</span>\n                  <span style="color: #fff; font-weight: 600; font-size: 14px">\n                    {{ entry.name || \'(æ— åç§°)\' }}\n                  </span>\n                </div>\n\n                \x3c!-- ç¬¬äºŒè¡Œï¼šå…³é”®è¯ | ä½ç½® | æ·±åº¦ --\x3e\n                <div style="padding-left: 20px; margin-bottom: 6px; font-size: 12px; color: #ccc">\n                  <span v-if="entry.strategy?.keys && entry.strategy.keys.length > 0">\n                    å…³é”®è¯:\n                    {{ entry.strategy.keys.map((k: any) => (typeof k === \'string\' ? k : String(k))).join(\', \') }}\n                  </span>\n                  <span v-else>å…³é”®è¯: (æ— )</span>\n\n                  <span v-if="entry.position?.order && entry.position.order !== 0">\n                    <span style="color: #666"> | </span>\n                    é¡ºåº: {{ entry.position.order }}\n                  </span>\n\n                  <span\n                    v-if="entry.position?.type === \'at_depth\' && entry.position.depth && entry.position.depth !== 0"\n                  >\n                    <span style="color: #666"> | </span>\n                    æ·±åº¦: {{ entry.position.depth }}\n                  </span>\n                </div>\n\n                \x3c!-- ç¬¬ä¸‰è¡Œï¼šå†…å®¹é¢„è§ˆ --\x3e\n                <div style="padding-left: 20px; font-size: 12px; color: #999; font-style: italic">\n                  {{\n                    entry.content\n                      ? entry.content.length > 50\n                        ? entry.content.substring(0, 50) + \'...\'\n                        : entry.content\n                      : \'(æ— å†…å®¹)\'\n                  }}\n                </div>\n              </div>\n\n              <i\n                :class="isEntryExpanded(index) ? \'fa-solid fa-chevron-up\' : \'fa-solid fa-chevron-down\'"\n                style="color: #888; font-size: 12px; margin-top: 2px"\n              ></i>\n            </div>\n\n            \x3c!-- æ¡ç›®å†…å®¹ï¼ˆå±•å¼€æ—¶æ˜¾ç¤ºï¼‰ --\x3e\n            <div\n              v-if="isEntryExpanded(index)"\n              style="margin-top: 15px; padding-top: 15px; border-top: 1px solid #3a3a3a"\n            >\n              \x3c!-- è§¦å‘ç­–ç•¥ä¿¡æ¯ --\x3e\n              <div style="margin-bottom: 12px">\n                <span style="color: #888; font-size: 12px; font-weight: 600; display: block; margin-bottom: 6px">\n                  âš™ï¸ è§¦å‘ç­–ç•¥ï¼š\n                </span>\n                <div style="display: flex; align-items: center; gap: 8px">\n                  <span\n                    v-if="entry.strategy?.type === \'constant\'"\n                    style="\n                      padding: 4px 10px;\n                      background: #4a9eff;\n                      color: white;\n                      border-radius: 12px;\n                      font-size: 11px;\n                      font-weight: bold;\n                    "\n                  >\n                    ğŸ”µ è“ç¯ï¼ˆå¸¸é‡ï¼‰- æ— éœ€å…³é”®å­—åŒ¹é…\n                  </span>\n                  <span\n                    v-else-if="entry.strategy?.type === \'selective\'"\n                    style="\n                      padding: 4px 10px;\n                      background: #28a745;\n                      color: white;\n                      border-radius: 12px;\n                      font-size: 11px;\n                      font-weight: bold;\n                    "\n                  >\n                    ğŸŸ¢ ç»¿ç¯ï¼ˆå¯é€‰é¡¹ï¼‰- éœ€è¦å…³é”®å­—åŒ¹é…\n                  </span>\n                  <span\n                    v-else\n                    style="\n                      padding: 4px 10px;\n                      background: #888;\n                      color: white;\n                      border-radius: 12px;\n                      font-size: 11px;\n                      font-weight: bold;\n                    "\n                  >\n                    âšª æœªçŸ¥ç±»å‹\n                  </span>\n                </div>\n              </div>\n\n              \x3c!-- å…³é”®å­— --\x3e\n              <div style="margin-bottom: 12px">\n                <span style="color: #888; font-size: 12px; font-weight: 600; display: block; margin-bottom: 6px">\n                  ğŸ”‘ å…³é”®å­—ï¼š\n                  <span\n                    v-if="entry.strategy?.type === \'constant\'"\n                    style="color: #ffa500; font-size: 10px; margin-left: 6px"\n                  >\n                    (è“ç¯æ¡ç›®é€šå¸¸ä¸éœ€è¦å…³é”®å­—)\n                  </span>\n                </span>\n                <div style="display: flex; flex-wrap: wrap; gap: 6px">\n                  <span\n                    v-for="(key, ki) in entry.strategy?.keys || []"\n                    :key="ki"\n                    style="padding: 4px 10px; background: #667eea; color: white; border-radius: 12px; font-size: 11px"\n                  >\n                    {{ typeof key === \'string\' ? key : String(key) }}\n                  </span>\n                  <span\n                    v-if="!entry.strategy?.keys || entry.strategy.keys.length === 0"\n                    style="color: #888; font-size: 11px"\n                  >\n                    {{ entry.strategy?.type === \'constant\' ? \'(è“ç¯æ¡ç›®æ— éœ€å…³é”®å­—)\' : \'(æ— å…³é”®å­—)\' }}\n                  </span>\n                </div>\n              </div>\n\n              \x3c!-- æ¡ç›®å†…å®¹ --\x3e\n              <div style="margin-bottom: 12px">\n                <span style="color: #888; font-size: 12px; font-weight: 600; display: block; margin-bottom: 6px">\n                  ğŸ“„ æ¡ç›®å†…å®¹ï¼š\n                </span>\n                <div\n                  style="\n                    padding: 12px;\n                    background: #1a1a1a;\n                    border: 1px solid #3a3a3a;\n                    border-radius: 6px;\n                    color: #ccc;\n                    font-size: 12px;\n                    line-height: 1.6;\n                    max-height: 200px;\n                    overflow-y: auto;\n                    white-space: pre-wrap;\n                  "\n                >\n                  {{ entry.content || \'(æ— å†…å®¹)\' }}\n                </div>\n              </div>\n\n              \x3c!-- æ“ä½œæŒ‰é’® --\x3e\n              <div style="display: flex; gap: 10px; margin-top: 12px">\n                <button\n                  style="\n                    padding: 8px 16px;\n                    background: #4a9eff;\n                    border: none;\n                    border-radius: 6px;\n                    color: white;\n                    font-size: 12px;\n                    cursor: pointer;\n                    transition: all 0.2s;\n                  "\n                  @click="editWorldbookEntry(entry)"\n                >\n                  <i class="fa-solid fa-edit"></i> ç¼–è¾‘\n                </button>\n                <button\n                  style="\n                    padding: 8px 16px;\n                    background: #ff6b6b;\n                    border: none;\n                    border-radius: 6px;\n                    color: white;\n                    font-size: 12px;\n                    cursor: pointer;\n                    transition: all 0.2s;\n                  "\n                  @click="deleteWorldbookEntry(entry)"\n                >\n                  <i class="fa-solid fa-trash"></i> åˆ é™¤\n                </button>\n              </div>\n            </div>\n          </div>\n        </div>\n      </div>\n    </div>\n\n    \x3c!-- ä¸–ç•Œä¹¦æ¡ç›®ç¼–è¾‘å¯¹è¯æ¡† --\x3e\n    <div\n      v-if="showEditDialog"\n      style="\n        position: fixed;\n        top: 0;\n        left: 0;\n        right: 0;\n        bottom: 0;\n        background: rgba(0, 0, 0, 0.7);\n        display: flex;\n        align-items: center;\n        justify-content: center;\n        z-index: 10000;\n        backdrop-filter: blur(4px);\n      "\n      @click.self="showEditDialog = false"\n    >\n      <div\n        style="\n          background: #2a2a2a;\n          border: 1px solid rgba(255, 255, 255, 0.1);\n          border-radius: 12px;\n          padding: 25px;\n          max-width: 700px;\n          width: 90%;\n          max-height: 85vh;\n          overflow-y: auto;\n          box-shadow: 0 10px 40px rgba(0, 0, 0, 0.5);\n        "\n      >\n        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px">\n          <h3 style="margin: 0; color: #fff; font-size: 18px; font-weight: 600">\n            <i class="fa-solid fa-edit" style="margin-right: 8px; color: #4a9eff"></i>\n            ç¼–è¾‘ä¸–ç•Œä¹¦æ¡ç›®\n          </h3>\n          <button\n            style="\n              background: transparent;\n              border: none;\n              color: #888;\n              font-size: 20px;\n              cursor: pointer;\n              padding: 5px 10px;\n              transition: color 0.2s;\n            "\n            @click="showEditDialog = false"\n            @mouseenter="(e: any) => (e.target.style.color = \'#fff\')"\n            @mouseleave="(e: any) => (e.target.style.color = \'#888\')"\n          >\n            <i class="fa-solid fa-times"></i>\n          </button>\n        </div>\n\n        <div style="display: flex; flex-direction: column; gap: 15px">\n          \x3c!-- æ¡ç›®åç§° --\x3e\n          <div>\n            <label style="display: block; margin-bottom: 8px; color: #e0e0e0; font-size: 14px; font-weight: 500">\n              æ¡ç›®åç§°ï¼š\n            </label>\n            <input\n              v-model="editingEntry.name"\n              type="text"\n              style="\n                width: 100%;\n                padding: 12px;\n                background: #1a1a1a;\n                border: 1px solid rgba(255, 255, 255, 0.1);\n                border-radius: 8px;\n                color: #e0e0e0;\n                font-size: 14px;\n              "\n            />\n          </div>\n\n          \x3c!-- å¯ç”¨çŠ¶æ€ --\x3e\n          <div style="display: flex; align-items: center; gap: 10px">\n            <input\n              id="entry-enabled"\n              v-model="editingEntry.enabled"\n              type="checkbox"\n              style="width: 18px; height: 18px; cursor: pointer"\n            />\n            <label for="entry-enabled" style="color: #e0e0e0; font-size: 14px; cursor: pointer"> å¯ç”¨æ­¤æ¡ç›® </label>\n          </div>\n\n          \x3c!-- ä¸»è¦å…³é”®å­— --\x3e\n          <div>\n            <label style="display: block; margin-bottom: 8px; color: #e0e0e0; font-size: 14px; font-weight: 500">\n              ä¸»è¦å…³é”®å­—ï¼š\n            </label>\n            <input\n              :value="\n                (editingEntry.strategy?.keys || []).map((k: any) => (typeof k === \'string\' ? k : String(k))).join(\',\')\n              "\n              type="text"\n              placeholder="ç”¨é€—å·åˆ†éš”ï¼Œå¦‚ï¼šè‰¾è‰å¨…,Aria,ç²¾çµ,{{char}}"\n              style="\n                width: 100%;\n                padding: 12px;\n                background: #1a1a1a;\n                border: 1px solid rgba(255, 255, 255, 0.1);\n                border-radius: 8px;\n                color: #e0e0e0;\n                font-size: 14px;\n              "\n              @input="\n                (e: any) => {\n                  const keys = e.target.value\n                    .split(\',\')\n                    .filter((k: string) => k.trim())\n                    .map((k: string) => k.trim());\n                  editingEntry.strategy = {\n                    ...editingEntry.strategy,\n                    keys: keys,\n                    keys_secondary: editingEntry.strategy?.keys_secondary || { logic: \'and_any\', keys: [] },\n                    scan_depth: editingEntry.strategy?.scan_depth || \'same_as_global\',\n                    type: editingEntry.strategy?.type || \'selective\',\n                  };\n                }\n              "\n            />\n          </div>\n\n          \x3c!-- è§¦å‘ç±»å‹ --\x3e\n          <div>\n            <label style="display: block; margin-bottom: 8px; color: #e0e0e0; font-size: 14px; font-weight: 500">\n              è§¦å‘ç±»å‹ï¼š\n            </label>\n            <select\n              :value="editingEntry.strategy?.type || \'selective\'"\n              style="\n                width: 100%;\n                padding: 12px;\n                background: #1a1a1a;\n                border: 1px solid rgba(255, 255, 255, 0.1);\n                border-radius: 8px;\n                color: #e0e0e0;\n                font-size: 14px;\n                cursor: pointer;\n              "\n              @change="\n                (e: any) =>\n                  (editingEntry.strategy = {\n                    ...editingEntry.strategy,\n                    type: e.target.value,\n                    keys: editingEntry.strategy?.keys || [],\n                    keys_secondary: editingEntry.strategy?.keys_secondary || { logic: \'and_any\', keys: [] },\n                    scan_depth: editingEntry.strategy?.scan_depth || \'same_as_global\',\n                  })\n              "\n            >\n              <option value="selective">ç»¿ç¯ (å¯é€‰é¡¹)</option>\n              <option value="constant">è“ç¯ (å¸¸é‡)</option>\n            </select>\n          </div>\n\n          \x3c!-- æ’å…¥ä½ç½® --\x3e\n          <div>\n            <label style="display: block; margin-bottom: 8px; color: #e0e0e0; font-size: 14px; font-weight: 500">\n              æ’å…¥ä½ç½®ï¼š\n            </label>\n            <select\n              :value="editingEntry.position?.type || \'before_character_definition\'"\n              style="\n                width: 100%;\n                padding: 12px;\n                background: #1a1a1a;\n                border: 1px solid rgba(255, 255, 255, 0.1);\n                border-radius: 8px;\n                color: #e0e0e0;\n                font-size: 14px;\n                cursor: pointer;\n              "\n              @change="\n                (e: any) =>\n                  (editingEntry.position = {\n                    ...editingEntry.position,\n                    type: e.target.value,\n                    role: editingEntry.position?.role || \'system\',\n                    depth: editingEntry.position?.depth || 0,\n                    order: editingEntry.position?.order || 0,\n                  })\n              "\n            >\n              <option value="before_character_definition">è§’è‰²å®šä¹‰ä¹‹å‰</option>\n              <option value="after_character_definition">è§’è‰²å®šä¹‰ä¹‹å</option>\n              <option value="before_example_messages">ç¤ºä¾‹æ¶ˆæ¯ä¹‹å‰</option>\n              <option value="after_example_messages">ç¤ºä¾‹æ¶ˆæ¯ä¹‹å</option>\n              <option value="before_author_note">ä½œè€…æ³¨é‡Šä¹‹å‰</option>\n              <option value="after_author_note">ä½œè€…æ³¨é‡Šä¹‹å</option>\n              <option value="at_depth">æ’å…¥åˆ°æŒ‡å®šæ·±åº¦</option>\n            </select>\n          </div>\n\n          \x3c!-- æ·±åº¦å’Œé¡ºåº --\x3e\n          <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px">\n            <div>\n              <label style="display: block; margin-bottom: 8px; color: #e0e0e0; font-size: 14px; font-weight: 500">\n                æ·±åº¦ï¼š\n              </label>\n              <input\n                :value="editingEntry.position?.depth || 0"\n                type="number"\n                style="\n                  width: 100%;\n                  padding: 12px;\n                  background: #1a1a1a;\n                  border: 1px solid rgba(255, 255, 255, 0.1);\n                  border-radius: 8px;\n                  color: #e0e0e0;\n                  font-size: 14px;\n                "\n                @input="\n                  (e: any) =>\n                    (editingEntry.position = {\n                      ...editingEntry.position,\n                      depth: Number(e.target.value) || 0,\n                      role: editingEntry.position?.role || \'system\',\n                      order: editingEntry.position?.order || 0,\n                      type: editingEntry.position?.type || \'before_character_definition\',\n                    })\n                "\n              />\n            </div>\n            <div>\n              <label style="display: block; margin-bottom: 8px; color: #e0e0e0; font-size: 14px; font-weight: 500">\n                é¡ºåºï¼š\n              </label>\n              <input\n                :value="editingEntry.position?.order || 0"\n                type="number"\n                style="\n                  width: 100%;\n                  padding: 12px;\n                  background: #1a1a1a;\n                  border: 1px solid rgba(255, 255, 255, 0.1);\n                  border-radius: 8px;\n                  color: #e0e0e0;\n                  font-size: 14px;\n                "\n                @input="\n                  (e: any) =>\n                    (editingEntry.position = {\n                      ...editingEntry.position,\n                      order: Number(e.target.value) || 0,\n                      type: editingEntry.position?.type || \'before_character_definition\',\n                      role: editingEntry.position?.role || \'system\',\n                      depth: editingEntry.position?.depth || 0,\n                    })\n                "\n              />\n            </div>\n          </div>\n\n          \x3c!-- é€’å½’è®¾ç½® --\x3e\n          <div\n            style="background: #1a1a1a; padding: 15px; border-radius: 8px; border: 1px solid rgba(255, 255, 255, 0.1)"\n          >\n            <label style="display: block; margin-bottom: 12px; color: #e0e0e0; font-size: 14px; font-weight: 600">\n              é€’å½’è®¾ç½®ï¼š\n            </label>\n            <div style="display: flex; flex-direction: column; gap: 10px">\n              <label\n                style="color: #ccc; font-size: 13px; display: flex; align-items: center; gap: 10px; cursor: pointer"\n              >\n                <input\n                  type="checkbox"\n                  :checked="editingEntry.recursion?.prevent_incoming || false"\n                  @change="\n                    (e: any) =>\n                      (editingEntry.recursion = {\n                        ...editingEntry.recursion,\n                        prevent_incoming: e.target.checked,\n                        prevent_outgoing: editingEntry.recursion?.prevent_outgoing || false,\n                        delay_until: editingEntry.recursion?.delay_until || null,\n                      })\n                  "\n                />\n                ç¦æ­¢å…¶ä»–æ¡ç›®é€’å½’æ¿€æ´»æœ¬æ¡ç›®\n              </label>\n              <label\n                style="color: #ccc; font-size: 13px; display: flex; align-items: center; gap: 10px; cursor: pointer"\n              >\n                <input\n                  type="checkbox"\n                  :checked="editingEntry.recursion?.prevent_outgoing || false"\n                  @change="\n                    (e: any) =>\n                      (editingEntry.recursion = {\n                        ...editingEntry.recursion,\n                        prevent_outgoing: e.target.checked,\n                        prevent_incoming: editingEntry.recursion?.prevent_incoming || false,\n                        delay_until: editingEntry.recursion?.delay_until || null,\n                      })\n                  "\n                />\n                ç¦æ­¢æœ¬æ¡ç›®é€’å½’æ¿€æ´»å…¶ä»–æ¡ç›®\n              </label>\n              <div>\n                <label style="color: #ccc; font-size: 13px; display: block; margin-bottom: 5px">\n                  å»¶è¿Ÿåˆ°ç¬¬ n çº§é€’å½’ï¼š\n                </label>\n                <input\n                  :value="editingEntry.recursion?.delay_until || \'\'"\n                  type="number"\n                  placeholder="ç•™ç©ºè¡¨ç¤ºä¸å»¶è¿Ÿ"\n                  style="\n                    width: 100%;\n                    padding: 8px;\n                    background: #2a2a2a;\n                    border: 1px solid rgba(255, 255, 255, 0.1);\n                    border-radius: 6px;\n                    color: #e0e0e0;\n                    font-size: 13px;\n                  "\n                  @input="\n                    (e: any) =>\n                      (editingEntry.recursion = {\n                        ...editingEntry.recursion,\n                        delay_until: e.target.value === \'\' ? null : Number(e.target.value),\n                        prevent_incoming: editingEntry.recursion?.prevent_incoming || false,\n                        prevent_outgoing: editingEntry.recursion?.prevent_outgoing || false,\n                      })\n                  "\n                />\n              </div>\n            </div>\n          </div>\n\n          \x3c!-- æ¡ç›®å†…å®¹ --\x3e\n          <div>\n            <label style="display: block; margin-bottom: 8px; color: #e0e0e0; font-size: 14px; font-weight: 500">\n              æ¡ç›®å†…å®¹ï¼š\n            </label>\n            <textarea\n              v-model="editingEntry.content"\n              style="\n                width: 100%;\n                min-height: 200px;\n                padding: 12px;\n                background: #1a1a1a;\n                border: 1px solid rgba(255, 255, 255, 0.1);\n                border-radius: 8px;\n                color: #e0e0e0;\n                font-size: 14px;\n                resize: vertical;\n                font-family: inherit;\n              "\n            ></textarea>\n          </div>\n        </div>\n\n        \x3c!-- å¯¹è¯æ¡†æŒ‰é’® --\x3e\n        <div style="display: flex; gap: 10px; margin-top: 20px; justify-content: flex-end">\n          <button\n            style="\n              padding: 10px 20px;\n              background: #444;\n              border: none;\n              border-radius: 8px;\n              color: white;\n              font-size: 14px;\n              cursor: pointer;\n              transition: all 0.2s;\n            "\n            @click="showEditDialog = false"\n            @mouseenter="(e: any) => (e.target.style.background = \'#555\')"\n            @mouseleave="(e: any) => (e.target.style.background = \'#444\')"\n          >\n            å–æ¶ˆ\n          </button>\n          <button\n            style="\n              padding: 10px 20px;\n              background: #4a9eff;\n              border: none;\n              border-radius: 8px;\n              color: white;\n              font-size: 14px;\n              font-weight: 600;\n              cursor: pointer;\n              transition: all 0.2s;\n            "\n            @click="saveEditedEntry"\n            @mouseenter="(e: any) => (e.target.style.background = \'#5ba8ff\')"\n            @mouseleave="(e: any) => (e.target.style.background = \'#4a9eff\')"\n          >\n            <i class="fa-solid fa-save" style="margin-right: 6px"></i>\n            ä¿å­˜\n          </button>\n        </div>\n      </div>\n    </div>\n\n    \x3c!-- è§’è‰²å¡ç”Ÿæˆå·¥å…· --\x3e\n    <div class="tool-section">\n      <div\n        class="section-header"\n        style="\n          display: flex;\n          justify-content: space-between;\n          align-items: center;\n          padding: 15px 20px;\n          background: linear-gradient(\n            135deg,\n            rgba(30, 30, 30, 0.95) 0%,\n            rgba(38, 38, 38, 0.9) 50%,\n            rgba(30, 30, 30, 0.95) 100%\n          );\n          backdrop-filter: blur(12px);\n          border-radius: 12px;\n          margin-bottom: 15px;\n          border: 1px solid rgba(255, 255, 255, 0.06);\n          box-shadow:\n            0 3px 12px rgba(0, 0, 0, 0.3),\n            inset 0 1px 0 rgba(255, 255, 255, 0.04),\n            inset 0 -1px 0 rgba(0, 0, 0, 0.2);\n          cursor: pointer;\n          transition: all 0.3s ease;\n        "\n        @click="toggleToolExpanded(\'characterCard\')"\n        @mouseenter="(e: any) => (e.currentTarget.style.transform = \'translateY(-1px)\')"\n        @mouseleave="(e: any) => (e.currentTarget.style.transform = \'translateY(0)\')"\n      >\n        <h4\n          style="\n            margin: 0;\n            color: #fff;\n            font-size: 16px;\n            font-weight: 600;\n            display: flex;\n            align-items: center;\n            gap: 10px;\n          "\n        >\n          <i class="fa-solid fa-user-plus" style="color: #17a2b8; font-size: 18px"></i>\n          è§’è‰²å¡ç”Ÿæˆå·¥å…·\n        </h4>\n        <i\n          :class="isToolExpanded(\'characterCard\') ? \'fa-solid fa-chevron-up\' : \'fa-solid fa-chevron-down\'"\n          style="color: #ccc; transition: transform 0.3s ease; font-size: 14px"\n        ></i>\n      </div>\n\n      <div v-if="isToolExpanded(\'characterCard\')" class="tool-content">\n        <div class="tool-instructions">\n          <p style="margin: 0 0 8px 0; color: #ccc; font-size: 12px">\n            <i class="fa-solid fa-info-circle" style="margin-right: 6px; color: #17a2b8"></i>\n            è¾“å…¥è§’è‰²æè¿°ï¼ŒAIå°†è‡ªåŠ¨ç”Ÿæˆè§’è‰²å¡ï¼ˆYAML æ ¼å¼ï¼Œçº¯ä¸­æ–‡ï¼‰ã€‚\n          </p>\n          <p\n            style="\n              margin: 0 0 6px 0;\n              color: #4a9eff;\n              font-size: 11px;\n              background: #1a1a1a;\n              padding: 6px;\n              border-radius: 4px;\n              border-left: 3px solid #17a2b8;\n            "\n          >\n            ğŸ’¡ åŒ…å«å†…å®¹ï¼šåŸºç¡€ä¿¡æ¯ã€å¤–è²Œèº«æã€æ ¸å¿ƒæ€§æ ¼ã€å¯¹è¯é£æ ¼ã€èƒŒæ™¯ç»å†ã€äººé™…å…³ç³»ã€æ¼”ç»æŒ‡å¯¼\n          </p>\n          <p\n            style="\n              margin: 0 0 6px 0;\n              color: #ffa500;\n              font-size: 11px;\n              background: #1a1a1a;\n              padding: 6px;\n              border-radius: 4px;\n              border-left: 3px solid #ffa500;\n            "\n          >\n            âš ï¸ æ³¨æ„ï¼šèº«é«˜ä½“é‡ä½¿ç”¨æ–‡å­—æè¿°ï¼ˆå¦‚"é«˜å¤§åŒ€ç§°"ï¼‰ï¼Œé¿å…AIåˆ»æ¿åŒ–ï¼Œæœ‰æ€§æ ¼å¯¹ç«‹é¢å’Œä¿®å¤æœºåˆ¶\n          </p>\n        </div>\n\n        <div class="form-group" style="margin: 15px 0">\n          <label style="display: block; margin-bottom: 8px; color: #ccc; font-size: 13px; font-weight: 500">\n            è§’è‰²æè¿°ï¼š\n          </label>\n          <textarea\n            v-model="characterDescription"\n            placeholder="è¯·æè¿°è§’è‰²çš„åŸºæœ¬ä¿¡æ¯ï¼Œå¦‚å¤–è§‚ã€æ€§æ ¼ã€èƒŒæ™¯ç­‰..."\n            style="\n              width: 100%;\n              height: 120px;\n              padding: 12px;\n              background: #2a2a2a;\n              border: 1px solid #3a3a3a;\n              border-radius: 6px;\n              color: #e0e0e0;\n              font-size: 13px;\n              resize: vertical;\n              font-family: inherit;\n            "\n          ></textarea>\n        </div>\n\n        \x3c!-- æµå¼ä¼ è¾“å¼€å…³ --\x3e\n        <div class="form-group" style="margin: 15px 0">\n          <label style="display: flex; align-items: center; gap: 8px; color: #ccc; font-size: 13px; cursor: pointer">\n            <input v-model="enableCharacterStreaming" type="checkbox" style="cursor: pointer" />\n            å¯ç”¨æµå¼ä¼ è¾“ï¼ˆå¯æŸ¥çœ‹ç”Ÿæˆè¿›åº¦ï¼‰\n          </label>\n        </div>\n\n        \x3c!-- è¿›åº¦æ¡ --\x3e\n        <div\n          v-if="isGeneratingCharacter && characterProgressPercent > 0"\n          class="progress-bar-container"\n          style="margin: 15px 0"\n        >\n          <div\n            class="progress-bar"\n            style="\n              width: 100%;\n              height: 8px;\n              background: #2a2a2a;\n              border-radius: 4px;\n              overflow: hidden;\n              position: relative;\n            "\n          >\n            <div\n              class="progress-fill"\n              :style="{\n                width: characterProgressPercent + \'%\',\n                height: \'100%\',\n                background: \'linear-gradient(90deg, #17a2b8 0%, #138496 50%, #17a2b8 100%)\',\n                backgroundSize: \'200% 100%\',\n                animation: enableCharacterStreaming ? \'progress-slide 2s linear infinite\' : \'none\',\n                transition: \'width 0.3s ease\',\n              }"\n            ></div>\n          </div>\n          <div style="text-align: center; margin-top: 8px; color: #17a2b8; font-size: 12px; font-weight: 500">\n            ç”Ÿæˆä¸­... {{ characterProgressPercent.toFixed(0) }}%\n          </div>\n        </div>\n\n        <div class="button-group" style="display: flex; gap: 12px; margin-bottom: 20px">\n          <button\n            class="generate-button"\n            :disabled="isGeneratingCharacter || !characterDescription.trim()"\n            style="\n              padding: 12px 24px;\n              background: linear-gradient(135deg, #17a2b8 0%, #138496 100%);\n              border: none;\n              border-radius: 8px;\n              color: white;\n              font-size: 13px;\n              font-weight: 600;\n              cursor: pointer;\n              transition: all 0.3s ease;\n              box-shadow: 0 3px 12px rgba(23, 162, 184, 0.3);\n              position: relative;\n              overflow: hidden;\n            "\n            @click="handleGenerateCharacterCard"\n          >\n            <div\n              style="\n                position: absolute;\n                top: 0;\n                left: -100%;\n                width: 100%;\n                height: 100%;\n                background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);\n                transition: left 0.5s;\n              "\n              class="shimmer-effect"\n            ></div>\n            <i class="fa-solid fa-magic" style="font-size: 14px; margin-right: 6px"></i>\n            {{ isGeneratingCharacter ? \'ç”Ÿæˆä¸­...\' : \'ç”Ÿæˆè§’è‰²å¡\' }}\n          </button>\n\n          <button\n            class="clear-button"\n            style="\n              padding: 12px 24px;\n              background: linear-gradient(135deg, #ff6b6b 0%, #ee5a24 100%);\n              border: none;\n              border-radius: 8px;\n              color: white;\n              font-size: 13px;\n              font-weight: 600;\n              cursor: pointer;\n              transition: all 0.3s ease;\n              box-shadow: 0 3px 12px rgba(255, 107, 107, 0.3);\n              position: relative;\n              overflow: hidden;\n            "\n            @click="clearCharacterForm"\n          >\n            <div\n              style="\n                position: absolute;\n                top: 0;\n                left: -100%;\n                width: 100%;\n                height: 100%;\n                background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);\n                transition: left 0.5s;\n              "\n              class="shimmer-effect"\n            ></div>\n            <i class="fa-solid fa-trash" style="font-size: 14px; margin-right: 6px"></i>\n            æ¸…ç©º\n          </button>\n        </div>\n\n        \x3c!-- è¾“å‡ºåŒºåŸŸ --\x3e\n        <div v-if="characterCardOutput" class="output-section">\n          <h5 style="margin: 0 0 12px 0; color: #fff; font-size: 14px; font-weight: 600">\n            <i class="fa-solid fa-check-circle" style="margin-right: 6px; color: #28a745"></i>\n            ç”Ÿæˆçš„è§’è‰²å¡ï¼š\n          </h5>\n          <div\n            class="output-content"\n            style="\n              background: #1e1e1e;\n              border: 1px solid #3a3a3a;\n              border-radius: 6px;\n              padding: 15px;\n              color: #e0e0e0;\n              font-size: 13px;\n              line-height: 1.6;\n              white-space: pre-wrap;\n              word-wrap: break-word;\n              max-height: 300px;\n              overflow-y: auto;\n            "\n          >\n            {{ characterCardOutput }}\n          </div>\n\n          <div class="output-actions" style="margin-top: 12px; display: flex; gap: 12px">\n            <button\n              class="copy-button"\n              style="\n                padding: 10px 20px;\n                background: linear-gradient(135deg, #28a745 0%, #20c997 100%);\n                border: none;\n                border-radius: 6px;\n                color: white;\n                font-size: 13px;\n                font-weight: 600;\n                cursor: pointer;\n                transition: all 0.3s ease;\n                display: flex;\n                align-items: center;\n                gap: 8px;\n                box-shadow: 0 3px 12px rgba(40, 167, 69, 0.3);\n                position: relative;\n                overflow: hidden;\n              "\n              @click="copyCharacterCard"\n            >\n              <div\n                style="\n                  position: absolute;\n                  top: 0;\n                  left: -100%;\n                  width: 100%;\n                  height: 100%;\n                  background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);\n                  transition: left 0.5s;\n                "\n                class="shimmer-effect"\n              ></div>\n              <i class="fa-solid fa-copy" style="font-size: 14px"></i> å¤åˆ¶è§’è‰²å¡\n            </button>\n          </div>\n\n          \x3c!-- è§’è‰²å¡ä¿®æ”¹åŒºåŸŸ --\x3e\n          <div class="modify-section" style="margin-top: 25px; border-top: 2px dashed #3a3a3a; padding-top: 20px">\n            <h5 style="margin: 0 0 12px 0; color: #fff; font-size: 14px; font-weight: 600">\n              <i class="fa-solid fa-edit" style="margin-right: 6px; color: #ffa500"></i>\n              ä¿®æ”¹è§’è‰²å¡\n            </h5>\n            <div\n              class="modify-instructions"\n              style="\n                background: #1a1a1a;\n                border: 1px solid #3a3a3a;\n                border-radius: 6px;\n                padding: 10px;\n                margin-bottom: 15px;\n              "\n            >\n              <p style="margin: 0 0 6px 0; color: #ccc; font-size: 12px">\n                <i class="fa-solid fa-lightbulb" style="margin-right: 6px; color: #ffa500"></i>\n                æè¿°ä½ æƒ³è¦ä¿®æ”¹çš„å†…å®¹ï¼ŒAIä¼šæ ¹æ®ä½ çš„éœ€æ±‚è°ƒæ•´è§’è‰²å¡ã€‚ä¾‹å¦‚ï¼š"è®©è§’è‰²æ›´æ´»æ³¼ä¸€äº›"ã€"å¢åŠ é­”æ³•æŠ€èƒ½"ã€"æ”¹ä¸ºå¥³æ€§è§’è‰²"ç­‰ã€‚\n              </p>\n              <p style="margin: 0; color: #ffa500; font-size: 11px">âš ï¸ ä¿®æ”¹åä¼šä¿æŒ YAML æ ¼å¼å’Œä¸­æ–‡å­—æ®µã€‚</p>\n            </div>\n\n            <div class="form-group" style="margin: 15px 0">\n              <label style="display: block; margin-bottom: 8px; color: #ccc; font-size: 13px; font-weight: 500">\n                ä¿®æ”¹éœ€æ±‚ï¼š\n              </label>\n              <textarea\n                v-model="modifyRequest"\n                placeholder="è¯·æè¿°ä½ æƒ³è¦ä¿®æ”¹çš„å†…å®¹..."\n                style="\n                  width: 100%;\n                  height: 80px;\n                  padding: 12px;\n                  background: #2a2a2a;\n                  border: 1px solid #3a3a3a;\n                  border-radius: 6px;\n                  color: #e0e0e0;\n                  font-size: 13px;\n                  resize: vertical;\n                  font-family: inherit;\n                "\n              ></textarea>\n            </div>\n\n            \x3c!-- ä¿®æ”¹è¿›åº¦æ¡ --\x3e\n            <div\n              v-if="isModifyingCharacter && characterProgressPercent > 0"\n              class="progress-bar-container"\n              style="margin: 15px 0"\n            >\n              <div\n                class="progress-bar"\n                style="\n                  width: 100%;\n                  height: 8px;\n                  background: #2a2a2a;\n                  border-radius: 4px;\n                  overflow: hidden;\n                  position: relative;\n                "\n              >\n                <div\n                  class="progress-fill"\n                  :style="{\n                    width: characterProgressPercent + \'%\',\n                    height: \'100%\',\n                    background: \'linear-gradient(90deg, #17a2b8 0%, #138496 50%, #17a2b8 100%)\',\n                    backgroundSize: \'200% 100%\',\n                    animation: enableCharacterStreaming ? \'progress-slide 2s linear infinite\' : \'none\',\n                    transition: \'width 0.3s ease\',\n                  }"\n                ></div>\n              </div>\n              <div style="text-align: center; margin-top: 8px; color: #17a2b8; font-size: 12px; font-weight: 500">\n                ä¿®æ”¹ä¸­... {{ characterProgressPercent.toFixed(0) }}%\n              </div>\n            </div>\n\n            <div class="button-group" style="display: flex; gap: 12px; margin-bottom: 15px">\n              <button\n                class="modify-button"\n                :disabled="isModifyingCharacter || !modifyRequest.trim()"\n                style="\n                  padding: 12px 24px;\n                  background: linear-gradient(135deg, #ffa500 0%, #ff8c00 100%);\n                  border: none;\n                  border-radius: 8px;\n                  color: white;\n                  font-size: 13px;\n                  font-weight: 600;\n                  cursor: pointer;\n                  transition: all 0.3s ease;\n                  box-shadow: 0 3px 12px rgba(255, 165, 0, 0.3);\n                  position: relative;\n                  overflow: hidden;\n                "\n                @click="handleModifyCharacterCard"\n              >\n                <div\n                  style="\n                    position: absolute;\n                    top: 0;\n                    left: -100%;\n                    width: 100%;\n                    height: 100%;\n                    background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);\n                    transition: left 0.5s;\n                  "\n                  class="shimmer-effect"\n                ></div>\n                <i class="fa-solid fa-wand-magic-sparkles" style="font-size: 14px; margin-right: 6px"></i>\n                {{ isModifyingCharacter ? \'ä¿®æ”¹ä¸­...\' : \'AIä¿®æ”¹\' }}\n              </button>\n\n              <button\n                class="clear-modify-button"\n                style="\n                  padding: 12px 24px;\n                  background: linear-gradient(135deg, #6c757d 0%, #5a6268 100%);\n                  border: none;\n                  border-radius: 8px;\n                  color: white;\n                  font-size: 13px;\n                  font-weight: 600;\n                  cursor: pointer;\n                  transition: all 0.3s ease;\n                  box-shadow: 0 3px 12px rgba(108, 117, 125, 0.3);\n                  position: relative;\n                  overflow: hidden;\n                "\n                @click="clearModifyRequest"\n              >\n                <div\n                  style="\n                    position: absolute;\n                    top: 0;\n                    left: -100%;\n                    width: 100%;\n                    height: 100%;\n                    background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);\n                    transition: left 0.5s;\n                  "\n                  class="shimmer-effect"\n                ></div>\n                <i class="fa-solid fa-eraser" style="font-size: 14px; margin-right: 6px"></i>\n                æ¸…ç©ºä¿®æ”¹éœ€æ±‚\n              </button>\n            </div>\n          </div>\n        </div>\n      </div>\n    </div>\n  </div>\n</template>\n\n<script setup lang="ts">\nimport { debounce } from \'lodash\';\nimport { storeToRefs } from \'pinia\';\nimport { onBeforeUnmount, onMounted, ref, Ref, watch } from \'vue\';\nimport { normalizeApiEndpoint, useSettingsStore } from \'../settings\';\nimport { copyToClipboard, getScriptIdSafe } from \'../utils\';\n\nconst settingsStore = useSettingsStore();\nconst { settings } = storeToRefs(settingsStore);\n\n// å“åº”å¼æ•°æ®\nconst toolExpandedState = ref(new Map<string, boolean>());\nconst antiClicheInput = ref(\'\');\nconst antiClicheOutput = ref(\'\');\nconst isProcessingAntiCliche = ref(false);\nconst enableAntiClicheStreaming = ref(false); // åå…«è‚¡æ˜¯å¦å¯ç”¨æµå¼ä¼ è¾“\nconst antiClicheProgressPercent = ref(0); // åå…«è‚¡å¤„ç†è¿›åº¦\nconst antiClicheModifyRequest = ref(\'\'); // åå…«è‚¡ä¿®æ”¹éœ€æ±‚\nconst isModifyingAntiCliche = ref(false); // æ˜¯å¦æ­£åœ¨ä¿®æ”¹\nconst characterDescription = ref(\'\');\nconst characterCardOutput = ref(\'\');\nconst isGeneratingCharacter = ref(false);\nconst modifyRequest = ref(\'\');\nconst isModifyingCharacter = ref(false);\nconst enableCharacterStreaming = ref(false); // è§’è‰²å¡ç”Ÿæˆæ˜¯å¦å¯ç”¨æµå¼ä¼ è¾“\nconst characterProgressPercent = ref(0); // è§’è‰²å¡ç”Ÿæˆè¿›åº¦\n\n// ä¸–ç•Œä¹¦æ¡ç›®ç”Ÿæˆå·¥å…·ç›¸å…³\nconst worldbookDescription = ref(\'\');\nconst worldbookEntryOutput = ref<Partial<WorldbookEntry> | null>(null);\nconst isGeneratingWorldbook = ref(false);\nconst availableWorldbooks = ref<string[]>([]);\nconst selectedWorldbook = ref(\'\');\nconst isInsertingEntry = ref(false);\nconst worldbookModifyRequest = ref(\'\');\nconst isModifyingWorldbook = ref(false);\nconst enableWorldbookStreaming = ref(false); // ä¸–ç•Œä¹¦æ¡ç›®ç”Ÿæˆæ˜¯å¦å¯ç”¨æµå¼ä¼ è¾“\nconst worldbookProgressPercent = ref(0); // ä¸–ç•Œä¹¦æ¡ç›®ç”Ÿæˆè¿›åº¦\n\n// ä¸–ç•Œä¹¦æŸ¥çœ‹å™¨ç›¸å…³\nconst selectedViewerWorldbook = ref(\'\');\nconst worldbookEntries = ref<WorldbookEntry[]>([]);\nconst viewerSearchQuery = ref(\'\');\nconst viewerSortBy = ref<\'original\' | \'enabled\' | \'disabled\'>(\'original\');\nconst entryExpandedState = ref(new Map<number, boolean>());\n\n// ç¼–è¾‘å¯¹è¯æ¡†ç›¸å…³\nconst showEditDialog = ref(false);\nconst editingEntry = ref<Partial<WorldbookEntry>>({});\nconst editingEntryUid = ref<number | null>(null);\n\n// æ ‡å¿—ä½ï¼šæ˜¯å¦å·²å®Œæˆåˆå§‹åŠ è½½ï¼ˆé¿å…åŠ è½½æ—¶è§¦å‘ä¿å­˜ï¼‰\nconst isDataLoaded = ref(false);\n\n// åŠ è½½å¯ç”¨çš„ä¸–ç•Œä¹¦åˆ—è¡¨\nconst loadAvailableWorldbooks = () => {\n  try {\n    availableWorldbooks.value = getWorldbookNames();\n    console.log(\'âœ… å·²åŠ è½½ä¸–ç•Œä¹¦åˆ—è¡¨:\', availableWorldbooks.value);\n  } catch (error) {\n    console.error(\'âŒ åŠ è½½ä¸–ç•Œä¹¦åˆ—è¡¨å¤±è´¥:\', error);\n    window.toastr.error(\'åŠ è½½ä¸–ç•Œä¹¦åˆ—è¡¨å¤±è´¥ï¼š\' + (error as Error).message);\n  }\n};\n\n// ä»é…’é¦†å˜é‡åŠ è½½å·¥å…·æ•°æ®\nconst loadToolsData = () => {\n  try {\n    isDataLoaded.value = false; // åŠ è½½æœŸé—´æš‚åœè‡ªåŠ¨ä¿å­˜\n    const script_id = getScriptIdSafe();\n    if (!script_id) {\n      console.warn(\'âš ï¸ script_id ä¸ºç©ºï¼Œæ— æ³•åŠ è½½æ•°æ®\');\n      isDataLoaded.value = true;\n      return;\n    }\n    const savedData = getVariables({ type: \'script\', script_id });\n\n    console.log(\'ğŸ“¥ åŠ è½½å·¥å…·æ•°æ®:\', savedData);\n\n    // åŠ è½½åå…«è‚¡æ•°æ®\n    if (savedData.tools_antiCliche) {\n      antiClicheInput.value = savedData.tools_antiCliche.input || \'\';\n      antiClicheOutput.value = savedData.tools_antiCliche.output || \'\';\n      enableAntiClicheStreaming.value = savedData.tools_antiCliche.enableStreaming || false;\n      antiClicheModifyRequest.value = savedData.tools_antiCliche.modifyRequest || \'\';\n      console.log(\'âœ… å·²æ¢å¤åå…«è‚¡æ•°æ®:\', {\n        input: antiClicheInput.value.substring(0, 50),\n        output: antiClicheOutput.value.substring(0, 50),\n        enableStreaming: enableAntiClicheStreaming.value,\n        modifyRequest: antiClicheModifyRequest.value.substring(0, 30),\n      });\n    }\n\n    // åŠ è½½è§’è‰²å¡æ•°æ®\n    if (savedData.tools_characterCard) {\n      characterDescription.value = savedData.tools_characterCard.description || \'\';\n      characterCardOutput.value = savedData.tools_characterCard.output || \'\';\n      modifyRequest.value = savedData.tools_characterCard.modifyRequest || \'\';\n      enableCharacterStreaming.value = savedData.tools_characterCard.enableStreaming || false;\n      console.log(\'âœ… å·²æ¢å¤è§’è‰²å¡æ•°æ®:\', {\n        description: characterDescription.value.substring(0, 50),\n        output: characterCardOutput.value.substring(0, 50),\n        modifyRequest: modifyRequest.value.substring(0, 50),\n        enableStreaming: enableCharacterStreaming.value,\n      });\n    }\n\n    // åŠ è½½ä¸–ç•Œä¹¦æ¡ç›®æ•°æ®\n    if (savedData.tools_worldbookEntry) {\n      worldbookDescription.value = savedData.tools_worldbookEntry.description || \'\';\n      worldbookEntryOutput.value = savedData.tools_worldbookEntry.output || null;\n      selectedWorldbook.value = savedData.tools_worldbookEntry.selectedWorldbook || \'\';\n      worldbookModifyRequest.value = savedData.tools_worldbookEntry.modifyRequest || \'\';\n      enableWorldbookStreaming.value = savedData.tools_worldbookEntry.enableStreaming || false;\n      console.log(\'âœ… å·²æ¢å¤ä¸–ç•Œä¹¦æ¡ç›®æ•°æ®:\', {\n        description: worldbookDescription.value.substring(0, 50),\n        output: worldbookEntryOutput.value ? \'æœ‰è¾“å‡º\' : \'æ— è¾“å‡º\',\n        selectedWorldbook: selectedWorldbook.value,\n        modifyRequest: worldbookModifyRequest.value.substring(0, 50),\n        enableStreaming: enableWorldbookStreaming.value,\n      });\n    }\n\n    // åŠ è½½å±•å¼€çŠ¶æ€\n    if (savedData.tools_expandedState) {\n      toolExpandedState.value = new Map(Object.entries(savedData.tools_expandedState));\n      console.log(\'âœ… å·²æ¢å¤å±•å¼€çŠ¶æ€:\', Object.fromEntries(toolExpandedState.value));\n    }\n\n    // åŠ è½½ä¸–ç•Œä¹¦æŸ¥çœ‹å™¨æ•°æ®\n    if (savedData.tools_worldbookViewer) {\n      selectedViewerWorldbook.value = savedData.tools_worldbookViewer.selectedWorldbook || \'\';\n      viewerSearchQuery.value = savedData.tools_worldbookViewer.searchQuery || \'\';\n      viewerSortBy.value = savedData.tools_worldbookViewer.sortBy || \'original\';\n      console.log(\'âœ… å·²æ¢å¤ä¸–ç•Œä¹¦æŸ¥çœ‹å™¨æ•°æ®:\', {\n        selectedWorldbook: selectedViewerWorldbook.value,\n        searchQuery: viewerSearchQuery.value,\n        sortBy: viewerSortBy.value,\n      });\n\n      // å¦‚æœå·²é€‰æ‹©ä¸–ç•Œä¹¦ï¼Œè‡ªåŠ¨åŠ è½½æ¡ç›®\n      if (selectedViewerWorldbook.value) {\n        console.log(\'ğŸ”„ è‡ªåŠ¨åŠ è½½å·²é€‰æ‹©çš„ä¸–ç•Œä¹¦æ¡ç›®...\');\n        setTimeout(() => {\n          loadWorldbookEntries();\n        }, 200);\n      }\n    }\n\n    // å»¶è¿Ÿå¯ç”¨è‡ªåŠ¨ä¿å­˜ï¼Œé¿å…åŠ è½½æ—¶è§¦å‘\n    setTimeout(() => {\n      isDataLoaded.value = true;\n      console.log(\'âœ… æ•°æ®åŠ è½½å®Œæˆï¼Œå¯ç”¨è‡ªåŠ¨ä¿å­˜\');\n    }, 100);\n  } catch (error) {\n    console.error(\'âŒ åŠ è½½å·¥å…·æ•°æ®å¤±è´¥:\', error);\n    isDataLoaded.value = true;\n  }\n};\n\n// ä¿å­˜å·¥å…·æ•°æ®åˆ°é…’é¦†å˜é‡\nconst saveToolsDataImmediate = () => {\n  // åªæœ‰åœ¨æ•°æ®åŠ è½½å®Œæˆåæ‰ä¿å­˜\n  if (!isDataLoaded.value) {\n    console.log(\'â¸ï¸ è·³è¿‡ä¿å­˜ï¼šæ•°æ®å°šæœªåŠ è½½å®Œæˆ\');\n    return;\n  }\n\n  try {\n    const script_id = getScriptIdSafe();\n    if (!script_id) {\n      console.warn(\'âš ï¸ script_id ä¸ºç©ºï¼Œæ— æ³•ä¿å­˜æ•°æ®\');\n      return;\n    }\n\n    const dataToSave = {\n      tools_antiCliche: {\n        input: antiClicheInput.value,\n        output: antiClicheOutput.value,\n        enableStreaming: enableAntiClicheStreaming.value,\n        modifyRequest: antiClicheModifyRequest.value,\n      },\n      tools_characterCard: {\n        description: characterDescription.value,\n        output: characterCardOutput.value,\n        modifyRequest: modifyRequest.value,\n        enableStreaming: enableCharacterStreaming.value,\n      },\n      tools_worldbookEntry: {\n        description: worldbookDescription.value,\n        output: worldbookEntryOutput.value,\n        selectedWorldbook: selectedWorldbook.value,\n        modifyRequest: worldbookModifyRequest.value,\n        enableStreaming: enableWorldbookStreaming.value,\n      },\n      tools_worldbookViewer: {\n        selectedWorldbook: selectedViewerWorldbook.value,\n        searchQuery: viewerSearchQuery.value,\n        sortBy: viewerSortBy.value,\n      },\n      tools_expandedState: Object.fromEntries(toolExpandedState.value),\n    };\n\n    insertOrAssignVariables(klona(dataToSave), { type: \'script\', script_id });\n    console.log(\'ğŸ’¾ å·¥å…·æ•°æ®å·²ä¿å­˜:\', {\n      antiCliche_input_length: antiClicheInput.value.length,\n      antiCliche_output_length: antiClicheOutput.value.length,\n      character_desc_length: characterDescription.value.length,\n      character_output_length: characterCardOutput.value.length,\n    });\n  } catch (error) {\n    console.error(\'âŒ ä¿å­˜å·¥å…·æ•°æ®å¤±è´¥:\', error);\n  }\n};\n\n// ä½¿ç”¨é˜²æŠ–æ¥é¿å…é¢‘ç¹ä¿å­˜ï¼ˆå‡å°‘åˆ°300msï¼Œæ›´å¿«å“åº”ï¼‰\nconst saveToolsData = debounce(saveToolsDataImmediate, 300);\n\n// ç›‘å¬æ•°æ®å˜åŒ–å¹¶è‡ªåŠ¨ä¿å­˜\nwatch(\n  [\n    antiClicheInput,\n    antiClicheOutput,\n    enableAntiClicheStreaming,\n    antiClicheModifyRequest,\n    characterDescription,\n    characterCardOutput,\n    modifyRequest,\n    enableCharacterStreaming,\n    worldbookDescription,\n    worldbookEntryOutput,\n    selectedWorldbook,\n    worldbookModifyRequest,\n    enableWorldbookStreaming,\n    selectedViewerWorldbook,\n    viewerSearchQuery,\n    viewerSortBy,\n    toolExpandedState,\n  ],\n  () => {\n    if (isDataLoaded.value) {\n      console.log(\'ğŸ“ æ•°æ®å˜åŒ–ï¼Œè§¦å‘ä¿å­˜...\');\n      saveToolsData();\n    }\n  },\n  { deep: true },\n);\n\n// ç»„ä»¶æŒ‚è½½æ—¶åŠ è½½æ•°æ®\nonMounted(() => {\n  console.log(\'ğŸ”§ ToolsTab ç»„ä»¶å·²æŒ‚è½½ï¼ŒåŠ è½½æ•°æ®...\');\n  loadToolsData();\n  loadAvailableWorldbooks();\n});\n\n// ç»„ä»¶å¸è½½å‰ä¿å­˜æ•°æ®\nonBeforeUnmount(() => {\n  console.log(\'ğŸ”„ ToolsTab ç»„ä»¶å³å°†å¸è½½ï¼Œä¿å­˜æ•°æ®...\');\n  // å–æ¶ˆé˜²æŠ–ï¼Œç«‹å³ä¿å­˜\n  saveToolsData.cancel();\n  saveToolsDataImmediate();\n});\n\n// åˆ‡æ¢å·¥å…·å±•å¼€çŠ¶æ€\nconst toggleToolExpanded = (toolName: string) => {\n  console.log(\'toggleToolExpanded è¢«è°ƒç”¨ï¼Œå·¥å…·åç§°:\', toolName);\n  const current = toolExpandedState.value.get(toolName) || false;\n  console.log(\'å½“å‰å±•å¼€çŠ¶æ€:\', current);\n  toolExpandedState.value.set(toolName, !current);\n  console.log(\'æ–°çš„å±•å¼€çŠ¶æ€:\', !current);\n};\n\n// æ£€æŸ¥å·¥å…·æ˜¯å¦å±•å¼€\nconst isToolExpanded = (toolName: string) => {\n  return toolExpandedState.value.get(toolName) || false;\n};\n\n// copyToClipboard å‡½æ•°å·²ä» utils.ts å¯¼å…¥\n\n// åå…«è‚¡å·¥å…·å¤„ç†å‡½æ•°\nconst handleAntiClicheProcess = async () => {\n  if (!antiClicheInput.value.trim()) {\n    window.toastr.warning(\'è¯·è¾“å…¥éœ€è¦æ¸…ç†çš„æ–‡æœ¬\');\n    return;\n  }\n\n  try {\n    isProcessingAntiCliche.value = true;\n    antiClicheProgressPercent.value = 0;\n    window.toastr.info(\'AIæ­£åœ¨åˆ†ææ–‡æœ¬...\', \'åå…«è‚¡æ¸…ç†\', { timeOut: 15000 });\n\n    const requestPayload = {\n      model: settings.value.model,\n      max_tokens: settings.value.max_tokens || 8000,\n      temperature: 0.7,\n      stream: enableAntiClicheStreaming.value,\n      messages: [\n        {\n          role: \'system\',\n          content: `ä½ æ˜¯ä¸€ä¸ªæ–‡æœ¬ç¼–è¾‘åŠ©æ‰‹ï¼Œè´Ÿè´£æ¸…ç†è§’è‰²å¡ã€ä¸–ç•Œä¹¦å’Œå¼€åœºç™½ä¸­çš„**æ˜æ˜¾å…«è‚¡è¡¨è¿°**ã€‚\n\n## ğŸ¯ æ ¸å¿ƒåŸåˆ™ï¼ˆæœ€é‡è¦ï¼ï¼‰\n\nâš ï¸ **ä¿æŒä¿¡æ¯å®Œæ•´åº¦ï¼šæ¸…ç†å…«è‚¡çš„åŒæ—¶ï¼Œå¿…é¡»ä¿ç•™åŸæ–‡çš„æ ¸å¿ƒä¿¡æ¯å’Œå†…å®¹é‡**\nâš ï¸ **é€‚åº¦æ¸…ç†ï¼šåªåˆ é™¤æœ€æ˜æ˜¾çš„å…«è‚¡ï¼Œä¸è¦è¿‡åº¦åˆ å‡**\nâš ï¸ **ä¿æŒé•¿åº¦ï¼šè¾“å‡ºé•¿åº¦åº”è¯¥æ¥è¿‘è¾“å…¥é•¿åº¦ï¼Œä¸è¦å¤§å¹…ç¼©çŸ­**\nâš ï¸ **åˆ é™¤ç²¾ç¡®æ•°å­—ï¼šèº«é«˜ã€ä½“é‡ã€ç½©æ¯ç­‰ç²¾ç¡®æ•°å­—è¦åˆ é™¤æˆ–æ”¹ä¸ºæ¨¡ç³Šæè¿°ï¼ˆ"é«˜"ã€"ç˜¦"ã€"ä¸°æ»¡"ï¼‰**\n\n## æ¸…ç†é‡ç‚¹ï¼ˆæŒ‰ä¼˜å…ˆçº§æ’åºï¼‰\n\n### ğŸ”´ åå…«è‚¡æ ¸å¿ƒè§„åˆ™ï¼ˆå¿…é¡»ä¸¥æ ¼éµå®ˆï¼‰\n\n#### 1. ç¦æ­¢çš„è¯æ±‡å’Œå¥å¼\n- **æ¨¡ç³Šè¯**ï¼šä¸€ä¸ã€ä¸€æŠ¹ã€ä¸€äº›ã€ä¸€ç§ã€ä¼¼ä¹ã€å‡ ä¹ã€è¿‘ä¹ã€ä»¿ä½›ã€å¯èƒ½ã€å¤§æ¦‚\n- **æ¯”å–»è¯**ï¼šå¦‚åŒã€å®›å¦‚ã€æ°ä¼¼ã€åƒæ˜¯ã€å¥½åƒã€åƒã€å°±åƒã€è‹¥æœ‰è‹¥æ— \n- **å¯¹æ¯”å¥**ï¼š"ä¸æ˜¯...è€Œæ˜¯..."ã€"ä¸å…¶...ä¸å¦‚"ã€"å½¢æˆäº†é²œæ˜çš„å¯¹æ¯”"\n- **å¼ºè°ƒè¯**ï¼š"çŒ›åœ°"ã€"é‡é‡åœ°"ã€"ç‹‚é‡"ã€"æ¿€çƒˆåœ°"ã€"æ¨ä¸å¾—"ã€"ç‹‚å–œ"ã€"ä¸å®¹ç½®ç–‘"\n- **ä¿®é¥°è¯**ï¼š"ä¸æ˜“å¯Ÿè§‰"ã€"éš¾ä»¥å¯Ÿè§‰"ã€"å¸¦ç€xxæ„å‘³"ã€"å¸¦ç€ä¸€ç§"ã€"å……æ»¡äº†æŸç§"ã€"å¹¶æ²¡æœ‰ç«‹åˆ»"\n- **åŠ¨ä½œè¯**ï¼š"æ‰è¿›èº«ä½“"ã€"æŒ‡ç”²æè¿›"ã€"å¼“èµ·"ã€"åå™¬"\n- **"ä¸€"+é‡è¯å¥å¼**ï¼šä¸€æŠ¹å¾®ç¬‘ã€ä¸€ä¸ä¸å®‰ã€ä¸€ç§æ„Ÿè§‰ï¼ˆå…¨éƒ¨åˆ é™¤ï¼‰\n- **ç²¾ç¡®æ•°å­—**ï¼šèº«é«˜168cm/ä¸€ç±³å…­å…«ã€ä½“é‡50kgã€ç½©æ¯Cï¼ˆæ”¹ä¸º"é«˜"ã€"ç˜¦"ã€"ä¸°æ»¡"æˆ–ç›´æ¥åˆ é™¤ï¼‰\n\n#### 2. ç¦æ­¢çš„æå†™å†…å®¹\n- âŒ **çœ¼ç¥/è§†çº¿/å˜´è§’**ï¼šä¸æå†™"çœ¼é‡Œé—ªè¿‡xxx"ã€"å˜´è§’ä¸Šæ‰¬"ã€"è§†çº¿äº¤æ±‡"\n- âŒ **å¿ƒç†çŠ¶æ€**ï¼šä¸æå†™"å¥¹æ„Ÿåˆ°å®³æ€•"ã€"ä»–å†…å¿ƒçŸ›ç›¾"ï¼ˆæ”¹ç”¨å¯¹ç™½æˆ–è¡Œä¸ºå‘ˆç°ï¼‰\n- âŒ **æ°”æ°›**ï¼šä¸æå†™"æ°”æ°›å‡é‡"ã€"ç©ºæ°”å‡å›º"\n- âŒ **åŠ¨ç‰©æ¯”å–»**ï¼šä¸ç”¨"åƒå°å…½"ã€"åƒçŒ«å’ª"ã€"é‡å…½èˆ¬çš„ä½å¼"\n- âŒ **å£°éŸ³æè¿°**ï¼šä¸æå†™"å£°éŸ³æ²™å“‘"ã€"å£°éŸ³é‡Œå¸¦ç€..."ã€"å—“éŸ³å¬èµ·æ¥..."ã€éŸ³é‡/éŸ³é«˜/éŸ³è´¨/é€Ÿåº¦\n- âŒ **å¯¹ç™½è¡¥å……**ï¼šä¸æè¿°å¯¹ç™½çš„è¯­æ°”ã€æ„å›¾ã€åŠŸèƒ½ï¼Œåªå‘ˆç°å¯¹ç™½æœ¬èº«\n\n#### 3. æ‰€æœ‰æ ¼ä¸»è¯­è§„åˆ™\n- âŒ ç¦æ­¢ï¼š"å¥¹çš„å£°éŸ³"ã€"ä»–çš„çœ¼ç¥"ã€"æˆ‘çš„å¿ƒæƒ…"\n- âœ… æ”¹ä¸ºï¼šç›´æ¥ç”¨åè¯æˆ–ä»£è¯ä½œä¸»è¯­ï¼Œæˆ–ç›´æ¥åˆ é™¤\n\n#### 4. åŠ¨ä½œæå†™è§„åˆ™\n- âœ… **åªå‘ˆç°åŠ¨ä½œç»“æœ**ï¼šä¸æ€»ç»“ã€ä¸è¯„ä»·ã€ä¸è§£é‡Šæ„å›¾\n- âŒ é”™è¯¯ï¼š"ä»–æ„¤æ€’åœ°ç ¸äº†æ¯å­"ï¼ˆè¯„ä»·ï¼‰\n- âœ… æ­£ç¡®ï¼š"ä»–ç ¸äº†æ¯å­"ï¼ˆåªå‘ˆç°åŠ¨ä½œï¼‰\n\n#### 5. æƒ…ç»ª/æ„Ÿå—å‘ˆç°è§„åˆ™\n- âœ… **ç”¨å¯¹ç™½æˆ–è¡Œä¸ºå‘ˆç°**ï¼Œä¸ç›´è¿°\n- âŒ é”™è¯¯ï¼š"å¥¹æ„Ÿåˆ°å®³æ€•"\n- âœ… æ­£ç¡®ï¼š"åˆ«è¿‡æ¥ï¼"ï¼ˆå¯¹ç™½ï¼‰æˆ–"å¥¹å¾€åé€€äº†ä¸€æ­¥"ï¼ˆè¡Œä¸ºï¼‰\n\n#### 6. å¯¹ç™½è§„åˆ™\n- âœ… åªç”¨""åŒ…è£¹çš„å°è¯å’Œæ‹Ÿå£°è¯\n- âœ… è¦æœ‰æ—¥å¸¸æ„Ÿå’Œç”Ÿæ´»æ„Ÿï¼Œé¿å…ç¿»è¯‘è…”\n- âŒ ä¸æœ¯è¯­ã€ä¸æ•°æ®ã€ä¸æŠ¥å‘Šã€ä¸åˆ†æ\n\n#### 7. æ•°æ®åŒ–æè¿°è§„åˆ™\n- âŒ ç¦æ­¢ç²¾ç¡®æ•°å­—ï¼šèº«é«˜ï¼ˆ168cmã€ä¸€ç±³å…­å…«ï¼‰ã€ä½“é‡ï¼ˆ50kgï¼‰ã€ç½©æ¯ï¼ˆCç½©æ¯ï¼‰\n- âŒ ç¦æ­¢æœ¯è¯­åŒ–ï¼šæœ¯è¯­ã€ä¸“ä¸šåè¯ã€åˆ†ææ€§æè¿°\n- âœ… æ”¹ä¸ºæ¨¡ç³Šæè¿°ï¼šé«˜ã€çŸ®ã€ç˜¦ã€èƒ–ã€ä¸°æ»¡ç­‰å£è¯­åŒ–è¯æ±‡\n- âœ… æˆ–è€…ç›´æ¥åˆ é™¤ï¼šå¦‚æœæ•°å­—ä¸é‡è¦å°±åˆ æ‰\n\n### ğŸŸ¢ ä¼˜å…ˆçº§3ï¼šå¯ä»¥ä¿ç•™çš„å†…å®¹\n1. **å…·ä½“åŠ¨ä½œæè¿°**ï¼šèµ°ã€åã€ç«™ã€æ‹¿ã€æ”¾ç­‰åŸºæœ¬åŠ¨ä½œ\n2. **ç®€å•æƒ…ç»ªè¯**ï¼šå¼€å¿ƒã€éš¾è¿‡ã€ç”Ÿæ°”ï¼ˆä¸è¦åˆ é™¤ï¼‰\n3. **å¯¹è¯å†…å®¹**ï¼šå®Œæ•´ä¿ç•™æ‰€æœ‰å¯¹è¯\n4. **è®¾å®šä¿¡æ¯**ï¼šäººç‰©èƒŒæ™¯ã€å…³ç³»ã€åœºæ™¯ç­‰æ ¸å¿ƒè®¾å®š\n\n## âš ï¸ ä¸¥ç¦è¿‡åº¦åˆ å‡\n\n**ä¸è¦åšçš„äº‹æƒ…ï¼š**\nâŒ ä¸è¦åˆ é™¤æ•´ä¸ªå¥å­ï¼Œåªåˆ é™¤å…«è‚¡è¯æ±‡\nâŒ ä¸è¦æŠŠäº”æ®µè¯å‹ç¼©æˆä¸‰å¥è¯\nâŒ ä¸è¦åˆ é™¤æ ¸å¿ƒè®¾å®šå’Œé‡è¦ä¿¡æ¯\nâŒ ä¸è¦æŠŠè¯¦ç»†æè¿°å˜æˆç®€ç•¥æ¦‚æ‹¬\nâŒ ä¸è¦åˆ é™¤å¯¹è¯å†…å®¹\n\n**åº”è¯¥åšçš„äº‹æƒ…ï¼š**\nâœ… åªåˆ é™¤/æ›¿æ¢æ˜æ˜¾çš„å…«è‚¡è¯æ±‡\nâœ… **é‡å†™æ¨¡æ¿åŒ–æ¯”å–»**ï¼šç”¨å£è¯­åŒ–ã€è‡ªç„¶çš„è¡¨è¾¾æ›¿æ¢å¥—è¯\nâœ… **è¯´äººè¯**ï¼šä¸è¦ç®€å•åˆ é™¤ï¼Œè€Œæ˜¯ç”¨æ›´è‡ªç„¶çš„è¡¨è¾¾æ–¹å¼æ›¿æ¢\nâœ… **å»æ‰å¯¹ä»—å¼ç»“æ„**ï¼šæŠŠ"æ—¢...åˆ..."æ”¹ä¸ºå£è¯­åŒ–çš„å¹¶åˆ—\nâœ… ä¿æŒåŸæ–‡çš„ä¿¡æ¯é‡å’Œç»“æ„\nâœ… ä¿ç•™æ‰€æœ‰å¯¹è¯å’Œæ ¸å¿ƒè®¾å®š\nâœ… è¾“å‡ºåº”è¯¥å’Œè¾“å…¥é•¿åº¦ç›¸è¿‘ï¼Œä¿¡æ¯é‡ä¸èƒ½å°‘\n\n## ğŸ“– æ–‡ç¬”æå‡æŒ‡å—\n\n**æ ¸å¿ƒåŸåˆ™ï¼šç”¨äººè¯è¯´è¯ï¼Œåˆ«æ–‡å­¦è…”ï¼Œä½†ä¿æŒä¿¡æ¯é‡**\n\n### âœï¸ å¥½æ–‡ç¬”çš„ç‰¹å¾\n1. **å£è¯­åŒ–ã€æ—¥å¸¸åŒ–**ï¼š\n   - âŒ æ–‡å­¦è…”ï¼š"é†‡åšçš„é¦™æ°”æ‰‘é¢è€Œæ¥"\n   - âœ… å£è¯­åŒ–ï¼š"é—»åˆ°é…’å‘³äº†"ã€"æœ‰è‚¡é…’é¦™"\n\n2. **ç®€æ´ç›´æ¥**ï¼š\n   - âŒ å †ç Œï¼š"å¥¹é‚£åŒå¦‚åŒé»‘æ›œçŸ³èˆ¬ç’€ç’¨å¤ºç›®ã€æ·±é‚ƒæ— æ¯”ã€å®›å¦‚æ·±æ¸Šçš„çœ¼çœ¸"\n   - âœ… ç®€æ´ï¼š"å¥¹é»‘è‰²çš„çœ¼ç›å¾ˆæ·±"ã€"é»‘çœ¼ç›ï¼Œçœ‹ä¸å‡ºåœ¨æƒ³ä»€ä¹ˆ"\n\n3. **çœŸå®çš„äººè¯**ï¼š\n   - âŒ åˆ»æ„ï¼š"å¿ƒä¸­æ¶Œèµ·ä¸€è‚¡æ—¢çŸ›ç›¾åˆå¤æ‚çš„æƒ…ç»ªï¼Œä»¿ä½›æ˜¯ææƒ§ä¸æœŸå¾…çš„æ··åˆä½“"\n   - âœ… äººè¯ï¼š"åˆæ€•åˆæœŸå¾…"ã€"å¿ƒé‡ŒçŸ›ç›¾å¾—å¾ˆ"\n\n4. **åŠ¨ä½œè¦å…·ä½“**ï¼š\n   - âŒ æŠ½è±¡ï¼š"å¥¹çš„å£°éŸ³å¦‚åŒé‡å…½èˆ¬çš„ä½å¼"ã€"å¥¹çš„å£°éŸ³å¸¦ç€å‹è¿«æ„Ÿ"\n   - âœ… å…·ä½“ï¼š"å¥¹å‹ä½äº†å£°éŸ³"ã€"å£°éŸ³å¾ˆä½"ã€"å£°éŸ³å“‘äº†"\n\n5. **æ„Ÿå®˜æå†™åˆ«å¤¸å¼ **ï¼š\n   - âŒ å¤¸å¼ ï¼š"ä¸€è‚¡è¯±äººçš„é¦™æ°”"ã€"è‡´å‘½çš„å¸å¼•åŠ›"\n   - âœ… è‡ªç„¶ï¼š"å¥½é—»"ã€"è®©äººæƒ³å¤šé—»ä¸¤ä¸‹"ã€"é¦™å‘³å¾ˆæµ“"\n\n### ğŸ¨ å‚è€ƒé£æ ¼\n- **æµ·æ˜å¨**ï¼šçŸ­å¥ã€æœ‰åŠ›ã€å…‹åˆ¶ã€æ„Ÿå®˜ç»†èŠ‚å‡†ç¡®\n- **æ‘ä¸Šæ˜¥æ ‘**ï¼šå…·ä½“æ„è±¡ã€æ—¥å¸¸åŒ–æ¯”å–»ã€è½»æ¾å™è¿°\n- **ä¼˜è´¨ç½‘æ–‡**ï¼šæµç•…ã€æœ‰èŠ‚å¥æ„Ÿã€ä¸å–å¼„ã€è¯»èµ·æ¥èˆ’æœ\n\n### ğŸ’¡ å®æˆ˜æŠ€å·§\n1. **å»æ‰æ–‡å­¦è…”**ï¼šæŠŠ"è‡´å‘½çš„è¯±æƒ‘"æ”¹æˆ"å¿ä¸ä½æƒ³é è¿‘"ï¼ŒæŠŠ"é†‡åšçš„é¦™æ°”"æ”¹æˆ"é…’é¦™å¾ˆæµ“"\n2. **å»æ‰å¯¹ä»—**ï¼šæŠŠ"æ—¢...åˆ..."æ”¹æˆå£è¯­åŒ–çš„å¹¶åˆ—ï¼š"åˆæ€•åˆæœŸå¾…"ã€"é¦™å‘³æ··åœ¨ä¸€èµ·"\n3. **å»æ‰æ¯”å–»**ï¼šæŠŠ"å¦‚åŒé‡å…½èˆ¬çš„ä½å¼"ç›´æ¥åˆ æ‰ï¼Œæˆ–è€…æ”¹æˆ"å£°éŸ³å¾ˆä½"\n4. **ç”¨äººè¯è¯´è¯**ï¼šæŠŠ"çŸ›ç›¾è€Œæå…·å¸å¼•åŠ›"æ”¹æˆ"è¯´ä¸ä¸Šæ¥ï¼Œä½†å°±æ˜¯æƒ³çœ‹"\n5. **åˆ«å¤ªæ–‡è‰º**ï¼šæŠŠ"å†·æš–äº¤ç»‡çš„æ°”æ¯"æ”¹æˆ"å†·é¦™å’Œé…’å‘³æ··åœ¨ä¸€èµ·"\n\n## ğŸ“‹ åå…«è‚¡ç¤ºä¾‹å¯¹æ¯”\n\n### ç¤ºä¾‹1ï¼šåŸºç¡€å»å…«è‚¡\n\n**è¾“å…¥ï¼ˆåŒ…å«åŸºç¡€å…«è‚¡ï¼‰ï¼š**\nè§’è‰²Aä¼¼ä¹æœ‰äº›å›°æƒ‘ï¼Œçœ¼é‡Œé—ªè¿‡ä¸€ä¸ä¸æ˜“å¯Ÿè§‰çš„ç–‘æƒ‘ï¼Œå¥¹ç”¨ä¸å®¹ç½®ç–‘çš„è¯­æ°”è¯´ï¼š"ä½ æ˜¯è°ï¼Ÿ"å¥¹çš„å£°éŸ³ä½æ²‰è€Œå¯Œæœ‰ç£æ€§ï¼Œå¦‚åŒé‡å…½èˆ¬çš„ä½å¼ã€‚\n\nè§’è‰²Aå‡ºç”Ÿäºè´µæ—å®¶åº­ï¼Œå¥¹æœ‰ç€ä¸€å¤´å¦‚åŒé»‘æ›œçŸ³èˆ¬çš„é•¿å‘ï¼ŒåŒçœ¸å®›å¦‚æ·±é‚ƒçš„æ¹–æ³Šï¼Œèº«é«˜168cmï¼Œç½©æ¯Cã€‚\n\nå¥¹çš„æ€§æ ¼å¹¶ä¸æ˜¯æ¸©æŸ”çš„ï¼Œè€Œæ˜¯å‚²æ…¢ä¸”ç‹‚çƒ­çš„ã€‚å¥¹å–œæ¬¢é˜…è¯»ï¼Œç»å¸¸ä¸€ä¸ªäººå¾…åœ¨å›¾ä¹¦é¦†é‡Œã€‚\n\nå¥¹å¯¹é­”æ³•æœ‰ç€è¿‘ä¹ç‹‚çƒ­çš„è¿½æ±‚ï¼Œä»¿ä½›é‚£æ˜¯å¥¹ç”Ÿå‘½çš„å…¨éƒ¨æ„ä¹‰ã€‚å¥¹çš„å†…å¿ƒæ·±å¤„éšè—ç€å·¨å¤§çš„ææƒ§ã€‚\n\nè¯­æ–™ï¼š"å“¼ï¼Œä½ è¿™ç§å‡¡äººæ€ä¹ˆä¼šç†è§£æˆ‘çš„æƒ³æ³•ã€‚"ï¼ˆå¸¦ç€ä¸å±‘çš„å£å»ï¼‰\n\n**âŒ é”™è¯¯è¾“å‡ºï¼ˆè¿‡åº¦åˆ å‡ï¼‰ï¼š**\nè§’è‰²Aé—®ï¼š"ä½ æ˜¯è°ï¼Ÿ"\nè§’è‰²Aå‡ºç”Ÿäºè´µæ—å®¶åº­ï¼Œæœ‰é»‘è‰²é•¿å‘ã€‚\nè¯­æ–™ï¼š"ä½ ä¸ä¼šç†è§£æˆ‘çš„æƒ³æ³•ã€‚"\n\n**âœ… æ­£ç¡®è¾“å‡ºï¼ˆåº”ç”¨åå…«è‚¡è§„åˆ™ï¼‰ï¼š**\nè§’è‰²Aåœäº†åœã€‚"ä½ æ˜¯è°ï¼Ÿ"\n\nè§’è‰²Aå‡ºç”Ÿäºè´µæ—å®¶åº­ï¼Œé»‘è‰²é•¿å‘ï¼Œé»‘çœ¼ç›ï¼Œä¸ªå­é«˜ï¼Œèƒ¸éƒ¨ä¸°æ»¡ã€‚\n\nè§’è‰²Aå‚²æ…¢ï¼Œå¯¹å¾ˆå¤šäº‹éƒ½å¾ˆçƒ­æƒ…ã€‚å–œæ¬¢é˜…è¯»ï¼Œç»å¸¸ä¸€ä¸ªäººå¾…åœ¨å›¾ä¹¦é¦†ã€‚\n\nè§’è‰²Aå¯¹é­”æ³•å¾ˆç—´è¿·ï¼ŒæŠ•å…¥äº†å¾ˆå¤šæ—¶é—´ç ”ç©¶ã€‚å¥¹æ€•ä¸€äº›ä¸œè¥¿ã€‚\n\nè¯­æ–™ï¼š"å“¼ï¼Œä½ è¿™ç§å‡¡äººæ€ä¹ˆä¼šç†è§£æˆ‘çš„æƒ³æ³•ã€‚"\n\n**æ”¹è¿›è¯´æ˜ï¼š**\n1. "ä¼¼ä¹æœ‰äº›å›°æƒ‘" â†’ "åœäº†åœ"ï¼ˆç”¨è¡Œä¸ºä»£æ›¿å¿ƒç†ï¼‰\n2. "çœ¼é‡Œé—ªè¿‡ä¸€ä¸ä¸æ˜“å¯Ÿè§‰çš„ç–‘æƒ‘" â†’ åˆ é™¤ï¼ˆç¦æ­¢çœ¼ç¥æå†™ï¼‰\n3. "å¥¹çš„å£°éŸ³ä½æ²‰è€Œå¯Œæœ‰ç£æ€§ï¼Œå¦‚åŒé‡å…½èˆ¬çš„ä½å¼" â†’ åˆ é™¤ï¼ˆç¦æ­¢å£°éŸ³æå†™å’ŒåŠ¨ç‰©æ¯”å–»ï¼‰\n4. "å¦‚åŒé»‘æ›œçŸ³èˆ¬"ã€"å®›å¦‚æ·±é‚ƒçš„æ¹–æ³Š" â†’ åˆ é™¤ï¼ˆç¦æ­¢æ˜å–»ï¼‰\n5. "å¥¹çš„æ€§æ ¼å¹¶ä¸æ˜¯...è€Œæ˜¯..." â†’ "è§’è‰²Aå‚²æ…¢"ï¼ˆåˆ é™¤æ‰€æœ‰æ ¼ä¸»è¯­å’Œå¯¹æ¯”å¥ï¼‰\n6. "è¿‘ä¹"ã€"ä»¿ä½›" â†’ åˆ é™¤ï¼ˆç¦æ­¢æ¨¡ç³Šè¯ï¼‰\n7. "èº«é«˜168cm"ã€"ç½©æ¯C" â†’ "ä¸ªå­é«˜"ï¼ˆåˆ é™¤ç²¾ç¡®æ•°å­—ï¼‰\n8. "ï¼ˆå¸¦ç€ä¸å±‘çš„å£å»ï¼‰" â†’ åˆ é™¤ï¼ˆç¦æ­¢å¯¹ç™½è¡¥å……ï¼‰\n\n### ç¤ºä¾‹2ï¼šä¿¡æ¯ç´ æå†™å»å…«è‚¡\n\n**è¾“å…¥ï¼ˆåŒ…å«å¤§é‡å…«è‚¡ï¼‰ï¼š**\nä¸€é˜µæ—¢å†·å†½åˆé†‡åšçš„é¦™æ°”é£˜æ¥ï¼Œæ··åˆç€å†¬æ—¥é›ªæ¾ä¸æ¸©çƒ­ç™½å…°åœ°çš„å‘³é“ï¼ŒçŸ›ç›¾è€Œæå…·å¸å¼•åŠ›ã€‚æµ“éƒè€Œæ»šçƒ«çš„ä¿¡æ¯ç´ æ­£ä»ä»–èº«ä¸Šæºæºä¸æ–­åœ°æ•£å‘å‡ºæ¥ï¼Œé‚£å†°å†·çš„é›ªæ‰æ°”æ¯å·²ç»è¢«é†‡åšçš„ç™½å…°åœ°é…’é¦™å½»åº•åŒ…è£¹ï¼Œå……æ»¡äº†æ¯«æ— é˜²å¤‡çš„ã€è‡´å‘½çš„è¯±æƒ‘ã€‚\n\n**âœ… æ­£ç¡®è¾“å‡ºï¼ˆåº”ç”¨åå…«è‚¡è§„åˆ™ï¼‰ï¼š**\né—»åˆ°é¦™å‘³ï¼Œé›ªæ¾å’Œç™½å…°åœ°æ··åœ¨ä¸€èµ·ã€‚æ»šçƒ«çš„ä¿¡æ¯ç´ ä»ä»–èº«ä¸Šæ•£å‡ºæ¥ï¼Œé›ªæ‰å‘³è¢«é…’é¦™ç›–è¿‡äº†ã€‚\n\n**æ”¹è¿›è¯´æ˜ï¼š**\n1. "æ—¢...åˆ..." â†’ åˆ é™¤ï¼ˆç¦æ­¢å¯¹æ¯”å¥å¼ï¼‰\n2. "çŸ›ç›¾è€Œæå…·å¸å¼•åŠ›" â†’ åˆ é™¤ï¼ˆç¦æ­¢æŠ½è±¡æè¿°ï¼‰\n3. "æµ“éƒè€Œæ»šçƒ«" â†’ "æ»šçƒ«"ï¼ˆåˆ é™¤å†—ä½™å½¢å®¹è¯ï¼‰\n4. "é†‡åš"ã€"å†°å†·" â†’ åˆ é™¤ï¼ˆåˆ é™¤éå¿…è¦å½¢å®¹è¯ï¼‰\n5. "å……æ»¡äº†æ¯«æ— é˜²å¤‡çš„ã€è‡´å‘½çš„è¯±æƒ‘" â†’ åˆ é™¤ï¼ˆç¦æ­¢æŠ½è±¡æè¿°ï¼‰\n6. "ä¸€é˜µ" â†’ "é—»åˆ°"ï¼ˆåˆ é™¤"ä¸€"+é‡è¯å¥å¼ï¼‰\n\n\n## ğŸ¯ è¾“å‡ºè¦æ±‚\n\n1. **ä¿æŒæ®µè½æ•°é‡**ï¼šè¾“å…¥æœ‰å‡ æ®µï¼Œè¾“å‡ºä¹Ÿåº”è¯¥æœ‰å‡ æ®µ\n2. **ä¿æŒä¿¡æ¯é‡**ï¼šæ‰€æœ‰é‡è¦ä¿¡æ¯éƒ½è¦ä¿ç•™ï¼Œä¸è¦è¿‡åº¦åˆ å‡\n3. **ä¸¥æ ¼åº”ç”¨åå…«è‚¡è§„åˆ™**ï¼š\n   - åˆ é™¤æ‰€æœ‰ç¦æ­¢çš„è¯æ±‡ï¼ˆæ¨¡ç³Šè¯ã€æ¯”å–»è¯ã€å¼ºè°ƒè¯ç­‰ï¼‰\n   - åˆ é™¤æ‰€æœ‰ç¦æ­¢çš„æå†™ï¼ˆçœ¼ç¥ã€å£°éŸ³ã€å¿ƒç†ã€æ°”æ°›ç­‰ï¼‰\n   - åˆ é™¤æ‰€æœ‰æ ¼ä¸»è¯­ï¼ˆ"å¥¹çš„"ã€"ä»–çš„"ï¼‰\n   - ç”¨è¡Œä¸ºæˆ–å¯¹ç™½ä»£æ›¿å¿ƒç†æå†™\n   - å¯¹ç™½ä¸åŠ ä»»ä½•è¡¥å……è¯´æ˜\n4. **ä¿æŒè‡ªç„¶**ï¼šåˆ é™¤åçš„æ–‡æœ¬åº”è¯¥è¯»èµ·æ¥è‡ªç„¶æµç•…ï¼Œä¸ç”Ÿç¡¬\n5. **åªåˆ å…«è‚¡è¯**ï¼šåªé’ˆå¯¹æ€§åœ°åˆ é™¤ä¸Šè¿°ç¦ç”¨è¯ï¼Œä¸è¦å¤§èŒƒå›´åˆ å‡\n6. **ç›´æ¥è¾“å‡º**ï¼šä¸è¦æ·»åŠ ä»»ä½•è§£é‡Šæˆ–è¯´æ˜\n\nè¯·æŒ‰ç…§ä»¥ä¸Šæ ‡å‡†æ¸…ç†æ–‡æœ¬ï¼Œ**ç‰¹åˆ«æ³¨æ„ä¸è¦è¿‡åº¦åˆ å‡å†…å®¹**ã€‚`,\n        },\n        {\n          role: \'user\',\n          content: antiClicheInput.value,\n        },\n      ],\n    };\n\n    let generatedText: string;\n\n    if (enableAntiClicheStreaming.value) {\n      // æµå¼ç”Ÿæˆ\n      generatedText = await generateWithStreaming(requestPayload, antiClicheProgressPercent);\n    } else {\n      // éæµå¼ç”Ÿæˆ\n      const apiUrl = normalizeApiEndpoint(settings.value.api_endpoint);\n      const response = await fetch(apiUrl, {\n        method: \'POST\',\n        headers: {\n          \'Content-Type\': \'application/json\',\n          Authorization: `Bearer ${settings.value.api_key}`,\n        },\n        body: JSON.stringify(requestPayload),\n      });\n\n      if (!response.ok) {\n        throw new Error(`HTTP error! status: ${response.status}`);\n      }\n\n      const data = await response.json();\n      generatedText = data.choices[0].message.content.trim();\n      antiClicheProgressPercent.value = 100;\n    }\n\n    antiClicheOutput.value = generatedText;\n    saveToolsDataImmediate(); // ç«‹å³ä¿å­˜ç»“æœ\n\n    window.toastr.success(\'æ–‡æœ¬æ¸…ç†å®Œæˆï¼\');\n  } catch (error) {\n    console.error(\'åå…«è‚¡æ¸…ç†å¤±è´¥:\', error);\n    window.toastr.error(\'æ¸…ç†å¤±è´¥ï¼š\' + (error as Error).message);\n  } finally {\n    isProcessingAntiCliche.value = false;\n    antiClicheProgressPercent.value = 0;\n  }\n};\n\nconst copyAntiClicheResult = () => {\n  if (!antiClicheOutput.value) {\n    window.toastr.warning(\'æ²¡æœ‰å¯å¤åˆ¶çš„å†…å®¹\');\n    return;\n  }\n\n  // ä½¿ç”¨ç»Ÿä¸€çš„å¤åˆ¶å‡½æ•°\n  copyToClipboard(antiClicheOutput.value, \'æ¸…ç†ç»“æœå·²å¤åˆ¶åˆ°å‰ªè´´æ¿\');\n};\n\n// åå…«è‚¡ä¿®æ”¹å¤„ç†å‡½æ•°\nconst handleModifyAntiCliche = async () => {\n  if (!antiClicheModifyRequest.value.trim()) {\n    window.toastr.warning(\'è¯·è¾“å…¥ä¿®æ”¹éœ€æ±‚\');\n    return;\n  }\n\n  if (!antiClicheOutput.value) {\n    window.toastr.warning(\'æ²¡æœ‰å¯ä¿®æ”¹çš„å†…å®¹\');\n    return;\n  }\n\n  try {\n    isModifyingAntiCliche.value = true;\n    antiClicheProgressPercent.value = 0;\n    window.toastr.info(\'AIæ­£åœ¨ä¿®æ”¹...\', \'åå…«è‚¡ä¿®æ”¹\', { timeOut: 15000 });\n\n    const requestPayload = {\n      model: settings.value.model,\n      max_tokens: settings.value.max_tokens || 8000,\n      temperature: 0.7,\n      stream: enableAntiClicheStreaming.value,\n      messages: [\n        {\n          role: \'system\',\n          content:\n            \'ä½ æ˜¯ä¸€ä¸ªæ–‡æœ¬ç¼–è¾‘åŠ©æ‰‹ã€‚æ ¹æ®ç”¨æˆ·çš„ä¿®æ”¹éœ€æ±‚ï¼Œå¯¹æä¾›çš„æ–‡æœ¬è¿›è¡Œä¿®æ”¹ã€‚ç›´æ¥è¾“å‡ºä¿®æ”¹åçš„ç»“æœï¼Œä¸è¦æ·»åŠ ä»»ä½•è§£é‡Šæˆ–è¯´æ˜ã€‚\',\n        },\n        {\n          role: \'user\',\n          content: `å½“å‰æ–‡æœ¬ï¼š\\n${antiClicheOutput.value}\\n\\nä¿®æ”¹éœ€æ±‚ï¼š${antiClicheModifyRequest.value}`,\n        },\n      ],\n    };\n\n    let modifiedText: string;\n\n    if (enableAntiClicheStreaming.value) {\n      // æµå¼ç”Ÿæˆ\n      modifiedText = await generateWithStreaming(requestPayload, antiClicheProgressPercent);\n    } else {\n      // éæµå¼ç”Ÿæˆ\n      const apiUrl = normalizeApiEndpoint(settings.value.api_endpoint);\n      const response = await fetch(apiUrl, {\n        method: \'POST\',\n        headers: {\n          \'Content-Type\': \'application/json\',\n          Authorization: `Bearer ${settings.value.api_key}`,\n        },\n        body: JSON.stringify(requestPayload),\n      });\n\n      if (!response.ok) {\n        throw new Error(`HTTP error! status: ${response.status}`);\n      }\n\n      const data = await response.json();\n      modifiedText = data.choices[0].message.content.trim();\n      antiClicheProgressPercent.value = 100;\n    }\n\n    antiClicheOutput.value = modifiedText;\n    saveToolsDataImmediate(); // ç«‹å³ä¿å­˜ç»“æœ\n\n    window.toastr.success(\'ä¿®æ”¹å®Œæˆï¼\');\n  } catch (error) {\n    console.error(\'åå…«è‚¡ä¿®æ”¹å¤±è´¥:\', error);\n    window.toastr.error(\'ä¿®æ”¹å¤±è´¥ï¼š\' + (error as Error).message);\n  } finally {\n    isModifyingAntiCliche.value = false;\n    antiClicheProgressPercent.value = 0;\n  }\n};\n\n// æ¸…ç©ºåå…«è‚¡ä¿®æ”¹éœ€æ±‚\nconst clearAntiClicheModifyRequest = () => {\n  antiClicheModifyRequest.value = \'\';\n  saveToolsDataImmediate();\n  window.toastr.success(\'ä¿®æ”¹éœ€æ±‚å·²æ¸…ç©º\');\n};\n\n// è§’è‰²å¡ç”Ÿæˆå·¥å…·ç›¸å…³å‡½æ•°\nconst handleGenerateCharacterCard = async () => {\n  if (!characterDescription.value.trim()) {\n    window.toastr.warning(\'è¯·è¾“å…¥è§’è‰²æè¿°\');\n    return;\n  }\n\n  try {\n    isGeneratingCharacter.value = true;\n    characterProgressPercent.value = 0;\n    window.toastr.info(\'AIæ­£åœ¨ç”Ÿæˆè§’è‰²å¡ï¼Œè¯·ç¨å€™...\');\n\n    const requestPayload = {\n      model: settings.value.model || \'gpt-3.5-turbo\',\n      max_tokens: settings.value.max_tokens || 16000,\n      temperature: 0.8,\n      stream: enableCharacterStreaming.value,\n      messages: [\n        {\n          role: \'system\',\n          content: `ä½ æ˜¯ä¸€ä¸ªè§’è‰²å¡ç”ŸæˆåŠ©æ‰‹ã€‚è¯·ç³»ç»Ÿæ€§åœ°åˆ›å»ºä¸€ä¸ªå®Œæ•´çš„è§’è‰²å¡ã€‚\n\n**è¾“å‡ºæ ¼å¼è¦æ±‚**ï¼š\n- å¿…é¡»ä½¿ç”¨ YAML æ ¼å¼ï¼Œæ‰€æœ‰å­—æ®µåå’Œå†…å®¹éƒ½ç”¨ä¸­æ–‡\n- ç¡®ä¿è¾“å‡ºå®Œæ•´ï¼Œä¸è¦æˆªæ–­\n- é¿å…AIåˆ»æ¿åŒ–ï¼Œè¦æœ‰å¤šæ ·æ€§å’ŒçœŸå®æ„Ÿ\n- ä¸¥æ ¼é¿å…ä»»ä½•AIæŒ‡ä»¤å¼è¯­è¨€\n\n**è§’è‰²å¡ç»“æ„æ¨¡æ¿**ï¼š\n\\`\\`\\`yaml\nåŸºç¡€ä¿¡æ¯:\n  å§“å: "å…¨å"\n  å¹´é¾„: å…·ä½“å¹´é¾„\n  å‡ºç”Ÿå¹´æœˆ: "YYYYå¹´MMæœˆ"\n  æ€§åˆ«: "ç”·/å¥³/å…¶ä»–"\n  ç¬¬äºŒæ€§åˆ«: "Alpha/Beta/Omega/æ— "\n  èº«é«˜ä½“é‡: "èº«é«˜ç”¨æ–‡å­—æè¿°ï¼ˆé«˜å¤§/ä¸­ç­‰/å¨‡å°ç­‰ï¼‰ï¼Œä½“é‡ç”¨æ–‡å­—æè¿°ï¼ˆåŒ€ç§°/çº¤ç˜¦/ä¸°æ»¡ç­‰ï¼‰"\n  ä¿¡æ¯ç´ : "æè¿°æ°”å‘³ç‰¹å¾å’Œå˜åŒ–è§„å¾‹ï¼ˆå¦‚é€‚ç”¨ï¼‰"\n  æ€§å–å‘: "å¼‚æ€§æ‹/åŒæ€§æ‹/åŒæ€§æ‹ç­‰"\n  æ‹çˆ±ç»éªŒ: "è¯¦ç»†æè¿°"\n  èº«ä»½èŒä¸š: "å…·ä½“èŒä¸šå’Œç¤¾ä¼šåœ°ä½"\n  æ ‡å¿—æ€§ç‰¹å¾:\n    å¾®ä¿¡æ˜µç§°: "æ˜µç§°"\n    å¤´åƒ: "æè¿°"\n    å…¶ä»–: "å…¶ä»–æ ‡å¿—æ€§ç‰¹å¾"\n\nå¤–è²Œä¸èº«æ:\n  æ•´ä½“èº«å½¢: "é«˜çŸ®èƒ–ç˜¦ã€è‚Œè‚‰ç±»å‹çš„è¯¦ç»†æè¿°"\n  é¢å®¹ç‰¹å¾:\n    å‘å‹: "å‘å‹ã€å‘è‰²ã€å‘è´¨"\n    è‚¤è‰²: "è‚¤è‰²æè¿°"\n    çœ¼ç›: "çœ¼ç›é¢œè‰²å’Œç‰¹å¾"\n    äº”å®˜: "äº”å®˜ç‰¹ç‚¹"\n  ç©¿æ­é£æ ¼: "æ—¥å¸¸ç©¿æ­åå¥½å’Œé£æ ¼"\n  å£°éŸ³ç‰¹å¾: "éŸ³è‰²ã€éŸ³è°ƒã€è¯´è¯èŠ‚å¥"\n  ä¹ æƒ¯æ€§åŠ¨ä½œ: "å¸¸è§çš„å§¿æ€å’Œå°åŠ¨ä½œ"\n\næ€§æ ¼ä¸å¿ƒç†:\n  ä¸»è¦æ€§æ ¼ç‰¹å¾:\n    - ç‰¹è´¨1: "å…·ä½“è¡¨ç°å’Œè¡Œä¸ºæ¨¡å¼"\n    - ç‰¹è´¨2: "å…·ä½“è¡¨ç°å’Œè¡Œä¸ºæ¨¡å¼"\n    - ç‰¹è´¨3: "å…·ä½“è¡¨ç°å’Œè¡Œä¸ºæ¨¡å¼"\n  æ€§æ ¼çš„ä¸¤é¢æ€§: "åœ¨ä¸åŒæƒ…å†µä¸‹å±•ç°çš„ä¸åŒä¾§é¢ï¼ˆä¾‹å¦‚ï¼šå¹³æ—¶æ¸©å’Œä½†è§¦åŠåº•çº¿æ—¶å¼ºç¡¬ï¼‰"\n  æƒ…ç»ªæ¨¡å¼:\n    å¸¸è§æƒ…ç»ª: "æ—¥å¸¸ä¸»è¦æƒ…ç»ªçŠ¶æ€"\n    æƒ…ç»ªè§¦å‘ç‚¹: "ä»€ä¹ˆå®¹æ˜“å¼•å‘æƒ…ç»ªæ³¢åŠ¨"\n    æƒ…ç»ªè¡¨è¾¾æ–¹å¼: "å¦‚ä½•è¡¨ç°å’Œå¤„ç†æƒ…ç»ª"\n  åº”å¯¹å‹åŠ›: "é¢å¯¹å‹åŠ›å’Œå›°å¢ƒæ—¶çš„ååº”å’Œå¤„ç†æ–¹å¼"\n\nå¯¹è¯é£æ ¼:\n  æ—¥å¸¸è¯­æ°”: "ç”¨è¯ä¹ æƒ¯å’Œè¯´è¯ç‰¹ç‚¹"\n  å¯¹ä¸åŒå¯¹è±¡:\n    äº²è¿‘çš„äºº: "è¯´è¯æ–¹å¼"\n    é™Œç”Ÿäºº: "è¯´è¯æ–¹å¼"\n    å·¥ä½œåœºåˆ: "è¯´è¯æ–¹å¼"\n  æƒ…ç»ªå˜åŒ–æ—¶: "æƒ…ç»ªæ¿€åŠ¨/ä½è½æ—¶çš„è¯­è¨€å˜åŒ–"\n  å£å¤´ç¦…: ["å£å¤´ç¦…1", "å£å¤´ç¦…2"]\n\nèƒŒæ™¯ç»å†:\n  å®¶åº­èƒŒæ™¯: "è¯¦ç»†çš„å®¶åº­ç¯å¢ƒå’Œæˆé•¿èƒŒæ™¯"\n  æ•™è‚²ç»å†: "å­¦ä¹ ç»å†"\n  é‡è¦äººç”Ÿäº‹ä»¶: ["äº‹ä»¶1", "äº‹ä»¶2", "äº‹ä»¶3"]\n  å…³é”®è½¬æŠ˜ç‚¹: "æ”¹å˜TAçš„é‡è¦äº‹ä»¶"\n  å½“å‰çŠ¶å†µ: "ç°åœ¨çš„ç”Ÿæ´»çŠ¶æ€"\n  äººç”Ÿç›®æ ‡: "TAæƒ³è¦è¾¾æˆçš„ç›®æ ‡"\n\näººé™…å…³ç³»:\n  å¯¹ä¸»è¦è§’è‰²çš„æ€åº¦: "ä¸{{user}}æˆ–å…¶ä»–é‡è¦è§’è‰²çš„äº’åŠ¨æ¨¡å¼"\n  ç¤¾äº¤åå¥½: "å–œæ¬¢çš„ç¤¾äº¤æ–¹å¼å’Œè¾¹ç•Œ"\n  ç¾¤ä½“è§’è‰²: "åœ¨å›¢é˜Ÿä¸­çš„å®šä½ï¼ˆé¢†å¯¼è€…/åè°ƒè€…/è§‚å¯Ÿè€…ç­‰ï¼‰"\n  å†²çªå¤„ç†: "å¦‚ä½•å¤„ç†çŸ›ç›¾å’Œå†²çª"\n\nè¡Œä¸ºæ¨¡å¼ä¸åŠ¨æœº:\n  å…¸å‹è¡Œä¸º:\n    ä¸»åŠ¨å€¾å‘: "TAå€¾å‘äºä¸»åŠ¨åšä»€ä¹ˆäº‹æƒ…"\n    å›é¿å€¾å‘: "TAä¼šé¿å…æˆ–æ‹’ç»åšä»€ä¹ˆ"\n    ä¹ æƒ¯ååº”: "åœ¨ç‰¹å®šæƒ…å†µä¸‹çš„å…¸å‹ååº”"\n  åº•çº¿ä¸åŸåˆ™: "TAåšå®ˆçš„åŸåˆ™å’Œä¸å¯è§¦ç¢°çš„åº•çº¿"\n  å†…åœ¨åŠ¨æœº:\n    è¡ŒåŠ¨é©±åŠ¨: "æ¨åŠ¨TAè¡ŒåŠ¨çš„å†…åœ¨åŸå› "\n    æ·±å±‚éœ€æ±‚: "TAå†…å¿ƒçœŸæ­£æ¸´æœ›çš„æ˜¯ä»€ä¹ˆ"\n    éšè—æƒ³æ³•: "TAä¸è½»æ˜“è¡¨éœ²çš„çœŸå®æƒ³æ³•"\n  æƒ…ç»ªç®¡ç†:\n    å¤±æ§è¾¹ç•Œ: "ä»€ä¹ˆæƒ…å†µä¸‹ä¼šæƒ…ç»ªå¤±æ§"\n    æ¢å¤æ–¹å¼: "å¦‚ä½•å¹³å¤æƒ…ç»ªå’Œè‡ªæˆ‘è°ƒèŠ‚"\n\\`\\`\\`\n\nè¯·åŸºäºç”¨æˆ·çš„æè¿°ï¼Œç”Ÿæˆä¸€ä¸ªå®Œæ•´ã€ç«‹ä½“ã€çœŸå®çš„è§’è‰²ã€‚æ³¨æ„ï¼š\n1. èº«é«˜ä½“é‡å¿…é¡»ç”¨æ–‡å­—æè¿°ï¼Œä¸è¦ç”¨æ•°å­—å’Œå•ä½\n2. æ€§æ ¼è¦å±•ç°å¤šé¢æ€§å’Œå¤æ‚æ€§ï¼Œé¿å…å•ä¸€åŒ–å’Œåˆ»æ¿å°è±¡\n3. è¡Œä¸ºæ¨¡å¼è¦ä»è§’è‰²è§†è§’å‡ºå‘ï¼Œæè¿°TAä¼šå¦‚ä½•æ€è€ƒå’Œè¡ŒåŠ¨\n4. æ‰€æœ‰å†…å®¹è¦è¯¦ç»†ä¸°å¯Œï¼Œæœ‰å…·ä½“ä¾‹å­å’Œåœºæ™¯`,\n        },\n        {\n          role: \'user\',\n          content: characterDescription.value,\n        },\n      ],\n    };\n\n    let generatedText: string;\n\n    if (enableCharacterStreaming.value) {\n      // æµå¼ç”Ÿæˆ\n      generatedText = await generateWithStreaming(requestPayload, characterProgressPercent);\n    } else {\n      // éæµå¼ç”Ÿæˆ\n      const apiUrl = normalizeApiEndpoint(settings.value.api_endpoint);\n      const response = await fetch(apiUrl, {\n        method: \'POST\',\n        headers: {\n          \'Content-Type\': \'application/json\',\n          Authorization: `Bearer ${settings.value.api_key}`,\n        },\n        body: JSON.stringify(requestPayload),\n      });\n\n      if (!response.ok) {\n        throw new Error(`HTTP error! status: ${response.status}`);\n      }\n\n      const data = await response.json();\n      generatedText = data.choices[0].message.content.trim();\n      characterProgressPercent.value = 100;\n    }\n\n    characterCardOutput.value = generatedText;\n    saveToolsDataImmediate(); // ç«‹å³ä¿å­˜ç»“æœ\n\n    window.toastr.success(\'è§’è‰²å¡ç”Ÿæˆå®Œæˆï¼\');\n  } catch (error) {\n    console.error(\'è§’è‰²å¡ç”Ÿæˆå¤±è´¥:\', error);\n    window.toastr.error(\'ç”Ÿæˆå¤±è´¥ï¼š\' + (error as Error).message);\n  } finally {\n    isGeneratingCharacter.value = false;\n    characterProgressPercent.value = 0;\n  }\n};\n\nconst clearCharacterForm = () => {\n  characterDescription.value = \'\';\n  characterCardOutput.value = \'\';\n  modifyRequest.value = \'\';\n  saveToolsDataImmediate(); // ç«‹å³ä¿å­˜\n  window.toastr.success(\'å†…å®¹å·²æ¸…ç©º\');\n};\n\nconst copyCharacterCard = () => {\n  if (!characterCardOutput.value) {\n    window.toastr.warning(\'æ²¡æœ‰å¯å¤åˆ¶çš„å†…å®¹\');\n    return;\n  }\n\n  // ä½¿ç”¨ç»Ÿä¸€çš„å¤åˆ¶å‡½æ•°\n  copyToClipboard(characterCardOutput.value, \'è§’è‰²å¡å·²å¤åˆ¶åˆ°å‰ªè´´æ¿\');\n};\n\n// æ¸…ç©ºåå…«è‚¡è¡¨å•\nconst clearAntiClicheForm = () => {\n  antiClicheInput.value = \'\';\n  antiClicheOutput.value = \'\';\n  saveToolsDataImmediate(); // ç«‹å³ä¿å­˜\n  window.toastr.success(\'å†…å®¹å·²æ¸…ç©º\');\n};\n\n// ä¿®æ”¹è§’è‰²å¡\nconst handleModifyCharacterCard = async () => {\n  if (!modifyRequest.value.trim()) {\n    window.toastr.warning(\'è¯·è¾“å…¥ä¿®æ”¹éœ€æ±‚\');\n    return;\n  }\n\n  if (!characterCardOutput.value) {\n    window.toastr.warning(\'æ²¡æœ‰å¯ä¿®æ”¹çš„è§’è‰²å¡ï¼Œè¯·å…ˆç”Ÿæˆè§’è‰²å¡\');\n    return;\n  }\n\n  try {\n    isModifyingCharacter.value = true;\n    characterProgressPercent.value = 0;\n    window.toastr.info(\'AIæ­£åœ¨æ ¹æ®ä½ çš„éœ€æ±‚ä¿®æ”¹è§’è‰²å¡ï¼Œè¯·ç¨å€™...\');\n\n    const requestPayload = {\n      model: settings.value.model || \'gpt-3.5-turbo\',\n      max_tokens: settings.value.max_tokens || 16000,\n      temperature: 0.8,\n      stream: enableCharacterStreaming.value,\n      messages: [\n        {\n          role: \'system\',\n          content: `ä½ æ˜¯ä¸€ä¸ªè§’è‰²å¡ç¼–è¾‘åŠ©æ‰‹ã€‚ç”¨æˆ·ä¼šæä¾›ä¸€ä¸ªç°æœ‰çš„ YAML æ ¼å¼è§’è‰²å¡å’Œä¿®æ”¹éœ€æ±‚ï¼Œè¯·æ ¹æ®ä¿®æ”¹éœ€æ±‚è°ƒæ•´è§’è‰²å¡å†…å®¹ã€‚\n\n**ä¿®æ”¹åŸåˆ™**ï¼š\n1. å¿…é¡»ä¿æŒ YAML æ ¼å¼ï¼Œæ‰€æœ‰å­—æ®µåå’Œå†…å®¹éƒ½ä½¿ç”¨ä¸­æ–‡\n2. åªä¿®æ”¹ç”¨æˆ·æ˜ç¡®è¦æ±‚ä¿®æ”¹çš„éƒ¨åˆ†\n3. ç¡®ä¿ä¿®æ”¹åçš„å†…å®¹ä¸åŸæœ‰è§’è‰²å¡é£æ ¼ä¸€è‡´\n4. å¦‚æœç”¨æˆ·çš„è¦æ±‚ä¸åŸæœ‰è®¾å®šå†²çªï¼Œä»¥ç”¨æˆ·çš„è¦æ±‚ä¸ºå‡†\n5. è¾“å‡ºå®Œæ•´çš„ä¿®æ”¹åçš„è§’è‰²å¡ï¼Œä¸è¦æˆªæ–­\n6. ä¿æŒåŸæœ‰çš„å­—æ®µç»“æ„ï¼Œé™¤éç”¨æˆ·è¦æ±‚æ·»åŠ æˆ–åˆ é™¤å­—æ®µ\n\n**é‡è¦æ³¨æ„äº‹é¡¹**ï¼š\n- èº«é«˜ä½“é‡å¿…é¡»ç”¨æ–‡å­—æè¿°ï¼ˆé«˜å¤§/ä¸­ç­‰/å¨‡å°/åŒ€ç§°/çº¤ç˜¦ç­‰ï¼‰ï¼Œä¸è¦ç”¨æ•°å­—å’Œå•ä½\n- ä¿æŒæ€§æ ¼çš„å¤šé¢æ€§å’Œå¤æ‚æ€§ï¼Œé¿å…å•ä¸€åŒ–\n- è¡Œä¸ºæ¨¡å¼è¦ä»è§’è‰²è§†è§’å‡ºå‘ï¼Œæè¿°è§’è‰²ä¼šå¦‚ä½•æ€è€ƒå’Œè¡ŒåŠ¨\n- é¿å…AIåˆ»æ¿åŒ–ï¼Œä¿æŒè§’è‰²çš„çœŸå®æ„Ÿå’Œå¤šæ ·æ€§\n\nè¯·è¾“å‡ºå®Œæ•´çš„ YAML æ ¼å¼è§’è‰²å¡ã€‚`,\n        },\n        {\n          role: \'user\',\n          content: `ä»¥ä¸‹æ˜¯ç°æœ‰çš„è§’è‰²å¡ï¼š\n\n${characterCardOutput.value}\n\n---\n\nè¯·æ ¹æ®ä»¥ä¸‹ä¿®æ”¹éœ€æ±‚è°ƒæ•´è§’è‰²å¡ï¼š\n${modifyRequest.value}`,\n        },\n      ],\n    };\n\n    let modifiedCard: string;\n\n    if (enableCharacterStreaming.value) {\n      // æµå¼ç”Ÿæˆ\n      modifiedCard = await generateWithStreaming(requestPayload, characterProgressPercent);\n    } else {\n      // éæµå¼ç”Ÿæˆ\n      const apiUrl = normalizeApiEndpoint(settings.value.api_endpoint);\n      const response = await fetch(apiUrl, {\n        method: \'POST\',\n        headers: {\n          \'Content-Type\': \'application/json\',\n          Authorization: `Bearer ${settings.value.api_key}`,\n        },\n        body: JSON.stringify(requestPayload),\n      });\n\n      if (!response.ok) {\n        throw new Error(`HTTP error! status: ${response.status}`);\n      }\n\n      const data = await response.json();\n      modifiedCard = data.choices[0].message.content.trim();\n      characterProgressPercent.value = 100;\n    }\n\n    characterCardOutput.value = modifiedCard;\n    modifyRequest.value = \'\'; // æ¸…ç©ºä¿®æ”¹éœ€æ±‚\n    saveToolsDataImmediate(); // ç«‹å³ä¿å­˜ç»“æœ\n\n    window.toastr.success(\'è§’è‰²å¡ä¿®æ”¹å®Œæˆï¼\');\n  } catch (error) {\n    console.error(\'è§’è‰²å¡ä¿®æ”¹å¤±è´¥:\', error);\n    window.toastr.error(\'ä¿®æ”¹å¤±è´¥ï¼š\' + (error as Error).message);\n  } finally {\n    isModifyingCharacter.value = false;\n    characterProgressPercent.value = 0;\n  }\n};\n\n// æ¸…ç©ºä¿®æ”¹éœ€æ±‚\nconst clearModifyRequest = () => {\n  modifyRequest.value = \'\';\n  saveToolsDataImmediate(); // ç«‹å³ä¿å­˜\n  window.toastr.success(\'ä¿®æ”¹éœ€æ±‚å·²æ¸…ç©º\');\n};\n\n// ==================== é€šç”¨æµå¼ç”Ÿæˆè¾…åŠ©å‡½æ•° ====================\n\n// ä»æµå¼å“åº”ä¸­æå–å†…å®¹\nconst extractStreamContent = (chunk: any): string | null => {\n  // OpenAI æ ¼å¼\n  if (chunk.choices?.[0]?.delta?.content) {\n    return chunk.choices[0].delta.content;\n  }\n  // Claude æ ¼å¼\n  if (chunk.delta?.text) {\n    return chunk.delta.text;\n  }\n  // ç›´æ¥å†…å®¹æ ¼å¼\n  if (typeof chunk.content === \'string\') {\n    return chunk.content;\n  }\n  if (typeof chunk.text === \'string\') {\n    return chunk.text;\n  }\n  if (typeof chunk.response === \'string\') {\n    return chunk.response;\n  }\n  return null;\n};\n\n// é€šç”¨æµå¼ç”Ÿæˆå‡½æ•°\nconst generateWithStreaming = async (\n  requestPayload: Record<string, any>,\n  progressRef: Ref<number>,\n): Promise<string> => {\n  const apiUrl = normalizeApiEndpoint(settings.value.api_endpoint);\n  const response = await fetch(apiUrl, {\n    method: \'POST\',\n    headers: {\n      \'Content-Type\': \'application/json\',\n      Authorization: `Bearer ${settings.value.api_key}`,\n    },\n    body: JSON.stringify(requestPayload),\n  });\n\n  if (!response.ok) {\n    const errorText = await response.text();\n    throw new Error(`æµå¼è¯·æ±‚å¤±è´¥ï¼š${response.status} ${response.statusText}\\n${errorText.slice(0, 400)}`);\n  }\n\n  if (!response.body) {\n    throw new Error(\'è¯¥ API æœªè¿”å›å¯è¯»æµï¼Œè¯·å…³é—­æµå¼æ¨¡å¼æˆ–æ£€æŸ¥ç«¯ç‚¹æ”¯æŒæƒ…å†µ\');\n  }\n\n  const reader = response.body.getReader();\n  const decoder = new TextDecoder(\'utf-8\');\n  let buffer = \'\';\n  let done = false;\n  let result = \'\';\n\n  progressRef.value = 0;\n\n  const processLine = (line: string): boolean => {\n    const trimmed = line.trim();\n    if (!trimmed) {\n      return false;\n    }\n\n    if (trimmed === \'data: [DONE]\' || trimmed === \'[DONE]\') {\n      return true;\n    }\n\n    const payloadText = trimmed.startsWith(\'data:\') ? trimmed.slice(5).trim() : trimmed;\n    if (!payloadText || payloadText === \'[DONE]\') {\n      return false;\n    }\n\n    try {\n      const payloadJson = JSON.parse(payloadText);\n      const deltaText = extractStreamContent(payloadJson);\n      if (deltaText) {\n        result += deltaText;\n        progressRef.value = Math.min(progressRef.value + 2, 98);\n      }\n    } catch (parseError) {\n      console.warn(\'æ— æ³•è§£ææµå¼æ•°æ®å—:\', payloadText.slice(0, 100), parseError);\n    }\n\n    return false;\n  };\n\n  while (!done) {\n    const { value, done: readerDone } = await reader.read();\n    if (value) {\n      buffer += decoder.decode(value, { stream: true });\n      const lines = buffer.split(\'\\n\');\n      buffer = lines.pop() ?? \'\';\n      for (const line of lines) {\n        if (processLine(line)) {\n          done = true;\n          break;\n        }\n      }\n    }\n\n    if (readerDone) {\n      done = true;\n    }\n  }\n\n  if (buffer && !done) {\n    processLine(buffer);\n  }\n\n  progressRef.value = 100;\n  return result;\n};\n\n// ==================== ä¸–ç•Œä¹¦æ¡ç›®ç”Ÿæˆå·¥å…· ====================\n\n// ç”Ÿæˆä¸–ç•Œä¹¦æ¡ç›®\nconst handleGenerateWorldbookEntry = async () => {\n  if (!worldbookDescription.value.trim()) {\n    window.toastr.warning(\'è¯·è¾“å…¥æ¡ç›®æè¿°\');\n    return;\n  }\n\n  try {\n    isGeneratingWorldbook.value = true;\n    worldbookProgressPercent.value = 0;\n    window.toastr.info(\'AIæ­£åœ¨ç”Ÿæˆä¸–ç•Œä¹¦æ¡ç›®ï¼Œè¯·ç¨å€™...\', \'\', { timeOut: 15000 });\n\n    const requestPayload = {\n      model: settings.value.model || \'gpt-3.5-turbo\',\n      max_tokens: settings.value.max_tokens || 4000,\n      temperature: 0.7,\n      stream: enableWorldbookStreaming.value,\n      messages: [\n        {\n          role: \'system\',\n          content: `ä½ æ˜¯ä¸€ä¸ªä¸–ç•Œä¹¦æ¡ç›®ç”ŸæˆåŠ©æ‰‹ã€‚ç”¨æˆ·ä¼šæè¿°ä»–ä»¬æƒ³è¦çš„ä¸–ç•Œä¹¦æ¡ç›®å†…å®¹ï¼Œä½ éœ€è¦ç”Ÿæˆç¬¦åˆ SillyTavern ä¸–ç•Œä¹¦æ ¼å¼çš„ JSON æ•°æ®ã€‚\n\n**ä¸–ç•Œä¹¦æ¡ç›®çš„ç»“æ„**ï¼š\n\\`\\`\\`typescript\n{\n  "name": "æ¡ç›®åç§°",\n  "enabled": true,\n  "strategy": {\n    "type": "selective",  // "constant"(è“ç¯-å¸¸é‡) æˆ– "selective"(ç»¿ç¯-å¯é€‰é¡¹)\n    "keys": ["å…³é”®å­—1", "å…³é”®å­—2"],  // ä¸»è¦å…³é”®å­—æ•°ç»„\n    "keys_secondary": {\n      "logic": "and_any",  // "and_any" | "and_all" | "not_all" | "not_any"\n      "keys": []  // æ¬¡è¦å…³é”®å­—æ•°ç»„ï¼Œé€šå¸¸ç•™ç©º\n    },\n    "scan_depth": "same_as_global"  // æˆ–è€…å…·ä½“æ•°å­—å¦‚ 10\n  },\n  "position": {\n    "type": "after_character_definition",  // å¸¸è§: "after_character_definition" | "at_depth"\n    "role": "system",  // "system" | "assistant" | "user"\n    "depth": 4,\n    "order": 100\n  },\n  "content": "æ¡ç›®çš„å®é™…å†…å®¹æ–‡æœ¬",\n  "probability": 100,  // æ¿€æ´»æ¦‚ç‡ï¼Œé€šå¸¸æ˜¯ 100\n  "recursion": {\n    "prevent_incoming": false,\n    "prevent_outgoing": false,\n    "delay_until": null\n  },\n  "effect": {\n    "sticky": null,\n    "cooldown": null,\n    "delay": null\n  }\n}\n\\`\\`\\`\n\n**ç”ŸæˆåŸåˆ™**ï¼š\n1. **åç§° (name)**ï¼šç®€æ´æ˜ç¡®ï¼Œåæ˜ æ¡ç›®ä¸»é¢˜ï¼ˆå¦‚è§’è‰²åã€åœ°ç‚¹åã€ç‰©å“åï¼‰\n2. **æ¿€æ´»ç­–ç•¥ (strategy.type)**ï¼š\n   - å¦‚æœæ˜¯éœ€è¦æ ¹æ®å…³é”®å­—æ¿€æ´»çš„å†…å®¹ï¼ˆå¦‚è§’è‰²ã€åœ°ç‚¹ã€ç‰©å“ï¼‰ï¼Œä½¿ç”¨ "selective" (ç»¿ç¯)\n   - å¦‚æœæ˜¯åº”è¯¥å§‹ç»ˆç”Ÿæ•ˆçš„è®¾å®šï¼ˆå¦‚ä¸–ç•Œè§‚è§„åˆ™ã€åŸºç¡€è®¾å®šï¼‰ï¼Œä½¿ç”¨ "constant" (è“ç¯)\n3. **å…³é”®å­— (strategy.keys)**ï¼š\n   - æå–ä¸å†…å®¹ç›¸å…³çš„æ ¸å¿ƒå…³é”®å­—\n   - åŒ…å«åç§°ã€åˆ«åã€ç›¸å…³æ¦‚å¿µ\n   - é€šå¸¸ 3-6 ä¸ªå…³é”®å­—\n4. **å†…å®¹ (content)**ï¼š\n   - **åŠ¡å¿…åŒ…å«ç”¨æˆ·æä¾›çš„æ‰€æœ‰è¯¦ç»†ä¿¡æ¯**\n   - ç»“æ„åŒ–ã€ç®€æ´ã€ä¿¡æ¯å¯†åº¦é«˜\n   - ä½¿ç”¨é™ˆè¿°å¼è‚¯å®šè¯­å¥ï¼Œé¿å…å…«è‚¡ä¿®è¾\n   - å¦‚æœç”¨æˆ·æä¾›äº†å…·ä½“è®¾å®šï¼ˆå¹´é¾„ã€æ€§åˆ«ã€èŒä¸šã€å®¶åº­èƒŒæ™¯ç­‰ï¼‰ï¼Œ**å¿…é¡»å…¨éƒ¨ä½“ç°åœ¨ content ä¸­**\n   - å¯ä»¥é€‚å½“è¡¥å……åˆç†çš„ç»†èŠ‚ï¼Œä½†**ä¸èƒ½é—æ¼ç”¨æˆ·æ˜ç¡®æä¾›çš„ä¿¡æ¯**\n5. **ä½ç½® (position.type)**ï¼š\n   - é€šå¸¸ä½¿ç”¨ "after_character_definition"ï¼ˆåœ¨è§’è‰²å®šä¹‰ä¹‹åï¼‰\n   - ç‰¹æ®Šæƒ…å†µå¯ä½¿ç”¨ "at_depth" æŒ‡å®šæ·±åº¦\n6. **å…¶ä»–å­—æ®µä¿æŒé»˜è®¤å€¼å³å¯**\n\n**ç¤ºä¾‹ 1ï¼šè§’è‰²æ¡ç›®**\nç”¨æˆ·æè¿°ï¼š"åˆ›å»ºè§’è‰²ã€æ—æ½œã€‘çš„æ¡ç›®ï¼Œ16å²ï¼Œç”·ï¼Œé«˜ä¸­ç”Ÿï¼Œæ™®é€šå®¶åº­"\nè¾“å‡ºï¼š\n\\`\\`\\`json\n{\n  "name": "æ—æ½œ",\n  "enabled": true,\n  "strategy": {\n    "type": "selective",\n    "keys": ["æ—æ½œ", "æ—", "æ½œ"],\n    "keys_secondary": { "logic": "and_any", "keys": [] },\n    "scan_depth": "same_as_global"\n  },\n  "position": {\n    "type": "after_character_definition",\n    "role": "system",\n    "depth": 4,\n    "order": 100\n  },\n  "content": "æ—æ½œï¼Œç”·æ€§ï¼Œ16å²ï¼Œç›®å‰å°±è¯»é«˜ä¸­ã€‚å‡ºèº«äºæ™®é€šå®¶åº­ï¼Œå®¶åº­ç»æµçŠ¶å†µä¸­ç­‰ã€‚æ€§æ ¼è¾ƒä¸ºå†…å‘ï¼Œåœ¨å­¦æ ¡æˆç»©ä¸­ç­‰åä¸Šã€‚å¹³æ—¶å–œæ¬¢ç‹¬è‡ªæ€è€ƒï¼Œä¸å¤ªæ“…é•¿ä¸äººäº¤é™…ã€‚",\n  "probability": 100,\n  "recursion": {\n    "prevent_incoming": false,\n    "prevent_outgoing": false,\n    "delay_until": null\n  },\n  "effect": {\n    "sticky": null,\n    "cooldown": null,\n    "delay": null\n  }\n}\n\\`\\`\\`\n\n**ç¤ºä¾‹ 2ï¼šåœ°ç‚¹æ¡ç›®**\nç”¨æˆ·æè¿°ï¼š"åˆ›å»ºä¸€ä¸ªå…³äºé­”æ³•å­¦é™¢çš„æ¡ç›®ï¼ŒåŒ…å«å­¦é™¢å†å²å’Œè§„åˆ™"\nè¾“å‡ºï¼š\n\\`\\`\\`json\n{\n  "name": "æ˜Ÿè¾‰é­”æ³•å­¦é™¢",\n  "enabled": true,\n  "strategy": {\n    "type": "selective",\n    "keys": ["æ˜Ÿè¾‰é­”æ³•å­¦é™¢", "é­”æ³•å­¦é™¢", "å­¦é™¢", "æ˜Ÿè¾‰"],\n    "keys_secondary": { "logic": "and_any", "keys": [] },\n    "scan_depth": "same_as_global"\n  },\n  "position": {\n    "type": "after_character_definition",\n    "role": "system",\n    "depth": 4,\n    "order": 100\n  },\n  "content": "æ˜Ÿè¾‰é­”æ³•å­¦é™¢æ˜¯ä¸€æ‰€å†å²æ‚ ä¹…çš„é­”æ³•æ•™è‚²æœºæ„ï¼Œå»ºç«‹äºä¸‰ç™¾å¹´å‰ã€‚å­¦é™¢åè½åœ¨æµ®ç©ºå²›ä¸Šï¼Œå…±æœ‰ä¸ƒåº§é«˜å¡”ï¼Œåˆ†åˆ«å¯¹åº”ä¸ƒå¤§é­”æ³•æµæ´¾ï¼šå…ƒç´ ã€å¿ƒçµã€è½¬åŒ–ã€å¬å”¤ã€é¢„è¨€ã€é˜²æŠ¤ã€å¹»æœ¯ã€‚å­¦é™¢å®è¡Œå­¦åˆ†åˆ¶ï¼Œå­¦ç”Ÿéœ€è¦å®ŒæˆåŸºç¡€è¯¾ç¨‹å’Œä¸“ç²¾è¯¾ç¨‹æ‰èƒ½æ¯•ä¸šã€‚å­¦é™¢è§„åˆ™ä¸¥æ ¼ï¼šç¦æ­¢åœ¨æ•™å­¦åŒºåŸŸæ–½å±•æœªç»è®¸å¯çš„é­”æ³•ï¼Œç¦æ­¢æ“…è‡ªè¿›å…¥ç¦ä¹¦åŒºï¼Œç¦æ­¢ç§ä¸‹å†³æ–—ã€‚",\n  "probability": 100,\n  "recursion": {\n    "prevent_incoming": false,\n    "prevent_outgoing": false,\n    "delay_until": null\n  },\n  "effect": {\n    "sticky": null,\n    "cooldown": null,\n    "delay": null\n  }\n}\n\\`\\`\\`\n\n**é‡è¦**ï¼š\n- åªè¾“å‡º JSON æ•°æ®ï¼Œä¸è¦æ·»åŠ ä»»ä½•è§£é‡Š\n- ç¡®ä¿ JSON æ ¼å¼æ­£ç¡®ï¼Œå¯ä»¥è¢«è§£æ\n- **content å­—æ®µå¿…é¡»åŒ…å«ç”¨æˆ·æä¾›çš„æ‰€æœ‰è¯¦ç»†ä¿¡æ¯ï¼Œä¸èƒ½é—æ¼**\n- å¦‚æœç”¨æˆ·ç»™å‡ºäº†å¤šä¸ªå±æ€§ï¼ˆå¹´é¾„ã€æ€§åˆ«ã€èŒä¸šç­‰ï¼‰ï¼Œæ¯ä¸ªéƒ½è¦åœ¨ content ä¸­æ˜ç¡®ä½“ç°\n- æ ¹æ®ç”¨æˆ·æè¿°çš„å†…å®¹ç±»å‹ï¼Œæ™ºèƒ½é€‰æ‹© strategy.type`,\n        },\n        {\n          role: \'user\',\n          content: worldbookDescription.value,\n        },\n      ],\n    };\n\n    let generatedText: string;\n\n    if (enableWorldbookStreaming.value) {\n      // æµå¼ç”Ÿæˆ\n      generatedText = await generateWithStreaming(requestPayload, worldbookProgressPercent);\n    } else {\n      // éæµå¼ç”Ÿæˆ\n      const apiUrl = normalizeApiEndpoint(settings.value.api_endpoint);\n      const response = await fetch(apiUrl, {\n        method: \'POST\',\n        headers: {\n          \'Content-Type\': \'application/json\',\n          Authorization: `Bearer ${settings.value.api_key}`,\n        },\n        body: JSON.stringify(requestPayload),\n      });\n\n      if (!response.ok) {\n        throw new Error(`HTTP error! status: ${response.status}`);\n      }\n\n      const data = await response.json();\n      generatedText = data.choices[0].message.content.trim();\n      worldbookProgressPercent.value = 100;\n    }\n\n    // å°è¯•è§£æ JSON\n    try {\n      // æå– JSON éƒ¨åˆ†ï¼ˆå¦‚æœæœ‰ä»£ç å—åŒ…è£¹ï¼‰\n      const jsonMatch = generatedText.match(/```(?:json)?\\s*([\\s\\S]*?)```/) || [null, generatedText];\n      const jsonText = jsonMatch[1] || generatedText;\n\n      const parsedEntry = JSON.parse(jsonText);\n      worldbookEntryOutput.value = parsedEntry;\n      saveToolsDataImmediate(); // ç«‹å³ä¿å­˜ç»“æœ\n\n      window.toastr.success(\'ä¸–ç•Œä¹¦æ¡ç›®ç”Ÿæˆå®Œæˆï¼\');\n    } catch (parseError) {\n      console.error(\'JSON è§£æå¤±è´¥:\', parseError);\n      console.log(\'åŸå§‹å“åº”:\', generatedText);\n      window.toastr.error(\'ç”Ÿæˆçš„å†…å®¹æ ¼å¼é”™è¯¯ï¼Œè¯·é‡è¯•\');\n    }\n  } catch (error) {\n    console.error(\'ä¸–ç•Œä¹¦æ¡ç›®ç”Ÿæˆå¤±è´¥:\', error);\n    window.toastr.error(\'ç”Ÿæˆå¤±è´¥ï¼š\' + (error as Error).message);\n  } finally {\n    isGeneratingWorldbook.value = false;\n    worldbookProgressPercent.value = 0;\n  }\n};\n\n// æ¸…ç©ºä¸–ç•Œä¹¦è¡¨å•\nconst clearWorldbookForm = () => {\n  worldbookDescription.value = \'\';\n  worldbookEntryOutput.value = null;\n  selectedWorldbook.value = \'\';\n  worldbookModifyRequest.value = \'\';\n  saveToolsDataImmediate(); // ç«‹å³ä¿å­˜\n  window.toastr.success(\'å†…å®¹å·²æ¸…ç©º\');\n};\n\n// æ’å…¥æ¡ç›®åˆ°ä¸–ç•Œä¹¦\nconst handleInsertEntry = async () => {\n  if (!selectedWorldbook.value) {\n    window.toastr.warning(\'è¯·é€‰æ‹©ç›®æ ‡ä¸–ç•Œä¹¦\');\n    return;\n  }\n\n  if (!worldbookEntryOutput.value) {\n    window.toastr.warning(\'æ²¡æœ‰å¯æ’å…¥çš„æ¡ç›®\');\n    return;\n  }\n\n  try {\n    isInsertingEntry.value = true;\n    window.toastr.info(`æ­£åœ¨æ’å…¥æ¡ç›®åˆ°ã€Œ${selectedWorldbook.value}ã€...`);\n\n    // ä½¿ç”¨ createWorldbookEntries æ’å…¥æ¡ç›®\n    await createWorldbookEntries(selectedWorldbook.value, [worldbookEntryOutput.value], { render: \'immediate\' });\n\n    window.toastr.success(`âœ… æ¡ç›®å·²æˆåŠŸæ’å…¥åˆ°ã€Œ${selectedWorldbook.value}ã€`);\n  } catch (error) {\n    console.error(\'æ’å…¥æ¡ç›®å¤±è´¥:\', error);\n    window.toastr.error(\'æ’å…¥å¤±è´¥ï¼š\' + (error as Error).message);\n  } finally {\n    isInsertingEntry.value = false;\n  }\n};\n\n// å¤åˆ¶ä¸–ç•Œä¹¦æ¡ç›® JSON\nconst copyWorldbookEntry = () => {\n  if (!worldbookEntryOutput.value) {\n    window.toastr.warning(\'æ²¡æœ‰å¯å¤åˆ¶çš„å†…å®¹\');\n    return;\n  }\n\n  const jsonText = JSON.stringify(worldbookEntryOutput.value, null, 2);\n  copyToClipboard(jsonText, \'ä¸–ç•Œä¹¦æ¡ç›® JSON å·²å¤åˆ¶åˆ°å‰ªè´´æ¿\');\n};\n\n// ä¿®æ”¹ä¸–ç•Œä¹¦æ¡ç›®\nconst handleModifyWorldbookEntry = async () => {\n  if (!worldbookModifyRequest.value.trim()) {\n    window.toastr.warning(\'è¯·è¾“å…¥ä¿®æ”¹éœ€æ±‚\');\n    return;\n  }\n\n  if (!worldbookEntryOutput.value) {\n    window.toastr.warning(\'æ²¡æœ‰å¯ä¿®æ”¹çš„æ¡ç›®ï¼Œè¯·å…ˆç”Ÿæˆæ¡ç›®\');\n    return;\n  }\n\n  try {\n    isModifyingWorldbook.value = true;\n    worldbookProgressPercent.value = 0;\n    window.toastr.info(\'AIæ­£åœ¨æ ¹æ®ä½ çš„éœ€æ±‚ä¿®æ”¹ä¸–ç•Œä¹¦æ¡ç›®ï¼Œè¯·ç¨å€™...\');\n\n    const requestPayload = {\n      model: settings.value.model || \'gpt-3.5-turbo\',\n      max_tokens: settings.value.max_tokens || 4000,\n      temperature: 0.7,\n      stream: enableWorldbookStreaming.value,\n      messages: [\n        {\n          role: \'system\',\n          content: `ä½ æ˜¯ä¸€ä¸ªä¸–ç•Œä¹¦æ¡ç›®ç¼–è¾‘åŠ©æ‰‹ã€‚ç”¨æˆ·ä¼šæä¾›ä¸€ä¸ªç°æœ‰çš„ä¸–ç•Œä¹¦æ¡ç›® JSON å’Œä¿®æ”¹éœ€æ±‚ï¼Œè¯·æ ¹æ®ä¿®æ”¹éœ€æ±‚è°ƒæ•´æ¡ç›®å†…å®¹ã€‚\n\n**ä¿®æ”¹åŸåˆ™**ï¼š\n1. å¿…é¡»ä¿æŒ JSON æ ¼å¼æ­£ç¡®\n2. åªä¿®æ”¹ç”¨æˆ·æ˜ç¡®è¦æ±‚ä¿®æ”¹çš„éƒ¨åˆ†\n3. ç¡®ä¿ä¿®æ”¹åçš„å†…å®¹ä¸åŸæœ‰æ¡ç›®é£æ ¼ä¸€è‡´\n4. å¦‚æœç”¨æˆ·çš„è¦æ±‚ä¸åŸæœ‰è®¾å®šå†²çªï¼Œä»¥ç”¨æˆ·çš„è¦æ±‚ä¸ºå‡†\n5. è¾“å‡ºå®Œæ•´çš„ä¿®æ”¹åçš„ JSONï¼Œä¸è¦æˆªæ–­\n6. ä¿æŒåŸæœ‰çš„å­—æ®µç»“æ„ï¼Œé™¤éç”¨æˆ·è¦æ±‚æ·»åŠ æˆ–åˆ é™¤å­—æ®µ\n\n**é‡è¦æ³¨æ„äº‹é¡¹**ï¼š\n- å¦‚æœä¿®æ”¹å†…å®¹ (content)ï¼ŒåŠ¡å¿…åŒ…å«ç”¨æˆ·è¦æ±‚çš„æ‰€æœ‰ä¿¡æ¯\n- å¦‚æœä¿®æ”¹å…³é”®å­— (keys)ï¼Œè¦ç¡®ä¿å…³é”®å­—ä¸å†…å®¹åŒ¹é…\n- ä¿æŒæ¿€æ´»ç­–ç•¥ (strategy.type) çš„åˆç†æ€§\n- åªè¾“å‡º JSON æ•°æ®ï¼Œä¸è¦æ·»åŠ ä»»ä½•è§£é‡Š\n\nè¯·è¾“å‡ºå®Œæ•´çš„ JSON æ ¼å¼ä¸–ç•Œä¹¦æ¡ç›®ã€‚`,\n        },\n        {\n          role: \'user\',\n          content: `ä»¥ä¸‹æ˜¯ç°æœ‰çš„ä¸–ç•Œä¹¦æ¡ç›®ï¼š\n\n${JSON.stringify(worldbookEntryOutput.value, null, 2)}\n\n---\n\nè¯·æ ¹æ®ä»¥ä¸‹ä¿®æ”¹éœ€æ±‚è°ƒæ•´æ¡ç›®ï¼š\n${worldbookModifyRequest.value}`,\n        },\n      ],\n    };\n\n    let generatedText: string;\n\n    if (enableWorldbookStreaming.value) {\n      // æµå¼ç”Ÿæˆ\n      generatedText = await generateWithStreaming(requestPayload, worldbookProgressPercent);\n    } else {\n      // éæµå¼ç”Ÿæˆ\n      const apiUrl = normalizeApiEndpoint(settings.value.api_endpoint);\n      const response = await fetch(apiUrl, {\n        method: \'POST\',\n        headers: {\n          \'Content-Type\': \'application/json\',\n          Authorization: `Bearer ${settings.value.api_key}`,\n        },\n        body: JSON.stringify(requestPayload),\n      });\n\n      if (!response.ok) {\n        throw new Error(`HTTP error! status: ${response.status}`);\n      }\n\n      const data = await response.json();\n      generatedText = data.choices[0].message.content.trim();\n      worldbookProgressPercent.value = 100;\n    }\n\n    // å°è¯•è§£æ JSON\n    try {\n      // æå– JSON éƒ¨åˆ†ï¼ˆå¦‚æœæœ‰ä»£ç å—åŒ…è£¹ï¼‰\n      const jsonMatch = generatedText.match(/```(?:json)?\\s*([\\s\\S]*?)```/) || [null, generatedText];\n      const jsonText = jsonMatch[1] || generatedText;\n\n      const parsedEntry = JSON.parse(jsonText);\n      worldbookEntryOutput.value = parsedEntry;\n      worldbookModifyRequest.value = \'\'; // æ¸…ç©ºä¿®æ”¹éœ€æ±‚\n      saveToolsDataImmediate(); // ç«‹å³ä¿å­˜ç»“æœ\n\n      window.toastr.success(\'ä¸–ç•Œä¹¦æ¡ç›®ä¿®æ”¹å®Œæˆï¼\');\n    } catch (parseError) {\n      console.error(\'JSON è§£æå¤±è´¥:\', parseError);\n      console.log(\'åŸå§‹å“åº”:\', generatedText);\n      window.toastr.error(\'ä¿®æ”¹çš„å†…å®¹æ ¼å¼é”™è¯¯ï¼Œè¯·é‡è¯•\');\n    }\n  } catch (error) {\n    console.error(\'ä¸–ç•Œä¹¦æ¡ç›®ä¿®æ”¹å¤±è´¥:\', error);\n    window.toastr.error(\'ä¿®æ”¹å¤±è´¥ï¼š\' + (error as Error).message);\n  } finally {\n    isModifyingWorldbook.value = false;\n    worldbookProgressPercent.value = 0;\n  }\n};\n\n// æ¸…ç©ºä¿®æ”¹éœ€æ±‚\nconst clearWorldbookModifyRequest = () => {\n  worldbookModifyRequest.value = \'\';\n  saveToolsDataImmediate(); // ç«‹å³ä¿å­˜\n  window.toastr.success(\'ä¿®æ”¹éœ€æ±‚å·²æ¸…ç©º\');\n};\n\n// ==================== ä¸–ç•Œä¹¦æŸ¥çœ‹å™¨ç›¸å…³å‡½æ•° ====================\n\n// åŠ è½½ä¸–ç•Œä¹¦æ¡ç›®\nconst loadWorldbookEntries = async () => {\n  if (!selectedViewerWorldbook.value) {\n    worldbookEntries.value = [];\n    return;\n  }\n\n  try {\n    const worldbook = await getWorldbook(selectedViewerWorldbook.value);\n    if (worldbook && Array.isArray(worldbook) && worldbook.length > 0) {\n      worldbookEntries.value = worldbook;\n      console.log(`âœ… å·²åŠ è½½ä¸–ç•Œä¹¦ "${selectedViewerWorldbook.value}" çš„ ${worldbookEntries.value.length} ä¸ªæ¡ç›®`);\n      window.toastr.success(`å·²åŠ è½½ ${worldbookEntries.value.length} ä¸ªæ¡ç›®`);\n    } else {\n      worldbookEntries.value = [];\n      window.toastr.info(\'è¯¥ä¸–ç•Œä¹¦æ²¡æœ‰æ¡ç›®\');\n    }\n  } catch (error) {\n    console.error(\'âŒ åŠ è½½ä¸–ç•Œä¹¦æ¡ç›®å¤±è´¥:\', error);\n    window.toastr.error(\'åŠ è½½å¤±è´¥ï¼š\' + (error as Error).message);\n    worldbookEntries.value = [];\n  }\n};\n\n// è®¡ç®—è¿‡æ»¤åçš„æ¡ç›®\nconst filteredWorldbookEntries = computed(() => {\n  let entries = [...worldbookEntries.value];\n\n  // æœç´¢è¿‡æ»¤\n  if (viewerSearchQuery.value.trim()) {\n    const query = viewerSearchQuery.value.toLowerCase();\n    entries = entries.filter(entry => {\n      const nameMatch = entry.name?.toLowerCase().includes(query);\n      const contentMatch = entry.content?.toLowerCase().includes(query);\n      const keysMatch = entry.strategy?.keys?.some(key => {\n        if (typeof key === \'string\') {\n          return key.toLowerCase().includes(query);\n        } else if (key instanceof RegExp) {\n          return key.toString().toLowerCase().includes(query);\n        }\n        return false;\n      });\n      return nameMatch || contentMatch || keysMatch;\n    });\n  }\n\n  // æ’åºè¿‡æ»¤\n  if (viewerSortBy.value === \'enabled\') {\n    entries = entries.filter(entry => entry.enabled);\n  } else if (viewerSortBy.value === \'disabled\') {\n    entries = entries.filter(entry => !entry.enabled);\n  }\n\n  return entries;\n});\n\n// åˆ‡æ¢æ¡ç›®å±•å¼€çŠ¶æ€\nconst toggleEntryExpanded = (index: number) => {\n  const current = entryExpandedState.value.get(index) || false;\n  entryExpandedState.value.set(index, !current);\n};\n\n// æ£€æŸ¥æ¡ç›®æ˜¯å¦å±•å¼€\nconst isEntryExpanded = (index: number) => {\n  return entryExpandedState.value.get(index) || false;\n};\n\n// ç¼–è¾‘ä¸–ç•Œä¹¦æ¡ç›®\nconst editWorldbookEntry = (entry: WorldbookEntry) => {\n  try {\n    // æ·±æ‹·è´æ¡ç›®æ•°æ®ï¼Œé¿å…ç›´æ¥ä¿®æ”¹åŸæ•°æ®\n    editingEntry.value = {\n      uid: entry.uid,\n      name: entry.name || \'\',\n      enabled: entry.enabled ?? true,\n      content: entry.content || \'\',\n      strategy: {\n        type: entry.strategy?.type || \'selective\',\n        keys: [...(entry.strategy?.keys || [])],\n        keys_secondary: {\n          logic: entry.strategy?.keys_secondary?.logic || \'and_any\',\n          keys: [...(entry.strategy?.keys_secondary?.keys || [])],\n        },\n        scan_depth: entry.strategy?.scan_depth || \'same_as_global\',\n      },\n      position: entry.position\n        ? {\n            type: entry.position.type || \'before_character_definition\',\n            role: entry.position.role || \'system\',\n            depth: entry.position.depth ?? 0,\n            order: entry.position.order ?? 0,\n          }\n        : {\n            type: \'before_character_definition\',\n            role: \'system\',\n            depth: 0,\n            order: 0,\n          },\n      probability: entry.probability ?? 100,\n      recursion: entry.recursion\n        ? {\n            prevent_incoming: entry.recursion.prevent_incoming ?? false,\n            prevent_outgoing: entry.recursion.prevent_outgoing ?? false,\n            delay_until: entry.recursion.delay_until ?? null,\n          }\n        : {\n            prevent_incoming: false,\n            prevent_outgoing: false,\n            delay_until: null,\n          },\n      effect: entry.effect\n        ? {\n            sticky: entry.effect.sticky ?? null,\n            cooldown: entry.effect.cooldown ?? null,\n            delay: entry.effect.delay ?? null,\n          }\n        : {\n            sticky: null,\n            cooldown: null,\n            delay: null,\n          },\n    };\n    editingEntryUid.value = entry.uid;\n    showEditDialog.value = true;\n  } catch (error) {\n    console.error(\'æ‰“å¼€ç¼–è¾‘ç•Œé¢å¤±è´¥:\', error);\n    window.toastr.error(\'æ‰“å¼€ç¼–è¾‘ç•Œé¢å¤±è´¥ï¼š\' + (error as Error).message);\n  }\n};\n\n// ä¿å­˜ç¼–è¾‘çš„æ¡ç›®\nconst saveEditedEntry = async () => {\n  if (!editingEntry.value.name?.trim()) {\n    window.toastr.warning(\'æ¡ç›®åç§°ä¸èƒ½ä¸ºç©º\');\n    return;\n  }\n\n  if (!editingEntryUid.value) {\n    window.toastr.error(\'æ¡ç›®IDä¸å­˜åœ¨\');\n    return;\n  }\n\n  try {\n    // ä½¿ç”¨ updateWorldbookWith API æ›´æ–°æ¡ç›®\n    const updatedWorldbook = await updateWorldbookWith(selectedViewerWorldbook.value, worldbook => {\n      const entryIndex = worldbook.findIndex(e => e.uid === editingEntryUid.value);\n      if (entryIndex !== -1) {\n        // æ›´æ–°æ¡ç›®\n        worldbook[entryIndex] = {\n          ...worldbook[entryIndex],\n          ...editingEntry.value,\n          uid: editingEntryUid.value, // ç¡®ä¿ UID ä¸å˜\n        } as WorldbookEntry;\n      }\n      return worldbook;\n    });\n\n    // æ›´æ–°æœ¬åœ°æ•°æ®\n    worldbookEntries.value = updatedWorldbook;\n\n    // å…³é—­å¯¹è¯æ¡†\n    showEditDialog.value = false;\n    editingEntry.value = {};\n    editingEntryUid.value = null;\n\n    window.toastr.success(\'æ¡ç›®å·²ä¿å­˜\');\n  } catch (error) {\n    console.error(\'ä¿å­˜æ¡ç›®å¤±è´¥:\', error);\n    window.toastr.error(\'ä¿å­˜å¤±è´¥ï¼š\' + (error as Error).message);\n  }\n};\n\n// åˆ é™¤ä¸–ç•Œä¹¦æ¡ç›®\nconst deleteWorldbookEntry = async (entry: WorldbookEntry) => {\n  if (!confirm(`ç¡®å®šè¦åˆ é™¤æ¡ç›® "${entry.name}" å—ï¼Ÿ`)) {\n    return;\n  }\n\n  try {\n    // ä½¿ç”¨ deleteWorldbookEntries API\n    const { worldbook } = await deleteWorldbookEntries(selectedViewerWorldbook.value, e => e.uid === entry.uid);\n\n    // é‡æ–°åŠ è½½åˆ—è¡¨\n    worldbookEntries.value = worldbook;\n\n    window.toastr.success(`å·²åˆ é™¤æ¡ç›® "${entry.name}"`);\n  } catch (error) {\n    console.error(\'åˆ é™¤æ¡ç›®å¤±è´¥:\', error);\n    window.toastr.error(\'åˆ é™¤å¤±è´¥ï¼š\' + (error as Error).message);\n  }\n};\n<\/script>\n\n<style scoped>\n.tools-tab {\n  height: 100%;\n  overflow-y: auto;\n  padding: 25px !important;\n}\n\n.section-header {\n  display: flex;\n  align-items: center;\n  justify-content: space-between;\n  padding: 15px 20px;\n  background: linear-gradient(135deg, #2a2a2a 0%, #3a3a3a 100%);\n  border-radius: 8px;\n  cursor: pointer;\n  transition: all 0.3s ease;\n  margin-bottom: 15px;\n  border: 1px solid #3a3a3a;\n}\n\n.section-header:hover {\n  background: linear-gradient(135deg, #3a3a3a 0%, #4a4a4a 100%);\n  transform: translateY(-1px);\n  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);\n}\n\n/* åå…«è‚¡å·¥å…·ç¾åŒ– */\n.section-header-anti-cliche {\n  background: linear-gradient(135deg, rgba(42, 42, 42, 0.95) 0%, rgba(58, 58, 58, 0.95) 100%) !important;\n  border: 1px solid rgba(255, 107, 107, 0.3) !important;\n  box-shadow:\n    0 2px 8px rgba(0, 0, 0, 0.2),\n    0 0 0 1px rgba(255, 107, 107, 0.1) inset !important;\n  backdrop-filter: blur(10px);\n}\n\n.section-header-anti-cliche:hover {\n  background: linear-gradient(135deg, rgba(255, 107, 107, 0.2) 0%, rgba(238, 90, 36, 0.2) 100%) !important;\n  border-color: rgba(255, 107, 107, 0.5) !important;\n  box-shadow:\n    0 4px 16px rgba(255, 107, 107, 0.3),\n    0 0 0 1px rgba(255, 107, 107, 0.2) inset !important;\n  transform: translateY(-2px) !important;\n}\n\n/* ä¸–ç•Œä¹¦æ¡ç›®ç”Ÿæˆå·¥å…·ç¾åŒ– */\n.section-header-worldbook {\n  background: linear-gradient(135deg, rgba(42, 42, 42, 0.95) 0%, rgba(58, 58, 58, 0.95) 100%) !important;\n  border: 1px solid rgba(255, 193, 7, 0.3) !important;\n  box-shadow:\n    0 2px 8px rgba(0, 0, 0, 0.2),\n    0 0 0 1px rgba(255, 193, 7, 0.1) inset !important;\n  backdrop-filter: blur(10px);\n}\n\n.section-header-worldbook:hover {\n  background: linear-gradient(135deg, rgba(255, 193, 7, 0.2) 0%, rgba(255, 152, 0, 0.2) 100%) !important;\n  border-color: rgba(255, 193, 7, 0.5) !important;\n  box-shadow:\n    0 4px 16px rgba(255, 193, 7, 0.3),\n    0 0 0 1px rgba(255, 193, 7, 0.2) inset !important;\n  transform: translateY(-2px) !important;\n}\n\n/* è§’è‰²å¡ç”Ÿæˆå·¥å…·ç¾åŒ– */\n.section-header-character {\n  background: linear-gradient(135deg, rgba(42, 42, 42, 0.95) 0%, rgba(58, 58, 58, 0.95) 100%) !important;\n  border: 1px solid rgba(23, 162, 184, 0.3) !important;\n  box-shadow:\n    0 2px 8px rgba(0, 0, 0, 0.2),\n    0 0 0 1px rgba(23, 162, 184, 0.1) inset !important;\n  backdrop-filter: blur(10px);\n}\n\n.section-header-character:hover {\n  background: linear-gradient(135deg, rgba(23, 162, 184, 0.2) 0%, rgba(19, 132, 150, 0.2) 100%) !important;\n  border-color: rgba(23, 162, 184, 0.5) !important;\n  box-shadow:\n    0 4px 16px rgba(23, 162, 184, 0.3),\n    0 0 0 1px rgba(23, 162, 184, 0.2) inset !important;\n  transform: translateY(-2px) !important;\n}\n\n/* å·¥å…·åŒºåŸŸæ•´ä½“ç¾åŒ– */\n.tool-section-anti-cliche,\n.tool-section-worldbook,\n.tool-section-character {\n  margin-bottom: 20px;\n  border-radius: 12px;\n  overflow: hidden;\n  background: rgba(26, 26, 26, 0.5);\n  backdrop-filter: blur(5px);\n}\n\n.tool-content {\n  background: #1e1e1e;\n  border: 1px solid #3a3a3a;\n  border-radius: 8px;\n  padding: 20px;\n  margin-bottom: 20px;\n}\n\n.tool-instructions {\n  background: #1a1a1a;\n  border: 1px solid #3a3a3a;\n  border-radius: 6px;\n  padding: 12px;\n  color: #ccc;\n  font-size: 12px;\n  margin-bottom: 15px;\n}\n\n.form-group {\n  margin-bottom: 15px;\n}\n\n.button-group {\n  display: flex;\n  gap: 12px;\n  margin-bottom: 20px;\n}\n\n.output-section {\n  margin-top: 20px;\n}\n\n.output-content {\n  background: #1e1e1e;\n  border: 1px solid #3a3a3a;\n  border-radius: 6px;\n  padding: 15px;\n  color: #e0e0e0;\n  font-size: 13px;\n  line-height: 1.6;\n  white-space: pre-wrap;\n  word-wrap: break-word;\n  max-height: 300px;\n  overflow-y: auto;\n}\n\n.output-actions {\n  margin-top: 12px;\n  display: flex;\n  gap: 12px;\n}\n\n/* æŒ‰é’®æ ·å¼ */\n.process-button,\n.clear-button,\n.generate-button,\n.copy-button {\n  position: relative;\n  overflow: hidden;\n  transition: all 0.3s ease;\n}\n\n.process-button:hover:not(:disabled),\n.clear-button:hover:not(:disabled),\n.generate-button:hover:not(:disabled),\n.copy-button:hover {\n  transform: translateY(-2px);\n  box-shadow: 0 6px 20px rgba(0, 0, 0, 0.3);\n}\n\n.copy-button:hover {\n  background: #218838 !important;\n}\n\n.tool-instructions {\n  background: #1a1a1a;\n  border: 1px solid #3a3a3a;\n  border-radius: 6px;\n  padding: 12px;\n  color: #ccc;\n  font-size: 12px;\n  margin-bottom: 15px;\n}\n\n/* ç¾åŒ–æŒ‰é’®çš„æ‚¬åœæ•ˆæœ */\n.process-button:hover:not(:disabled) .shimmer-effect,\n.clear-button:hover:not(:disabled) .shimmer-effect,\n.generate-button:hover:not(:disabled) .shimmer-effect,\n.copy-button:hover .shimmer-effect {\n  left: 100%;\n}\n\n.process-button:hover:not(:disabled) {\n  transform: translateY(-2px);\n  box-shadow: 0 6px 20px rgba(102, 126, 234, 0.4);\n}\n\n.clear-button:hover:not(:disabled) {\n  transform: translateY(-2px);\n  box-shadow: 0 6px 20px rgba(255, 107, 107, 0.4);\n}\n\n.generate-button:hover:not(:disabled) {\n  transform: translateY(-2px);\n  box-shadow: 0 6px 20px rgba(23, 162, 184, 0.4);\n}\n\n.copy-button:hover {\n  transform: translateY(-1px);\n  box-shadow: 0 5px 15px rgba(40, 167, 69, 0.4);\n}\n\n.process-button:disabled,\n.clear-button:disabled,\n.generate-button:disabled {\n  opacity: 0.6;\n  cursor: not-allowed;\n  transform: none;\n}\n\n.process-button:disabled:hover,\n.clear-button:disabled:hover,\n.generate-button:disabled:hover {\n  transform: none;\n  box-shadow: none;\n}\n\n/* æ»šåŠ¨æ¡æ ·å¼ */\n.output-content::-webkit-scrollbar {\n  width: 6px;\n}\n\n.output-content::-webkit-scrollbar-track {\n  background: #1a1a1a;\n  border-radius: 3px;\n}\n\n.output-content::-webkit-scrollbar-thumb {\n  background: #3a3a3a;\n  border-radius: 3px;\n}\n\n.output-content::-webkit-scrollbar-thumb:hover {\n  background: #4a4a4a;\n}\n\n/* å“åº”å¼è®¾è®¡ */\n@media (max-width: 768px) {\n  .button-group {\n    flex-direction: column;\n  }\n\n  .output-actions {\n    flex-direction: column;\n  }\n}\n</style>\n'],sourceRoot:''}]);const i=s},871:(e,n,t)=>{t.r(n),t.d(n,{default:()=>i});var a=t(790),o=t.n(a),r=t(54),s=t.n(r)()(o());s.push([e.id,'@keyframes fadeIn-3100a601{from{opacity:0}to{opacity:1}}@keyframes slideUp-3100a601{from{opacity:0;transform:translateY(30px)}to{opacity:1;transform:translateY(0)}}\n','',{version:3,sources:['webpack://./src/è®°å¿†_with_worldbook/components/GreetingsTab.vue'],names:[],mappings:'AAm5DA,2BACE,KACE,SACF,CACA,GACE,SACF,CACF,CAEA,4BACE,KACE,SAAU,CACV,0BACF,CACA,GACE,SAAU,CACV,uBACF,CACF',sourcesContent:['<template>\n  <div\n    class="greetings-tab"\n    style="display: flex; flex-direction: column; height: 100%; background: #1a1a1a !important"\n  >\n    \x3c!-- æ ‡é¢˜åŒºåŸŸ --\x3e\n    <div\n      class="section-header"\n      style="\n        display: flex;\n        justify-content: space-between;\n        align-items: center;\n        padding: 20px 25px !important;\n        border-bottom: 1px solid #3a3a3a;\n      "\n    >\n      <h3\n        style="\n          margin: 0;\n          color: #fff;\n          font-size: 15px !important;\n          font-weight: bold;\n          display: flex;\n          align-items: center;\n          gap: 8px;\n        "\n      >\n        <i class="fa-solid fa-comments" style="color: #667eea"></i>\n        å¼€åœºç™½ç®¡ç†å™¨\n      </h3>\n      <div class="header-actions" style="display: flex; align-items: center; gap: 10px">\n        <span\n          v-if="greetings.length > 0"\n          class="count-badge"\n          style="background: #667eea; color: white; padding: 4px 8px; border-radius: 12px; font-size: 12px"\n        >\n          {{ greetings.length }} ä¸ªå¼€åœºç™½\n        </span>\n        <button\n          v-if="greetings.length > 0"\n          class="mini-button"\n          style="\n            padding: 6px 12px;\n            background: #2a2a2a;\n            border: 1px solid #3a3a3a;\n            border-radius: 4px;\n            cursor: pointer;\n            font-size: 12px;\n            transition: all 0.2s;\n            display: flex;\n            align-items: center;\n            gap: 6px;\n          "\n          :style="{ color: showHelp ? \'#667eea\' : \'#e0e0e0\', borderColor: showHelp ? \'#667eea\' : \'#3a3a3a\' }"\n          @click="showHelp = !showHelp"\n        >\n          <i class="fa-solid fa-circle-question"></i> {{ showHelp ? \'éšè—å¸®åŠ©\' : \'æ˜¾ç¤ºå¸®åŠ©\' }}\n        </button>\n        <button\n          v-if="greetings.length > 0"\n          class="mini-button"\n          style="\n            padding: 6px 12px;\n            background: #dc2626;\n            border: none;\n            border-radius: 4px;\n            color: white;\n            cursor: pointer;\n            font-size: 12px;\n            font-weight: 600;\n            transition: all 0.2s;\n            display: flex;\n            align-items: center;\n            gap: 6px;\n          "\n          @click="clearAllConfig"\n          @mouseenter="($event.currentTarget as HTMLElement).style.transform = \'translateY(-2px)\'"\n          @mouseleave="($event.currentTarget as HTMLElement).style.transform = \'translateY(0)\'"\n        >\n          <i class="fa-solid fa-eraser"></i> æ¸…ç©ºé…ç½®\n        </button>\n        <button\n          v-if="greetings.length > 0"\n          class="mini-button"\n          style="\n            padding: 6px 12px;\n            background: linear-gradient(135deg, #fbbf24 0%, #f59e0b 100%);\n            border: none;\n            border-radius: 4px;\n            color: white;\n            cursor: pointer;\n            font-size: 12px;\n            font-weight: 600;\n            transition: all 0.2s;\n            display: flex;\n            align-items: center;\n            gap: 6px;\n          "\n          @click="showAiStyleDialog = true"\n          @mouseenter="($event.currentTarget as HTMLElement).style.transform = \'translateY(-2px)\'"\n          @mouseleave="($event.currentTarget as HTMLElement).style.transform = \'translateY(0)\'"\n        >\n          <i class="fa-solid fa-wand-magic-sparkles"></i> AIç”Ÿæˆç•Œé¢æ ·å¼\n        </button>\n        <button\n          class="mini-button refresh-button"\n          style="\n            padding: 6px 12px;\n            background: #2a2a2a;\n            border: 1px solid #3a3a3a;\n            border-radius: 4px;\n            color: #e0e0e0;\n            cursor: pointer;\n            font-size: 12px;\n            transition: all 0.2s;\n            display: flex;\n            align-items: center;\n            gap: 6px;\n          "\n          @click="loadConfig"\n        >\n          <i class="fa-solid fa-refresh"></i> åˆ·æ–°\n        </button>\n      </div>\n    </div>\n\n    \x3c!-- ä¸»å†…å®¹åŒºåŸŸï¼šå·¦å³ä¸¤æ  --\x3e\n    <div style="flex: 1; display: flex; gap: 20px; padding: 20px; overflow: hidden">\n      \x3c!-- å·¦ä¾§ï¼šé…ç½®åŒºåŸŸ --\x3e\n      <div style="flex: 1; overflow-y: auto; padding-right: 10px">\n        \x3c!-- ç©ºçŠ¶æ€ / ä½¿ç”¨è¯´æ˜ --\x3e\n        <div\n          v-if="greetings.length === 0"\n          style="\n            display: flex;\n            flex-direction: column;\n            align-items: center;\n            justify-content: center;\n            padding: 60px 20px;\n            text-align: center;\n            color: #888;\n          "\n        >\n          <i class="fa-solid fa-comment-dots" style="font-size: 64px; margin-bottom: 20px; opacity: 0.3"></i>\n          <div style="font-size: 18px; font-weight: 600; color: #e0e0e0; margin-bottom: 10px">æš‚æ— å¼€åœºç™½</div>\n          <div style="font-size: 14px; color: #888; max-width: 400px; line-height: 1.6">\n            è¯·åœ¨é…’é¦†ä¸­é€‰æ‹©ä¸€ä¸ªæœ‰å¼€åœºç™½çš„è§’è‰²å¡ï¼Œæˆ–ç‚¹å‡»ä¸Šæ–¹çš„åˆ·æ–°æŒ‰é’®\n          </div>\n        </div>\n\n        \x3c!-- ä½¿ç”¨è¯´æ˜ --\x3e\n        <div\n          v-else-if="showHelp"\n          style="background: #2a2a2a; border: 1px solid #667eea; border-radius: 8px; padding: 20px; margin-bottom: 20px"\n        >\n          <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px">\n            <h4 style="color: #667eea; margin: 0; display: flex; align-items: center; gap: 8px">\n              <i class="fa-solid fa-circle-info"></i>\n              ä½¿ç”¨è¯´æ˜\n            </h4>\n            <button\n              style="background: transparent; border: none; color: #888; cursor: pointer; font-size: 18px; padding: 4px"\n              @click="showHelp = false"\n            >\n              <i class="fa-solid fa-times"></i>\n            </button>\n          </div>\n          <ol style="color: #ccc; margin: 0; padding-left: 20px; line-height: 1.8">\n            <li>å·¥å…·ä¼šè‡ªåŠ¨è¯»å–å½“å‰è§’è‰²å¡çš„æ‰€æœ‰å¼€åœºç™½</li>\n            <li>ä¸ºæ¯ä¸ªå¼€åœºç™½è®¾ç½®å›¾æ ‡ã€æ ‡é¢˜å’Œæè¿°</li>\n            <li>ä½¿ç”¨AIç”Ÿæˆæè¿°åŠŸèƒ½ï¼Œæ ¹æ®å¼€åœºç™½å†…å®¹è‡ªåŠ¨ç”Ÿæˆå¸å¼•äººçš„æè¿°</li>\n            <li>ç‚¹å‡»"AIç”Ÿæˆç•Œé¢æ ·å¼"æŒ‰é’®ï¼Œæè¿°ä½ æƒ³è¦çš„é£æ ¼ï¼ˆå¦‚ï¼šæ·±è“è‰²èƒŒæ™¯ã€é‡‘è‰²æ ‡é¢˜ï¼‰</li>\n            <li>AIä¼šæ ¹æ®ä½ çš„æè¿°ç”Ÿæˆå®Œæ•´çš„HTMLæ ·å¼ä»£ç </li>\n            <li>å³ä¾§å®æ—¶é¢„è§ˆç”Ÿæˆçš„ç•Œé¢æ ·å¼æ•ˆæœ</li>\n            <li>ç‚¹å‡»"ç”Ÿæˆå‰ç«¯é€‰æ‹©ç•Œé¢ä»£ç "æŸ¥çœ‹å®Œæ•´ä»£ç </li>\n            <li>ç‚¹å‡»"ä¸‹è½½ä¸ºSTScript JSON"å¯¼å‡ºé…ç½®æ–‡ä»¶</li>\n            <li>åœ¨é…’é¦†ä¸­å¯¼å…¥JSONæ–‡ä»¶ï¼Œè¾“å…¥ /ã€å¼€åœºç™½ã€‘ ä½¿ç”¨</li>\n          </ol>\n          <div style="margin-top: 15px; padding-top: 15px; border-top: 1px solid #3a3a3a">\n            <p style="color: #888; font-size: 13px; margin: 0">\n              <i class="fa-solid fa-lightbulb" style="color: #ffc107"></i>\n              <strong>æç¤ºï¼š</strong>ç”Ÿæˆçš„åºå·å¯¹åº”è§’è‰²å¡ä¸­çš„å¼€åœºç™½åºå·ï¼ˆ0ä¸ºé»˜è®¤å¼€åœºç™½ï¼‰\n            </p>\n          </div>\n        </div>\n\n        \x3c!-- å¼€åœºç™½åˆ—è¡¨ --\x3e\n        <div v-else style="display: flex; flex-direction: column; gap: 15px">\n          <div\n            v-for="(greeting, index) in greetings"\n            :key="index"\n            class="greeting-item"\n            style="\n              background: #2a2a2a;\n              border: 1px solid #3a3a3a;\n              border-radius: 8px;\n              padding: 15px;\n              transition: all 0.3s ease;\n            "\n          >\n            \x3c!-- é¡¶éƒ¨ä¿¡æ¯æ  --\x3e\n            <div\n              style="\n                display: flex;\n                align-items: center;\n                gap: 10px;\n                margin-bottom: 12px;\n                padding-bottom: 10px;\n                border-bottom: 1px solid #3a3a3a;\n              "\n            >\n              <span\n                style="\n                  background: #667eea;\n                  color: white;\n                  padding: 4px 10px;\n                  border-radius: 6px;\n                  font-size: 12px;\n                  font-weight: bold;\n                  min-width: 35px;\n                  text-align: center;\n                "\n              >\n                #{{ index }}\n              </span>\n              <input\n                v-model="greeting.icon"\n                style="\n                  width: 60px;\n                  text-align: center;\n                  font-size: 20px;\n                  background: #1a1a1a;\n                  border: 1px solid #3a3a3a;\n                  border-radius: 6px;\n                  padding: 6px;\n                  color: #e0e0e0;\n                "\n                placeholder="å›¾æ ‡"\n                maxlength="4"\n                @input="saveConfig"\n              />\n              <input\n                v-model="greeting.title"\n                style="\n                  flex: 1;\n                  background: #1a1a1a;\n                  border: 1px solid #3a3a3a;\n                  border-radius: 6px;\n                  padding: 8px 12px;\n                  color: #e0e0e0;\n                  font-size: 14px;\n                "\n                :placeholder="index === 0 ? \'é»˜è®¤å¼€åœºç™½\' : `å¼€åœºç™½ ${index}`"\n                @input="saveConfig"\n              />\n              <button\n                style="\n                  background: linear-gradient(135deg, #fbbf24 0%, #f59e0b 100%);\n                  border: none;\n                  color: white;\n                  padding: 8px 16px;\n                  border-radius: 6px;\n                  cursor: pointer;\n                  transition: all 0.2s ease;\n                  display: flex;\n                  align-items: center;\n                  gap: 6px;\n                  font-size: 13px;\n                  font-weight: 600;\n                  box-shadow: 0 2px 8px rgba(251, 191, 36, 0.3);\n                "\n                title="æ ¹æ®å¼€åœºç™½å†…å®¹è‡ªåŠ¨ç”Ÿæˆæè¿°"\n                @click="generateDescription(index)"\n                @mouseenter="\n                  ($event.currentTarget as HTMLElement).style.transform = \'translateY(-2px)\';\n                  ($event.currentTarget as HTMLElement).style.boxShadow = \'0 4px 12px rgba(251, 191, 36, 0.5)\';\n                "\n                @mouseleave="\n                  ($event.currentTarget as HTMLElement).style.transform = \'translateY(0)\';\n                  ($event.currentTarget as HTMLElement).style.boxShadow = \'0 2px 8px rgba(251, 191, 36, 0.3)\';\n                "\n              >\n                <i class="fa-solid fa-wand-magic-sparkles"></i>\n                <span>AI ç”Ÿæˆæè¿°</span>\n              </button>\n              <button\n                v-if="greeting.description"\n                style="\n                  background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);\n                  border: none;\n                  color: white;\n                  padding: 8px 16px;\n                  border-radius: 6px;\n                  cursor: pointer;\n                  transition: all 0.2s ease;\n                  display: flex;\n                  align-items: center;\n                  gap: 6px;\n                  font-size: 13px;\n                  font-weight: 600;\n                  box-shadow: 0 2px 8px rgba(59, 130, 246, 0.3);\n                "\n                title="æ ¹æ®éœ€æ±‚ä¿®æ”¹å·²æœ‰æè¿°"\n                @click="editDescription(index)"\n                @mouseenter="\n                  ($event.currentTarget as HTMLElement).style.transform = \'translateY(-2px)\';\n                  ($event.currentTarget as HTMLElement).style.boxShadow = \'0 4px 12px rgba(59, 130, 246, 0.5)\';\n                "\n                @mouseleave="\n                  ($event.currentTarget as HTMLElement).style.transform = \'translateY(0)\';\n                  ($event.currentTarget as HTMLElement).style.boxShadow = \'0 2px 8px rgba(59, 130, 246, 0.3)\';\n                "\n              >\n                <i class="fa-solid fa-edit"></i>\n                <span>AI ç¼–è¾‘æè¿°</span>\n              </button>\n            </div>\n\n            \x3c!-- æè¿°è¾“å…¥æ¡† --\x3e\n            <textarea\n              v-model="greeting.description"\n              style="\n                width: 100%;\n                background: #1a1a1a;\n                border: 1px solid #3a3a3a;\n                border-radius: 6px;\n                padding: 10px;\n                color: #e0e0e0;\n                font-size: 13px;\n                font-family: inherit;\n                resize: vertical;\n                min-height: 60px;\n              "\n              placeholder="è¾“å…¥ç®€çŸ­æè¿°..."\n              @input="saveConfig"\n            >\n            </textarea>\n\n            \x3c!-- æŸ¥çœ‹åŸæ–‡æŒ‰é’® --\x3e\n            <button\n              style="\n                width: 100%;\n                padding: 10px;\n                background: transparent;\n                border: 1px solid #667eea;\n                border-radius: 6px;\n                color: #667eea;\n                font-size: 13px;\n                cursor: pointer;\n                transition: all 0.2s ease;\n                display: flex;\n                align-items: center;\n                justify-content: center;\n                gap: 6px;\n                margin-top: 10px;\n              "\n              @click="viewOriginalGreeting(index)"\n              @mouseenter="($event.currentTarget as HTMLElement).style.background = \'rgba(102, 126, 234, 0.1)\'"\n              @mouseleave="($event.currentTarget as HTMLElement).style.background = \'transparent\'"\n            >\n              <i class="fa-solid fa-file-lines"></i>\n              <span>æŸ¥çœ‹è§’è‰²å¡ä¸­çš„å¼€åœºç™½åŸæ–‡</span>\n            </button>\n          </div>\n        </div>\n\n        \x3c!-- åº•éƒ¨æ“ä½œæŒ‰é’® --\x3e\n        <div\n          v-if="greetings.length > 0"\n          style="\n            position: sticky;\n            bottom: 0;\n            padding: 20px;\n            background: linear-gradient(to top, #1a1a1a 80%, transparent);\n            border-top: 1px solid #3a3a3a;\n            display: flex;\n            justify-content: center;\n            gap: 15px;\n            margin-top: 20px;\n          "\n        >\n          <button\n            style="\n              padding: 15px 35px;\n              background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);\n              border: none;\n              border-radius: 10px;\n              color: white;\n              font-size: 15px;\n              font-weight: 600;\n              cursor: pointer;\n              transition: all 0.3s ease;\n              display: flex;\n              align-items: center;\n              gap: 10px;\n              box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);\n            "\n            @click="generateFrontendCode"\n            @mouseenter="\n              ($event.currentTarget as HTMLElement).style.transform = \'translateY(-3px)\';\n              ($event.currentTarget as HTMLElement).style.boxShadow = \'0 6px 20px rgba(102, 126, 234, 0.6)\';\n            "\n            @mouseleave="\n              ($event.currentTarget as HTMLElement).style.transform = \'translateY(0)\';\n              ($event.currentTarget as HTMLElement).style.boxShadow = \'0 4px 15px rgba(102, 126, 234, 0.4)\';\n            "\n          >\n            <i class="fa-solid fa-code" style="font-size: 16px"></i>\n            ç”ŸæˆHTMLä»£ç \n          </button>\n          <button\n            style="\n              padding: 15px 35px;\n              background: linear-gradient(135deg, #10b981 0%, #059669 100%);\n              border: none;\n              border-radius: 10px;\n              color: white;\n              font-size: 15px;\n              font-weight: 600;\n              cursor: pointer;\n              transition: all 0.3s ease;\n              display: flex;\n              align-items: center;\n              gap: 10px;\n              box-shadow: 0 4px 15px rgba(16, 185, 129, 0.4);\n            "\n            @click="downloadAsJson"\n            @mouseenter="\n              ($event.currentTarget as HTMLElement).style.transform = \'translateY(-3px)\';\n              ($event.currentTarget as HTMLElement).style.boxShadow = \'0 6px 20px rgba(16, 185, 129, 0.6)\';\n            "\n            @mouseleave="\n              ($event.currentTarget as HTMLElement).style.transform = \'translateY(0)\';\n              ($event.currentTarget as HTMLElement).style.boxShadow = \'0 4px 15px rgba(16, 185, 129, 0.4)\';\n            "\n          >\n            <i class="fa-solid fa-download" style="font-size: 16px"></i>\n            ä¸‹è½½ä¸ºSTScript JSON\n          </button>\n        </div>\n      </div>\n\n      \x3c!-- å³ä¾§ï¼šå®æ—¶é¢„è§ˆ --\x3e\n      <div\n        style="\n          flex: 1;\n          display: flex;\n          flex-direction: column;\n          background: #2a2a2a;\n          border-radius: 12px;\n          overflow: hidden;\n          border: 1px solid #3a3a3a;\n          box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);\n        "\n      >\n        <div\n          style="\n            padding: 15px 20px;\n            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);\n            border-bottom: 1px solid #3a3a3a;\n            display: flex;\n            justify-content: space-between;\n            align-items: center;\n          "\n        >\n          <h4\n            style="\n              margin: 0;\n              color: white;\n              font-size: 14px;\n              font-weight: 600;\n              display: flex;\n              align-items: center;\n              gap: 8px;\n            "\n          >\n            <i class="fa-solid fa-eye"></i>\n            å®æ—¶é¢„è§ˆ\n          </h4>\n          <button\n            v-if="previewHtml"\n            title="æ–°çª—å£æ‰“å¼€"\n            style="\n              width: 32px;\n              height: 32px;\n              background: rgba(255, 255, 255, 0.2);\n              border: none;\n              border-radius: 6px;\n              color: white;\n              font-size: 14px;\n              cursor: pointer;\n              transition: all 0.2s;\n              display: flex;\n              align-items: center;\n              justify-content: center;\n            "\n            @click="openPreviewInNewWindow"\n          >\n            <i class="fa-solid fa-external-link-alt"></i>\n          </button>\n        </div>\n        <div style="flex: 1; position: relative; overflow: hidden; background: #1e1e1e">\n          <iframe\n            v-if="previewHtml"\n            :srcdoc="previewHtml"\n            sandbox="allow-scripts allow-same-origin allow-modals allow-forms"\n            style="width: 100%; height: 100%; border: none; background: white"\n          ></iframe>\n          <div\n            v-else\n            style="\n              width: 100%;\n              height: 100%;\n              display: flex;\n              align-items: center;\n              justify-content: center;\n              color: #666;\n              font-size: 14px;\n              padding: 20px;\n              text-align: center;\n              line-height: 1.8;\n            "\n          >\n            <div>\n              <i class="fa-solid fa-eye-slash" style="font-size: 48px; margin-bottom: 15px; opacity: 0.3"></i>\n              <p style="margin: 0">é…ç½®å¼€åœºç™½åå°†æ˜¾ç¤ºé¢„è§ˆ</p>\n            </div>\n          </div>\n        </div>\n      </div>\n    </div>\n\n    \x3c!-- AIç”Ÿæˆå¯¹è¯æ¡† --\x3e\n    <AIGenerateDialog\n      :show="showAiGenerateDialog"\n      :is-generating="isGeneratingAi"\n      title="AI ç”Ÿæˆç®€çŸ­æè¿°"\n      description="AI æ­£åœ¨æ ¹æ®å¼€åœºç™½çš„å®é™…å†…å®¹è‡ªåŠ¨ç”Ÿæˆå¸å¼•äººçš„ç®€çŸ­æè¿°ï¼ˆ20-50å­—ï¼‰..."\n      :show-input="false"\n      @close="closeAiGenerateDialog"\n      @confirm="() => {}"\n    />\n\n    \x3c!-- AIç¼–è¾‘å¯¹è¯æ¡† --\x3e\n    <AIModifyDialog\n      :show="showAiEditDialog"\n      :is-modifying="isEditingAi"\n      title="AI ç¼–è¾‘ç®€çŸ­æè¿°"\n      description="æè¿°ä½ æƒ³è¦ä¿®æ”¹çš„åœ°æ–¹ï¼ŒAI ä¼šåœ¨å½“å‰æè¿°çš„åŸºç¡€ä¸Šè¿›è¡Œè°ƒæ•´ã€‚æ³¨æ„ï¼šä»…ä¿®æ”¹æè¿°ï¼Œä¸ä¼šæ”¹å˜å¼€åœºç™½å†…å®¹æœ¬èº«ã€‚"\n      :examples="[\'æ›´ç®€æ´ä¸€äº›\', \'æ›´æ–‡è‰ºä¸€äº›\', \'æ›´æ´»æ³¼ä¸€äº›\', \'æ·»åŠ æƒ…æ„Ÿè‰²å½©\']"\n      @close="showAiEditDialog = false"\n      @confirm="confirmEditDescription"\n    />\n\n    \x3c!-- AIç”Ÿæˆç•Œé¢æ ·å¼å¯¹è¯æ¡† --\x3e\n    <AIModifyDialog\n      :show="showAiStyleDialog"\n      :is-modifying="isGeneratingStyle"\n      title="AI ç”Ÿæˆå¼€åœºç™½ç•Œé¢æ ·å¼"\n      description="æè¿°ä½ æƒ³è¦çš„ç•Œé¢é£æ ¼ï¼ŒAI ä¼šç”Ÿæˆå®Œæ•´çš„HTMLæ ·å¼ä»£ç ã€‚ä¾‹å¦‚ï¼šæ·±è“è‰²èƒŒæ™¯ã€é‡‘è‰²æ ‡é¢˜ã€åœ†è§’å¡ç‰‡ç­‰ã€‚"\n      :examples="[\n        \'æ·±è“è‰²æ¸å˜èƒŒæ™¯ï¼Œç™½è‰²åœ†è§’å¡ç‰‡ï¼Œé‡‘è‰²æ ‡é¢˜\',\n        \'ç²‰è‰²å¯çˆ±é£æ ¼ï¼Œå¸¦é˜´å½±çš„å¡ç‰‡\',\n        \'æ·±è‰²ç§‘æŠ€é£æ ¼ï¼Œéœ“è™¹ç¯æ•ˆæœ\',\n        \'å…¸é›…é‡‘è‰²é£æ ¼ï¼Œé«˜è´µå¤§æ°”\',\n        \'æ¸¸æˆåƒç´ é£æ ¼ï¼Œæ–¹å½¢å¡ç‰‡\',\n      ]"\n      @close="showAiStyleDialog = false"\n      @confirm="generateStyleWithAI"\n    />\n\n    \x3c!-- æŸ¥çœ‹å¼€åœºç™½åŸæ–‡å¯¹è¯æ¡† --\x3e\n    <div\n      v-if="showOriginalDialog"\n      style="\n        position: fixed;\n        top: 0;\n        left: 0;\n        right: 0;\n        bottom: 0;\n        background: rgba(0, 0, 0, 0.7);\n        display: flex;\n        align-items: center;\n        justify-content: center;\n        z-index: 10000;\n        padding: 20px;\n      "\n      @click.self="showOriginalDialog = false"\n    >\n      <div\n        style="\n          background: linear-gradient(135deg, #1e3a8a 0%, #1e40af 100%);\n          border-radius: 12px;\n          padding: 24px;\n          max-width: 700px;\n          width: 100%;\n          max-height: 80vh;\n          display: flex;\n          flex-direction: column;\n          box-shadow: 0 8px 32px rgba(0, 0, 0, 0.5);\n        "\n        @click.stop\n      >\n        \x3c!-- æ ‡é¢˜æ  --\x3e\n        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px">\n          <h3 style="margin: 0; color: white; display: flex; align-items: center; gap: 8px">\n            <i class="fa-solid fa-file-lines"></i>\n            <span>å¼€åœºç™½åŸæ–‡</span>\n          </h3>\n          <button\n            style="\n              background: transparent;\n              border: none;\n              color: rgba(255, 255, 255, 0.7);\n              cursor: pointer;\n              font-size: 20px;\n              padding: 4px 8px;\n              transition: all 0.2s;\n            "\n            @click="showOriginalDialog = false"\n            @mouseenter="($event.currentTarget as HTMLElement).style.color = \'white\'"\n            @mouseleave="($event.currentTarget as HTMLElement).style.color = \'rgba(255, 255, 255, 0.7)\'"\n          >\n            <i class="fa-solid fa-times"></i>\n          </button>\n        </div>\n\n        \x3c!-- å†…å®¹åŒºåŸŸ --\x3e\n        <div\n          style="\n            background: #1a1a1a;\n            border-radius: 8px;\n            padding: 16px;\n            color: #e0e0e0;\n            font-size: 14px;\n            line-height: 1.6;\n            overflow-y: auto;\n            flex: 1;\n            white-space: pre-wrap;\n            word-wrap: break-word;\n          "\n        >\n          {{ originalGreetingContent }}\n        </div>\n\n        \x3c!-- åº•éƒ¨æŒ‰é’® --\x3e\n        <div style="display: flex; justify-content: flex-end; margin-top: 16px">\n          <button\n            style="\n              padding: 10px 24px;\n              background: white;\n              border: none;\n              border-radius: 6px;\n              color: #1e3a8a;\n              font-size: 14px;\n              font-weight: 600;\n              cursor: pointer;\n              transition: all 0.2s;\n            "\n            @click="showOriginalDialog = false"\n            @mouseenter="($event.currentTarget as HTMLElement).style.transform = \'translateY(-2px)\'"\n            @mouseleave="($event.currentTarget as HTMLElement).style.transform = \'translateY(0)\'"\n          >\n            å…³é—­\n          </button>\n        </div>\n      </div>\n    </div>\n\n    \x3c!-- ç”Ÿæˆä»£ç å¯¹è¯æ¡† --\x3e\n    <div\n      v-if="showCodeDialog"\n      style="\n        position: fixed;\n        top: 0;\n        left: 0;\n        right: 0;\n        bottom: 0;\n        background: rgba(0, 0, 0, 0.7);\n        display: flex;\n        align-items: center;\n        justify-content: center;\n        z-index: 10000;\n        backdrop-filter: blur(5px);\n      "\n      @click="closeCodeDialog"\n    >\n      <div\n        style="\n          background: #2a2a2a;\n          border-radius: 15px;\n          max-width: 800px;\n          width: 90%;\n          max-height: 80vh;\n          display: flex;\n          flex-direction: column;\n          box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);\n        "\n        @click.stop\n      >\n        <div\n          style="\n            padding: 20px;\n            border-bottom: 1px solid #3a3a3a;\n            display: flex;\n            justify-content: space-between;\n            align-items: center;\n          "\n        >\n          <h3 style="color: #e0e0e0; font-size: 18px; margin: 0; display: flex; align-items: center; gap: 10px">\n            <i class="fa-solid fa-code"></i>\n            ç”Ÿæˆçš„å‰ç«¯ä»£ç \n          </h3>\n          <button\n            style="\n              background: transparent;\n              border: none;\n              color: #888;\n              font-size: 20px;\n              cursor: pointer;\n              padding: 5px 10px;\n              transition: color 0.2s ease;\n            "\n            @click="closeCodeDialog"\n          >\n            <i class="fa-solid fa-times"></i>\n          </button>\n        </div>\n        <div style="padding: 20px; overflow-y: auto; flex: 1">\n          <div\n            style="\n              background: #1a1a1a;\n              border: 1px solid #3a3a3a;\n              border-radius: 8px;\n              padding: 15px;\n              margin-bottom: 20px;\n              color: #e0e0e0;\n            "\n          >\n            <p style="margin-bottom: 10px; font-weight: 600"><strong>ä½¿ç”¨æ–¹æ³•ï¼š</strong></p>\n            <ol style="margin-left: 20px; color: #aaa; line-height: 1.8">\n              <li>å¤åˆ¶ä¸‹é¢çš„ä»£ç </li>\n              <li>\n                åœ¨æ¶ˆæ¯ä¸­è¾“å…¥å ä½ç¬¦ï¼ˆå¦‚\n                <code style="background: #2a2a2a; padding: 2px 6px; border-radius: 4px; color: #667eea">ã€å¼€åœºç™½ã€‘</code\n                >ï¼‰\n              </li>\n              <li>åˆ›å»ºæ­£åˆ™è„šæœ¬ï¼Œå°†å ä½ç¬¦æ›¿æ¢ä¸ºæ­¤ä»£ç </li>\n            </ol>\n          </div>\n          <div\n            style="\n              background: #1a1a1a;\n              border: 1px solid #3a3a3a;\n              border-radius: 8px;\n              padding: 15px;\n              max-height: 400px;\n              overflow-y: auto;\n              margin-bottom: 15px;\n            "\n          >\n            <pre\n              style="margin: 0; white-space: pre-wrap; word-wrap: break-word"\n            ><code style="color: #e0e0e0; font-family: \'Consolas\', \'Monaco\', monospace; font-size: 12px; line-height: 1.6">{{ generatedCode }}</code></pre>\n          </div>\n          <button\n            style="\n              width: 100%;\n              background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);\n              color: white;\n              border: none;\n              padding: 12px;\n              border-radius: 8px;\n              font-size: 14px;\n              font-weight: 600;\n              cursor: pointer;\n              transition: all 0.3s ease;\n              display: flex;\n              align-items: center;\n              justify-content: center;\n              gap: 8px;\n            "\n            @click="copyCode"\n          >\n            <i class="fa-solid fa-copy"></i>\n            {{ copyButtonText }}\n          </button>\n        </div>\n      </div>\n    </div>\n  </div>\n</template>\n\n<script setup lang="ts">\nimport { klona } from \'klona\';\nimport { storeToRefs } from \'pinia\';\nimport toastr from \'toastr\';\nimport { onMounted, ref } from \'vue\';\nimport { z } from \'zod\';\nimport { useSettingsStore } from \'../settings\';\nimport { copyToClipboard } from \'../utils\';\nimport { normalizeApiEndpoint } from \'../utils/api\';\nimport AIGenerateDialog from \'./AIGenerateDialog.vue\';\nimport AIModifyDialog from \'./AIModifyDialog.vue\';\n\n// æ•°æ®ç»“æ„å®šä¹‰\nconst GreetingConfig = z.object({\n  icon: z.string().default(\'\'),\n  title: z.string().default(\'\'),\n  description: z.string().default(\'\'),\n});\n\ntype GreetingConfig = z.infer<typeof GreetingConfig>;\n\n// UIé…ç½®ï¼ˆä¿å­˜ç”Ÿæˆçš„HTMLä»£ç ï¼‰\nconst UIConfig = z.object({\n  customHtml: z.string().default(\'\'), // AIç”Ÿæˆçš„å®Œæ•´HTMLä»£ç \n});\n\ntype UIConfig = z.infer<typeof UIConfig>;\n\n// è·å–settings store\nconst settingsStore = useSettingsStore();\nconst { settings } = storeToRefs(settingsStore);\n\n// å“åº”å¼æ•°æ®\nconst greetings = ref<GreetingConfig[]>([]);\nconst uiConfig = ref<UIConfig>(UIConfig.parse({})); // UIé…ç½®\nconst showCodeDialog = ref(false);\nconst generatedCode = ref(\'\');\nconst copyButtonText = ref(\'å¤åˆ¶ä»£ç \');\nconst showAiGenerateDialog = ref(false);\nconst showAiEditDialog = ref(false);\nconst isGeneratingAi = ref(false);\nconst isEditingAi = ref(false);\nconst currentEditingIndex = ref(-1);\nconst showHelp = ref(false); // é»˜è®¤æŠ˜å å¸®åŠ©ä¿¡æ¯\nconst previewHtml = ref(\'\');\nconst currentCharacter = ref<any>(null);\nconst showOriginalDialog = ref(false);\nconst originalGreetingContent = ref(\'\');\nconst showAiStyleDialog = ref(false); // æ˜¾ç¤ºAIç”Ÿæˆæ ·å¼å¯¹è¯æ¡†\nconst isGeneratingStyle = ref(false); // æ­£åœ¨ç”Ÿæˆæ ·å¼\n\n// è·å–å½“å‰è§’è‰²å¡\nfunction getCurrentCharacter() {\n  try {\n    const char = getCharData(\'current\');\n    if (char) {\n      console.log(\'æ‰¾åˆ°è§’è‰²å¡:\', char.name);\n    } else {\n      console.log(\'æœªæ‰¾åˆ°è§’è‰²å¡\');\n    }\n    return char;\n  } catch (error) {\n    console.error(\'è·å–è§’è‰²å¡å¤±è´¥:\', error);\n    return null;\n  }\n}\n\n// åŠ è½½é…ç½®\nasync function loadConfig() {\n  try {\n    const character = getCurrentCharacter();\n    if (!character) {\n      greetings.value = [];\n      console.log(\'æœªæ‰¾åˆ°è§’è‰²å¡\');\n      return;\n    }\n\n    console.log(\'å½“å‰è§’è‰²å¡:\', character.name);\n\n    // è·å–è§’è‰²å¡çš„æ‰€æœ‰å¼€åœºç™½\n    const allGreetings = [character.first_mes, ...(character.data?.alternate_greetings || [])];\n    console.log(\'æ‰¾åˆ°\', allGreetings.length, \'ä¸ªå¼€åœºç™½\');\n\n    // ä»è§’è‰²å¡å˜é‡åŠ è½½é…ç½®\n    const savedConfig = getVariables({ type: \'character\' });\n    const configs = savedConfig?.greetings_config || [];\n    const savedUIConfig = savedConfig?.ui_config;\n\n    // åˆå§‹åŒ–å¼€åœºç™½é…ç½®\n    greetings.value = allGreetings.map((_, index) => {\n      const saved = configs[index];\n      return GreetingConfig.parse(saved || {});\n    });\n\n    // åˆå§‹åŒ–UIé…ç½®\n    uiConfig.value = UIConfig.parse(savedUIConfig || {});\n\n    console.log(\'å¼€åœºç™½é…ç½®å·²åŠ è½½:\', greetings.value.length, \'ä¸ª\');\n    console.log(\'UIé…ç½®å·²åŠ è½½, è‡ªå®šä¹‰HTMLé•¿åº¦:\', uiConfig.value.customHtml.length);\n    currentCharacter.value = character;\n    updatePreview();\n  } catch (error) {\n    console.error(\'åŠ è½½é…ç½®å¤±è´¥:\', error);\n    toastr.error(\'åŠ è½½é…ç½®å¤±è´¥: \' + (error as Error).message);\n  }\n}\n\n// ä¿å­˜é…ç½®\nfunction saveConfig() {\n  try {\n    replaceVariables(\n      {\n        greetings_config: klona(greetings.value),\n        ui_config: klona(uiConfig.value),\n      },\n      { type: \'character\' },\n    );\n    updatePreview(); // ä¿å­˜åæ›´æ–°é¢„è§ˆ\n  } catch (error) {\n    console.error(\'ä¿å­˜é…ç½®å¤±è´¥:\', error);\n  }\n}\n\n// æ¸…ç©ºæ‰€æœ‰å¼€åœºç™½é…ç½®ï¼ˆä¸å½±å“è§’è‰²å¡åŸæ–‡ï¼‰\nfunction clearAllConfig() {\n  if (\n    !confirm(\n      `ç¡®å®šè¦æ¸…ç©ºæ‰€æœ‰å¼€åœºç™½çš„é…ç½®å—ï¼Ÿ\\n\\nå½“å‰å…±æœ‰ ${greetings.value.length} ä¸ªå¼€åœºç™½ï¼Œæ¸…ç©ºåæ‰€æœ‰å›¾æ ‡ã€æ ‡é¢˜ã€æè¿°éƒ½å°†æ¢å¤é»˜è®¤ã€‚\\n\\nâš ï¸ æ­¤æ“ä½œä¸ä¼šåˆ é™¤è§’è‰²å¡çš„å¼€åœºç™½åŸæ–‡ï¼Œåªæ¸…ç©ºæ˜¾ç¤ºé…ç½®ï¼`,\n    )\n  ) {\n    return;\n  }\n\n  try {\n    // é‡ç½®æ‰€æœ‰å¼€åœºç™½é…ç½®ä¸ºé»˜è®¤å€¼\n    greetings.value = greetings.value.map(() => {\n      return GreetingConfig.parse({\n        icon: \'\',\n        title: \'\',\n        description: \'\',\n      });\n    });\n\n    // æ¸…ç©ºUIé…ç½®\n    uiConfig.value.customHtml = \'\';\n\n    // ä¿å­˜é…ç½®\n    saveConfig();\n\n    // å¼ºåˆ¶æ›´æ–°é¢„è§ˆï¼ˆåˆ‡æ¢åˆ°é»˜è®¤æ ·å¼ï¼‰\n    updatePreview();\n\n    toastr.success(\'å·²æ¸…ç©ºæ‰€æœ‰å¼€åœºç™½é…ç½®ï¼Œé¢„è§ˆå·²æ¢å¤é»˜è®¤æ ·å¼\');\n  } catch (error) {\n    console.error(\'æ¸…ç©ºé…ç½®å¤±è´¥:\', error);\n    toastr.error(\'æ¸…ç©ºå¤±è´¥: \' + (error as Error).message);\n  }\n}\n\n// æŸ¥çœ‹å¼€åœºç™½åŸæ–‡\nfunction viewOriginalGreeting(index: number) {\n  try {\n    const character = getCurrentCharacter();\n    if (!character) {\n      toastr.error(\'æœªæ‰¾åˆ°è§’è‰²å¡\');\n      return;\n    }\n\n    const allGreetings = [character.first_mes, ...(character.data?.alternate_greetings || [])];\n    const greetingContent = allGreetings[index] || \'\';\n\n    if (!greetingContent.trim()) {\n      toastr.warning(\'è¯¥å¼€åœºç™½å†…å®¹ä¸ºç©º\');\n      return;\n    }\n\n    originalGreetingContent.value = greetingContent;\n    showOriginalDialog.value = true;\n  } catch (error) {\n    console.error(\'æŸ¥çœ‹å¼€åœºç™½å¤±è´¥:\', error);\n    toastr.error(\'æŸ¥çœ‹å¼€åœºç™½å¤±è´¥: \' + (error as Error).message);\n  }\n}\n\n// å…³é—­AIç”Ÿæˆå¯¹è¯æ¡†\nfunction closeAiGenerateDialog() {\n  if (!isGeneratingAi.value) {\n    showAiGenerateDialog.value = false;\n  }\n}\n\n// AIç”Ÿæˆæè¿°\nasync function generateDescription(index: number) {\n  currentEditingIndex.value = index;\n\n  // æ˜¾ç¤ºè¿›åº¦å¯¹è¯æ¡†å¹¶å¼€å§‹ç”Ÿæˆ\n  showAiGenerateDialog.value = true;\n  isGeneratingAi.value = true;\n\n  const idx = index;\n  if (idx < 0 || idx >= greetings.value.length) {\n    isGeneratingAi.value = false;\n    showAiGenerateDialog.value = false;\n    return;\n  }\n\n  try {\n    // æ£€æŸ¥ API é…ç½®\n    if (!settings.value.api_endpoint || !settings.value.api_key) {\n      toastr.error(\'è¯·å…ˆåœ¨è®¾ç½®é¡µé¢é…ç½® API ç«¯ç‚¹å’Œ API Key\');\n      showAiGenerateDialog.value = false;\n      isGeneratingAi.value = false;\n      return;\n    }\n\n    // è·å–å¼€åœºç™½å†…å®¹\n    const character = getCurrentCharacter();\n    if (!character) {\n      toastr.error(\'æœªæ‰¾åˆ°è§’è‰²å¡\');\n      showAiGenerateDialog.value = false;\n      isGeneratingAi.value = false;\n      return;\n    }\n\n    const allGreetings = [character.first_mes, ...(character.data?.alternate_greetings || [])];\n    const greetingContent = allGreetings[idx] || \'\';\n\n    if (!greetingContent.trim()) {\n      toastr.warning(\'è¯¥å¼€åœºç™½å†…å®¹ä¸ºç©º\');\n      showAiGenerateDialog.value = false;\n      isGeneratingAi.value = false;\n      return;\n    }\n\n    // æ„å»ºæç¤ºè¯\n    const systemPrompt = `ä½ æ˜¯ä¸€ä¸ªä¸“ä¸šçš„æ–‡æ¡ˆç¼–è¾‘åŠ©æ‰‹ï¼Œæ“…é•¿ä¸ºå°è¯´ã€æ¸¸æˆç­‰åˆ›ä½œç®€æ´å¸å¼•äººçš„å¼€åœºç™½æè¿°ã€‚\n\nè¦æ±‚ï¼š\n1. æè¿°è¦ç®€æ´æœ‰åŠ›ï¼Œæ§åˆ¶åœ¨ 20-50 å­—ä»¥å†…\n2. çªå‡ºå¼€åœºç™½çš„æ ¸å¿ƒåœºæ™¯ã€æƒ…æ„Ÿæˆ–å†²çªç‚¹\n3. ä½¿ç”¨å¸å¼•äººçš„è¯­è¨€ï¼Œè®©è¯»è€…äº§ç”Ÿé˜…è¯»å…´è¶£\n4. ä¸è¦ä½¿ç”¨"è¿™æ˜¯ä¸€ä¸ª..."ã€"åœ¨è¿™ä¸ªå¼€åœºç™½ä¸­..."ç­‰å†—ä½™è¡¨è¿°\n5. ç›´æ¥è¾“å‡ºæè¿°æ–‡æœ¬ï¼Œä¸è¦æ·»åŠ å¼•å·æˆ–å…¶ä»–æ ‡è®°`;\n\n    const userPrompt = `è¯·ä¸ºä»¥ä¸‹å¼€åœºç™½å†…å®¹ç”Ÿæˆä¸€ä¸ªç®€æ´å¸å¼•äººçš„æè¿°ï¼š\n\n${greetingContent}\n\nç›´æ¥è¾“å‡ºæè¿°æ–‡æœ¬ï¼š`;\n\n    console.log(\'å¼€å§‹ AI ç”Ÿæˆæè¿°...\');\n\n    // è§„èŒƒåŒ– API ç«¯ç‚¹\n    const apiUrl = normalizeApiEndpoint(settings.value.api_endpoint, \'/chat/completions\');\n    console.log(\'ğŸ”— è§„èŒƒåŒ–åçš„ç«¯ç‚¹:\', apiUrl);\n\n    // è°ƒç”¨ AI API\n    const response = await fetch(apiUrl, {\n      method: \'POST\',\n      headers: {\n        \'Content-Type\': \'application/json\',\n        Authorization: `Bearer ${settings.value.api_key}`,\n      },\n      body: JSON.stringify({\n        model: settings.value.model,\n        messages: [\n          { role: \'system\', content: systemPrompt },\n          { role: \'user\', content: userPrompt },\n        ],\n        temperature: settings.value.temperature,\n        max_tokens: settings.value.max_tokens,\n        top_p: settings.value.top_p,\n        presence_penalty: settings.value.presence_penalty,\n        frequency_penalty: settings.value.frequency_penalty,\n      }),\n    });\n\n    if (!response.ok) {\n      const errorText = await response.text();\n      throw new Error(`API è¯·æ±‚å¤±è´¥: ${response.status} ${response.statusText}\\n${errorText}`);\n    }\n\n    const result = await response.json();\n\n    console.log(\'âœ… [ç”Ÿæˆ] API å®Œæ•´å“åº”:\', result);\n\n    let aiDescription = result.choices?.[0]?.message?.content?.trim() || \'\';\n\n    console.log(\'ğŸ“ [ç”Ÿæˆ] AI åŸå§‹è¿”å›:\', aiDescription);\n\n    if (!aiDescription) {\n      console.error(\'âŒ [ç”Ÿæˆ] AI å“åº”ä¸ºç©º\');\n      console.error(\'å®Œæ•´å“åº”:\', JSON.stringify(result, null, 2));\n\n      // æ£€æŸ¥æ˜¯å¦æœ‰é”™è¯¯ä¿¡æ¯\n      if (result.error) {\n        throw new Error(`API é”™è¯¯: ${result.error.message || JSON.stringify(result.error)}`);\n      }\n\n      // æ£€æŸ¥å“åº”æ ¼å¼\n      if (!result.choices || result.choices.length === 0) {\n        throw new Error(\'API è¿”å›æ ¼å¼é”™è¯¯ï¼šæ²¡æœ‰ choices å­—æ®µï¼Œè¯·æ£€æŸ¥ API ç«¯ç‚¹å’Œæ¨¡å‹\');\n      }\n\n      throw new Error(\'AI æœªè¿”å›æœ‰æ•ˆå†…å®¹ï¼Œè¯·æ£€æŸ¥ï¼š\\n1. API Key æ˜¯å¦æœ‰æ•ˆ\\n2. æ¨¡å‹æ˜¯å¦å¯ç”¨\\n3. è´¦æˆ·ä½™é¢\');\n    }\n\n    // æ¸…ç†AIè¿”å›çš„å†…å®¹\n    // ç§»é™¤å¯èƒ½çš„å¼•å·åŒ…è£¹\n    aiDescription = aiDescription.replace(/^["\']|["\']$/g, \'\');\n    // ç§»é™¤å¯èƒ½çš„markdownä»£ç å—æ ‡è®°\n    aiDescription = aiDescription.replace(/^```.*?\\n?|```$/g, \'\').trim();\n\n    if (!aiDescription) {\n      throw new Error(\'AI è¿”å›å†…å®¹æ¸…ç†åä¸ºç©º\');\n    }\n\n    console.log(\'âœ¨ [ç”Ÿæˆ] AI æ¸…ç†åçš„æè¿°:\', aiDescription);\n\n    // æ›´æ–°æè¿°\n    greetings.value[idx].description = aiDescription;\n    saveConfig();\n\n    toastr.success(\'æè¿°ç”ŸæˆæˆåŠŸ\');\n    showAiGenerateDialog.value = false;\n  } catch (error) {\n    console.error(\'âŒ [ç”Ÿæˆ] AI ç”Ÿæˆå¤±è´¥:\', error);\n    const errorMsg = \'ç”Ÿæˆå¤±è´¥: \' + (error as Error).message;\n    toastr.error(errorMsg);\n    // å»¶é•¿æ˜¾ç¤ºæ—¶é—´\n    setTimeout(() => {}, 5000);\n  } finally {\n    isGeneratingAi.value = false;\n  }\n}\n\n// AIç¼–è¾‘æè¿°\nfunction editDescription(index: number) {\n  currentEditingIndex.value = index;\n  showAiEditDialog.value = true;\n}\n\n// ç¡®è®¤AIç¼–è¾‘æè¿°\nasync function confirmEditDescription(requirement: string) {\n  const index = currentEditingIndex.value;\n  if (index < 0 || index >= greetings.value.length) return;\n\n  isEditingAi.value = true;\n\n  try {\n    // æ£€æŸ¥ API é…ç½®\n    if (!settings.value.api_endpoint || !settings.value.api_key) {\n      toastr.error(\'è¯·å…ˆåœ¨è®¾ç½®é¡µé¢é…ç½® API ç«¯ç‚¹å’Œ API Key\');\n      showAiEditDialog.value = false;\n      isEditingAi.value = false;\n      return;\n    }\n\n    const currentDesc = greetings.value[index].description;\n\n    if (!currentDesc.trim()) {\n      toastr.warning(\'å½“å‰æè¿°ä¸ºç©ºï¼Œè¯·å…ˆä½¿ç”¨ AI ç”Ÿæˆ\');\n      showAiEditDialog.value = false;\n      isEditingAi.value = false;\n      return;\n    }\n\n    // æ„å»ºæç¤ºè¯\n    const systemPrompt = `ä½ æ˜¯ä¸€ä¸ªä¸“ä¸šçš„æ–‡æ¡ˆç¼–è¾‘åŠ©æ‰‹ï¼Œæ“…é•¿æ ¹æ®ç”¨æˆ·éœ€æ±‚ä¿®æ”¹æ–‡æ¡ˆã€‚\n\nè¦æ±‚ï¼š\n1. æ ¹æ®ç”¨æˆ·çš„ä¿®æ”¹éœ€æ±‚è°ƒæ•´æè¿°\n2. ä¿æŒæè¿°ç®€æ´æœ‰åŠ›ï¼Œæ§åˆ¶åœ¨ 20-50 å­—ä»¥å†…\n3. ä¿ç•™åŸæè¿°çš„æ ¸å¿ƒä¿¡æ¯ï¼Œåªè¿›è¡Œå¿…è¦çš„è°ƒæ•´\n4. ç›´æ¥è¾“å‡ºä¿®æ”¹åçš„æè¿°æ–‡æœ¬ï¼Œä¸è¦æ·»åŠ å¼•å·æˆ–å…¶ä»–æ ‡è®°`;\n\n    const userPrompt = `å½“å‰æè¿°ï¼š\n${currentDesc}\n\nä¿®æ”¹éœ€æ±‚ï¼š\n${requirement}\n\nè¯·è¾“å‡ºä¿®æ”¹åçš„æè¿°ï¼š`;\n\n    console.log(\'å¼€å§‹ AI ç¼–è¾‘æè¿°...\');\n\n    // è§„èŒƒåŒ– API ç«¯ç‚¹\n    const apiUrl = normalizeApiEndpoint(settings.value.api_endpoint, \'/chat/completions\');\n    console.log(\'ğŸ”— è§„èŒƒåŒ–åçš„ç«¯ç‚¹:\', apiUrl);\n\n    // è°ƒç”¨ AI API\n    const response = await fetch(apiUrl, {\n      method: \'POST\',\n      headers: {\n        \'Content-Type\': \'application/json\',\n        Authorization: `Bearer ${settings.value.api_key}`,\n      },\n      body: JSON.stringify({\n        model: settings.value.model,\n        messages: [\n          { role: \'system\', content: systemPrompt },\n          { role: \'user\', content: userPrompt },\n        ],\n        temperature: settings.value.temperature,\n        max_tokens: settings.value.max_tokens,\n        top_p: settings.value.top_p,\n        presence_penalty: settings.value.presence_penalty,\n        frequency_penalty: settings.value.frequency_penalty,\n      }),\n    });\n\n    if (!response.ok) {\n      const errorText = await response.text();\n      throw new Error(`API è¯·æ±‚å¤±è´¥: ${response.status} ${response.statusText}\\n${errorText}`);\n    }\n\n    const result = await response.json();\n\n    console.log(\'âœ… [ç¼–è¾‘] API å®Œæ•´å“åº”:\', result);\n\n    let aiDescription = result.choices?.[0]?.message?.content?.trim() || \'\';\n\n    console.log(\'ğŸ“ [ç¼–è¾‘] AI åŸå§‹è¿”å›:\', aiDescription);\n\n    if (!aiDescription) {\n      console.error(\'âŒ [ç¼–è¾‘] AI å“åº”ä¸ºç©º\');\n      console.error(\'å®Œæ•´å“åº”:\', JSON.stringify(result, null, 2));\n\n      // æ£€æŸ¥æ˜¯å¦æœ‰é”™è¯¯ä¿¡æ¯\n      if (result.error) {\n        throw new Error(`API é”™è¯¯: ${result.error.message || JSON.stringify(result.error)}`);\n      }\n\n      // æ£€æŸ¥å“åº”æ ¼å¼\n      if (!result.choices || result.choices.length === 0) {\n        throw new Error(\'API è¿”å›æ ¼å¼é”™è¯¯ï¼šæ²¡æœ‰ choices å­—æ®µï¼Œè¯·æ£€æŸ¥ API ç«¯ç‚¹å’Œæ¨¡å‹\');\n      }\n\n      throw new Error(\'AI æœªè¿”å›æœ‰æ•ˆå†…å®¹ï¼Œè¯·æ£€æŸ¥ï¼š\\n1. API Key æ˜¯å¦æœ‰æ•ˆ\\n2. æ¨¡å‹æ˜¯å¦å¯ç”¨\\n3. è´¦æˆ·ä½™é¢\');\n    }\n\n    // æ¸…ç†AIè¿”å›çš„å†…å®¹\n    // ç§»é™¤å¯èƒ½çš„å¼•å·åŒ…è£¹\n    aiDescription = aiDescription.replace(/^["\']|["\']$/g, \'\');\n    // ç§»é™¤å¯èƒ½çš„markdownä»£ç å—æ ‡è®°\n    aiDescription = aiDescription.replace(/^```.*?\\n?|```$/g, \'\').trim();\n\n    if (!aiDescription) {\n      throw new Error(\'AI è¿”å›å†…å®¹æ¸…ç†åä¸ºç©º\');\n    }\n\n    console.log(\'âœ¨ [ç¼–è¾‘] AI æ¸…ç†åçš„æè¿°:\', aiDescription);\n\n    // æ›´æ–°æè¿°\n    greetings.value[index].description = aiDescription;\n    saveConfig();\n\n    toastr.success(\'æè¿°ä¿®æ”¹æˆåŠŸ\');\n    showAiEditDialog.value = false;\n  } catch (error) {\n    console.error(\'âŒ [ç¼–è¾‘] AI ç¼–è¾‘å¤±è´¥:\', error);\n    const errorMsg = \'ç¼–è¾‘å¤±è´¥: \' + (error as Error).message;\n    toastr.error(errorMsg);\n  } finally {\n    isEditingAi.value = false;\n  }\n}\n\n// AIç”Ÿæˆç•Œé¢æ ·å¼\nasync function generateStyleWithAI(styleDescription: string) {\n  if (!styleDescription.trim()) {\n    toastr.warning(\'è¯·è¾“å…¥ç•Œé¢é£æ ¼æè¿°\');\n    return;\n  }\n\n  // æ£€æŸ¥ API é…ç½®\n  if (!settings.value.api_endpoint || !settings.value.api_key) {\n    toastr.error(\'è¯·å…ˆåœ¨è®¾ç½®é¡µé¢é…ç½® API ç«¯ç‚¹å’Œ API Key\');\n    showAiStyleDialog.value = false;\n    return;\n  }\n\n  isGeneratingStyle.value = true;\n\n  try {\n    // ç”Ÿæˆå¡ç‰‡åˆ—è¡¨HTML\n    const cards = greetings.value\n      .map((g, index) => {\n        const icon = g.icon || \'ğŸ’¬\';\n        const title = g.title || (index === 0 ? \'é»˜è®¤å¼€åœºç™½\' : `å¼€åœºç™½ ${index}`);\n        const desc = g.description || \'ç‚¹å‡»å¼€å§‹å¯¹è¯\';\n        const badge = index === 0 ? \'é»˜è®¤\' : String(index).padStart(2, \'0\');\n        return (\n          \'      <\' +\n          \'div class="scene-card" onclick="switchGreeting(\' +\n          index +\n          \')">\' +\n          \'<\' +\n          \'div class="card-badge">\' +\n          badge +\n          \'<\' +\n          \'/div>\' +\n          \'<\' +\n          \'div class="card-icon">\' +\n          icon +\n          \'<\' +\n          \'/div>\' +\n          \'<\' +\n          \'div class="card-title">\' +\n          title +\n          \'<\' +\n          \'/div>\' +\n          \'<\' +\n          \'div class="card-desc">\' +\n          desc +\n          \'<\' +\n          \'/div>\' +\n          \'<\' +\n          \'/div>\'\n        );\n      })\n      .join(\'\\n\');\n\n    const systemPrompt =\n      `ä½ æ˜¯ä¸€ä¸ªä¸“ä¸šçš„å‰ç«¯å¼€å‘ä¸“å®¶ï¼Œæ“…é•¿åˆ›å»ºç¾è§‚çš„HTML/CSSç•Œé¢ã€‚\n\nä»»åŠ¡ï¼šæ ¹æ®ç”¨æˆ·çš„é£æ ¼æè¿°ï¼Œç”Ÿæˆä¸€ä¸ªå®Œæ•´çš„HTMLé¡µé¢ä»£ç ï¼Œç”¨äºå±•ç¤ºå¼€åœºç™½é€‰æ‹©ç•Œé¢ã€‚\n\nè¦æ±‚ï¼š\n1. åŒ…å«å®Œæ•´çš„ HTML ç»“æ„ï¼ˆ` +\n      \'<\' +\n      `html>ã€` +\n      \'<\' +\n      `head>ã€` +\n      \'<\' +\n      `body>ï¼‰\n2. åœ¨ ` +\n      \'<\' +\n      `head> ä¸­åŒ…å« Font Awesome å›¾æ ‡åº“ï¼š` +\n      \'<\' +\n      `link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">\n3. æ‰€æœ‰æ ·å¼å†™åœ¨ ` +\n      \'<\' +\n      `style> æ ‡ç­¾å†…ï¼Œä¸è¦ä½¿ç”¨å¤–éƒ¨ CSS æ–‡ä»¶\n4. å¿…é¡»åŒ…å«ä»¥ä¸‹HTMLç»“æ„ï¼ˆä¿æŒç±»åä¸å˜ï¼‰ï¼š\n   - bodyï¼ˆé¡µé¢èƒŒæ™¯ï¼‰\n   - .containerï¼ˆä¸»å®¹å™¨ï¼‰\n   - .headerï¼ˆæ ‡é¢˜åŒºåŸŸï¼‰\n     - h1ï¼ˆä¸»æ ‡é¢˜ï¼‰\n     - pï¼ˆå‰¯æ ‡é¢˜ï¼‰\n   - .scene-gridï¼ˆå¡ç‰‡ç½‘æ ¼å®¹å™¨ï¼‰\n   - .scene-cardï¼ˆå•ä¸ªå¡ç‰‡ï¼Œéœ€è¦ onclick å±æ€§ï¼‰\n   - .card-badgeï¼ˆåºå·å¾½ç« ï¼‰\n   - .card-iconï¼ˆå›¾æ ‡ï¼‰\n   - .card-titleï¼ˆå¡ç‰‡æ ‡é¢˜ï¼‰\n   - .card-descï¼ˆå¡ç‰‡æè¿°ï¼‰\n   - .loadingï¼ˆåŠ è½½æç¤ºï¼‰\n5. å¿…é¡»åŒ…å« switchGreeting(id) å‡½æ•°çš„å®Œæ•´ JavaScript ä»£ç \n6. æ ¹æ®ç”¨æˆ·çš„é£æ ¼æè¿°è®¾è®¡é¢œè‰²ã€å­—ä½“ã€å¸ƒå±€ã€åŠ¨ç”»ç­‰æ ·å¼\n7. ç¡®ä¿å“åº”å¼è®¾è®¡ï¼Œåœ¨ä¸åŒå±å¹•å°ºå¯¸ä¸‹éƒ½å¥½çœ‹\n8. ç›´æ¥è¾“å‡ºå®Œæ•´çš„HTMLä»£ç ï¼Œä¸è¦æ·»åŠ ä»»ä½•è§£é‡Šæ–‡å­—æˆ–markdownæ ‡è®°\n\nã€é‡è¦ã€‘æ ·å¼è¦æ±‚ï¼š\n- body å¿…é¡»ä½¿ç”¨ "min-height: 100vh; height: auto;" è€Œä¸æ˜¯å›ºå®šé«˜åº¦\n- body å¿…é¡»ä½¿ç”¨ "display: flex; align-items: center; justify-content: center;" æ¥å±…ä¸­å†…å®¹\n- .container ä¸è¦è®¾ç½®å›ºå®šé«˜åº¦ï¼Œä½¿ç”¨ "height: auto;" è®©å†…å®¹è‡ªé€‚åº”\n- ç¡®ä¿æ‰€æœ‰å†…å®¹éƒ½èƒ½å®Œæ•´æ˜¾ç¤ºï¼Œä¸ä¼šè¢«æˆªæ–­\n\nã€é‡è¦ã€‘HTMLç»“æ„å¿…é¡»ä¸¥æ ¼éµå®ˆï¼š\n- å¿…é¡»æœ‰ä¸€ä¸ª class="scene-grid" çš„divä½œä¸ºå¡ç‰‡å®¹å™¨\n- æ‰€æœ‰å¡ç‰‡å¿…é¡»åœ¨ scene-grid å®¹å™¨å†…\n- ä¸è¦æ”¹å˜scene-gridè¿™ä¸ªç±»åï¼Œä¸è¦ç”¨grid-containerã€cards-gridç­‰å…¶ä»–åå­—`;\n\n    // æä¾›å®Œæ•´çš„ switchGreeting å‡½æ•°ä»£ç \n    const switchGreetingCode = `async function switchGreeting(id) {\n      try {\n        const loading = document.getElementById("loading");\n        const mainContainer = document.getElementById("mainContainer");\n        if (loading) loading.classList.add("active");\n        if (mainContainer) mainContainer.style.display = "none";\n        \n        if (typeof window.getChatMessages !== "function") {\n          alert("è¯·åœ¨é…’é¦†ç¯å¢ƒä¸­ä½¿ç”¨æ­¤åŠŸèƒ½");\n          if (loading) loading.classList.remove("active");\n          if (mainContainer) mainContainer.style.display = "block";\n          return;\n        }\n        \n        const messages = await window.getChatMessages(0, { include_swipe: true });\n        if (!messages || messages.length === 0) {\n          alert("æœªæ‰¾åˆ°æ¶ˆæ¯");\n          if (loading) loading.classList.remove("active");\n          if (mainContainer) mainContainer.style.display = "block";\n          return;\n        }\n        \n        const content = messages[0].swipes[id];\n        if (!content) {\n          alert("è¯¥å¼€åœºç™½æš‚æ— å†…å®¹");\n          if (loading) loading.classList.remove("active");\n          if (mainContainer) mainContainer.style.display = "block";\n          return;\n        }\n        \n        await window.setChatMessage(content, 0, { swipe_id: id, refresh: "display_and_render_current" });\n        \n        setTimeout(() => {\n          if (loading) loading.classList.remove("active");\n          if (mainContainer) mainContainer.style.display = "block";\n        }, 500);\n      } catch (err) {\n        console.error("åˆ‡æ¢å¤±è´¥:", err);\n        alert("åˆ‡æ¢å¤±è´¥: " + err.message);\n        const loading = document.getElementById("loading");\n        const mainContainer = document.getElementById("mainContainer");\n        if (loading) loading.classList.remove("active");\n        if (mainContainer) mainContainer.style.display = "block";\n      }\n    }`;\n\n    const userPrompt =\n      `é£æ ¼æè¿°ï¼š${styleDescription}\n\nä»¥ä¸‹æ˜¯éœ€è¦å±•ç¤ºçš„å¼€åœºç™½å¡ç‰‡ï¼ˆæ¯ä¸ªå¡ç‰‡éœ€è¦æœ‰ onclick="switchGreeting(åºå·)" å±æ€§ï¼‰ï¼š\n${cards}\n\nã€é‡è¦ã€‘å¿…é¡»åœ¨ ` +\n      \'<\' +\n      `/body> å‰æ·»åŠ ä»¥ä¸‹ JavaScript ä»£ç ï¼š\n` +\n      \'<\' +\n      `script>\n${switchGreetingCode}\n` +\n      \'<\' +\n      `/script>\n\nã€é‡è¦ã€‘æ¯ä¸ª .scene-card å¿…é¡»æ·»åŠ  onclick="switchGreeting(åºå·)" å±æ€§ï¼Œä¾‹å¦‚ï¼š\n` +\n      \'<\' +\n      `div class="scene-card" onclick="switchGreeting(0)">\n\nã€é‡è¦ã€‘å¿…é¡»åŒ…å«ä¸€ä¸ª loading æç¤ºå…ƒç´ ï¼š\n` +\n      \'<\' +\n      `div class="loading" id="loading" style="display: none; text-align: center; padding: 40px;">\n  ` +\n      \'<\' +\n      `p style="color: #888; font-size: 18px;">åˆ‡æ¢ä¸­...` +\n      \'<\' +\n      `/p>\n` +\n      \'<\' +\n      `/div>\n\nè¯·ç”Ÿæˆå®Œæ•´çš„HTMLä»£ç ï¼Œç¡®ä¿åŒ…å«ä»¥ä¸Šæ‰€æœ‰è¦æ±‚ï¼š`;\n\n    console.log(\'å¼€å§‹ AI ç”Ÿæˆç•Œé¢æ ·å¼...\');\n\n    // è§„èŒƒåŒ– API ç«¯ç‚¹\n    const apiUrl = normalizeApiEndpoint(settings.value.api_endpoint, \'/chat/completions\');\n    console.log(\'ğŸ”— è§„èŒƒåŒ–åçš„ç«¯ç‚¹:\', apiUrl);\n\n    // è°ƒç”¨ AI API\n    const response = await fetch(apiUrl, {\n      method: \'POST\',\n      headers: {\n        \'Content-Type\': \'application/json\',\n        Authorization: `Bearer ${settings.value.api_key}`,\n      },\n      body: JSON.stringify({\n        model: settings.value.model,\n        messages: [\n          { role: \'system\', content: systemPrompt },\n          { role: \'user\', content: userPrompt },\n        ],\n        temperature: settings.value.temperature,\n        max_tokens: settings.value.max_tokens,\n        top_p: settings.value.top_p,\n        presence_penalty: settings.value.presence_penalty,\n        frequency_penalty: settings.value.frequency_penalty,\n      }),\n    });\n\n    if (!response.ok) {\n      const errorText = await response.text();\n      throw new Error(`API è¯·æ±‚å¤±è´¥: ${response.status} ${response.statusText}\\n${errorText}`);\n    }\n\n    const result = await response.json();\n\n    console.log(\'âœ… [æ ·å¼ç”Ÿæˆ] API å®Œæ•´å“åº”:\', result);\n\n    let generatedHtml = result.choices?.[0]?.message?.content?.trim() || \'\';\n\n    console.log(\'ğŸ“ [æ ·å¼ç”Ÿæˆ] AI åŸå§‹è¿”å›:\', generatedHtml ? generatedHtml.substring(0, 500) : \'(ç©º)\');\n\n    if (!generatedHtml) {\n      console.error(\'âŒ [æ ·å¼ç”Ÿæˆ] AI å“åº”ä¸ºç©º\');\n      console.error(\'å®Œæ•´å“åº”:\', JSON.stringify(result, null, 2));\n\n      // æ£€æŸ¥æ˜¯å¦æœ‰é”™è¯¯ä¿¡æ¯\n      if (result.error) {\n        throw new Error(`API é”™è¯¯: ${result.error.message || JSON.stringify(result.error)}`);\n      }\n\n      throw new Error(\'AI æœªè¿”å›æœ‰æ•ˆå†…å®¹ï¼Œè¯·æ£€æŸ¥ API é…ç½®å’Œæ¨¡å‹æ˜¯å¦æ”¯æŒè¯¥ä»»åŠ¡\');\n    }\n\n    // æ¸…ç†AIè¿”å›çš„å†…å®¹\n    // ç§»é™¤å¯èƒ½çš„markdownä»£ç å—æ ‡è®°\n    generatedHtml = generatedHtml.replace(/^```html\\n?|^```\\n?|```$/gm, \'\').trim();\n\n    if (!generatedHtml) {\n      throw new Error(\'AI è¿”å›å†…å®¹æ¸…ç†åä¸ºç©º\');\n    }\n\n    console.log(\'âœ¨ [æ ·å¼ç”Ÿæˆ] AI æ¸…ç†åçš„HTMLé•¿åº¦:\', generatedHtml.length);\n\n    // ä¿å­˜ç”Ÿæˆçš„HTML\n    uiConfig.value.customHtml = generatedHtml;\n    saveConfig();\n\n    toastr.success(\'ç•Œé¢æ ·å¼ç”ŸæˆæˆåŠŸï¼è¯·æŸ¥çœ‹å³ä¾§é¢„è§ˆ\');\n    showAiStyleDialog.value = false;\n\n    // æ›´æ–°é¢„è§ˆ\n    updatePreview();\n  } catch (error) {\n    console.error(\'âŒ [æ ·å¼ç”Ÿæˆ] AI ç”Ÿæˆå¤±è´¥:\', error);\n    toastr.error(\'ç”Ÿæˆå¤±è´¥: \' + (error as Error).message, \'\', { timeOut: 5000 });\n  } finally {\n    isGeneratingStyle.value = false;\n  }\n}\n\n// ç”Ÿæˆå‰ç«¯ä»£ç \nasync function generateFrontendCode() {\n  const character = getCurrentCharacter();\n  if (!character) {\n    toastr.warning(\'æœªæ‰¾åˆ°è§’è‰²å¡\');\n    return;\n  }\n\n  // å¦‚æœæœ‰AIç”Ÿæˆçš„è‡ªå®šä¹‰HTMLï¼Œç›´æ¥ä½¿ç”¨\n  if (uiConfig.value.customHtml && uiConfig.value.customHtml.trim()) {\n    generatedCode.value = uiConfig.value.customHtml;\n    showCodeDialog.value = true;\n    return;\n  }\n\n  // å¦åˆ™ä½¿ç”¨é»˜è®¤æ¨¡æ¿ç”Ÿæˆ\n  // ç”Ÿæˆå¡ç‰‡åˆ—è¡¨\n  const cards = greetings.value\n    .map((g, index) => {\n      const icon = g.icon || \'<\' + \'i class="fa-solid fa-comment"><\' + \'/i>\';\n      const title = g.title || (index === 0 ? \'é»˜è®¤å¼€åœºç™½\' : `å¼€åœºç™½ ${index}`);\n      const desc = g.description || \'ç‚¹å‡»å¼€å§‹å¯¹è¯\';\n      const badge = index === 0 ? \'é»˜è®¤\' : String(index).padStart(2, \'0\');\n\n      return (\n        \'        <\' +\n        \'div class="scene-card" onclick="switchGreeting(\' +\n        index +\n        \')">\' +\n        \'<\' +\n        \'div class="card-badge">\' +\n        badge +\n        \'<\' +\n        \'/div>\' +\n        \'<\' +\n        \'div class="card-icon">\' +\n        icon +\n        \'<\' +\n        \'/div>\' +\n        \'<\' +\n        \'div class="card-title">\' +\n        title +\n        \'<\' +\n        \'/div>\' +\n        \'<\' +\n        \'div class="card-desc">\' +\n        desc +\n        \'<\' +\n        \'/div>\' +\n        \'<\' +\n        \'/div>\'\n      );\n    })\n    .join(\'\\n\\n\');\n\n  // ç”Ÿæˆé»˜è®¤æ ·å¼çš„HTML\n  const htmlCode = [\n    \'<\' + \'html>\',\n    \'<\' + \'head>\',\n    \'  <\' + \'meta charset="UTF-8">\',\n    \'  <\' + \'link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">\',\n    \'  <\' + \'style>\',\n    \'    * { margin: 0; padding: 0; box-sizing: border-box; }\',\n    \'    html, body { height: 100%; }\',\n    \'    body {\',\n    \'      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;\',\n    \'      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);\',\n    \'      padding: 20px; min-height: 100%; height: auto; display: flex; align-items: center; justify-content: center;\',\n    \'      overflow-y: auto;\',\n    \'    }\',\n    \'    .container { max-width: 900px; width: 100%; height: auto; background: rgba(255, 255, 255, 0.95);\',\n    \'      border-radius: 20px; padding: 40px; box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3); margin: 20px auto; }\',\n    \'    .header { text-align: center; margin-bottom: 40px; }\',\n    \'    .header h1 { font-size: 32px; color: #333; margin-bottom: 10px; }\',\n    \'    .header p { color: #666; font-size: 16px; }\',\n    \'    .scene-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(250px, 1fr)); gap: 20px; }\',\n    \'    .scene-card { background: white; border: 2px solid #e0e0e0; border-radius: 15px;\',\n    \'      padding: 25px; cursor: pointer; transition: all 0.3s ease; position: relative; overflow: hidden; }\',\n    \'    .scene-card:hover { transform: translateY(-5px); border-color: #667eea;\',\n    \'      box-shadow: 0 10px 30px rgba(102, 126, 234, 0.3); }\',\n    \'    .card-badge { position: absolute; top: 10px; right: 10px; background: #667eea;\',\n    \'      color: white; padding: 4px 10px; border-radius: 12px; font-size: 12px; font-weight: bold; }\',\n    \'    .card-icon { font-size: 48px; margin-bottom: 15px; text-align: center; }\',\n    \'    .card-title { font-size: 20px; font-weight: 600; color: #333; margin-bottom: 10px; }\',\n    \'    .card-desc { font-size: 14px; color: #666; line-height: 1.5; }\',\n    \'    .loading { display: none; text-align: center; padding: 40px; }\',\n    \'    .loading.active { display: block; }\',\n    \'  <\' + \'/style>\',\n    \'<\' + \'/head>\',\n    \'<\' + \'body>\',\n    \'  <\' + \'div class="container" id="mainContainer">\',\n    \'    <\' + \'div class="header">\',\n    \'      <\' + \'h1>å¼€åœºç™½é€‰æ‹©<\' + \'/h1>\',\n    \'      <\' + \'p>é€‰æ‹©ä¸€ä¸ªåœºæ™¯å¼€å§‹ä½ çš„æ•…äº‹<\' + \'/p>\',\n    \'    <\' + \'/div>\',\n    \'    <\' + \'div class="scene-grid" id="sceneGrid">\',\n    cards,\n    \'    <\' + \'/div>\',\n    \'  <\' + \'/div>\',\n    \'  <\' + \'div class="loading" id="loading"><\' + \'p>åˆ‡æ¢ä¸­...<\' + \'/p><\' + \'/div>\',\n    \'  <\' + \'script>\',\n    \'    async function switchGreeting(id) {\',\n    \'      try {\',\n    \'        const loading = document.getElementById("loading");\',\n    \'        const mainContainer = document.getElementById("mainContainer");\',\n    \'        loading.classList.add("active"); mainContainer.style.display = "none";\',\n    \'        const messages = await getChatMessages(0, { include_swipe: true });\',\n    \'        if (!messages || messages.length === 0) { alert("æœªæ‰¾åˆ°æ¶ˆæ¯"); return; }\',\n    \'        const content = messages[0].swipes[id];\',\n    \'        if (!content) { alert("è¯¥å¼€åœºç™½æš‚æ— å†…å®¹"); return; }\',\n    \'        await setChatMessage(content, 0, { swipe_id: id, refresh: "display_and_render_current" });\',\n    \'        setTimeout(() => { loading.classList.remove("active"); mainContainer.style.display = "block"; }, 500);\',\n    \'      } catch (err) { console.error("åˆ‡æ¢å¤±è´¥:", err); alert("åˆ‡æ¢å¤±è´¥: " + err.message); }\',\n    \'    }\',\n    \'  </\' + \'script>\',\n    \'<\' + \'/body>\',\n    \'<\' + \'/html>\',\n  ].join(\'\\n\');\n\n  // ä¿®æ”¹ç”Ÿæˆçš„ä»£ç ï¼Œæ·»åŠ APIæ£€æŸ¥\n  const fixedHtmlCode = htmlCode\n    .replace(\n      \'const messages = await getChatMessages\',\n      \'if (typeof window.getChatMessages !== "function") { alert("è¯·åœ¨é…’é¦†ç¯å¢ƒä¸­ä½¿ç”¨"); loading.classList.remove("active"); mainContainer.style.display = "block"; return; }\\n        const messages = await window.getChatMessages\',\n    )\n    .replace(\'await setChatMessage\', \'await window.setChatMessage\')\n    .replace(\n      \'alert("æœªæ‰¾åˆ°æ¶ˆæ¯"); return;\',\n      \'alert("æœªæ‰¾åˆ°æ¶ˆæ¯"); loading.classList.remove("active"); mainContainer.style.display = "block"; return;\',\n    )\n    .replace(\n      \'alert("è¯¥å¼€åœºç™½æš‚æ— å†…å®¹"); return;\',\n      \'alert("è¯¥å¼€åœºç™½æš‚æ— å†…å®¹"); loading.classList.remove("active"); mainContainer.style.display = "block"; return;\',\n    );\n\n  generatedCode.value = fixedHtmlCode;\n\n  showCodeDialog.value = true;\n  copyButtonText.value = \'å¤åˆ¶ä»£ç \';\n}\n\n// å¤åˆ¶ä»£ç \nasync function copyCode() {\n  const success = await copyToClipboard(generatedCode.value, \'âœ… ä»£ç å·²å¤åˆ¶åˆ°å‰ªè´´æ¿\');\n  if (success) {\n    copyButtonText.value = \'âœ“ å·²å¤åˆ¶\';\n    setTimeout(() => {\n      copyButtonText.value = \'å¤åˆ¶ä»£ç \';\n    }, 2000);\n  }\n}\n\n// å…³é—­ä»£ç å¯¹è¯æ¡†\nfunction closeCodeDialog() {\n  showCodeDialog.value = false;\n}\n\n// æ›´æ–°é¢„è§ˆï¼ˆä»…å±•ç¤ºæ ·å¼ï¼Œä¸è°ƒç”¨APIï¼‰\nfunction updatePreview() {\n  if (greetings.value.length === 0) {\n    previewHtml.value = \'\';\n    return;\n  }\n\n  const character = getCurrentCharacter();\n  const characterName = character?.name || \'è§’è‰²\';\n\n  // å¦‚æœæœ‰AIç”Ÿæˆçš„è‡ªå®šä¹‰HTMLï¼Œä½¿ç”¨å®ƒ\n  if (uiConfig.value.customHtml && uiConfig.value.customHtml.trim()) {\n    console.log(\'ğŸ¨ ä½¿ç”¨AIç”Ÿæˆçš„è‡ªå®šä¹‰HTMLé¢„è§ˆ\');\n\n    try {\n      // ç”Ÿæˆå¡ç‰‡HTML\n      const cardsHtml = greetings.value\n        .map((g, index) => {\n          const icon = g.icon || \'ğŸ’¬\';\n          const title = g.title || (index === 0 ? \'é»˜è®¤å¼€åœºç™½\' : `å¼€åœºç™½ ${index}`);\n          const desc = g.description || \'ç‚¹å‡»å¼€å§‹å¯¹è¯\';\n          const badge = index === 0 ? \'é»˜è®¤\' : String(index).padStart(2, \'0\');\n\n          return `\n        <div class="scene-card">\n          <div class="card-badge">${badge}</div>\n          <div class="card-icon">${icon}</div>\n          <div class="card-title">${title}</div>\n          <div class="card-desc">${desc}</div>\n        </div>`;\n        })\n        .join(\'\\n\');\n\n      // æŸ¥æ‰¾ scene-grid å®¹å™¨å¹¶æ›¿æ¢å†…å®¹\n      let customHtml = uiConfig.value.customHtml;\n\n      // å°è¯•å¤šç§å¯èƒ½çš„å®¹å™¨ç±»å\n      const possiblePatterns = [\n        /(<div[^>]*class="scene-grid"[^>]*>)([\\s\\S]*?)(<\\/div>)/i,\n        /(<div[^>]*class="[^"]*grid[^"]*"[^>]*>)([\\s\\S]*?)(<\\/div>)/i,\n        /(<div[^>]*class="[^"]*cards[^"]*"[^>]*>)([\\s\\S]*?)(<\\/div>)/i,\n        /(<div[^>]*class="[^"]*container[^"]*"[^>]*>[\\s\\S]*?<div[^>]*class="[^"]*grid[^"]*"[^>]*>)([\\s\\S]*?)(<\\/div>)/i,\n      ];\n\n      for (const pattern of possiblePatterns) {\n        const match = customHtml.match(pattern);\n        if (match) {\n          // æ›¿æ¢æ‰¾åˆ°çš„å®¹å™¨å†…çš„å†…å®¹\n          customHtml = customHtml.replace(pattern, `$1\\n${cardsHtml}\\n      $3`);\n          previewHtml.value = customHtml;\n          console.log(\'âœ… è‡ªå®šä¹‰HTMLé¢„è§ˆæ›´æ–°æˆåŠŸï¼ˆå­—ç¬¦ä¸²æ›¿æ¢ï¼‰\');\n          return;\n        }\n      }\n\n      // å¦‚æœéƒ½æ‰¾ä¸åˆ°ï¼Œå°è¯•åœ¨bodyç»“æŸæ ‡ç­¾å‰æ’å…¥\n      console.warn(\'âš ï¸ æœªæ‰¾åˆ°åˆé€‚çš„å¡ç‰‡å®¹å™¨ï¼Œå°è¯•åœ¨bodyä¸­æ’å…¥\');\n      const bodyPattern = /(<body[^>]*>)([\\s\\S]*?)(<\\/body>)/i;\n      const bodyMatch = customHtml.match(bodyPattern);\n      if (bodyMatch) {\n        customHtml = customHtml.replace(bodyPattern, `$1$2\\n<div class="scene-grid">\\n${cardsHtml}\\n</div>\\n$3`);\n        previewHtml.value = customHtml;\n        console.log(\'âœ… å·²åœ¨bodyä¸­æ’å…¥å¡ç‰‡\');\n        return;\n      }\n\n      console.warn(\'âš ï¸ æ— æ³•å¤„ç†è‡ªå®šä¹‰HTMLï¼Œä½¿ç”¨åŸå§‹HTML\');\n      previewHtml.value = uiConfig.value.customHtml;\n    } catch (error) {\n      console.error(\'âŒ è§£æè‡ªå®šä¹‰HTMLå¤±è´¥:\', error);\n      toastr.warning(\'è‡ªå®šä¹‰HTMLè§£æå¤±è´¥ï¼Œä½¿ç”¨é»˜è®¤æ ·å¼\');\n      // ç»§ç»­ä½¿ç”¨é»˜è®¤æ ·å¼\n    }\n  }\n\n  console.log(\'ğŸ“ ä½¿ç”¨é»˜è®¤æ ·å¼é¢„è§ˆ\');\n\n  // ç”Ÿæˆå¡ç‰‡åˆ—è¡¨ - é¢„è§ˆæ¨¡å¼åªå±•ç¤ºæ ·å¼\n  const cards = greetings.value\n    .map((g, index) => {\n      const icon = g.icon || \'<\' + \'i class="fa-solid fa-comment"><\' + \'/i>\';\n      const title = g.title || (index === 0 ? \'é»˜è®¤å¼€åœºç™½\' : `å¼€åœºç™½ ${index}`);\n      const desc = g.description || \'ç‚¹å‡»å¼€å§‹å¯¹è¯\';\n      const badge = index === 0 ? \'é»˜è®¤\' : String(index).padStart(2, \'0\');\n\n      return (\n        \'        <\' +\n        \'div class="scene-card">\' +\n        \'<\' +\n        \'div class="card-badge">\' +\n        badge +\n        \'<\' +\n        \'/div>\' +\n        \'<\' +\n        \'div class="card-icon">\' +\n        icon +\n        \'<\' +\n        \'/div>\' +\n        \'<\' +\n        \'div class="card-title">\' +\n        title +\n        \'<\' +\n        \'/div>\' +\n        \'<\' +\n        \'div class="card-desc">\' +\n        desc +\n        \'<\' +\n        \'/div>\' +\n        \'<\' +\n        \'/div>\'\n      );\n    })\n    .join(\'\\n\\n\');\n\n  // ç”Ÿæˆé¢„è§ˆHTMLï¼ˆçº¯æ ·å¼å±•ç¤ºï¼Œæ— åŠŸèƒ½ï¼‰\n  const htmlCode = [\n    \'<\' + \'html>\',\n    \'<\' + \'head>\',\n    \'  <\' + \'meta charset="UTF-8">\',\n    \'  <\' + \'link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">\',\n    \'  <\' + \'style>\',\n    \'    * { margin: 0; padding: 0; box-sizing: border-box; }\',\n    \'    html, body { height: 100%; }\',\n    \'    body {\',\n    \'      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;\',\n    \'      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);\',\n    \'      padding: 20px; min-height: 100%; height: auto; display: flex; align-items: center; justify-content: center;\',\n    \'      overflow-y: auto;\',\n    \'    }\',\n    \'    .container { max-width: 900px; width: 100%; height: auto; background: rgba(255, 255, 255, 0.95);\',\n    \'      border-radius: 20px; padding: 40px; box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3); margin: 20px auto; }\',\n    \'    .header { text-align: center; margin-bottom: 40px; }\',\n    \'    .header h1 { font-size: 32px; color: #333; margin-bottom: 10px; }\',\n    \'    .header p { color: #666; font-size: 16px; }\',\n    \'    .scene-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(250px, 1fr)); gap: 20px; }\',\n    \'    .scene-card { background: white; border: 2px solid #e0e0e0; border-radius: 15px;\',\n    \'      padding: 25px; cursor: pointer; transition: all 0.3s ease; position: relative; overflow: hidden; }\',\n    \'    .scene-card:hover { transform: translateY(-5px); border-color: #667eea;\',\n    \'      box-shadow: 0 10px 30px rgba(102, 126, 234, 0.3); }\',\n    \'    .scene-card:active { transform: translateY(-2px); }\',\n    \'    .card-badge { position: absolute; top: 10px; right: 10px; background: #667eea;\',\n    \'      color: white; padding: 4px 10px; border-radius: 12px; font-size: 12px; font-weight: bold; }\',\n    \'    .card-icon { font-size: 48px; margin-bottom: 15px; text-align: center; }\',\n    \'    .card-title { font-size: 20px; font-weight: 600; color: #333; margin-bottom: 10px; }\',\n    \'    .card-desc { font-size: 14px; color: #666; line-height: 1.5; }\',\n    \'  <\' + \'/style>\',\n    \'<\' + \'/head>\',\n    \'<\' + \'body>\',\n    \'  <\' + \'div class="container">\',\n    \'    <\' + \'div class="header">\',\n    `      <` + `h1>${characterName} çš„å¼€åœºç™½<` + \'/h1>\',\n    \'      <\' + \'p>é€‰æ‹©ä¸€ä¸ªåœºæ™¯å¼€å§‹ä½ çš„æ•…äº‹<\' + \'/p>\',\n    \'    <\' + \'/div>\',\n    \'    <\' + \'div class="scene-grid">\',\n    cards,\n    \'    <\' + \'/div>\',\n    \'  <\' + \'/div>\',\n    \'<\' + \'/body>\',\n    \'<\' + \'/html>\',\n  ].join(\'\\n\');\n\n  previewHtml.value = htmlCode;\n}\n\n// åœ¨æ–°çª—å£æ‰“å¼€é¢„è§ˆ\nfunction openPreviewInNewWindow() {\n  if (!previewHtml.value) {\n    toastr.error(\'æ²¡æœ‰å¯é¢„è§ˆçš„å†…å®¹\');\n    return;\n  }\n\n  const character = getCurrentCharacter();\n  const windowTitle = character ? `${character.name} - å¼€åœºç™½é€‰æ‹©` : \'å¼€åœºç™½é¢„è§ˆ\';\n\n  // æ‰“å¼€æ–°çª—å£\n  const newWindow = window.open(\'\', \'_blank\', \'width=1200,height=800,menubar=no,toolbar=no,location=no,status=no\');\n  if (newWindow) {\n    newWindow.document.write(previewHtml.value);\n    newWindow.document.close();\n    newWindow.document.title = windowTitle;\n    toastr.success(\'å·²åœ¨æ–°çª—å£æ‰“å¼€é¢„è§ˆ\');\n  } else {\n    toastr.error(\'æ— æ³•æ‰“å¼€æ–°çª—å£ï¼Œè¯·æ£€æŸ¥æµè§ˆå™¨å¼¹çª—è®¾ç½®\');\n  }\n}\n\n// ä¸‹è½½ä¸ºSTScript JSON\nasync function downloadAsJson() {\n  try {\n    await generateFrontendCode();\n\n    if (!generatedCode.value) {\n      toastr.error(\'è¯·å…ˆç”Ÿæˆä»£ç \');\n      return;\n    }\n\n    const character = getCurrentCharacter();\n    const characterName = character?.name || \'è§’è‰²\';\n\n    // ç”ŸæˆUUID\n    const uuid = crypto.randomUUID();\n\n    // åˆ›å»ºSTScript JSONå¯¹è±¡\n    const stscriptJson = {\n      id: uuid,\n      scriptName: `${characterName}-å¼€åœºç™½å‰ç«¯`,\n      disabled: false,\n      runOnEdit: true,\n      findRegex: \'/ã€å¼€åœºç™½ã€‘/g\',\n      replaceString: \'```html\\n\' + generatedCode.value + \'\\n```\',\n      trimStrings: [],\n      placement: [1, 2],\n      substituteRegex: 0,\n      minDepth: null,\n      maxDepth: null,\n      markdownOnly: true,\n      promptOnly: false,\n    };\n\n    // è½¬æ¢ä¸ºJSONå­—ç¬¦ä¸²\n    const jsonString = JSON.stringify(stscriptJson, null, 4);\n\n    // åˆ›å»ºBlob\n    const blob = new Blob([jsonString], { type: \'application/json\' });\n\n    // åˆ›å»ºä¸‹è½½é“¾æ¥\n    const url = URL.createObjectURL(blob);\n    const link = document.createElement(\'a\');\n    link.href = url;\n    link.download = `${characterName}-å¼€åœºç™½å‰ç«¯.json`;\n\n    // è§¦å‘ä¸‹è½½\n    document.body.appendChild(link);\n    link.click();\n\n    // æ¸…ç†\n    document.body.removeChild(link);\n    URL.revokeObjectURL(url);\n\n    toastr.success(\'å·²ç”Ÿæˆå¹¶ä¸‹è½½JSONæ–‡ä»¶\');\n  } catch (error) {\n    console.error(\'ä¸‹è½½å¤±è´¥:\', error);\n    toastr.error(\'ä¸‹è½½å¤±è´¥: \' + (error as Error).message);\n  }\n}\n\n// ç»„ä»¶æŒ‚è½½æ—¶åŠ è½½é…ç½®\nonMounted(() => {\n  loadConfig();\n});\n<\/script>\n\n<style scoped>\n@keyframes fadeIn {\n  from {\n    opacity: 0;\n  }\n  to {\n    opacity: 1;\n  }\n}\n\n@keyframes slideUp {\n  from {\n    opacity: 0;\n    transform: translateY(30px);\n  }\n  to {\n    opacity: 1;\n    transform: translateY(0);\n  }\n}\n</style>\n'],sourceRoot:''}]);const i=s},884:(e,n,t)=>{var a=t(345);a.__esModule&&(a=a.default),'string'==typeof a&&(a=[[e.id,a,'']]),a.locals&&(e.exports=a.locals);(0,t(424).A)('0c94caae',a,!1,{ssrId:!0})},892:(e,n,t)=>{t.r(n),t.d(n,{default:()=>i});var a=t(790),o=t.n(a),r=t(54),s=t.n(r)()(o());s.push([e.id,'@keyframes blink-434cf372{0%,50%{opacity:1}51%,100%{opacity:0}}.project-tab[data-v-434cf372]{padding:25px !important;background:#1a1a1a !important}\n','',{version:3,sources:['webpack://./src/è®°å¿†_with_worldbook/components/ProjectManager.vue'],names:[],mappings:'AAqhMA,0BACE,OAEE,SACF,CACA,SAEE,SACF,CACF,CAEA,8BACE,uBAAwB,CACxB,6BACF',sourcesContent:['<template>\n  <div class="project-tab">\n    \x3c!-- é¡¶éƒ¨æ“ä½œæ  --\x3e\n    <div\n      class="section-header"\n      style="\n        display: flex;\n        justify-content: space-between;\n        align-items: center;\n        padding: 20px 28px;\n        background: #2a2a2a;\n        backdrop-filter: blur(12px);\n        border-radius: 14px;\n        margin-bottom: 20px;\n        border: 1px solid #333;\n        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);\n      "\n    >\n      <h3\n        style="\n          margin: 0;\n          color: #fff;\n          font-size: 16px !important;\n          font-weight: 600;\n          display: flex;\n          align-items: center;\n          gap: 12px;\n          letter-spacing: 0.5px;\n          text-shadow: 0 1px 2px rgba(0, 0, 0, 0.5);\n        "\n      >\n        <i class="fa-solid fa-laptop-code" style="color: #4a9eff; font-size: 18px"></i>\n        å‰ç«¯é¡¹ç›®ç®¡ç†å™¨\n      </h3>\n      <div class="project-action-buttons" style="display: flex; gap: 10px">\n        <button\n          v-if="currentId"\n          style="\n            padding: 8px 16px;\n            background: #444;\n            border: none;\n            border-radius: 8px;\n            color: #e0e0e0;\n            font-size: 13px;\n            font-weight: 500;\n            cursor: pointer;\n            transition: all 0.2s;\n          "\n          @click="exportToRegex"\n          @mouseenter="(e: any) => (e.currentTarget.style.background = \'#555\')"\n          @mouseleave="(e: any) => (e.currentTarget.style.background = \'#444\')"\n        >\n          <i class="fa-solid fa-download" style="margin-right: 6px"></i>\n          å¯¼å‡ºä¸ºæ­£åˆ™\n        </button>\n        <button\n          v-if="currentId"\n          style="\n            padding: 8px 16px;\n            background: #444;\n            border: none;\n            border-radius: 8px;\n            color: #e0e0e0;\n            font-size: 13px;\n            font-weight: 500;\n            cursor: pointer;\n            transition: all 0.2s;\n          "\n          @click="showHistoryDialog"\n          @mouseenter="(e: any) => (e.currentTarget.style.background = \'#555\')"\n          @mouseleave="(e: any) => (e.currentTarget.style.background = \'#444\')"\n        >\n          <i class="fa-solid fa-history" style="margin-right: 6px"></i>\n          å†å²è®°å½•\n        </button>\n        <button\n          v-if="currentId"\n          style="\n            padding: 8px 16px;\n            background: #8b5cf6;\n            border: none;\n            border-radius: 8px;\n            color: white;\n            font-size: 13px;\n            font-weight: 500;\n            cursor: pointer;\n            transition: all 0.2s;\n          "\n          @click="showAIDialog"\n          @mouseenter="(e: any) => (e.currentTarget.style.background = \'#7c3aed\')"\n          @mouseleave="(e: any) => (e.currentTarget.style.background = \'#8b5cf6\')"\n        >\n          <i class="fa-solid fa-wand-magic-sparkles" style="margin-right: 6px"></i>\n          AI æ™ºèƒ½ç¼–å†™\n        </button>\n        <button\n          v-if="currentId"\n          style="\n            padding: 8px 16px;\n            background: #ef4444;\n            border: none;\n            border-radius: 8px;\n            color: white;\n            font-size: 13px;\n            font-weight: 500;\n            cursor: pointer;\n            transition: all 0.2s;\n          "\n          @click="showBugFixDialog"\n          @mouseenter="(e: any) => (e.currentTarget.style.background = \'#dc2626\')"\n          @mouseleave="(e: any) => (e.currentTarget.style.background = \'#ef4444\')"\n        >\n          <i class="fa-solid fa-bug" style="margin-right: 6px"></i>\n          Bug ä¿®å¤\n        </button>\n        <button\n          style="\n            padding: 8px 16px;\n            background: #444;\n            border: none;\n            border-radius: 8px;\n            color: #e0e0e0;\n            font-size: 13px;\n            font-weight: 500;\n            cursor: pointer;\n            transition: all 0.2s;\n          "\n          @click="showProjectTemplateDialog"\n          @mouseenter="(e: any) => (e.currentTarget.style.background = \'#555\')"\n          @mouseleave="(e: any) => (e.currentTarget.style.background = \'#444\')"\n        >\n          <i class="fa-solid fa-file-lines" style="margin-right: 6px"></i>\n          ä½¿ç”¨æ¨¡æ¿\n        </button>\n        <button\n          style="\n            padding: 8px 16px;\n            background: #444;\n            border: none;\n            border-radius: 8px;\n            color: #e0e0e0;\n            font-size: 13px;\n            font-weight: 500;\n            cursor: pointer;\n            transition: all 0.2s;\n          "\n          @click="triggerFolderImport"\n          @mouseenter="(e: any) => (e.currentTarget.style.background = \'#555\')"\n          @mouseleave="(e: any) => (e.currentTarget.style.background = \'#444\')"\n        >\n          <i class="fa-solid fa-folder-open" style="margin-right: 6px"></i>\n          å¯¼å…¥æ–‡ä»¶å¤¹\n        </button>\n        <button\n          style="\n            padding: 8px 16px;\n            background: #10b981;\n            border: none;\n            border-radius: 8px;\n            color: white;\n            font-size: 13px;\n            font-weight: 500;\n            cursor: pointer;\n            transition: all 0.2s;\n          "\n          @click="createProject"\n          @mouseenter="(e: any) => (e.currentTarget.style.background = \'#059669\')"\n          @mouseleave="(e: any) => (e.currentTarget.style.background = \'#10b981\')"\n        >\n          <i class="fa-solid fa-plus" style="margin-right: 6px"></i>\n          æ–°å»ºé¡¹ç›®\n        </button>\n      </div>\n    </div>\n\n    \x3c!-- éšè—çš„æ–‡ä»¶å¤¹è¾“å…¥æ¡† --\x3e\n    <input\n      ref="folderInputRef"\n      type="file"\n      webkitdirectory\n      directory\n      multiple\n      style="display: none"\n      @change="handleFolderImport"\n    />\n\n    \x3c!-- é¡¹ç›®åˆ—è¡¨å’Œç¼–è¾‘å™¨åŒºåŸŸ --\x3e\n    <div style="display: grid; grid-template-columns: 220px 1fr 650px; gap: 20px; min-height: 500px">\n      \x3c!-- å·¦ä¾§ï¼šé¡¹ç›®åˆ—è¡¨å’Œæ–‡ä»¶åˆ—è¡¨ --\x3e\n      <div\n        style="\n          background: #2a2a2a;\n          border-radius: 12px;\n          padding: 15px;\n          border: 1px solid #3a3a3a;\n          display: flex;\n          flex-direction: column;\n        "\n      >\n        <h4 style="margin: 0 0 15px 0; color: #fff; font-size: 14px; font-weight: 600">é¡¹ç›®åˆ—è¡¨</h4>\n        <div v-if="projects.length === 0" style="text-align: center; color: #666; font-size: 12px; padding: 20px 10px">\n          æš‚æ— é¡¹ç›®<br />\n          ç‚¹å‡»"æ–°å»ºé¡¹ç›®"å¼€å§‹\n        </div>\n        <div\n          v-for="proj in projects"\n          :key="proj.id"\n          :style="{\n            padding: \'10px 12px\',\n            marginBottom: \'8px\',\n            background: currentId === proj.id ? \'#4a9eff\' : \'#1e1e1e\',\n            borderRadius: \'8px\',\n            cursor: \'pointer\',\n            transition: \'all 0.2s ease\',\n            display: \'flex\',\n            justifyContent: \'space-between\',\n            alignItems: \'center\',\n            color: currentId === proj.id ? \'#fff\' : \'#e0e0e0\',\n          }"\n          @click="selectProject(proj.id)"\n          @mouseenter="(e: any) => currentId !== proj.id && (e.currentTarget.style.background = \'#3a3a3a\')"\n          @mouseleave="(e: any) => currentId !== proj.id && (e.currentTarget.style.background = \'#1e1e1e\')"\n        >\n          <span style="font-size: 13px; flex: 1">{{ proj.name }}</span>\n          <button\n            style="\n              width: 20px;\n              height: 20px;\n              background: rgba(239, 68, 68, 0.2);\n              border: none;\n              border-radius: 4px;\n              color: #ff4444;\n              font-size: 14px;\n              line-height: 1;\n              cursor: pointer;\n              opacity: 0.6;\n              transition: all 0.2s ease;\n            "\n            @click.stop="deleteProject(proj.id)"\n            @mouseenter="\n              (e: any) => (\n                (e.currentTarget.style.opacity = \'1\'),\n                (e.currentTarget.style.background = \'#ef4444\'),\n                (e.currentTarget.style.color = \'#fff\')\n              )\n            "\n            @mouseleave="\n              (e: any) => (\n                (e.currentTarget.style.opacity = \'0.6\'),\n                (e.currentTarget.style.background = \'rgba(239, 68, 68, 0.2)\'),\n                (e.currentTarget.style.color = \'#ff4444\')\n              )\n            "\n          >\n            Ã—\n          </button>\n        </div>\n\n        \x3c!-- æ–‡ä»¶åˆ—è¡¨ --\x3e\n        <div\n          v-if="currentId && currentProject"\n          style="margin-top: 20px; border-top: 1px solid #3a3a3a; padding-top: 15px"\n        >\n          <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px">\n            <h4 style="margin: 0; color: #fff; font-size: 13px; font-weight: 600">æ–‡ä»¶</h4>\n            <div style="display: flex; gap: 5px">\n              <button\n                style="\n                  padding: 4px 8px;\n                  background: #444;\n                  border: none;\n                  border-radius: 5px;\n                  color: #e0e0e0;\n                  font-size: 11px;\n                  cursor: pointer;\n                  transition: all 0.2s;\n                  display: flex;\n                  align-items: center;\n                  gap: 4px;\n                "\n                title="æ–°å»ºæ–‡ä»¶å¤¹"\n                @click="createNewFolder"\n                @mouseenter="(e: any) => (e.currentTarget.style.background = \'#555\')"\n                @mouseleave="(e: any) => (e.currentTarget.style.background = \'#444\')"\n              >\n                <i class="fa-solid fa-folder-plus" style="font-size: 10px"></i>\n              </button>\n              <button\n                style="\n                  padding: 4px 8px;\n                  background: #10b981;\n                  border: none;\n                  border-radius: 5px;\n                  color: white;\n                  font-size: 11px;\n                  cursor: pointer;\n                  transition: all 0.2s;\n                  display: flex;\n                  align-items: center;\n                  gap: 4px;\n                "\n                title="æ–°å»ºæ–‡ä»¶"\n                @click="showNewFileDialog"\n                @mouseenter="(e: any) => (e.currentTarget.style.background = \'#059669\')"\n                @mouseleave="(e: any) => (e.currentTarget.style.background = \'#10b981\')"\n              >\n                <i class="fa-solid fa-plus" style="font-size: 10px"></i>\n              </button>\n            </div>\n          </div>\n          <div\n            v-for="file in currentProject.files"\n            :key="file.path"\n            :style="{\n              padding: \'8px 10px\',\n              marginBottom: \'5px\',\n              background: currentFile === file.path ? \'#10b981\' : \'#1e1e1e\',\n              borderRadius: \'6px\',\n              cursor: \'pointer\',\n              transition: \'all 0.2s ease\',\n              color: currentFile === file.path ? \'#fff\' : \'#e0e0e0\',\n              fontSize: \'12px\',\n              display: \'flex\',\n              justifyContent: \'space-between\',\n              alignItems: \'center\',\n            }"\n            @click="selectFile(file.path)"\n            @mouseenter="(e: any) => currentFile !== file.path && (e.currentTarget.style.background = \'#3a3a3a\')"\n            @mouseleave="(e: any) => currentFile !== file.path && (e.currentTarget.style.background = \'#1e1e1e\')"\n          >\n            <span>\n              <i :class="getFileIcon(file.path)" style="margin-right: 6px"></i>\n              {{ file.name }}\n            </span>\n            <button\n              style="\n                width: 18px;\n                height: 18px;\n                background: rgba(239, 68, 68, 0.2);\n                border: none;\n                border-radius: 3px;\n                color: #ff4444;\n                font-size: 12px;\n                line-height: 1;\n                cursor: pointer;\n                opacity: 0;\n                transition: all 0.2s ease;\n              "\n              title="åˆ é™¤æ–‡ä»¶"\n              @click.stop="deleteFile(file.path)"\n              @mouseenter="\n                (e: any) => (\n                  (e.currentTarget.style.opacity = \'1\'),\n                  (e.currentTarget.style.background = \'#ef4444\'),\n                  (e.currentTarget.style.color = \'#fff\')\n                )\n              "\n              @mouseleave="\n                (e: any) => (\n                  (e.currentTarget.style.opacity = \'0.6\'),\n                  (e.currentTarget.style.background = \'rgba(239, 68, 68, 0.2)\'),\n                  (e.currentTarget.style.color = \'#ff4444\')\n                )\n              "\n            >\n              Ã—\n            </button>\n          </div>\n        </div>\n      </div>\n\n      \x3c!-- ä¸­é—´ï¼šä»£ç ç¼–è¾‘å™¨ --\x3e\n      <div\n        style="\n          background: #2a2a2a;\n          border-radius: 12px;\n          padding: 15px;\n          border: 1px solid #3a3a3a;\n          display: flex;\n          flex-direction: column;\n        "\n      >\n        <div\n          v-if="!currentId"\n          style="flex: 1; display: flex; align-items: center; justify-content: center; color: #666; font-size: 14px"\n        >\n          â† è¯·é€‰æ‹©ä¸€ä¸ªé¡¹ç›®\n        </div>\n        <div\n          v-else-if="!currentFile"\n          style="flex: 1; display: flex; align-items: center; justify-content: center; color: #666; font-size: 14px"\n        >\n          â† è¯·é€‰æ‹©ä¸€ä¸ªæ–‡ä»¶\n        </div>\n        <div v-else style="display: flex; flex-direction: column; height: 100%">\n          <div style="margin-bottom: 10px; display: flex; justify-content: space-between; align-items: center">\n            <div style="display: flex; align-items: center; gap: 8px">\n              <i :class="getFileIcon(currentFile)" style="color: #4a9eff"></i>\n              <span style="color: #fff; font-size: 14px; font-weight: 500">{{ currentFile }}</span>\n            </div>\n            <div style="display: flex; align-items: center; gap: 10px">\n              <span style="color: #888; font-size: 11px">\n                <i class="fa-solid fa-circle-check" style="color: #10b981; margin-right: 4px"></i>\n                è‡ªåŠ¨ä¿å­˜\n              </span>\n              <button\n                style="\n                  padding: 6px 12px;\n                  background: linear-gradient(135deg, #10b981 0%, #059669 100%);\n                  border: none;\n                  border-radius: 6px;\n                  color: white;\n                  font-size: 12px;\n                  font-weight: 600;\n                  cursor: pointer;\n                  transition: all 0.2s ease;\n                "\n                @click="saveCode"\n                @mouseenter="(e: any) => (e.currentTarget.style.transform = \'translateY(-1px)\')"\n                @mouseleave="(e: any) => (e.currentTarget.style.transform = \'translateY(0)\')"\n              >\n                <i class="fa-solid fa-floppy-disk" style="margin-right: 4px"></i>\n                æ‰‹åŠ¨ä¿å­˜\n              </button>\n            </div>\n          </div>\n          <textarea\n            v-model="code"\n            :placeholder="`åœ¨è¿™é‡Œç¼–å†™ ${currentFile.split(\'.\').pop()?.toUpperCase()} ä»£ç ...`"\n            style="\n              flex: 1;\n              background: #1e1e1e;\n              border: 1px solid #3a3a3a;\n              border-radius: 8px;\n              color: #e0e0e0;\n              font-family: \'Consolas\', \'Monaco\', monospace;\n              font-size: 13px;\n              line-height: 1.6;\n              padding: 15px;\n              resize: none;\n              outline: none;\n              min-height: 400px;\n            "\n          ></textarea>\n        </div>\n      </div>\n\n      \x3c!-- å³ä¾§ï¼šå®æ—¶é¢„è§ˆ --\x3e\n      <div\n        style="\n          background: #2a2a2a;\n          border-radius: 12px;\n          padding: 15px;\n          border: 1px solid #3a3a3a;\n          display: flex;\n          flex-direction: column;\n        "\n      >\n        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px">\n          <h4 style="margin: 0; color: #fff; font-size: 14px; font-weight: 600">\n            <i class="fa-solid fa-eye" style="margin-right: 8px; color: #4a9eff"></i>\n            å®æ—¶é¢„è§ˆ\n          </h4>\n          <div style="display: flex; gap: 8px">\n            <button\n              v-if="previewHtml"\n              title="æ–°çª—å£æ‰“å¼€"\n              style="\n                width: 28px;\n                height: 28px;\n                padding: 0;\n                background: #3a3a3a;\n                border: none;\n                border-radius: 6px;\n                color: #e0e0e0;\n                cursor: pointer;\n                display: flex;\n                align-items: center;\n                justify-content: center;\n                transition: all 0.2s ease;\n              "\n              @click="openInNewWindow"\n              @mouseenter="(e: any) => (e.currentTarget.style.background = \'#4a9eff\')"\n              @mouseleave="(e: any) => (e.currentTarget.style.background = \'#3a3a3a\')"\n            >\n              <i class="fa-solid fa-external-link-alt" style="font-size: 12px"></i>\n            </button>\n          </div>\n        </div>\n        <div\n          style="\n            flex: 1;\n            background: #1e1e1e;\n            border-radius: 8px;\n            overflow: auto;\n            position: relative;\n            min-height: 400px;\n          "\n        >\n          <iframe\n            v-if="previewHtml"\n            :srcdoc="previewHtml"\n            sandbox="allow-scripts allow-same-origin allow-modals allow-forms"\n            style="width: 100%; height: 100%; border: none; background: white"\n          ></iframe>\n          <div\n            v-else\n            style="\n              position: absolute;\n              top: 50%;\n              left: 50%;\n              transform: translate(-50%, -50%);\n              color: #666;\n              font-size: 12px;\n              text-align: center;\n            "\n          >\n            ä¿å­˜ä»£ç åå°†æ˜¾ç¤ºé¢„è§ˆ\n          </div>\n        </div>\n      </div>\n    </div>\n\n    \x3c!-- AI æ™ºèƒ½ç¼–å†™å¯¹è¯æ¡† --\x3e\n    <div\n      v-if="showAI"\n      style="\n        position: fixed;\n        top: 0;\n        left: 0;\n        right: 0;\n        bottom: 0;\n        background: rgba(0, 0, 0, 0.8);\n        display: flex;\n        align-items: center;\n        justify-content: center;\n        z-index: 10000;\n      "\n      @click.self="closeAIDialog"\n    >\n      <div\n        style="\n          background: #2a2a2a;\n          border-radius: 12px;\n          padding: 25px;\n          width: 90%;\n          max-width: 600px;\n          border: 1px solid #3a3a3a;\n          box-shadow: 0 10px 40px rgba(0, 0, 0, 0.5);\n        "\n      >\n        <h3\n          style="\n            margin: 0 0 20px 0;\n            color: #fff;\n            font-size: 18px;\n            font-weight: 600;\n            display: flex;\n            align-items: center;\n            gap: 10px;\n          "\n        >\n          <i class="fa-solid fa-wand-magic-sparkles" style="color: #8b5cf6"></i>\n          AI æ™ºèƒ½ç¼–å†™\n        </h3>\n\n        <div style="margin-bottom: 15px">\n          <label style="display: block; margin-bottom: 8px; color: #ccc; font-size: 13px">\n            <i class="fa-solid fa-pencil" style="color: #8b5cf6; margin-right: 6px"></i>\n            è¯¦ç»†æè¿°ä½ çš„éœ€æ±‚ï¼ˆè¶Šè¯¦ç»†æ•ˆæœè¶Šå¥½ï¼‰ï¼š\n          </label>\n          <div\n            style="\n              margin-bottom: 10px;\n              padding: 10px 12px;\n              background: rgba(139, 92, 246, 0.1);\n              border-left: 3px solid #8b5cf6;\n              border-radius: 4px;\n              font-size: 12px;\n              color: #ccc;\n              line-height: 1.6;\n            "\n          >\n            <strong style="color: #8b5cf6">ğŸ’¡ æç¤ºï¼š</strong>\n            ä¸è¦åªè¯´"ä¼˜åŒ–"ã€"å®Œå–„"ï¼Œè¦å…·ä½“è¯´æ˜ä½ æƒ³è¦ä»€ä¹ˆæ•ˆæœã€ä»€ä¹ˆæ ·å¼ã€ä»€ä¹ˆåŠŸèƒ½ï¼\n          </div>\n          <textarea\n            v-model="aiPrompt"\n            placeholder="è¯·è¯¦ç»†æè¿°ä½ çš„éœ€æ±‚ï¼Œä¾‹å¦‚ï¼šæ·»åŠ ä¸€ä¸ªå“åº”å¼å¯¼èˆªæ ï¼Œå¸¦æ±‰å ¡èœå•å’Œå¹³æ»‘æ»šåŠ¨æ•ˆæœ..."\n            style="\n              width: 100%;\n              height: 120px;\n              background: #1e1e1e;\n              border: 1px solid #3a3a3a;\n              border-radius: 8px;\n              color: #e0e0e0;\n              font-size: 13px;\n              line-height: 1.6;\n              padding: 12px;\n              resize: none;\n              outline: none;\n            "\n          ></textarea>\n\n          \x3c!-- å¿«æ·å»ºè®® --\x3e\n          <div style="margin-top: 12px">\n            <div style="color: #888; font-size: 12px; margin-bottom: 8px">\n              <i class="fa-solid fa-lightbulb" style="color: #fbbf24; margin-right: 4px"></i>\n              å¿«æ·å»ºè®®ï¼ˆç‚¹å‡»å¡«å…¥ï¼‰ï¼š\n            </div>\n            <div style="display: flex; flex-wrap: wrap; gap: 8px">\n              <button\n                v-for="suggestion in quickSuggestions"\n                :key="suggestion"\n                style="\n                  padding: 6px 12px;\n                  background: #2a2a2a;\n                  border: 1px solid #3a3a3a;\n                  border-radius: 6px;\n                  color: #ccc;\n                  font-size: 12px;\n                  cursor: pointer;\n                  transition: all 0.2s;\n                "\n                @click="aiPrompt = suggestion"\n                @mouseenter="(e: any) => (e.currentTarget.style.background = \'#3a3a3a\')"\n                @mouseleave="(e: any) => (e.currentTarget.style.background = \'#2a2a2a\')"\n              >\n                {{ suggestion }}\n              </button>\n            </div>\n          </div>\n        </div>\n\n        \x3c!-- æµå¼ä¼ è¾“å¼€å…³ --\x3e\n        <div\n          style="\n            display: flex;\n            align-items: center;\n            gap: 10px;\n            margin-bottom: 15px;\n            padding: 10px;\n            background: #252525;\n            border-radius: 6px;\n          "\n        >\n          <label\n            style="\n              display: flex;\n              align-items: center;\n              gap: 8px;\n              cursor: pointer;\n              color: #ccc;\n              font-size: 13px;\n              user-select: none;\n            "\n          >\n            <input v-model="enableStream" type="checkbox" style="width: 16px; height: 16px; cursor: pointer" />\n            <i class="fa-solid fa-water" style="color: #4a9eff"></i>\n            å¯ç”¨æµå¼ä¼ è¾“\n          </label>\n          <span style="color: #888; font-size: 12px"> ï¼ˆå®æ—¶æŸ¥çœ‹ç”Ÿæˆè¿‡ç¨‹ï¼Œä½“éªŒæ›´æµç•…ï¼‰ </span>\n        </div>\n\n        \x3c!-- æµå¼ä¼ è¾“å®æ—¶æ˜¾ç¤ºåŒºåŸŸ --\x3e\n        <div\n          v-if="aiGenerating && enableStream && streamingText"\n          style="\n            margin-bottom: 15px;\n            padding: 15px;\n            background: #1e1e1e;\n            border: 1px solid #3a3a3a;\n            border-radius: 6px;\n            max-height: 200px;\n            overflow-y: auto;\n            font-family: \'Consolas\', monospace;\n            font-size: 12px;\n            color: #e0e0e0;\n            line-height: 1.5;\n            white-space: pre-wrap;\n          "\n        >\n          {{ streamingText }}\n          <span style="animation: blink 1s infinite">â–Š</span>\n        </div>\n\n        <div style="display: flex; gap: 10px; justify-content: flex-end">\n          <button\n            style="\n              padding: 8px 16px;\n              background: #3a3a3a;\n              border: none;\n              border-radius: 6px;\n              color: #e0e0e0;\n              font-size: 13px;\n              cursor: pointer;\n              transition: all 0.2s ease;\n            "\n            @click="closeAIDialog"\n            @mouseenter="(e: any) => (e.currentTarget.style.background = \'#4a4a4a\')"\n            @mouseleave="(e: any) => (e.currentTarget.style.background = \'#3a3a3a\')"\n          >\n            å–æ¶ˆ\n          </button>\n          <button\n            :disabled="aiGenerating || !aiPrompt.trim()"\n            style="\n              padding: 8px 16px;\n              background: linear-gradient(135deg, #8b5cf6 0%, #7c3aed 100%);\n              border: none;\n              border-radius: 6px;\n              color: white;\n              font-size: 13px;\n              font-weight: 600;\n              cursor: pointer;\n              transition: all 0.2s ease;\n            "\n            :style="{\n              opacity: aiGenerating || !aiPrompt.trim() ? 0.5 : 1,\n              cursor: aiGenerating || !aiPrompt.trim() ? \'not-allowed\' : \'pointer\',\n            }"\n            @click="generateWithAI"\n          >\n            <i v-if="!aiGenerating" class="fa-solid fa-wand-magic-sparkles" style="margin-right: 6px"></i>\n            <i v-else class="fa-solid fa-spinner fa-spin" style="margin-right: 6px"></i>\n            {{ aiGenerating ? \'ç”Ÿæˆä¸­...\' : \'å¼€å§‹ç”Ÿæˆ\' }}\n          </button>\n        </div>\n      </div>\n    </div>\n\n    \x3c!-- Bug ä¿®å¤å¯¹è¯æ¡† --\x3e\n    <div\n      v-if="showBugFix"\n      style="\n        position: fixed;\n        top: 0;\n        left: 0;\n        right: 0;\n        bottom: 0;\n        background: rgba(0, 0, 0, 0.8);\n        display: flex;\n        align-items: center;\n        justify-content: center;\n        z-index: 10000;\n      "\n      @click.self="closeBugFixDialog"\n    >\n      <div\n        style="\n          background: #2a2a2a;\n          border-radius: 12px;\n          padding: 25px;\n          width: 90%;\n          max-width: 650px;\n          border: 1px solid #3a3a3a;\n          box-shadow: 0 10px 40px rgba(0, 0, 0, 0.5);\n        "\n      >\n        <h3\n          style="\n            margin: 0 0 20px 0;\n            color: #fff;\n            font-size: 18px;\n            font-weight: 600;\n            display: flex;\n            align-items: center;\n            gap: 10px;\n          "\n        >\n          <i class="fa-solid fa-bug" style="color: #ef4444"></i>\n          Bug ä¿®å¤åŠ©æ‰‹\n        </h3>\n\n        \x3c!-- é—®é¢˜æè¿° --\x3e\n        <div style="margin-bottom: 15px">\n          <label style="display: block; margin-bottom: 8px; color: #ccc; font-size: 13px; font-weight: 600">\n            <i class="fa-solid fa-circle-exclamation" style="color: #f59e0b; margin-right: 6px"></i>\n            å“ªé‡Œæœ‰é—®é¢˜ï¼Ÿï¼ˆå¿…å¡«ï¼‰\n          </label>\n          <textarea\n            v-model="bugDescription"\n            placeholder="ä¾‹å¦‚ï¼šç‚¹å‡»å‘é€æŒ‰é’®æ²¡æœ‰ååº”&#10;æˆ–è€…ï¼šæ¶ˆæ¯åˆ—è¡¨ä¸æ˜¾ç¤ºå†…å®¹&#10;æˆ–è€…ï¼šè¾“å…¥æ¡†è¾“å…¥åæ•°æ®æ²¡æœ‰ä¿å­˜"\n            style="\n              width: 100%;\n              height: 90px;\n              background: #1e1e1e;\n              border: 1px solid #3a3a3a;\n              border-radius: 8px;\n              color: #e0e0e0;\n              font-size: 13px;\n              line-height: 1.6;\n              padding: 12px;\n              resize: none;\n              outline: none;\n            "\n          ></textarea>\n        </div>\n\n        \x3c!-- Console é”™è¯¯ä¿¡æ¯ --\x3e\n        <div style="margin-bottom: 15px">\n          <label style="display: block; margin-bottom: 8px; color: #ccc; font-size: 13px; font-weight: 600">\n            <i class="fa-solid fa-terminal" style="color: #ef4444; margin-right: 6px"></i>\n            æµè§ˆå™¨ Console é”™è¯¯ä¿¡æ¯ï¼ˆæŒ‰ F12 æŸ¥çœ‹ï¼‰\n          </label>\n          <textarea\n            v-model="consoleError"\n            placeholder="å¦‚æœæµè§ˆå™¨ Console ä¸­æœ‰çº¢è‰²é”™è¯¯ï¼Œè¯·å¤åˆ¶ç²˜è´´åˆ°è¿™é‡Œ&#10;ä¾‹å¦‚ï¼šUncaught TypeError: xxx is not a function&#10;&#10;å¦‚æœæ²¡æœ‰é”™è¯¯ï¼Œç•™ç©ºå³å¯"\n            style="\n              width: 100%;\n              height: 80px;\n              background: #1e1e1e;\n              border: 1px solid #3a3a3a;\n              border-radius: 8px;\n              color: #ff6b6b;\n              font-size: 12px;\n              font-family: \'Consolas\', monospace;\n              line-height: 1.5;\n              padding: 12px;\n              resize: none;\n              outline: none;\n            "\n          ></textarea>\n        </div>\n\n        \x3c!-- é—®é¢˜æ–‡ä»¶ --\x3e\n        <div style="margin-bottom: 15px">\n          <label style="display: block; margin-bottom: 8px; color: #ccc; font-size: 13px; font-weight: 600">\n            <i class="fa-solid fa-file-code" style="color: #4a9eff; margin-right: 6px"></i>\n            é—®é¢˜å¯èƒ½åœ¨å“ªä¸ªæ–‡ä»¶ï¼Ÿ\n          </label>\n          <select\n            v-model="bugFile"\n            style="\n              width: 100%;\n              background: #1e1e1e;\n              border: 1px solid #3a3a3a;\n              border-radius: 8px;\n              color: #e0e0e0;\n              font-size: 13px;\n              padding: 10px 12px;\n              outline: none;\n              cursor: pointer;\n            "\n          >\n            <option value="">è®© AI è‡ªåŠ¨åˆ¤æ–­</option>\n            <option value="index.html">HTML æ–‡ä»¶ï¼ˆindex.htmlï¼‰</option>\n            <option value="style.css">CSS æ–‡ä»¶ï¼ˆstyle.cssï¼‰</option>\n            <option value="script.js">JavaScript æ–‡ä»¶ï¼ˆscript.jsï¼‰</option>\n          </select>\n        </div>\n\n        \x3c!-- æç¤ºä¿¡æ¯ --\x3e\n        <div\n          style="\n            padding: 12px;\n            background: rgba(74, 158, 255, 0.1);\n            border: 1px solid rgba(74, 158, 255, 0.3);\n            border-radius: 6px;\n            margin-bottom: 15px;\n          "\n        >\n          <p style="margin: 0; color: #4a9eff; font-size: 12px; line-height: 1.6">\n            <i class="fa-solid fa-lightbulb" style="margin-right: 6px"></i>\n            <strong>æç¤ºï¼š</strong>AI ä¼šä¸“æ³¨äºä¿®å¤è¿™ä¸ªå…·ä½“çš„ bugï¼Œä¸ä¼šæ”¹åŠ¨å…¶ä»–åŠŸèƒ½ã€‚å¦‚æœæœ‰ Console\n            é”™è¯¯ä¿¡æ¯ï¼Œä¿®å¤æˆåŠŸç‡ä¼šæ›´é«˜ï¼\n          </p>\n        </div>\n\n        <div style="display: flex; gap: 10px; justify-content: flex-end">\n          <button\n            style="\n              padding: 8px 16px;\n              background: #3a3a3a;\n              border: none;\n              border-radius: 6px;\n              color: #e0e0e0;\n              font-size: 13px;\n              cursor: pointer;\n              transition: all 0.2s ease;\n            "\n            @click="closeBugFixDialog"\n            @mouseenter="(e: any) => (e.currentTarget.style.background = \'#4a4a4a\')"\n            @mouseleave="(e: any) => (e.currentTarget.style.background = \'#3a3a3a\')"\n          >\n            å–æ¶ˆ\n          </button>\n          <button\n            :disabled="aiGenerating || !bugDescription.trim()"\n            style="\n              padding: 8px 16px;\n              background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);\n              border: none;\n              border-radius: 6px;\n              color: white;\n              font-size: 13px;\n              font-weight: 600;\n              cursor: pointer;\n              transition: all 0.2s ease;\n            "\n            :style="{\n              opacity: aiGenerating || !bugDescription.trim() ? 0.5 : 1,\n              cursor: aiGenerating || !bugDescription.trim() ? \'not-allowed\' : \'pointer\',\n            }"\n            @click="fixBugWithAI"\n          >\n            <i v-if="!aiGenerating" class="fa-solid fa-wrench" style="margin-right: 6px"></i>\n            <i v-else class="fa-solid fa-spinner fa-spin" style="margin-right: 6px"></i>\n            {{ aiGenerating ? \'ä¿®å¤ä¸­...\' : \'å¼€å§‹ä¿®å¤\' }}\n          </button>\n        </div>\n      </div>\n    </div>\n\n    \x3c!-- AI ç”Ÿæˆç»“æœå¯¹æ¯”å¯¹è¯æ¡† --\x3e\n    <div\n      v-if="showComparison"\n      style="\n        position: fixed;\n        top: 0;\n        left: 0;\n        right: 0;\n        bottom: 0;\n        background: rgba(0, 0, 0, 0.9);\n        display: flex;\n        align-items: center;\n        justify-content: center;\n        z-index: 10001;\n        padding: 20px;\n      "\n    >\n      <div\n        style="\n          background: #2a2a2a;\n          border-radius: 12px;\n          width: 95%;\n          height: 90%;\n          border: 1px solid #3a3a3a;\n          box-shadow: 0 10px 40px rgba(0, 0, 0, 0.5);\n          display: flex;\n          flex-direction: column;\n        "\n      >\n        \x3c!-- æ ‡é¢˜æ  --\x3e\n        <div\n          style="\n            padding: 20px 25px;\n            border-bottom: 1px solid #3a3a3a;\n            display: flex;\n            justify-content: space-between;\n            align-items: center;\n          "\n        >\n          <h3\n            style="\n              margin: 0;\n              color: #fff;\n              font-size: 18px;\n              font-weight: 600;\n              display: flex;\n              align-items: center;\n              gap: 10px;\n            "\n          >\n            <i class="fa-solid fa-code-compare" style="color: #8b5cf6"></i>\n            AI ç”Ÿæˆç»“æœå¯¹æ¯”\n          </h3>\n          <div style="display: flex; gap: 10px">\n            <button\n              style="\n                padding: 8px 16px;\n                background: #ef4444;\n                border: none;\n                border-radius: 6px;\n                color: white;\n                font-size: 13px;\n                cursor: pointer;\n                transition: all 0.2s ease;\n              "\n              @click="rejectChanges"\n              @mouseenter="(e: any) => (e.currentTarget.style.background = \'#dc2626\')"\n              @mouseleave="(e: any) => (e.currentTarget.style.background = \'#ef4444\')"\n            >\n              <i class="fa-solid fa-xmark" style="margin-right: 6px"></i>\n              æ‹’ç»\n            </button>\n            <button\n              style="\n                padding: 8px 16px;\n                background: #10b981;\n                border: none;\n                border-radius: 6px;\n                color: white;\n                font-size: 13px;\n                font-weight: 500;\n                cursor: pointer;\n                transition: all 0.2s;\n              "\n              @click="acceptChanges"\n              @mouseenter="(e: any) => (e.currentTarget.style.background = \'#059669\')"\n              @mouseleave="(e: any) => (e.currentTarget.style.background = \'#10b981\')"\n            >\n              <i class="fa-solid fa-check" style="margin-right: 6px"></i>\n              åº”ç”¨æ›´æ”¹\n            </button>\n          </div>\n        </div>\n\n        \x3c!-- å†…å®¹åŒº --\x3e\n        <div\n          style="\n            flex: 1;\n            display: grid;\n            grid-template-columns: 1fr 1fr 1.5fr;\n            gap: 15px;\n            padding: 20px;\n            overflow: hidden;\n          "\n        >\n          \x3c!-- ä¿®æ”¹å‰ä»£ç  --\x3e\n          <div style="display: flex; flex-direction: column; background: #1e1e1e; border-radius: 8px; overflow: hidden">\n            <div style="padding: 12px 15px; background: #2a2a2a; border-bottom: 1px solid #3a3a3a">\n              <h4 style="margin: 0; color: #fff; font-size: 14px; font-weight: 600">\n                <i class="fa-solid fa-file-code" style="margin-right: 8px; color: #ef4444"></i>\n                ä¿®æ”¹å‰\n              </h4>\n            </div>\n            <div style="flex: 1; overflow-y: auto; padding: 15px">\n              <div v-for="change in aiChanges" :key="change.path" style="margin-bottom: 20px">\n                <div\n                  style="\n                    color: #4a9eff;\n                    font-size: 12px;\n                    font-weight: 600;\n                    margin-bottom: 8px;\n                    display: flex;\n                    align-items: center;\n                    gap: 6px;\n                  "\n                >\n                  <i :class="getFileIcon(change.path)"></i>\n                  {{ change.path }}\n                </div>\n                <pre\n                  style="\n                    margin: 0;\n                    padding: 12px;\n                    background: #1a1a1a;\n                    border-radius: 6px;\n                    color: #e0e0e0;\n                    font-family: \'Consolas\', \'Monaco\', monospace;\n                    font-size: 12px;\n                    line-height: 1.5;\n                    overflow-x: auto;\n                    border: 1px solid #3a3a3a;\n                  "\n                  >{{ change.oldContent }}</pre\n                >\n              </div>\n            </div>\n          </div>\n\n          \x3c!-- ä¿®æ”¹åä»£ç  --\x3e\n          <div style="display: flex; flex-direction: column; background: #1e1e1e; border-radius: 8px; overflow: hidden">\n            <div style="padding: 12px 15px; background: #2a2a2a; border-bottom: 1px solid #3a3a3a">\n              <h4 style="margin: 0; color: #fff; font-size: 14px; font-weight: 600">\n                <i class="fa-solid fa-file-code" style="margin-right: 8px; color: #10b981"></i>\n                ä¿®æ”¹å\n              </h4>\n            </div>\n            <div style="flex: 1; overflow-y: auto; padding: 15px">\n              <div v-for="change in aiChanges" :key="change.path" style="margin-bottom: 20px">\n                <div\n                  style="\n                    color: #4a9eff;\n                    font-size: 12px;\n                    font-weight: 600;\n                    margin-bottom: 8px;\n                    display: flex;\n                    align-items: center;\n                    gap: 6px;\n                  "\n                >\n                  <i :class="getFileIcon(change.path)"></i>\n                  {{ change.path }}\n                </div>\n                <pre\n                  style="\n                    margin: 0;\n                    padding: 12px;\n                    background: #1a1a1a;\n                    border-radius: 6px;\n                    color: #e0e0e0;\n                    font-family: \'Consolas\', \'Monaco\', monospace;\n                    font-size: 12px;\n                    line-height: 1.5;\n                    overflow-x: auto;\n                    border: 1px solid #3a3a3a;\n                  "\n                  >{{ change.newContent }}</pre\n                >\n              </div>\n            </div>\n          </div>\n\n          \x3c!-- é¢„è§ˆæ•ˆæœ --\x3e\n          <div style="display: flex; flex-direction: column; background: #1e1e1e; border-radius: 8px; overflow: hidden">\n            <div\n              style="\n                padding: 12px 15px;\n                background: #2a2a2a;\n                border-bottom: 1px solid #3a3a3a;\n                display: flex;\n                justify-content: space-between;\n                align-items: center;\n              "\n            >\n              <h4 style="margin: 0; color: #fff; font-size: 14px; font-weight: 600">\n                <i class="fa-solid fa-eye" style="margin-right: 8px; color: #4a9eff"></i>\n                é¢„è§ˆæ•ˆæœ\n              </h4>\n              <div style="display: flex; gap: 8px">\n                <button\n                  :style="{\n                    padding: \'4px 10px\',\n                    background: previewMode === \'before\' ? \'#ef4444\' : \'#3a3a3a\',\n                    border: \'none\',\n                    borderRadius: \'4px\',\n                    color: \'white\',\n                    fontSize: \'11px\',\n                    cursor: \'pointer\',\n                    transition: \'all 0.2s ease\',\n                  }"\n                  @click="previewMode = \'before\'"\n                >\n                  ä¿®æ”¹å‰\n                </button>\n                <button\n                  :style="{\n                    padding: \'4px 10px\',\n                    background: previewMode === \'after\' ? \'#10b981\' : \'#3a3a3a\',\n                    border: \'none\',\n                    borderRadius: \'4px\',\n                    color: \'white\',\n                    fontSize: \'11px\',\n                    cursor: \'pointer\',\n                    transition: \'all 0.2s ease\',\n                  }"\n                  @click="previewMode = \'after\'"\n                >\n                  ä¿®æ”¹å\n                </button>\n              </div>\n            </div>\n            <div style="flex: 1; background: white; overflow: hidden">\n              <iframe\n                :srcdoc="comparisonPreviewHtml"\n                sandbox="allow-scripts allow-same-origin allow-modals allow-forms"\n                style="width: 100%; height: 100%; border: none"\n              ></iframe>\n            </div>\n          </div>\n        </div>\n      </div>\n    </div>\n\n    \x3c!-- å†å²è®°å½•å¯¹è¯æ¡† --\x3e\n    <div\n      v-if="showHistory"\n      style="\n        position: fixed;\n        top: 0;\n        left: 0;\n        right: 0;\n        bottom: 0;\n        background: rgba(0, 0, 0, 0.8);\n        display: flex;\n        align-items: center;\n        justify-content: center;\n        z-index: 10000;\n        padding: 20px;\n      "\n      @click.self="closeHistoryDialog"\n    >\n      <div\n        style="\n          background: #2a2a2a;\n          border-radius: 12px;\n          width: 90%;\n          max-width: 900px;\n          max-height: 80%;\n          border: 1px solid #3a3a3a;\n          box-shadow: 0 10px 40px rgba(0, 0, 0, 0.5);\n          display: flex;\n          flex-direction: column;\n        "\n      >\n        <div\n          style="\n            padding: 20px 25px;\n            border-bottom: 1px solid #3a3a3a;\n            display: flex;\n            justify-content: space-between;\n            align-items: center;\n          "\n        >\n          <h3\n            style="\n              margin: 0;\n              color: #fff;\n              font-size: 18px;\n              font-weight: 600;\n              display: flex;\n              align-items: center;\n              gap: 10px;\n            "\n          >\n            <i class="fa-solid fa-history" style="color: #f59e0b"></i>\n            AI ç¼–å†™å†å²\n          </h3>\n          <button\n            style="\n              width: 28px;\n              height: 28px;\n              background: #3a3a3a;\n              border: none;\n              border-radius: 6px;\n              color: #e0e0e0;\n              cursor: pointer;\n              transition: all 0.2s ease;\n            "\n            @click="closeHistoryDialog"\n            @mouseenter="(e: any) => (e.currentTarget.style.background = \'#4a4a4a\')"\n            @mouseleave="(e: any) => (e.currentTarget.style.background = \'#3a3a3a\')"\n          >\n            Ã—\n          </button>\n        </div>\n        <div style="flex: 1; overflow-y: auto; padding: 20px">\n          <div v-if="currentProjectHistory.length === 0" style="text-align: center; color: #666; padding: 40px 20px">\n            <i class="fa-solid fa-inbox" style="font-size: 48px; margin-bottom: 15px; opacity: 0.3"></i>\n            <p>æš‚æ— å†å²è®°å½•</p>\n          </div>\n          <div\n            v-for="(record, index) in currentProjectHistory"\n            :key="index"\n            style="\n              background: #1e1e1e;\n              border-radius: 8px;\n              padding: 15px;\n              margin-bottom: 15px;\n              border: 1px solid #3a3a3a;\n            "\n          >\n            <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 10px">\n              <div>\n                <div style="color: #fff; font-size: 14px; font-weight: 600; margin-bottom: 5px">\n                  {{ record.prompt }}\n                </div>\n                <div style="color: #888; font-size: 12px">\n                  {{ new Date(record.timestamp).toLocaleString(\'zh-CN\') }}\n                </div>\n              </div>\n              <button\n                style="\n                  padding: 6px 12px;\n                  background: #4a9eff;\n                  border: none;\n                  border-radius: 6px;\n                  color: white;\n                  font-size: 12px;\n                  font-weight: 500;\n                  cursor: pointer;\n                  transition: all 0.2s;\n                "\n                @click="restoreHistory(record)"\n                @mouseenter="(e: any) => (e.currentTarget.style.background = \'#3b82f6\')"\n                @mouseleave="(e: any) => (e.currentTarget.style.background = \'#4a9eff\')"\n              >\n                <i class="fa-solid fa-undo" style="margin-right: 4px"></i>\n                æ¢å¤\n              </button>\n            </div>\n            <div style="color: #ccc; font-size: 13px; margin-top: 10px">\n              <strong>ä¿®æ”¹çš„æ–‡ä»¶ï¼š</strong>\n              <div style="margin-top: 5px; display: flex; flex-wrap: wrap; gap: 8px">\n                <span\n                  v-for="change in record.changes"\n                  :key="change.path"\n                  style="\n                    background: #2a2a2a;\n                    padding: 4px 10px;\n                    border-radius: 4px;\n                    font-size: 12px;\n                    display: inline-flex;\n                    align-items: center;\n                    gap: 6px;\n                  "\n                >\n                  <i :class="getFileIcon(change.path)"></i>\n                  {{ change.path }}\n                </span>\n              </div>\n            </div>\n          </div>\n        </div>\n      </div>\n    </div>\n\n    \x3c!-- é¡¹ç›®æ¨¡æ¿é€‰æ‹©å¯¹è¯æ¡† --\x3e\n    <div\n      v-if="showProjectTemplate"\n      style="\n        position: fixed;\n        top: 0;\n        left: 0;\n        right: 0;\n        bottom: 0;\n        background: rgba(0, 0, 0, 0.8);\n        display: flex;\n        align-items: center;\n        justify-content: center;\n        z-index: 10000;\n        padding: 20px;\n      "\n      @click.self="showProjectTemplate = false"\n    >\n      <div\n        style="\n          background: #1e1e1e;\n          border-radius: 16px;\n          max-width: 850px;\n          width: 100%;\n          max-height: 90vh;\n          overflow-y: auto;\n          box-shadow: 0 20px 60px rgba(0, 0, 0, 0.8);\n          border: 1px solid #333;\n        "\n      >\n        \x3c!-- å¯¹è¯æ¡†å¤´éƒ¨ --\x3e\n        <div\n          style="\n            padding: 24px 28px;\n            border-bottom: 1px solid #2a2a2a;\n            display: flex;\n            justify-content: space-between;\n            align-items: center;\n          "\n        >\n          <h3\n            style="\n              margin: 0;\n              color: #fff;\n              font-size: 20px;\n              font-weight: 600;\n              display: flex;\n              align-items: center;\n              gap: 12px;\n            "\n          >\n            <span\n              style="\n                width: 40px;\n                height: 40px;\n                background: #2a2a2a;\n                border-radius: 10px;\n                display: flex;\n                align-items: center;\n                justify-content: center;\n                font-size: 20px;\n              "\n            >\n              ğŸ“\n            </span>\n            é€‰æ‹©é¡¹ç›®æ¨¡æ¿\n          </h3>\n          <button\n            style="\n              width: 36px;\n              height: 36px;\n              background: #2a2a2a;\n              border: none;\n              border-radius: 8px;\n              color: #888;\n              font-size: 18px;\n              cursor: pointer;\n              transition: all 0.2s;\n              display: flex;\n              align-items: center;\n              justify-content: center;\n            "\n            @click="showProjectTemplate = false"\n            @mouseenter="\n              (e: any) => {\n                e.currentTarget.style.background = \'#333\';\n                e.currentTarget.style.color = \'#fff\';\n              }\n            "\n            @mouseleave="\n              (e: any) => {\n                e.currentTarget.style.background = \'#2a2a2a\';\n                e.currentTarget.style.color = \'#888\';\n              }\n            "\n          >\n            <i class="fa-solid fa-times"></i>\n          </button>\n        </div>\n\n        \x3c!-- æ¨¡æ¿åˆ—è¡¨ --\x3e\n        <div style="padding: 28px">\n          <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(240px, 1fr)); gap: 20px">\n            \x3c!-- åŒå±‚å¯¹è¯ç•Œé¢ --\x3e\n            <div\n              style="\n                background: #252525;\n                border: 1px solid transparent;\n                border-radius: 12px;\n                padding: 24px;\n                cursor: pointer;\n                transition: all 0.25s cubic-bezier(0.4, 0, 0.2, 1);\n                box-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);\n              "\n              @click="createProjectFromTemplate(\'åŒå±‚å¯¹è¯ç•Œé¢\')"\n              @mouseenter="\n                (e: any) => {\n                  e.currentTarget.style.transform = \'translateY(-4px)\';\n                  e.currentTarget.style.borderColor = \'#555\';\n                  e.currentTarget.style.boxShadow = \'0 8px 24px rgba(0, 0, 0, 0.5)\';\n                }\n              "\n              @mouseleave="\n                (e: any) => {\n                  e.currentTarget.style.transform = \'translateY(0)\';\n                  e.currentTarget.style.borderColor = \'transparent\';\n                  e.currentTarget.style.boxShadow = \'0 2px 8px rgba(0, 0, 0, 0.3)\';\n                }\n              "\n            >\n              <div\n                style="\n                  width: 56px;\n                  height: 56px;\n                  background: #2a2a2a;\n                  border-radius: 12px;\n                  display: flex;\n                  align-items: center;\n                  justify-content: center;\n                  font-size: 28px;\n                  margin-bottom: 16px;\n                "\n              >\n                ğŸ’¬\n              </div>\n              <h4 style="margin: 0 0 8px 0; color: #fff; font-size: 17px; font-weight: 600">åŒå±‚å¯¹è¯ç•Œé¢</h4>\n              <p style="margin: 0; color: #999; font-size: 13px; line-height: 1.6">æµå¼å¯¹è¯ã€æ¶ˆæ¯å†å²ã€æ­£åˆ™æ¸…ç†</p>\n            </div>\n\n            \x3c!-- çŠ¶æ€æ é¢æ¿ --\x3e\n            <div\n              style="\n                background: #252525;\n                border: 1px solid transparent;\n                border-radius: 12px;\n                padding: 24px;\n                cursor: pointer;\n                transition: all 0.25s cubic-bezier(0.4, 0, 0.2, 1);\n                box-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);\n              "\n              @click="createProjectFromTemplate(\'çŠ¶æ€æ é¢æ¿\')"\n              @mouseenter="\n                (e: any) => {\n                  e.currentTarget.style.transform = \'translateY(-4px)\';\n                  e.currentTarget.style.borderColor = \'#555\';\n                  e.currentTarget.style.boxShadow = \'0 8px 24px rgba(0, 0, 0, 0.5)\';\n                }\n              "\n              @mouseleave="\n                (e: any) => {\n                  e.currentTarget.style.transform = \'translateY(0)\';\n                  e.currentTarget.style.borderColor = \'transparent\';\n                  e.currentTarget.style.boxShadow = \'0 2px 8px rgba(0, 0, 0, 0.3)\';\n                }\n              "\n            >\n              <div\n                style="\n                  width: 56px;\n                  height: 56px;\n                  background: #2a2a2a;\n                  border-radius: 12px;\n                  display: flex;\n                  align-items: center;\n                  justify-content: center;\n                  font-size: 28px;\n                  margin-bottom: 16px;\n                "\n              >\n                ğŸ“Š\n              </div>\n              <h4 style="margin: 0 0 8px 0; color: #fff; font-size: 17px; font-weight: 600">çŠ¶æ€æ é¢æ¿</h4>\n              <p style="margin: 0; color: #999; font-size: 13px; line-height: 1.6">HP/MP/ç»éªŒå€¼ï¼Œè¿›åº¦æ¡åŠ¨ç”»</p>\n            </div>\n\n            \x3c!-- å¥½æ„Ÿåº¦é¢æ¿ --\x3e\n            <div\n              style="\n                background: #252525;\n                border: 1px solid transparent;\n                border-radius: 12px;\n                padding: 24px;\n                cursor: pointer;\n                transition: all 0.25s cubic-bezier(0.4, 0, 0.2, 1);\n                box-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);\n              "\n              @click="createProjectFromTemplate(\'å¥½æ„Ÿåº¦é¢æ¿\')"\n              @mouseenter="\n                (e: any) => {\n                  e.currentTarget.style.transform = \'translateY(-4px)\';\n                  e.currentTarget.style.borderColor = \'#555\';\n                  e.currentTarget.style.boxShadow = \'0 8px 24px rgba(0, 0, 0, 0.5)\';\n                }\n              "\n              @mouseleave="\n                (e: any) => {\n                  e.currentTarget.style.transform = \'translateY(0)\';\n                  e.currentTarget.style.borderColor = \'transparent\';\n                  e.currentTarget.style.boxShadow = \'0 2px 8px rgba(0, 0, 0, 0.3)\';\n                }\n              "\n            >\n              <div\n                style="\n                  width: 56px;\n                  height: 56px;\n                  background: #2a2a2a;\n                  border-radius: 12px;\n                  display: flex;\n                  align-items: center;\n                  justify-content: center;\n                  font-size: 28px;\n                  margin-bottom: 16px;\n                "\n              >\n                ğŸ’\n              </div>\n              <h4 style="margin: 0 0 8px 0; color: #fff; font-size: 17px; font-weight: 600">å¥½æ„Ÿåº¦é¢æ¿</h4>\n              <p style="margin: 0; color: #999; font-size: 13px; line-height: 1.6">å¤šè§’è‰²å¡ç‰‡ï¼Œçˆ±å¿ƒå›¾æ ‡</p>\n            </div>\n          </div>\n\n          <div\n            style="\n              margin-top: 24px;\n              padding: 16px 18px;\n              background: #252525;\n              border: 1px solid #333;\n              border-radius: 10px;\n            "\n          >\n            <div\n              style="\n                color: #ccc;\n                font-weight: 500;\n                margin-bottom: 6px;\n                font-size: 13px;\n                display: flex;\n                align-items: center;\n                gap: 8px;\n              "\n            >\n              <span style="color: #fbbf24; font-size: 16px">ğŸ’¡</span>\n              ä½¿ç”¨æç¤º\n            </div>\n            <p style="margin: 0; color: #888; font-size: 13px; line-height: 1.7">\n              é€‰æ‹©æ¨¡æ¿åï¼Œä¼šè‡ªåŠ¨åˆ›å»ºåŒ…å«å®Œæ•´ä»£ç çš„é¡¹ç›®ï¼Œä½ å¯ä»¥ç›´æ¥é¢„è§ˆå’Œç¼–è¾‘\n            </p>\n          </div>\n        </div>\n      </div>\n    </div>\n\n    \x3c!-- è¿›åº¦å¯¹è¯æ¡† --\x3e\n    <ProgressDialog ref="progressDialogRef" :show="showProgress" title="AI æ­£åœ¨å¤„ç†" />\n  </div>\n</template>\n\n<script setup lang="ts">\nimport { computed, onBeforeUnmount, ref, watch, watchEffect } from \'vue\';\nimport { normalizeApiEndpoint } from \'../settings\';\nimport { getScriptIdSafe } from \'../utils\';\nimport ProgressDialog from \'./ProgressDialog.vue\';\n\ninterface ProjectFile {\n  path: string;\n  name: string;\n  content: string;\n}\n\ninterface Project {\n  id: string;\n  name: string;\n  files: ProjectFile[];\n}\n\ninterface AIChange {\n  path: string;\n  oldContent: string;\n  newContent: string;\n}\n\ninterface AIHistoryRecord {\n  timestamp: string;\n  prompt: string;\n  changes: AIChange[];\n}\n\nconst projects = ref<Project[]>([]);\nconst currentId = ref(\'\');\nconst currentFile = ref(\'\');\nconst code = ref(\'\');\nconst previewHtml = ref(\'\');\nconst showAI = ref(false);\nconst aiPrompt = ref(\'\');\nconst aiGenerating = ref(false);\nconst enableStream = ref(false); // æ˜¯å¦å¯ç”¨æµå¼ä¼ è¾“\nconst streamingText = ref(\'\'); // æµå¼ä¼ è¾“çš„å®æ—¶æ–‡æœ¬\nconst showComparison = ref(false);\nconst aiChanges = ref<AIChange[]>([]);\nconst previewMode = ref<\'before\' | \'after\'>(\'after\');\nconst showHistory = ref(false);\nconst aiHistory = ref<Record<string, AIHistoryRecord[]>>({});\n\n// AI å¿«æ·å»ºè®®\nconst quickSuggestions = [\n  \'æ·»åŠ å“åº”å¼å¸ƒå±€ï¼Œæ”¯æŒç§»åŠ¨ç«¯å’Œæ¡Œé¢ç«¯\',\n  \'æ·»åŠ æ·±è‰²/æµ…è‰²ä¸»é¢˜åˆ‡æ¢åŠŸèƒ½\',\n  \'ä¼˜åŒ–ä»£ç ç»“æ„ï¼Œæå–å¯å¤ç”¨ç»„ä»¶\',\n  \'æ·»åŠ åŠ è½½åŠ¨ç”»å’Œéª¨æ¶å±\',\n  \'æ·»åŠ è¡¨å•éªŒè¯å’Œé”™è¯¯æç¤º\',\n  \'ä¼˜åŒ–æ€§èƒ½ï¼Œå‡å°‘ä¸å¿…è¦çš„æ¸²æŸ“\',\n  \'æ·»åŠ é”®ç›˜å¿«æ·é”®æ”¯æŒ\',\n  \'æ”¹è¿›æ— éšœç¢è®¿é—®ï¼ˆARIAï¼‰\',\n];\n\n// è¿›åº¦å¯¹è¯æ¡†\nconst showProgress = ref(false);\nconst progressDialogRef = ref<InstanceType<typeof ProgressDialog> | null>(null);\n\n// é¡¹ç›®æ¨¡æ¿ç›¸å…³\nconst showProjectTemplate = ref(false);\n\n// Bug ä¿®å¤ç›¸å…³\nconst showBugFix = ref(false);\nconst bugDescription = ref(\'\');\nconst consoleError = ref(\'\');\nconst bugFile = ref(\'\');\n\n// æ–‡ä»¶å¤¹å¯¼å…¥\nconst folderInputRef = ref<HTMLInputElement | null>(null);\n\nconst currentProject = computed(() => {\n  return projects.value.find(p => p.id === currentId.value);\n});\n\nconst currentProjectHistory = computed(() => {\n  return aiHistory.value[currentId.value] || [];\n});\n\nconst comparisonPreviewHtml = computed(() => {\n  if (aiChanges.value.length === 0) return \'\';\n\n  const proj = currentProject.value;\n  if (!proj) return \'\';\n\n  // åˆ›å»ºä¸´æ—¶é¡¹ç›®ç”¨äºé¢„è§ˆ\n  const tempFiles: ProjectFile[] = proj.files.map(f => {\n    const change = aiChanges.value.find(c => c.path === f.path);\n    return {\n      ...f,\n      content: change ? (previewMode.value === \'after\' ? change.newContent : change.oldContent) : f.content,\n    };\n  });\n\n  return buildPreviewFromFiles(tempFiles);\n});\n\n// é¡¹ç›®æ¨¡æ¿å®šä¹‰\nconst projectTemplates = {\n  åŒå±‚å¯¹è¯ç•Œé¢: {\n    name: \'åŒå±‚å¯¹è¯ç•Œé¢\',\n    description: \'æµå¼å¯¹è¯ã€æ¶ˆæ¯å†å²ã€æ­£åˆ™æ¸…ç†\',\n    icon: \'ğŸ’¬\',\n    color: \'#4a9eff\',\n    files: {\n      \'index.html\': `<!DOCTYPE html>\n<html lang="zh-CN">\n<head>\n  <meta charset="UTF-8">\n  <meta name="viewport" content="width=device-width, initial-scale=1.0">\n  <title>åŒå±‚å¯¹è¯ç•Œé¢</title>\n  <link rel="stylesheet" href="style.css">\n</head>\n<body>\n  <div id="app">\n    <div class="chat-container">\n      <div class="message-list" id="messageList"></div>\n      <div class="input-area">\n        <textarea id="userInput" placeholder="è¾“å…¥æ¶ˆæ¯..."></textarea>\n        <button id="sendBtn">å‘é€</button>\n      </div>\n    </div>\n  </div>\n  <${\'script\'} src="https://cdn.jsdelivr.net/npm/vue@3/dist/vue.global.prod.js"></${\'script\'}>\n  <${\'script\'} src="script.js"></${\'script\'}>\n</body>\n</html>`,\n      \'style.css\': `* {\n  margin: 0;\n  padding: 0;\n  box-sizing: border-box;\n}\n\nbody {\n  font-family: \'Segoe UI\', sans-serif;\n  background: #1a1a1a;\n  color: #e0e0e0;\n}\n\n.chat-container {\n  max-width: 800px;\n  margin: 20px auto;\n  height: calc(100vh - 40px);\n  display: flex;\n  flex-direction: column;\n  background: #2a2a2a;\n  border-radius: 12px;\n  overflow: hidden;\n}\n\n.message-list {\n  flex: 1;\n  padding: 20px;\n  overflow-y: auto;\n}\n\n.message {\n  margin-bottom: 15px;\n  padding: 10px 15px;\n  border-radius: 8px;\n  max-width: 70%;\n}\n\n.message.user {\n  background: #4a9eff;\n  margin-left: auto;\n  text-align: right;\n}\n\n.message.assistant {\n  background: #3a3a3a;\n}\n\n.input-area {\n  padding: 15px;\n  background: #2a2a2a;\n  border-top: 1px solid #3a3a3a;\n  display: flex;\n  gap: 10px;\n}\n\n#userInput {\n  flex: 1;\n  padding: 10px;\n  background: #1a1a1a;\n  border: 1px solid #3a3a3a;\n  border-radius: 6px;\n  color: #e0e0e0;\n  resize: none;\n  height: 60px;\n}\n\n#sendBtn {\n  padding: 10px 20px;\n  background: #4a9eff;\n  border: none;\n  border-radius: 6px;\n  color: white;\n  cursor: pointer;\n  font-weight: 600;\n}\n\n#sendBtn:hover {\n  background: #357abd;\n}`,\n      \'script.js\': `// èŠå¤©å†å²\nlet chatHistory = [];\n\n// ä»é…’é¦†å˜é‡åŠ è½½å†å²\nfunction loadHistory() {\n  const saved = getVariables({ type: \'chat\' });\n  chatHistory = saved.chatHistory || [];\n  renderMessages();\n}\n\n// ä¿å­˜åˆ°é…’é¦†å˜é‡\nfunction saveHistory() {\n  insertOrAssignVariables({ chatHistory }, { type: \'chat\' });\n}\n\n// æ¸²æŸ“æ¶ˆæ¯\nfunction renderMessages() {\n  const list = document.getElementById(\'messageList\');\n  list.innerHTML = \'\';\n  chatHistory.forEach(msg => {\n    const div = document.createElement(\'div\');\n    div.className = \'message \' + msg.sender;\n    div.textContent = msg.content;\n    list.appendChild(div);\n  });\n  list.scrollTop = list.scrollHeight;\n}\n\n// å‘é€æ¶ˆæ¯\nasync function sendMessage() {\n  const input = document.getElementById(\'userInput\');\n  const text = input.value.trim();\n  if (!text) return;\n\n  // æ·»åŠ ç”¨æˆ·æ¶ˆæ¯\n  chatHistory.push({\n    id: Date.now(),\n    sender: \'user\',\n    content: text,\n    timestamp: new Date().toLocaleTimeString()\n  });\n  input.value = \'\';\n  renderMessages();\n  saveHistory();\n\n  // è°ƒç”¨ AIï¼ˆæµå¼ï¼‰\n  const prompt = \'ã€å¯¹è¯å†å²ã€‘\\\\n\' + chatHistory.map(m => m.sender + \': \' + m.content).join(\'\\\\n\');\n\n  let aiText = \'\';\n  await generate({\n    should_stream: true,\n    prompt: prompt,\n    on_stream_chunk: (chunk) => {\n      aiText += chunk;\n      // å®æ—¶æ˜¾ç¤º\n      const tempMsg = { id: \'temp\', sender: \'assistant\', content: aiText };\n      const tempIndex = chatHistory.findIndex(m => m.id === \'temp\');\n      if (tempIndex >= 0) {\n        chatHistory[tempIndex] = tempMsg;\n      } else {\n        chatHistory.push(tempMsg);\n      }\n      renderMessages();\n    },\n    on_stream_end: () => {\n      // å®Œæˆï¼Œæ›¿æ¢ä¸ºæ­£å¼æ¶ˆæ¯\n      const tempIndex = chatHistory.findIndex(m => m.id === \'temp\');\n      if (tempIndex >= 0) {\n        chatHistory[tempIndex] = {\n          id: Date.now(),\n          sender: \'assistant\',\n          content: aiText,\n          timestamp: new Date().toLocaleTimeString()\n        };\n      }\n      renderMessages();\n      saveHistory();\n    }\n  });\n}\n\n// åˆå§‹åŒ–\n$(() => {\n  loadHistory();\n  document.getElementById(\'sendBtn\').addEventListener(\'click\', sendMessage);\n  document.getElementById(\'userInput\').addEventListener(\'keydown\', (e) => {\n    if (e.key === \'Enter\' && !e.shiftKey) {\n      e.preventDefault();\n      sendMessage();\n    }\n  });\n});`,\n    },\n  },\n  çŠ¶æ€æ é¢æ¿: {\n    name: \'çŠ¶æ€æ é¢æ¿\',\n    description: \'HP/MP/ç»éªŒå€¼ï¼Œè¿›åº¦æ¡åŠ¨ç”»\',\n    icon: \'ğŸ“Š\',\n    color: \'#10b981\',\n    files: {\n      \'index.html\': `<!DOCTYPE html>\n<html lang="zh-CN">\n<head>\n  <meta charset="UTF-8">\n  <meta name="viewport" content="width=device-width, initial-scale=1.0">\n  <title>çŠ¶æ€æ </title>\n  <link rel="stylesheet" href="style.css">\n</head>\n<body>\n  <div id="app">\n    <div class="status-panel">\n      <h2>è§’è‰²çŠ¶æ€</h2>\n      <div class="stat-item">\n        <label>ç”Ÿå‘½å€¼ (HP)</label>\n        <div class="progress-bar">\n          <div class="progress-fill hp" id="hpBar"></div>\n        </div>\n        <span id="hpText">0/0</span>\n      </div>\n      <div class="stat-item">\n        <label>é­”æ³•å€¼ (MP)</label>\n        <div class="progress-bar">\n          <div class="progress-fill mp" id="mpBar"></div>\n        </div>\n        <span id="mpText">0/0</span>\n      </div>\n      <div class="stat-item">\n        <label>ç»éªŒå€¼ (EXP)</label>\n        <div class="progress-bar">\n          <div class="progress-fill exp" id="expBar"></div>\n        </div>\n        <span id="expText">0/0</span>\n      </div>\n    </div>\n  </div>\n  <${\'script\'} src="script.js"></${\'script\'}>\n</body>\n</html>`,\n      \'style.css\': `* {\n  margin: 0;\n  padding: 0;\n  box-sizing: border-box;\n}\n\nbody {\n  font-family: \'Segoe UI\', sans-serif;\n  background: #1a1a1a;\n  color: #e0e0e0;\n  padding: 20px;\n}\n\n.status-panel {\n  max-width: 500px;\n  margin: 0 auto;\n  background: #2a2a2a;\n  border-radius: 12px;\n  padding: 25px;\n  border: 1px solid #3a3a3a;\n}\n\nh2 {\n  margin-bottom: 20px;\n  color: #4a9eff;\n}\n\n.stat-item {\n  margin-bottom: 20px;\n}\n\n.stat-item label {\n  display: block;\n  margin-bottom: 8px;\n  font-weight: 600;\n  font-size: 14px;\n}\n\n.progress-bar {\n  width: 100%;\n  height: 24px;\n  background: #1a1a1a;\n  border-radius: 12px;\n  overflow: hidden;\n  margin-bottom: 5px;\n}\n\n.progress-fill {\n  height: 100%;\n  transition: width 0.5s ease;\n  border-radius: 12px;\n}\n\n.progress-fill.hp {\n  background: linear-gradient(90deg, #ef4444, #10b981);\n}\n\n.progress-fill.mp {\n  background: linear-gradient(90deg, #3b82f6, #06b6d4);\n}\n\n.progress-fill.exp {\n  background: linear-gradient(90deg, #fbbf24, #f59e0b);\n}\n\n.stat-item span {\n  font-size: 13px;\n  color: #94a3b8;\n}`,\n      \'script.js\': `// ä»é…’é¦†å˜é‡åŠ è½½æ•°æ®\nfunction loadStats() {\n  const data = getVariables({ type: \'chat\' });\n\n  const hp = data.hp || 850;\n  const maxHp = data.maxHp || 1000;\n  const mp = data.mp || 340;\n  const maxMp = data.maxMp || 500;\n  const exp = data.exp || 1250;\n  const maxExp = data.maxExp || 2000;\n\n  // æ›´æ–°è¿›åº¦æ¡\n  updateBar(\'hp\', hp, maxHp);\n  updateBar(\'mp\', mp, maxMp);\n  updateBar(\'exp\', exp, maxExp);\n}\n\nfunction updateBar(type, current, max) {\n  const percent = (current / max) * 100;\n  document.getElementById(type + \'Bar\').style.width = percent + \'%\';\n  document.getElementById(type + \'Text\').textContent = current + \'/\' + max;\n}\n\n// åˆå§‹åŒ–\ndocument.addEventListener(\'DOMContentLoaded\', loadStats);`,\n    },\n  },\n  å¥½æ„Ÿåº¦é¢æ¿: {\n    name: \'å¥½æ„Ÿåº¦é¢æ¿\',\n    description: \'å¤šè§’è‰²å¡ç‰‡ï¼Œçˆ±å¿ƒå›¾æ ‡ï¼Œå¥½æ„Ÿåº¦å±•ç¤º\',\n    icon: \'ğŸ’\',\n    color: \'#ec4899\',\n    files: {\n      \'index.html\': `<!DOCTYPE html>\n<html lang="zh-CN">\n<head>\n  <meta charset="UTF-8">\n  <meta name="viewport" content="width=device-width, initial-scale=1.0">\n  <title>å¥½æ„Ÿåº¦é¢æ¿</title>\n  <link rel="stylesheet" href="style.css">\n</head>\n<body>\n  <div id="app">\n    <div class="affection-container">\n      <h2>è§’è‰²å¥½æ„Ÿåº¦</h2>\n      <div class="character-grid" id="characterGrid"></div>\n    </div>\n  </div>\n  <${\'script\'} src="script.js"></${\'script\'}>\n</body>\n</html>`,\n      \'style.css\': `* {\n  margin: 0;\n  padding: 0;\n  box-sizing: border-box;\n}\n\nbody {\n  font-family: \'Segoe UI\', sans-serif;\n  background: #1a1a1a;\n  color: #e0e0e0;\n  padding: 20px;\n}\n\n.affection-container {\n  max-width: 900px;\n  margin: 0 auto;\n}\n\nh2 {\n  margin-bottom: 25px;\n  color: #ec4899;\n  text-align: center;\n}\n\n.character-grid {\n  display: grid;\n  grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));\n  gap: 20px;\n}\n\n.character-card {\n  background: #2a2a2a;\n  border-radius: 12px;\n  padding: 20px;\n  border: 2px solid #3a3a3a;\n  transition: all 0.3s ease;\n}\n\n.character-card:hover {\n  transform: translateY(-5px);\n  border-color: #ec4899;\n  box-shadow: 0 10px 25px rgba(236, 72, 153, 0.3);\n}\n\n.character-name {\n  font-size: 18px;\n  font-weight: 600;\n  margin-bottom: 15px;\n  color: #e0e0e0;\n}\n\n.affection-bar {\n  width: 100%;\n  height: 20px;\n  background: #1a1a1a;\n  border-radius: 10px;\n  overflow: hidden;\n  margin-bottom: 8px;\n}\n\n.affection-fill {\n  height: 100%;\n  background: linear-gradient(90deg, #ec4899, #f472b6);\n  transition: width 0.5s ease;\n  border-radius: 10px;\n}\n\n.affection-text {\n  font-size: 13px;\n  color: #94a3b8;\n}`,\n      \'script.js\': `// ä»é…’é¦†å˜é‡åŠ è½½è§’è‰²æ•°æ®\nfunction loadCharacters() {\n  const data = getVariables({ type: \'chat\' });\n  const characters = data.characters || [\n    { name: \'è§’è‰² A\', affection: 75 },\n    { name: \'è§’è‰² B\', affection: 50 },\n    { name: \'è§’è‰² C\', affection: 90 }\n  ];\n\n  const grid = document.getElementById(\'characterGrid\');\n  grid.innerHTML = \'\';\n\n  characters.forEach(char => {\n    const card = document.createElement(\'div\');\n    card.className = \'character-card\';\n    card.innerHTML = \\`\n      <div class="character-name">\\${char.name}</div>\n      <div class="affection-bar">\n        <div class="affection-fill" style="width: \\${char.affection}%"></div>\n      </div>\n      <div class="affection-text">å¥½æ„Ÿåº¦: \\${char.affection}/100</div>\n    \\`;\n    grid.appendChild(card);\n  });\n}\n\n// åˆå§‹åŒ–\ndocument.addEventListener(\'DOMContentLoaded\', loadCharacters);`,\n    },\n  },\n};\n\n// æ˜¾ç¤ºé¡¹ç›®æ¨¡æ¿å¯¹è¯æ¡†\nfunction showProjectTemplateDialog() {\n  showProjectTemplate.value = true;\n}\n\n// ä½¿ç”¨æ¨¡æ¿åˆ›å»ºé¡¹ç›®\nfunction createProjectFromTemplate(templateKey: string) {\n  const template = projectTemplates[templateKey as keyof typeof projectTemplates];\n  if (!template) return;\n\n  const name = prompt(\'é¡¹ç›®åç§°:\', template.name);\n  if (!name || !name.trim()) return;\n\n  const newProj: Project = {\n    id: Date.now().toString(),\n    name: name.trim(),\n    files: Object.entries(template.files).map(([filename, content]) => ({\n      path: filename,\n      name: filename,\n      content: content,\n    })),\n  };\n\n  projects.value.push(newProj);\n  currentId.value = newProj.id;\n  currentFile.value = newProj.files[0]?.name || \'\';\n  code.value = newProj.files[0]?.content || \'\';\n  saveToChatVar();\n\n  showProjectTemplate.value = false;\n  window.toastr.success(\'âœ… é¡¹ç›®"\' + name.trim() + \'"åˆ›å»ºæˆåŠŸï¼\');\n}\n\n// æ–‡ä»¶å¤¹å¯¼å…¥åŠŸèƒ½\nfunction triggerFolderImport() {\n  if (folderInputRef.value) {\n    folderInputRef.value.value = \'\'; // æ¸…ç©ºä¹‹å‰çš„é€‰æ‹©\n    folderInputRef.value.click();\n  }\n}\n\nasync function handleFolderImport(event: Event) {\n  const input = event.target as HTMLInputElement;\n  const files = input.files;\n\n  if (!files || files.length === 0) {\n    return;\n  }\n\n  try {\n    // è·å–æ–‡ä»¶å¤¹åç§°ï¼ˆä»ç¬¬ä¸€ä¸ªæ–‡ä»¶çš„è·¯å¾„ä¸­æå–ï¼‰\n    const firstFile = files[0];\n    const pathParts = firstFile.webkitRelativePath.split(\'/\');\n    const folderName = pathParts[0] || \'å¯¼å…¥çš„é¡¹ç›®\';\n\n    // è®©ç”¨æˆ·ç¡®è®¤é¡¹ç›®åç§°\n    const projectName = prompt(\'é¡¹ç›®åç§°:\', folderName);\n    if (!projectName || !projectName.trim()) {\n      return;\n    }\n\n    // æ”¯æŒçš„æ–‡ä»¶æ‰©å±•å\n    const supportedExtensions = [\'.html\', \'.css\', \'.js\', \'.ts\', \'.scss\', \'.sass\', \'.json\', \'.txt\', \'.md\'];\n\n    // è¯»å–æ‰€æœ‰æ–‡ä»¶\n    const projectFiles: ProjectFile[] = [];\n    const fileReadPromises: Promise<void>[] = [];\n\n    for (let i = 0; i < files.length; i++) {\n      const file = files[i];\n      const relativePath = file.webkitRelativePath.split(\'/\').slice(1).join(\'/\'); // ç§»é™¤æ–‡ä»¶å¤¹åç§°\n\n      // è·³è¿‡ç©ºè·¯å¾„æˆ–éšè—æ–‡ä»¶/æ–‡ä»¶å¤¹\n      if (!relativePath || relativePath.startsWith(\'.\') || relativePath.includes(\'/.\')) {\n        continue;\n      }\n\n      // è·³è¿‡ node_modulesã€dist ç­‰å¸¸è§ä¸éœ€è¦çš„æ–‡ä»¶å¤¹\n      if (\n        relativePath.includes(\'node_modules/\') ||\n        relativePath.includes(\'dist/\') ||\n        relativePath.includes(\'.git/\') ||\n        relativePath.includes(\'build/\')\n      ) {\n        continue;\n      }\n\n      // æ£€æŸ¥æ–‡ä»¶æ‰©å±•å\n      const extension = \'.\' + relativePath.split(\'.\').pop()?.toLowerCase();\n      if (!supportedExtensions.includes(extension)) {\n        continue;\n      }\n\n      // è¯»å–æ–‡ä»¶å†…å®¹\n      const readPromise = new Promise<void>((resolve, reject) => {\n        const reader = new FileReader();\n        reader.onload = e => {\n          const content = e.target?.result as string;\n          const fileName = relativePath.split(\'/\').pop() || relativePath;\n          projectFiles.push({\n            path: relativePath,\n            name: fileName,\n            content: content || \'\',\n          });\n          resolve();\n        };\n        reader.onerror = () => reject(new Error(`è¯»å–æ–‡ä»¶å¤±è´¥: ${relativePath}`));\n        reader.readAsText(file);\n      });\n\n      fileReadPromises.push(readPromise);\n    }\n\n    // ç­‰å¾…æ‰€æœ‰æ–‡ä»¶è¯»å–å®Œæˆ\n    await Promise.all(fileReadPromises);\n\n    if (projectFiles.length === 0) {\n      window.toastr.warning(\'æœªæ‰¾åˆ°å¯å¯¼å…¥çš„æ–‡ä»¶ï¼ˆæ”¯æŒçš„æ ¼å¼ï¼šHTMLã€CSSã€JSã€TSã€SCSS ç­‰ï¼‰\');\n      return;\n    }\n\n    // åˆ›å»ºæ–°é¡¹ç›®\n    const newProj: Project = {\n      id: Date.now().toString(),\n      name: projectName.trim(),\n      files: projectFiles,\n    };\n\n    projects.value.push(newProj);\n    currentId.value = newProj.id;\n    currentFile.value = newProj.files[0]?.path || \'\';\n    code.value = newProj.files[0]?.content || \'\';\n\n    saveToChatVar();\n    updatePreview();\n\n    window.toastr.success(`æˆåŠŸå¯¼å…¥é¡¹ç›®"${projectName}"ï¼Œå…± ${projectFiles.length} ä¸ªæ–‡ä»¶`);\n  } catch (error) {\n    console.error(\'å¯¼å…¥æ–‡ä»¶å¤¹å¤±è´¥:\', error);\n    window.toastr.error(\'å¯¼å…¥æ–‡ä»¶å¤¹å¤±è´¥: \' + (error as Error).message);\n  }\n}\n\nfunction createProject() {\n  const name = prompt(\'é¡¹ç›®åç§°:\');\n  if (!name || !name.trim()) return;\n\n  const htmlContent = `<!DOCTYPE html>\n<html lang="zh-CN">\n<head>\n  <meta charset="UTF-8">\n  <meta name="viewport" content="width=device-width, initial-scale=1.0">\n  <title>${name.trim()}</title>\n  <link rel="stylesheet" href="style.css">\n</head>\n<body>\n  <div class="container">\n    <h1>æ¬¢è¿æ¥åˆ° ${name.trim()}!</h1>\n    <p>å¼€å§‹ä½ çš„åˆ›ä½œä¹‹æ—…</p>\n  </div>\n  <${\'script\'} src="script.js"></${\'script\'}>\n</body>\n</html>`;\n\n  const cssContent = `* {\n  margin: 0;\n  padding: 0;\n  box-sizing: border-box;\n}\n\nbody {\n  font-family: \'Segoe UI\', Tahoma, Geneva, Verdana, sans-serif;\n  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);\n  color: #333;\n  min-height: 100vh;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n}\n\n.container {\n  background: white;\n  padding: 60px 40px;\n  border-radius: 20px;\n  box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);\n  text-align: center;\n  max-width: 600px;\n}\n\nh1 {\n  font-size: 2.5em;\n  color: #667eea;\n  margin-bottom: 20px;\n}\n\np {\n  font-size: 1.2em;\n  color: #666;\n  line-height: 1.6;\n}`;\n\n  const jsContent = `console.log(\'é¡¹ç›®å·²å¯åŠ¨ï¼\');\n\n// ä½¿ç”¨ jQuery ç¡®ä¿ DOM åŠ è½½å®Œæˆ\n$(function() {\n  console.log(\'é¡µé¢åŠ è½½å®Œæˆ\');\n\n  // ========== æ£€æµ‹æ˜¯å¦åœ¨é…’é¦†ç¯å¢ƒä¸­ ==========\n  const isInTavern = typeof SillyTavern !== \'undefined\' && typeof getVariables !== \'undefined\';\n\n  if (!isInTavern) {\n    console.log(\'é¢„è§ˆæ¨¡å¼ï¼šå½“å‰åœ¨é¢„è§ˆçª—å£ä¸­ï¼Œé…’é¦† API ä¸å¯ç”¨\');\n    // é¢„è§ˆæ¨¡å¼ä¸‹çš„é€»è¾‘ï¼ˆä½¿ç”¨ localStorage æˆ–ä¸ä¿å­˜æ•°æ®ï¼‰\n  }\n\n  // ========== æ•°æ®æŒä¹…åŒ–ç¤ºä¾‹ï¼ˆä»…åœ¨é…’é¦†ç¯å¢ƒä¸­å¯ç”¨ï¼‰==========\n  const storageKey = \'my_project_data\'; // è‡ªå®šä¹‰å­˜å‚¨é”®å\n\n  // åŠ è½½æ•°æ®\n  function loadData() {\n    if (isInTavern) {\n      const data = getVariables({ type: \'chat\' });\n      return data[storageKey] || { count: 0 };\n    } else {\n      // é¢„è§ˆæ¨¡å¼ï¼šä½¿ç”¨ localStorage\n      const stored = localStorage.getItem(storageKey);\n      return stored ? JSON.parse(stored) : { count: 0 };\n    }\n  }\n\n  // ä¿å­˜æ•°æ®\n  function saveData(data) {\n    if (isInTavern) {\n      insertOrAssignVariables({ [storageKey]: data }, { type: \'chat\' });\n      console.log(\'æ•°æ®å·²ä¿å­˜åˆ°é…’é¦†å˜é‡:\', data);\n    } else {\n      // é¢„è§ˆæ¨¡å¼ï¼šä½¿ç”¨ localStorage\n      localStorage.setItem(storageKey, JSON.stringify(data));\n      console.log(\'æ•°æ®å·²ä¿å­˜åˆ° localStorageï¼ˆé¢„è§ˆæ¨¡å¼ï¼‰:\', data);\n    }\n  }\n\n  // åˆå§‹åŒ–\n  let myData = loadData();\n  console.log(\'åŠ è½½çš„æ•°æ®:\', myData);\n\n  // ========== ç¤ºä¾‹ï¼šç‚¹å‡»è®¡æ•°å™¨ ==========\n  const container = $(\'.container\');\n  if (container.length) {\n    container.on(\'click\', function() {\n      myData.count++;\n      saveData(myData);\n      if (typeof toastr !== \'undefined\') {\n        toastr.success(\\`ç‚¹å‡»æ¬¡æ•°: \\${myData.count}\\`);\n      } else {\n        alert(\\`ç‚¹å‡»æ¬¡æ•°: \\${myData.count}\\`);\n      }\n    });\n  }\n\n  // é¡µé¢å¸è½½æ—¶ä¿å­˜ï¼ˆå¯é€‰ï¼‰\n  $(window).on(\'pagehide\', function() {\n    saveData(myData);\n  });\n});`;\n\n  const newProj: Project = {\n    id: Date.now().toString(),\n    name: name.trim(),\n    files: [\n      { path: \'index.html\', name: \'index.html\', content: htmlContent },\n      { path: \'style.css\', name: \'style.css\', content: cssContent },\n      { path: \'script.js\', name: \'script.js\', content: jsContent },\n    ],\n  };\n\n  projects.value.push(newProj);\n  console.log(\'æ–°å»ºé¡¹ç›®:\', newProj.name, \'é¡¹ç›®æ€»æ•°:\', projects.value.length);\n\n  // ç«‹å³ä¿å­˜\n  saveToChatVar();\n\n  currentId.value = newProj.id;\n  currentFile.value = \'index.html\';\n  code.value = htmlContent;\n  updatePreview();\n  toastr.success(`é¡¹ç›® "${newProj.name}" å·²åˆ›å»ºå¹¶ä¿å­˜`);\n}\n\nfunction selectProject(id: string) {\n  currentId.value = id;\n  const proj = currentProject.value;\n  if (proj && proj.files.length > 0) {\n    currentFile.value = proj.files[0].path;\n    code.value = proj.files[0].content;\n    updatePreview();\n  } else {\n    currentFile.value = \'\';\n    code.value = \'\';\n    previewHtml.value = \'\';\n  }\n}\n\nfunction selectFile(path: string) {\n  currentFile.value = path;\n  const proj = currentProject.value;\n  if (proj) {\n    const file = proj.files.find(f => f.path === path);\n    if (file) {\n      code.value = file.content;\n    }\n  }\n}\n\nfunction saveCode() {\n  const proj = currentProject.value;\n  if (!proj || !currentFile.value) {\n    toastr.error(\'è¯·å…ˆé€‰æ‹©ä¸€ä¸ªæ–‡ä»¶\');\n    return;\n  }\n\n  const file = proj.files.find(f => f.path === currentFile.value);\n  if (file) {\n    file.content = code.value;\n\n    // æ¸…é™¤è‡ªåŠ¨ä¿å­˜å®šæ—¶å™¨ï¼Œç«‹å³ä¿å­˜\n    if (autoSaveTimer) {\n      clearTimeout(autoSaveTimer);\n      autoSaveTimer = null;\n    }\n\n    saveToChatVar();\n    updatePreview();\n    toastr.success(\'å·²ä¿å­˜\');\n  }\n}\n\nfunction deleteProject(id: string) {\n  const proj = projects.value.find(p => p.id === id);\n  if (!proj) return;\n\n  if (!confirm(`ç¡®å®šåˆ é™¤é¡¹ç›® "${proj.name}" å—ï¼Ÿ`)) return;\n\n  projects.value = projects.value.filter(p => p.id !== id);\n  console.log(\'åˆ é™¤é¡¹ç›®åï¼Œå‰©ä½™é¡¹ç›®æ•°:\', projects.value.length);\n\n  if (currentId.value === id) {\n    currentId.value = \'\';\n    currentFile.value = \'\';\n    code.value = \'\';\n    previewHtml.value = \'\';\n  }\n\n  // ç«‹å³ä¿å­˜\n  saveToChatVar();\n  toastr.success(`é¡¹ç›® "${proj.name}" å·²åˆ é™¤`);\n}\n\n// æ–°å»ºæ–‡ä»¶å¤¹\nfunction createNewFolder() {\n  const proj = currentProject.value;\n  if (!proj) return;\n\n  const folderPath = prompt(\'è¯·è¾“å…¥æ–‡ä»¶å¤¹è·¯å¾„ï¼š\\nä¾‹å¦‚ï¼šcss æˆ– js/utils\', \'\');\n  if (!folderPath || !folderPath.trim()) return;\n\n  const trimmedPath = folderPath.trim().replace(/\\/$/, \'\'); // ç§»é™¤æœ«å°¾çš„æ–œæ \n\n  // åœ¨æ–‡ä»¶å¤¹ä¸­åˆ›å»ºä¸€ä¸ª .gitkeep å ä½æ–‡ä»¶\n  const gitkeepPath = `${trimmedPath}/.gitkeep`;\n\n  // æ£€æŸ¥æ˜¯å¦å·²å­˜åœ¨\n  if (proj.files.some(f => f.path.startsWith(`${trimmedPath}/`))) {\n    window.toastr.warning(`æ–‡ä»¶å¤¹ "${trimmedPath}" å·²å­˜åœ¨ï¼ˆåŒ…å«æ–‡ä»¶ï¼‰`);\n    return;\n  }\n\n  // åˆ›å»ºå ä½æ–‡ä»¶\n  const newFile: ProjectFile = {\n    path: gitkeepPath,\n    name: \'.gitkeep\',\n    content: \'# æ­¤æ–‡ä»¶ç”¨äºä¿æŒæ–‡ä»¶å¤¹ç»“æ„\\n\',\n  };\n\n  proj.files.push(newFile);\n  saveToChatVar();\n\n  window.toastr.success(`æ–‡ä»¶å¤¹ "${trimmedPath}" å·²åˆ›å»º`);\n}\n\n// æ–°å»ºæ–‡ä»¶\nfunction showNewFileDialog() {\n  const proj = currentProject.value;\n  if (!proj) return;\n\n  // è·å–é¡¹ç›®ä¸­å·²æœ‰çš„æ–‡ä»¶å¤¹åˆ—è¡¨\n  const folders = new Set<string>();\n  folders.add(\'\'); // æ ¹ç›®å½•\n\n  proj.files.forEach(file => {\n    const parts = file.path.split(\'/\');\n    if (parts.length > 1) {\n      // æå–æ‰€æœ‰æ–‡ä»¶å¤¹è·¯å¾„\n      for (let i = 1; i < parts.length; i++) {\n        const folderPath = parts.slice(0, i).join(\'/\');\n        if (folderPath) folders.add(folderPath);\n      }\n    }\n  });\n\n  const folderList = Array.from(folders).sort();\n\n  // 1. é€‰æ‹©æ–‡ä»¶ç±»å‹\n  const fileTypes = [\n    { name: \'HTML æ–‡ä»¶\', ext: \'.html\', icon: \'ğŸŒ\' },\n    { name: \'CSS æ–‡ä»¶\', ext: \'.css\', icon: \'ğŸ¨\' },\n    { name: \'JavaScript æ–‡ä»¶\', ext: \'.js\', icon: \'âš¡\' },\n    { name: \'TypeScript æ–‡ä»¶\', ext: \'.ts\', icon: \'ğŸ“˜\' },\n    { name: \'JSON æ–‡ä»¶\', ext: \'.json\', icon: \'ğŸ“„\' },\n    { name: \'Markdown æ–‡ä»¶\', ext: \'.md\', icon: \'ğŸ“\' },\n    { name: \'å…¶ä»–æ–‡ä»¶\', ext: \'\', icon: \'ğŸ“‹\' },\n  ];\n\n  const typeOptions = fileTypes.map((t, i) => `${i + 1}. ${t.icon} ${t.name} (${t.ext || \'è‡ªå®šä¹‰\'})`).join(\'\\n\');\n  const typeChoice = prompt(`è¯·é€‰æ‹©æ–‡ä»¶ç±»å‹ï¼ˆè¾“å…¥åºå· 1-${fileTypes.length}ï¼‰ï¼š\\n\\n${typeOptions}`, \'1\');\n\n  if (!typeChoice) return;\n\n  const typeIndex = parseInt(typeChoice) - 1;\n  if (typeIndex < 0 || typeIndex >= fileTypes.length) {\n    window.toastr.error(\'æ— æ•ˆçš„é€‰é¡¹\');\n    return;\n  }\n\n  const selectedType = fileTypes[typeIndex];\n\n  // 2. é€‰æ‹©ç›®æ ‡æ–‡ä»¶å¤¹\n  let targetFolder = \'\';\n  if (folderList.length > 1) {\n    const folderOptions =\n      folderList.length > 5\n        ? \'è¾“å…¥æ–‡ä»¶å¤¹è·¯å¾„ï¼ˆç•™ç©ºä¸ºæ ¹ç›®å½•ï¼‰ï¼š\'\n        : `è¯·é€‰æ‹©ç›®æ ‡æ–‡ä»¶å¤¹ï¼ˆè¾“å…¥åºå·ï¼‰ï¼š\\n\\n${folderList.map((f, i) => `${i + 1}. ${f || \'æ ¹ç›®å½•\'}`).join(\'\\n\')}\\n\\næˆ–ç›´æ¥è¾“å…¥æ–‡ä»¶å¤¹è·¯å¾„ï¼š`;\n\n    const folderChoice = prompt(folderOptions, \'1\');\n    if (!folderChoice) return;\n\n    // å°è¯•è§£æä¸ºåºå·\n    const folderIndex = parseInt(folderChoice) - 1;\n    if (folderIndex >= 0 && folderIndex < folderList.length) {\n      targetFolder = folderList[folderIndex];\n    } else {\n      // å½“ä½œè·¯å¾„å¤„ç†\n      targetFolder = folderChoice.trim().replace(/\\/$/, \'\');\n    }\n  }\n\n  // 3. è¾“å…¥æ–‡ä»¶å\n  const fileName = prompt(\n    `è¯·è¾“å…¥æ–‡ä»¶å${selectedType.ext ? `ï¼ˆå°†è‡ªåŠ¨æ·»åŠ  ${selectedType.ext}ï¼‰` : \'ï¼ˆéœ€åŒ…å«æ‰©å±•åï¼‰\'}ï¼š`,\n    selectedType.ext ? `new-file` : \'newfile.txt\',\n  );\n\n  if (!fileName || !fileName.trim()) return;\n\n  let trimmedName = fileName.trim();\n\n  // å¦‚æœé€‰æ‹©äº†æ–‡ä»¶ç±»å‹ï¼Œè‡ªåŠ¨æ·»åŠ æ‰©å±•å\n  if (selectedType.ext && !trimmedName.endsWith(selectedType.ext)) {\n    trimmedName += selectedType.ext;\n  }\n\n  // æ„å»ºå®Œæ•´è·¯å¾„\n  const fullPath = targetFolder ? `${targetFolder}/${trimmedName}` : trimmedName;\n\n  // æ£€æŸ¥æ–‡ä»¶æ˜¯å¦å·²å­˜åœ¨\n  if (proj.files.some(f => f.path === fullPath)) {\n    window.toastr.error(`æ–‡ä»¶ "${fullPath}" å·²å­˜åœ¨ï¼`);\n    return;\n  }\n\n  // ç”Ÿæˆé»˜è®¤å†…å®¹\n  const extension = trimmedName.split(\'.\').pop()?.toLowerCase();\n  let defaultContent = \'\';\n\n  switch (extension) {\n    case \'html\':\n      defaultContent =\n        \'<!DOCTYPE html>\\n\' +\n        \'<html lang="zh-CN">\\n\' +\n        \'<head>\\n\' +\n        \'  <meta charset="UTF-8">\\n\' +\n        \'  <meta name="viewport" content="width=device-width, initial-scale=1.0">\\n\' +\n        \'  <title>\' +\n        trimmedName.replace(\'.html\', \'\') +\n        \'</title>\\n\' +\n        \'  <link rel="stylesheet" href="style.css">\\n\' +\n        \'</head>\\n\' +\n        \'<body>\\n\' +\n        \'  <div class="container">\\n\' +\n        \'    <h1>æ¬¢è¿</h1>\\n\' +\n        \'  </div>\\n\' +\n        \'  <\' +\n        \'script src="script.js"></\' +\n        \'script>\\n\' +\n        \'</body>\\n\' +\n        \'</html>\';\n      break;\n    case \'css\':\n    case \'scss\':\n    case \'sass\':\n      defaultContent = `/* ${trimmedName} */\\n\\n* {\\n  margin: 0;\\n  padding: 0;\\n  box-sizing: border-box;\\n}\\n`;\n      break;\n    case \'js\':\n    case \'ts\':\n      defaultContent =\n        `// ${trimmedName}\\n\\nconsole.log(\'${trimmedName} å·²åŠ è½½\');\\n\\n$` + `(function() {\\n  // åœ¨è¿™é‡Œç¼–å†™ä»£ç \\n});\\n`;\n      break;\n    case \'json\':\n      defaultContent = `{\\n  "name": "${trimmedName.replace(\'.json\', \'\')}",\\n  "version": "1.0.0"\\n}`;\n      break;\n    case \'md\':\n      defaultContent = `# ${trimmedName.replace(/\\.md$/, \'\')}\\n\\n`;\n      break;\n    default:\n      defaultContent = \'\';\n  }\n\n  // åˆ›å»ºæ–°æ–‡ä»¶\n  const newFile: ProjectFile = {\n    path: fullPath,\n    name: trimmedName,\n    content: defaultContent,\n  };\n\n  proj.files.push(newFile);\n  currentFile.value = fullPath;\n  code.value = defaultContent;\n\n  saveToChatVar();\n  updatePreview();\n\n  window.toastr.success(`æ–‡ä»¶ "${fullPath}" å·²åˆ›å»º`);\n}\n\n// åˆ é™¤æ–‡ä»¶\nfunction deleteFile(filePath: string) {\n  const proj = currentProject.value;\n  if (!proj) return;\n\n  const file = proj.files.find(f => f.path === filePath);\n  if (!file) return;\n\n  if (!confirm(`ç¡®å®šåˆ é™¤æ–‡ä»¶ "${file.path}" å—ï¼Ÿ`)) return;\n\n  proj.files = proj.files.filter(f => f.path !== filePath);\n\n  // å¦‚æœåˆ é™¤çš„æ˜¯å½“å‰æ‰“å¼€çš„æ–‡ä»¶ï¼Œåˆ‡æ¢åˆ°ç¬¬ä¸€ä¸ªæ–‡ä»¶\n  if (currentFile.value === filePath) {\n    if (proj.files.length > 0) {\n      currentFile.value = proj.files[0].path;\n      code.value = proj.files[0].content;\n    } else {\n      currentFile.value = \'\';\n      code.value = \'\';\n    }\n  }\n\n  saveToChatVar();\n  updatePreview();\n\n  window.toastr.success(`æ–‡ä»¶ "${file.path}" å·²åˆ é™¤`);\n}\n\nfunction getFileIcon(path: string): string {\n  const ext = path.split(\'.\').pop()?.toLowerCase();\n  if (ext === \'html\') return \'fa-brands fa-html5\';\n  if (ext === \'css\') return \'fa-brands fa-css3-alt\';\n  if (ext === \'js\') return \'fa-brands fa-js\';\n  return \'fa-solid fa-file-code\';\n}\n\nfunction buildPreviewFromFiles(files: ProjectFile[]): string {\n  const htmlFile = files.find(f => f.path.endsWith(\'.html\'));\n  const cssFile = files.find(f => f.path.endsWith(\'.css\'));\n  const jsFile = files.find(f => f.path.endsWith(\'.js\'));\n\n  if (!htmlFile) return \'\';\n\n  const html = htmlFile.content;\n  const headTag = \'head\';\n  const bodyTag = \'body\';\n  const headMatch = html.match(new RegExp(`<${headTag}[^>]*>([\\\\s\\\\S]*?)</${headTag}>`, \'i\'));\n  const bodyMatch = html.match(new RegExp(`<${bodyTag}[^>]*>([\\\\s\\\\S]*?)</${bodyTag}>`, \'i\'));\n\n  let headContent = headMatch ? headMatch[1] : \'\';\n  let bodyContent = bodyMatch ? bodyMatch[1] : html;\n\n  const linkTagRegex = /<link[^>]*rel=["\']stylesheet["\'][^>]*>/gi;\n  const scriptTagRegex = new RegExp(\'<\' + \'script[^>]*></\' + \'script>\', \'gi\');\n  headContent = headContent.replace(linkTagRegex, \'\');\n  bodyContent = bodyContent.replace(scriptTagRegex, \'\');\n\n  const scriptTag = \'script\';\n  const styleTag = \'style\';\n  return `<!DOCTYPE html>\n<html>\n<head>\n  <meta charset="UTF-8">\n  <meta name="viewport" content="width=device-width, initial-scale=1.0">\n  ${headContent}\n  <${styleTag}>\n    html, body {\n      margin: 0 !important;\n      padding: 0 !important;\n      width: 100% !important;\n      height: auto !important;\n      min-height: 800px !important;\n      overflow: visible !important;\n    }\n    ${cssFile?.content || \'\'}\n  </${styleTag}>\n  <${scriptTag} src="https://code.jquery.com/jquery-3.7.1.min.js"></${scriptTag}>\n  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/toastr.min.css">\n  <${scriptTag} src="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/toastr.min.js"></${scriptTag}>\n  <${scriptTag} src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.5/gsap.min.js"></${scriptTag}>\n  <${scriptTag} src="https://cdnjs.cloudflare.com/ajax/libs/lodash.js/4.17.21/lodash.min.js"></${scriptTag}>\n</head>\n<body>\n  ${bodyContent}\n  <${scriptTag}>${jsFile?.content || \'\'}</${scriptTag}>\n</body>\n</html>`;\n}\n\nfunction updatePreview() {\n  const proj = currentProject.value;\n  if (!proj) {\n    previewHtml.value = \'\';\n    return;\n  }\n  previewHtml.value = buildPreviewFromFiles(proj.files);\n}\n\nfunction saveToChatVar() {\n  try {\n    const chatId = SillyTavern.getCurrentChatId();\n    console.log(\'ä¿å­˜æ•°æ®åˆ°èŠå¤©å˜é‡ï¼ŒèŠå¤© ID:\', chatId);\n\n    const dataToSave = {\n      frontend_projects_files: projects.value,\n      frontend_ai_history: aiHistory.value,\n    };\n\n    if (chatId) {\n      console.log(\'å‡†å¤‡ä¿å­˜åˆ°èŠå¤©å˜é‡:\', dataToSave.frontend_projects_files.length, \'ä¸ªé¡¹ç›®\');\n      insertOrAssignVariables(dataToSave, { type: \'chat\' });\n      console.log(\'ä¿å­˜æˆåŠŸï¼\');\n\n      // éªŒè¯ä¿å­˜\n      const verify = getVariables({ type: \'chat\' });\n      if (verify?.frontend_projects_files) {\n        console.log(\'éªŒè¯ï¼šæ•°æ®å·²æˆåŠŸä¿å­˜ï¼Œå…±\', verify.frontend_projects_files.length, \'ä¸ªé¡¹ç›®\');\n      } else {\n        console.error(\'éªŒè¯å¤±è´¥ï¼šä¿å­˜åæ— æ³•è¯»å–æ•°æ®\');\n      }\n    } else {\n      // æ²¡æœ‰èŠå¤©æ—¶ä½¿ç”¨å…¨å±€å˜é‡\n      console.log(\'æœªæ‰¾åˆ°èŠå¤© IDï¼Œä¿å­˜åˆ°å…¨å±€å˜é‡:\', dataToSave.frontend_projects_files.length, \'ä¸ªé¡¹ç›®\');\n      insertOrAssignVariables(dataToSave, { type: \'global\' });\n      console.log(\'å·²ä¿å­˜åˆ°å…¨å±€å˜é‡\');\n      toastr.info(\'é¡¹ç›®å·²ä¿å­˜åˆ°å…¨å±€å˜é‡ï¼ˆæ‰“å¼€èŠå¤©åå¯ä¿å­˜åˆ°èŠå¤©å˜é‡ï¼‰\');\n    }\n  } catch (e) {\n    console.error(\'ä¿å­˜å¤±è´¥:\', e);\n  }\n}\n\nfunction loadFromChatVar() {\n  try {\n    const chatId = SillyTavern.getCurrentChatId();\n    console.log(\'æ­£åœ¨åŠ è½½æ•°æ®ï¼ŒèŠå¤© ID:\', chatId);\n\n    let data;\n    if (chatId) {\n      data = getVariables({ type: \'chat\' });\n      console.log(\'ä»èŠå¤©å˜é‡è¯»å–åˆ°çš„æ•°æ®:\', data);\n    } else {\n      data = getVariables({ type: \'global\' });\n      console.log(\'æœªæ‰¾åˆ°èŠå¤© IDï¼Œä»å…¨å±€å˜é‡è¯»å–æ•°æ®:\', data);\n    }\n\n    if (data?.frontend_projects_files && Array.isArray(data.frontend_projects_files)) {\n      projects.value = data.frontend_projects_files;\n      console.log(\'æˆåŠŸåŠ è½½é¡¹ç›®:\', projects.value.length, \'ä¸ª\');\n    } else {\n      console.log(\'æ²¡æœ‰æ‰¾åˆ°å·²ä¿å­˜çš„é¡¹ç›®æ•°æ®\');\n      projects.value = [];\n    }\n\n    if (data?.frontend_ai_history) {\n      aiHistory.value = data.frontend_ai_history;\n      console.log(\'æˆåŠŸåŠ è½½å†å²è®°å½•\');\n    } else {\n      aiHistory.value = {};\n    }\n  } catch (e) {\n    console.error(\'åŠ è½½å¤±è´¥:\', e);\n  }\n}\n\n// ç«‹å³åŠ è½½æ•°æ®\nloadFromChatVar();\n\nwatch(\n  () => SillyTavern.getCurrentChatId(),\n  () => {\n    loadFromChatVar();\n    currentId.value = \'\';\n    currentFile.value = \'\';\n    code.value = \'\';\n    previewHtml.value = \'\';\n  },\n);\n\n// å®æ—¶è‡ªåŠ¨ä¿å­˜ï¼ˆé˜²æŠ–ï¼‰\nlet autoSaveTimer: ReturnType<typeof setTimeout> | null = null;\nwatchEffect(() => {\n  // ç›‘å¬ä»£ç ç¼–è¾‘å™¨çš„å†…å®¹å˜åŒ–\n  if (currentFile.value && code.value !== undefined) {\n    const proj = currentProject.value;\n    if (proj) {\n      const file = proj.files.find(f => f.path === currentFile.value);\n      if (file && file.content !== code.value) {\n        // æ›´æ–°å†…å­˜ä¸­çš„æ–‡ä»¶å†…å®¹\n        file.content = code.value;\n\n        // æ¸…é™¤ä¹‹å‰çš„å®šæ—¶å™¨\n        if (autoSaveTimer) {\n          clearTimeout(autoSaveTimer);\n        }\n\n        // å»¶è¿Ÿä¿å­˜åˆ°å­˜å‚¨ï¼ˆé˜²æŠ– 1 ç§’ï¼‰\n        autoSaveTimer = setTimeout(() => {\n          saveToChatVar();\n          console.log(\'è‡ªåŠ¨ä¿å­˜:\', currentFile.value);\n        }, 1000);\n      }\n    }\n  }\n});\n\n// é¢„è§ˆæ›´æ–°ï¼ˆé˜²æŠ–ï¼‰\nlet previewTimer: ReturnType<typeof setTimeout> | null = null;\nwatch(\n  () => [currentFile.value, code.value],\n  () => {\n    if (previewTimer) {\n      clearTimeout(previewTimer);\n    }\n    previewTimer = setTimeout(updatePreview, 500);\n  },\n  { deep: true },\n);\n\n// ç»„ä»¶å¸è½½å‰ä¿å­˜ï¼ˆåˆ‡æ¢æ ‡ç­¾é¡µæ—¶ï¼‰\nonBeforeUnmount(() => {\n  console.log(\'ç»„ä»¶å¸è½½ï¼Œä¿å­˜æ•°æ®...\');\n\n  // æ¸…ç†å®šæ—¶å™¨\n  if (autoSaveTimer) {\n    clearTimeout(autoSaveTimer);\n  }\n  if (previewTimer) {\n    clearTimeout(previewTimer);\n  }\n\n  // ç«‹å³ä¿å­˜å½“å‰ç¼–è¾‘çš„å†…å®¹\n  if (currentFile.value && code.value !== undefined) {\n    const proj = currentProject.value;\n    if (proj) {\n      const file = proj.files.find(f => f.path === currentFile.value);\n      if (file) {\n        file.content = code.value;\n      }\n    }\n  }\n\n  // æœ€ç»ˆä¿å­˜\n  saveToChatVar();\n  console.log(\'æ•°æ®å·²ä¿å­˜\');\n});\n\nfunction showAIDialog() {\n  showAI.value = true;\n  aiPrompt.value = \'\';\n}\n\nfunction closeAIDialog() {\n  showAI.value = false;\n  aiPrompt.value = \'\';\n}\n\n// Bug ä¿®å¤å¯¹è¯æ¡†\nfunction showBugFixDialog() {\n  showBugFix.value = true;\n  bugDescription.value = \'\';\n  consoleError.value = \'\';\n  bugFile.value = \'\';\n}\n\nfunction closeBugFixDialog() {\n  showBugFix.value = false;\n  bugDescription.value = \'\';\n  consoleError.value = \'\';\n  bugFile.value = \'\';\n}\n\nasync function fixBugWithAI() {\n  const proj = currentProject.value;\n  if (!proj) {\n    window.toastr.error(\'è¯·å…ˆé€‰æ‹©é¡¹ç›®\');\n    return;\n  }\n\n  if (!bugDescription.value.trim()) {\n    window.toastr.error(\'è¯·æè¿°é—®é¢˜\');\n    return;\n  }\n\n  aiGenerating.value = true;\n  showProgress.value = true;\n  let normalizedEndpoint = \'\';\n\n  try {\n    // é˜¶æ®µ 1: å‡†å¤‡è¯·æ±‚\n    progressDialogRef.value?.setProgress(5);\n    progressDialogRef.value?.setMessage(\'æ­£åœ¨å‡†å¤‡ Bug ä¿®å¤è¯·æ±‚...\');\n    await new Promise(r => setTimeout(r, 100));\n\n    // è·å– API é…ç½®\n    const scriptId = getScriptIdSafe();\n    if (!scriptId) {\n      throw new Error(\'æ— æ³•è·å–è„šæœ¬ ID\');\n    }\n\n    const vars = getVariables({ type: \'script\', script_id: scriptId });\n    const apiEndpoint = vars?.api_endpoint;\n    const apiKey = vars?.api_key;\n    const model = vars?.model || \'gpt-4o-mini\';\n\n    if (!apiEndpoint || !apiKey) {\n      throw new Error(\'è¯·å…ˆåœ¨"è®¾ç½®"æ ‡ç­¾ä¸­é…ç½® API\');\n    }\n\n    normalizedEndpoint = normalizeApiEndpoint(apiEndpoint);\n\n    progressDialogRef.value?.setProgress(15);\n    progressDialogRef.value?.setMessage(\'æ­£åœ¨æ„å»º Bug ä¿®å¤æç¤ºè¯...\');\n    await new Promise(r => setTimeout(r, 100));\n\n    // æ„å»ºä¸“é—¨çš„ Bug ä¿®å¤æç¤ºè¯\n    const systemPrompt = `ä½ æ˜¯ä¸“ä¸šçš„å‰ç«¯ Bug ä¿®å¤ä¸“å®¶ã€‚\n\n# ä¿®å¤è¦æ±‚\n\n1. **ä¸“æ³¨æ€§**ï¼šåªä¿®å¤ç”¨æˆ·æè¿°çš„å…·ä½“é—®é¢˜ï¼Œä¸è¦æ”¹åŠ¨å…¶ä»–åŠŸèƒ½\n2. **æœ€å°åŒ–æ”¹åŠ¨**ï¼šåªä¿®æ”¹å¿…è¦çš„ä»£ç ï¼Œä¿æŒå…¶ä»–éƒ¨åˆ†ä¸å˜\n3. **ç²¾å‡†å®šä½**ï¼šä¼˜å…ˆæ ¹æ® Console é”™è¯¯ä¿¡æ¯å®šä½é—®é¢˜\n4. **ä¿æŒé£æ ¼**ï¼šä¿®å¤åçš„ä»£ç è¦ä¿æŒåŸæœ‰çš„å‘½åã€æ ¼å¼ã€ç¼©è¿›é£æ ¼\n\n# å¸¸è§ Bug ç±»å‹å’Œä¿®å¤ç­–ç•¥\n\n**ç‚¹å‡»æ— å“åº”ï¼š**\n- æ£€æŸ¥äº‹ä»¶ç»‘å®šæ˜¯å¦æ­£ç¡®ï¼ˆID æ˜¯å¦åŒ¹é…ï¼‰\n- æ£€æŸ¥å‡½æ•°æ˜¯å¦åœ¨ \\`$(function() {})\\` å†…æ­£ç¡®å®šä¹‰\n- æ£€æŸ¥æ˜¯å¦æœ‰ JavaScript é”™è¯¯é˜»æ­¢äº†æ‰§è¡Œ\n\n**æ˜¾ç¤ºå¼‚å¸¸ï¼š**\n- æ£€æŸ¥ CSS æ ·å¼ï¼ˆdisplayã€visibilityã€z-indexï¼‰\n- æ£€æŸ¥ DOM ç»“æ„æ˜¯å¦æ­£ç¡®\n- æ£€æŸ¥æ•°æ®ç»‘å®šæ˜¯å¦æ­£å¸¸\n\n**æ•°æ®ä¿å­˜å¤±è´¥ï¼š**\n- æ£€æŸ¥ insertOrAssignVariables è°ƒç”¨\n- æ£€æŸ¥æ•°æ®æ ¼å¼æ˜¯å¦æ­£ç¡®\n- æ£€æŸ¥å˜é‡ä½œç”¨åŸŸ\n\n**é€»è¾‘é”™è¯¯ï¼š**\n- æ£€æŸ¥æ¡ä»¶åˆ¤æ–­\n- æ£€æŸ¥å¼‚æ­¥å¤„ç†\n- æ£€æŸ¥å˜é‡ä½œç”¨åŸŸ\n\n# è¾“å‡ºæ ¼å¼\n\nåªè¾“å‡ºéœ€è¦ä¿®æ”¹çš„æ–‡ä»¶ï¼Œä½¿ç”¨ä»¥ä¸‹æ ¼å¼ï¼š\n\n\\`\\`\\`\nFILE_START: æ–‡ä»¶å\n[ä¿®æ”¹åçš„å®Œæ•´æ–‡ä»¶å†…å®¹ï¼Œå¹¶åœ¨å…³é”®ä¿®å¤ä½ç½®æ·»åŠ æ³¨é‡Š]\nFILE_END\n\\`\\`\\`\n\nä¸è¦è¾“å‡ºä»»ä½•å…¶ä»–æ–‡å­—æˆ–è§£é‡Šï¼`;\n\n    const currentFiles = proj.files.map(f => `=== ${f.path} ===\\n${f.content}`).join(\'\\n\\n\');\n\n    const userPrompt = `# å½“å‰é¡¹ç›®æ–‡ä»¶ï¼š\n${currentFiles}\n\n# Bug æè¿°ï¼š\n${bugDescription.value}\n\n${\n  consoleError.value.trim()\n    ? `# Console é”™è¯¯ä¿¡æ¯ï¼š\n\\`\\`\\`\n${consoleError.value}\n\\`\\`\\`\n`\n    : \'\'\n}\n\n${\n  bugFile.value\n    ? `# é—®é¢˜å¯èƒ½åœ¨æ–‡ä»¶ï¼š\n${bugFile.value}\n`\n    : \'\'\n}\n\n# ä¿®å¤è¦æ±‚ï¼š\n1. ä¸“æ³¨ä¿®å¤ä¸Šè¿° bugï¼Œä¸è¦æ”¹å…¶ä»–åœ°æ–¹\n2. åªè¾“å‡ºéœ€è¦ä¿®æ”¹çš„æ–‡ä»¶\n3. åœ¨ä¿®å¤çš„å…³é”®ä½ç½®æ·»åŠ æ³¨é‡Šè¯´æ˜ä¿®å¤å†…å®¹\n4. ä¿æŒä»£ç é£æ ¼ä¸€è‡´\n\nè¯·ä¸¥æ ¼æŒ‰ system ä¸­çš„æ ¼å¼è¾“å‡ºï¼Œä¸è¦æ·»åŠ è§£é‡Šï¼`;\n\n    progressDialogRef.value?.setProgress(25);\n    progressDialogRef.value?.setMessage(\'æ­£åœ¨å‘é€è¯·æ±‚åˆ° AI æœåŠ¡å™¨...\');\n    await new Promise(r => setTimeout(r, 100));\n\n    // å‘é€è¯·æ±‚\n    progressDialogRef.value?.setProgress(30);\n    progressDialogRef.value?.setMessage(\'ç­‰å¾… AI åˆ†æ bug...\');\n    await new Promise(r => setTimeout(r, 100));\n\n    const response = await fetch(normalizedEndpoint, {\n      method: \'POST\',\n      headers: {\n        \'Content-Type\': \'application/json\',\n        Authorization: `Bearer ${apiKey}`,\n      },\n      body: JSON.stringify({\n        model: model,\n        messages: [\n          { role: \'system\', content: systemPrompt },\n          { role: \'user\', content: userPrompt },\n        ],\n        temperature: 0.3, // é™ä½æ¸©åº¦ï¼Œè®©ä¿®å¤æ›´ç¨³å®š\n      }),\n    });\n\n    if (!response.ok) {\n      const errorText = await response.text();\n      throw new Error(`API è¯·æ±‚å¤±è´¥ (${response.status}): ${errorText}`);\n    }\n\n    progressDialogRef.value?.setProgress(60);\n    progressDialogRef.value?.setMessage(\'æ­£åœ¨æ¥æ”¶ AI ä¿®å¤æ–¹æ¡ˆ...\');\n    await new Promise(r => setTimeout(r, 100));\n\n    const data = await response.json();\n    const resultText = data.choices?.[0]?.message?.content || \'\';\n\n    if (!resultText) {\n      throw new Error(\'AI æœªè¿”å›ä¿®å¤æ–¹æ¡ˆ\');\n    }\n\n    progressDialogRef.value?.setProgress(75);\n    progressDialogRef.value?.setMessage(\'æ­£åœ¨è§£æä¿®å¤æ–¹æ¡ˆ...\');\n    await new Promise(r => setTimeout(r, 100));\n\n    // è§£æ AI è¿”å›çš„æ–‡ä»¶\n    const fileRegex = /FILE_START:\\s*(.+?)\\s*\\n([\\s\\S]*?)\\nFILE_END/g;\n    const changes: AIChange[] = [];\n    let match;\n\n    while ((match = fileRegex.exec(resultText)) !== null) {\n      const path = match[1].trim();\n      const newContent = match[2].trim();\n      const existingFile = proj.files.find(f => f.path === path);\n\n      if (existingFile) {\n        changes.push({\n          path,\n          oldContent: existingFile.content,\n          newContent,\n        });\n      }\n    }\n\n    if (changes.length === 0) {\n      throw new Error(\'AI æœªè¿”å›æœ‰æ•ˆçš„ä¿®å¤æ–¹æ¡ˆ\');\n    }\n\n    progressDialogRef.value?.setProgress(85);\n    progressDialogRef.value?.setMessage(\'æ­£åœ¨å‡†å¤‡å¯¹æ¯”é¢„è§ˆ...\');\n    await new Promise(r => setTimeout(r, 100));\n\n    // ä¿å­˜åˆ°å†å²è®°å½•ï¼ˆä¼šåœ¨ç”¨æˆ·æ¥å—æ›´æ”¹æ—¶è‡ªåŠ¨ä¿å­˜ï¼‰\n    if (!aiHistory.value[proj.id]) {\n      aiHistory.value[proj.id] = [];\n    }\n    aiHistory.value[proj.id].unshift({\n      timestamp: new Date().toISOString(),\n      prompt: `Bug ä¿®å¤: ${bugDescription.value}`,\n      changes: klona(changes),\n    });\n\n    // æ˜¾ç¤ºå¯¹æ¯”\n    aiChanges.value = changes;\n    showComparison.value = true;\n    previewMode.value = \'after\';\n\n    progressDialogRef.value?.setProgress(95);\n    progressDialogRef.value?.setMessage(`Bug ä¿®å¤æ–¹æ¡ˆå·²ç”Ÿæˆ (${changes.length} ä¸ªæ–‡ä»¶)`);\n    await new Promise(r => setTimeout(r, 100));\n\n    // å®Œæˆ\n    progressDialogRef.value?.setProgress(100);\n    progressDialogRef.value?.setMessage(\'Bug ä¿®å¤æ–¹æ¡ˆå·²ç”Ÿæˆï¼\');\n    setTimeout(() => {\n      showProgress.value = false;\n      showBugFix.value = false;\n      window.toastr.success(`AI å·²ç”Ÿæˆä¿®å¤æ–¹æ¡ˆï¼Œè¯·åœ¨å¯¹æ¯”çª—å£ä¸­æŸ¥çœ‹`);\n    }, 800);\n  } catch (error: any) {\n    console.error(\'Bug ä¿®å¤å¤±è´¥:\', error);\n    window.toastr.error(`Bug ä¿®å¤å¤±è´¥: ${error?.message || String(error)}`);\n    showProgress.value = false;\n  } finally {\n    aiGenerating.value = false;\n  }\n}\n\nasync function generateWithAI() {\n  if (!aiPrompt.value.trim() || aiGenerating.value) return;\n\n  const proj = currentProject.value;\n  if (!proj) {\n    toastr.error(\'è¯·å…ˆé€‰æ‹©ä¸€ä¸ªé¡¹ç›®\');\n    return;\n  }\n\n  // æ£€æŸ¥ç”¨æˆ·è¾“å…¥æ˜¯å¦è¿‡äºæ¨¡ç³Š\n  const vaguePhrases = [\'å®Œå–„\', \'ä¼˜åŒ–\', \'æ”¹è¿›\', \'ç¾åŒ–\', \'ä¿®æ”¹\', \'è°ƒæ•´\', \'æ›´æ–°\'];\n  const prompt = aiPrompt.value.trim();\n  const isVague = vaguePhrases.some(phrase => {\n    const regex = new RegExp(`^${phrase}[ä¸€ä¸‹äº†å§å‘—å•Šå—ã€‚ï¼ï¼Ÿ\\\\s]*$`, \'i\');\n    return regex.test(prompt);\n  });\n\n  if (isVague) {\n    toastr.warning(\n      \'è¯·è¯¦ç»†æè¿°ä½ çš„éœ€æ±‚ï¼\\n\\nä¾‹å¦‚ï¼š\\n\' +\n        \'âŒ "ä¼˜åŒ–ä¸€ä¸‹"\\n\' +\n        \'âœ… "ä¼˜åŒ–æŒ‰é’®æ ·å¼ï¼Œæ·»åŠ æ‚¬åœåŠ¨ç”»å’Œåœ†è§’æ•ˆæœ"\\n\\n\' +\n        \'âŒ "å®Œå–„"\\n\' +\n        \'âœ… "æ·»åŠ å“åº”å¼å¸ƒå±€ï¼Œæ”¯æŒç§»åŠ¨ç«¯æ˜¾ç¤º"\',\n      \'éœ€æ±‚å¤ªæ¨¡ç³Šäº†\',\n      { timeOut: 6000 },\n    );\n    return;\n  }\n\n  aiGenerating.value = true;\n  showProgress.value = true;\n  let normalizedEndpoint = \'\'; // æåˆ°å¤–å±‚ä½œç”¨åŸŸ\n\n  try {\n    // é˜¶æ®µ1: å‡†å¤‡è¯·æ±‚\n    progressDialogRef.value?.setProgress(5);\n    progressDialogRef.value?.setMessage(\'æ­£åœ¨å‡†å¤‡ AI è¯·æ±‚...\');\n    await new Promise(r => setTimeout(r, 100)); // ç­‰å¾… DOM æ›´æ–°\n\n    const scriptId = getScriptIdSafe();\n    if (!scriptId) {\n      toastr.error(\'æ— æ³•è·å–è„šæœ¬ ID\');\n      aiGenerating.value = false;\n      showProgress.value = false;\n      return;\n    }\n\n    const vars = getVariables({ type: \'script\', script_id: scriptId });\n    const apiEndpoint = vars?.api_endpoint;\n    const apiKey = vars?.api_key;\n    const model = vars?.model || \'gpt-4o-mini\';\n    const temperature = vars?.temperature || 0.7;\n    const maxTokens = vars?.max_tokens || 4000;\n\n    if (!apiEndpoint || !apiKey) {\n      toastr.error(\'è¯·å…ˆåœ¨"è®¾ç½®"æ ‡ç­¾é¡µé…ç½® API\');\n      aiGenerating.value = false;\n      showProgress.value = false;\n      return;\n    }\n\n    // è§„èŒƒåŒ– API ç«¯ç‚¹\n    try {\n      normalizedEndpoint = normalizeApiEndpoint(apiEndpoint);\n      console.log(\'ğŸ“ åŸå§‹ç«¯ç‚¹:\', apiEndpoint);\n      console.log(\'ğŸ”— è§„èŒƒåŒ–åçš„ç«¯ç‚¹:\', normalizedEndpoint);\n    } catch (e) {\n      toastr.error(\'API ç«¯ç‚¹æ ¼å¼ä¸æ­£ç¡®ï¼š\' + (e as Error).message);\n      aiGenerating.value = false;\n      showProgress.value = false;\n      return;\n    }\n\n    // æ£€æŸ¥ max_tokens æ˜¯å¦è¶³å¤Ÿ\n    if (maxTokens < 2000) {\n      toastr.warning(`å½“å‰ max_tokens è®¾ç½®ä¸º ${maxTokens}ï¼Œå¯èƒ½å¯¼è‡´ AI è¿”å›å†…å®¹è¢«æˆªæ–­ã€‚å»ºè®®è®¾ç½®ä¸º 4000 ä»¥ä¸Šã€‚`);\n    }\n\n    progressDialogRef.value?.setProgress(15);\n    progressDialogRef.value?.setMessage(\'æ­£åœ¨æ„å»ºæç¤ºè¯...\');\n    await new Promise(r => setTimeout(r, 100)); // ç­‰å¾… DOM æ›´æ–°\n\n    const systemPrompt = `ä½ æ˜¯ä¸“ä¸šçš„å‰ç«¯å¼€å‘åŠ©æ‰‹ã€‚è¿™æ˜¯ä¸€ä¸ªåœ¨ SillyTavernï¼ˆé…’é¦†ï¼‰ä¸­è¿è¡Œçš„å‰ç«¯ç•Œé¢é¡¹ç›®ã€‚\n\n# å½“å‰é¡¹ç›®æ–‡ä»¶ï¼š\n${proj.files.map(f => `- ${f.path}`).join(\'\\n\')}\n\n# å¯ç”¨çš„ API å’Œåº“ï¼ˆå¯ç›´æ¥ä½¿ç”¨ï¼Œæ— éœ€å¯¼å…¥ï¼‰ï¼š\n## ç¬¬ä¸‰æ–¹åº“ï¼š\n- jQuery ($): DOM æ“ä½œã€äº‹ä»¶å¤„ç†\n- toastr: æ¶ˆæ¯æç¤º\n- gsap: åŠ¨ç”»æ•ˆæœ\n- lodash (_): å·¥å…·å‡½æ•°\n- zod (z): æ•°æ®æ ¡éªŒ\n\n## é…’é¦†åŠ©æ‰‹ APIï¼ˆå…¨å±€å¯ç”¨ï¼‰ï¼š\n**æ•°æ®æŒä¹…åŒ–ï¼ˆé‡è¦ï¼ï¼‰ï¼š**\n- \\`getVariables({ type: \'chat\' })\\`: è·å–èŠå¤©å˜é‡ï¼ˆå¯¹è±¡å½¢å¼ï¼‰\n- \\`insertOrAssignVariables(data, { type: \'chat\' })\\`: ä¿å­˜æ•°æ®åˆ°èŠå¤©å˜é‡ï¼ˆæ¨èç”¨è¿™ä¸ªï¼‰\n- \\`replaceVariables(data, { type: \'chat\' })\\`: å®Œå…¨æ›¿æ¢èŠå¤©å˜é‡\n\n**æ•°æ®æŒä¹…åŒ–ç¤ºä¾‹ä»£ç ï¼š**\n\\`\\`\\`javascript\n// âš ï¸ é‡è¦ï¼šéœ€è¦æ£€æµ‹æ˜¯å¦åœ¨é…’é¦†ç¯å¢ƒä¸­ï¼ˆé¢„è§ˆæ¨¡å¼ä¸‹é…’é¦† API ä¸å¯ç”¨ï¼‰\nconst isInTavern = typeof SillyTavern !== \'undefined\' && typeof getVariables !== \'undefined\';\n\n// åŠ è½½æ•°æ®\nfunction loadData() {\n  if (isInTavern) {\n    const data = getVariables({ type: \'chat\' });\n    return data.my_key || { count: 0 };\n  } else {\n    // é¢„è§ˆæ¨¡å¼ï¼šä½¿ç”¨ localStorage\n    const stored = localStorage.getItem(\'my_key\');\n    return stored ? JSON.parse(stored) : { count: 0 };\n  }\n}\n\n// ä¿å­˜æ•°æ®\nfunction saveData(data) {\n  if (isInTavern) {\n    insertOrAssignVariables({ my_key: data }, { type: \'chat\' });\n  } else {\n    localStorage.setItem(\'my_key\', JSON.stringify(data));\n  }\n}\n\n// ä½¿ç”¨\nlet myData = loadData();\nmyData.count++;\nsaveData(myData);\n\\`\\`\\`\n\n**å…¶ä»– APIï¼š**\n- getChatMessages(): è·å–å½“å‰èŠå¤©çš„æ‰€æœ‰æ¶ˆæ¯\n- getCurrentCharacter(): è·å–å½“å‰è§’è‰²å¡ä¿¡æ¯\n- getWorldbook(): è·å–ä¸–ç•Œä¹¦\n- replaceWorldbook(data): æ›¿æ¢ä¸–ç•Œä¹¦\n- eventOn(event, callback): ç›‘å¬é…’é¦†äº‹ä»¶\n- getIframeName(): è·å–å½“å‰ iframe åç§°\n- triggerSlash(command): æ‰§è¡Œ STScript å‘½ä»¤\n- SillyTavern.getCurrentChatId(): è·å–å½“å‰èŠå¤© ID\n\n## ä»æ¶ˆæ¯ä¸­è¯»å–æ•°æ®å¹¶æ›´æ–°ç•Œé¢\n\n**åœºæ™¯ï¼š** åˆ›å»ºçŠ¶æ€æ ç•Œé¢ï¼Œéœ€è¦ä»æœ€æ–°çš„ AI æ¶ˆæ¯ä¸­æå–è§’è‰²çŠ¶æ€å¹¶å®æ—¶æ˜¾ç¤ºã€‚\n\n**æ ¸å¿ƒä»£ç ç¤ºä¾‹ï¼š**\n\n\\`\\`\\`javascript\n// 1. è¯»å–æœ€æ–°æ¶ˆæ¯å†…å®¹\nasync function updateStatusFromMessages() {\n  if (typeof getChatMessages !== \'function\') return; // é¢„è§ˆæ¨¡å¼è·³è¿‡\n\n  const messages = await getChatMessages();\n  if (!messages || messages.length === 0) return;\n\n  // è·å–æœ€æ–°çš„ AI æ¶ˆæ¯ï¼ˆä»åå¾€å‰æ‰¾ç¬¬ä¸€æ¡ is_user: falseï¼‰\n  const latestAIMessage = messages.slice().reverse().find(m => !m.is_user);\n  if (!latestAIMessage) return;\n\n  const content = latestAIMessage.mes; // æ¶ˆæ¯æ–‡æœ¬å†…å®¹\n\n  // 2. ä½¿ç”¨æ­£åˆ™æå–çŠ¶æ€æ•°æ®ï¼ˆç¤ºä¾‹ï¼šæå–ä»£ç å—ä¸­çš„çŠ¶æ€ï¼‰\n  const statusMatch = content.match(/\\`\\`\\`json([\\\\s\\\\S]*?)\\`\\`\\`/);\n  if (statusMatch) {\n    try {\n      const status = JSON.parse(statusMatch[1]);\n      // 3. æ›´æ–°ç•Œé¢æ˜¾ç¤º\n      $(\'#health\').text(status.health || 100);\n      $(\'#level\').text(status.level || 1);\n    } catch (e) {\n      console.error(\'è§£æçŠ¶æ€å¤±è´¥:\', e);\n    }\n  }\n\n  // æˆ–è€…ç”¨æ­£åˆ™ç›´æ¥æå–ç‰¹å®šæ ¼å¼ï¼ˆä¾‹å¦‚ï¼šã€ç”Ÿå‘½å€¼ï¼š80ã€‘ï¼‰\n  const healthMatch = content.match(/ã€ç”Ÿå‘½å€¼[ï¼š:](\\\\d+)ã€‘/);\n  if (healthMatch) {\n    $(\'#health\').text(healthMatch[1]);\n  }\n}\n\n// 4. é¡µé¢åŠ è½½æ—¶æ›´æ–°\n$(function() {\n  updateStatusFromMessages();\n});\n\n// 5. ç›‘å¬æ–°æ¶ˆæ¯äº‹ä»¶ï¼Œè‡ªåŠ¨æ›´æ–°ï¼ˆå¯é€‰ï¼‰\nif (typeof eventOn === \'function\') {\n  eventOn(\'MESSAGE_RECEIVED\', () => {\n    updateStatusFromMessages();\n  });\n}\n\\`\\`\\`\n\n---\n\n## ğŸ¯ çŠ¶æ€æ  XML ç¾åŒ–ï¼ˆé‡è¦ï¼ï¼‰\n\n**åœºæ™¯ï¼š** AI å›å¤ä¸­åŒ…å« XML æ ¼å¼çš„çŠ¶æ€æ ï¼ˆå¦‚ \\`<state_bar><i>ã€å†…å®¹ã€‘</i></state_bar>\\`ï¼‰ï¼Œéœ€è¦å°†å…¶ç¾åŒ–æ˜¾ç¤ºã€‚\n\n**æ ¸å¿ƒåŠŸèƒ½ï¼š**\n1. æå– \\`<state_bar>\\` æ ‡ç­¾å†…å®¹\n2. å°† XML æ ‡ç­¾è½¬æ¢ä¸ºç¾åŒ–çš„ HTML\n3. å®æ—¶æ˜¾ç¤ºåœ¨ç•Œé¢ä¸Š\n\n**å®Œæ•´å®ç°ç¤ºä¾‹ï¼š**\n\n\\`\\`\\`typescript\n// ===== 1. æå–çŠ¶æ€æ å†…å®¹ =====\nfunction extractStateBar(text: string): string | null {\n  const match = text.match(/<state_bar>([\\\\s\\\\S]*?)<\\\\/state_bar>/i);\n  return match ? match[1].trim() : null;\n}\n\n// ===== 2. XML è½¬ HTMLï¼ˆæ”¯æŒå¤šç§æ ‡ç­¾æ ¼å¼ï¼‰=====\nfunction convertXmlToHtml(xml: string): string {\n  let html = xml;\n\n  // å¤„ç†ç¼©è¿›æ ‡ç­¾ï¼š<i>ã€<2i>ã€<3i> ç­‰\n  html = html.replace(/<i>([\\\\s\\\\S]*?)<\\\\/i>/g, \'<div class="state-item indent-1">$1</div>\');\n  html = html.replace(/<2i>([\\\\s\\\\S]*?)<\\\\/2i>/g, \'<div class="state-item indent-2">$1</div>\');\n  html = html.replace(/<3i>([\\\\s\\\\S]*?)<\\\\/3i>/g, \'<div class="state-item indent-3">$1</div>\');\n\n  // å¤„ç†è¯­ä¹‰åŒ–æ ‡ç­¾ï¼ˆå¸¸è§çš„çŠ¶æ€æ æ ‡ç­¾ï¼‰\n  html = html.replace(/<æ—¥æœŸ>([\\\\s\\\\S]*?)<\\\\/æ—¥æœŸ>/g, \'<div class="state-date">ğŸ“… $1</div>\');\n  html = html.replace(/<æ—¶é—´>([\\\\s\\\\S]*?)<\\\\/æ—¶é—´>/g, \'<div class="state-time">ğŸ• $1</div>\');\n  html = html.replace(/<åœ°ç‚¹>([\\\\s\\\\S]*?)<\\\\/åœ°ç‚¹>/g, \'<div class="state-location">ğŸ“ $1</div>\');\n  html = html.replace(/<è§’è‰²ç”Ÿç†çŠ¶æ€>([\\\\s\\\\S]*?)<\\\\/è§’è‰²ç”Ÿç†çŠ¶æ€>/g, \'<div class="state-physical">ğŸ’“ $1</div>\');\n  html = html.replace(/<è§’è‰²å¿ƒç†çŠ¶æ€>([\\\\s\\\\S]*?)<\\\\/è§’è‰²å¿ƒç†çŠ¶æ€>/g, \'<div class="state-mental">ğŸ§  $1</div>\');\n  html = html.replace(/<å½“å‰çŠ¶æ€>([\\\\s\\\\S]*?)<\\\\/å½“å‰çŠ¶æ€>/g, \'<div class="state-current">âœ¨ $1</div>\');\n\n  // å¤„ç†é¢œè‰²æ ‡ç­¾ï¼ˆå¦‚ <è§’è‰²ç”Ÿç†çŠ¶æ€>ã€æè¿°è§’è‰²å½“å‰ç”Ÿç†çŠ¶æ€ã€‘</è§’è‰²ç”Ÿç†çŠ¶æ€>ï¼‰\n  html = html.replace(/<è§’è‰²ç”Ÿç†çŠ¶æ€>([\\\\s\\\\S]*?)<\\\\/è§’è‰²ç”Ÿç†çŠ¶æ€>/g,\n    \'<div class="state-colored" style="border-left: 3px solid #ff6b6b; background: rgba(255,107,107,0.1);">$1</div>\');\n\n  // é€šç”¨æ ‡ç­¾å¤„ç†ï¼ˆå…œåº•æ–¹æ¡ˆï¼‰\n  html = html.replace(/<([^>\\\\/\\\\s]+)>([\\\\s\\\\S]*?)<\\\\/\\\\1>/g, \'<div class="state-generic">$2</div>\');\n\n  return html;\n}\n\n// ===== 3. ç›‘å¬æ¶ˆæ¯å¹¶æ›´æ–° =====\nasync function updateStateBar() {\n  if (typeof getChatMessages !== \'function\') return;\n\n  const messages = await getChatMessages();\n  if (!messages || messages.length === 0) return;\n\n  // è·å–æœ€æ–°çš„ AI æ¶ˆæ¯\n  const latestAI = messages.slice().reverse().find(m => !m.is_user);\n  if (!latestAI) return;\n\n  // æå–çŠ¶æ€æ \n  const stateBarXml = extractStateBar(latestAI.mes);\n  if (stateBarXml) {\n    const stateBarHtml = convertXmlToHtml(stateBarXml);\n\n    // æ›´æ–°ç•Œé¢ï¼ˆå¸¦åŠ¨ç”»ï¼‰\n    const container = $(\'#state-bar-container\');\n    container.fadeOut(200, () => {\n      container.html(stateBarHtml);\n      container.fadeIn(200);\n    });\n  }\n}\n\n// ===== 4. åˆå§‹åŒ–å’Œç›‘å¬ =====\n$(function() {\n  updateStateBar(); // é¡µé¢åŠ è½½æ—¶æ›´æ–°\n\n  // ç›‘å¬æ¶ˆæ¯æ¥æ”¶äº‹ä»¶\n  if (typeof eventOn === \'function\') {\n    eventOn(\'MESSAGE_RECEIVED\', updateStateBar);\n  }\n});\n\\`\\`\\`\n\n**é…å¥— CSS æ ·å¼ï¼š**\n\n\\`\\`\\`scss\n#state-bar-container {\n  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);\n  border-radius: 12px;\n  padding: 16px;\n  color: white;\n  box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);\n  margin-bottom: 16px;\n}\n\n.state-item {\n  padding: 8px 12px;\n  margin: 6px 0;\n  background: rgba(255, 255, 255, 0.1);\n  border-radius: 6px;\n  backdrop-filter: blur(10px);\n  transition: all 0.3s ease;\n\n  &:hover {\n    background: rgba(255, 255, 255, 0.15);\n    transform: translateX(4px);\n  }\n}\n\n// ç¼©è¿›æ ·å¼\n.indent-1 { margin-left: 20px; }\n.indent-2 { margin-left: 40px; }\n.indent-3 { margin-left: 60px; }\n\n// è¯­ä¹‰åŒ–æ ‡ç­¾æ ·å¼\n.state-date, .state-time, .state-location {\n  font-weight: 600;\n  font-size: 14px;\n  padding: 8px 12px;\n  margin: 8px 0;\n  border-radius: 6px;\n}\n\n.state-date { background: rgba(100, 181, 246, 0.2); }\n.state-time { background: rgba(129, 199, 132, 0.2); }\n.state-location { background: rgba(255, 167, 38, 0.2); }\n\n.state-physical {\n  padding: 10px 14px;\n  margin: 8px 0;\n  background: rgba(255, 107, 107, 0.15);\n  border-left: 4px solid #ff6b6b;\n  border-radius: 4px;\n}\n\n.state-mental {\n  padding: 10px 14px;\n  margin: 8px 0;\n  background: rgba(149, 117, 205, 0.15);\n  border-left: 4px solid #9575cd;\n  border-radius: 4px;\n}\n\n.state-colored {\n  padding: 10px 14px;\n  margin: 8px 0;\n  border-radius: 4px;\n  backdrop-filter: blur(5px);\n}\n\n.state-generic {\n  padding: 6px 10px;\n  margin: 4px 0;\n  opacity: 0.9;\n}\n\\`\\`\\`\n\n**ä½¿ç”¨ GSAP åˆ¶ä½œé«˜çº§åŠ¨ç”»ï¼ˆå¯é€‰ï¼‰ï¼š**\n\n\\`\\`\\`typescript\n// ä½¿ç”¨ GSAP åˆ¶ä½œæ›´æµç•…çš„åŠ¨ç”»\nfunction updateStateBarWithAnimation(stateBarHtml: string) {\n  const container = $(\'#state-bar-container\');\n\n  // æ·¡å‡º\n  gsap.to(container, {\n    opacity: 0,\n    y: -10,\n    duration: 0.2,\n    onComplete: () => {\n      container.html(stateBarHtml);\n\n      // æ·¡å…¥\n      gsap.to(container, {\n        opacity: 1,\n        y: 0,\n        duration: 0.3,\n        ease: \'power2.out\'\n      });\n\n      // å­å…ƒç´ ä¾æ¬¡å‡ºç°\n      gsap.from(\'.state-item\', {\n        opacity: 0,\n        x: -20,\n        duration: 0.4,\n        stagger: 0.05,\n        ease: \'back.out(1.2)\'\n      });\n    }\n  });\n}\n\\`\\`\\`\n\\`\\`\\`\n\n**å…³é”®ç‚¹ï¼š**\n- ä½¿ç”¨ \\`getChatMessages()\\` è·å–æ‰€æœ‰æ¶ˆæ¯\n- é€šè¿‡æ­£åˆ™è¡¨è¾¾å¼ä»æ¶ˆæ¯æ–‡æœ¬ä¸­æå–æ•°æ®\n- ç”¨ jQuery æ›´æ–° DOM å…ƒç´ æ˜¾ç¤º\n- ç›‘å¬ MESSAGE_RECEIVED äº‹ä»¶å®ç°è‡ªåŠ¨æ›´æ–°\n\n## å®ç°åŒå±‚å¯¹è¯ï¼ˆæµå¼ä¼ è¾“å‰ç«¯ç•Œé¢ï¼‰\n\n**æ ¸å¿ƒæ¦‚å¿µï¼š**\nåŒå±‚å¯¹è¯æ˜¯ä¸€ä¸ª**ç‹¬ç«‹çš„å‰ç«¯ç•Œé¢**ï¼ˆæœ‰è‡ªå·±çš„ index.htmlï¼‰ï¼Œç©å®¶åªåœ¨ç•Œé¢å†…æ¸¸ç©ï¼Œä¸çœ‹é…’é¦†ä¸»èŠå¤©ã€‚\n\n**ğŸš¨ğŸš¨ğŸš¨ ç»å¯¹ç¦æ­¢ï¼ˆå¦åˆ™åŠŸèƒ½å®Œå…¨ä¸å·¥ä½œï¼ï¼‰ğŸš¨ğŸš¨ğŸš¨**\n\n\\`\\`\\`javascript\n// âŒâŒâŒ ç»å¯¹ç¦æ­¢ï¼ç»å¯¹ç¦æ­¢ï¼ç»å¯¹ç¦æ­¢ï¼\n$(function() {\n  let chatHistory = [];           // âŒ å¤–éƒ¨è®¿é—®ä¸åˆ°ï¼\n  function renderMessages() {}    // âŒ å¤–éƒ¨è®¿é—®ä¸åˆ°ï¼\n  function handleSend() {}        // âŒ å¤–éƒ¨è®¿é—®ä¸åˆ°ï¼\n\n  // æ‰€æœ‰ä»£ç éƒ½åœ¨è¿™é‡Œ âŒâŒâŒ\n});\n\n// âœ…âœ…âœ… å¿…é¡»è¿™æ ·å†™ï¼å¿…é¡»è¿™æ ·å†™ï¼å¿…é¡»è¿™æ ·å†™ï¼\nlet chatHistory = [];              // âœ… å…¨å±€å˜é‡\nfunction renderMessages() {}       // âœ… å…¨å±€å‡½æ•°\nfunction handleSend() {}           // âœ… å…¨å±€å‡½æ•°\n\n$(function() {\n  // åªåœ¨è¿™é‡Œè°ƒç”¨å‡½æ•°ï¼Œä¸å®šä¹‰ï¼\n  loadChatHistory();\n  setupStreamListeners();\n});\n\\`\\`\\`\n\n**ä»£ç ç»“æ„å¿…é¡»ä¸¥æ ¼æŒ‰ä»¥ä¸‹é¡ºåºï¼ˆä¸èƒ½æ”¹ï¼ï¼‰ï¼š**\n1. å…¨å±€å˜é‡å®šä¹‰ï¼ˆlet/constï¼‰\n2. å…¨å±€å‡½æ•°å®šä¹‰ï¼ˆfunctionï¼‰\n3. \\`$(function() {})\\` - åªç”¨äºè°ƒç”¨ä¸Šé¢å®šä¹‰çš„å‡½æ•°\n4. \\`$(window).on(\'pagehide\', ...)\\` - å¸è½½äº‹ä»¶\n\n**âš ï¸âš ï¸âš ï¸ ç¬¬äºŒé‡è¦çš„æ³¨æ„äº‹é¡¹ï¼šgeneration_id è¿‡æ»¤**\nåŒå±‚å¯¹è¯çš„æµå¼ç›‘å¬å™¨ä¼šç›‘å¬åˆ°**æ‰€æœ‰**é…’é¦†çš„ç”Ÿæˆäº‹ä»¶ï¼ˆåŒ…æ‹¬ä¸»ç•Œé¢çš„ç”Ÿæˆï¼‰ã€‚å› æ­¤**å¿…é¡»ä½¿ç”¨ generation_id è¿‡æ»¤**ï¼Œå¦åˆ™ä¼šå‡ºç°ï¼š\n- åŒå±‚å¯¹è¯æ¥æ”¶åˆ°ä¸»ç•Œé¢çš„ AI å›å¤\n- çŠ¶æ€ç®¡ç†æ··ä¹±ï¼Œç”ŸæˆçŠ¶æ€å¯¹ä¸ä¸Š\n- æŒ‰é’®çŠ¶æ€å¼‚å¸¸\n\n**å®ç°è¦ç‚¹ï¼š**\n1. åˆ›å»º**å‰ç«¯ç•Œé¢é¡¹ç›®**ï¼ˆindex.html + index.tsï¼‰\n2. ç•Œé¢å†…è®¾è®¡è¾“å…¥æ¡†å’Œå‘é€æŒ‰é’®\n3. ç‚¹å‡»å‘é€æ—¶ï¼Œè°ƒç”¨ \\`generate(text)\\`ï¼Œå¹¶**ä¿å­˜è¿”å›çš„ generation_id**\n4. **ç›‘å¬æµå¼ä¼ è¾“äº‹ä»¶**æ—¶ï¼Œå¿…é¡»æ£€æŸ¥ \\`id === currentGenerationId\\`ï¼š\n   - \\`iframe_events.STREAM_TOKEN_RECEIVED_INCREMENTALLY\\`: æ¯ä¸ª token çš„å¢é‡æ›´æ–°\n   - \\`iframe_events.STREAM_TOKEN_RECEIVED_FULLY\\`: æµå¼ä¼ è¾“å®Œæˆï¼Œè·å–å®Œæ•´æ–‡æœ¬\n   - \\`iframe_events.GENERATION_ENDED\\`: ç”Ÿæˆç»“æŸï¼ˆå¤‡ç”¨æ–¹æ¡ˆï¼‰\n5. åå°æ“ä½œæ¶ˆæ¯æ¥¼å±‚ï¼ˆå¯é€‰ï¼‰ï¼šä½¿ç”¨ \\`setChatMessages\\`ã€\\`createChatMessages\\` é…åˆ \\`{ refresh: \'none\' }\\` å‚æ•°\n\n**âš ï¸âš ï¸âš ï¸ å…³é”® APIï¼ˆå¿…é¡»ä½¿ç”¨æ­¤æ–¹æ³•ï¼ç¦æ­¢ä½¿ç”¨ generate()ï¼ï¼‰ï¼š**\n- **\\`triggerSlashWithResult(command)\\`**: æ‰§è¡Œ STScript å‘½ä»¤å¹¶è·å–è¿”å›å€¼\n  - è¿”å›å€¼ï¼š\\`Promise<string>\\`ï¼ˆAI ç”Ÿæˆçš„å®Œæ•´æ–‡æœ¬ï¼‰\n  - ç¤ºä¾‹ï¼š\\`const result = await triggerSlashWithResult(\'/gen lock=on "å¯¹è¯å†…å®¹"\');\\`\n  - **é‡è¦**ï¼šä½¿ç”¨ \\`/gen\\` å‘½ä»¤ä¼šè‡ªåŠ¨ä½¿ç”¨è§’è‰²å¡ã€é¢„è®¾ã€ä¸–ç•Œä¹¦\n  - **å…³é”®ä¼˜åŠ¿**ï¼šä¸éœ€è¦æµå¼ç›‘å¬ï¼Œä¸éœ€è¦ generation_idï¼Œç›´æ¥è¿”å›å®Œæ•´ç»“æœ\n- **\\`getRegexScripts()\\`**: è·å–å½“å‰å¯ç”¨çš„æ­£åˆ™è„šæœ¬åˆ—è¡¨\n  - ç”¨äºè¿‡æ»¤æ€ç»´é“¾ã€è°ƒè¯•ä¿¡æ¯ç­‰\n  - **å¿…é¡»åœ¨æ˜¾ç¤º AI å›å¤å‰åº”ç”¨æ­£åˆ™è¿‡æ»¤**\n- **æ„å»ºå¯¹è¯å†å²ä¸ºæç¤ºè¯**ï¼šå°†å¯¹è¯å†å²æ‹¼æ¥æˆæ–‡æœ¬ï¼Œè€Œä¸æ˜¯ç”¨ API å‚æ•°\n- **\\`triggerSlash(command)\\`**: æ‰§è¡Œ STScript å‘½ä»¤ä½†ä¸ç­‰å¾…è¿”å›å€¼\n\n**âš ï¸âš ï¸âš ï¸ AI å›å¤çš„æ ‡ç­¾æ¸…ç†ï¼ˆéå¸¸é‡è¦ï¼ï¼‰ï¼š**\nAI å¯èƒ½ä¼šåœ¨å›å¤ä¸­ç”Ÿæˆæ€ç»´é“¾æ ‡ç­¾ï¼Œå¦‚ï¼š\\`<guide>\\`ã€\\`<dream>\\`ã€\\`<plot>\\`ã€\\`<status>\\`ã€\\`<think>\\` ç­‰ã€‚\nè¿™äº›æ ‡ç­¾**å¿…é¡»åœ¨æ˜¾ç¤ºå‰ç§»é™¤**ï¼Œå¦åˆ™ä¼šç ´åç•Œé¢æ•ˆæœï¼\n\n**æ¸…ç†ç­–ç•¥ï¼ˆå‚è€ƒæ¢¦æ˜Ÿå¤§ä½¬çš„æ–¹æ¡ˆï¼‰ï¼š**\n1. **ä¼˜å…ˆæå–æ­£æ–‡æ ‡ç­¾**ï¼šå¦‚æœ AI ç”¨ç‰¹å®šæ ‡ç­¾åŒ…è£¹æ­£æ–‡ï¼ˆå¦‚ \\`<gametxt>\\`ï¼‰ï¼Œä¼˜å…ˆæå–\n2. **å¤‡ç”¨æ–¹æ¡ˆ**ï¼šç§»é™¤æ‰€æœ‰æ€ç»´é“¾æ ‡ç­¾\n3. **å¯é€‰å¢å¼º**ï¼šåº”ç”¨é…’é¦†çš„å…¨å±€æ­£åˆ™å’Œé¢„è®¾æ­£åˆ™\n\n**å®Œæ•´çš„æ¸…ç†å‡½æ•°æ¨¡æ¿ï¼ˆæ¢¦æ˜Ÿæ–¹æ¡ˆï¼‰ï¼š**\n\\`\\`\\`typescript\n// è¾…åŠ©å‡½æ•°ï¼šæå–æ ‡ç­¾å†…å®¹ï¼ˆä»åå¾€å‰æŸ¥æ‰¾æœ€åä¸€ä¸ªï¼‰\nfunction extractLastTagContent(tagName: string, text: string, ignoreCase = false): string | null {\n  if (!text || typeof text !== \'string\') return null;\n\n  const endTag = \\`</\\${tagName}>\\`;\n  let searchPool = text;\n  let endTagPattern = endTag;\n\n  if (ignoreCase) {\n    searchPool = text.toLowerCase();\n    endTagPattern = endTag.toLowerCase();\n  }\n\n  const lastEndIndex = searchPool.lastIndexOf(endTagPattern);\n  if (lastEndIndex !== -1) {\n    const startTag = \\`<\\${tagName}>\\`;\n    let startTagPattern = startTag;\n    if (ignoreCase) startTagPattern = startTag.toLowerCase();\n\n    const lastStartIndex = searchPool.lastIndexOf(startTagPattern, lastEndIndex);\n    if (lastStartIndex !== -1) {\n      const startIndex = lastStartIndex + startTag.length;\n      return text.substring(startIndex, lastEndIndex).trim();\n    }\n  }\n  return null;\n}\n\n// ä¸»æ¸…ç†å‡½æ•°\nfunction applyRegexFilters(text: string): string {\n  console.log(\'ğŸ” å¼€å§‹æ¸…ç†ï¼ŒåŸå§‹é•¿åº¦:\', text.length);\n\n  if (!text || typeof text !== \'string\') return \'\';\n\n  // ===== æ­¥éª¤ 0: ä¿®å¤æœªé—­åˆçš„æ ‡ç­¾ï¼ˆå®¹é”™å¤„ç†ï¼‰=====\n  // å“ˆåŸºç±³æµå£æ°´æ—¶ç»å¸¸ä¸é—­åˆæ ‡ç­¾ï¼Œå¯¼è‡´"å‰ç«¯å¤±è¸ª"ã€"ä»£ç æš´éœ²"ç­‰é—®é¢˜\n  // æ£€æµ‹å¸¸è§çš„æœªé—­åˆæ ‡ç­¾å¹¶è‡ªåŠ¨é—­åˆ\n  // âš ï¸ dream å’Œ gametxt æ˜¯æ­£æ–‡æ ‡ç­¾ï¼Œéœ€è¦è¡¥é½ä»¥ä¾¿æå–å†…å®¹\n  const criticalTags = [\'thinking\', \'UpdateVariable\', \'guide\', \'plot\', \'status\', \'dream\', \'gametxt\'];\n  criticalTags.forEach(tag => {\n    const openTagRegex = new RegExp(\\`<\\${tag}([^>]*)>\\`, \'gi\');\n    const closeTagRegex = new RegExp(\\`</\\${tag}>\\`, \'gi\');\n\n    const openMatches = text.match(openTagRegex);\n    const closeMatches = text.match(closeTagRegex);\n\n    const openCount = openMatches ? openMatches.length : 0;\n    const closeCount = closeMatches ? closeMatches.length : 0;\n\n    if (openCount > closeCount) {\n      // æœ‰æœªé—­åˆçš„æ ‡ç­¾ï¼Œè‡ªåŠ¨è¡¥é½é—­åˆæ ‡ç­¾\n      const missing = openCount - closeCount;\n      console.log(\\`âš ï¸ å‘ç° \\${missing} ä¸ªæœªé—­åˆçš„ <\\${tag}> æ ‡ç­¾ï¼Œè‡ªåŠ¨è¡¥é½\\`);\n      text = text + \\`</\\${tag}>\\`.repeat(missing);\n    }\n  });\n\n  // ===== æ­¥éª¤ 1: ä¼˜å…ˆæå–æ­£æ–‡æ ‡ç­¾ï¼ˆæ¢¦æ˜Ÿæ–¹æ¡ˆï¼‰=====\n  // å¦‚æœ AI ç”¨ç‰¹å®šæ ‡ç­¾åŒ…è£¹æ­£æ–‡ï¼Œä¼˜å…ˆæå–è¯¥æ ‡ç­¾çš„å†…å®¹\n  // âš ï¸âš ï¸âš ï¸ dream æ˜¯å¸¸è§çš„æ­£æ–‡æ ‡ç­¾ï¼å¿…é¡»ä¼˜å…ˆæå–ï¼\n  const gameTextTags = [\'dream\', \'gametxt\', \'output\', \'display\', \'text\', \'content\'];\n  for (const tag of gameTextTags) {\n    const extracted = extractLastTagContent(tag, text);\n    if (extracted !== null) {\n      console.log(\\`âœ… æå–äº† <\\${tag}> æ ‡ç­¾çš„å†…å®¹ï¼Œé•¿åº¦:\\`, extracted.length);\n      return extracted; // ç›´æ¥è¿”å›æ­£æ–‡ï¼Œä¸éœ€è¦è¿›ä¸€æ­¥æ¸…ç†\n    }\n  }\n\n  // ===== æ­¥éª¤ 2: å¤‡ç”¨æ–¹æ¡ˆ - ç§»é™¤æ‰€æœ‰æ€ç»´é“¾æ ‡ç­¾ =====\n  let cleanedText = text;\n\n  // å¸¸è§çš„å›ºå®šæ ‡ç­¾ï¼ˆæ³¨æ„ï¼šdream/gametxt æ˜¯æ­£æ–‡æ ‡ç­¾ï¼Œä¸åº”ç§»é™¤ï¼ï¼‰\n  const tagsToRemove = [\n    \'guide\', \'plot\', \'status\',\n    \'UpdateVariable\', \'è§’è‰²æå–\', \'æœ¬ä¸–å†ç¨‹\', \'å¾€ä¸–æ¶Ÿæ¼ª\'\n  ];\n\n  tagsToRemove.forEach(tag => {\n    // ç§»é™¤ <tag>...</tag> ç»“æ„\n    const regexWithContent = new RegExp(\\`<\\${tag}[^>]*>[\\\\\\\\s\\\\\\\\S]*?</\\${tag}>\\`, \'gi\');\n    const before = cleanedText;\n    cleanedText = cleanedText.replace(regexWithContent, \'\');\n\n    // ç§»é™¤è‡ªé—­åˆçš„ <tag/> ç»“æ„\n    const regexSelfClosing = new RegExp(\\`<\\${tag}\\\\\\\\s*\\\\\\\\/>\\`, \'gi\');\n    cleanedText = cleanedText.replace(regexSelfClosing, \'\');\n\n    if (before !== cleanedText) {\n      console.log(\\`  ğŸ§¹ ç§»é™¤äº† <\\${tag}> æ ‡ç­¾\\`);\n    }\n  });\n\n  // âš ï¸âš ï¸âš ï¸ ç‰¹æ®Šå¤„ç†ï¼šç§»é™¤æ‰€æœ‰åŒ…å« think/thinking çš„æ ‡ç­¾ï¼ˆæ€ç»´é“¾ï¼‰\n  // åŒ¹é… <xxx_think>ã€<thinking_xxx>ã€<think>ã€<thinking> ç­‰æ‰€æœ‰å˜ä½“\n  const thinkingRegex = /<[^>]*think[^>]*>[\\\\\\\\s\\\\\\\\S]*?<\\\\/[^>]*think[^>]*>/gi;\n  const beforeThinking = cleanedText;\n  cleanedText = cleanedText.replace(thinkingRegex, \'\');\n  if (beforeThinking !== cleanedText) {\n    console.log(\'  ğŸ§¹ ç§»é™¤äº†åŒ…å« think/thinking çš„æ€ç»´é“¾æ ‡ç­¾\');\n  }\n\n  // ç§»é™¤è‡ªé—­åˆçš„ think æ ‡ç­¾\n  const thinkingSelfClosing = /<[^>]*think[^>]*\\\\\\\\/>/gi;\n  cleanedText = cleanedText.replace(thinkingSelfClosing, \'\');\n\n  // æ¸…ç† HTML æ³¨é‡Š\n  cleanedText = cleanedText.replace(/\x3c!--[\\\\s\\\\S]*?--\x3e/g, \'\');\n\n  if (cleanedText !== text) {\n    console.log(\'âœ… æ ‡ç­¾æ¸…ç†å®Œæˆï¼Œæ¸…ç†åé•¿åº¦:\', cleanedText.length);\n    text = cleanedText;\n  }\n\n  // ===== æ­¥éª¤ 2-3: å°è¯•åº”ç”¨é…’é¦†æ­£åˆ™ï¼ˆå¯é€‰ï¼‰=====\n  let allRegexScripts: any[] = [];\n\n  // æ–¹å¼ 1: å…¨å±€æ­£åˆ™\n  if (typeof getRegexScripts === \'function\') {\n    try {\n      const globalRegexes = getRegexScripts();\n      if (globalRegexes && globalRegexes.length > 0) {\n        console.log(\'ğŸ“‹ ä»å…¨å±€æ­£åˆ™è·å–åˆ°\', globalRegexes.length, \'ä¸ªè„šæœ¬\');\n        allRegexScripts = allRegexScripts.concat(globalRegexes);\n      }\n    } catch (e) {\n      console.warn(\'âš ï¸ è·å–å…¨å±€æ­£åˆ™å¤±è´¥:\', e);\n    }\n  }\n\n  // æ–¹å¼ 2: é¢„è®¾å†…ç½®æ­£åˆ™ï¼ˆæ”¯æŒ SoliUmbra ç­‰è„šæœ¬ï¼‰\n  try {\n    const parentST = (window as any).parent?.SillyTavern || (window as any).SillyTavern;\n    if (parentST && typeof parentST.getContext === \'function\') {\n      const context = parentST.getContext();\n      const prompts = context?.chatCompletionSettings?.prompts;\n\n      if (prompts && Array.isArray(prompts)) {\n        const possibleIdentifiers = [\'regexes-bindings\', \'SPresetSettings\', \'regex-bindings\'];\n\n        for (const identifier of possibleIdentifiers) {\n          const regexPrompt = prompts.find((p: any) => p.identifier === identifier);\n          if (regexPrompt?.content) {\n            try {\n              const data = JSON.parse(regexPrompt.content);\n              let presetRegexes: any = null;\n\n              if (Array.isArray(data)) {\n                presetRegexes = data;\n              } else if (data && typeof data === \'object\') {\n                if (data.RegexBinding?.regexes && Array.isArray(data.RegexBinding.regexes)) {\n                  presetRegexes = data.RegexBinding.regexes;\n                } else if (data.regexes && Array.isArray(data.regexes)) {\n                  presetRegexes = data.regexes;\n                }\n              }\n\n              if (presetRegexes && presetRegexes.length > 0) {\n                console.log(\'ğŸ“‹ ä»é¢„è®¾å†…ç½®æ­£åˆ™è·å–åˆ°\', presetRegexes.length, \'ä¸ªè„šæœ¬ (identifier:\', identifier + \')\');\n                allRegexScripts = allRegexScripts.concat(presetRegexes);\n                break;\n              }\n            } catch (parseError) {\n              console.warn(\'âš ï¸ è§£æ identifier\', identifier, \'å¤±è´¥:\', parseError);\n            }\n          }\n        }\n      }\n    }\n  } catch (e) {\n    console.warn(\'âš ï¸ è·å–é¢„è®¾å†…ç½®æ­£åˆ™å¤±è´¥:\', e);\n  }\n\n  if (allRegexScripts.length > 0) {\n    console.log(\'ğŸ“‹ æ€»å…±è·å–åˆ°\', allRegexScripts.length, \'ä¸ªæ­£åˆ™è„šæœ¬\');\n\n    // è¿‡æ»¤å‡ºé€‚ç”¨äº AI è¾“å‡ºåå¤„ç†çš„æ­£åˆ™ï¼ˆplacement åŒ…å« 2ï¼‰\n    // âš ï¸ åªæ£€æŸ¥ disabled å’Œ placementï¼Œä¸æ£€æŸ¥ promptOnly\n    // å› ä¸ºæœ‰äº›é¢„è®¾æ­£åˆ™å¯èƒ½æ²¡æœ‰ promptOnly å­—æ®µï¼Œæˆ–è€…è®¾ç½®ä¸è§„èŒƒ\n    const activeScripts = allRegexScripts.filter((script: any) => {\n      if (script.disabled) return false;\n      if (!script.placement || !Array.isArray(script.placement)) return false;\n      if (!script.placement.includes(2)) return false;\n      return true;\n    });\n\n    console.log(\'âœ… æ‰¾åˆ°\', activeScripts.length, \'ä¸ªé€‚ç”¨çš„æ­£åˆ™è„šæœ¬\');\n\n    let result = text;\n    activeScripts.forEach((script: any, index: number) => {\n      try {\n        const regex = new RegExp(script.findRegex, \'gim\');\n        const beforeLength = result.length;\n        result = result.replace(regex, script.replaceString || \'\');\n\n        if (beforeLength !== result.length) {\n          console.log(\'ğŸ§¹ æ­£åˆ™\', index + 1, \'(\', script.scriptName, \') ç”Ÿæ•ˆ\');\n        }\n      } catch (e) {\n        console.error(\'âŒ æ­£åˆ™\', index + 1, \'åº”ç”¨å¤±è´¥:\', e);\n      }\n    });\n\n    text = result;\n  }\n\n  console.log(\'ğŸ“Š æœ€ç»ˆé•¿åº¦:\', text.length);\n  return text;\n}\n\\`\\`\\`\n\n**ä½¿ç”¨æ–¹å¼ï¼ˆå®Œæ•´ç¤ºä¾‹ï¼‰ï¼š**\n\\`\\`\\`typescript\n// å…¨å±€å˜é‡\nlet chatHistory: Array<{ role: string; content: string }> = [];\nlet isGenerating = false;\n\n// å‘é€æ¶ˆæ¯\nasync function handleSend() {\n  const input = $(\'#user-input\');\n  const userInput = input.val().trim();\n  if (!userInput || isGenerating) return;\n\n  // 1. æ·»åŠ ç”¨æˆ·æ¶ˆæ¯åˆ°å†å²\n  chatHistory.push({ role: \'user\', content: userInput });\n  input.val(\'\');\n  renderMessages();\n\n  // 2. è®¾ç½®ç”ŸæˆçŠ¶æ€\n  isGenerating = true;\n  $(\'#send-btn\').prop(\'disabled\', true).text(\'ç”Ÿæˆä¸­...\');\n\n  try {\n    // 3. æ„å»ºå¯¹è¯å†å²æç¤ºè¯\n    let prompt = \'\';\n    chatHistory.slice(-10).forEach(msg => {\n      prompt += (msg.role === \'user\' ? \'ç©å®¶\' : \'AI\') + \': \' + msg.content + \'\\\\n\';\n    });\n\n    // 4. è°ƒç”¨ AIï¼ˆä¸éœ€è¦æµå¼ï¼ï¼‰\n    const rawResult = await triggerSlashWithResult(\'/gen lock=on "\' + prompt.replace(/"/g, \'\\\\\\\\"\') + \'"\');\n\n    // 5. â­ å…³é”®ï¼šå¿…é¡»å…ˆæ¸…ç†æ ‡ç­¾å†æ˜¾ç¤º\n    const cleanedResult = applyRegexFilters(rawResult);\n\n    // 6. æ·»åŠ åˆ°èŠå¤©å†å²å¹¶æ¸²æŸ“\n    chatHistory.push({ role: \'assistant\', content: cleanedResult });\n    renderMessages();\n    saveChatHistory(); // ä¿å­˜åˆ°é…’é¦†å˜é‡\n\n  } catch (error) {\n    console.error(\'ç”Ÿæˆå¤±è´¥:\', error);\n    toastr.error(\'ç”Ÿæˆå¤±è´¥: \' + (error?.message || String(error)));\n  } finally {\n    isGenerating = false;\n    $(\'#send-btn\').prop(\'disabled\', false).text(\'å‘é€\');\n  }\n}\n\n// æ¸²æŸ“æ¶ˆæ¯\nfunction renderMessages() {\n  const container = $(\'#messages\');\n  container.empty();\n\n  chatHistory.forEach(msg => {\n    const div = $(\'<div>\')\n      .addClass(\'message\')\n      .addClass(msg.role === \'user\' ? \'user-message\' : \'ai-message\')\n      .text(msg.content); // ä½¿ç”¨ text() é˜²æ­¢ XSS\n    container.append(div);\n  });\n\n  container.scrollTop(container[0].scrollHeight);\n}\n\n// ä¿å­˜èŠå¤©å†å²\nfunction saveChatHistory() {\n  if (typeof insertOrAssignVariables === \'function\') {\n    insertOrAssignVariables({ chat_history: chatHistory }, { type: \'chat\' });\n  } else {\n    localStorage.setItem(\'chat_history\', JSON.stringify(chatHistory));\n  }\n}\n\\`\\`\\`\n\n**âš ï¸ é‡è¦è¯´æ˜ï¼šæµå¼ä¼ è¾“çš„æ­£ç¡®å®ç°æ–¹å¼ï¼**\n\n**ğŸš¨ åŒå±‚å¯¹è¯å¿…é¡»ä½¿ç”¨çœŸæµå¼ä¼ è¾“ï¼ğŸš¨**\n\n### â­ çœŸæµå¼æ¨¡å¼ï¼ˆå”¯ä¸€æ­£ç¡®çš„å®ç°æ–¹å¼ï¼‰\n- ä½¿ç”¨ \\`generate({ should_stream: true, generation_id })\\` å¯ç”¨æµå¼\n- ç›‘å¬ \\`iframe_events.STREAM_TOKEN_RECEIVED_INCREMENTALLY\\` å®æ—¶æ¥æ”¶æ–‡æœ¬\n- è¾¹æ¥æ”¶è¾¹æ¸…ç†æ ‡ç­¾è¾¹æ˜¾ç¤º\n- âœ… å®æ—¶æ˜¾ç¤º AI ç”Ÿæˆï¼Œæ— éœ€ç­‰å¾…ï¼Œä½“éªŒæœ€ä½³\n- âœ… ç”¨æˆ·å¯ä»¥ç«‹å³çœ‹åˆ° AI çš„å›å¤ï¼Œä½“éªŒæµç•…\n\n### âŒ ç¦æ­¢ä½¿ç”¨ä»¥ä¸‹æ–¹æ¡ˆï¼š\n- âŒ \\`triggerSlashWithResult\\`ï¼ˆéœ€è¦ç­‰å¾…å…¨éƒ¨ç”Ÿæˆï¼Œä½“éªŒå·®ï¼‰\n- âŒ æ‰“å­—æœºæ•ˆæœï¼ˆå‡æµå¼ï¼Œä»éœ€ç­‰å¾…ï¼Œä¸æ˜¯çœŸæ­£çš„æµå¼ï¼‰\n- âŒ \\`generateRaw\\`ï¼ˆä¸ä½¿ç”¨è§’è‰²å¡å’Œé¢„è®¾ï¼‰\n\n**ğŸ¯ çœŸæµå¼æ¨¡å¼çš„æ­£ç¡®å®ç°ï¼ˆå¼ºçƒˆæ¨èï¼‰ï¼š**\n\n\\`\\`\\`typescript\n// ===== å…¨å±€å˜é‡ =====\nlet chatHistory: Array<{ role: string; content: string }> = [];\nlet isGenerating = false;\nlet currentGenerationId: string | null = null;\n\n// ===== çœŸæµå¼ç›‘å¬ï¼ˆæ ¸å¿ƒï¼ï¼‰=====\nfunction setupStreamListeners() {\n  // âš ï¸ ç›‘å¬å¢é‡æ–‡æœ¬ï¼ˆæ¯æ¬¡æ¥æ”¶ä¸€å°æ®µï¼‰\n  eventOn(iframe_events.STREAM_TOKEN_RECEIVED_INCREMENTALLY, (text: string, id: string) => {\n    if (!isGenerating || id !== currentGenerationId) return;\n\n    // âš ï¸âš ï¸âš ï¸ æ ¸å¿ƒï¼å¿…é¡»å®æ—¶æ¸…ç†æ ‡ç­¾ï¼\n    const cleanedText = applyRegexFilters(text);\n\n    // æ›´æ–° DOMï¼ˆæ‰¾åˆ°æœ€åä¸€æ¡æ¶ˆæ¯å¹¶æ›´æ–°ï¼‰\n    const container = $(\'#inner-messages\');  // æ ¹æ®å®é™…å®¹å™¨ ID ä¿®æ”¹\n    const charName = SillyTavern?.name2 || \'AI\';\n    const lastMsg = container.find(\'.message:last-child\');\n\n    if (lastMsg.length && !lastMsg.hasClass(\'user-message\')) {\n      // æ›´æ–°å·²æœ‰çš„ AI æ¶ˆæ¯\n      lastMsg.html(\'<strong>\' + charName + \':</strong> \' + cleanedText);\n    } else {\n      // åˆ›å»ºæ–°çš„ AI æ¶ˆæ¯\n      const msgDiv = $(\'<div>\')\n        .addClass(\'message ai-message\')\n        .html(\'<strong>\' + charName + \':</strong> \' + cleanedText);\n      container.append(msgDiv);\n    }\n\n    // è‡ªåŠ¨æ»šåŠ¨åˆ°åº•éƒ¨\n    container.scrollTop(container[0].scrollHeight);\n  });\n\n  // âš ï¸ ç›‘å¬ç”Ÿæˆå®Œæˆ\n  eventOn(iframe_events.GENERATION_ENDED, (text: string, id: string) => {\n    if (id === currentGenerationId) {\n      console.log(\'âœ… æµå¼ç”Ÿæˆå®Œæˆ\');\n\n      // âš ï¸âš ï¸âš ï¸ æ ¸å¿ƒï¼æœ€åæ¸…ç†ä¸€æ¬¡å†ä¿å­˜åˆ°å†å²ï¼\n      const cleanedText = applyRegexFilters(text);\n\n      // ä¿å­˜åˆ°èŠå¤©å†å²\n      chatHistory.push({ role: \'assistant\', content: cleanedText });\n      saveChatHistory();\n\n      // é‡æ–°æ¸²æŸ“ï¼ˆç¡®ä¿æ˜¾ç¤ºçš„æ˜¯æ¸…ç†åçš„å†…å®¹ï¼‰\n      renderMessages();\n\n      // é‡ç½®çŠ¶æ€\n      isGenerating = false;\n      currentGenerationId = null;\n      $(\'#inner-send-btn\').prop(\'disabled\', false).text(\'å‘é€\');  // æ ¹æ®å®é™…æŒ‰é’® ID ä¿®æ”¹\n    }\n  });\n}\n\n// ===== å‘é€æ¶ˆæ¯ï¼ˆçœŸæµå¼ç‰ˆæœ¬ï¼‰=====\nasync function handleSend() {\n  const input = $(\'#inner-input\');  // æ ¹æ®å®é™…è¾“å…¥æ¡† ID ä¿®æ”¹\n  const userInput = input.val().trim();\n  if (!userInput || isGenerating) return;\n\n  // 1. æ·»åŠ ç”¨æˆ·æ¶ˆæ¯\n  chatHistory.push({ role: \'user\', content: userInput });\n  input.val(\'\');\n  saveChatHistory();\n  renderMessages();\n\n  // 2. ç”Ÿæˆå”¯ä¸€ ID\n  currentGenerationId = \'chat-\' + Date.now() + \'-\' + Math.random().toString(36).slice(2);\n\n  // 3. è®¾ç½®ç”ŸæˆçŠ¶æ€\n  isGenerating = true;\n  $(\'#inner-send-btn\').prop(\'disabled\', true).text(\'ç”Ÿæˆä¸­...\');  // æ ¹æ®å®é™…æŒ‰é’® ID ä¿®æ”¹\n\n  try {\n    // 4. âš ï¸âš ï¸âš ï¸ æ ¸å¿ƒï¼šè°ƒç”¨ generate å¹¶å¯ç”¨æµå¼\n    await generate({\n      user_input: userInput,\n      should_stream: true,           // âš ï¸ å¿…é¡»å¯ç”¨æµå¼\n      generation_id: currentGenerationId,  // âš ï¸ å¿…é¡»ä¼ å…¥ ID ç”¨äºäº‹ä»¶è¿‡æ»¤\n      overrides: {\n        chat_history: {\n          prompts: chatHistory.map(msg => ({\n            role: msg.role === \'user\' ? \'user\' : \'assistant\',\n            content: msg.content\n          }))\n        }\n      }\n    });\n\n    // æ³¨æ„ï¼šç”±äºæ˜¯æµå¼ï¼Œå®é™…çš„æ–‡æœ¬æ›´æ–°æ˜¯é€šè¿‡äº‹ä»¶ç›‘å¬å™¨å®æ—¶æ›´æ–°çš„\n    // GENERATION_ENDED äº‹ä»¶ä¼šè‡ªåŠ¨ä¿å­˜ AI å›å¤åˆ°å†å²\n\n  } catch (error) {\n    console.error(\'âŒ ç”Ÿæˆå¤±è´¥:\', error);\n    toastr.error(\'ç”Ÿæˆå¤±è´¥: \' + error.message);\n\n    // é‡ç½®çŠ¶æ€\n    isGenerating = false;\n    currentGenerationId = null;\n    $(\'#inner-send-btn\').prop(\'disabled\', false).text(\'å‘é€\');\n  }\n}\n\n// ===== æ¸²æŸ“æ¶ˆæ¯ =====\nfunction renderMessages() {\n  const container = $(\'#messages\');\n  container.empty();\n\n  chatHistory.forEach((msg, index) => {\n    const div = $(\'<div>\')\n      .attr(\'id\', \\\\\\`message-\\\\\\${index}\\\\\\`)  // âš ï¸ å¿…é¡»æœ‰ id\n      .addClass(\'message\')\n      .addClass(msg.role === \'user\' ? \'user-message\' : \'ai-message\')\n      .text(msg.content);\n    container.append(div);\n  });\n\n  container.scrollTop(container[0].scrollHeight);\n}\n\n// ===== åˆå§‹åŒ– =====\n$(() => {\n  loadChatHistory();\n  setupStreamListeners();  // âš ï¸ å¿…é¡»åœ¨åŠ è½½æ—¶å°±è®¾ç½®ç›‘å¬\n\n  $(\'#send-btn\').on(\'click\', handleSend);\n  $(\'#user-input\').on(\'keypress\', (e) => {\n    if (e.key === \'Enter\' && !e.shiftKey) {\n      e.preventDefault();\n      handleSend();\n    }\n  });\n});\n\\\\\\`\\\\\\`\\\\\\`\n\n**ğŸ¨ CSS æ ·å¼ï¼ˆå¯é€‰ï¼Œæ·»åŠ å…‰æ ‡æ•ˆæœï¼‰ï¼š**\n\\\\\\`\\\\\\`\\\\\\`css\n.streaming {\n  border-right: 2px solid #165DFF;\n  animation: blink 1s infinite;\n}\n\n@keyframes blink {\n  0%, 50% { border-right-color: transparent; }\n  51%, 100% { border-right-color: #165DFF; }\n}\n\\\\\\`\\\\\\`\\\\\\`\n\n**ğŸ’¡ æ¨¡å¼é€‰æ‹©å»ºè®®ï¼ˆé‡è¦ï¼ï¼‰ï¼š**\n- **åŒå±‚å¯¹è¯ï¼ˆå‰ç«¯ç•Œé¢ï¼‰**ï¼šå¿…é¡»ä½¿ç”¨çœŸæµå¼æ¨¡å¼ï¼ˆæ¨¡å¼ 3ï¼‰â­â­â­\n- **è„šæœ¬åå°ä»»åŠ¡**ï¼šå¯ä»¥ä½¿ç”¨ triggerSlashWithResultï¼ˆä¸éœ€è¦æµå¼ï¼‰\n- **åŸå› **ï¼šåŒå±‚å¯¹è¯éœ€è¦å®æ—¶æ˜¾ç¤º AI ç”Ÿæˆï¼Œç»™ç”¨æˆ·æœ€ä½³ä½“éªŒ\n- **ä¸è¦ç”¨å‡æµå¼ï¼** å‡æµå¼éœ€è¦ç­‰å¾…å®Œæ•´ç”Ÿæˆï¼Œä½“éªŒå·®\n\n**ğŸ”‘ çœŸæµå¼çš„å…³é”®è¦ç‚¹ï¼š**\n1. âœ… å¿…é¡»è°ƒç”¨ \\`generate({ should_stream: true, generation_id: uniqueId })\\`\n2. âœ… å¿…é¡»åœ¨åŠ è½½æ—¶å°±è®¾ç½®ç›‘å¬ï¼š\\`setupStreamListeners()\\`\n3. âœ… ç›‘å¬äº‹ä»¶ï¼š\\`eventOn(iframe_events.STREAM_TOKEN_RECEIVED_INCREMENTALLY, (text, id) => ...)\\`\n4. âœ… è¿‡æ»¤ IDï¼šç¡®ä¿åªå¤„ç†è‡ªå·±çš„ \\`generation_id\\`\n5. âœ… ä½¿ç”¨ \\`overrides.chat_history.prompts\\` ä¼ é€’èŠå¤©å†å²\n\n**ğŸš¨ğŸš¨ğŸš¨ æœ€å…³é”®ï¼å¿…é¡»åœ¨è¿™äº›åœ°æ–¹è°ƒç”¨ \\`applyRegexFilters\\`ï¼š**\n1. âš ï¸ **STREAM_TOKEN_RECEIVED_INCREMENTALLY äº‹ä»¶ä¸­**ï¼š\n   \\`\\`\\`typescript\n   const cleanedText = applyRegexFilters(text);  // æ¸…ç†åå†æ˜¾ç¤ºï¼\n   lastMsg.html(\'<strong>\' + charName + \':</strong> \' + cleanedText);\n   \\`\\`\\`\n\n2. âš ï¸ **GENERATION_ENDED äº‹ä»¶ä¸­**ï¼š\n   \\`\\`\\`typescript\n   const cleanedText = applyRegexFilters(text);  // æ¸…ç†åå†ä¿å­˜ï¼\n   chatHistory.push({ role: \'assistant\', content: cleanedText });\n   \\`\\`\\`\n\n**ğŸ’¡ \\`applyRegexFilters\\` çš„å®¹é”™æœºåˆ¶ï¼ˆå››å±‚ä¿æŠ¤ï¼‰ï¼š**\n1. âœ… **è‡ªåŠ¨è¡¥é½æœªé—­åˆçš„æ ‡ç­¾**ï¼ˆé˜²æ­¢"å‰ç«¯å¤±è¸ª"ã€"ä»£ç æš´éœ²"ï¼‰\n2. âœ… **ä¼˜å…ˆæå–æ­£æ–‡æ ‡ç­¾**ï¼ˆå¦‚ \\`<dream>\\`ã€\\`<gametxt>\\`ï¼‰â­â­â­ æœ€é‡è¦ï¼\n3. âœ… **ç§»é™¤æ€ç»´é“¾æ ‡ç­¾**ï¼ˆé€šé…ç¬¦åŒ¹é…æ‰€æœ‰åŒ…å« \\`think\\` çš„æ ‡ç­¾ï¼‰\n4. âœ… **åº”ç”¨é¢„è®¾æ­£åˆ™**ï¼ˆæ”¯æŒå…¨å±€æ­£åˆ™å’Œé¢„è®¾å†…ç½®æ­£åˆ™ï¼‰\n\n**ğŸš¨ğŸš¨ğŸš¨ æ­£æ–‡æ ‡ç­¾æå–ï¼ˆæ ¸å¿ƒåŸç†ï¼‰ï¼š**\n- **ä¸åŒé¢„è®¾ä½¿ç”¨ä¸åŒçš„æ­£æ–‡æ ‡ç­¾**ï¼š\\`<dream>\\`ã€\\`<gametxt>\\`ã€\\`<output>\\` ç­‰\n- **ä¼˜å…ˆæå–é¡ºåº**ï¼š\\`[\'dream\', \'gametxt\', \'output\', \'display\', \'text\', \'content\']\\`\n- **æå–é€»è¾‘**ï¼šæ‰¾åˆ°ç¬¬ä¸€ä¸ªåŒ¹é…çš„æ ‡ç­¾ï¼Œæå–å…¶å†…å®¹å¹¶ç›´æ¥è¿”å›\n- **ç¤ºä¾‹**ï¼š\n  \\`\\`\\`\n  åŸå§‹ï¼š<guide>æ€ç»´</guide><dream>æ­£æ–‡å†…å®¹</dream><plot>å…ƒæ•°æ®</plot>\n  æå–ï¼šæ­£æ–‡å†…å®¹  â† åªä¿ç•™ <dream> é‡Œçš„å†…å®¹ï¼\n  \\`\\`\\`\n\n**ğŸ¯ æ€ç»´é“¾æ ‡ç­¾å¤„ç†ï¼ˆé‡ç‚¹ï¼ï¼‰ï¼š**\n- æ€ç»´é“¾æ ‡ç­¾åé€šå¸¸åŒ…å« \\`think\\` æˆ– \\`thinking\\`\n- ä½¿ç”¨é€šé…ç¬¦æ­£åˆ™ï¼š\\`/<[^>]*think[^>]*>[\\\\s\\\\S]*?<\\\\/[^>]*think[^>]*>/gi\\`\n- è‡ªåŠ¨åŒ¹é…æ‰€æœ‰å˜ä½“ï¼š\\`<think>\\`ã€\\`<thinking>\\`ã€\\`<xxx_think>\\`ã€\\`<thinking_xxx>\\` ç­‰\n- å³ä½¿æ ‡ç­¾åå˜åŒ–ï¼Œä¹Ÿèƒ½æ­£ç¡®æ¸…ç†\n\n**å¸¸è§é—®é¢˜åŠè§£å†³æ–¹æ¡ˆï¼š**\n- âŒ æ€è€ƒå†…å®¹æš´éœ² â†’ \\`<thinking>\\` æœªé—­åˆ â†’ è‡ªåŠ¨è¡¥é½ + æ¸…ç†\n- âŒ å‰ç«¯å¤±è¸ª â†’ \\`<UpdateVariable>\\` æœªé—­åˆ â†’ è‡ªåŠ¨è¡¥é½ + æ¸…ç†\n- âŒ ä»£ç æš´éœ² â†’ å¤šä½™çš„ \\`<UpdateVariable>\\` â†’ æ¸…ç†æ‰€æœ‰ \\`<UpdateVariable>\\` æ ‡ç­¾\n\n**âŒ è‡´å‘½é”™è¯¯ï¼ˆç»å¯¹ä¸èƒ½çŠ¯ï¼‰ï¼š**\n- âŒ ç›´æ¥æ˜¾ç¤º/ä¿å­˜åŸå§‹ textï¼Œæ²¡æœ‰è°ƒç”¨ \\`applyRegexFilters\\`\n- âŒ åªåœ¨æ˜¾ç¤ºæ—¶æ¸…ç†ï¼Œä½†ä¿å­˜æ—¶ç”¨åŸå§‹ text\n- âŒ åªåœ¨ä¿å­˜æ—¶æ¸…ç†ï¼Œä½†æ˜¾ç¤ºæ—¶ç”¨åŸå§‹ text\n- âŒ ä¸è®¾ç½® \\`should_stream: true\\`\n- âŒ ä¸è®¾ç½® \\`generation_id\\`ï¼ˆä¼šæ”¶åˆ°æ‰€æœ‰äº‹ä»¶ï¼‰\n- âŒ ä¸è¿‡æ»¤ IDï¼ˆä¼šå¤„ç†å…¶ä»–åŒå±‚å¯¹è¯çš„äº‹ä»¶ï¼‰\n- âŒ ä¸åœ¨åŠ è½½æ—¶è®¾ç½®ç›‘å¬ï¼ˆä¼šä¸¢å¤±äº‹ä»¶ï¼‰\n\n**âš ï¸âš ï¸âš ï¸ ä½œç”¨åŸŸé—®é¢˜ï¼ˆæœ€å¸¸è§é”™è¯¯ï¼ï¼‰ï¼š**\nå˜é‡å’Œå‡½æ•°**å¿…é¡»åœ¨å…¨å±€ä½œç”¨åŸŸ**å®šä¹‰ï¼Œä¸èƒ½åœ¨ \\`$(function() {})\\` å†…éƒ¨ï¼\n\n\\`\\`\\`javascript\n// âŒ é”™è¯¯ç¤ºä¾‹ï¼šå˜é‡åœ¨å±€éƒ¨ä½œç”¨åŸŸ\n$(function() {\n  let chatHistory = [];  // âŒ å¤–éƒ¨è®¿é—®ä¸åˆ°ï¼\n  function renderMessages() {}  // âŒ å¤–éƒ¨è®¿é—®ä¸åˆ°ï¼\n});\n\n// âœ… æ­£ç¡®ç¤ºä¾‹ï¼šå˜é‡åœ¨å…¨å±€ä½œç”¨åŸŸ\nlet chatHistory = [];  // âœ… å…¨å±€å¯è®¿é—®\nfunction renderMessages() {}  // âœ… å…¨å±€å¯è®¿é—®\n\n$(function() {\n  // åœ¨è¿™é‡Œè°ƒç”¨ä¸Šé¢å®šä¹‰çš„å‡½æ•°\n  loadChatHistory();\n});\n\\`\\`\\`\n\n**ğŸ“‹ ä»£ç ç»“æ„å¤§çº²ï¼ˆå¿…é¡»ä¸¥æ ¼æŒ‰æ­¤é¡ºåºï¼ï¼‰ï¼š**\n\n\\`\\`\\`javascript\n// index.ts æ–‡ä»¶ç»“æ„ï¼š\n//\n// 1ï¸âƒ£ å…¨å±€å˜é‡å®šä¹‰åŒºï¼ˆç¬¬ 1-10 è¡Œå·¦å³ï¼‰\n//    let chatHistory = [];\n//    let isGenerating = false;\n//    ...\n//\n// 2ï¸âƒ£ å…¨å±€å‡½æ•°å®šä¹‰åŒºï¼ˆç¬¬ 10-250 è¡Œå·¦å³ï¼‰\n//    function loadChatHistory() { ... }\n//    function saveChatHistory() { ... }\n//    function renderMessages() { ... }\n//    function applyRegexFilters(text) { ... }  // âš ï¸ å¿…é¡»ï¼ç”¨äºè¿‡æ»¤æ€ç»´é“¾\n//    function handleSend() { ... }\n//\n// 3ï¸âƒ£ jQuery åˆå§‹åŒ–åŒºï¼ˆç¬¬ 250-270 è¡Œå·¦å³ï¼‰\n//    $(function() {\n//      // åªè°ƒç”¨å‡½æ•°ï¼Œä¸å®šä¹‰ï¼\n//      loadChatHistory();\n//      $(\'#btn\').on(\'click\', handleSend);\n//    });\n//\n// 4ï¸âƒ£ å¸è½½äº‹ä»¶ï¼ˆç¬¬ 270-275 è¡Œå·¦å³ï¼‰\n//    $(window).on(\'pagehide\', () => { ... });\n\\`\\`\\`\n\n**å®Œæ•´å®ç°ç¤ºä¾‹ï¼ˆå¿…é¡» 100% æŒ‰æ­¤ç»“æ„ï¼ï¼‰ï¼š**\n\n\\`\\`\\`javascript\n// =====================================================\n// âš ï¸âš ï¸âš ï¸ ä»¥ä¸‹æ‰€æœ‰ä»£ç éƒ½åœ¨å…¨å±€ä½œç”¨åŸŸï¼Œä¸è¦æ”¾åœ¨ $(function() {}) å†…ï¼\n// =====================================================\n\n// ===== 1. çŠ¶æ€ç®¡ç†ï¼ˆå¿…é¡»åœ¨å…¨å±€ä½œç”¨åŸŸï¼ï¼‰=====\nlet chatHistory = []; // { role: \'user\'|\'assistant\', content: string }\nlet isGenerating = false;\n\n// ===== 2. æ•°æ®æŒä¹…åŒ–ï¼ˆä½¿ç”¨èŠå¤©å˜é‡ï¼‰ =====\nfunction loadChatHistory() {\n  const isInTavern = typeof getVariables === \'function\';\n  if (!isInTavern) {\n    // é¢„è§ˆæ¨¡å¼\n    const saved = localStorage.getItem(\'inner_chat_history\');\n    chatHistory = saved ? JSON.parse(saved) : [];\n  } else {\n    // é…’é¦†æ¨¡å¼ï¼šä»èŠå¤©å˜é‡è¯»å–\n    const data = getVariables({ type: \'chat\' });\n    chatHistory = data?.inner_chat_history || [];\n  }\n  renderMessages();\n}\n\nfunction saveChatHistory() {\n  const isInTavern = typeof insertOrAssignVariables === \'function\';\n  if (!isInTavern) {\n    localStorage.setItem(\'inner_chat_history\', JSON.stringify(chatHistory));\n  } else {\n    insertOrAssignVariables({ inner_chat_history: chatHistory }, { type: \'chat\' });\n  }\n}\n\n// ===== 3. ç•Œé¢æ¸²æŸ“ =====\nfunction renderMessages() {\n  console.log(\'ğŸ¨ renderMessages å¼€å§‹ï¼ŒèŠå¤©å†å²:\', chatHistory.length, \'æ¡\');\n\n  const container = $(\'#inner-messages\');\n  console.log(\'ğŸ“¦ æ¶ˆæ¯å®¹å™¨:\', container.length > 0 ? \'âœ… å­˜åœ¨\' : \'âŒ ä¸å­˜åœ¨\');\n\n  container.empty();\n\n  chatHistory.forEach((msg, index) => {\n    // è·å–æ˜¾ç¤ºåç§°\n    const name = msg.role === \'user\'\n      ? (typeof getCurrentUser === \'function\' ? getCurrentUser()?.name : null) || \'{{user}}\'\n      : (typeof getCurrentCharacter === \'function\' ? getCurrentCharacter()?.name : null) || \'{{char}}\';\n\n    console.log(\'ğŸ’¬ æ¸²æŸ“æ¶ˆæ¯\', index + 1, \':\', msg.role, \'-\', name, \'- é•¿åº¦:\', msg.content.length);\n\n    const msgDiv = $(\'<div>\')\n      .addClass(\'message\')\n      .addClass(msg.role === \'user\' ? \'user-message\' : \'ai-message\')\n      .html(\'<strong>\' + name + \':</strong> \' + msg.content);\n    container.append(msgDiv);\n  });\n\n  console.log(\'âœ… renderMessages å®Œæˆï¼Œå®¹å™¨å†…æ¶ˆæ¯æ•°:\', container.find(\'.message\').length);\n\n  // æ»šåŠ¨åˆ°åº•éƒ¨\n  container.scrollTop(container[0].scrollHeight);\n}\n\n// ===== 4. æ­£åˆ™è¿‡æ»¤ï¼ˆéšè—æ€ç»´é“¾ç­‰ï¼‰ =====\n/**\n * åº”ç”¨æ­£åˆ™è„šæœ¬æ¥æ¸…ç† AI å›å¤\n * æ”¯æŒä¸‰ç§æ¸…ç†æ–¹å¼ï¼š\n * 1. é…’é¦†åŸç”Ÿå…¨å±€æ­£åˆ™ï¼ˆé€šè¿‡ getRegexScriptsï¼‰\n * 2. é¢„è®¾å†…ç½®æ­£åˆ™ï¼ˆé€šè¿‡ SoliUmbra çš„é¢„è®¾ç»‘å®šè„šæœ¬ï¼‰\n * 3. å†…ç½®çš„ç®€å•æ ‡ç­¾æ¸…ç†ï¼ˆä½œä¸ºå¤‡ç”¨æ–¹æ¡ˆï¼‰\n */\nfunction applyRegexFilters(text) {\n  console.log(\'ğŸ” å¼€å§‹åº”ç”¨æ­£åˆ™è¿‡æ»¤ï¼ŒåŸå§‹æ–‡æœ¬é•¿åº¦:\', text.length);\n\n  // ===== æ­¥éª¤ 0: å†…ç½®çš„ç®€å•æ ‡ç­¾æ¸…ç†ï¼ˆå¤‡ç”¨æ–¹æ¡ˆï¼‰=====\n  // æ¸…ç†å¸¸è§çš„æ€ç»´é“¾æ ‡ç­¾ï¼š<guide>ã€<dream>ã€<plot>ã€<status>ã€<think> ç­‰\n  let cleanedText = text;\n  const commonTags = [\n    \'guide\', \'dream\', \'plot\', \'status\', \'think\', \'thinking\',\n    \'thought\', \'reasoning\', \'analysis\', \'plan\', \'reflection\',\n    \'meta\', \'ooc\', \'system\', \'debug\'\n  ];\n\n  commonTags.forEach(tag => {\n    // åŒ¹é… <tag>...</tag> æ ¼å¼ï¼ˆåŒ…æ‹¬æ¢è¡Œï¼‰\n    const regex = new RegExp(\\`<\\${tag}[^>]*>[\\\\\\\\s\\\\\\\\S]*?</\\${tag}>\\`, \'gi\');\n    const before = cleanedText;\n    cleanedText = cleanedText.replace(regex, \'\');\n    if (before !== cleanedText) {\n      console.log(\\`  ğŸ§¹ å†…ç½®æ¸…ç†: ç§»é™¤äº† <\\${tag}> æ ‡ç­¾\\`);\n    }\n  });\n\n  // æ¸…ç† HTML æ³¨é‡Šä¸­çš„è°ƒè¯•ä¿¡æ¯\n  cleanedText = cleanedText.replace(/\x3c!--[\\\\s\\\\S]*?--\x3e/g, \'\');\n\n  // å¦‚æœå†…ç½®æ¸…ç†ç”Ÿæ•ˆäº†ï¼Œå…ˆæ˜¾ç¤ºç»“æœ\n  if (cleanedText !== text) {\n    console.log(\'âœ… å†…ç½®æ ‡ç­¾æ¸…ç†å®Œæˆï¼Œæ¸…ç†åé•¿åº¦:\', cleanedText.length);\n    text = cleanedText;\n  }\n\n  // ===== æ­¥éª¤ 1-2: å°è¯•ä½¿ç”¨é…’é¦†çš„æ­£åˆ™è„šæœ¬ =====\n  let allRegexScripts = [];\n\n  // æ–¹å¼ 1: å°è¯•ä»é…’é¦†åŸç”Ÿå…¨å±€æ­£åˆ™è·å–\n  if (typeof getRegexScripts === \'function\') {\n    try {\n      const globalRegex = getRegexScripts();\n      console.log(\'ğŸ“‹ ä»å…¨å±€æ­£åˆ™è·å–åˆ°\', globalRegex.length, \'ä¸ªè„šæœ¬\');\n      allRegexScripts = allRegexScripts.concat(globalRegex);\n    } catch (e) {\n      console.warn(\'âš ï¸ è·å–å…¨å±€æ­£åˆ™å¤±è´¥:\', e);\n    }\n  }\n\n  // æ–¹å¼ 2: å°è¯•ä»é¢„è®¾å†…ç½®æ­£åˆ™è·å–ï¼ˆSoliUmbra çš„æ–¹æ¡ˆï¼‰\n  // âš ï¸ åŒå±‚å¯¹è¯åœ¨ iframe ä¸­ï¼Œéœ€è¦é€šè¿‡ window.parent.SillyTavern.getContext() è®¿é—®\n  try {\n    const parentST = window.parent?.SillyTavern || window.SillyTavern;\n    if (parentST && typeof parentST.getContext === \'function\') {\n      const context = parentST.getContext();\n      const prompts = context?.chatCompletionSettings?.prompts;\n\n      if (prompts && Array.isArray(prompts)) {\n        // å°è¯•å¤šä¸ªå¯èƒ½çš„ identifierï¼ˆä¸åŒé¢„è®¾ä½¿ç”¨ä¸åŒçš„å‘½åï¼‰\n        const possibleIdentifiers = [\'regexes-bindings\', \'SPresetSettings\', \'regex-bindings\'];\n\n        for (const identifier of possibleIdentifiers) {\n          const regexPrompt = prompts.find(p => p.identifier === identifier);\n          if (regexPrompt?.content) {\n            try {\n              const data = JSON.parse(regexPrompt.content);\n              let presetRegexes = null;\n\n              // å¤„ç†ä¸åŒçš„æ•°æ®æ ¼å¼\n              if (Array.isArray(data)) {\n                // ç›´æ¥æ˜¯æ•°ç»„ï¼ˆå¦‚ regexes-bindingsï¼‰\n                presetRegexes = data;\n              } else if (data && typeof data === \'object\') {\n                // åµŒå¥—å¯¹è±¡ï¼ˆå¦‚ SPresetSettings.RegexBinding.regexesï¼‰\n                if (data.RegexBinding?.regexes && Array.isArray(data.RegexBinding.regexes)) {\n                  presetRegexes = data.RegexBinding.regexes;\n                } else if (data.regexes && Array.isArray(data.regexes)) {\n                  presetRegexes = data.regexes;\n                }\n              }\n\n              if (presetRegexes && presetRegexes.length > 0) {\n                console.log(\'ğŸ“‹ ä»é¢„è®¾å†…ç½®æ­£åˆ™è·å–åˆ°\', presetRegexes.length, \'ä¸ªè„šæœ¬ (identifier:\', identifier + \')\');\n                allRegexScripts = allRegexScripts.concat(presetRegexes);\n                break; // æ‰¾åˆ°å°±é€€å‡ºå¾ªç¯\n              }\n            } catch (parseError) {\n              console.warn(\'âš ï¸ è§£æ identifier\', identifier, \'å¤±è´¥:\', parseError);\n            }\n          }\n        }\n      }\n    }\n  } catch (e) {\n    console.warn(\'âš ï¸ è·å–é¢„è®¾å†…ç½®æ­£åˆ™å¤±è´¥:\', e);\n  }\n\n  if (allRegexScripts.length === 0) {\n    console.log(\'âš ï¸ æœªæ‰¾åˆ°ä»»ä½•æ­£åˆ™è„šæœ¬ï¼Œè·³è¿‡è¿‡æ»¤\');\n    return text;\n  }\n\n  console.log(\'ğŸ“‹ æ€»å…±è·å–åˆ°\', allRegexScripts.length, \'ä¸ªæ­£åˆ™è„šæœ¬\');\n\n  // è¿‡æ»¤å‡ºå¯ç”¨çš„ã€é€‚ç”¨äº AI è¾“å‡ºåå¤„ç†çš„æ­£åˆ™\n  // placement æ•°ç»„:\n  //   0 = æç¤ºè¯ä¹‹å‰\n  //   1 = æç¤ºè¯ä¹‹åï¼ˆå‘é€ç»™ AI ä¹‹å‰ï¼‰\n  //   2 = AI è¾“å‡ºä¹‹åï¼ˆæ˜¾ç¤ºç»™ç”¨æˆ·ä¹‹å‰ï¼‰â­ è¿™æ˜¯æˆ‘ä»¬éœ€è¦çš„ï¼\n  // promptOnly: true = ä»…ç”¨äºæç¤ºè¯å¤„ç†\n  // promptOnly: false = ç”¨äºè¾“å‡ºåå¤„ç† â­ è¿™æ˜¯æˆ‘ä»¬éœ€è¦çš„ï¼\n  const activeScripts = allRegexScripts.filter(script => {\n    return !script.disabled &&\n           !script.promptOnly &&  // åªè¦ promptOnly ä¸º false çš„\n           script.placement &&\n           script.placement.includes(2);  // åªè¦ placement åŒ…å« 2 çš„ï¼ˆAI è¾“å‡ºåï¼‰\n  });\n\n  console.log(\'âœ… æ‰¾åˆ°\', activeScripts.length, \'ä¸ªé€‚ç”¨çš„æ­£åˆ™è„šæœ¬\');\n\n  let result = text;\n\n  // ä¾æ¬¡åº”ç”¨æ¯ä¸ªæ­£åˆ™\n  activeScripts.forEach((script, index) => {\n    try {\n      const regex = new RegExp(script.findRegex, \'gim\');\n      const beforeLength = result.length;\n      result = result.replace(regex, script.replaceString || \'\');\n\n      if (beforeLength !== result.length) {\n        console.log(\'ğŸ§¹ æ­£åˆ™\', index + 1, \'(\', script.scriptName, \') ç”Ÿæ•ˆï¼Œç§»é™¤äº†\', beforeLength - result.length, \'ä¸ªå­—ç¬¦\');\n      }\n    } catch (e) {\n      console.error(\'âŒ æ­£åˆ™\', index + 1, \'(\', script.scriptName, \') åº”ç”¨å¤±è´¥:\', e);\n    }\n  });\n\n  console.log(\'ğŸ¯ æ­£åˆ™è¿‡æ»¤å®Œæˆï¼ŒåŸå§‹é•¿åº¦:\', text.length, \'è¿‡æ»¤åé•¿åº¦:\', result.length);\n\n  return result;\n}\n\n// ===== 5. å‘é€æ¶ˆæ¯ =====\n// âš ï¸ å‡½æ•°åå¿…é¡»é¿å…ä¸é…’é¦†å†²çªï¼ˆä¸è¦ç”¨ sendChatMessageï¼‰\n// âš ï¸ è¿™ä¸ªå‡½æ•°å¿…é¡»åœ¨å…¨å±€ä½œç”¨åŸŸå®šä¹‰ï¼\nasync function handleSend() {\n  const input = $(\'#inner-user-input\');\n  const text = input.val().trim();\n\n  if (!text || isGenerating) return;\n\n  // æ·»åŠ ç”¨æˆ·æ¶ˆæ¯\n  chatHistory.push({ role: \'user\', content: text });\n  input.val(\'\');\n  renderMessages();\n  saveChatHistory();\n\n  // è®¾ç½®ç”ŸæˆçŠ¶æ€\n  isGenerating = true;\n  $(\'#inner-send-btn\').prop(\'disabled\', true).text(\'ç”Ÿæˆä¸­...\');\n\n  try {\n    // âš ï¸ æ£€æŸ¥ STScript API å¯ç”¨æ€§\n    if (typeof triggerSlashWithResult !== \'function\') {\n      throw new Error(\'è¯·åœ¨é…’é¦†ä¸­ä½¿ç”¨æ­¤åŠŸèƒ½\');\n    }\n\n    // è·å–ç”¨æˆ·åå’Œè§’è‰²å\n    const userName = SillyTavern?.name1 || \'You\';\n    const charName = SillyTavern?.name2 || \'AI\';\n\n    // æ„å»ºå®Œæ•´çš„å¯¹è¯ä¸Šä¸‹æ–‡ï¼ˆåŒ…å«å†å²è®°å½•ï¼‰\n    let fullPrompt = \'\';\n    if (chatHistory.length > 0) {\n      fullPrompt += \'ã€å¯¹è¯å†å²ã€‘\\\\n\';\n      chatHistory.forEach((msg) => {\n        const name = msg.role === \'user\' ? userName : charName;\n        fullPrompt += name + \': \' + msg.content + \'\\\\n\';\n      });\n      fullPrompt += \'\\\\n\';\n    }\n    fullPrompt += userName + \': \' + text;\n\n    console.log(\'ğŸš€ å¼€å§‹ç”Ÿæˆï¼Œæç¤ºè¯é•¿åº¦:\', fullPrompt.length);\n\n    // âš ï¸âš ï¸âš ï¸ ä½¿ç”¨ /gen å‘½ä»¤ï¼ˆä¼šè‡ªåŠ¨ä½¿ç”¨è§’è‰²å¡ã€é¢„è®¾ã€ä¸–ç•Œä¹¦ï¼‰\n    const command = \'/gen lock=on "\' + fullPrompt.replace(/"/g, \'\\\\\\\\"\') + \'"\';\n    const result = await triggerSlashWithResult(command);\n\n    console.log(\'ğŸ“¥ AI è¿”å›å€¼é•¿åº¦:\', result ? result.length : 0);\n\n    if (result && result.length > 0) {\n      // âš ï¸âš ï¸âš ï¸ åº”ç”¨æ­£åˆ™è¿‡æ»¤ï¼ˆéšè—æ€ç»´é“¾ç­‰è°ƒè¯•ä¿¡æ¯ï¼‰\n      const cleanedResult = applyRegexFilters(result);\n      console.log(\'ğŸ§¹ æ­£åˆ™è¿‡æ»¤åé•¿åº¦:\', cleanedResult.length);\n\n      // æ·»åŠ  AI å›å¤åˆ°å†å²\n      chatHistory.push({ role: \'assistant\', content: cleanedResult });\n      saveChatHistory();\n      renderMessages();\n      toastr.success(\'å›å¤æˆåŠŸ\');\n    } else {\n      toastr.warning(\'AI æœªè¿”å›å†…å®¹\');\n    }\n\n  } catch (error) {\n    console.error(\'ç”Ÿæˆå¤±è´¥:\', error);\n    toastr.error(\'ç”Ÿæˆå¤±è´¥: \' + (error?.message || String(error)));\n  } finally {\n    // é‡ç½®çŠ¶æ€\n    isGenerating = false;\n    $(\'#inner-send-btn\').prop(\'disabled\', false).text(\'å‘é€\');\n  }\n}\n\n// =====================================================\n// âš ï¸âš ï¸âš ï¸ ä»è¿™é‡Œå¼€å§‹æ‰èƒ½ç”¨ $(function() {})ï¼Œä¸Šé¢çš„ä»£ç éƒ½æ˜¯å…¨å±€çš„ï¼\n// =====================================================\n\n// ===== 6. åˆå§‹åŒ– =====\n// âš ï¸âš ï¸âš ï¸ å…³é”®ï¼šåªåœ¨è¿™é‡Œè°ƒç”¨å‡½æ•°ï¼Œä¸è¦åœ¨è¿™é‡Œå®šä¹‰å˜é‡å’Œå‡½æ•°ï¼\n$(function() {\n  // è°ƒè¯•è¾“å‡ºï¼Œç¡®ä¿ä»£ç åŠ è½½æˆåŠŸ\n  console.log(\'âœ… åŒå±‚å¯¹è¯åˆå§‹åŒ–å¼€å§‹\');\n  console.log(\'ğŸ“‹ chatHistory å¯è®¿é—®:\', typeof chatHistory !== \'undefined\');\n  console.log(\'ğŸ”§ renderMessages å¯è®¿é—®:\', typeof renderMessages === \'function\');\n  console.log(\'ğŸ”§ handleSend å¯è®¿é—®:\', typeof handleSend === \'function\');\n\n  // âš ï¸ å¦‚æœä¸Šé¢ä»»ä½•ä¸€ä¸ªæ˜¯ falseï¼Œè¯´æ˜å‡½æ•°å®šä¹‰åœ¨ $(function() {}) å†…éƒ¨äº†ï¼\n  if (typeof chatHistory === \'undefined\' || typeof renderMessages !== \'function\') {\n    console.error(\'âŒâŒâŒ ä¸¥é‡é”™è¯¯ï¼šå˜é‡/å‡½æ•°å®šä¹‰åœ¨äº†å±€éƒ¨ä½œç”¨åŸŸï¼\');\n    console.error(\'è¯·æ£€æŸ¥ä»£ç ï¼Œç¡®ä¿æ‰€æœ‰å˜é‡å’Œå‡½æ•°éƒ½åœ¨ $(function() {}) å¤–éƒ¨å®šä¹‰ï¼\');\n    toastr.error(\'ä»£ç ç»“æ„é”™è¯¯ï¼šå˜é‡ä½œç”¨åŸŸé—®é¢˜\');\n    return;\n  }\n\n  loadChatHistory();\n\n  // ç»‘å®šäº‹ä»¶\n  $(\'#inner-send-btn\').on(\'click\', handleSend);\n  $(\'#inner-user-input\').on(\'keypress\', (e) => {\n    if (e.key === \'Enter\' && !e.shiftKey) {\n      e.preventDefault();\n      handleSend();\n    }\n  });\n\n  // æ¸…ç©ºæŒ‰é’®\n  $(\'#inner-clear-btn\').on(\'click\', () => {\n    if (confirm(\'ç¡®å®šæ¸…ç©ºå¯¹è¯å†å²ï¼Ÿ\')) {\n      chatHistory = [];\n      renderMessages();\n      saveChatHistory();\n    }\n  });\n\n  console.log(\'âœ… åŒå±‚å¯¹è¯åˆå§‹åŒ–å®Œæˆ\');\n  console.log(\'ğŸ“Š æ¶ˆæ¯å®¹å™¨:\', $(\'#inner-messages\').length > 0 ? \'âœ… å­˜åœ¨\' : \'âŒ ä¸å­˜åœ¨\');\n});\n\n// ===== 7. å¸è½½æ—¶ä¿å­˜ =====\n$(window).on(\'pagehide\', () => {\n  saveChatHistory();\n});\n\\`\\`\\`\n\n**HTML ç»“æ„ç¤ºä¾‹ï¼ˆå¿…é¡»åŒ…å«ä»¥ä¸‹æ‰€æœ‰å…ƒç´ ï¼‰ï¼š**\n\\`\\`\\`html\n<div class="inner-chat-container">\n  <div class="inner-chat-header">\n    <h3>åŒå±‚å¯¹è¯</h3>\n    <button id="inner-clear-btn">æ¸…ç©º</button>\n  </div>\n\n  \x3c!-- âš ï¸ å¿…éœ€ï¼šæ¶ˆæ¯å®¹å™¨ï¼ŒID å¿…é¡»æ˜¯ inner-messages --\x3e\n  <div id="inner-messages" class="inner-messages"></div>\n\n  <div class="inner-input-area">\n    \x3c!-- âš ï¸ å¿…éœ€ï¼šè¾“å…¥æ¡†ï¼ŒID å¿…é¡»æ˜¯ inner-user-input --\x3e\n    <textarea id="inner-user-input" placeholder="è¾“å…¥æ¶ˆæ¯..."></textarea>\n    \x3c!-- âš ï¸ å¿…éœ€ï¼šå‘é€æŒ‰é’®ï¼ŒID å¿…é¡»æ˜¯ inner-send-btn --\x3e\n    <button id="inner-send-btn">å‘é€</button>\n  </div>\n</div>\n\\`\\`\\`\n\n**âš ï¸ HTML æ£€æŸ¥æ¸…å•ï¼š**\n- [ ] æ˜¯å¦æœ‰ \\`id="inner-messages"\\` çš„æ¶ˆæ¯å®¹å™¨ï¼Ÿ\n- [ ] æ˜¯å¦æœ‰ \\`id="inner-user-input"\\` çš„è¾“å…¥æ¡†ï¼Ÿ\n- [ ] æ˜¯å¦æœ‰ \\`id="inner-send-btn"\\` çš„å‘é€æŒ‰é’®ï¼Ÿ\n- [ ] æ˜¯å¦æœ‰ \\`id="inner-clear-btn"\\` çš„æ¸…ç©ºæŒ‰é’®ï¼Ÿ\n- [ ] ID æ˜¯å¦ä¸ JS ä»£ç ä¸­ä½¿ç”¨çš„å®Œå…¨ä¸€è‡´ï¼Ÿ\n\n**CSS æ ·å¼ç¤ºä¾‹ï¼ˆå¿…é¡»ä¸¥æ ¼éµå®ˆï¼Œç¡®ä¿æ¶ˆæ¯æ­£ç¡®å·¦å³å¯¹é½ï¼‰ï¼š**\n\\`\\`\\`css\n/* æ¶ˆæ¯å®¹å™¨ */\n.inner-messages {\n  height: 400px;\n  overflow-y: auto;\n  padding: 15px;\n  display: flex;  /* âš ï¸ å¿…é¡»ç”¨ flex */\n  flex-direction: column;\n  gap: 10px;\n}\n\n/* æ¶ˆæ¯åŸºç¡€æ ·å¼ */\n.message {\n  max-width: 70%;\n  padding: 10px 15px;\n  border-radius: 12px;\n  word-wrap: break-word;\n}\n\n/* âš ï¸ ç”¨æˆ·æ¶ˆæ¯ï¼šå³å¯¹é½ï¼Œè“è‰² */\n.user-message {\n  align-self: flex-end;  /* âœ… å³å¯¹é½å…³é”®ï¼*/\n  background: #4a9eff;\n  color: white;\n}\n\n/* âš ï¸ AI æ¶ˆæ¯ï¼šå·¦å¯¹é½ï¼Œç°è‰² */\n.ai-message {\n  align-self: flex-start;  /* âœ… å·¦å¯¹é½å…³é”®ï¼*/\n  background: #2a2a2a;\n  color: #e0e0e0;\n}\n\\`\\`\\`\n\n**âš ï¸ å…³é”®ç‚¹ï¼š**\n- ID å¿…é¡»ç”¨å”¯ä¸€å‰ç¼€ï¼ˆ\\`inner-\\`ï¼‰\n- å®¹å™¨å¿…é¡» \\`display: flex; flex-direction: column\\`\n- ç”¨æˆ·æ¶ˆæ¯ç”¨ \\`align-self: flex-end\\` å³å¯¹é½\n- AI æ¶ˆæ¯ç”¨ \\`align-self: flex-start\\` å·¦å¯¹é½\n\n**å…³é”® APIï¼š**\n- **\\`generate(prompt)\\`**: **è°ƒç”¨ AI ç”Ÿæˆï¼ˆä½¿ç”¨å½“å‰é¢„è®¾ã€è§’è‰²å¡ã€ä¸–ç•Œä¹¦ï¼‰**\n- \\`generateRaw(prompt)\\`: è°ƒç”¨ AI ç”Ÿæˆï¼ˆä¸ä½¿ç”¨é¢„è®¾ï¼Œçº¯æ–‡æœ¬ç”Ÿæˆï¼‰\n- \\`getVariables({ type: \'message\', message_id })\\`: è¯»å–æ¶ˆæ¯æ¥¼å±‚å˜é‡\n- \\`insertOrAssignVariables(data, { type: \'message\', message_id })\\`: ä¿å­˜åˆ°æ¶ˆæ¯æ¥¼å±‚å˜é‡\n- \\`getChatMessages()\\`: è·å–æ‰€æœ‰æ¶ˆæ¯\n\n**é‡è¦åŒºåˆ«ï¼š**\n- **\\`generate\\`**: ä½¿ç”¨å®Œæ•´çš„è§’è‰²é¢„è®¾ï¼Œé€‚åˆåŒå±‚å¯¹è¯ï¼ˆæ¨èï¼ï¼‰\n- **\\`generateRaw\\`**: ä¸ä½¿ç”¨é¢„è®¾ï¼Œé€‚åˆçº¯æ–‡æœ¬ç”Ÿæˆä»»åŠ¡\n\n**âš ï¸ å…³é”®æ³¨æ„äº‹é¡¹ï¼ˆå¿…è¯»ï¼‰ï¼š**\n1. **ä½œç”¨åŸŸé—®é¢˜ï¼ˆæœ€å¸¸è§é”™è¯¯ï¼80% çš„é—®é¢˜éƒ½æ˜¯è¿™ä¸ªï¼ï¼‰**ï¼š\n   - âŒ **ç¦æ­¢**ï¼šåœ¨ \\`$(function() {})\\` å†…éƒ¨ç”¨ \\`let\\`/\\`const\\`/\\`function\\` å®šä¹‰å˜é‡å’Œå‡½æ•°\n   - âœ… **æ­£ç¡®**ï¼šæ‰€æœ‰å˜é‡å’Œå‡½æ•°éƒ½åœ¨**å…¨å±€ä½œç”¨åŸŸ**å®šä¹‰ï¼Œ\\`$(function() {})\\` åªç”¨äºè°ƒç”¨\n   - **éªŒè¯æ–¹æ³•**ï¼šåœ¨åˆå§‹åŒ–æ—¶æ‰“å° \\`console.log(typeof chatHistory)\\`ï¼Œåº”è¯¥æ˜¯ \\`\'object\'\\` è€Œé \\`\'undefined\'\\`\n\n1.5. **ç¦æ­¢å†™æ¨¡æ‹Ÿ/å‡å›å¤ï¼ˆå¸¸è§å¤šä½™ä»£ç ï¼ï¼‰**ï¼š\n   - âŒ **ç¦æ­¢**ï¼š\\`chatHistory.push({ role: \'assistant\', content: \'è¿™æ˜¯æ¨¡æ‹Ÿå›å¤\' });\\`\n   - âŒ **ç¦æ­¢**ï¼š\\`chatHistory.push({ role: \'assistant\', content: \'è¿™æ˜¯ AI çš„å›å¤\' });\\`\n   - âŒ **ç¦æ­¢**ï¼šä»»ä½•ç¡¬ç¼–ç çš„å‡ AI å›å¤\n   - âœ… **æ­£ç¡®**ï¼šåªè°ƒç”¨ \\`generate()\\`ï¼ŒAI å›å¤é€šè¿‡ \\`STREAM_TOKEN_RECEIVED_FULLY\\` äº‹ä»¶è‡ªåŠ¨æ¥æ”¶\n   - **åŸå› **ï¼š\\`generate()\\` ä¼šçœŸæ­£è°ƒç”¨ AI APIï¼Œä¸éœ€è¦å†™å‡å›å¤æ¥æµ‹è¯•\n\n2. **generation_id çš„æ­£ç¡®ç”¨æ³•ï¼ˆéå¸¸é‡è¦ï¼ï¼‰**ï¼š\n   - âŒ é”™è¯¯ï¼š\\`const result = await generate(...); const id = result.generation_id;\\`\n   - âœ… æ­£ç¡®ï¼š\n     \\`\\`\\`javascript\n     const myId = \'chat-\' + Date.now() + \'-\' + Math.random().toString(36).slice(2);\n     await generate({ user_input: text, generation_id: myId });\n     // ç›‘å¬å™¨ä¸­çš„ id å‚æ•°å°±æ˜¯ myId\n     \\`\\`\\`\n   - \\`generate()\\` è¿”å› \\`Promise<string>\\`ï¼Œä¸è¿”å›å¯¹è±¡ï¼\n   - å¿…é¡»è‡ªå·±ç”Ÿæˆå”¯ä¸€ ID å¹¶ä¼ å…¥ï¼Œä¸æ˜¯ä»è¿”å›å€¼è·å–ï¼\n\n3. **è¿™æ˜¯å‰ç«¯ç•Œé¢é¡¹ç›®ï¼Œä¸æ˜¯æ¶ˆæ¯æ¥¼å±‚åµŒå…¥ï¼**\n   - éœ€è¦åˆ›å»º \\`index.html\\` + \\`index.ts\\`ï¼ˆå‰ç«¯ç•Œé¢é¡¹ç›®ï¼‰\n   - ç©å®¶åœ¨ç•Œé¢å†…æ¸¸ç©ï¼Œä¸çœ‹é…’é¦†ä¸»èŠå¤©\n   - åå°å¯ç”¨ \\`setChatMessages(..., { refresh: \'none\' })\\` æ“ä½œæ¶ˆæ¯ä½†ä¸åˆ·æ–°\n\n4. **å‡½æ•°å‘½åå¿…é¡»é¿å…å†²çª**ï¼š\n   - âŒ ç¦æ­¢ä½¿ç”¨ \\`sendChatMessage\\`ï¼ˆä¸é…’é¦†åŸç”Ÿå‡½æ•°é‡åï¼ï¼‰\n   - âŒ ç¦æ­¢ä½¿ç”¨ \\`generate\\`ã€\\`getChatMessages\\` ç­‰é…’é¦† API åä½œä¸ºå‡½æ•°å\n   - âœ… ä½¿ç”¨å¸¦å‰ç¼€çš„åç§°ï¼š\\`handleSend\\`ã€\\`innerSendMessage\\`ã€\\`sendInnerMessage\\`\n   - **åŸå› **ï¼šé‡åä¼šå¯¼è‡´è°ƒç”¨é…’é¦†å†…éƒ¨å‡½æ•° \\`sk()\\` ç­‰ï¼Œå¼•å‘é”™è¯¯\n\n5. **å…ƒç´  ID å¿…é¡»å”¯ä¸€**ï¼š\n   - ä½¿ç”¨ \\`inner-\\` ç­‰å‰ç¼€é¿å…ä¸é…’é¦†å†²çª\n   - ä¸è¦ç”¨ \\`send-button\\`ã€\\`user-input\\` ç­‰å¸¸è§åç§°\n   - **éªŒè¯æ–¹æ³•**ï¼šæ£€æŸ¥ \\`$(\'#inner-messages\').length\\` åº”è¯¥æ˜¯ 1ï¼Œä¸æ˜¯ 0\n\n6. **æµå¼ä¼ è¾“ç›‘å¬ï¼ˆæ ¸å¿ƒï¼æœ€å®¹æ˜“å‡ºé”™ï¼ï¼‰**ï¼š\n   - âš ï¸ **äº‹ä»¶åï¼šä½¿ç”¨å¸¸é‡ \\`iframe_events.XXX\\`ï¼Œä¸è¦ç”¨å­—ç¬¦ä¸² \\`\'iframe_events.XXX\'\\`**\n   - âš ï¸ **å›è°ƒå‚æ•°ï¼šæ˜¯ \\`(text, id)\\`ï¼Œä¸æ˜¯ \\`(data)\\`ï¼ç›´æ¥ç”¨ \\`text\\` ä¸è¦ç”¨ \\`data.text\\`**\n   - âš ï¸ **å¿…é¡»å¯ç”¨æµå¼ï¼š\\`generate({ user_input: text, should_stream: true, generation_id: myId })\\`**\n   - ä½¿ç”¨ \\`eventOn(iframe_events.STREAM_TOKEN_RECEIVED_FULLY, (text, id) => ...)\\` è·å–å®Œæ•´å›å¤\n   - ä½¿ç”¨ \\`eventOn(iframe_events.STREAM_TOKEN_RECEIVED_INCREMENTALLY, (text, id) => ...)\\` è·å–å¢é‡æ›´æ–°\n\n7. **API ä½¿ç”¨è§„èŒƒ**ï¼š\n   - âœ… \\`generate(prompt)\\`ï¼šåŒ…å«è§’è‰²å¡ã€é¢„è®¾ã€ä¸–ç•Œä¹¦ï¼ˆæ¨èï¼ï¼‰\n   - âœ… \\`generateRaw(prompt)\\`ï¼šçº¯æ–‡æœ¬ç”Ÿæˆï¼Œä¸ä½¿ç”¨é¢„è®¾\n   - ä¸¤è€…éƒ½ä¼šè§¦å‘æµå¼ä¼ è¾“äº‹ä»¶\n\n8. **æ•°æ®æŒä¹…åŒ–**ï¼š\n   - æ¨èä½¿ç”¨ \\`getVariables({ type: \'chat\' })\\` å’Œ \\`insertOrAssignVariables(data, { type: \'chat\' })\\`\n   - æˆ–ä½¿ç”¨æ¶ˆæ¯æ¥¼å±‚å˜é‡ï¼š\\`{ type: \'message\', message_id }\\`\n   - é¡µé¢å¸è½½æ—¶å¿…é¡»ä¿å­˜æ•°æ®\n\n**æ ¸å¿ƒç¤ºä¾‹ï¼ˆå¿…é¡»ä¸¥æ ¼éµå®ˆï¼ï¼‰ï¼š**\n\\`\\`\\`javascript\n// ========== âš ï¸ å…³é”®ï¼šæµå¼äº‹ä»¶ç›‘å¬ï¼ˆæœ€å®¹æ˜“å‡ºé”™ï¼ï¼‰==========\n\n// âŒâŒâŒ é”™è¯¯å†™æ³•ï¼ˆç¦æ­¢ï¼ï¼‰ï¼š\n// eventOn(\'iframe_events.STREAM_TOKEN_RECEIVED_FULLY\', (data) => { ... })\n// âŒ ä¸è¦ç”¨å­—ç¬¦ä¸² \'iframe_events.XXX\'\n// âŒ ä¸è¦ç”¨å‚æ•° (data)\n\n// âœ…âœ…âœ… æ­£ç¡®å†™æ³•ï¼ˆå¿…é¡»è¿™æ ·å†™ï¼ï¼‰ï¼š\neventOn(iframe_events.STREAM_TOKEN_RECEIVED_INCREMENTALLY, (text, id) => {\n  // text æ˜¯ç´¯ç§¯çš„å®Œæ•´æ–‡æœ¬\n  $(\'#ai-reply\').text(text); // âœ… ç›´æ¥ç”¨ textï¼Œä¸æ˜¯ text.text æˆ– data.text\n  console.log(\'å¢é‡æ›´æ–°:\', text);\n});\n\neventOn(iframe_events.STREAM_TOKEN_RECEIVED_FULLY, (text, id) => {\n  // text æ˜¯æœ€ç»ˆå®Œæ•´æ–‡æœ¬\n  console.log(\'âœ… ç”Ÿæˆå®Œæˆ:\', text); // âœ… ç›´æ¥ç”¨ text\n  chatHistory.push({ role: \'assistant\', content: text });\n  saveChatHistory();\n  isGenerating = false;\n  $(\'#send-btn\').prop(\'disabled\', false).text(\'å‘é€\');\n});\n\n// å¤‡é€‰æ–¹æ¡ˆï¼šå¦‚æœæµå¼ä¸å·¥ä½œï¼Œç”¨ GENERATION_ENDED\neventOn(iframe_events.GENERATION_ENDED, (text, id) => {\n  console.log(\'âœ… ç”Ÿæˆç»“æŸ:\', text);\n  chatHistory.push({ role: \'assistant\', content: text });\n  saveChatHistory();\n  isGenerating = false;\n  $(\'#send-btn\').prop(\'disabled\', false).text(\'å‘é€\');\n});\n\n// ========== å‘é€æ¶ˆæ¯ ==========\nasync function handleSend() {\n  const userInput = $(\'#user-input\').val();\n  chatHistory.push({ role: \'user\', content: userInput });\n\n  isGenerating = true;\n  $(\'#send-btn\').prop(\'disabled\', true).text(\'ç”Ÿæˆä¸­...\');\n\n  // âœ…âœ…âœ… å¿…é¡»è¿™æ ·è°ƒç”¨ï¼ˆä½¿ç”¨ STScript å‘½ä»¤ï¼‰ï¼š\n  const command = \'/gen lock=on "\' + userInput.replace(/"/g, \'\\\\\\\\"\') + \'"\';\n  const result = await triggerSlashWithResult(command);\n\n  if (result) {\n    chatHistory.push({ role: \'assistant\', content: result });\n    renderMessages();\n  }\n\n  // âŒâŒâŒ ç¦æ­¢ä½¿ç”¨ generate APIï¼š\n  // await generate({ user_input: userInput });  // âŒ ä¸æ¨è\n}\n\\`\\`\\`\n\n**ä¸ºä»€ä¹ˆç”¨ triggerSlashWithResultï¼Ÿ**\n- ä½¿ç”¨ \\`/gen\\` å‘½ä»¤ä¼šè‡ªåŠ¨åº”ç”¨è§’è‰²å¡ã€é¢„è®¾ã€ä¸–ç•Œä¹¦\n- è¿”å›å€¼ç›´æ¥æ˜¯ç”Ÿæˆçš„æ–‡æœ¬ï¼Œç®€å•ç›´æ¥\n- ä¸éœ€è¦å¤æ‚çš„æµå¼ç›‘å¬å’Œ generation_id ç®¡ç†\n\n**\\`/gen\\` å‘½ä»¤è¯´æ˜ï¼š**\n- \\`/gen lock=on "æç¤ºè¯"\\`ï¼šç”Ÿæˆæ—¶é”å®šè¾“å…¥æ¡†ï¼ˆæ¨èï¼ï¼‰\n- ä¼šè‡ªåŠ¨ä½¿ç”¨å½“å‰è§’è‰²å¡ã€é¢„è®¾ã€ä¸–ç•Œä¹¦\n- è¿”å›å€¼æ˜¯ AI ç”Ÿæˆçš„å®Œæ•´æ–‡æœ¬\n\n---\n\n# ğŸŒŠ åŒå±‚å¯¹è¯çš„ä¸¤ç§å®ç°æ–¹å¼ï¼ˆAI è‡ªåŠ¨é€‰æ‹©ï¼‰\n\nå½“ç”¨æˆ·éœ€æ±‚ä¸­æåˆ°**"å®æ—¶æ˜¾ç¤º"ã€"æ‰“å­—æ•ˆæœ"ã€"æµå¼"ã€"è¾¹ç”Ÿæˆè¾¹æ˜¾ç¤º"**æ—¶ï¼Œä½¿ç”¨**çœŸæµå¼æ–¹æ¡ˆ**ï¼ˆæ–¹æ¡ˆBï¼‰ã€‚\nå¦åˆ™ï¼Œä½¿ç”¨**ç®€å•æ–¹æ¡ˆ**ï¼ˆæ–¹æ¡ˆAï¼‰ã€‚\n\n## âš ï¸âš ï¸âš ï¸ å¿…é¡»åŒ…å«çš„æ ¸å¿ƒåŠŸèƒ½ï¼ˆä¸¤ç§æ–¹æ¡ˆéƒ½è¦æœ‰ï¼ï¼‰\n\n### 1. æ•°æ®æŒä¹…åŒ–ï¼ˆæœ€é‡è¦ï¼ï¼‰\n- âœ… **ä¿å­˜åˆ°èŠå¤©å˜é‡**ï¼šä½¿ç”¨ \\`insertOrAssignVariables({ inner_chat_history: chatHistory }, { type: \'chat\' })\\`\n- âœ… **é¡µé¢åŠ è½½æ—¶æ¢å¤**ï¼šåœ¨ \\`$(function() {})\\` ä¸­è°ƒç”¨ \\`loadChatHistory()\\`\n- âœ… **åˆ‡æ¢èŠå¤©æ—¶é‡æ–°åŠ è½½**ï¼šç›‘å¬ \\`SillyTavern.getCurrentChatId()\\` å˜åŒ–\n- âœ… **é¡µé¢å¸è½½æ—¶ä¿å­˜**ï¼šåœ¨ \\`$(window).on(\'pagehide\', ...)\\` ä¸­ä¿å­˜\n- âœ… **å®æ—¶ä¿å­˜**ï¼šæ¯æ¬¡å‘é€/æ¥æ”¶æ¶ˆæ¯åç«‹å³è°ƒç”¨ \\`saveChatHistory()\\`\n\n### 2. ä¸æ‰“æ–­ç”Ÿæˆï¼ˆå…³é”®ï¼ï¼‰\n- âœ… **æœ€å°åŒ–é¢æ¿ä¸æ‰“æ–­**ï¼šé¢æ¿åªæ˜¯éšè—ï¼ˆ\\`display: none\\`ï¼‰ï¼Œiframe ä¸å¸è½½\n- âœ… **åˆ‡æ¢æ ‡ç­¾é¡µä¸æ‰“æ–­**ï¼šæ•°æ®å·²ä¿å­˜åˆ°å˜é‡ï¼Œåˆ‡æ¢å›æ¥è‡ªåŠ¨æ¢å¤\n- âœ… **åˆ·æ–°é¡µé¢åæ¢å¤**ï¼šä»èŠå¤©å˜é‡è¯»å– \\`chatHistory\\`ï¼Œå®Œæ•´æ¢å¤å¯¹è¯\n\n### 3. è·¨èŠå¤©éš”ç¦»\n- âœ… **æ¯ä¸ªèŠå¤©ç‹¬ç«‹**ï¼šæ•°æ®å­˜å‚¨åœ¨ \\`{ type: \'chat\' }\\`ï¼Œä¸åŒèŠå¤©æ–‡ä»¶æ•°æ®äº’ä¸å½±å“\n- âœ… **åˆ‡æ¢èŠå¤©è‡ªåŠ¨åˆ‡æ¢æ•°æ®**ï¼šç›‘å¬ \\`getCurrentChatId()\\` å˜åŒ–ï¼Œè‡ªåŠ¨åŠ è½½å¯¹åº”èŠå¤©çš„å†å²\n\n## ğŸ“š ç®€å•æ–¹æ¡ˆï¼ˆtriggerSlashWithResultï¼‰\n\n**ç‰¹ç‚¹ï¼š** ä»£ç ç®€å•ï¼Œç­‰å¾…å®Œæ•´ç”Ÿæˆåä¸€æ¬¡æ€§æ˜¾ç¤ºã€‚\n\n**å®Œæ•´å®ç°ï¼ˆåŒ…å«æ•°æ®æŒä¹…åŒ–ï¼ï¼‰ï¼š**\n\n\\`\\`\\`typescript\n// ===== 1. å…¨å±€å˜é‡ï¼ˆå¿…é¡»åœ¨å…¨å±€ä½œç”¨åŸŸï¼ï¼‰=====\nlet chatHistory: Array<{ role: string; content: string }> = [];\nlet isGenerating = false;\n\n// ===== 2. æ•°æ®æŒä¹…åŒ– =====\nfunction loadChatHistory() {\n  const isInTavern = typeof getVariables === \'function\';\n  if (!isInTavern) {\n    const saved = localStorage.getItem(\'inner_chat_history\');\n    chatHistory = saved ? JSON.parse(saved) : [];\n  } else {\n    const data = getVariables({ type: \'chat\' });\n    chatHistory = data?.inner_chat_history || [];\n  }\n  renderMessages();\n}\n\nfunction saveChatHistory() {\n  const isInTavern = typeof insertOrAssignVariables === \'function\';\n  if (!isInTavern) {\n    localStorage.setItem(\'inner_chat_history\', JSON.stringify(chatHistory));\n  } else {\n    insertOrAssignVariables({ inner_chat_history: chatHistory }, { type: \'chat\' });\n  }\n}\n\n// ===== 3. æ­£åˆ™è¿‡æ»¤ï¼ˆæ ¸å¿ƒï¼ï¼‰=====\nfunction applyRegexFilters(text: string): string {\n  console.log(\'ğŸ” å¼€å§‹æ¸…ç†ï¼ŒåŸå§‹é•¿åº¦:\', text.length);\n\n  if (!text || typeof text !== \'string\') return \'\';\n\n  // ===== æ­¥éª¤ 0: ä¿®å¤æœªé—­åˆçš„æ ‡ç­¾ =====\n  const criticalTags = [\'thinking\', \'UpdateVariable\', \'guide\', \'plot\', \'status\', \'dream\', \'gametxt\'];\n  criticalTags.forEach(tag => {\n    const openTagRegex = new RegExp(\\\\\\`<\\\\\\${tag}([^>]*)>\\\\\\`, \'gi\');\n    const closeTagRegex = new RegExp(\\\\\\`</\\\\\\${tag}>\\\\\\`, \'gi\');\n\n    const openMatches = text.match(openTagRegex);\n    const closeMatches = text.match(closeTagRegex);\n\n    const openCount = openMatches ? openMatches.length : 0;\n    const closeCount = closeMatches ? closeMatches.length : 0;\n\n    if (openCount > closeCount) {\n      const missing = openCount - closeCount;\n      console.log(\\\\\\`âš ï¸ å‘ç° \\\\\\${missing} ä¸ªæœªé—­åˆçš„ <\\\\\\${tag}> æ ‡ç­¾ï¼Œè‡ªåŠ¨è¡¥é½\\\\\\`);\n      text = text + \\\\\\`</\\\\\\${tag}>\\\\\\`.repeat(missing);\n    }\n  });\n\n  // ===== æ­¥éª¤ 1: ä¼˜å…ˆæå–æ­£æ–‡æ ‡ç­¾ï¼ˆæ¢¦æ˜Ÿæ–¹æ¡ˆï¼‰=====\n  function extractLastTagContent(tagName: string, text: string): string | null {\n    if (!text || typeof text !== \'string\') return null;\n\n    const endTag = \\\\\\`</\\\\\\${tagName}>\\\\\\`;\n    const searchPool = text.toLowerCase();\n    const endTagPattern = endTag.toLowerCase();\n\n    const lastEndIndex = searchPool.lastIndexOf(endTagPattern);\n    if (lastEndIndex !== -1) {\n      const startTag = \\\\\\`<\\\\\\${tagName}>\\\\\\`;\n      const startTagPattern = startTag.toLowerCase();\n\n      const lastStartIndex = searchPool.lastIndexOf(startTagPattern, lastEndIndex);\n      if (lastStartIndex !== -1) {\n        const startIndex = lastStartIndex + startTag.length;\n        return text.substring(startIndex, lastEndIndex).trim();\n      }\n    }\n    return null;\n  }\n\n  const gameTextTags = [\'dream\', \'gametxt\', \'output\', \'display\', \'text\', \'content\'];\n  for (const tag of gameTextTags) {\n    const extracted = extractLastTagContent(tag, text);\n    if (extracted !== null) {\n      console.log(\\\\\\`âœ… æå–äº† <\\\\\\${tag}> æ ‡ç­¾çš„å†…å®¹ï¼Œé•¿åº¦:\\\\\\`, extracted.length);\n      return extracted;\n    }\n  }\n\n  // ===== æ­¥éª¤ 2: ç§»é™¤æ‰€æœ‰æ€ç»´é“¾æ ‡ç­¾ =====\n  let cleanedText = text;\n\n  const tagsToRemove = [\n    \'guide\', \'plot\', \'status\',\n    \'UpdateVariable\', \'è§’è‰²æå–\', \'æœ¬ä¸–å†ç¨‹\', \'å¾€ä¸–æ¶Ÿæ¼ª\'\n  ];\n\n  tagsToRemove.forEach(tag => {\n    const regexWithContent = new RegExp(\\\\\\`<\\\\\\${tag}[^>]*>[\\\\\\\\\\\\\\\\s\\\\\\\\\\\\\\\\S]*?</\\\\\\${tag}>\\\\\\`, \'gi\');\n    const before = cleanedText;\n    cleanedText = cleanedText.replace(regexWithContent, \'\');\n\n    const regexSelfClosing = new RegExp(\\\\\\`<\\\\\\${tag}\\\\\\\\\\\\\\\\s*\\\\\\\\\\\\\\\\/>\\\\\\`, \'gi\');\n    cleanedText = cleanedText.replace(regexSelfClosing, \'\');\n\n    if (before !== cleanedText) {\n      console.log(\\\\\\`  ğŸ§¹ ç§»é™¤äº† <\\\\\\${tag}> æ ‡ç­¾\\\\\\`);\n    }\n  });\n\n  // ç‰¹æ®Šå¤„ç†ï¼šç§»é™¤æ‰€æœ‰åŒ…å« think/thinking çš„æ ‡ç­¾\n  const thinkingRegex = /<[^>]*think[^>]*>[\\\\\\\\s\\\\\\\\S]*?<\\\\\\\\/[^>]*think[^>]*>/gi;\n  const beforeThinking = cleanedText;\n  cleanedText = cleanedText.replace(thinkingRegex, \'\');\n  if (beforeThinking !== cleanedText) {\n    console.log(\'  ğŸ§¹ ç§»é™¤äº†åŒ…å« think/thinking çš„æ€ç»´é“¾æ ‡ç­¾\');\n  }\n\n  const thinkingSelfClosing = /<[^>]*think[^>]*\\\\\\\\/>/gi;\n  cleanedText = cleanedText.replace(thinkingSelfClosing, \'\');\n\n  cleanedText = cleanedText.replace(/\x3c!--[\\\\s\\\\S]*?--\x3e/g, \'\');\n\n  if (cleanedText !== text) {\n    console.log(\'âœ… æ ‡ç­¾æ¸…ç†å®Œæˆï¼Œæ¸…ç†åé•¿åº¦:\', cleanedText.length);\n    text = cleanedText;\n  }\n\n  // ===== æ­¥éª¤ 3: å°è¯•åº”ç”¨é…’é¦†æ­£åˆ™ï¼ˆå¯é€‰ï¼‰=====\n  let allRegexScripts: any[] = [];\n\n  if (typeof getRegexScripts === \'function\') {\n    try {\n      const globalRegexes = getRegexScripts();\n      if (globalRegexes && globalRegexes.length > 0) {\n        console.log(\'ğŸ“‹ ä»å…¨å±€æ­£åˆ™è·å–åˆ°\', globalRegexes.length, \'ä¸ªè„šæœ¬\');\n        allRegexScripts = allRegexScripts.concat(globalRegexes);\n      }\n    } catch (e) {\n      console.warn(\'âš ï¸ è·å–å…¨å±€æ­£åˆ™å¤±è´¥:\', e);\n    }\n  }\n\n  try {\n    const parentST = (window as any).parent?.SillyTavern || (window as any).SillyTavern;\n    if (parentST && typeof parentST.getContext === \'function\') {\n      const context = parentST.getContext();\n      const prompts = context?.chatCompletionSettings?.prompts;\n\n      if (prompts && Array.isArray(prompts)) {\n        const possibleIdentifiers = [\'regexes-bindings\', \'SPresetSettings\', \'regex-bindings\'];\n\n        for (const identifier of possibleIdentifiers) {\n          const regexPrompt = prompts.find((p: any) => p.identifier === identifier);\n          if (regexPrompt?.content) {\n            try {\n              const data = JSON.parse(regexPrompt.content);\n              let presetRegexes: any = null;\n\n              if (Array.isArray(data)) {\n                presetRegexes = data;\n              } else if (data && typeof data === \'object\') {\n                if (data.RegexBinding?.regexes && Array.isArray(data.RegexBinding.regexes)) {\n                  presetRegexes = data.RegexBinding.regexes;\n                } else if (data.regexes && Array.isArray(data.regexes)) {\n                  presetRegexes = data.regexes;\n                }\n              }\n\n              if (presetRegexes && presetRegexes.length > 0) {\n                console.log(\'ğŸ“‹ ä»é¢„è®¾å†…ç½®æ­£åˆ™è·å–åˆ°\', presetRegexes.length, \'ä¸ªè„šæœ¬ (identifier:\', identifier + \')\');\n                allRegexScripts = allRegexScripts.concat(presetRegexes);\n                break;\n              }\n            } catch (parseError) {\n              console.warn(\'âš ï¸ è§£æ identifier\', identifier, \'å¤±è´¥:\', parseError);\n            }\n          }\n        }\n      }\n    }\n  } catch (e) {\n    console.warn(\'âš ï¸ è·å–é¢„è®¾å†…ç½®æ­£åˆ™å¤±è´¥:\', e);\n  }\n\n  if (allRegexScripts.length > 0) {\n    console.log(\'ğŸ“‹ æ€»å…±è·å–åˆ°\', allRegexScripts.length, \'ä¸ªæ­£åˆ™è„šæœ¬\');\n\n    const activeScripts = allRegexScripts.filter((script: any) => {\n      if (script.disabled) return false;\n      if (!script.placement || !Array.isArray(script.placement)) return false;\n      if (!script.placement.includes(2)) return false;\n      return true;\n    });\n\n    console.log(\'âœ… æ‰¾åˆ°\', activeScripts.length, \'ä¸ªé€‚ç”¨çš„æ­£åˆ™è„šæœ¬\');\n\n    let result = text;\n    activeScripts.forEach((script: any, index: number) => {\n      try {\n        const regex = new RegExp(script.findRegex, \'gim\');\n        const beforeLength = result.length;\n        result = result.replace(regex, script.replaceString || \'\');\n\n        if (beforeLength !== result.length) {\n          console.log(\'ğŸ§¹ æ­£åˆ™\', index + 1, \'(\', script.scriptName, \') ç”Ÿæ•ˆ\');\n        }\n      } catch (e) {\n        console.error(\'âŒ æ­£åˆ™\', index + 1, \'åº”ç”¨å¤±è´¥:\', e);\n      }\n    });\n\n    text = result;\n  }\n\n  console.log(\'ğŸ“Š æœ€ç»ˆé•¿åº¦:\', text.length);\n  return text;\n}\n\n// ===== 4. å‘é€æ¶ˆæ¯ =====\nasync function handleSend() {\n  const input = $(\'#inner-input\');\n  const userInput = input.val().trim();\n  if (!userInput || isGenerating) return;\n\n  chatHistory.push({ role: \'user\', content: userInput });\n  input.val(\'\');\n  saveChatHistory();\n  renderMessages();\n\n  isGenerating = true;\n  $(\'#inner-send-btn\').prop(\'disabled\', true).text(\'ç”Ÿæˆä¸­...\');\n\n  try {\n    if (typeof triggerSlashWithResult !== \'function\') {\n      throw new Error(\'è¯·åœ¨é…’é¦†ä¸­ä½¿ç”¨æ­¤åŠŸèƒ½\');\n    }\n\n    const userName = SillyTavern?.name1 || \'You\';\n    const charName = SillyTavern?.name2 || \'AI\';\n\n    let fullPrompt = \'\';\n    if (chatHistory.length > 1) {\n      fullPrompt += \'ã€å¯¹è¯å†å²ã€‘\\\\n\';\n      chatHistory.slice(0, -1).forEach((msg) => {\n        const name = msg.role === \'user\' ? userName : charName;\n        fullPrompt += name + \': \' + msg.content + \'\\\\n\';\n      });\n      fullPrompt += \'\\\\n\';\n    }\n    fullPrompt += userName + \': \' + userInput;\n\n    console.log(\'ğŸš€ å¼€å§‹ç”Ÿæˆï¼Œæç¤ºè¯é•¿åº¦:\', fullPrompt.length);\n\n    const command = \'/gen lock=on "\' + fullPrompt.replace(/"/g, \'\\\\\\\\"\') + \'"\';\n    const result = await triggerSlashWithResult(command);\n\n    console.log(\'ğŸ“¥ AI è¿”å›å€¼é•¿åº¦:\', result ? result.length : 0);\n\n    if (result && result.length > 0) {\n      const cleanedResult = applyRegexFilters(result);\n      console.log(\'ğŸ§¹ æ­£åˆ™è¿‡æ»¤åé•¿åº¦:\', cleanedResult.length);\n\n      chatHistory.push({ role: \'assistant\', content: cleanedResult });\n      saveChatHistory();\n      renderMessages();\n      toastr.success(\'å›å¤æˆåŠŸ\');\n    } else {\n      toastr.warning(\'AI æœªè¿”å›å†…å®¹\');\n    }\n\n  } catch (error) {\n    console.error(\'ç”Ÿæˆå¤±è´¥:\', error);\n    toastr.error(\'ç”Ÿæˆå¤±è´¥: \' + (error?.message || String(error)));\n  } finally {\n    isGenerating = false;\n    $(\'#inner-send-btn\').prop(\'disabled\', false).text(\'å‘é€\');\n  }\n}\n\n// ===== 5. æ¸²æŸ“æ¶ˆæ¯ =====\nfunction renderMessages() {\n  const container = $(\'#inner-messages\');\n  container.empty();\n\n  chatHistory.forEach((msg, index) => {\n    const name = msg.role === \'user\'\n      ? (typeof getCurrentUser === \'function\' ? getCurrentUser()?.name : null) || \'{{user}}\'\n      : (typeof getCurrentCharacter === \'function\' ? getCurrentCharacter()?.name : null) || \'{{char}}\';\n\n    const msgDiv = $(\'<div>\')\n      .addClass(\'message\')\n      .addClass(msg.role === \'user\' ? \'user-message\' : \'ai-message\')\n      .html(\'<strong>\' + name + \':</strong> \' + msg.content);\n    container.append(msgDiv);\n  });\n\n  container.scrollTop(container[0].scrollHeight);\n}\n\n// ===== 6. ç›‘å¬èŠå¤©åˆ‡æ¢ï¼ˆé‡è¦ï¼ï¼‰=====\nlet currentChatId = SillyTavern.getCurrentChatId();\nif (typeof eventOn === \'function\') {\n  eventOn(\'CHAT_CHANGED\', (newChatId: string) => {\n    if (currentChatId !== newChatId) {\n      console.log(\'ğŸ”„ æ£€æµ‹åˆ°èŠå¤©åˆ‡æ¢:\', currentChatId, \'->\', newChatId);\n      currentChatId = newChatId;\n\n      // é‡æ–°åŠ è½½æ–°èŠå¤©çš„å†å²\n      loadChatHistory();\n\n      // é‡ç½®ç”ŸæˆçŠ¶æ€ï¼ˆå¦‚æœæ­£åœ¨ç”Ÿæˆï¼Œä¼šè¢«æ‰“æ–­ï¼‰\n      if (isGenerating) {\n        isGenerating = false;\n        $(\'#inner-send-btn\').prop(\'disabled\', false).text(\'å‘é€\');\n        console.log(\'âš ï¸ åˆ‡æ¢èŠå¤©ï¼Œå·²ä¸­æ–­ç”Ÿæˆ\');\n      }\n    }\n  });\n}\n\n// ===== 7. åˆå§‹åŒ– =====\n$(function() {\n  console.log(\'âœ… åŒå±‚å¯¹è¯åˆå§‹åŒ–å¼€å§‹ï¼ˆæ–¹æ¡ˆAï¼‰\');\n  console.log(\'ğŸ“Š å½“å‰èŠå¤© ID:\', currentChatId);\n\n  // åŠ è½½èŠå¤©å†å²ï¼ˆä»èŠå¤©å˜é‡æ¢å¤ï¼‰\n  loadChatHistory();\n\n  $(\'#inner-send-btn\').on(\'click\', handleSend);\n  $(\'#inner-input\').on(\'keypress\', (e) => {\n    if (e.key === \'Enter\' && !e.shiftKey) {\n      e.preventDefault();\n      handleSend();\n    }\n  });\n\n  $(\'#inner-clear-btn\').on(\'click\', () => {\n    if (confirm(\'ç¡®å®šæ¸…ç©ºå¯¹è¯å†å²ï¼Ÿ\')) {\n      chatHistory = [];\n      renderMessages();\n      saveChatHistory();\n    }\n  });\n\n  console.log(\'âœ… åŒå±‚å¯¹è¯åˆå§‹åŒ–å®Œæˆï¼ˆæ–¹æ¡ˆAï¼‰\');\n  console.log(\'ğŸ’¾ å·²åŠ è½½\', chatHistory.length, \'æ¡å†å²æ¶ˆæ¯\');\n});\n\n// ===== 8. å¸è½½æ—¶ä¿å­˜ =====\n$(window).on(\'pagehide\', () => {\n  console.log(\'ğŸ’¾ é¡µé¢å¸è½½ï¼Œä¿å­˜æ•°æ®\');\n  saveChatHistory();\n});\n\\`\\`\\`\n\n---\n\n## ğŸŒŠ çœŸæµå¼æ–¹æ¡ˆï¼ˆgenerate + äº‹ä»¶ç›‘å¬ï¼‰\n\n**ç‰¹ç‚¹ï¼š** å®æ—¶æ˜¾ç¤º AI æ‰“å­—æ•ˆæœï¼Œä½“éªŒæœ€ä½³ã€‚\n\n**å®Œæ•´å®ç°ï¼š**\n\n\\`\\`\\`typescript\n// ===== 1. å…¨å±€å˜é‡ï¼ˆå¿…é¡»åœ¨å…¨å±€ä½œç”¨åŸŸï¼ï¼‰=====\nlet chatHistory: Array<{ role: string; content: string }> = [];\nlet isGenerating = false;\nlet currentGenerationId: string | null = null;\n\n// ===== 2. æ•°æ®æŒä¹…åŒ–ï¼ˆä¸æ–¹æ¡ˆAç›¸åŒï¼‰=====\nfunction loadChatHistory() {\n  const isInTavern = typeof getVariables === \'function\';\n  if (!isInTavern) {\n    const saved = localStorage.getItem(\'inner_chat_history\');\n    chatHistory = saved ? JSON.parse(saved) : [];\n  } else {\n    const data = getVariables({ type: \'chat\' });\n    chatHistory = data?.inner_chat_history || [];\n  }\n  renderMessages();\n}\n\nfunction saveChatHistory() {\n  const isInTavern = typeof insertOrAssignVariables === \'function\';\n  if (!isInTavern) {\n    localStorage.setItem(\'inner_chat_history\', JSON.stringify(chatHistory));\n  } else {\n    insertOrAssignVariables({ inner_chat_history: chatHistory }, { type: \'chat\' });\n  }\n}\n\n// ===== 3. æ­£åˆ™è¿‡æ»¤ï¼ˆä¸æ–¹æ¡ˆAç›¸åŒï¼‰=====\nfunction applyRegexFilters(text: string): string {\n  // ... ä¸æ–¹æ¡ˆAå®Œå…¨ç›¸åŒï¼Œæ­¤å¤„çœç•¥ ...\n  // ï¼ˆè¯·å¤åˆ¶æ–¹æ¡ˆAä¸­çš„ applyRegexFilters å®Œæ•´å®ç°ï¼‰\n  return text;\n}\n\n// ===== 4. çœŸæµå¼ç›‘å¬ï¼ˆæ ¸å¿ƒï¼ï¼‰=====\nfunction setupStreamListeners() {\n  // âš ï¸ ç›‘å¬å¢é‡æ–‡æœ¬ï¼ˆå®æ—¶æ›´æ–°ï¼‰\n  eventOn(iframe_events.STREAM_TOKEN_RECEIVED_INCREMENTALLY, (text: string, id: string) => {\n    if (!isGenerating || id !== currentGenerationId) return;\n\n    console.log(\'ğŸ“¥ æ”¶åˆ°å¢é‡æ–‡æœ¬ï¼Œé•¿åº¦:\', text.length);\n\n    // âš ï¸ å®æ—¶æ¸…ç†æ ‡ç­¾\n    const cleanedText = applyRegexFilters(text);\n\n    // æ›´æ–° DOM\n    const container = $(\'#inner-messages\');\n    const charName = (typeof getCurrentCharacter === \'function\' ? getCurrentCharacter()?.name : null) || \'{{char}}\';\n    const lastMsg = container.find(\'.message:last-child\');\n\n    if (lastMsg.length && lastMsg.hasClass(\'ai-message\')) {\n      // æ›´æ–°å·²æœ‰çš„ AI æ¶ˆæ¯\n      lastMsg.html(\'<strong>\' + charName + \':</strong> <span class="streaming">\' + cleanedText + \'</span>\');\n    } else {\n      // åˆ›å»ºæ–°çš„ AI æ¶ˆæ¯\n      const msgDiv = $(\'<div>\')\n        .addClass(\'message ai-message\')\n        .html(\'<strong>\' + charName + \':</strong> <span class="streaming">\' + cleanedText + \'</span>\');\n      container.append(msgDiv);\n    }\n\n    // è‡ªåŠ¨æ»šåŠ¨åˆ°åº•éƒ¨\n    container.scrollTop(container[0].scrollHeight);\n  });\n\n  // âš ï¸ ç›‘å¬ç”Ÿæˆå®Œæˆ\n  eventOn(iframe_events.GENERATION_ENDED, (text: string, id: string) => {\n    if (id === currentGenerationId) {\n      console.log(\'âœ… æµå¼ç”Ÿæˆå®Œæˆï¼Œé•¿åº¦:\', text.length);\n\n      // âš ï¸ æœ€åæ¸…ç†ä¸€æ¬¡å†ä¿å­˜\n      const cleanedText = applyRegexFilters(text);\n\n      // ä¿å­˜åˆ°èŠå¤©å†å²\n      chatHistory.push({ role: \'assistant\', content: cleanedText });\n      saveChatHistory();\n\n      // é‡æ–°æ¸²æŸ“ï¼ˆç§»é™¤å…‰æ ‡æ•ˆæœï¼‰\n      renderMessages();\n\n      // é‡ç½®çŠ¶æ€\n      isGenerating = false;\n      currentGenerationId = null;\n      $(\'#inner-send-btn\').prop(\'disabled\', false).text(\'å‘é€\');\n\n      toastr.success(\'å›å¤å®Œæˆ\');\n    }\n  });\n}\n\n// ===== 5. å‘é€æ¶ˆæ¯ï¼ˆçœŸæµå¼ç‰ˆæœ¬ï¼‰=====\nasync function handleSend() {\n  const input = $(\'#inner-input\');\n  const userInput = input.val().trim();\n  if (!userInput || isGenerating) return;\n\n  // æ·»åŠ ç”¨æˆ·æ¶ˆæ¯\n  chatHistory.push({ role: \'user\', content: userInput });\n  input.val(\'\');\n  saveChatHistory();\n  renderMessages();\n\n  // ç”Ÿæˆå”¯ä¸€ ID\n  currentGenerationId = \'chat-\' + Date.now() + \'-\' + Math.random().toString(36).slice(2);\n\n  // è®¾ç½®ç”ŸæˆçŠ¶æ€\n  isGenerating = true;\n  $(\'#inner-send-btn\').prop(\'disabled\', true).text(\'ç”Ÿæˆä¸­...\');\n\n  try {\n    if (typeof generate !== \'function\') {\n      throw new Error(\'è¯·åœ¨é…’é¦†ä¸­ä½¿ç”¨æ­¤åŠŸèƒ½\');\n    }\n\n    console.log(\'ğŸš€ å¼€å§‹ç”Ÿæˆï¼ˆçœŸæµå¼ï¼‰ï¼Œgeneration_id:\', currentGenerationId);\n\n    // âš ï¸ æ ¸å¿ƒï¼šè°ƒç”¨ generate å¹¶å¯ç”¨æµå¼\n    await generate({\n      user_input: userInput,\n      should_stream: true,           // âš ï¸ å¿…é¡»å¯ç”¨æµå¼\n      generation_id: currentGenerationId,  // âš ï¸ å¿…é¡»ä¼ å…¥ ID\n      overrides: {\n        chat_history: {\n          prompts: chatHistory.map(msg => ({\n            role: msg.role === \'user\' ? \'user\' : \'assistant\',\n            content: msg.content\n          }))\n        }\n      }\n    });\n\n    // æ³¨æ„ï¼šå®é™…çš„æ–‡æœ¬æ›´æ–°æ˜¯é€šè¿‡äº‹ä»¶ç›‘å¬å™¨å®æ—¶æ›´æ–°çš„\n    // GENERATION_ENDED äº‹ä»¶ä¼šè‡ªåŠ¨ä¿å­˜ AI å›å¤åˆ°å†å²\n\n  } catch (error) {\n    console.error(\'âŒ ç”Ÿæˆå¤±è´¥:\', error);\n    toastr.error(\'ç”Ÿæˆå¤±è´¥: \' + (error?.message || String(error)));\n\n    // é‡ç½®çŠ¶æ€\n    isGenerating = false;\n    currentGenerationId = null;\n    $(\'#inner-send-btn\').prop(\'disabled\', false).text(\'å‘é€\');\n  }\n}\n\n// ===== 6. æ¸²æŸ“æ¶ˆæ¯ï¼ˆä¸æ–¹æ¡ˆAç›¸åŒï¼‰=====\nfunction renderMessages() {\n  const container = $(\'#inner-messages\');\n  container.empty();\n\n  chatHistory.forEach((msg, index) => {\n    const name = msg.role === \'user\'\n      ? (typeof getCurrentUser === \'function\' ? getCurrentUser()?.name : null) || \'{{user}}\'\n      : (typeof getCurrentCharacter === \'function\' ? getCurrentCharacter()?.name : null) || \'{{char}}\';\n\n    const msgDiv = $(\'<div>\')\n      .addClass(\'message\')\n      .addClass(msg.role === \'user\' ? \'user-message\' : \'ai-message\')\n      .html(\'<strong>\' + name + \':</strong> \' + msg.content);\n    container.append(msgDiv);\n  });\n\n  container.scrollTop(container[0].scrollHeight);\n}\n\n// ===== 7. ç›‘å¬èŠå¤©åˆ‡æ¢ï¼ˆé‡è¦ï¼ï¼‰=====\nlet currentChatId = SillyTavern.getCurrentChatId();\nif (typeof eventOn === \'function\') {\n  eventOn(\'CHAT_CHANGED\', (newChatId: string) => {\n    if (currentChatId !== newChatId) {\n      console.log(\'ğŸ”„ æ£€æµ‹åˆ°èŠå¤©åˆ‡æ¢:\', currentChatId, \'->\', newChatId);\n      currentChatId = newChatId;\n\n      // é‡æ–°åŠ è½½æ–°èŠå¤©çš„å†å²\n      loadChatHistory();\n\n      // é‡ç½®ç”ŸæˆçŠ¶æ€ï¼ˆå¦‚æœæ­£åœ¨ç”Ÿæˆï¼Œä¼šè¢«æ‰“æ–­ï¼‰\n      if (isGenerating) {\n        isGenerating = false;\n        currentGenerationId = null;\n        $(\'#inner-send-btn\').prop(\'disabled\', false).text(\'å‘é€\');\n        console.log(\'âš ï¸ åˆ‡æ¢èŠå¤©ï¼Œå·²ä¸­æ–­ç”Ÿæˆ\');\n      }\n    }\n  });\n}\n\n// ===== 8. åˆå§‹åŒ– =====\n$(function() {\n  console.log(\'âœ… åŒå±‚å¯¹è¯åˆå§‹åŒ–å¼€å§‹ï¼ˆæ–¹æ¡ˆB - çœŸæµå¼ï¼‰\');\n  console.log(\'ğŸ“Š å½“å‰èŠå¤© ID:\', currentChatId);\n\n  // åŠ è½½èŠå¤©å†å²ï¼ˆä»èŠå¤©å˜é‡æ¢å¤ï¼‰\n  loadChatHistory();\n\n  // è®¾ç½®æµå¼ç›‘å¬ï¼ˆâš ï¸ å¿…é¡»åœ¨åŠ è½½æ—¶å°±è®¾ç½®ï¼‰\n  setupStreamListeners();\n\n  $(\'#inner-send-btn\').on(\'click\', handleSend);\n  $(\'#inner-input\').on(\'keypress\', (e) => {\n    if (e.key === \'Enter\' && !e.shiftKey) {\n      e.preventDefault();\n      handleSend();\n    }\n  });\n\n  $(\'#inner-clear-btn\').on(\'click\', () => {\n    if (confirm(\'ç¡®å®šæ¸…ç©ºå¯¹è¯å†å²ï¼Ÿ\')) {\n      chatHistory = [];\n      renderMessages();\n      saveChatHistory();\n    }\n  });\n\n  console.log(\'âœ… åŒå±‚å¯¹è¯åˆå§‹åŒ–å®Œæˆï¼ˆæ–¹æ¡ˆBï¼‰\');\n  console.log(\'ğŸ’¾ å·²åŠ è½½\', chatHistory.length, \'æ¡å†å²æ¶ˆæ¯\');\n});\n\n// ===== 9. å¸è½½æ—¶ä¿å­˜ =====\n$(window).on(\'pagehide\', () => {\n  console.log(\'ğŸ’¾ é¡µé¢å¸è½½ï¼Œä¿å­˜æ•°æ®\');\n  saveChatHistory();\n});\n\\`\\`\\`\n\n**CSS æ ·å¼ï¼ˆä¸ºæ–¹æ¡ˆBæ·»åŠ å…‰æ ‡æ•ˆæœï¼‰ï¼š**\n\n\\`\\`\\`css\n.streaming {\n  border-right: 2px solid #165DFF;\n  padding-right: 4px;\n  animation: blink 1s infinite;\n}\n\n@keyframes blink {\n  0%, 50% { border-right-color: #165DFF; }\n  51%, 100% { border-right-color: transparent; }\n}\n\\`\\`\\`\n\n---\n\n## ğŸ¤– AI é€‰æ‹©ç­–ç•¥\n\n**åˆ†æç”¨æˆ·éœ€æ±‚æè¿°ï¼Œè‡ªåŠ¨é€‰æ‹©åˆé€‚æ–¹æ¡ˆï¼š**\n\n1. **ä½¿ç”¨çœŸæµå¼æ–¹æ¡ˆï¼ˆç¬¬äºŒç§ï¼‰**ï¼Œå¦‚æœç”¨æˆ·æåˆ°ï¼š\n   - "å®æ—¶æ˜¾ç¤º"ã€"è¾¹ç”Ÿæˆè¾¹æ˜¾ç¤º"\n   - "æ‰“å­—æ•ˆæœ"ã€"æµå¼"\n   - "ä¸æƒ³ç­‰å¾…"ã€"å³æ—¶åé¦ˆ"\n   - æˆ–æ˜ç¡®è¦æ±‚åŒå±‚å¯¹è¯\n\n2. **ä½¿ç”¨ç®€å•æ–¹æ¡ˆï¼ˆç¬¬ä¸€ç§ï¼‰**ï¼Œå¦‚æœï¼š\n   - ç”¨æˆ·æ²¡æœ‰æ˜ç¡®è¦æ±‚æµå¼æ˜¾ç¤º\n   - æˆ–ç”¨æˆ·è¯´"ç®€å•çš„å¯¹è¯ç•Œé¢"\n\n**âš ï¸ é»˜è®¤æ¨èï¼š** å½“ç”¨æˆ·æåˆ°"åŒå±‚å¯¹è¯"æ—¶ï¼Œé»˜è®¤ä½¿ç”¨**çœŸæµå¼æ–¹æ¡ˆ**ï¼ˆä½“éªŒæ›´å¥½ï¼‰ã€‚\n\n## éœ€æ±‚æ”¶é›†ä¸ç•Œé¢è®¾è®¡å¼•å¯¼ï¼ˆé‡è¦ï¼ï¼‰\n\n**å½“ç”¨æˆ·éœ€æ±‚ä¸å¤Ÿè¯¦ç»†æ—¶ï¼Œå¿…é¡»å…ˆå¼•å¯¼ç”¨æˆ·è¡¥å……ä¿¡æ¯ï¼Œä¸è¦ç«‹å³ç”Ÿæˆä»£ç ï¼**\n\n### AI äº¤äº’æµç¨‹ï¼ˆå¿…é¡»éµå®ˆï¼‰\n\n**æ­¥éª¤1ï¼šæ£€æŸ¥ç”¨æˆ·éœ€æ±‚æ˜¯å¦å®Œæ•´**\n\næ£€æŸ¥ç”¨æˆ·æ˜¯å¦æ˜ç¡®äº†ä»¥ä¸‹å†…å®¹ï¼š\n- ç•Œé¢å¸ƒå±€ï¼ˆå¯¹è¯æ¡†ã€è¾“å…¥åŒºåŸŸã€åŠŸèƒ½åŒºçš„æ’å¸ƒï¼‰\n- é…è‰²æ–¹æ¡ˆï¼ˆæ·±è‰²/æµ…è‰²æ¨¡å¼ã€ä¸»è‰²è°ƒï¼‰\n- ç‰¹æ®Šæ•ˆæœï¼ˆåŠ¨ç”»ã€è¿‡æ¸¡æ•ˆæœï¼‰\n- é¢å¤–åŠŸèƒ½ï¼ˆæ–‡ä»¶ä¸Šä¼ ã€è¯­éŸ³è¾“å…¥ã€æ¶ˆæ¯ç¼–è¾‘ç­‰ï¼‰\n\n**æ­¥éª¤2ï¼šæ ¹æ®éœ€æ±‚å®Œæ•´åº¦å†³å®šè¾“å‡º**\n\n### æƒ…å†µAï¼šéœ€æ±‚ä¸å®Œæ•´ï¼ˆç”¨æˆ·åªè¯´äº†"åŒå±‚å¯¹è¯"ã€"æµå¼å¯¹è¯"ç­‰æ ¸å¿ƒåŠŸèƒ½ï¼‰\n\n**ä¸è¦ç«‹å³ç”Ÿæˆä»£ç ï¼åº”è¯¥å…ˆå¼•å¯¼ç”¨æˆ·è¡¥å……éœ€æ±‚ï¼**\n\nè¾“å‡ºæ ¼å¼ï¼š\n\\`\\`\\`\nFILE_START: NEED_MORE_INFO\n\nä½ å¥½ï¼æˆ‘çœ‹åˆ°ä½ æƒ³è¦åˆ›å»ºä¸€ä¸ªå¯¹è¯å‰ç«¯ç•Œé¢ï¼Œæ ¸å¿ƒåŠŸèƒ½åŒ…æ‹¬ï¼š\n- çœŸæµå¼ä¼ è¾“ï¼ˆå®æ—¶æ˜¾ç¤º AI ç”Ÿæˆï¼‰\n- æ¶ˆæ¯å†å²è‡ªåŠ¨ç®¡ç†ï¼ˆä¿å­˜åˆ°èŠå¤©å˜é‡ï¼‰\n- æ­£æ–‡æ ‡ç­¾å®æ—¶æ¸…ç†ï¼ˆè¿‡æ»¤æ€ç»´é“¾ç­‰ï¼‰\n\nä½†æ˜¯ï¼Œä¸ºäº†ç»™ä½ ç”Ÿæˆæœ€ç¬¦åˆéœ€æ±‚çš„ç•Œé¢ï¼Œæˆ‘éœ€è¦äº†è§£æ›´å¤šç»†èŠ‚ï¼š\n\n**1. ç•Œé¢å¸ƒå±€**\n- å¯¹è¯æ¡†çš„ä½ç½®å’Œå¤§å°ï¼Ÿ\n- è¾“å…¥åŒºåŸŸæ”¾åœ¨åº•éƒ¨è¿˜æ˜¯å…¶ä»–ä½ç½®ï¼Ÿ\n- æ˜¯å¦éœ€è¦ä¾§è¾¹æ ã€é¡¶éƒ¨æ æˆ–åº•éƒ¨åŠŸèƒ½åŒºï¼Ÿ\n- æ¶ˆæ¯åˆ—è¡¨å¦‚ä½•æ»šåŠ¨ï¼ˆè‡ªåŠ¨æ»šåŠ¨åˆ°åº•éƒ¨ï¼Ÿï¼‰\n\n**2. é…è‰²æ–¹æ¡ˆ**\n- åå¥½æ·±è‰²æ¨¡å¼è¿˜æ˜¯æµ…è‰²æ¨¡å¼ï¼Ÿ\n- ä¸»è‰²è°ƒåå¥½ï¼ˆè“è‰²ã€ç»¿è‰²ã€ç´«è‰²ç­‰ï¼‰ï¼Ÿ\n- ç”¨æˆ·æ¶ˆæ¯å’Œ AI æ¶ˆæ¯å¦‚ä½•åŒºåˆ†é¢œè‰²ï¼Ÿ\n\n**3. ç‰¹æ®Šæ•ˆæœ**\n- æ˜¯å¦éœ€è¦åŠ¨ç”»æ•ˆæœï¼ˆæ·¡å…¥æ·¡å‡ºã€æ»‘åŠ¨ç­‰ï¼‰ï¼Ÿ\n- æ¶ˆæ¯å‡ºç°æ—¶çš„è¿‡æ¸¡æ•ˆæœï¼Ÿ\n- æŒ‰é’®ç‚¹å‡»ã€è¾“å…¥æ¡†èšç„¦çš„äº¤äº’åé¦ˆï¼Ÿ\n\n**4. é¢å¤–åŠŸèƒ½**\n- æ˜¯å¦éœ€è¦æ–‡ä»¶ä¸Šä¼ åŠŸèƒ½ï¼Ÿ\n- æ˜¯å¦éœ€è¦è¯­éŸ³è¾“å…¥ï¼Ÿ\n- æ˜¯å¦éœ€è¦æ¶ˆæ¯ç¼–è¾‘/åˆ é™¤åŠŸèƒ½ï¼Ÿ\n- æ˜¯å¦éœ€è¦æ¸…ç©ºå†å²æŒ‰é’®ï¼Ÿ\n- æ˜¯å¦éœ€è¦æ­£åˆ™é¢„è®¾åˆ‡æ¢ï¼ˆä¸‹æ‹‰èœå•æˆ–æŒ‰é’®ç»„ï¼‰ï¼Ÿ\n\n---\n\n**åœ¨ä½ æä¾›è¿™äº›è¯¦ç»†ä¿¡æ¯ä¹‹å‰ï¼Œæˆ‘å…ˆè¯´æ˜ä¸€ä¸‹æ ¸å¿ƒåŠŸèƒ½çš„å®ç°åŸç†ï¼š**\n\n### æ ¸å¿ƒç»„ä»¶ç»“æ„\n\nä¸€ä¸ªåŸºæœ¬çš„å¯¹è¯ç•Œé¢åŒ…å«ï¼š\n\n1. **æ¶ˆæ¯æ˜¾ç¤ºåŒº**ï¼šç”¨äºæ¸²æŸ“æ‰€æœ‰å†å²æ¶ˆæ¯å’Œæ­£åœ¨è¿›è¡Œçš„æµå¼æ¶ˆæ¯ï¼Œæ”¯æŒæ»šåŠ¨æ˜¾ç¤º\n2. **æ¶ˆæ¯è¾“å…¥åŒº**ï¼šç”¨æˆ·è¾“å…¥æ–‡æœ¬çš„åŒºåŸŸï¼Œé€šå¸¸åŒ…å«å‘é€æŒ‰é’®\n3. **åŠŸèƒ½æ§åˆ¶åŒº**ï¼ˆå¯é€‰ï¼‰ï¼šåˆ‡æ¢æ­£åˆ™é¢„è®¾ã€æ¸…é™¤å†å²ç­‰åŠŸèƒ½æŒ‰é’®\n\n### çœŸæµå¼å¯¹è¯çš„å®ç°æœºåˆ¶\n\n**æµç¨‹ï¼š**\n1. ç”¨æˆ·å‘é€æ¶ˆæ¯ â†’ è°ƒç”¨ \\`generate({ should_stream: true, generation_id })\\`\n2. ç›‘å¬ \\`iframe_events.STREAM_TOKEN_RECEIVED_INCREMENTALLY\\` äº‹ä»¶å®æ—¶æ¥æ”¶æ–‡æœ¬ç‰‡æ®µ\n3. æ¯æ¥æ”¶ä¸€ä¸ªç‰‡æ®µ â†’ æ¸…ç†æ ‡ç­¾ â†’ é™„åŠ åˆ°æ˜¾ç¤ºåŒºï¼ˆå½¢æˆæ‰“å­—æœºæ•ˆæœï¼‰\n4. æµå¼ç»“æŸ â†’ ä¿å­˜å®Œæ•´çš„æ¸…ç†åæ¶ˆæ¯åˆ° \\`chatHistory\\` â†’ æŒä¹…åŒ–åˆ°èŠå¤©å˜é‡\n\n**å…³é”®ç‚¹ï¼š**\n- ä½¿ç”¨ \\`generation_id\\` è¿‡æ»¤äº‹ä»¶ï¼ˆé¿å…æ¥æ”¶å…¶ä»–å¯¹è¯çš„æ¶ˆæ¯ï¼‰\n- å®æ—¶æ¸…ç†æ ‡ç­¾ï¼ˆ\\`applyRegexFilters\\`ï¼‰é˜²æ­¢æ€ç»´é“¾æš´éœ²\n- ç¦ç”¨å‘é€æŒ‰é’®é˜²æ­¢ç”¨æˆ·é‡å¤å‘é€\n\n### æ¶ˆæ¯å†å²è‡ªåŠ¨ä¿å­˜\n\n**æ•°æ®ç»“æ„ï¼š**\n\\`\\`\\`javascript\nlet chatHistory = [\n  { role: \'user\', content: \'ç”¨æˆ·æ¶ˆæ¯\', timestamp: \'...\' },\n  { role: \'assistant\', content: \'AIå›å¤ï¼ˆå·²æ¸…ç†æ ‡ç­¾ï¼‰\', timestamp: \'...\' }\n];\n\\`\\`\\`\n\n**ä¿å­˜æ—¶æœºï¼š**\n- ç”¨æˆ·æ¶ˆæ¯ï¼šç‚¹å‡»å‘é€åç«‹å³ä¿å­˜\n- AI æ¶ˆæ¯ï¼šæµå¼ä¼ è¾“å®Œæˆåï¼Œæ¸…ç†æ ‡ç­¾å†ä¿å­˜\n\n**æŒä¹…åŒ–ï¼š**\nä½¿ç”¨ \\`insertOrAssignVariables({ inner_chat_history: chatHistory }, { type: \'chat\' })\\` ä¿å­˜åˆ°èŠå¤©å˜é‡\n\n### æ­£æ–‡æ ‡ç­¾å®æ—¶æ¸…ç†\n\n**\\`applyRegexFilters\\` å‡½æ•°çš„æ ¸å¿ƒé€»è¾‘ï¼š**\n1. è‡ªåŠ¨è¡¥é½æœªé—­åˆçš„æ ‡ç­¾ï¼ˆé˜²æ­¢"å‰ç«¯å¤±è¸ª"ï¼‰\n2. ä¼˜å…ˆæå–æ­£æ–‡æ ‡ç­¾ï¼ˆ\\`<dream>\\`ã€\\`<gametxt>\\` ç­‰ï¼‰\n3. ç§»é™¤æ€ç»´é“¾æ ‡ç­¾ï¼ˆ\\`<think>\\`ã€\\`<guide>\\`ã€\\`<plot>\\` ç­‰ï¼‰\n4. åº”ç”¨é…’é¦†å…¨å±€æ­£åˆ™å’Œé¢„è®¾æ­£åˆ™\n\n**è°ƒç”¨æ—¶æœºï¼š**\n- æµå¼æ¥æ”¶æ—¶ï¼šæ¯ä¸ªç‰‡æ®µéƒ½æ¸…ç†åå†æ˜¾ç¤º\n- ä¿å­˜æ—¶ï¼šå®Œæ•´æ¶ˆæ¯æ¸…ç†åå†ä¿å­˜åˆ°å†å²\n\n---\n\n**è¯·è¡¥å……ä¸Šè¿°ç»†èŠ‚ï¼Œæˆ‘ä¼šä¸ºä½ ç”Ÿæˆå®Œæ•´çš„ä»£ç ï¼**\n\nå¦‚æœä½ ç°åœ¨ä¸æƒ³çº ç»“è¿™äº›ç»†èŠ‚ï¼Œä¹Ÿå¯ä»¥ç›´æ¥è¯´"ç”¨é»˜è®¤è®¾è®¡"ï¼Œæˆ‘ä¼šä½¿ç”¨ä»¥ä¸‹é»˜è®¤é…ç½®ï¼š\n- æ·±è‰²æ¨¡å¼ï¼ˆèƒŒæ™¯ #1a1a1aï¼‰\n- ç”¨æˆ·æ¶ˆæ¯ï¼šå³å¯¹é½è“è‰²ï¼ˆ#4a9effï¼‰\n- AI æ¶ˆæ¯ï¼šå·¦å¯¹é½ç°è‰²ï¼ˆ#3a3a3aï¼‰\n- åœ†è§’è®¾è®¡ + åŸºç¡€åŠ¨ç”»\n- è‡ªåŠ¨æ»šåŠ¨åˆ°åº•éƒ¨\n\nFILE_END\n\\`\\`\\`\n\n### æƒ…å†µBï¼šéœ€æ±‚å®Œæ•´ï¼ˆç”¨æˆ·æä¾›äº†è¯¦ç»†çš„ç•Œé¢è®¾è®¡éœ€æ±‚ï¼‰\n\n**ç›´æ¥ç”Ÿæˆä»£ç ï¼**\n\nè¾“å‡ºæ ¼å¼ï¼š\n\\`\\`\\`\nFILE_START: index.html\n[å®Œæ•´çš„ HTML ä»£ç ]\nFILE_END\n\nFILE_START: style.css\n[å®Œæ•´çš„ CSS ä»£ç ]\nFILE_END\n\nFILE_START: script.js\n[å®Œæ•´çš„ JavaScript ä»£ç ]\nFILE_END\n\\`\\`\\`\n\n### æƒ…å†µCï¼šç”¨æˆ·æ˜ç¡®è¯´"ç”¨é»˜è®¤è®¾è®¡"æˆ–"ç®€å•çš„å¯¹è¯ç•Œé¢å°±è¡Œ"\n\n**ä½¿ç”¨é»˜è®¤è®¾è®¡è§„èŒƒç”Ÿæˆä»£ç **\n\n**é»˜è®¤ç•Œé¢è®¾è®¡è§„èŒƒï¼š**\n- æ·±è‰²æ¨¡å¼ï¼ˆèƒŒæ™¯ #1a1a1aï¼Œæ¶ˆæ¯åŒº #2a2a2aï¼‰\n- ç”¨æˆ·æ¶ˆæ¯ï¼šå³å¯¹é½ï¼Œè“è‰²èƒŒæ™¯ï¼ˆ#4a9effï¼‰\n- AI æ¶ˆæ¯ï¼šå·¦å¯¹é½ï¼Œç°è‰²èƒŒæ™¯ï¼ˆ#3a3a3aï¼‰\n- åœ†è§’è®¾è®¡ï¼ˆborder-radius: 12pxï¼‰\n- åŸºç¡€è¿‡æ¸¡åŠ¨ç”»ï¼ˆfadeIn/fadeOutï¼‰\n- è‡ªåŠ¨æ»šåŠ¨åˆ°åº•éƒ¨\n- æ¸…ç©ºå†å²æŒ‰é’®\n- åŸºç¡€çš„æ¶ˆæ¯åˆ—è¡¨å’Œè¾“å…¥æ¡†\n\n---\n\n### æ­£åˆ™é¢„è®¾åˆ‡æ¢åŠŸèƒ½ï¼ˆå¯é€‰ï¼‰\n\nå¦‚æœç”¨æˆ·æ˜ç¡®éœ€è¦æ”¯æŒä¸åŒçš„æ­£åˆ™æ¸…ç†é¢„è®¾ï¼š\n\n\\`\\`\\`typescript\n// å®šä¹‰æ­£åˆ™é¢„è®¾\nconst regexPresets = {\n  "é»˜è®¤æ¸…ç†": [\n    { pattern: /<tag1>/g, replacement: "" },\n    { pattern: /\\\\[tag2\\\\]/g, replacement: "" },\n  ],\n  "ç‰¹æ®Šæ ¼å¼æ¸…ç†": [\n    { pattern: /\\\\{\\\\{some_meta_data\\\\}\\\\}/g, replacement: "" },\n  ]\n};\n\nlet currentPreset = "é»˜è®¤æ¸…ç†";\n\nfunction applyRegexFilters(text: string, presetName?: string): string {\n  const preset = presetName || currentPreset;\n  const rules = regexPresets[preset] || regexPresets["é»˜è®¤æ¸…ç†"];\n\n  let cleanedText = text;\n  rules.forEach(rule => {\n    cleanedText = cleanedText.replace(rule.pattern, rule.replacement);\n  });\n\n  // ä»ç„¶åº”ç”¨é…’é¦†çš„å…¨å±€æ­£åˆ™\n  // ... åŸæœ‰é€»è¾‘ ...\n\n  return cleanedText;\n}\n\nfunction switchPreset(presetName: string) {\n  currentPreset = presetName;\n  renderMessages(); // é‡æ–°æ¸²æŸ“åº”ç”¨æ–°é¢„è®¾\n}\n\\`\\`\\`\n\n**ç•Œé¢å®ç°ï¼š**åœ¨é¡¶éƒ¨æ·»åŠ ä¸‹æ‹‰èœå•æˆ–æŒ‰é’®ç»„åˆ‡æ¢é¢„è®¾\n\n---\n\n# è¾“å‡ºæ ¼å¼ï¼ˆå¿…é¡»ä¸¥æ ¼éµå®ˆï¼‰ï¼š\nåªåœ¨ FILE_START å’Œ FILE_END ä¹‹é—´è¾“å‡ºä»£ç ï¼Œä¸è¦æ·»åŠ ä»»ä½•å…¶ä»–æ–‡å­—ã€‚\n\n**ç¤ºä¾‹ï¼ˆåˆ›å»ºç•Œé¢æ—¶å¿…é¡»è¾“å‡ºä¸‰ä¸ªæ–‡ä»¶ï¼‰ï¼š**\n\nFILE_START: index.html\n[å®Œæ•´çš„ HTML ä»£ç ï¼ŒåŒ…å« headã€bodyã€å¼•ç”¨ CSS å’Œ JS]\nFILE_END\n\nFILE_START: style.css\n[å®Œæ•´çš„ CSS æ ·å¼ä»£ç ]\nFILE_END\n\nFILE_START: script.js\n[å®Œæ•´çš„ JavaScript ä»£ç ï¼Œä½¿ç”¨ jQuery]\nFILE_END\n\n**âš ï¸ ä»£ç è§„èŒƒï¼ˆå¿…é¡»éµå®ˆï¼‰ï¼š**\n1. **å‡½æ•°å‘½å**ï¼šå¿…é¡»ä½¿ç”¨å”¯ä¸€å‰ç¼€ï¼ˆå¦‚ \\`inner\\`ã€\\`my\\`ï¼‰ï¼Œé¿å…ä¸é…’é¦†å‡½æ•°é‡å\n   - âŒ ç¦æ­¢ï¼š\\`sendChatMessage\\`ã€\\`generate\\`ã€\\`getChatMessages\\`\n   - âœ… æ­£ç¡®ï¼š\\`innerSendMessage\\`ã€\\`handleSendMessage\\`ã€\\`sendInnerMessage\\`\n2. **å…ƒç´  ID**ï¼šå¿…é¡»ä½¿ç”¨å”¯ä¸€å‰ç¼€ï¼ˆå¦‚ \\`inner-\\`ã€\\`my-\\`ï¼‰\n   - âŒ ç¦æ­¢ï¼š\\`#send-button\\`ã€\\`#user-input\\`\n   - âœ… æ­£ç¡®ï¼š\\`#inner-send-btn\\`ã€\\`#inner-user-input\\`\n3. **æ¯ä¸ªæ–‡ä»¶éƒ½è¦è¾“å‡ºå®Œæ•´å†…å®¹ï¼Œä¸èƒ½çœç•¥ï¼**\n\n# ğŸ”‘ æ ¸å¿ƒåŸåˆ™ï¼šä¼˜å…ˆå¢é‡ä¿®æ”¹ï¼Œé¿å…é‡å†™ï¼\n**é™¤éç”¨æˆ·æ˜ç¡®è¦æ±‚"é‡å†™"ã€"ä»å¤´å¼€å§‹"ã€"é‡æ–°åˆ›å»º"ï¼Œå¦åˆ™å¿…é¡»åŸºäºç°æœ‰ä»£ç è¿›è¡Œæœ€å°åŒ–ä¿®æ”¹ï¼**\n\n- âœ… ç”¨æˆ·è¯´"æŠŠæŒ‰é’®æ”¹æˆç»¿è‰²" â†’ **åªè¾“å‡º style.css**ï¼ˆåªæ”¹é¢œè‰²ï¼‰\n- âœ… ç”¨æˆ·è¯´"æ·»åŠ ä¸€ä¸ªé‡ç½®åŠŸèƒ½" â†’ **åªè¾“å‡º script.js**ï¼ˆåªåŠ å‡½æ•°ï¼‰\n- âœ… ç”¨æˆ·è¯´"ä¿®å¤ç‚¹å‡»æ— å“åº”" â†’ **åªè¾“å‡º script.js**ï¼ˆåªæ”¹äº‹ä»¶ï¼‰\n- âŒ ç¦æ­¢ï¼šå› ä¸ºå°æ”¹åŠ¨å°±é‡å†™æ•´ä¸ªæ–‡ä»¶ï¼\n\n# è¾“å‡ºæ–‡ä»¶ç­–ç•¥ï¼š\n## å°æ”¹åŠ¨ï¼ˆåªè¾“å‡ºå¿…è¦çš„æ–‡ä»¶ï¼‰ï¼š\n- åªä¿®æ”¹é¢œè‰²/å­—ä½“/è¾¹è·/åŠ¨ç”» â†’ **åªè¾“å‡º style.css**\n- åªä¿®æ”¹ä¸€ä¸ªå‡½æ•°é€»è¾‘/ä¿®å¤ bug â†’ **åªè¾“å‡º script.js**\n- åªæ·»åŠ ä¸€ä¸ªæŒ‰é’®/è¾“å…¥æ¡† â†’ **åªè¾“å‡º index.html**\n- åªä¿®æ”¹æ–‡æ¡ˆ/æ ‡ç­¾å†…å®¹ â†’ **åªè¾“å‡º index.html**\n\n## å¤§æ”¹åŠ¨ï¼ˆè¾“å‡ºæ‰€æœ‰ç›¸å…³æ–‡ä»¶ï¼‰ï¼š\n- åˆ›å»ºæ–°ç•Œé¢/æ–°åŠŸèƒ½ â†’ **è¾“å‡º index.htmlã€style.cssã€script.js**\n- é‡æ„æ•´ä½“å¸ƒå±€/å®Œå…¨é‡è®¾è®¡ â†’ **è¾“å‡ºæ‰€æœ‰æ–‡ä»¶**\n- æ·»åŠ éœ€è¦æ–°æ ·å¼å’Œæ–°é€»è¾‘çš„å¤æ‚åŠŸèƒ½ â†’ **è¾“å‡ºç›¸å…³çš„æ‰€æœ‰æ–‡ä»¶**\n\n# å…¶ä»–è§„åˆ™ï¼š\n1. **âš ï¸ æ•°æ®æŒä¹…åŒ–ï¼šæ¶‰åŠç”¨æˆ·æ•°æ®å¿…é¡»ä½¿ç”¨ getVariables/insertOrAssignVariablesï¼**\n2. **âš ï¸ é¢„è§ˆå…¼å®¹ï¼šå¿…é¡»æ£€æµ‹ \\`typeof SillyTavern !== \'undefined\'\\`ï¼Œé¢„è§ˆæ¨¡å¼ä¸‹ç”¨ localStorage æ›¿ä»£é…’é¦† API**\n3. å¿…é¡»è¾“å‡ºå®Œæ•´å†…å®¹ï¼Œå³ä½¿æ–‡ä»¶å¾ˆé•¿ä¹Ÿä¸èƒ½çœç•¥ï¼ˆä½†ä¼˜å…ˆåªè¾“å‡ºéœ€è¦ä¿®æ”¹çš„æ–‡ä»¶ï¼‰\n4. ä¸è¦åœ¨ä»£ç å¤–æ·»åŠ ä»»ä½•è§£é‡Šæ–‡å­—\n5. CSS è¦ç¾è§‚ä¸”ç¬¦åˆç°ä»£è®¾è®¡\n6. JavaScript ä½¿ç”¨ \\`$(function() { ... })\\` ç¡®ä¿ DOM åŠ è½½\n7. æ•°æ®å­˜å‚¨ï¼š\\`{ type: \'chat\' }\\` ç»‘å®šèŠå¤©ï¼Œ\\`{ type: \'global\' }\\` ä¸ºå…¨å±€\n8. ä¿æŒç°æœ‰ä»£ç çš„å‘½åé£æ ¼ã€ç¼©è¿›ã€æ ¼å¼ï¼Œä¸è¦éšæ„é‡æ„`;\n\n    const currentFiles = proj.files.map(f => `=== ${f.path} ===\\n${f.content}`).join(\'\\n\\n\');\n    const userPrompt = `# å½“å‰é¡¹ç›®æ–‡ä»¶ï¼š\n${currentFiles}\n\n# ç”¨æˆ·éœ€æ±‚ï¼š\n${aiPrompt.value}\n\n# âš ï¸ æ ¸å¿ƒæé†’ï¼š\n1. **ä¼˜å…ˆå¢é‡ä¿®æ”¹**ï¼šé™¤éç”¨æˆ·æ˜ç¡®è¦æ±‚é‡å†™ï¼Œå¦åˆ™åŸºäºç°æœ‰ä»£ç æœ€å°åŒ–ä¿®æ”¹\n2. **åªè¾“å‡ºéœ€è¦æ”¹çš„æ–‡ä»¶**ï¼šå°æ”¹åŠ¨åªè¾“å‡º 1 ä¸ªæ–‡ä»¶ï¼Œå¤§æ”¹åŠ¨æ‰è¾“å‡ºå¤šä¸ª\n3. **ä¿æŒä»£ç é£æ ¼ä¸€è‡´**ï¼šä¸è¦éšæ„é‡æ„ç°æœ‰ä»£ç \n4. **æ•°æ®æŒä¹…åŒ–**ï¼šä½¿ç”¨ getVariables/insertOrAssignVariables\n\nè¯·ä¸¥æ ¼æŒ‰ system ä¸­çš„æ ¼å¼è¾“å‡ºï¼Œä¸è¦æ·»åŠ è§£é‡Šï¼`;\n\n    // æµå¼ä¼ è¾“æˆ–æ™®é€šè¯·æ±‚\n    streamingText.value = \'\'; // é‡ç½®æµå¼æ–‡æœ¬\n    let resultText = \'\';\n\n    progressDialogRef.value?.setProgress(25);\n    progressDialogRef.value?.setMessage(\'æ­£åœ¨å‘é€è¯·æ±‚åˆ° AI æœåŠ¡å™¨...\');\n    await new Promise(r => setTimeout(r, 100)); // ç­‰å¾… DOM æ›´æ–°\n\n    if (enableStream.value) {\n      // æµå¼ä¼ è¾“\n      progressDialogRef.value?.setProgress(30);\n      progressDialogRef.value?.setMessage(\'ç­‰å¾… AI æµå¼å“åº”...\');\n      await new Promise(r => setTimeout(r, 100)); // ç­‰å¾… DOM æ›´æ–°\n\n      const response = await fetch(normalizedEndpoint, {\n        method: \'POST\',\n        headers: {\n          \'Content-Type\': \'application/json\',\n          Authorization: `Bearer ${apiKey}`,\n        },\n        body: JSON.stringify({\n          model: model,\n          messages: [\n            { role: \'system\', content: systemPrompt },\n            { role: \'user\', content: userPrompt },\n          ],\n          temperature: temperature,\n          max_tokens: maxTokens,\n          stream: true, // å¯ç”¨æµå¼ä¼ è¾“\n        }),\n      });\n\n      if (!response.ok) {\n        let errorMsg = `API è¯·æ±‚å¤±è´¥: ${response.status} ${response.statusText}`;\n        try {\n          const errorData = await response.json();\n          console.error(\'API é”™è¯¯è¯¦æƒ…:\', errorData);\n          errorMsg += `\\n${JSON.stringify(errorData, null, 2)}`;\n        } catch (e) {\n          console.error(\'æ— æ³•è§£æé”™è¯¯å“åº”\');\n        }\n        throw new Error(errorMsg);\n      }\n\n      // è¯»å–æµå¼æ•°æ®\n      const reader = response.body?.getReader();\n      const decoder = new TextDecoder();\n\n      if (!reader) {\n        throw new Error(\'æ— æ³•è¯»å–å“åº”æµ\');\n      }\n\n      let chunkCount = 0;\n      while (true) {\n        const { done, value } = await reader.read();\n        if (done) break;\n\n        const chunk = decoder.decode(value, { stream: true });\n        const lines = chunk.split(\'\\n\');\n\n        for (const line of lines) {\n          if (line.startsWith(\'data: \')) {\n            const data = line.slice(6);\n            if (data === \'[DONE]\') continue;\n\n            try {\n              const json = JSON.parse(data);\n              const content = json.choices?.[0]?.delta?.content || \'\';\n              if (content) {\n                resultText += content;\n                streamingText.value += content;\n                chunkCount++;\n\n                // åŠ¨æ€æ›´æ–°è¿›åº¦ï¼ˆ30% â†’ 60%ï¼‰\n                const progress = Math.min(60, 30 + chunkCount / 10);\n                progressDialogRef.value?.setProgress(progress);\n\n                // æ¯10ä¸ªchunkæ›´æ–°ä¸€æ¬¡æ¶ˆæ¯\n                if (chunkCount % 10 === 0) {\n                  progressDialogRef.value?.setMessage(`æ­£åœ¨æ¥æ”¶ AI å“åº”... (${resultText.length} å­—ç¬¦)`);\n                }\n              }\n            } catch (e) {\n              // å¿½ç•¥è§£æé”™è¯¯\n            }\n          }\n        }\n      }\n    } else {\n      // æ™®é€šè¯·æ±‚ï¼ˆéæµå¼ï¼‰\n      progressDialogRef.value?.setProgress(30);\n      progressDialogRef.value?.setMessage(\'ç­‰å¾… AI å“åº”...\');\n      await new Promise(r => setTimeout(r, 100)); // ç­‰å¾… DOM æ›´æ–°\n\n      const response = await fetch(normalizedEndpoint, {\n        method: \'POST\',\n        headers: {\n          \'Content-Type\': \'application/json\',\n          Authorization: `Bearer ${apiKey}`,\n        },\n        body: JSON.stringify({\n          model: model,\n          messages: [\n            { role: \'system\', content: systemPrompt },\n            { role: \'user\', content: userPrompt },\n          ],\n          temperature: temperature,\n          max_tokens: maxTokens,\n        }),\n      });\n\n      if (!response.ok) {\n        let errorMsg = `API è¯·æ±‚å¤±è´¥: ${response.status} ${response.statusText}`;\n        try {\n          const errorData = await response.json();\n          console.error(\'API é”™è¯¯è¯¦æƒ…:\', errorData);\n          errorMsg += `\\n${JSON.stringify(errorData, null, 2)}`;\n        } catch (e) {\n          console.error(\'æ— æ³•è§£æé”™è¯¯å“åº”\');\n        }\n        throw new Error(errorMsg);\n      }\n\n      progressDialogRef.value?.setProgress(60);\n      progressDialogRef.value?.setMessage(\'æ­£åœ¨æ¥æ”¶ AI å“åº”...\');\n\n      const data = await response.json();\n      resultText = data.choices?.[0]?.message?.content || \'\';\n    }\n\n    progressDialogRef.value?.setProgress(75);\n    progressDialogRef.value?.setMessage(\'æ­£åœ¨è§£æ AI ç”Ÿæˆçš„ä»£ç ...\');\n\n    console.log(\'AI åŸå§‹å›å¤:\', resultText);\n    console.log(\'AI å›å¤é•¿åº¦:\', resultText.length);\n\n    if (!resultText || resultText.trim().length === 0) {\n      throw new Error(\'AI è¿”å›å†…å®¹ä¸ºç©ºï¼Œè¯·æ£€æŸ¥ API é…ç½®æˆ–é‡è¯•\');\n    }\n\n    // è§£æç‰¹æ®Šæ ¼å¼ï¼ˆæ”¯æŒå¤šç§æ ¼å¼ï¼‰\n    const changes: AIChange[] = [];\n    // æ”¯æŒï¼šFILE_START: filename\\n...FILE_END æˆ– FILE_START:filename\\n...FILE_END\n    const fileRegex = /FILE_START:\\s*(.+?)[\\r\\n]+([\\s\\S]*?)FILE_END/gi;\n    let match;\n\n    console.log(\'å¼€å§‹è§£æ AI è¿”å›å†…å®¹...\');\n\n    // æ£€æŸ¥æ˜¯å¦æ˜¯éœ€æ±‚æ”¶é›†å¼•å¯¼ï¼ˆç‰¹æ®Šæƒ…å†µï¼‰\n    const needMoreInfoMatch = resultText.match(/FILE_START:\\s*NEED_MORE_INFO\\s*[\\r\\n]+([\\s\\S]*?)FILE_END/i);\n    if (needMoreInfoMatch) {\n      const guideContent = needMoreInfoMatch[1].trim();\n      console.log(\'ğŸ¤– AI éœ€è¦æ›´å¤šä¿¡æ¯ï¼Œæ˜¾ç¤ºå¼•å¯¼å†…å®¹\');\n\n      // å…³é—­ AI å¯¹è¯æ¡†\n      closeAIDialog();\n\n      // æ˜¾ç¤ºå¼•å¯¼å†…å®¹\n      toastr.info(\'AI éœ€è¦æ›´å¤šä¿¡æ¯\', \'\', { timeOut: 3000 });\n\n      // ä½¿ç”¨alertæ˜¾ç¤ºå¼•å¯¼å†…å®¹\n      alert(guideContent);\n\n      // ä¸æŠ›å‡ºé”™è¯¯ï¼Œæ­£å¸¸ç»“æŸ\n      aiGenerating.value = false;\n      return;\n    }\n\n    while ((match = fileRegex.exec(resultText)) !== null) {\n      const path = match[1].trim();\n      const content = match[2].trim();\n\n      console.log(`æ‰¾åˆ°æ–‡ä»¶: ${path}, å†…å®¹é•¿åº¦: ${content.length}`);\n\n      const file = proj.files.find(f => f.path === path);\n      if (file) {\n        changes.push({\n          path: path,\n          oldContent: file.content,\n          newContent: content,\n        });\n      } else {\n        console.warn(`æ–‡ä»¶ ${path} ä¸å­˜åœ¨äºé¡¹ç›®ä¸­ï¼Œå·²å¿½ç•¥`);\n      }\n    }\n\n    if (changes.length === 0) {\n      console.error(\'æœªèƒ½ä» AI å›å¤ä¸­è§£æå‡ºæ–‡ä»¶ä¿®æ”¹\');\n      console.error(\'AI è¿”å›å†…å®¹é¢„è§ˆ:\', resultText.substring(0, 500));\n\n      // æ£€æŸ¥æ˜¯å¦å› ä¸ºå†…å®¹è¢«æˆªæ–­\n      if (resultText.length < 500 || !resultText.includes(\'FILE_END\')) {\n        throw new Error(\n          `AI è¿”å›å†…å®¹è¢«æˆªæ–­ï¼ˆä»… ${resultText.length} å­—ç¬¦ï¼‰ã€‚è¯·åœ¨"è®¾ç½®"ä¸­å¢åŠ  max_tokensï¼ˆå»ºè®® 4000 ä»¥ä¸Šï¼‰ï¼Œç„¶åé‡è¯•ã€‚`,\n        );\n      }\n\n      throw new Error(\'AI æœªè¿”å›æœ‰æ•ˆçš„æ–‡ä»¶ä¿®æ”¹æ ¼å¼ã€‚è¯·ç¡®ä¿ AI è¿”å›çš„å†…å®¹åŒ…å« FILE_START å’Œ FILE_END æ ‡è®°ã€‚\');\n    }\n\n    console.log(\'è§£æåˆ°çš„ä¿®æ”¹:\', changes.length, \'ä¸ªæ–‡ä»¶\');\n\n    progressDialogRef.value?.setProgress(85);\n    progressDialogRef.value?.setMessage(\'æ­£åœ¨å‡†å¤‡å¯¹æ¯”é¢„è§ˆ...\');\n\n    // æ£€æµ‹æ˜¯å¦å¯èƒ½è¢«æˆªæ–­\n    if (changes.length === 1 && changes[0].path === \'index.html\') {\n      toastr.warning(\'AI å¯èƒ½åªç”Ÿæˆäº† HTMLï¼Œå»ºè®®é‡æ–°ç”Ÿæˆæˆ–æ‰‹åŠ¨è¡¥å…… CSS/JS\');\n    }\n\n    // æ£€æµ‹å›å¤æ˜¯å¦å®Œæ•´ï¼ˆæœ€åä¸€ä¸ªæ–‡ä»¶åº”è¯¥æœ‰ FILE_ENDï¼‰\n    const lastFile = resultText.trim().split(\'FILE_START\').pop() || \'\';\n    if (!lastFile.includes(\'FILE_END\')) {\n      toastr.error(\'AI å›å¤å¯èƒ½è¢«æˆªæ–­ï¼Œå»ºè®®ç®€åŒ–éœ€æ±‚æˆ–é‡è¯•\');\n    }\n\n    const result = { changes };\n\n    if (!result.changes || !Array.isArray(result.changes)) {\n      throw new Error(\'AI è¿”å›æ ¼å¼é”™è¯¯\');\n    }\n\n    // æ„å»ºå¯¹æ¯”æ•°æ®\n    aiChanges.value = result.changes;\n\n    progressDialogRef.value?.setProgress(95);\n    progressDialogRef.value?.setMessage(`æ­£åœ¨ç”Ÿæˆé¢„è§ˆ... (${changes.length} ä¸ªæ–‡ä»¶)`);\n\n    closeAIDialog();\n    showComparison.value = true;\n    previewMode.value = \'after\';\n\n    // å®Œæˆ\n    progressDialogRef.value?.setProgress(100);\n    progressDialogRef.value?.setMessage(\'âœ… AI ç”Ÿæˆå®Œæˆï¼\');\n\n    setTimeout(() => {\n      showProgress.value = false;\n      toastr.success(`âœ… AI ç”Ÿæˆå®Œæˆï¼å·²æ›´æ–° ${changes.length} ä¸ªæ–‡ä»¶`);\n    }, 800);\n  } catch (error: any) {\n    console.error(\'AI ç”Ÿæˆå¤±è´¥:\', error);\n    showProgress.value = false;\n\n    // æ£€æµ‹ CORS é”™è¯¯\n    const errorMessage = error.message || String(error);\n    if (\n      errorMessage.includes(\'CORS\') ||\n      errorMessage.includes(\'Failed to fetch\') ||\n      errorMessage.includes(\'Access-Control-Allow-Origin\')\n    ) {\n      toastr.error(\n        `âš ï¸ CORS é”™è¯¯ï¼šæ— æ³•è®¿é—® API\\n\\n` +\n          `åŸå› ï¼šAPI æœåŠ¡å™¨ï¼ˆ${new URL(normalizedEndpoint).origin}ï¼‰æœªé…ç½® CORS å¤´\\n\\n` +\n          `è§£å†³æ–¹æ¡ˆï¼š\\n` +\n          `1. åœ¨ API æœåŠ¡å™¨é…ç½® CORS\\n` +\n          `2. æˆ–ä½¿ç”¨æ”¯æŒ CORS çš„ API ç«¯ç‚¹\\n` +\n          `3. æˆ–é€šè¿‡é…’é¦†çš„ API ä»£ç†åŠŸèƒ½è°ƒç”¨`,\n      );\n    } else if (errorMessage.includes(\'307\') || errorMessage.includes(\'Temporary Redirect\')) {\n      toastr.error(\n        `âš ï¸ URL é‡å®šå‘é”™è¯¯\\n\\n` +\n          `ç«¯ç‚¹ï¼š${normalizedEndpoint}\\n\\n` +\n          `å¯èƒ½åŸå› ï¼šURL æ ¼å¼ä¸æ­£ç¡®\\n` +\n          `è¯·æ£€æŸ¥ç«¯ç‚¹è®¾ç½®ï¼Œç¡®ä¿æ ¼å¼ä¸ºï¼šhttps://æœåŠ¡å™¨/v1`,\n      );\n    } else {\n      toastr.error(`AI ç”Ÿæˆå¤±è´¥: ${errorMessage}`);\n    }\n  } finally {\n    aiGenerating.value = false;\n  }\n}\n\nfunction acceptChanges() {\n  const proj = currentProject.value;\n  if (!proj) return;\n\n  // ä¿å­˜åˆ°å†å²\n  const historyRecord: AIHistoryRecord = {\n    timestamp: new Date().toISOString(),\n    prompt: aiPrompt.value,\n    changes: aiChanges.value,\n  };\n\n  if (!aiHistory.value[currentId.value]) {\n    aiHistory.value[currentId.value] = [];\n  }\n  aiHistory.value[currentId.value].unshift(historyRecord);\n  console.log(\'æ·»åŠ  AI å†å²è®°å½•ï¼Œå½“å‰é¡¹ç›®å†å²æ•°:\', aiHistory.value[currentId.value].length);\n\n  // åº”ç”¨æ›´æ”¹\n  aiChanges.value.forEach(change => {\n    const file = proj.files.find(f => f.path === change.path);\n    if (file) {\n      file.content = change.newContent;\n    }\n  });\n\n  // ç«‹å³ä¿å­˜\n  saveToChatVar();\n  updatePreview();\n\n  // æ›´æ–°å½“å‰ç¼–è¾‘å™¨\n  if (currentFile.value) {\n    const file = proj.files.find(f => f.path === currentFile.value);\n    if (file) {\n      code.value = file.content;\n    }\n  }\n\n  showComparison.value = false;\n  aiChanges.value = [];\n  toastr.success(\'æ›´æ”¹å·²åº”ç”¨\');\n}\n\nfunction rejectChanges() {\n  showComparison.value = false;\n  aiChanges.value = [];\n  toastr.info(\'å·²æ‹’ç»æ›´æ”¹\');\n}\n\nfunction showHistoryDialog() {\n  showHistory.value = true;\n}\n\nfunction closeHistoryDialog() {\n  showHistory.value = false;\n}\n\nfunction restoreHistory(record: AIHistoryRecord) {\n  if (!confirm(`ç¡®å®šè¦æ¢å¤åˆ°è¿™ä¸ªå†å²ç‰ˆæœ¬å—ï¼Ÿ\\n\\n"${record.prompt}"\\n\\nå½“å‰çš„ä¿®æ”¹å°†è¢«è¦†ç›–ã€‚`)) {\n    return;\n  }\n\n  const proj = currentProject.value;\n  if (!proj) return;\n\n  // æ¢å¤æ–‡ä»¶å†…å®¹\n  record.changes.forEach(change => {\n    const file = proj.files.find(f => f.path === change.path);\n    if (file) {\n      file.content = change.newContent;\n    }\n  });\n\n  console.log(\'æ¢å¤å†å²ç‰ˆæœ¬:\', record.prompt);\n\n  // ç«‹å³ä¿å­˜\n  saveToChatVar();\n  updatePreview();\n\n  // æ›´æ–°å½“å‰ç¼–è¾‘å™¨\n  if (currentFile.value) {\n    const file = proj.files.find(f => f.path === currentFile.value);\n    if (file) {\n      code.value = file.content;\n    }\n  }\n\n  closeHistoryDialog();\n  toastr.success(\'å·²æ¢å¤åˆ°å†å²ç‰ˆæœ¬\');\n}\n\nfunction exportToRegex() {\n  const proj = currentProject.value;\n  if (!proj) {\n    toastr.error(\'è¯·å…ˆé€‰æ‹©ä¸€ä¸ªé¡¹ç›®\');\n    return;\n  }\n\n  // æé†’ç”¨æˆ·å…ˆæ‰‹åŠ¨ä¿å­˜\n  const fileObj = proj.files.find(f => f.name === currentFile.value);\n  if (fileObj && code.value !== fileObj.content) {\n    const shouldContinue = confirm(\'æ£€æµ‹åˆ°æœ‰æœªä¿å­˜çš„ä¿®æ”¹ï¼Œå»ºè®®å…ˆæ‰‹åŠ¨ä¿å­˜ã€‚\\n\\næ˜¯å¦ç»§ç»­å¯¼å‡ºï¼ˆå°†ä½¿ç”¨ä¸Šæ¬¡ä¿å­˜çš„ç‰ˆæœ¬ï¼‰ï¼Ÿ\');\n    if (!shouldContinue) {\n      return;\n    }\n  }\n\n  // å¼¹å‡ºå¯¹è¯æ¡†è®©ç”¨æˆ·è¾“å…¥è§¦å‘è¯\n  const triggerWord = prompt(\n    `æ­£åœ¨å¯¼å‡ºé¡¹ç›®ï¼š${proj.name}\\n\\nè¯·è¾“å…¥è§¦å‘è¯ï¼ˆæ­£åˆ™è¡¨è¾¾å¼ï¼‰ï¼š\\nä¾‹å¦‚ï¼šã€å¼€åœºç™½ã€‘ æˆ– /å¼€åœºç™½/g`,\n    `ã€${proj.name}ã€‘`,\n  );\n  if (!triggerWord) {\n    toastr.info(\'å·²å–æ¶ˆå¯¼å‡º\');\n    return;\n  }\n\n  try {\n    // æ„å»ºå®Œæ•´çš„ HTMLï¼ˆæ­¤æ—¶ proj.files å·²ç»æ˜¯æœ€æ–°çš„äº†ï¼Œå› ä¸ºä¸Šé¢è‡ªåŠ¨ä¿å­˜äº†ï¼‰\n    const fullHtml = buildPreviewFromFiles(proj.files);\n\n    // ç”Ÿæˆ UUID\n    const uuid = \'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx\'.replace(/[xy]/g, function (c) {\n      const r = (Math.random() * 16) | 0;\n      const v = c === \'x\' ? r : (r & 0x3) | 0x8;\n      return v.toString(16);\n    });\n\n    // æ„å»ºæ­£åˆ™ JSON\n    // 1. å»é™¤ Windows çš„ \\r\n    // 2. å»æ‰ <!DOCTYPE html>\\nï¼Œç›´æ¥ä» <html> å¼€å§‹\n    // 3. æ ¼å¼ï¼š```html\\n\\n<html>...</html>\\n```\n    let cleanHtml = fullHtml.replace(/\\r/g, \'\');\n    cleanHtml = cleanHtml.replace(/^<!DOCTYPE html>\\n/, \'\');\n\n    const regexJson = {\n      id: uuid,\n      scriptName: proj.name,\n      findRegex: triggerWord.startsWith(\'/\') ? triggerWord : `/${triggerWord}/g`,\n      replaceString: \'```html\\n\\n\' + cleanHtml + \'\\n```\',\n      trimStrings: [],\n      placement: [1, 2],\n      disabled: false,\n      markdownOnly: true,\n      promptOnly: false,\n      runOnEdit: true,\n      substituteRegex: 0,\n      minDepth: null,\n      maxDepth: null,\n    };\n\n    // åˆ›å»ºä¸‹è½½é“¾æ¥\n    const dataStr = JSON.stringify(regexJson, null, 4);\n    const dataBlob = new Blob([dataStr], { type: \'application/json\' });\n    const url = URL.createObjectURL(dataBlob);\n\n    const link = document.createElement(\'a\');\n    link.href = url;\n    link.download = `${proj.name}_regex.json`;\n    document.body.appendChild(link);\n    link.click();\n    document.body.removeChild(link);\n    URL.revokeObjectURL(url);\n\n    console.log(\'å¯¼å‡ºçš„æ­£åˆ™ JSON:\', regexJson);\n    toastr.success(`é¡¹ç›® "${proj.name}" å·²å¯¼å‡ºä¸ºæ­£åˆ™ JSON`);\n  } catch (error: any) {\n    console.error(\'å¯¼å‡ºå¤±è´¥:\', error);\n    toastr.error(`å¯¼å‡ºå¤±è´¥: ${error.message}`);\n  }\n}\n\nfunction openInNewWindow() {\n  if (!previewHtml.value) {\n    toastr.error(\'æ²¡æœ‰å¯é¢„è§ˆçš„å†…å®¹\');\n    return;\n  }\n\n  const proj = currentProject.value;\n  const windowTitle = proj ? proj.name : \'é¢„è§ˆ\';\n\n  // æ‰“å¼€æ–°çª—å£\n  const newWindow = window.open(\'\', \'_blank\', \'width=1200,height=800,menubar=no,toolbar=no,location=no,status=no\');\n\n  if (newWindow) {\n    newWindow.document.write(previewHtml.value);\n    newWindow.document.close();\n    newWindow.document.title = windowTitle;\n    toastr.success(\'å·²åœ¨æ–°çª—å£æ‰“å¼€é¢„è§ˆ\');\n  } else {\n    toastr.error(\'æ— æ³•æ‰“å¼€æ–°çª—å£ï¼Œè¯·æ£€æŸ¥æµè§ˆå™¨å¼¹çª—è®¾ç½®\');\n  }\n}\n<\/script>\n\n<style scoped>\n/* å…‰æ ‡é—ªçƒåŠ¨ç”» */\n@keyframes blink {\n  0%,\n  50% {\n    opacity: 1;\n  }\n  51%,\n  100% {\n    opacity: 0;\n  }\n}\n\n.project-tab {\n  padding: 25px !important;\n  background: #1a1a1a !important;\n}\n</style>\n'],sourceRoot:''}]);const i=s},937:(e,n,t)=>{async function a(e,n){try{if(window.parent&&window.parent.document)try{const t=window.parent.document.createElement('textarea');t.value=e,t.style.position='fixed',t.style.opacity='0',window.parent.document.body.appendChild(t),t.select();const a=window.parent.document.execCommand('copy');if(window.parent.document.body.removeChild(t),a)return n&&toastr.success(n),!0}catch(e){console.warn('çˆ¶çª—å£å¤åˆ¶å¤±è´¥ï¼Œå°è¯•å…¶ä»–æ–¹æ³•',e)}try{const t=document.createElement('textarea');t.value=e,t.style.position='fixed',t.style.opacity='0',document.body.appendChild(t),t.select();const a=document.execCommand('copy');if(document.body.removeChild(t),a)return n&&toastr.success(n),!0}catch(e){console.warn('å½“å‰çª—å£å¤åˆ¶å¤±è´¥ï¼Œå°è¯• Clipboard API',e)}if(navigator.clipboard&&navigator.clipboard.writeText)return await navigator.clipboard.writeText(e),n&&toastr.success(n),!0;throw new Error('æ‰€æœ‰å¤åˆ¶æ–¹æ³•éƒ½å¤±è´¥äº†')}catch(e){return console.error('å¤åˆ¶å¤±è´¥:',e),toastr.error('å¤åˆ¶å¤±è´¥ï¼Œè¯·æ‰‹åŠ¨å¤åˆ¶'),!1}}function o(){if(s)return s;try{const e=getScriptId();return e&&!s&&(s=e),e||'maomao_writing_tool_v1'}catch(e){return console.error('è·å–è„šæœ¬ ID å¤±è´¥:',e),'maomao_writing_tool_v1'}}function r(){try{return SillyTavern.getCurrentChatId()}catch(e){return console.error('è·å–èŠå¤© ID å¤±è´¥:',e),''}}t.d(n,{Ut:()=>o,aJ:()=>i,lW:()=>a,pA:()=>r});let s=null;function i(e){s=e}},954:(e,n,t)=>{var a=t(99);a.__esModule&&(a=a.default),'string'==typeof a&&(a=[[e.id,a,'']]),a.locals&&(e.exports=a.locals);(0,t(424).A)('6082e7c9',a,!1,{ssrId:!0})},957:(e,n,t)=>{t.r(n),t.d(n,{default:()=>i});var a=t(790),o=t.n(a),r=t(54),s=t.n(r)()(o());s.push([e.id,'.summary-tab[data-v-f8bd87fc]{height:100%;overflow-y:auto;padding:25px !important}.section-header[data-v-f8bd87fc]{display:flex;justify-content:space-between;align-items:center;padding:20px 25px !important;border-bottom:1px solid #3a3a3a;margin-bottom:5px}.section-header h3[data-v-f8bd87fc]{margin:0;color:#fff;font-size:15px !important;font-weight:bold;display:flex;align-items:center;gap:8px}.header-actions[data-v-f8bd87fc]{display:flex;align-items:center;gap:10px}.count-badge[data-v-f8bd87fc]{background:#4a9eff;color:white;padding:4px 8px;border-radius:12px;font-size:12px}.empty-state[data-v-f8bd87fc]{text-align:center;padding:40px 20px;color:#888}.empty-state i[data-v-f8bd87fc]{font-size:48px;margin-bottom:10px;opacity:0.3}.empty-state p[data-v-f8bd87fc]{margin:10px 0;font-size:14px}.empty-state small[data-v-f8bd87fc]{color:#666;font-size:12px}.history-list[data-v-f8bd87fc]{display:flex;flex-direction:column;gap:10px;padding:15px 20px}.history-item[data-v-f8bd87fc]{background:#2a2a2a;border:1px solid #3a3a3a;border-radius:6px;overflow:hidden;transition:border-color 0.2s}.history-item[data-v-f8bd87fc]:hover{border-color:#4a4a4a}.history-header[data-v-f8bd87fc]{padding:12px 15px;background:#1a1a1a;display:flex;justify-content:space-between;align-items:center;cursor:pointer;-webkit-user-select:none;user-select:none;transition:background 0.2s}.history-header[data-v-f8bd87fc]:hover{background:#2a2a2a}.history-info[data-v-f8bd87fc]{display:flex;align-items:center;gap:10px;flex:1}.history-number[data-v-f8bd87fc]{color:#4a9eff;font-weight:bold}.history-range[data-v-f8bd87fc]{color:#888;font-size:12px}.expand-icon[data-v-f8bd87fc]{color:#888;font-size:12px}.history-content[data-v-f8bd87fc]{padding:15px;background:#2a2a2a}.history-actions[data-v-f8bd87fc]{display:flex;gap:8px;margin-bottom:12px;padding-bottom:8px;border-bottom:1px solid #3a3a3a}.mini-button[data-v-f8bd87fc]{flex:1;padding:6px 12px;background:#2a2a2a;border:1px solid #3a3a3a;border-radius:4px;color:#e0e0e0;cursor:pointer;font-size:12px;transition:background 0.2s}.mini-button[data-v-f8bd87fc]:hover{background:#3a3a3a}.mini-button.delete-button[data-v-f8bd87fc]:hover{background:#ff4444;border-color:#ff4444;color:white}.mini-button.worldbook-button[data-v-f8bd87fc]{background:#28a745;color:white;border-color:#28a745}.mini-button.worldbook-button[data-v-f8bd87fc]:hover{background:#218838;border-color:#218838;color:white}.mini-button.create-worldbook-button[data-v-f8bd87fc]{background:#17a2b8;color:white;border-color:#17a2b8}.mini-button.create-worldbook-button[data-v-f8bd87fc]:hover{background:#138496;border-color:#138496;color:white}.mini-button.refresh-button[data-v-f8bd87fc]{background:#6c757d;color:white;border-color:#6c757d}.mini-button.refresh-button[data-v-f8bd87fc]:hover{background:#5a6268;border-color:#5a6268;color:white}.mini-button.debug-button[data-v-f8bd87fc]{background:#ffc107;color:#000;border-color:#ffb300}.mini-button.debug-button[data-v-f8bd87fc]:hover{background:#e0a800;border-color:#d39e00;color:#000}.history-text[data-v-f8bd87fc]{white-space:pre-wrap;word-wrap:break-word;line-height:1.6;max-height:400px;overflow-y:auto}\n','',{version:3,sources:['webpack://./src/è®°å¿†_with_worldbook/components/SummaryTab.vue'],names:[],mappings:'AAqlCA,8BACE,WAAY,CACZ,eAAgB,CAChB,uBACF,CAEA,iCACE,YAAa,CACb,6BAA8B,CAC9B,kBAAmB,CACnB,4BAA6B,CAC7B,+BAAgC,CAChC,iBACF,CAEA,oCACE,QAAS,CACT,UAAW,CACX,yBAA0B,CAC1B,gBAAiB,CACjB,YAAa,CACb,kBAAmB,CACnB,OACF,CAEA,iCACE,YAAa,CACb,kBAAmB,CACnB,QACF,CAEA,8BACE,kBAAmB,CACnB,WAAY,CACZ,eAAgB,CAChB,kBAAmB,CACnB,cACF,CAEA,8BACE,iBAAkB,CAClB,iBAAkB,CAClB,UACF,CAEA,gCACE,cAAe,CACf,kBAAmB,CACnB,WACF,CAEA,gCACE,aAAc,CACd,cACF,CAEA,oCACE,UAAW,CACX,cACF,CAEA,+BACE,YAAa,CACb,qBAAsB,CACtB,QAAS,CACT,iBACF,CAEA,+BACE,kBAAmB,CACnB,wBAAyB,CACzB,iBAAkB,CAClB,eAAgB,CAChB,4BACF,CAEA,qCACE,oBACF,CAEA,iCACE,iBAAkB,CAClB,kBAAmB,CACnB,YAAa,CACb,6BAA8B,CAC9B,kBAAmB,CACnB,cAAe,CACf,wBAAiB,CAAjB,gBAAiB,CACjB,0BACF,CAEA,uCACE,kBACF,CAEA,+BACE,YAAa,CACb,kBAAmB,CACnB,QAAS,CACT,MACF,CAEA,iCACE,aAAc,CACd,gBACF,CAEA,gCACE,UAAW,CACX,cACF,CAEA,8BACE,UAAW,CACX,cACF,CAEA,kCACE,YAAa,CACb,kBACF,CAEA,kCACE,YAAa,CACb,OAAQ,CACR,kBAAmB,CACnB,kBAAmB,CACnB,+BACF,CAEA,8BACE,MAAO,CACP,gBAAiB,CACjB,kBAAmB,CACnB,wBAAyB,CACzB,iBAAkB,CAClB,aAAc,CACd,cAAe,CACf,cAAe,CACf,0BACF,CAEA,oCACE,kBACF,CAEA,kDACE,kBAAmB,CACnB,oBAAqB,CACrB,WACF,CAEA,+CACE,kBAAmB,CACnB,WAAY,CACZ,oBACF,CAEA,qDACE,kBAAmB,CACnB,oBAAqB,CACrB,WACF,CAEA,sDACE,kBAAmB,CACnB,WAAY,CACZ,oBACF,CAEA,4DACE,kBAAmB,CACnB,oBAAqB,CACrB,WACF,CAEA,6CACE,kBAAmB,CACnB,WAAY,CACZ,oBACF,CAEA,mDACE,kBAAmB,CACnB,oBAAqB,CACrB,WACF,CAEA,2CACE,kBAAmB,CACnB,UAAW,CACX,oBACF,CAEA,iDACE,kBAAmB,CACnB,oBAAqB,CACrB,UACF,CAEA,+BACE,oBAAqB,CACrB,oBAAqB,CACrB,eAAgB,CAChB,gBAAiB,CACjB,eACF',sourcesContent:['<template>\n  <div class="summary-tab" style="padding: 25px !important; background: #1a1a1a !important">\n    <div\n      class="section-header"\n      style="\n        display: flex;\n        justify-content: space-between;\n        align-items: center;\n        padding: 20px 25px !important;\n        border-bottom: 1px solid #3a3a3a;\n        margin-bottom: 5px;\n      "\n    >\n      <h3\n        style="\n          margin: 0;\n          color: #fff;\n          font-size: 15px !important;\n          font-weight: bold;\n          display: flex;\n          align-items: center;\n          gap: 8px;\n        "\n      >\n        ğŸ“ å†å²æ€»ç»“è®°å½•\n      </h3>\n      <div class="header-actions" style="display: flex; align-items: center; gap: 10px">\n        <span\n          v-if="summary_history.length > 0"\n          class="count-badge"\n          style="background: #4a9eff; color: white; padding: 4px 8px; border-radius: 12px; font-size: 12px"\n          >{{ summary_history.length }} æ¡è®°å½•</span\n        >\n        <button\n          class="mini-button refresh-button"\n          style="\n            padding: 6px 12px;\n            background: #2a2a2a;\n            border: 1px solid #3a3a3a;\n            border-radius: 4px;\n            color: #e0e0e0;\n            cursor: pointer;\n            font-size: 12px;\n            transition: all 0.2s;\n            display: flex;\n            align-items: center;\n            gap: 6px;\n          "\n          @click="handleRefreshData"\n        >\n          <i class="fa-solid fa-refresh"></i> åˆ·æ–°æ•°æ®\n        </button>\n        <button\n          class="mini-button create-worldbook-button"\n          style="\n            padding: 6px 12px;\n            background: #51cf66;\n            border: 1px solid #40c057;\n            border-radius: 4px;\n            color: white;\n            cursor: pointer;\n            font-size: 12px;\n            transition: all 0.2s;\n            display: flex;\n            align-items: center;\n            gap: 6px;\n          "\n          @click="createSummaryWorldbook"\n        >\n          <i class="fa-solid fa-plus"></i> åˆ›å»ºæ€»ç»“ä¸–ç•Œä¹¦\n        </button>\n        <button\n          class="mini-button debug-button"\n          style="\n            padding: 6px 12px;\n            background: #ffc107;\n            border: 1px solid #ffb300;\n            border-radius: 4px;\n            color: #000;\n            cursor: pointer;\n            font-size: 12px;\n            transition: all 0.2s;\n            display: flex;\n            align-items: center;\n            gap: 6px;\n          "\n          @click="showDebugPanel"\n        >\n          <i class="fa-solid fa-bug"></i> è°ƒè¯•å·¥å…·\n        </button>\n      </div>\n    </div>\n\n    <div\n      v-if="summary_history && summary_history.length > 0"\n      class="history-list"\n      style="display: flex; flex-direction: column; gap: 15px; margin-top: 20px"\n    >\n      <div\n        v-for="(item, index) in summary_history"\n        :key="index"\n        class="history-item"\n        style="\n          background: #2a2a2a;\n          border: 1px solid #444;\n          border-radius: 8px;\n          padding: 15px;\n          transition: all 0.3s ease;\n        "\n      >\n        <div\n          class="history-header"\n          style="\n            padding: 12px 15px;\n            background: #1a1a1a;\n            display: flex;\n            justify-content: space-between;\n            align-items: center;\n            cursor: pointer;\n            user-select: none;\n            transition: background 0.2s;\n            border-radius: 6px;\n          "\n          @click="toggleExpanded(index)"\n        >\n          <div class="history-info" style="display: flex; align-items: center; gap: 10px; flex: 1">\n            <span class="history-number" style="color: #4a9eff; font-weight: bold">#{{ index + 1 }}</span>\n            <span class="history-range" style="color: #888; font-size: 12px"\n              >æ¥¼å±‚ {{ item.start_id }} - {{ item.end_id }}</span\n            >\n          </div>\n          <span class="expand-icon" style="color: #888; font-size: 12px">{{ isExpanded(index) ? \'â–¼\' : \'â–¶\' }}</span>\n        </div>\n        <div\n          v-if="isExpanded(index)"\n          class="history-content"\n          style="padding: 15px; background: #2a2a2a; border-radius: 0 0 6px 6px"\n        >\n          <div\n            class="history-actions"\n            style="display: flex; gap: 8px; margin-bottom: 12px; padding-bottom: 8px; border-bottom: 1px solid #3a3a3a"\n          >\n            <button\n              class="mini-button"\n              style="\n                flex: 1;\n                padding: 6px 12px;\n                background: #2a2a2a;\n                border: 1px solid #3a3a3a;\n                border-radius: 4px;\n                color: #e0e0e0;\n                cursor: pointer;\n                font-size: 12px;\n                transition: background 0.2s;\n                display: flex;\n                align-items: center;\n                justify-content: center;\n                gap: 6px;\n              "\n              @click="copySummary(item.content)"\n            >\n              <i class="fa-solid fa-copy"></i> å¤åˆ¶\n            </button>\n            <button\n              class="mini-button worldbook-button"\n              style="\n                flex: 1;\n                padding: 6px 12px;\n                background: #4a9eff;\n                border: 1px solid #5aaeff;\n                border-radius: 4px;\n                color: white;\n                cursor: pointer;\n                font-size: 12px;\n                transition: all 0.2s;\n                display: flex;\n                align-items: center;\n                justify-content: center;\n                gap: 6px;\n              "\n              @click="bindToWorldbook(item.content, index)"\n            >\n              <i class="fa-solid fa-book"></i> ç»‘å®šåˆ°ä¸–ç•Œä¹¦\n            </button>\n            <button\n              class="mini-button delete-button"\n              style="\n                flex: 1;\n                padding: 6px 12px;\n                background: #ff6b6b;\n                border: 1px solid #ff5252;\n                border-radius: 4px;\n                color: white;\n                cursor: pointer;\n                font-size: 12px;\n                transition: all 0.2s;\n                display: flex;\n                align-items: center;\n                justify-content: center;\n                gap: 6px;\n              "\n              @click="deleteSummary(index)"\n            >\n              <i class="fa-solid fa-trash"></i> åˆ é™¤\n            </button>\n          </div>\n          <div\n            class="history-text"\n            style="\n              font-family: \'Courier New\', monospace;\n              font-size: 13px;\n              line-height: 1.6;\n              color: #e0e0e0;\n              white-space: pre-wrap;\n              word-wrap: break-word;\n              user-select: text;\n              cursor: text;\n            "\n          >\n            {{ item.content }}\n          </div>\n        </div>\n      </div>\n    </div>\n    <div v-else class="empty-state" style="text-align: center; padding: 40px 20px; color: #888">\n      <i class="fa-solid fa-inbox" style="font-size: 48px; margin-bottom: 10px; opacity: 0.3"></i>\n      <p style="margin: 10px 0; font-size: 16px">è¿˜æ²¡æœ‰æ€»ç»“è®°å½•</p>\n      <small style="font-size: 12px; color: #666">ä½¿ç”¨"è®¾ç½®"æ ‡ç­¾é¡µæ‰‹åŠ¨åˆ›å»ºæ€»ç»“</small>\n    </div>\n  </div>\n</template>\n\n<script setup lang="ts">\nimport { ref } from \'vue\';\nimport { useSummaryHistoryStore } from \'../settings\';\nimport { getChatIdSafe } from \'../utils\';\n\nconst historyStore = useSummaryHistoryStore();\n\n// å“åº”å¼æ•°æ®\nconst summary_history = ref<Array<{ start_id: number; end_id: number; content: string }>>([]);\nconst expandedState = ref<Map<number, boolean>>(new Map());\n\n// æ›´æ–°æ€»ç»“å†å²çš„å‡½æ•°\nconst refreshSummaryHistory = () => {\n  try {\n    summary_history.value = historyStore.getSummaryHistory();\n    console.log(\'å·²åˆ·æ–°æ€»ç»“å†å²ï¼Œå½“å‰èŠå¤©è®°å½•æ•°:\', summary_history.value.length);\n  } catch (e) {\n    console.error(\'åˆ·æ–°æ€»ç»“å†å²å¤±è´¥:\', e);\n    summary_history.value = [];\n  }\n};\n\n// åˆ‡æ¢å±•å¼€çŠ¶æ€\nconst toggleExpanded = (index: number) => {\n  const current = expandedState.value.get(index) || false;\n  expandedState.value.set(index, !current);\n};\n\nconst isExpanded = (index: number) => {\n  return expandedState.value.get(index) || false;\n};\n\n// å¤„ç†åˆ·æ–°æ•°æ®æŒ‰é’®\nconst handleRefreshData = async () => {\n  console.log(\'åˆ·æ–°æ•°æ®æŒ‰é’®è¢«ç‚¹å‡»\');\n  try {\n    await refreshSummaryHistory();\n    window.toastr.success(\'æ•°æ®å·²åˆ·æ–°\');\n  } catch (error) {\n    console.error(\'åˆ·æ–°æ•°æ®å¤±è´¥:\', error);\n    window.toastr.error(\'åˆ·æ–°æ•°æ®å¤±è´¥: \' + (error as Error).message);\n  }\n};\n\n// ç»Ÿä¸€çš„å¤åˆ¶å‡½æ•° - é’ˆå¯¹iframeç¯å¢ƒä¼˜åŒ–\nconst copyToClipboard = async (text: string, successMessage: string = \'å†…å®¹å·²å¤åˆ¶åˆ°å‰ªè´´æ¿\') => {\n  console.log(\'å¼€å§‹å¤åˆ¶ï¼Œæ–‡æœ¬é•¿åº¦:\', text.length);\n\n  try {\n    // åœ¨iframeç¯å¢ƒä¸­ï¼Œä¼˜å…ˆå°è¯•åœ¨çˆ¶çª—å£ä¸­å¤åˆ¶\n    if (window.parent && window.parent !== window) {\n      console.log(\'æ£€æµ‹åˆ°iframeç¯å¢ƒï¼Œå°è¯•åœ¨çˆ¶çª—å£å¤åˆ¶\');\n      const parentSuccess = await tryParentWindowCopy(text);\n      if (parentSuccess) {\n        console.log(\'çˆ¶çª—å£å¤åˆ¶æˆåŠŸ\');\n        window.toastr.success(successMessage);\n        return;\n      }\n    }\n\n    // æ–¹æ³•1: å°è¯•ä½¿ç”¨ç°ä»£çš„ Clipboard APIï¼ˆä»…åœ¨å®‰å…¨ä¸Šä¸‹æ–‡ä¸­ï¼‰\n    if (navigator.clipboard && window.isSecureContext) {\n      console.log(\'ä½¿ç”¨ç°ä»£ Clipboard API\');\n      try {\n        await navigator.clipboard.writeText(text);\n        console.log(\'Clipboard API å¤åˆ¶æˆåŠŸ\');\n        window.toastr.success(successMessage);\n        return;\n      } catch (clipboardErr) {\n        console.warn(\'Clipboard API å¤±è´¥:\', clipboardErr);\n        // ç»§ç»­å°è¯•å…¶ä»–æ–¹æ³•\n      }\n    }\n\n    // æ–¹æ³•2: ä½¿ç”¨ä¼ ç»Ÿçš„ execCommand æ–¹æ³•\n    console.log(\'ä½¿ç”¨ execCommand æ–¹æ³•\');\n    const success = await execCommandCopy(text);\n    if (success) {\n      console.log(\'execCommand å¤åˆ¶æˆåŠŸ\');\n      window.toastr.success(successMessage);\n      return;\n    }\n\n    // æ–¹æ³•3: å¦‚æœéƒ½å¤±è´¥äº†ï¼Œæ˜¾ç¤ºæ–‡æœ¬æ¡†è®©ç”¨æˆ·æ‰‹åŠ¨å¤åˆ¶\n    console.log(\'æ‰€æœ‰è‡ªåŠ¨å¤åˆ¶æ–¹æ³•éƒ½å¤±è´¥ï¼Œæ˜¾ç¤ºæ‰‹åŠ¨å¤åˆ¶ç•Œé¢\');\n    showManualCopyDialog(text);\n  } catch (err) {\n    console.error(\'å¤åˆ¶å¼‚å¸¸:\', err);\n    // å‡ºé”™æ—¶ä¹Ÿæ˜¾ç¤ºæ‰‹åŠ¨å¤åˆ¶ç•Œé¢\n    showManualCopyDialog(text);\n  }\n};\n\n// åœ¨çˆ¶çª—å£ä¸­å°è¯•å¤åˆ¶\nconst tryParentWindowCopy = async (text: string): Promise<boolean> => {\n  return new Promise(resolve => {\n    try {\n      const parentDoc = window.parent.document;\n      const parentBody = window.parent.document.body;\n\n      // åˆ›å»ºä¸€ä¸ªä¸´æ—¶çš„ textarea å…ƒç´ åœ¨çˆ¶çª—å£ä¸­\n      const textarea = parentDoc.createElement(\'textarea\');\n      textarea.value = text;\n      textarea.style.cssText = `\n        position: fixed;\n        left: -9999px;\n        top: -9999px;\n        opacity: 0;\n        pointer-events: none;\n        z-index: -1000;\n      `;\n      textarea.setAttribute(\'readonly\', \'\');\n\n      parentBody.appendChild(textarea);\n\n      // é€‰ä¸­æ–‡æœ¬\n      textarea.focus();\n      textarea.select();\n      textarea.setSelectionRange(0, text.length);\n\n      // å°è¯•å¤åˆ¶\n      const success = parentDoc.execCommand(\'copy\');\n\n      // æ¸…ç†\n      parentBody.removeChild(textarea);\n\n      resolve(success);\n    } catch (err) {\n      console.error(\'çˆ¶çª—å£å¤åˆ¶å¤±è´¥:\', err);\n      resolve(false);\n    }\n  });\n};\n\n// execCommand å¤åˆ¶æ–¹æ³•\nconst execCommandCopy = async (text: string): Promise<boolean> => {\n  return new Promise(resolve => {\n    try {\n      // åˆ›å»ºä¸€ä¸ªä¸´æ—¶çš„ textarea å…ƒç´ \n      const textarea = document.createElement(\'textarea\');\n      textarea.value = text;\n      textarea.style.position = \'fixed\';\n      textarea.style.left = \'-9999px\';\n      textarea.style.top = \'-9999px\';\n      textarea.style.opacity = \'0\';\n      textarea.style.pointerEvents = \'none\';\n      textarea.setAttribute(\'readonly\', \'\');\n\n      document.body.appendChild(textarea);\n\n      // é€‰ä¸­æ–‡æœ¬\n      textarea.select();\n      textarea.setSelectionRange(0, text.length);\n\n      // å°è¯•å¤åˆ¶\n      const success = document.execCommand(\'copy\');\n\n      // æ¸…ç†\n      document.body.removeChild(textarea);\n\n      resolve(success);\n    } catch (err) {\n      console.error(\'execCommand å¤åˆ¶å¤±è´¥:\', err);\n      resolve(false);\n    }\n  });\n};\n\n// æ‰‹åŠ¨å¤åˆ¶å¯¹è¯æ¡† - æ›´å¯é çš„å®ç°\nconst showManualCopyDialog = (text: string) => {\n  console.log(\'æ˜¾ç¤ºæ‰‹åŠ¨å¤åˆ¶å¯¹è¯æ¡†ï¼Œæ–‡æœ¬é•¿åº¦:\', text.length);\n\n  try {\n    // ä½¿ç”¨çˆ¶çª—å£çš„documentæ¥åˆ›å»ºå…ƒç´ \n    const parentDoc = window.parent.document;\n    const parentBody = window.parent.document.body;\n\n    // ç§»é™¤å¯èƒ½å­˜åœ¨çš„æ—§å¯¹è¯æ¡†\n    const existingOverlay = parentDoc.getElementById(\'manual-copy-overlay\');\n    if (existingOverlay) {\n      parentBody.removeChild(existingOverlay);\n    }\n\n    // åˆ›å»ºé®ç½©å±‚\n    const overlay = parentDoc.createElement(\'div\');\n    overlay.id = \'manual-copy-overlay\';\n    overlay.style.cssText = `\n      position: fixed;\n      top: 0;\n      left: 0;\n      right: 0;\n      bottom: 0;\n      background: rgba(0, 0, 0, 0.95);\n      z-index: 999999;\n      display: flex;\n      align-items: center;\n      justify-content: center;\n      font-family: -apple-system, BlinkMacSystemFont, \'Segoe UI\', Roboto, sans-serif;\n    `;\n\n    // åˆ›å»ºä¸»å®¹å™¨\n    const container = parentDoc.createElement(\'div\');\n    container.style.cssText = `\n      background: #2a2a2a;\n      border: 2px solid #4a9eff;\n      border-radius: 12px;\n      padding: 25px;\n      max-width: 900px;\n      width: 95%;\n      max-height: 85vh;\n      display: flex;\n      flex-direction: column;\n      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);\n    `;\n\n    // åˆ›å»ºæ ‡é¢˜\n    const header = parentDoc.createElement(\'div\');\n    header.innerHTML = `\n      <h3 style="margin: 0 0 15px 0; color: #4a9eff; text-align: center; font-size: 18px; font-weight: 600;">\n        ğŸ“‹ æ‰‹åŠ¨å¤åˆ¶æ€»ç»“å†…å®¹\n      </h3>\n      <div style="background: #1a1a1a; border: 1px solid #444; border-radius: 6px; padding: 12px; margin-bottom: 15px;">\n        <p style="margin: 0 0 8px 0; color: #e0e0e0; font-size: 14px;">\n          <strong>æ“ä½œæ­¥éª¤ï¼š</strong>\n        </p>\n        <ol style="margin: 0; padding-left: 20px; color: #ccc; font-size: 13px; line-height: 1.6;">\n          <li>ç‚¹å‡»ä¸‹æ–¹æ–‡æœ¬æ¡†</li>\n          <li>æŒ‰ <kbd style="background: #444; padding: 2px 6px; border-radius: 3px; color: #fff;">Ctrl+A</kbd> å…¨é€‰æ–‡æœ¬</li>\n          <li>æŒ‰ <kbd style="background: #444; padding: 2px 6px; border-radius: 3px; color: #fff;">Ctrl+C</kbd> å¤åˆ¶åˆ°å‰ªè´´æ¿</li>\n          <li>ç‚¹å‡»"å…³é—­"æŒ‰é’®æˆ–æŒ‰ <kbd style="background: #444; padding: 2px 6px; border-radius: 3px; color: #fff;">Esc</kbd> å…³é—­å¯¹è¯æ¡†</li>\n        </ol>\n      </div>\n    `;\n\n    // åˆ›å»ºæ–‡æœ¬æ¡†\n    const textarea = parentDoc.createElement(\'textarea\');\n    textarea.value = text;\n    textarea.style.cssText = `\n      width: 100%;\n      height: 400px;\n      background: #1a1a1a;\n      border: 2px solid #444;\n      border-radius: 6px;\n      padding: 15px;\n      color: #e0e0e0;\n      font-family: \'Courier New\', \'Consolas\', monospace;\n      font-size: 13px;\n      line-height: 1.5;\n      resize: vertical;\n      white-space: pre-wrap;\n      word-wrap: break-word;\n      outline: none;\n      margin-bottom: 20px;\n      box-sizing: border-box;\n    `;\n\n    // åˆ›å»ºæŒ‰é’®å®¹å™¨\n    const buttonContainer = parentDoc.createElement(\'div\');\n    buttonContainer.style.cssText = `\n      display: flex;\n      gap: 12px;\n      justify-content: center;\n      align-items: center;\n    `;\n\n    // åˆ›å»ºå…³é—­æŒ‰é’®\n    const closeButton = parentDoc.createElement(\'button\');\n    closeButton.textContent = \'å…³é—­\';\n    closeButton.style.cssText = `\n      background: #4a9eff;\n      color: white;\n      border: none;\n      padding: 12px 24px;\n      border-radius: 6px;\n      cursor: pointer;\n      font-size: 14px;\n      font-weight: 500;\n      transition: background 0.2s;\n    `;\n    closeButton.onmouseover = () => {\n      closeButton.style.background = \'#5ba8ff\';\n    };\n    closeButton.onmouseout = () => {\n      closeButton.style.background = \'#4a9eff\';\n    };\n\n    // åˆ›å»ºå¤åˆ¶æŒ‰é’®ï¼ˆå¤‡ç”¨ï¼‰\n    const copyButton = parentDoc.createElement(\'button\');\n    copyButton.textContent = \'å°è¯•è‡ªåŠ¨å¤åˆ¶\';\n    copyButton.style.cssText = `\n      background: #28a745;\n      color: white;\n      border: none;\n      padding: 12px 24px;\n      border-radius: 6px;\n      cursor: pointer;\n      font-size: 14px;\n      font-weight: 500;\n      transition: background 0.2s;\n    `;\n    copyButton.onmouseover = () => {\n      copyButton.style.background = \'#218838\';\n    };\n    copyButton.onmouseout = () => {\n      copyButton.style.background = \'#28a745\';\n    };\n\n    // ç»„è£…å…ƒç´ \n    buttonContainer.appendChild(copyButton);\n    buttonContainer.appendChild(closeButton);\n\n    container.appendChild(header);\n    container.appendChild(textarea);\n    container.appendChild(buttonContainer);\n    overlay.appendChild(container);\n\n    // æ·»åŠ åˆ°é¡µé¢\n    parentBody.appendChild(overlay);\n\n    // äº‹ä»¶å¤„ç†\n    closeButton.onclick = () => {\n      console.log(\'å…³é—­æŒ‰é’®è¢«ç‚¹å‡»\');\n      parentBody.removeChild(overlay);\n    };\n\n    copyButton.onclick = async () => {\n      console.log(\'å°è¯•è‡ªåŠ¨å¤åˆ¶æŒ‰é’®è¢«ç‚¹å‡»\');\n      try {\n        // é€‰ä¸­æ–‡æœ¬\n        textarea.focus();\n        textarea.select();\n\n        // å°è¯•å¤åˆ¶\n        const success = document.execCommand(\'copy\');\n        if (success) {\n          window.toastr.success(\'è‡ªåŠ¨å¤åˆ¶æˆåŠŸï¼\');\n          parentBody.removeChild(overlay);\n        } else {\n          window.toastr.warning(\'è‡ªåŠ¨å¤åˆ¶å¤±è´¥ï¼Œè¯·æ‰‹åŠ¨å¤åˆ¶\');\n        }\n      } catch (err) {\n        console.error(\'è‡ªåŠ¨å¤åˆ¶å¤±è´¥:\', err);\n        window.toastr.warning(\'è‡ªåŠ¨å¤åˆ¶å¤±è´¥ï¼Œè¯·æ‰‹åŠ¨å¤åˆ¶\');\n      }\n    };\n\n    // ç‚¹å‡»èƒŒæ™¯å…³é—­\n    overlay.onclick = e => {\n      if (e.target === overlay) {\n        console.log(\'ç‚¹å‡»èƒŒæ™¯å…³é—­\');\n        parentBody.removeChild(overlay);\n      }\n    };\n\n    // é”®ç›˜äº‹ä»¶å¤„ç†\n    const handleKeyDown = (e: KeyboardEvent) => {\n      if (e.key === \'Escape\') {\n        console.log(\'æŒ‰ESCé”®å…³é—­\');\n        parentBody.removeChild(overlay);\n        parentDoc.removeEventListener(\'keydown\', handleKeyDown);\n      }\n    };\n    parentDoc.addEventListener(\'keydown\', handleKeyDown);\n\n    // è‡ªåŠ¨é€‰ä¸­æ–‡æœ¬\n    setTimeout(() => {\n      console.log(\'è‡ªåŠ¨é€‰ä¸­æ–‡æœ¬\');\n      textarea.focus();\n      textarea.select();\n    }, 200);\n\n    // æ˜¾ç¤ºæˆåŠŸæ¶ˆæ¯\n    window.toastr.info(\'æ‰‹åŠ¨å¤åˆ¶å¯¹è¯æ¡†å·²æ‰“å¼€ï¼Œè¯·æŒ‰ç…§æç¤ºæ“ä½œ\');\n  } catch (err) {\n    console.error(\'åˆ›å»ºæ‰‹åŠ¨å¤åˆ¶å¯¹è¯æ¡†å¤±è´¥:\', err);\n    window.toastr.error(\'æ— æ³•æ˜¾ç¤ºå¤åˆ¶å¯¹è¯æ¡†ï¼Œè¯·æ£€æŸ¥æµè§ˆå™¨æƒé™\');\n  }\n};\n\n// å¤åˆ¶æ€»ç»“ - ä½¿ç”¨ç»Ÿä¸€çš„å¤åˆ¶å‡½æ•°\nconst copySummary = (content: string) => {\n  copyToClipboard(content, \'æ€»ç»“å·²å¤åˆ¶åˆ°å‰ªè´´æ¿\');\n};\n\n// åˆ é™¤æ€»ç»“\nconst deleteSummary = (index: number) => {\n  if (confirm(\'ç¡®å®šè¦åˆ é™¤è¿™æ¡æ€»ç»“å—ï¼Ÿ\')) {\n    try {\n      const chat_id = getChatIdSafe();\n      if (!chat_id) {\n        window.toastr.error(\'æ— æ³•è·å–å½“å‰èŠå¤©ä¿¡æ¯\');\n        return;\n      }\n\n      summary_history.value.splice(index, 1);\n      insertOrAssignVariables({ summary_history: summary_history.value }, { type: \'chat\' });\n      window.toastr.success(\'æ€»ç»“å·²åˆ é™¤\');\n    } catch (error) {\n      console.error(\'åˆ é™¤æ€»ç»“å¤±è´¥:\', error);\n      window.toastr.error(\'åˆ é™¤æ€»ç»“å¤±è´¥\');\n    }\n  }\n};\n\n// åˆ›å»ºæ€»ç»“ä¸–ç•Œä¹¦\nconst createSummaryWorldbook = async () => {\n  try {\n    // è·å–å½“å‰è§’è‰²å¡ä¿¡æ¯\n    let characterName = \'æœªçŸ¥è§’è‰²\';\n    try {\n      const currentCharacter = getCharData(\'current\');\n      if (currentCharacter && currentCharacter.name) {\n        characterName = currentCharacter.name;\n        // æ¸…ç†è§’è‰²åä¸­çš„ç‰¹æ®Šå­—ç¬¦ï¼Œé¿å…æ–‡ä»¶åé—®é¢˜\n        characterName = characterName.replace(/[<>:"/\\\\|?*]/g, \'_\').trim();\n      }\n    } catch (charError) {\n      console.warn(\'è·å–è§’è‰²ä¿¡æ¯å¤±è´¥:\', charError);\n    }\n\n    // ç”ŸæˆåŒ…å«è§’è‰²åå’Œæ—¥æœŸçš„ä¸–ç•Œä¹¦åç§°\n    const dateStr = new Date().toISOString().slice(0, 10);\n    const worldbookName = `æ€»ç»“_${characterName}_${dateStr}`;\n\n    console.log(\'å‡†å¤‡åˆ›å»ºä¸–ç•Œä¹¦:\', worldbookName);\n\n    const existingWorldbooks = getWorldbookNames();\n    if (existingWorldbooks.includes(worldbookName)) {\n      window.toastr.warning(`ä¸–ç•Œä¹¦ "${worldbookName}" å·²å­˜åœ¨`);\n      return;\n    }\n\n    await createWorldbook(worldbookName, []);\n\n    try {\n      await rebindChatWorldbook(\'current\', worldbookName);\n      window.toastr.success(`å·²åˆ›å»ºæ€»ç»“ä¸–ç•Œä¹¦ "${worldbookName}" å¹¶ç»‘å®šåˆ°å½“å‰èŠå¤©`);\n    } catch (bindError) {\n      console.warn(\'ç»‘å®šåˆ°èŠå¤©å¤±è´¥:\', bindError);\n      window.toastr.success(`å·²åˆ›å»ºæ€»ç»“ä¸–ç•Œä¹¦ "${worldbookName}"ï¼Œè¯·æ‰‹åŠ¨åœ¨èŠå¤©çŸ¥è¯†ä¹¦ä¸­ç»‘å®š`);\n    }\n  } catch (error) {\n    console.error(\'åˆ›å»ºæ€»ç»“ä¸–ç•Œä¹¦å¤±è´¥:\', error);\n    window.toastr.error(\'åˆ›å»ºæ€»ç»“ä¸–ç•Œä¹¦å¤±è´¥: \' + (error as Error).message);\n  }\n};\n\n// ç»‘å®šæ€»ç»“åˆ°ä¸–ç•Œä¹¦\nconst bindToWorldbook = async (content: string, summaryIndex: number) => {\n  try {\n    const worldbookNames = getWorldbookNames();\n    if (worldbookNames.length === 0) {\n      window.toastr.warning(\'æ²¡æœ‰å¯ç”¨çš„ä¸–ç•Œä¹¦ï¼Œè¯·å…ˆåˆ›å»ºæ€»ç»“ä¸–ç•Œä¹¦\');\n      return;\n    }\n\n    const selectedWorldbook =\n      worldbookNames.length === 1 ? worldbookNames[0] : await promptForWorldbook(worldbookNames);\n    if (!selectedWorldbook) {\n      return;\n    }\n\n    const entryName = `æ€»ç»“_${summaryIndex + 1}_${new Date().toLocaleDateString()}`;\n    const newEntry = {\n      name: entryName,\n      enabled: true,\n      strategy: {\n        type: \'constant\' as const,\n        keys: [],\n        keys_secondary: { logic: \'and_any\' as const, keys: [] },\n        scan_depth: \'same_as_global\' as const,\n      },\n      position: {\n        type: \'before_character_definition\' as const,\n        role: \'system\' as const,\n        depth: 1,\n      },\n      content: content,\n      comment: `è‡ªåŠ¨ç”Ÿæˆçš„æ€»ç»“æ¡ç›® - æ¥¼å±‚èŒƒå›´: ${summary_history.value[summaryIndex]?.start_id || \'?\'} - ${summary_history.value[summaryIndex]?.end_id || \'?\'}`,\n      insertion_order: 0,\n      case_sensitive: false,\n      name_is_regex: false,\n      keys_are_regex: false,\n      selective_logic: \'and\',\n      secondary_keys_logic: \'and\',\n      activation_threshold: 0,\n      disabled: false,\n      order: 0,\n      group: \'\',\n      local_id: 0,\n      depth_entries: [],\n      depth_entries_all: false,\n      search_range: 0,\n      force_activation: false,\n      disable: false,\n      exclude_recursion: false,\n      hidden: false,\n      priority: 0,\n      comment_is_regex: false,\n      content_is_regex: false,\n      secondary_keys_are_regex: false,\n      keys_secondary_are_regex: false,\n      uid: Date.now(),\n    };\n\n    await createWorldbookEntries(selectedWorldbook, [newEntry]);\n    window.toastr.success(`æ€»ç»“å·²ç»‘å®šåˆ°ä¸–ç•Œä¹¦: ${selectedWorldbook}`);\n  } catch (error) {\n    console.error(\'ç»‘å®šåˆ°ä¸–ç•Œä¹¦å¤±è´¥:\', error);\n    window.toastr.error(\'ç»‘å®šåˆ°ä¸–ç•Œä¹¦å¤±è´¥: \' + (error as Error).message);\n  }\n};\n\n// è®©ç”¨æˆ·é€‰æ‹©ä¸–ç•Œä¹¦çš„è¾…åŠ©å‡½æ•°\nconst promptForWorldbook = async (worldbookNames: string[]): Promise<string | null> => {\n  return new Promise<string | null>(resolve => {\n    const dialog = $(`\n      <div style="\n        position: fixed;\n        top: 50%;\n        left: 50%;\n        transform: translate(-50%, -50%);\n        background: #2a2a2a;\n        border: 1px solid #3a3a3a;\n        border-radius: 8px;\n        padding: 20px;\n        z-index: 1000000;\n        min-width: 300px;\n      ">\n        <h3 style="margin: 0 0 15px 0; color: #e0e0e0;">é€‰æ‹©ä¸–ç•Œä¹¦</h3>\n        <div style="margin-bottom: 15px;">\n          ${worldbookNames\n            .map(\n              name => `\n            <label style="display: block; margin: 5px 0; color: #e0e0e0;">\n              <input type="radio" name="worldbook" value="${name}" style="margin-right: 8px;">\n              ${name}\n            </label>\n          `,\n            )\n            .join(\'\')}\n        </div>\n        <div style="text-align: right;">\n          <button id="cancelWorldbook" style="\n            background: #666;\n            color: white;\n            border: none;\n            padding: 8px 16px;\n            border-radius: 4px;\n            margin-right: 10px;\n            cursor: pointer;\n          ">å–æ¶ˆ</button>\n          <button id="confirmWorldbook" style="\n            background: #4a9eff;\n            color: white;\n            border: none;\n            padding: 8px 16px;\n            border-radius: 4px;\n            cursor: pointer;\n          ">ç¡®å®š</button>\n        </div>\n      </div>\n    `);\n\n    const overlay = $(`\n      <div style="\n        position: fixed;\n        top: 0;\n        left: 0;\n        width: 100%;\n        height: 100%;\n        background: rgba(0, 0, 0, 0.5);\n        z-index: 999999;\n      "></div>\n    `);\n\n    $(\'body\').append(overlay).append(dialog);\n\n    $(\'#cancelWorldbook\').on(\'click\', () => {\n      overlay.remove();\n      dialog.remove();\n      resolve(null);\n    });\n\n    $(\'#confirmWorldbook\').on(\'click\', () => {\n      const selected = $(\'input[name="worldbook"]:checked\').val() as string;\n      overlay.remove();\n      dialog.remove();\n      resolve(selected || null);\n    });\n\n    $(\'input[name="worldbook"]:first\').prop(\'checked\', true);\n  });\n};\n\n// æ˜¾ç¤ºè°ƒè¯•é¢æ¿\nconst showDebugPanel = () => {\n  try {\n    // ä½¿ç”¨çˆ¶çª—å£çš„documentæ¥åˆ›å»ºå…ƒç´ \n    const parentDoc = window.parent.document;\n    const parentBody = window.parent.document.body;\n\n    // ç§»é™¤å¯èƒ½å­˜åœ¨çš„æ—§å¯¹è¯æ¡†\n    const existingOverlay = parentDoc.getElementById(\'debug-panel-overlay\');\n    if (existingOverlay) {\n      parentBody.removeChild(existingOverlay);\n    }\n\n    // åˆ›å»ºé®ç½©å±‚\n    const overlay = parentDoc.createElement(\'div\');\n    overlay.id = \'debug-panel-overlay\';\n    overlay.style.cssText = `\n      position: fixed;\n      top: 0;\n      left: 0;\n      right: 0;\n      bottom: 0;\n      background: rgba(0, 0, 0, 0.95);\n      z-index: 999999;\n      display: flex;\n      align-items: center;\n      justify-content: center;\n      font-family: -apple-system, BlinkMacSystemFont, \'Segoe UI\', Roboto, sans-serif;\n    `;\n\n    // åˆ›å»ºä¸»å®¹å™¨\n    const container = parentDoc.createElement(\'div\');\n    container.style.cssText = `\n      background: #2a2a2a;\n      border: 2px solid #ffc107;\n      border-radius: 12px;\n      padding: 25px;\n      max-width: 800px;\n      width: 95%;\n      max-height: 85vh;\n      display: flex;\n      flex-direction: column;\n      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);\n    `;\n\n    // åˆ›å»ºæ ‡é¢˜\n    const header = parentDoc.createElement(\'div\');\n    header.innerHTML = `\n      <h3 style="margin: 0 0 15px 0; color: #ffc107; text-align: center; font-size: 18px; font-weight: 600;">\n        ğŸ› è‡ªåŠ¨æ€»ç»“è°ƒè¯•å·¥å…·\n      </h3>\n      <div style="background: #1a1a1a; border: 1px solid #444; border-radius: 6px; padding: 12px; margin-bottom: 15px;">\n        <p style="margin: 0 0 8px 0; color: #e0e0e0; font-size: 14px;">\n          <strong>è°ƒè¯•åŠŸèƒ½ï¼š</strong>\n        </p>\n        <ul style="margin: 0; padding-left: 20px; color: #ccc; font-size: 13px; line-height: 1.6;">\n          <li>æµ‹è¯•è‡ªåŠ¨æ€»ç»“æµç¨‹</li>\n          <li>åŒæ­¥localStorageæ•°æ®åˆ°é…’é¦†åŠ©æ‰‹å˜é‡</li>\n          <li>æ£€æŸ¥å½“å‰æ¥¼å±‚çŠ¶æ€</li>\n          <li>éªŒè¯è§¦å‘æ¡ä»¶è®¡ç®—</li>\n        </ul>\n      </div>\n    `;\n\n    // åˆ›å»ºæŒ‰é’®å®¹å™¨\n    const buttonContainer = parentDoc.createElement(\'div\');\n    buttonContainer.style.cssText = `\n      display: grid;\n      grid-template-columns: 1fr 1fr;\n      gap: 12px;\n      margin-bottom: 20px;\n    `;\n\n    // åˆ›å»ºæŒ‰é’®\n    const buttons = [\n      { id: \'testComplete\', text: \'ğŸ§ª æµ‹è¯•å®Œæ•´æµç¨‹\', color: \'#4a9eff\' },\n      { id: \'syncData\', text: \'ğŸ”„ åŒæ­¥æ•°æ®\', color: \'#28a745\' },\n      { id: \'checkFloor\', text: \'ğŸ” æ£€æŸ¥æ¥¼å±‚\', color: \'#17a2b8\' },\n      { id: \'testCalculation\', text: \'ğŸ§® éªŒè¯è®¡ç®—\', color: \'#6f42c1\' },\n      { id: \'showStatus\', text: \'ğŸ“Š æ˜¾ç¤ºçŠ¶æ€\', color: \'#fd7e14\' },\n      { id: \'resetStartId\', text: \'ğŸ”„ é‡ç½®èµ·å§‹æ¥¼å±‚\', color: \'#dc3545\' },\n    ];\n\n    buttons.forEach(button => {\n      const btn = parentDoc.createElement(\'button\');\n      btn.id = button.id;\n      btn.textContent = button.text;\n      btn.style.cssText = `\n        background: ${button.color};\n        color: white;\n        border: none;\n        padding: 12px 16px;\n        border-radius: 6px;\n        cursor: pointer;\n        font-size: 13px;\n        font-weight: 500;\n        transition: background 0.2s;\n      `;\n      btn.onmouseover = () => {\n        btn.style.opacity = \'0.8\';\n      };\n      btn.onmouseout = () => {\n        btn.style.opacity = \'1\';\n      };\n      buttonContainer.appendChild(btn);\n    });\n\n    // åˆ›å»ºè¾“å‡ºåŒºåŸŸ\n    const outputArea = parentDoc.createElement(\'div\');\n    outputArea.id = \'debug-output\';\n    outputArea.style.cssText = `\n      background: #1a1a1a;\n      border: 1px solid #444;\n      border-radius: 6px;\n      padding: 15px;\n      height: 200px;\n      overflow-y: auto;\n      font-family: \'Courier New\', \'Consolas\', monospace;\n      font-size: 12px;\n      color: #e0e0e0;\n      white-space: pre-wrap;\n      margin-bottom: 20px;\n    `;\n    outputArea.textContent = \'ç‚¹å‡»ä¸Šæ–¹æŒ‰é’®å¼€å§‹è°ƒè¯•...\\n\';\n\n    // åˆ›å»ºå…³é—­æŒ‰é’®\n    const closeButton = parentDoc.createElement(\'button\');\n    closeButton.textContent = \'å…³é—­\';\n    closeButton.style.cssText = `\n      background: #6c757d;\n      color: white;\n      border: none;\n      padding: 12px 24px;\n      border-radius: 6px;\n      cursor: pointer;\n      font-size: 14px;\n      font-weight: 500;\n      transition: background 0.2s;\n      align-self: center;\n    `;\n\n    // ç»„è£…å…ƒç´ \n    container.appendChild(header);\n    container.appendChild(buttonContainer);\n    container.appendChild(outputArea);\n    container.appendChild(closeButton);\n\n    overlay.appendChild(container);\n    parentBody.appendChild(overlay);\n\n    // æ·»åŠ æ—¥å¿—å‡½æ•°\n    const log = (message: string) => {\n      const output = parentDoc.getElementById(\'debug-output\');\n      if (output) {\n        output.textContent += message + \'\\n\';\n        output.scrollTop = output.scrollHeight;\n      }\n    };\n\n    // äº‹ä»¶å¤„ç†\n    closeButton.onclick = () => {\n      parentBody.removeChild(overlay);\n    };\n\n    // æµ‹è¯•å®Œæ•´æµç¨‹\n    parentDoc.getElementById(\'testComplete\')?.addEventListener(\'click\', () => {\n      log(\'ğŸ§ª å¼€å§‹æµ‹è¯•å®Œæ•´è‡ªåŠ¨æ€»ç»“æµç¨‹...\');\n      try {\n        if ((window as any).testCompleteAutoSummary) {\n          (window as any).testCompleteAutoSummary();\n          log(\'âœ… æµ‹è¯•å‡½æ•°å·²æ‰§è¡Œï¼Œè¯·æŸ¥çœ‹æ§åˆ¶å°è¾“å‡º\');\n        } else {\n          log(\'âŒ æµ‹è¯•å‡½æ•°ä¸å¯ç”¨\');\n        }\n      } catch (error) {\n        log(\'âŒ æµ‹è¯•å¤±è´¥: \' + (error as Error).message);\n      }\n    });\n\n    // åŒæ­¥æ•°æ®\n    parentDoc.getElementById(\'syncData\')?.addEventListener(\'click\', () => {\n      log(\'ğŸ”„ å¼€å§‹åŒæ­¥æ•°æ®...\');\n      try {\n        if ((window as any).syncAutoSummaryData) {\n          (window as any).syncAutoSummaryData();\n          log(\'âœ… åŒæ­¥å‡½æ•°å·²æ‰§è¡Œï¼Œè¯·æŸ¥çœ‹æ§åˆ¶å°è¾“å‡º\');\n        } else {\n          log(\'âŒ åŒæ­¥å‡½æ•°ä¸å¯ç”¨\');\n        }\n      } catch (error) {\n        log(\'âŒ åŒæ­¥å¤±è´¥: \' + (error as Error).message);\n      }\n    });\n\n    // æ£€æŸ¥æ¥¼å±‚\n    parentDoc.getElementById(\'checkFloor\')?.addEventListener(\'click\', () => {\n      log(\'ğŸ” å¼€å§‹æ£€æŸ¥æ¥¼å±‚...\');\n      try {\n        if ((window as any).checkCurrentFloor) {\n          (window as any).checkCurrentFloor();\n          log(\'âœ… æ¥¼å±‚æ£€æŸ¥å‡½æ•°å·²æ‰§è¡Œï¼Œè¯·æŸ¥çœ‹æ§åˆ¶å°è¾“å‡º\');\n        } else {\n          log(\'âŒ æ¥¼å±‚æ£€æŸ¥å‡½æ•°ä¸å¯ç”¨\');\n        }\n      } catch (error) {\n        log(\'âŒ æ¥¼å±‚æ£€æŸ¥å¤±è´¥: \' + (error as Error).message);\n      }\n    });\n\n    // éªŒè¯è®¡ç®—\n    parentDoc.getElementById(\'testCalculation\')?.addEventListener(\'click\', () => {\n      log(\'ğŸ§® å¼€å§‹éªŒè¯è®¡ç®—...\');\n      try {\n        if ((window as any).testFloorCalculation) {\n          (window as any).testFloorCalculation();\n          log(\'âœ… è®¡ç®—éªŒè¯å‡½æ•°å·²æ‰§è¡Œï¼Œè¯·æŸ¥çœ‹æ§åˆ¶å°è¾“å‡º\');\n        } else {\n          log(\'âŒ è®¡ç®—éªŒè¯å‡½æ•°ä¸å¯ç”¨\');\n        }\n      } catch (error) {\n        log(\'âŒ è®¡ç®—éªŒè¯å¤±è´¥: \' + (error as Error).message);\n      }\n    });\n\n    // æ˜¾ç¤ºçŠ¶æ€\n    parentDoc.getElementById(\'showStatus\')?.addEventListener(\'click\', () => {\n      log(\'ğŸ“Š å¼€å§‹æ˜¾ç¤ºçŠ¶æ€...\');\n      try {\n        if ((window as any).checkAutoSummaryStatus) {\n          (window as any).checkAutoSummaryStatus();\n          log(\'âœ… çŠ¶æ€æ£€æŸ¥å‡½æ•°å·²æ‰§è¡Œï¼Œè¯·æŸ¥çœ‹æ§åˆ¶å°è¾“å‡º\');\n        } else {\n          log(\'âŒ çŠ¶æ€æ£€æŸ¥å‡½æ•°ä¸å¯ç”¨\');\n        }\n      } catch (error) {\n        log(\'âŒ çŠ¶æ€æ£€æŸ¥å¤±è´¥: \' + (error as Error).message);\n      }\n    });\n\n    // é‡ç½®èµ·å§‹æ¥¼å±‚\n    parentDoc.getElementById(\'resetStartId\')?.addEventListener(\'click\', () => {\n      log(\'ğŸ”„ å¼€å§‹é‡ç½®èµ·å§‹æ¥¼å±‚...\');\n      try {\n        if ((window as any).smartResetChat) {\n          (window as any).smartResetChat();\n          log(\'âœ… é‡ç½®å‡½æ•°å·²æ‰§è¡Œï¼Œè¯·æŸ¥çœ‹æ§åˆ¶å°è¾“å‡º\');\n        } else {\n          log(\'âŒ é‡ç½®å‡½æ•°ä¸å¯ç”¨\');\n        }\n      } catch (error) {\n        log(\'âŒ é‡ç½®å¤±è´¥: \' + (error as Error).message);\n      }\n    });\n\n    // ç‚¹å‡»èƒŒæ™¯å…³é—­\n    overlay.onclick = e => {\n      if (e.target === overlay) {\n        parentBody.removeChild(overlay);\n      }\n    };\n\n    // é”®ç›˜äº‹ä»¶å¤„ç†\n    const handleKeyDown = (e: KeyboardEvent) => {\n      if (e.key === \'Escape\') {\n        parentBody.removeChild(overlay);\n        parentDoc.removeEventListener(\'keydown\', handleKeyDown);\n      }\n    };\n    parentDoc.addEventListener(\'keydown\', handleKeyDown);\n\n    window.toastr?.info(\'è°ƒè¯•é¢æ¿å·²æ‰“å¼€\');\n  } catch (err) {\n    console.error(\'åˆ›å»ºè°ƒè¯•é¢æ¿å¤±è´¥:\', err);\n    window.toastr?.error(\'æ— æ³•æ˜¾ç¤ºè°ƒè¯•é¢æ¿ï¼Œè¯·æ£€æŸ¥æµè§ˆå™¨æƒé™\');\n  }\n};\n\n// åˆå§‹åŒ–\nrefreshSummaryHistory();\n<\/script>\n\n<style scoped>\n.summary-tab {\n  height: 100%;\n  overflow-y: auto;\n  padding: 25px !important;\n}\n\n.section-header {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  padding: 20px 25px !important;\n  border-bottom: 1px solid #3a3a3a;\n  margin-bottom: 5px;\n}\n\n.section-header h3 {\n  margin: 0;\n  color: #fff;\n  font-size: 15px !important;\n  font-weight: bold;\n  display: flex;\n  align-items: center;\n  gap: 8px;\n}\n\n.header-actions {\n  display: flex;\n  align-items: center;\n  gap: 10px;\n}\n\n.count-badge {\n  background: #4a9eff;\n  color: white;\n  padding: 4px 8px;\n  border-radius: 12px;\n  font-size: 12px;\n}\n\n.empty-state {\n  text-align: center;\n  padding: 40px 20px;\n  color: #888;\n}\n\n.empty-state i {\n  font-size: 48px;\n  margin-bottom: 10px;\n  opacity: 0.3;\n}\n\n.empty-state p {\n  margin: 10px 0;\n  font-size: 14px;\n}\n\n.empty-state small {\n  color: #666;\n  font-size: 12px;\n}\n\n.history-list {\n  display: flex;\n  flex-direction: column;\n  gap: 10px;\n  padding: 15px 20px;\n}\n\n.history-item {\n  background: #2a2a2a;\n  border: 1px solid #3a3a3a;\n  border-radius: 6px;\n  overflow: hidden;\n  transition: border-color 0.2s;\n}\n\n.history-item:hover {\n  border-color: #4a4a4a;\n}\n\n.history-header {\n  padding: 12px 15px;\n  background: #1a1a1a;\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  cursor: pointer;\n  user-select: none;\n  transition: background 0.2s;\n}\n\n.history-header:hover {\n  background: #2a2a2a;\n}\n\n.history-info {\n  display: flex;\n  align-items: center;\n  gap: 10px;\n  flex: 1;\n}\n\n.history-number {\n  color: #4a9eff;\n  font-weight: bold;\n}\n\n.history-range {\n  color: #888;\n  font-size: 12px;\n}\n\n.expand-icon {\n  color: #888;\n  font-size: 12px;\n}\n\n.history-content {\n  padding: 15px;\n  background: #2a2a2a;\n}\n\n.history-actions {\n  display: flex;\n  gap: 8px;\n  margin-bottom: 12px;\n  padding-bottom: 8px;\n  border-bottom: 1px solid #3a3a3a;\n}\n\n.mini-button {\n  flex: 1;\n  padding: 6px 12px;\n  background: #2a2a2a;\n  border: 1px solid #3a3a3a;\n  border-radius: 4px;\n  color: #e0e0e0;\n  cursor: pointer;\n  font-size: 12px;\n  transition: background 0.2s;\n}\n\n.mini-button:hover {\n  background: #3a3a3a;\n}\n\n.mini-button.delete-button:hover {\n  background: #ff4444;\n  border-color: #ff4444;\n  color: white;\n}\n\n.mini-button.worldbook-button {\n  background: #28a745;\n  color: white;\n  border-color: #28a745;\n}\n\n.mini-button.worldbook-button:hover {\n  background: #218838;\n  border-color: #218838;\n  color: white;\n}\n\n.mini-button.create-worldbook-button {\n  background: #17a2b8;\n  color: white;\n  border-color: #17a2b8;\n}\n\n.mini-button.create-worldbook-button:hover {\n  background: #138496;\n  border-color: #138496;\n  color: white;\n}\n\n.mini-button.refresh-button {\n  background: #6c757d;\n  color: white;\n  border-color: #6c757d;\n}\n\n.mini-button.refresh-button:hover {\n  background: #5a6268;\n  border-color: #5a6268;\n  color: white;\n}\n\n.mini-button.debug-button {\n  background: #ffc107;\n  color: #000;\n  border-color: #ffb300;\n}\n\n.mini-button.debug-button:hover {\n  background: #e0a800;\n  border-color: #d39e00;\n  color: #000;\n}\n\n.history-text {\n  white-space: pre-wrap;\n  word-wrap: break-word;\n  line-height: 1.6;\n  max-height: 400px;\n  overflow-y: auto;\n}\n</style>\n'],sourceRoot:''}]);const i=s}},r={};function s(e){var n=r[e];if(void 0!==n)return n.exports;var t=r[e]={id:e,exports:{}};return o[e](t,t.exports,s),t.exports}s.n=e=>{var n=e&&e.__esModule?()=>e.default:()=>e;return s.d(n,{a:n}),n},s.d=(e,n)=>{for(var t in n)s.o(n,t)&&!s.o(e,t)&&Object.defineProperty(e,t,{enumerable:!0,get:n[t]})},s.o=(e,n)=>Object.prototype.hasOwnProperty.call(e,n),s.r=e=>{'undefined'!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:'Module'}),Object.defineProperty(e,'__esModule',{value:!0})};var i=s(61),l=s(507),d=s(937),c=s(472),p=s(35);const g=t({legacy:!1,locale:localStorage.getItem('maomao_tool_locale')||'zh-CN',fallbackLocale:'zh-CN',messages:{'zh-CN':{common:{save:'ä¿å­˜',cancel:'å–æ¶ˆ',confirm:'ç¡®è®¤',delete:'åˆ é™¤',edit:'ç¼–è¾‘',add:'æ·»åŠ ',refresh:'åˆ·æ–°',search:'æœç´¢',loading:'åŠ è½½ä¸­...',success:'æˆåŠŸ',error:'é”™è¯¯',warning:'è­¦å‘Š',clear:'æ¸…ç©º',export:'å¯¼å‡º',import:'å¯¼å…¥',copy:'å¤åˆ¶',paste:'ç²˜è´´',generate:'ç”Ÿæˆ',preview:'é¢„è§ˆ'},panel:{title:'mzrodyuçŒ«çŒ«çš„å°ç ´çƒ‚',minimize:'æœ€å°åŒ–'},tabs:{settings:'è®¾ç½®',history:'å†å²æ€»è½¬',table:'è¡¨æ ¼',greetings:'å¼€åœºç™½',regex:'ç•Œé¢ç”Ÿæˆå™¨',state:'çŠ¶æ€æ ç”Ÿæˆ',projects:'å‰ç«¯é¡¹ç›®',tools:'å·¥å…·æ¨¡æ¿',mvu:'MVU Beta',help:'å¸®åŠ©'},settings:{title:'API é…ç½®',provider:'API æä¾›å•†',endpoint:'API ç«¯ç‚¹',endpointPlaceholder:'https://ä½ çš„æœåŠ¡å™¨/v1',endpointHelp:'å¸¸è§æ ¼å¼ç¤ºä¾‹',apiKey:'API Key',apiKeyPlaceholder:'sk-...',model:'æ¨¡å‹åç§°',modelPlaceholder:'ä¸è¾“å…¥ä¼šä½¿ç”¨åç§°ï¼ˆå¦‚ gpt-4o-miniï¼‰',fetchModels:'æ‹‰å–æ¨¡å‹åˆ—è¡¨',saveConfig:'ä¿å­˜é…ç½®',maxTokens:'æœ€å¤§ Token æ•°',maxTokensHelp:'å»ºè®®4000ä»¥ä¸Šè·å¾—æ›´è¯¦ç»†çš„æ€»ç»“',temperature:'Temperature (æ¸©åº¦)',temperatureHelp:'æ¨è 0.7',hiddenFloors:'éšè—æ¥¼å±‚ç®¡ç†',hiddenFloorsDesc:'åœ¨æ€»ç»“æ—¶éšè—æŒ‡å®šæ¥¼å±‚çš„æ¶ˆæ¯ï¼ˆä¾‹å¦‚çŠ¶æ€æ ã€æˆ˜æ–—ä¿¡æ¯ç­‰ï¼‰',addFloor:'æ·»åŠ éšè—æ¥¼å±‚',floorIndex:'æ¥¼å±‚ç´¢å¼•',floorIndexPlaceholder:'ä¾‹å¦‚ï¼š0, 1, 2',removeFloor:'ç§»é™¤',columnTemplates:'åˆ—å¤´æ¨¡æ¿ç®¡ç†',columnTemplatesDesc:'ç”¨äºè¡¨æ ¼åŠŸèƒ½çš„åˆ—å¤´æ¨¡æ¿',templateName:'æ¨¡æ¿åç§°',templateNamePlaceholder:'ä¾‹å¦‚ï¼šè§’è‰²å¡æ¨¡æ¿',templateContent:'æ¨¡æ¿å†…å®¹',templateContentPlaceholder:'ä¾‹å¦‚ï¼šå§“å|å¹´é¾„|æ€§åˆ«',addTemplate:'æ·»åŠ æ¨¡æ¿',deleteTemplate:'åˆ é™¤æ¨¡æ¿',autoSummary:'è‡ªåŠ¨æ€»ç»“é…ç½®',enableAutoSummary:'å¯ç”¨è‡ªåŠ¨æ€»ç»“',summaryInterval:'æ€»ç»“é—´éš”ï¼ˆæ¥¼å±‚æ•°ï¼‰',summaryIntervalPlaceholder:'ä¾‹å¦‚ï¼š20',summaryIntervalHelp:'æ¯éš”å¤šå°‘æ¥¼å±‚è‡ªåŠ¨ç”Ÿæˆä¸€æ¬¡æ€»ç»“',currentStatus:'å½“å‰æ€»ç»“çŠ¶æ€',chatId:'èŠå¤©ID',lastSummaryFloor:'ä¸Šæ¬¡æ€»ç»“æ¥¼å±‚',nextSummaryFloor:'ä¸‹æ¬¡æ€»ç»“æ¥¼å±‚',resetStatus:'é‡ç½®æ€»ç»“çŠ¶æ€',manualSummary:'æ‰‹åŠ¨è§¦å‘æ€»ç»“',configSaved:'é…ç½®å·²ä¿å­˜',apiConfigSaved:'API é…ç½®å·²ä¿å­˜',fetchError:'æ‹‰å–æ¨¡å‹åˆ—è¡¨å¤±è´¥'},greetings:{title:'å¼€åœºç™½ç®¡ç†',character:'å½“å‰è§’è‰²å¡',noCharacter:'æœªæ‰¾åˆ°è§’è‰²å¡',clearConfig:'æ¸…ç©ºé…ç½®',clearConfigConfirm:'ç¡®å®šè¦æ¸…ç©ºæ‰€æœ‰å¼€åœºç™½çš„é…ç½®å—ï¼Ÿ',clearSuccess:'é…ç½®å·²æ¸…ç©º',help:'ä½¿ç”¨å¸®åŠ©',greetingBadge:'å¼€åœºç™½',default:'é»˜è®¤',icon:'å›¾æ ‡',iconPlaceholder:'emoji æˆ–å›¾ç‰‡URL',greetingTitle:'æ ‡é¢˜',titlePlaceholder:'å¼€åœºç™½æ ‡é¢˜',description:'æè¿°',descriptionPlaceholder:'å¼€åœºç™½æè¿°',generateWithAI:'AIç”Ÿæˆ',generating:'ç”Ÿæˆä¸­...',stylePrompt:'ç•Œé¢é£æ ¼ç”Ÿæˆ',stylePromptPlaceholder:'æè¿°ä½ æƒ³è¦çš„ç•Œé¢é£æ ¼ï¼Œä¾‹å¦‚ï¼šèµ›åšæœ‹å…‹é£æ ¼ï¼Œéœ“è™¹ç¯æ•ˆæœï¼Œæš—è‰²è°ƒ',generateStyle:'AIç”Ÿæˆç•Œé¢æ ·å¼',generatingStyle:'ç”Ÿæˆä¸­...',copyCode:'å¤åˆ¶ä»£ç ',copySuccess:'ä»£ç å·²å¤åˆ¶åˆ°å‰ªè´´æ¿',apiFailed:'APIè°ƒç”¨å¤±è´¥',styleGenerated:'ç•Œé¢æ ·å¼ç”ŸæˆæˆåŠŸ',descGenerated:'æè¿°ç”ŸæˆæˆåŠŸ',htmlCode:'ç”Ÿæˆçš„HTMLä»£ç ',regexConfig:'æ­£åˆ™é…ç½®ï¼ˆJSONï¼‰'},regex:{title:'UI ç”Ÿæˆå™¨',help:'ä½¿ç”¨å¸®åŠ©',triggerText:'è§¦å‘æ–‡æœ¬',triggerTextPlaceholder:'ä¾‹å¦‚ï¼š#çŠ¶æ€æ ',uiDescription:'UI æè¿°',uiDescriptionPlaceholder:'è¯¦ç»†æè¿°ä½ æƒ³è¦çš„ç•Œé¢æ•ˆæœï¼Œä¾‹å¦‚ï¼šæ¸¸æˆé£æ ¼çš„çŠ¶æ€æ ï¼Œæ˜¾ç¤ºç”Ÿå‘½å€¼ã€é­”æ³•å€¼ã€ç»éªŒå€¼ï¼Œä½¿ç”¨è¿›åº¦æ¡å±•ç¤º',generateUI:'ç”Ÿæˆ UI',generating:'ç”Ÿæˆä¸­...',preview:'é¢„è§ˆ',htmlCode:'ç”Ÿæˆçš„HTMLä»£ç ',regexConfig:'æ­£åˆ™é…ç½®ï¼ˆJSONï¼‰',copyCode:'å¤åˆ¶ä»£ç ',copySuccess:'ä»£ç å·²å¤åˆ¶',apiFailed:'APIè°ƒç”¨å¤±è´¥',generated:'UIç”ŸæˆæˆåŠŸ'},table:{title:'è¡¨æ ¼ç®¡ç†',help:'ä½¿ç”¨å¸®åŠ©',selectTemplate:'é€‰æ‹©åˆ—å¤´æ¨¡æ¿',noTemplate:'æ— æ¨¡æ¿',floorNumber:'æ¥¼å±‚å·',floorNumberPlaceholder:'ä¾‹å¦‚ï¼š1',generateTable:'ç”Ÿæˆè¡¨æ ¼',updateTable:'æ›´æ–°è¡¨æ ¼',deleteTable:'åˆ é™¤è¡¨æ ¼',clearHistory:'æ¸…ç©ºå†å²',tableHistory:'è¡¨æ ¼å†å²',noHistory:'æš‚æ— è¡¨æ ¼å†å²'},history:{title:'å†å²æ€»ç»“',help:'ä½¿ç”¨å¸®åŠ©',floorRange:'æ¥¼å±‚èŒƒå›´',startFloor:'èµ·å§‹æ¥¼å±‚',endFloor:'ç»“æŸæ¥¼å±‚',generate:'ç”Ÿæˆæ€»ç»“',generating:'ç”Ÿæˆä¸­...',summary:'æ€»ç»“å†…å®¹',copyToClipboard:'å¤åˆ¶åˆ°å‰ªè´´æ¿',insertToChat:'æ’å…¥åˆ°èŠå¤©',noSummary:'æš‚æ— æ€»ç»“'},projects:{title:'å‰ç«¯é¡¹ç›®ç®¡ç†',help:'ä½¿ç”¨å¸®åŠ©',createProject:'åˆ›å»ºæ–°é¡¹ç›®',importProject:'å¯¼å…¥é¡¹ç›®',projectName:'é¡¹ç›®åç§°',projectList:'é¡¹ç›®åˆ—è¡¨',noProjects:'æš‚æ— é¡¹ç›®',openEditor:'æ‰“å¼€ç¼–è¾‘å™¨',deleteProject:'åˆ é™¤é¡¹ç›®',exportProject:'å¯¼å‡ºé¡¹ç›®'},tools:{title:'å·¥å…·æ¨¡æ¿',help:'ä½¿ç”¨å¸®åŠ©'},mvu:{title:'MVU Beta',help:'ä½¿ç”¨å¸®åŠ©'},helpPage:{version:'ç‰ˆæœ¬',checkUpdate:'æ£€æŸ¥æ›´æ–°',downloadLatest:'ä¸‹è½½æœ€æ–°ç‰ˆæœ¬',copyright:'ç‰ˆæƒå£°æ˜',copyrightContent:{line1:'ğŸ“Œ æœ¬è„šæœ¬ä»…å‘å¸ƒåœ¨ç±»è„‘/æ—…ç¨‹',line2:'ğŸš« ç¦æ­¢äºŒä¼ ',line3:'âš ï¸ äºŒæ”¹éœ€è¦è·å¾—ä½œè€…å…è®¸',line4:'âŒ å•†ä¸šåŒ–ç»å¯¹ç¦æ­¢'},usageGuide:'ä½¿ç”¨è¯´æ˜',features:{title:'ğŸ“‹ åŠŸèƒ½ç®€ä»‹',summary:'<strong>æ€»ç»“ï¼š</strong>è‡ªåŠ¨/æ‰‹åŠ¨æ€»ç»“å¯¹è¯ï¼Œå­˜å…¥ä¸–ç•Œä¹¦',cardAssist:'<strong>å†™å¡è¾…åŠ©ï¼š</strong>ç”Ÿæˆè§’è‰²å¡ã€ä¸–ç•Œä¹¦æ¡ç›®ï¼Œæ”¯æŒæµå¼ä¼ è¾“å’Œ AI ä¿®æ”¹',statusBar:'<strong>çŠ¶æ€æ ç”Ÿæˆï¼š</strong>å¯è§†åŒ–é…ç½®çŠ¶æ€æ ï¼Œç”Ÿæˆæ­£åˆ™ JSON å’Œä¸–ç•Œä¹¦æ¡ç›®',mvu:'<strong>MVU Betaï¼š</strong>ç”Ÿæˆå˜é‡ç»“æ„ã€æç¤ºè¯æ¨¡æ¿ã€$meta é…ç½®',others:'<strong>å…¶ä»–ï¼š</strong>å»å…«è‚¡ã€æ­£åˆ™ç•Œé¢ç”Ÿæˆã€å‰ç«¯é¡¹ç›®ç®¡ç†ã€è¡¨æ ¼ç”Ÿæˆ'},usage:{title:'ğŸ’¡ ä½¿ç”¨æ–¹æ³•',apiConfig:'âš ï¸ API é…ç½®',apiFormats:'<strong>æ”¯æŒçš„æ ¼å¼ï¼š</strong>',apiFormat1:'<code>https://api.openai.com</code> â†’ è‡ªåŠ¨è¡¥å…¨ä¸º <code>/v1</code>',apiFormat2:'<code>https://api.openai.com/v1</code> â†’ ç›´æ¥ä½¿ç”¨',apiFormat3:'<code>https://your-proxy.com/v1/chat/completions</code> â†’ ç›´æ¥ä½¿ç”¨',apiExample:'<strong>OpenAI å®˜æ–¹ç¤ºä¾‹ï¼š</strong>',import:'<strong>å¯¼å…¥ï¼š</strong>é…’é¦†åŠ©æ‰‹ â†’ è„šæœ¬åº“ â†’ å¯¼å…¥ â†’ å…¨å±€è„šæœ¬',firstUse:'<strong>é¦–æ¬¡ä½¿ç”¨ï¼š</strong>å…ˆå»"è®¾ç½®"é¡µé…ç½® API',autoSummary:'<strong>è‡ªåŠ¨æ€»ç»“ï¼š</strong>å»ºè®®å¼€å¯ï¼Œæ¯ 20-30 æ¥¼è‡ªåŠ¨ç”Ÿæˆä¸€æ¬¡'},changelog:'æ›´æ–°æ—¥å¿—',updates:{v134:{date:'2025å¹´11æœˆ7æ—¥',features:['ğŸŒ æ–°å¢ï¼šå¤šè¯­è¨€æ”¯æŒï¼ˆä¸­æ–‡/è‹±æ–‡åˆ‡æ¢ï¼‰','ğŸ› ä¿®å¤ï¼švue-i18n åˆå§‹åŒ–é”™è¯¯','ğŸ“± ä¼˜åŒ–ï¼šç§»åŠ¨ç«¯å®Œæ•´å“åº”å¼é€‚é…','ğŸ”§ ä¼˜åŒ–ï¼šä½¿ç”¨ testingcf.jsdelivr.net åŠ é€Ÿè®¿é—®']},v133:{date:'2025å¹´11æœˆ5æ—¥',title:'ğŸ¨ å¼€åœºç™½ç®¡ç†å™¨',features:['æ–°å¢ï¼šå¼€åœºç™½ç¾åŒ–é€‰æ‹©å™¨å·¥å…·','è‡ªåŠ¨è¯»å–è§’è‰²å¡çš„æ‰€æœ‰å¼€åœºç™½','ä¸ºæ¯ä¸ªå¼€åœºç™½é…ç½®ç¾åŒ–æ ·å¼ï¼ˆå›¾æ ‡ã€æ ‡é¢˜ã€æè¿°ï¼‰','AI ç”Ÿæˆæè¿°ï¼šæ ¹æ®å¼€åœºç™½åŸæ–‡å†…å®¹è‡ªåŠ¨ç”Ÿæˆå¸å¼•äººçš„æè¿°','AI ç¼–è¾‘æè¿°ï¼šæ ¹æ®éœ€æ±‚å¿«é€Ÿä¿®æ”¹æè¿°','â­ AI ç”Ÿæˆç•Œé¢æ ·å¼ï¼šç›´æ¥å‘Šè¯‰AIä½ æƒ³è¦ä»€ä¹ˆé£æ ¼ï¼Œè‡ªåŠ¨ç”Ÿæˆå®Œæ•´HTMLç•Œé¢','å®æ—¶é¢„è§ˆç”Ÿæˆçš„ç¾åŒ–ç•Œé¢æ ·å¼æ•ˆæœ','ä¸€é”®å¯¼å‡ºä¸º STScript JSON æ ¼å¼','é…ç½®è‡ªåŠ¨ä¿å­˜åˆ°è§’è‰²å¡å˜é‡']},v132:{date:'2025å¹´11æœˆ2æ—¥',optimize:'ğŸ”§ ä¼˜åŒ–',optimizeFeatures:['æœ€å°åŒ–å›¾æ ‡æ”¯æŒæ‹–åŠ¨ï¼Œå¯éšæ„è°ƒæ•´ä½ç½®']},v131:{date:'2025å¹´10æœˆ30æ—¥',newFeatures:'âœ¨ æ–°åŠŸèƒ½',newFeaturesList:['åŒå±‚å¯¹è¯ï¼šAI å›å¤ç›´æ¥æ˜¾ç¤ºåœ¨é¢æ¿å†…ï¼Œæ”¯æŒæµå¼ä¼ è¾“å’Œæ­£åˆ™è¿‡æ»¤','çŠ¶æ€æ ç”Ÿæˆå™¨æ–°å¢ AI è§£æ XML å’Œè‡ªç„¶è¯­è¨€ç”Ÿæˆå­—æ®µåŠŸèƒ½'],optimize:'ğŸ”§ ä¼˜åŒ–',optimizeFeatures:['å®Œæ•´çš„ç§»åŠ¨ç«¯é€‚é…ï¼šå“åº”å¼å¸ƒå±€ã€æ ‡ç­¾æ æ»šåŠ¨ã€æ»‘åŠ¨åˆ‡æ¢','æ‰€æœ‰ AI åŠŸèƒ½ç»Ÿä¸€ä½¿ç”¨è®¾ç½®é¡µçš„ API é…ç½®']},v130:{date:'2025å¹´10æœˆ26æ—¥',newFeatures:'âœ¨ æ–°åŠŸèƒ½',newFeaturesList:['æ–°å¢ MVU Beta æ ‡ç­¾é¡µï¼šå˜é‡ç»“æ„ã€æç¤ºè¯æ¨¡æ¿ã€$meta é…ç½®ç”Ÿæˆ','æ–°å¢çŠ¶æ€æ ç”Ÿæˆå™¨ï¼šå¯è§†åŒ–é…ç½®çŠ¶æ€æ ï¼Œç”Ÿæˆæ­£åˆ™ JSON å’Œä¸–ç•Œä¹¦æ¡ç›®','çŠ¶æ€æ ç”Ÿæˆå™¨æ”¯æŒ ABO æ¨¡æ¿å¿«é€ŸåŠ è½½'],optimize:'ğŸ”§ ä¼˜åŒ–',optimizeFeatures:['æ‰€æœ‰ AI å·¥å…·ç»Ÿä¸€ä»è®¾ç½®é¡µè¯»å– max_tokens å’Œ temperature','MVU Beta å’ŒçŠ¶æ€æ ç”Ÿæˆå™¨æ”¯æŒæ•°æ®æŒä¹…åŒ–']},v129:{date:'2025å¹´10æœˆ25æ—¥',newFeatures:'âœ¨ æ–°åŠŸèƒ½',newFeaturesList:['æ–°å¢çŠ¶æ€æ ç”Ÿæˆå™¨']},v128:{date:'2025å¹´10æœˆ24æ—¥',majorUpdate:'ğŸ‰ é‡å¤§æ›´æ–°',majorUpdateList:['å‰ç«¯é¡¹ç›®ç®¡ç†å™¨ AI é¢„è§ˆåŠŸèƒ½ï¼šç”Ÿæˆä»£ç åå…ˆé¢„è§ˆå¯¹æ¯”ï¼Œç¡®è®¤åå†åº”ç”¨','ä¿®æ”¹å†å²è®°å½•å’Œç‰ˆæœ¬å›æ»šï¼šæœ€å¤šä¿ç•™ 50 æ¡å†å²ï¼Œå¯æ¢å¤åˆ°ä»»æ„ç‰ˆæœ¬','åå…«è‚¡å·¥å…·ä¼˜åŒ–ï¼šé€‚åº¦æ¸…ç†ï¼Œä¿æŒåŸæ–‡ä¿¡æ¯é‡å’Œé•¿åº¦']},v127:{date:'2025å¹´10æœˆ23æ—¥',newFeatures:'âœ¨ æ–°åŠŸèƒ½',newFeaturesList:['æµå¼ä¼ è¾“æ”¯æŒï¼šæ‰€æœ‰ AI ç”Ÿæˆå·¥å…·æ”¯æŒå®æ—¶æŸ¥çœ‹ç”Ÿæˆè¿›åº¦','æ­£åˆ™ç•Œé¢ç”Ÿæˆå™¨ï¼šç”¨è‡ªç„¶è¯­è¨€ç”Ÿæˆé…’é¦†å‰ç«¯ç•Œé¢ä»£ç ','ä¸–ç•Œä¹¦æ¡ç›®æŸ¥çœ‹å™¨å’Œ AI ä¿®æ”¹åŠŸèƒ½']},v126:{date:'2025å¹´10æœˆ22æ—¥',newFeatures:'âœ¨ æ–°åŠŸèƒ½',newFeaturesList:['å‰ç«¯é¡¹ç›®ç®¡ç†å™¨ï¼šå®Œæ•´å‰ç«¯ç³»ç»Ÿç¼–å†™ï¼Œæ”¯æŒå¤šæ–‡ä»¶ã€å¤šæ¨¡å—ã€AI ç»­å†™','å®æ—¶é¢„è§ˆã€é¡¹ç›®æ¨¡æ¿ã€é¡¹ç›®æŒä¹…åŒ–']},v125:{date:'2025å¹´10æœˆ21æ—¥',newFeatures:'âœ¨ æ–°åŠŸèƒ½',newFeaturesList:['æ‰¹é‡ä¿®æ”¹ä¸–ç•Œä¹¦æ¡ç›®ã€åå…«è‚¡å†å²è®°å½•ã€å¸®åŠ©é¡µé¢']},v100:{date:'2025å¹´10æœˆ20æ—¥',features:['ğŸ‰ åˆå§‹ç‰ˆæœ¬å‘å¸ƒ','æ”¯æŒè‡ªåŠ¨/æ‰‹åŠ¨æ€»ç»“ã€è¡¨æ ¼ç”Ÿæˆã€åå…«è‚¡ã€ä¸–ç•Œä¹¦æ¡ç›®ç®¡ç†ã€æ¥¼å±‚éšè—/æ˜¾ç¤º']}},about:'å…³äº',madeWith:'Made with',by:'by',basedOn:'åŸºäº',and:'å’Œ'}},'en-US':{common:{save:'Save',cancel:'Cancel',confirm:'Confirm',delete:'Delete',edit:'Edit',add:'Add',refresh:'Refresh',search:'Search',loading:'Loading...',success:'Success',error:'Error',warning:'Warning',clear:'Clear',export:'Export',import:'Import',copy:'Copy',paste:'Paste',generate:'Generate',preview:'Preview'},panel:{title:'mzrodyu\'s Tool',minimize:'Minimize'},tabs:{settings:'Settings',history:'History Summary',table:'Table',greetings:'Greetings',regex:'UI Generator',state:'State Bar',projects:'Projects',tools:'Tools',mvu:'MVU Beta',help:'Help'},settings:{title:'API Configuration',provider:'API Provider',endpoint:'API Endpoint',endpointPlaceholder:'https://your-server/v1',endpointHelp:'Common formats',apiKey:'API Key',apiKeyPlaceholder:'sk-...',model:'Model Name',modelPlaceholder:'Leave empty to use name (e.g., gpt-4o-mini)',fetchModels:'Fetch Models',saveConfig:'Save Config',maxTokens:'Max Tokens',maxTokensHelp:'Recommend 4000+ for detailed summaries',temperature:'Temperature',temperatureHelp:'Recommended: 0.7',hiddenFloors:'Hidden Floors',hiddenFloorsDesc:'Hide specified message floors in summaries (e.g., status bars, combat info)',addFloor:'Add Floor',floorIndex:'Floor Index',floorIndexPlaceholder:'e.g., 0, 1, 2',removeFloor:'Remove',columnTemplates:'Column Templates',columnTemplatesDesc:'Column header templates for table feature',templateName:'Template Name',templateNamePlaceholder:'e.g., Character Template',templateContent:'Template Content',templateContentPlaceholder:'e.g., Name|Age|Gender',addTemplate:'Add Template',deleteTemplate:'Delete Template',autoSummary:'Auto Summary',enableAutoSummary:'Enable Auto Summary',summaryInterval:'Summary Interval (Floors)',summaryIntervalPlaceholder:'e.g., 20',summaryIntervalHelp:'Generate summary every N floors',currentStatus:'Current Summary Status',chatId:'Chat ID',lastSummaryFloor:'Last Summary Floor',nextSummaryFloor:'Next Summary Floor',resetStatus:'Reset Status',manualSummary:'Manual Summary',configSaved:'Config saved',apiConfigSaved:'API config saved',fetchError:'Failed to fetch models'},greetings:{title:'Greetings Manager',character:'Current Character',noCharacter:'No character found',clearConfig:'Clear Config',clearConfigConfirm:'Are you sure you want to clear all greeting configurations?',clearSuccess:'Configuration cleared',help:'Help',greetingBadge:'Greeting',default:'Default',icon:'Icon',iconPlaceholder:'emoji or image URL',greetingTitle:'Title',titlePlaceholder:'Greeting title',description:'Description',descriptionPlaceholder:'Greeting description',generateWithAI:'Generate with AI',generating:'Generating...',stylePrompt:'Style Generation',stylePromptPlaceholder:'Describe your desired interface style, e.g.: Cyberpunk style, neon lights, dark theme',generateStyle:'Generate Style with AI',generatingStyle:'Generating...',copyCode:'Copy Code',copySuccess:'Code copied to clipboard',apiFailed:'API call failed',styleGenerated:'Style generated successfully',descGenerated:'Description generated successfully',htmlCode:'Generated HTML Code',regexConfig:'Regex Config (JSON)'},regex:{title:'UI Generator',help:'Help',triggerText:'Trigger Text',triggerTextPlaceholder:'e.g., #status',uiDescription:'UI Description',uiDescriptionPlaceholder:'Describe your desired UI in detail, e.g.: Game-style status bar showing HP, MP, EXP with progress bars',generateUI:'Generate UI',generating:'Generating...',preview:'Preview',htmlCode:'Generated HTML Code',regexConfig:'Regex Config (JSON)',copyCode:'Copy Code',copySuccess:'Code copied',apiFailed:'API call failed',generated:'UI generated successfully'},table:{title:'Table Manager',help:'Help',selectTemplate:'Select Template',noTemplate:'No Template',floorNumber:'Floor Number',floorNumberPlaceholder:'e.g., 1',generateTable:'Generate Table',updateTable:'Update Table',deleteTable:'Delete Table',clearHistory:'Clear History',tableHistory:'Table History',noHistory:'No table history'},history:{title:'History Summary',help:'Help',floorRange:'Floor Range',startFloor:'Start Floor',endFloor:'End Floor',generate:'Generate Summary',generating:'Generating...',summary:'Summary',copyToClipboard:'Copy to Clipboard',insertToChat:'Insert to Chat',noSummary:'No summary yet'},projects:{title:'Project Manager',help:'Help',createProject:'Create Project',importProject:'Import Project',projectName:'Project Name',projectList:'Project List',noProjects:'No projects',openEditor:'Open Editor',deleteProject:'Delete Project',exportProject:'Export Project'},tools:{title:'Tool Templates',help:'Help'},mvu:{title:'MVU Beta',help:'Help'},helpPage:{version:'Version',checkUpdate:'Check for Updates',downloadLatest:'Download Latest Version',copyright:'Copyright Notice',copyrightContent:{line1:'ğŸ“Œ This script is only published on LeiNao/Journey',line2:'ğŸš« Redistribution is prohibited',line3:'âš ï¸ Modifications require author permission',line4:'âŒ Commercial use is absolutely prohibited'},usageGuide:'User Guide',features:{title:'ğŸ“‹ Features',summary:'<strong>Summary:</strong> Auto/manual chat summary, save to World Info',cardAssist:'<strong>Card Assistant:</strong> Generate character cards, World Info entries, supports streaming and AI modification',statusBar:'<strong>Status Bar Generator:</strong> Visual status bar configuration, generate regex JSON and World Info entries',mvu:'<strong>MVU Beta:</strong> Generate variable structure, prompt templates, $meta configuration',others:'<strong>Others:</strong> Remove clichÃ©s, regex UI generator, project manager, table generator'},usage:{title:'ğŸ’¡ How to Use',apiConfig:'âš ï¸ API Configuration',apiFormats:'<strong>Supported formats:</strong>',apiFormat1:'<code>https://api.openai.com</code> â†’ Auto-complete to <code>/v1</code>',apiFormat2:'<code>https://api.openai.com/v1</code> â†’ Use directly',apiFormat3:'<code>https://your-proxy.com/v1/chat/completions</code> â†’ Use directly',apiExample:'<strong>OpenAI official example:</strong>',import:'<strong>Import:</strong> Tavern Helper â†’ Script Library â†’ Import â†’ Global Script',firstUse:'<strong>First Use:</strong> Configure API in Settings page first',autoSummary:'<strong>Auto Summary:</strong> Recommended to enable, auto-generate every 20-30 floors'},changelog:'Changelog',updates:{v134:{date:'Nov 7, 2025',features:['ğŸŒ New: Multi-language support (Chinese/English switching)','ğŸ› Fix: vue-i18n initialization error','ğŸ“± Optimize: Complete mobile responsive adaptation','ğŸ”§ Optimize: Use testingcf.jsdelivr.net for faster access']},v133:{date:'Nov 5, 2025',title:'ğŸ¨ Greetings Manager',features:['New: Greetings beautification selector tool','Auto-read all character greetings','Configure beautification style for each greeting (icon, title, description)','AI generate description: Auto-generate attractive descriptions based on greeting content','AI edit description: Quickly modify descriptions based on requirements','â­ AI generate interface style: Tell AI what style you want, auto-generate complete HTML interface','Real-time preview of generated beautification effects','One-click export to STScript JSON format','Configuration auto-save to character variables']},v132:{date:'Nov 2, 2025',optimize:'ğŸ”§ Optimize',optimizeFeatures:['Minimize icon supports dragging, can adjust position freely']},v131:{date:'Oct 30, 2025',newFeatures:'âœ¨ New Features',newFeaturesList:['Same-layer dialogue: AI replies displayed directly in panel, supports streaming and regex filtering','Status bar generator adds AI parsing XML and natural language field generation'],optimize:'ğŸ”§ Optimize',optimizeFeatures:['Complete mobile adaptation: responsive layout, tab scrolling, swipe switching','All AI functions unified to use API configuration from settings page']},v130:{date:'Oct 26, 2025',newFeatures:'âœ¨ New Features',newFeaturesList:['New MVU Beta tab: variable structure, prompt templates, $meta configuration generation','New status bar generator: visual status bar configuration, generate regex JSON and World Info entries','Status bar generator supports ABO template quick load'],optimize:'ğŸ”§ Optimize',optimizeFeatures:['All AI tools unified to read max_tokens and temperature from settings page','MVU Beta and status bar generator support data persistence']},v129:{date:'Oct 25, 2025',newFeatures:'âœ¨ New Features',newFeaturesList:['New status bar generator']},v128:{date:'Oct 24, 2025',majorUpdate:'ğŸ‰ Major Update',majorUpdateList:['Project manager AI preview: Preview and compare generated code before applying','Modification history and version rollback: Keep up to 50 history records, restore to any version','Remove clichÃ©s tool optimized: Moderate cleaning, maintain original information and length']},v127:{date:'Oct 23, 2025',newFeatures:'âœ¨ New Features',newFeaturesList:['Streaming support: All AI generation tools support real-time generation progress','Regex UI generator: Generate SillyTavern frontend UI code with natural language','World Info entry viewer and AI modification']},v126:{date:'Oct 22, 2025',newFeatures:'âœ¨ New Features',newFeaturesList:['Project manager: Complete frontend system writing, supports multiple files, modules, AI continuation','Real-time preview, project templates, project persistence']},v125:{date:'Oct 21, 2025',newFeatures:'âœ¨ New Features',newFeaturesList:['Batch modify World Info entries, remove clichÃ©s history, help page']},v100:{date:'Oct 20, 2025',features:['ğŸ‰ Initial release','Support auto/manual summary, table generation, remove clichÃ©s, World Info entry management, floor hide/show']}},about:'About',madeWith:'Made with',by:'by',basedOn:'Based on',and:'and'}}}}),u='maomao_tool_cached_version';function m(){try{const e=localStorage.getItem(u);return e?JSON.parse(e):null}catch(e){return console.warn('è¯»å–ç¼“å­˜ç‰ˆæœ¬å¤±è´¥:',e),null}}function f(e){try{localStorage.setItem(u,JSON.stringify(e))}catch(e){console.warn('ä¿å­˜ç¼“å­˜ç‰ˆæœ¬å¤±è´¥:',e)}}async function x(e=!1){try{e&&window.toastr.info('æ­£åœ¨æ£€æŸ¥æ›´æ–°...','ç‰ˆæœ¬æ£€æŸ¥',{timeOut:2e3});const n=m();console.log('ğŸ” æ£€æŸ¥ç‰ˆæœ¬æ›´æ–°...'),n?console.log(`   ç¼“å­˜ç‰ˆæœ¬: v${n.version} (${n.shortHash})`):console.log('   ç¼“å­˜ç‰ˆæœ¬: (é¦–æ¬¡æ£€æµ‹)');const t=await async function(){try{const e=Date.now(),n=await fetch(`https://testingcf.jsdelivr.net/gh/mzrodyu/maomao/dist/è®°å¿†_with_worldbook/version.json?_=${e}`);return n.ok?await n.json():(console.warn('âš ï¸  æ— æ³•è·å–ç‰ˆæœ¬ä¿¡æ¯:',n.status),null)}catch(e){return console.warn('âš ï¸  è·å–ç‰ˆæœ¬ä¿¡æ¯å¤±è´¥:',e),null}}();if(!t)return void(e&&window.toastr.warning('æ— æ³•è·å–æœ€æ–°ç‰ˆæœ¬ä¿¡æ¯','æ£€æŸ¥æ›´æ–°',{timeOut:3e3}));console.log(`   è¿œç¨‹ç‰ˆæœ¬: v${t.version} (${t.shortHash})`),!function(e,n){return e?n.commitHash!==e.commitHash?(console.log('ğŸ”„ æ£€æµ‹åˆ°æ–°çš„ commit:',e.shortHash,'->',n.shortHash),!0):n.version!==e.version&&(console.log('ğŸ”„ æ£€æµ‹åˆ°æ–°çš„ç‰ˆæœ¬:',e.version,'->',n.version),!0):(console.log('ğŸ“Œ é¦–æ¬¡æ£€æµ‹ï¼Œä¿å­˜å½“å‰ç‰ˆæœ¬:',n.version),f(n),!1)}(n,t)?(console.log('âœ… å½“å‰å·²æ˜¯æœ€æ–°ç‰ˆæœ¬'),e&&window.toastr.success('å½“å‰å·²æ˜¯æœ€æ–°ç‰ˆæœ¬ï¼','ç‰ˆæœ¬æ£€æŸ¥',{timeOut:3e3})):(console.log('âœ¨ å‘ç°æ–°ç‰ˆæœ¬ï¼'),function(e,n){if(localStorage.getItem('maomao_skip_update_version')===n.version)return void console.log(`â„¹ï¸  ç”¨æˆ·é€‰æ‹©è·³è¿‡ç‰ˆæœ¬ ${n.version} çš„æ›´æ–°æç¤º`);const t=e?`v${e.version}`:'æœªçŸ¥',a=`v${n.version}`,o=$(`\n    <div id="maomao-update-dialog" style="\n      position: fixed;\n      top: 50%;\n      left: 50%;\n      transform: translate(-50%, -50%);\n      z-index: 9999999;\n      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);\n      padding: 30px 40px;\n      border-radius: 16px;\n      box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);\n      color: white;\n      max-width: 500px;\n      min-width: 350px;\n      text-align: center;\n      animation: slideIn 0.3s ease-out;\n    ">\n      <div style="font-size: 48px; margin-bottom: 15px;">ğŸ‰</div>\n      <h2 style="margin: 0 0 10px 0; font-size: 24px; font-weight: 600;">å‘ç°æ–°ç‰ˆæœ¬ï¼</h2>\n      <div style="font-size: 16px; margin-bottom: 20px; opacity: 0.95;">\n        <div style="margin-bottom: 8px;">\n          <strong>å½“å‰ç‰ˆæœ¬:</strong> ${t}\n        </div>\n        <div>\n          <strong>æœ€æ–°ç‰ˆæœ¬:</strong> ${a}\n        </div>\n      </div>\n      \n      <div style="display: flex; gap: 12px; justify-content: center; margin-top: 25px; flex-wrap: wrap;">\n        <button id="maomao-update-now" style="\n          padding: 12px 24px;\n          background: white;\n          color: #667eea;\n          border: none;\n          border-radius: 8px;\n          font-size: 15px;\n          font-weight: 600;\n          cursor: pointer;\n          transition: transform 0.2s, box-shadow 0.2s;\n        ">\n          <i class="fa-solid fa-download" style="margin-right: 6px;"></i>\n          ä¸‹è½½æ–°ç‰ˆæœ¬\n        </button>\n        \n        <button id="maomao-update-later" style="\n          padding: 12px 24px;\n          background: rgba(255, 255, 255, 0.2);\n          color: white;\n          border: 1px solid rgba(255, 255, 255, 0.5);\n          border-radius: 8px;\n          font-size: 15px;\n          font-weight: 600;\n          cursor: pointer;\n          transition: background 0.2s;\n        ">\n          ç¨åæé†’\n        </button>\n        \n        <button id="maomao-update-skip" style="\n          padding: 12px 24px;\n          background: transparent;\n          color: rgba(255, 255, 255, 0.8);\n          border: 1px solid rgba(255, 255, 255, 0.3);\n          border-radius: 8px;\n          font-size: 15px;\n          cursor: pointer;\n          transition: background 0.2s;\n        ">\n          è·³è¿‡æ­¤ç‰ˆæœ¬\n        </button>\n      </div>\n    </div>\n    \n    <style>\n      @keyframes slideIn {\n        from {\n          opacity: 0;\n          transform: translate(-50%, -60%);\n        }\n        to {\n          opacity: 1;\n          transform: translate(-50%, -50%);\n        }\n      }\n      \n      #maomao-update-now:hover {\n        transform: translateY(-2px);\n        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);\n      }\n      \n      #maomao-update-later:hover {\n        background: rgba(255, 255, 255, 0.3);\n      }\n      \n      #maomao-update-skip:hover {\n        background: rgba(255, 255, 255, 0.1);\n      }\n    </style>\n  `);$('body').append(o),$('#maomao-update-now').on('click',async()=>{try{window.toastr.info('æ­£åœ¨ä¸‹è½½æ–°ç‰ˆæœ¬...','æ›´æ–°ä¸­',{timeOut:2e3});const e=`https://testingcf.jsdelivr.net/gh/mzrodyu/maomao/dist/è®°å¿†_with_worldbook/çŒ«çŒ«çš„å†™å¡å°å·¥å…· v${n.version}.json?_=${Date.now()}`,t=await fetch(e);if(!t.ok)throw new Error(`ä¸‹è½½å¤±è´¥: HTTP ${t.status}`);const a=await t.text(),r=new Blob([a],{type:'application/json'}),s=URL.createObjectURL(r),i=document.createElement('a');i.href=s,i.download=`çŒ«çŒ«çš„å†™å¡å°å·¥å…· v${n.version}.json`,document.body.appendChild(i),i.click(),document.body.removeChild(i),URL.revokeObjectURL(s),f(n),o.fadeOut(200,()=>o.remove()),window.toastr.success(`v${n.version} å·²ä¸‹è½½å®Œæˆï¼Œè¯·åœ¨é…’é¦†è„šæœ¬åº“é‡æ–°å¯¼å…¥è¯¥æ–‡ä»¶`,'ä¸‹è½½æˆåŠŸ',{timeOut:8e3})}catch(e){console.error('ä¸‹è½½å¤±è´¥:',e),window.toastr.error('ä¸‹è½½å¤±è´¥: '+e.message,'é”™è¯¯',{timeOut:5e3})}}),$('#maomao-update-later').on('click',()=>{o.fadeOut(200,()=>o.remove()),window.toastr.info('æ‚¨å¯ä»¥éšæ—¶åœ¨"å¸®åŠ©"é¡µé¢æŸ¥çœ‹ç‰ˆæœ¬ä¿¡æ¯','ç¨åæ›´æ–°',{timeOut:3e3})}),$('#maomao-update-skip').on('click',()=>{f(n),localStorage.setItem('maomao_skip_update_version',n.version),o.fadeOut(200,()=>o.remove()),window.toastr.success(`å·²è·³è¿‡ç‰ˆæœ¬ ${a}`,'æ›´æ–°æç¤º',{timeOut:3e3})}),console.log(`ğŸ‰ å‘ç°æ–°ç‰ˆæœ¬: ${t} -> ${a}`)}(n,t))}catch(n){console.error('âŒ æ£€æŸ¥æ›´æ–°å¤±è´¥:',n),e&&window.toastr.error('æ£€æŸ¥æ›´æ–°å¤±è´¥','ç‰ˆæœ¬æ£€æŸ¥',{timeOut:3e3})}}var b=s(15);const h=toastr;var y=s.n(h),v=s(707);function w(e,n=''){try{const t=new URL(e);return n&&!t.pathname.endsWith('/')&&(t.pathname+='/'),n&&(t.pathname+=n.startsWith('/')?n.slice(1):n),t.toString()}catch(n){throw new Error(`API ç«¯ç‚¹æ ¼å¼ä¸æ­£ç¡®: ${e}`)}}const k={style:{color:'#667eea',margin:'0 0 15px 0'}},A={style:{color:'#888',margin:'0 0 25px 0','line-height':'1.6'}},C=['placeholder'],E={key:1,style:{'margin-bottom':'25px'}},T={style:{display:'flex',gap:'12px'}},S=['disabled'],N=['disabled'],I=(0,i.defineComponent)({__name:'AIGenerateDialog',props:{show:{type:Boolean},title:{},description:{},placeholder:{},isGenerating:{type:Boolean},showInput:{type:Boolean}},emits:['close','confirm'],setup(e,{emit:n}){const t=e,a=n,o=(0,i.ref)('');(0,i.watch)(()=>t.show,e=>{e&&(o.value='')});const r=()=>{t.isGenerating||(t.showInput?a('confirm',o.value):a('confirm'))},s=()=>{t.isGenerating||a('close')};return(n,t)=>e.show?((0,i.openBlock)(),(0,i.createElementBlock)('div',{key:0,onClick:(0,i.withModifiers)(s,['self']),style:{position:'fixed',top:'0',left:'0',right:'0',bottom:'0',background:'rgba(0, 0, 0, 0.8)','z-index':'1000000',display:'flex','align-items':'center','justify-content':'center',padding:'20px'}},[(0,i.createElementVNode)('div',{style:{background:'#2a2a2a',border:'2px solid #667eea','border-radius':'12px',padding:'30px','max-width':'500px',width:'100%','text-align':'center'},onClick:t[1]||(t[1]=(0,i.withModifiers)(()=>{},['stop']))},[(0,i.createElementVNode)('h3',k,[t[2]||(t[2]=(0,i.createElementVNode)('i',{class:'fa-solid fa-wand-magic-sparkles'},null,-1)),(0,i.createTextVNode)(' '+(0,i.toDisplayString)(e.title||'AI ç”Ÿæˆ'),1)]),(0,i.createElementVNode)('p',A,(0,i.toDisplayString)(e.description||'AI æ­£åœ¨ä¸ºä½ ç”Ÿæˆå†…å®¹...'),1),(0,i.createCommentVNode)(' æ˜¾ç¤ºè¾“å…¥æ¡†ï¼ˆå¯é€‰ï¼‰ '),e.showInput?(0,i.withDirectives)(((0,i.openBlock)(),(0,i.createElementBlock)('textarea',{key:0,'onUpdate:modelValue':t[0]||(t[0]=e=>o.value=e),placeholder:e.placeholder||'è¾“å…¥ä½ çš„éœ€æ±‚...',style:{width:'100%','min-height':'120px',background:'#1a1a1a',color:'#e0e0e0',border:'1px solid #444','border-radius':'4px',padding:'12px','font-size':'14px','margin-bottom':'20px',resize:'vertical','box-sizing':'border-box'}},null,8,C)),[[i.vModelText,o.value]]):(0,i.createCommentVNode)('v-if',!0),(0,i.createCommentVNode)(' åŠ è½½åŠ¨ç”» '),e.isGenerating?((0,i.openBlock)(),(0,i.createElementBlock)('div',E,[...t[3]||(t[3]=[(0,i.createElementVNode)('div',{style:{display:'inline-block',width:'50px',height:'50px',border:'4px solid #3a3a3a','border-top-color':'#667eea','border-radius':'50%',animation:'spin 1s linear infinite'}},null,-1),(0,i.createElementVNode)('p',{style:{color:'#888','margin-top':'15px','font-size':'14px'}},'æ­£åœ¨ç”Ÿæˆä¸­ï¼Œè¯·ç¨å€™...',-1)])])):(0,i.createCommentVNode)('v-if',!0),(0,i.createElementVNode)('div',T,[e.isGenerating?(0,i.createCommentVNode)('v-if',!0):((0,i.openBlock)(),(0,i.createElementBlock)('button',{key:0,onClick:r,disabled:e.showInput&&!o.value,style:(0,i.normalizeStyle)([{flex:'1',background:'#667eea',color:'white',border:'none',padding:'12px 24px','border-radius':'6px',cursor:'pointer','font-size':'14px','font-weight':'600',transition:'all 0.2s'},{opacity:e.showInput&&!o.value?.5:1}])},[...t[4]||(t[4]=[(0,i.createElementVNode)('i',{class:'fa-solid fa-check'},null,-1),(0,i.createTextVNode)(' ç¡®è®¤ç”Ÿæˆ ',-1)])],12,S)),(0,i.createElementVNode)('button',{onClick:s,disabled:e.isGenerating,style:(0,i.normalizeStyle)([{flex:'1',background:'#666',color:'white',border:'none',padding:'12px 24px','border-radius':'6px',cursor:'pointer','font-size':'14px','font-weight':'600',transition:'all 0.2s'},{opacity:e.isGenerating?.5:1}])},(0,i.toDisplayString)(e.isGenerating?'ç”Ÿæˆä¸­...':'å–æ¶ˆ'),13,N)])])])):(0,i.createCommentVNode)('v-if',!0)}});s(661);var V=s(800);const B=(0,V.A)(I,[['__scopeId','data-v-c12ec546']]),M={style:{color:'#ffc107',margin:'0 0 20px 0'}},P={style:{color:'#888',margin:'0 0 15px 0','line-height':'1.6'}},D={key:0,style:{color:'#888',margin:'0 0 20px 0','padding-left':'20px','line-height':'1.8'}},j=['placeholder'],R={key:1,style:{'margin-bottom':'20px',background:'#1a1a1a','border-radius':'8px',padding:'15px',border:'1px solid #444'}},O={style:{display:'flex',gap:'12px'}},F=['disabled'],L=['disabled'],H=(0,i.defineComponent)({__name:'AIModifyDialog',props:{show:{type:Boolean},title:{},description:{},examples:{},placeholder:{},isModifying:{type:Boolean}},emits:['close','confirm'],setup(e,{emit:n}){const t=e,a=n,o=(0,i.ref)('');(0,i.watch)(()=>t.show,e=>{e&&(o.value='')});const r=()=>{o.value&&!t.isModifying&&a('confirm',o.value)};return(n,t)=>e.show?((0,i.openBlock)(),(0,i.createElementBlock)('div',{key:0,onClick:t[3]||(t[3]=(0,i.withModifiers)(e=>n.$emit('close'),['self'])),style:{position:'fixed',top:'0',left:'0',right:'0',bottom:'0',background:'rgba(0, 0, 0, 0.8)','z-index':'1000000',display:'flex','align-items':'center','justify-content':'center',padding:'20px'}},[(0,i.createElementVNode)('div',{style:{background:'#2a2a2a',border:'2px solid #ffc107','border-radius':'12px',padding:'30px','max-width':'600px',width:'100%','max-height':'80vh','overflow-y':'auto'},onClick:t[2]||(t[2]=(0,i.withModifiers)(()=>{},['stop']))},[(0,i.createElementVNode)('h3',M,[t[4]||(t[4]=(0,i.createElementVNode)('i',{class:'fa-solid fa-edit'},null,-1)),(0,i.createTextVNode)(' '+(0,i.toDisplayString)(e.title||'AI ä¿®æ”¹'),1)]),(0,i.createElementVNode)('p',P,(0,i.toDisplayString)(e.description||'æè¿°ä½ æƒ³è¦ä¿®æ”¹çš„åœ°æ–¹ï¼ŒAI ä¼šåœ¨å½“å‰åŸºç¡€ä¸Šè¿›è¡Œè°ƒæ•´ã€‚'),1),e.examples&&e.examples.length>0?((0,i.openBlock)(),(0,i.createElementBlock)('ul',D,[((0,i.openBlock)(!0),(0,i.createElementBlock)(i.Fragment,null,(0,i.renderList)(e.examples,(e,n)=>((0,i.openBlock)(),(0,i.createElementBlock)('li',{key:n},(0,i.toDisplayString)(e),1))),128))])):(0,i.createCommentVNode)('v-if',!0),(0,i.withDirectives)((0,i.createElementVNode)('textarea',{'onUpdate:modelValue':t[0]||(t[0]=e=>o.value=e),placeholder:e.placeholder||'è¾“å…¥ä¿®æ”¹å»ºè®®...',style:{width:'100%','min-height':'150px',background:'#1a1a1a',color:'#e0e0e0',border:'1px solid #444','border-radius':'4px',padding:'12px','font-size':'14px','margin-bottom':'20px',resize:'vertical','box-sizing':'border-box'}},null,8,j),[[i.vModelText,o.value]]),(0,i.createCommentVNode)(' åŠ è½½è¿›åº¦æ¡ '),e.isModifying?((0,i.openBlock)(),(0,i.createElementBlock)('div',R,[...t[5]||(t[5]=[(0,i.createStaticVNode)('<div style="display:flex;align-items:center;gap:12px;margin-bottom:10px;" data-v-7890f262><i class="fa-solid fa-wand-magic-sparkles" style="color:#ffc107;font-size:18px;animation:pulse 1.5s infinite;" data-v-7890f262></i><span style="color:#ffc107;font-weight:600;font-size:14px;" data-v-7890f262>AI æ­£åœ¨ç”Ÿæˆä¸­...</span></div><div style="width:100%;height:6px;background:#333;border-radius:3px;overflow:hidden;position:relative;" data-v-7890f262><div class="progress-bar" data-v-7890f262></div></div><p style="color:#888;font-size:12px;margin:8px 0 0 0;text-align:center;" data-v-7890f262>è¯·ç¨å€™ï¼Œè¿™å¯èƒ½éœ€è¦å‡ ç§’é’Ÿ</p>',3)])])):(0,i.createCommentVNode)('v-if',!0),(0,i.createElementVNode)('div',O,[(0,i.createElementVNode)('button',{onClick:r,disabled:!o.value||e.isModifying,style:(0,i.normalizeStyle)([{flex:'1',background:'#ffc107',color:'#000',border:'none',padding:'12px 24px','border-radius':'6px',cursor:'pointer','font-size':'14px','font-weight':'600',transition:'all 0.2s',position:'relative',overflow:'hidden'},{opacity:!o.value||e.isModifying?.5:1}])},[(0,i.createElementVNode)('i',{class:(0,i.normalizeClass)(['fa-solid fa-wand-magic-sparkles',{'icon-spin':e.isModifying}])},null,2),(0,i.createTextVNode)(' '+(0,i.toDisplayString)(e.isModifying?'ç”Ÿæˆä¸­...':'ç¡®è®¤ç”Ÿæˆ'),1)],12,F),(0,i.createElementVNode)('button',{onClick:t[1]||(t[1]=e=>n.$emit('close')),disabled:e.isModifying,style:(0,i.normalizeStyle)([{flex:'1',background:'#666',color:'white',border:'none',padding:'12px 24px','border-radius':'6px',cursor:'pointer','font-size':'14px','font-weight':'600',transition:'all 0.2s'},{opacity:e.isModifying?.5:1}])},' å–æ¶ˆ ',12,L)])])])):(0,i.createCommentVNode)('v-if',!0)}});s(267);const U=(0,V.A)(H,[['__scopeId','data-v-7890f262']]),G={class:'greetings-tab',style:{display:'flex','flex-direction':'column',height:'100%',background:'#1a1a1a !important'}},Y={class:'section-header',style:{display:'flex','justify-content':'space-between','align-items':'center',padding:'20px 25px !important','border-bottom':'1px solid #3a3a3a'}},J={class:'header-actions',style:{display:'flex','align-items':'center',gap:'10px'}},W={key:0,class:'count-badge',style:{background:'#667eea',color:'white',padding:'4px 8px','border-radius':'12px','font-size':'12px'}},q={style:{flex:'1',display:'flex',gap:'20px',padding:'20px',overflow:'hidden'}},K={style:{flex:'1','overflow-y':'auto','padding-right':'10px'}},X={key:0,style:{display:'flex','flex-direction':'column','align-items':'center','justify-content':'center',padding:'60px 20px','text-align':'center',color:'#888'}},Q={style:{background:'#2a2a2a',border:'1px solid #667eea','border-radius':'8px',padding:'20px','margin-bottom':'20px'}},Z={style:{display:'flex','justify-content':'space-between','align-items':'center','margin-bottom':'15px'}},ee={style:{display:'flex','flex-direction':'column',gap:'15px'}},ne={style:{display:'flex','align-items':'center',gap:'10px','margin-bottom':'12px','padding-bottom':'10px','border-bottom':'1px solid #3a3a3a'}},te={style:{background:'#667eea',color:'white',padding:'4px 10px','border-radius':'6px','font-size':'12px','font-weight':'bold','min-width':'35px','text-align':'center'}},ae=['onUpdate:modelValue'],oe=['onUpdate:modelValue','placeholder'],re=['onClick'],se=['onClick'],ie=['onUpdate:modelValue'],le=['onClick'],de={key:3,style:{position:'sticky',bottom:'0',padding:'20px',background:'linear-gradient(to top, #1a1a1a 80%, transparent)','border-top':'1px solid #3a3a3a',display:'flex','justify-content':'center',gap:'15px','margin-top':'20px'}},ce={style:{flex:'1',display:'flex','flex-direction':'column',background:'#2a2a2a','border-radius':'12px',overflow:'hidden',border:'1px solid #3a3a3a','box-shadow':'0 4px 12px rgba(0, 0, 0, 0.3)'}},pe={style:{padding:'15px 20px',background:'linear-gradient(135deg, #667eea 0%, #764ba2 100%)','border-bottom':'1px solid #3a3a3a',display:'flex','justify-content':'space-between','align-items':'center'}},ge={style:{flex:'1',position:'relative',overflow:'hidden',background:'#1e1e1e'}},ue=['srcdoc'],me={key:1,style:{width:'100%',height:'100%',display:'flex','align-items':'center','justify-content':'center',color:'#666','font-size':'14px',padding:'20px','text-align':'center','line-height':'1.8'}},fe={style:{display:'flex','justify-content':'space-between','align-items':'center','margin-bottom':'16px'}},xe={style:{background:'#1a1a1a','border-radius':'8px',padding:'16px',color:'#e0e0e0','font-size':'14px','line-height':'1.6','overflow-y':'auto',flex:'1','white-space':'pre-wrap','word-wrap':'break-word'}},be={style:{display:'flex','justify-content':'flex-end','margin-top':'16px'}},he={style:{padding:'20px','overflow-y':'auto',flex:'1'}},ye={style:{background:'#1a1a1a',border:'1px solid #3a3a3a','border-radius':'8px',padding:'15px','max-height':'400px','overflow-y':'auto','margin-bottom':'15px'}},ve={style:{margin:'0','white-space':'pre-wrap','word-wrap':'break-word'}},we={style:{color:'#e0e0e0','font-family':'\'Consolas\', \'Monaco\', monospace','font-size':'12px','line-height':'1.6'}},ke=(0,i.defineComponent)({__name:'GreetingsTab',setup(e){const n=v.z.object({icon:v.z.string().default(''),title:v.z.string().default(''),description:v.z.string().default('')}),t=v.z.object({customHtml:v.z.string().default('')}),a=(0,l.C)(),{settings:o}=(0,p.storeToRefs)(a),r=(0,i.ref)([]),s=(0,i.ref)(t.parse({})),c=(0,i.ref)(!1),g=(0,i.ref)(''),u=(0,i.ref)('å¤åˆ¶ä»£ç '),m=(0,i.ref)(!1),f=(0,i.ref)(!1),x=(0,i.ref)(!1),h=(0,i.ref)(!1),k=(0,i.ref)(-1),A=(0,i.ref)(!1),C=(0,i.ref)(''),E=(0,i.ref)(null),T=(0,i.ref)(!1),S=(0,i.ref)(''),N=(0,i.ref)(!1),I=(0,i.ref)(!1);function V(){try{const e=getCharData('current');return e?console.log('æ‰¾åˆ°è§’è‰²å¡:',e.name):console.log('æœªæ‰¾åˆ°è§’è‰²å¡'),e}catch(e){return console.error('è·å–è§’è‰²å¡å¤±è´¥:',e),null}}async function M(){try{const e=V();if(!e)return r.value=[],void console.log('æœªæ‰¾åˆ°è§’è‰²å¡');console.log('å½“å‰è§’è‰²å¡:',e.name);const a=[e.first_mes,...e.data?.alternate_greetings||[]];console.log('æ‰¾åˆ°',a.length,'ä¸ªå¼€åœºç™½');const o=getVariables({type:'character'}),i=o?.greetings_config||[],l=o?.ui_config;r.value=a.map((_,e)=>{const t=i[e];return n.parse(t||{})}),s.value=t.parse(l||{}),console.log('å¼€åœºç™½é…ç½®å·²åŠ è½½:',r.value.length,'ä¸ª'),console.log('UIé…ç½®å·²åŠ è½½, è‡ªå®šä¹‰HTMLé•¿åº¦:',s.value.customHtml.length),E.value=e,ke()}catch(e){console.error('åŠ è½½é…ç½®å¤±è´¥:',e),y().error('åŠ è½½é…ç½®å¤±è´¥: '+e.message)}}function P(){try{replaceVariables({greetings_config:(0,b.klona)(r.value),ui_config:(0,b.klona)(s.value)},{type:'character'}),ke()}catch(e){console.error('ä¿å­˜é…ç½®å¤±è´¥:',e)}}function D(){if(confirm(`ç¡®å®šè¦æ¸…ç©ºæ‰€æœ‰å¼€åœºç™½çš„é…ç½®å—ï¼Ÿ\n\nå½“å‰å…±æœ‰ ${r.value.length} ä¸ªå¼€åœºç™½ï¼Œæ¸…ç©ºåæ‰€æœ‰å›¾æ ‡ã€æ ‡é¢˜ã€æè¿°éƒ½å°†æ¢å¤é»˜è®¤ã€‚\n\nâš ï¸ æ­¤æ“ä½œä¸ä¼šåˆ é™¤è§’è‰²å¡çš„å¼€åœºç™½åŸæ–‡ï¼Œåªæ¸…ç©ºæ˜¾ç¤ºé…ç½®ï¼`))try{r.value=r.value.map(()=>n.parse({icon:'',title:'',description:''})),s.value.customHtml='',P(),ke(),y().success('å·²æ¸…ç©ºæ‰€æœ‰å¼€åœºç™½é…ç½®ï¼Œé¢„è§ˆå·²æ¢å¤é»˜è®¤æ ·å¼')}catch(e){console.error('æ¸…ç©ºé…ç½®å¤±è´¥:',e),y().error('æ¸…ç©ºå¤±è´¥: '+e.message)}}function j(){x.value||(m.value=!1)}async function R(e){const n=k.value;if(!(n<0||n>=r.value.length)){h.value=!0;try{if(!o.value.api_endpoint||!o.value.api_key)return y().error('è¯·å…ˆåœ¨è®¾ç½®é¡µé¢é…ç½® API ç«¯ç‚¹å’Œ API Key'),f.value=!1,void(h.value=!1);const t=r.value[n].description;if(!t.trim())return y().warning('å½“å‰æè¿°ä¸ºç©ºï¼Œè¯·å…ˆä½¿ç”¨ AI ç”Ÿæˆ'),f.value=!1,void(h.value=!1);const a='ä½ æ˜¯ä¸€ä¸ªä¸“ä¸šçš„æ–‡æ¡ˆç¼–è¾‘åŠ©æ‰‹ï¼Œæ“…é•¿æ ¹æ®ç”¨æˆ·éœ€æ±‚ä¿®æ”¹æ–‡æ¡ˆã€‚\n\nè¦æ±‚ï¼š\n1. æ ¹æ®ç”¨æˆ·çš„ä¿®æ”¹éœ€æ±‚è°ƒæ•´æè¿°\n2. ä¿æŒæè¿°ç®€æ´æœ‰åŠ›ï¼Œæ§åˆ¶åœ¨ 20-50 å­—ä»¥å†…\n3. ä¿ç•™åŸæè¿°çš„æ ¸å¿ƒä¿¡æ¯ï¼Œåªè¿›è¡Œå¿…è¦çš„è°ƒæ•´\n4. ç›´æ¥è¾“å‡ºä¿®æ”¹åçš„æè¿°æ–‡æœ¬ï¼Œä¸è¦æ·»åŠ å¼•å·æˆ–å…¶ä»–æ ‡è®°',s=`å½“å‰æè¿°ï¼š\n${t}\n\nä¿®æ”¹éœ€æ±‚ï¼š\n${e}\n\nè¯·è¾“å‡ºä¿®æ”¹åçš„æè¿°ï¼š`;console.log('å¼€å§‹ AI ç¼–è¾‘æè¿°...');const i=w(o.value.api_endpoint,'/chat/completions');console.log('ğŸ”— è§„èŒƒåŒ–åçš„ç«¯ç‚¹:',i);const l=await fetch(i,{method:'POST',headers:{'Content-Type':'application/json',Authorization:`Bearer ${o.value.api_key}`},body:JSON.stringify({model:o.value.model,messages:[{role:'system',content:a},{role:'user',content:s}],temperature:o.value.temperature,max_tokens:o.value.max_tokens,top_p:o.value.top_p,presence_penalty:o.value.presence_penalty,frequency_penalty:o.value.frequency_penalty})});if(!l.ok){const e=await l.text();throw new Error(`API è¯·æ±‚å¤±è´¥: ${l.status} ${l.statusText}\n${e}`)}const d=await l.json();console.log('âœ… [ç¼–è¾‘] API å®Œæ•´å“åº”:',d);let c=d.choices?.[0]?.message?.content?.trim()||'';if(console.log('ğŸ“ [ç¼–è¾‘] AI åŸå§‹è¿”å›:',c),!c){if(console.error('âŒ [ç¼–è¾‘] AI å“åº”ä¸ºç©º'),console.error('å®Œæ•´å“åº”:',JSON.stringify(d,null,2)),d.error)throw new Error(`API é”™è¯¯: ${d.error.message||JSON.stringify(d.error)}`);if(!d.choices||0===d.choices.length)throw new Error('API è¿”å›æ ¼å¼é”™è¯¯ï¼šæ²¡æœ‰ choices å­—æ®µï¼Œè¯·æ£€æŸ¥ API ç«¯ç‚¹å’Œæ¨¡å‹');throw new Error('AI æœªè¿”å›æœ‰æ•ˆå†…å®¹ï¼Œè¯·æ£€æŸ¥ï¼š\n1. API Key æ˜¯å¦æœ‰æ•ˆ\n2. æ¨¡å‹æ˜¯å¦å¯ç”¨\n3. è´¦æˆ·ä½™é¢')}if(c=c.replace(/^["']|["']$/g,''),c=c.replace(/^```.*?\n?|```$/g,'').trim(),!c)throw new Error('AI è¿”å›å†…å®¹æ¸…ç†åä¸ºç©º');console.log('âœ¨ [ç¼–è¾‘] AI æ¸…ç†åçš„æè¿°:',c),r.value[n].description=c,P(),y().success('æè¿°ä¿®æ”¹æˆåŠŸ'),f.value=!1}catch(e){console.error('âŒ [ç¼–è¾‘] AI ç¼–è¾‘å¤±è´¥:',e);const n='ç¼–è¾‘å¤±è´¥: '+e.message;y().error(n)}finally{h.value=!1}}}async function O(e){if(e.trim()){if(!o.value.api_endpoint||!o.value.api_key)return y().error('è¯·å…ˆåœ¨è®¾ç½®é¡µé¢é…ç½® API ç«¯ç‚¹å’Œ API Key'),void(N.value=!1);I.value=!0;try{const n=r.value.map((e,n)=>{const t=e.icon||'ğŸ’¬',a=e.title||(0===n?'é»˜è®¤å¼€åœºç™½':`å¼€åœºç™½ ${n}`),o=e.description||'ç‚¹å‡»å¼€å§‹å¯¹è¯';return'      <div class="scene-card" onclick="switchGreeting('+n+')"><div class="card-badge">'+(0===n?'é»˜è®¤':String(n).padStart(2,'0'))+'</div><div class="card-icon">'+t+'</div><div class="card-title">'+a+'</div><div class="card-desc">'+o+'</div></div>'}).join('\n'),t='ä½ æ˜¯ä¸€ä¸ªä¸“ä¸šçš„å‰ç«¯å¼€å‘ä¸“å®¶ï¼Œæ“…é•¿åˆ›å»ºç¾è§‚çš„HTML/CSSç•Œé¢ã€‚\n\nä»»åŠ¡ï¼šæ ¹æ®ç”¨æˆ·çš„é£æ ¼æè¿°ï¼Œç”Ÿæˆä¸€ä¸ªå®Œæ•´çš„HTMLé¡µé¢ä»£ç ï¼Œç”¨äºå±•ç¤ºå¼€åœºç™½é€‰æ‹©ç•Œé¢ã€‚\n\nè¦æ±‚ï¼š\n1. åŒ…å«å®Œæ•´çš„ HTML ç»“æ„ï¼ˆ<html>ã€<head>ã€<body>ï¼‰\n2. åœ¨ <head> ä¸­åŒ…å« Font Awesome å›¾æ ‡åº“ï¼š<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">\n3. æ‰€æœ‰æ ·å¼å†™åœ¨ <style> æ ‡ç­¾å†…ï¼Œä¸è¦ä½¿ç”¨å¤–éƒ¨ CSS æ–‡ä»¶\n4. å¿…é¡»åŒ…å«ä»¥ä¸‹HTMLç»“æ„ï¼ˆä¿æŒç±»åä¸å˜ï¼‰ï¼š\n   - bodyï¼ˆé¡µé¢èƒŒæ™¯ï¼‰\n   - .containerï¼ˆä¸»å®¹å™¨ï¼‰\n   - .headerï¼ˆæ ‡é¢˜åŒºåŸŸï¼‰\n     - h1ï¼ˆä¸»æ ‡é¢˜ï¼‰\n     - pï¼ˆå‰¯æ ‡é¢˜ï¼‰\n   - .scene-gridï¼ˆå¡ç‰‡ç½‘æ ¼å®¹å™¨ï¼‰\n   - .scene-cardï¼ˆå•ä¸ªå¡ç‰‡ï¼Œéœ€è¦ onclick å±æ€§ï¼‰\n   - .card-badgeï¼ˆåºå·å¾½ç« ï¼‰\n   - .card-iconï¼ˆå›¾æ ‡ï¼‰\n   - .card-titleï¼ˆå¡ç‰‡æ ‡é¢˜ï¼‰\n   - .card-descï¼ˆå¡ç‰‡æè¿°ï¼‰\n   - .loadingï¼ˆåŠ è½½æç¤ºï¼‰\n5. å¿…é¡»åŒ…å« switchGreeting(id) å‡½æ•°çš„å®Œæ•´ JavaScript ä»£ç \n6. æ ¹æ®ç”¨æˆ·çš„é£æ ¼æè¿°è®¾è®¡é¢œè‰²ã€å­—ä½“ã€å¸ƒå±€ã€åŠ¨ç”»ç­‰æ ·å¼\n7. ç¡®ä¿å“åº”å¼è®¾è®¡ï¼Œåœ¨ä¸åŒå±å¹•å°ºå¯¸ä¸‹éƒ½å¥½çœ‹\n8. ç›´æ¥è¾“å‡ºå®Œæ•´çš„HTMLä»£ç ï¼Œä¸è¦æ·»åŠ ä»»ä½•è§£é‡Šæ–‡å­—æˆ–markdownæ ‡è®°\n\nã€é‡è¦ã€‘æ ·å¼è¦æ±‚ï¼š\n- body å¿…é¡»ä½¿ç”¨ "min-height: 100vh; height: auto;" è€Œä¸æ˜¯å›ºå®šé«˜åº¦\n- body å¿…é¡»ä½¿ç”¨ "display: flex; align-items: center; justify-content: center;" æ¥å±…ä¸­å†…å®¹\n- .container ä¸è¦è®¾ç½®å›ºå®šé«˜åº¦ï¼Œä½¿ç”¨ "height: auto;" è®©å†…å®¹è‡ªé€‚åº”\n- ç¡®ä¿æ‰€æœ‰å†…å®¹éƒ½èƒ½å®Œæ•´æ˜¾ç¤ºï¼Œä¸ä¼šè¢«æˆªæ–­\n\nã€é‡è¦ã€‘HTMLç»“æ„å¿…é¡»ä¸¥æ ¼éµå®ˆï¼š\n- å¿…é¡»æœ‰ä¸€ä¸ª class="scene-grid" çš„divä½œä¸ºå¡ç‰‡å®¹å™¨\n- æ‰€æœ‰å¡ç‰‡å¿…é¡»åœ¨ scene-grid å®¹å™¨å†…\n- ä¸è¦æ”¹å˜scene-gridè¿™ä¸ªç±»åï¼Œä¸è¦ç”¨grid-containerã€cards-gridç­‰å…¶ä»–åå­—',a=`é£æ ¼æè¿°ï¼š${e}\n\nä»¥ä¸‹æ˜¯éœ€è¦å±•ç¤ºçš„å¼€åœºç™½å¡ç‰‡ï¼ˆæ¯ä¸ªå¡ç‰‡éœ€è¦æœ‰ onclick="switchGreeting(åºå·)" å±æ€§ï¼‰ï¼š\n${n}\n\nã€é‡è¦ã€‘å¿…é¡»åœ¨ </body> å‰æ·»åŠ ä»¥ä¸‹ JavaScript ä»£ç ï¼š\n<script>\n${'async function switchGreeting(id) {\n      try {\n        const loading = document.getElementById("loading");\n        const mainContainer = document.getElementById("mainContainer");\n        if (loading) loading.classList.add("active");\n        if (mainContainer) mainContainer.style.display = "none";\n        \n        if (typeof window.getChatMessages !== "function") {\n          alert("è¯·åœ¨é…’é¦†ç¯å¢ƒä¸­ä½¿ç”¨æ­¤åŠŸèƒ½");\n          if (loading) loading.classList.remove("active");\n          if (mainContainer) mainContainer.style.display = "block";\n          return;\n        }\n        \n        const messages = await window.getChatMessages(0, { include_swipe: true });\n        if (!messages || messages.length === 0) {\n          alert("æœªæ‰¾åˆ°æ¶ˆæ¯");\n          if (loading) loading.classList.remove("active");\n          if (mainContainer) mainContainer.style.display = "block";\n          return;\n        }\n        \n        const content = messages[0].swipes[id];\n        if (!content) {\n          alert("è¯¥å¼€åœºç™½æš‚æ— å†…å®¹");\n          if (loading) loading.classList.remove("active");\n          if (mainContainer) mainContainer.style.display = "block";\n          return;\n        }\n        \n        await window.setChatMessage(content, 0, { swipe_id: id, refresh: "display_and_render_current" });\n        \n        setTimeout(() => {\n          if (loading) loading.classList.remove("active");\n          if (mainContainer) mainContainer.style.display = "block";\n        }, 500);\n      } catch (err) {\n        console.error("åˆ‡æ¢å¤±è´¥:", err);\n        alert("åˆ‡æ¢å¤±è´¥: " + err.message);\n        const loading = document.getElementById("loading");\n        const mainContainer = document.getElementById("mainContainer");\n        if (loading) loading.classList.remove("active");\n        if (mainContainer) mainContainer.style.display = "block";\n      }\n    }'}\n<\/script>\n\nã€é‡è¦ã€‘æ¯ä¸ª .scene-card å¿…é¡»æ·»åŠ  onclick="switchGreeting(åºå·)" å±æ€§ï¼Œä¾‹å¦‚ï¼š\n<div class="scene-card" onclick="switchGreeting(0)">\n\nã€é‡è¦ã€‘å¿…é¡»åŒ…å«ä¸€ä¸ª loading æç¤ºå…ƒç´ ï¼š\n<div class="loading" id="loading" style="display: none; text-align: center; padding: 40px;">\n  <p style="color: #888; font-size: 18px;">åˆ‡æ¢ä¸­...</p>\n</div>\n\nè¯·ç”Ÿæˆå®Œæ•´çš„HTMLä»£ç ï¼Œç¡®ä¿åŒ…å«ä»¥ä¸Šæ‰€æœ‰è¦æ±‚ï¼š`;console.log('å¼€å§‹ AI ç”Ÿæˆç•Œé¢æ ·å¼...');const i=w(o.value.api_endpoint,'/chat/completions');console.log('ğŸ”— è§„èŒƒåŒ–åçš„ç«¯ç‚¹:',i);const l=await fetch(i,{method:'POST',headers:{'Content-Type':'application/json',Authorization:`Bearer ${o.value.api_key}`},body:JSON.stringify({model:o.value.model,messages:[{role:'system',content:t},{role:'user',content:a}],temperature:o.value.temperature,max_tokens:o.value.max_tokens,top_p:o.value.top_p,presence_penalty:o.value.presence_penalty,frequency_penalty:o.value.frequency_penalty})});if(!l.ok){const e=await l.text();throw new Error(`API è¯·æ±‚å¤±è´¥: ${l.status} ${l.statusText}\n${e}`)}const d=await l.json();console.log('âœ… [æ ·å¼ç”Ÿæˆ] API å®Œæ•´å“åº”:',d);let c=d.choices?.[0]?.message?.content?.trim()||'';if(console.log('ğŸ“ [æ ·å¼ç”Ÿæˆ] AI åŸå§‹è¿”å›:',c?c.substring(0,500):'(ç©º)'),!c){if(console.error('âŒ [æ ·å¼ç”Ÿæˆ] AI å“åº”ä¸ºç©º'),console.error('å®Œæ•´å“åº”:',JSON.stringify(d,null,2)),d.error)throw new Error(`API é”™è¯¯: ${d.error.message||JSON.stringify(d.error)}`);throw new Error('AI æœªè¿”å›æœ‰æ•ˆå†…å®¹ï¼Œè¯·æ£€æŸ¥ API é…ç½®å’Œæ¨¡å‹æ˜¯å¦æ”¯æŒè¯¥ä»»åŠ¡')}if(c=c.replace(/^```html\n?|^```\n?|```$/gm,'').trim(),!c)throw new Error('AI è¿”å›å†…å®¹æ¸…ç†åä¸ºç©º');console.log('âœ¨ [æ ·å¼ç”Ÿæˆ] AI æ¸…ç†åçš„HTMLé•¿åº¦:',c.length),s.value.customHtml=c,P(),y().success('ç•Œé¢æ ·å¼ç”ŸæˆæˆåŠŸï¼è¯·æŸ¥çœ‹å³ä¾§é¢„è§ˆ'),N.value=!1,ke()}catch(e){console.error('âŒ [æ ·å¼ç”Ÿæˆ] AI ç”Ÿæˆå¤±è´¥:',e),y().error('ç”Ÿæˆå¤±è´¥: '+e.message,'',{timeOut:5e3})}finally{I.value=!1}}else y().warning('è¯·è¾“å…¥ç•Œé¢é£æ ¼æè¿°')}async function F(){if(!V())return void y().warning('æœªæ‰¾åˆ°è§’è‰²å¡');if(s.value.customHtml&&s.value.customHtml.trim())return g.value=s.value.customHtml,void(c.value=!0);const e=['<html>','<head>','  <meta charset="UTF-8">','  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">','  <style>','    * { margin: 0; padding: 0; box-sizing: border-box; }','    html, body { height: 100%; }','    body {','      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;','      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);','      padding: 20px; min-height: 100%; height: auto; display: flex; align-items: center; justify-content: center;','      overflow-y: auto;','    }','    .container { max-width: 900px; width: 100%; height: auto; background: rgba(255, 255, 255, 0.95);','      border-radius: 20px; padding: 40px; box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3); margin: 20px auto; }','    .header { text-align: center; margin-bottom: 40px; }','    .header h1 { font-size: 32px; color: #333; margin-bottom: 10px; }','    .header p { color: #666; font-size: 16px; }','    .scene-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(250px, 1fr)); gap: 20px; }','    .scene-card { background: white; border: 2px solid #e0e0e0; border-radius: 15px;','      padding: 25px; cursor: pointer; transition: all 0.3s ease; position: relative; overflow: hidden; }','    .scene-card:hover { transform: translateY(-5px); border-color: #667eea;','      box-shadow: 0 10px 30px rgba(102, 126, 234, 0.3); }','    .card-badge { position: absolute; top: 10px; right: 10px; background: #667eea;','      color: white; padding: 4px 10px; border-radius: 12px; font-size: 12px; font-weight: bold; }','    .card-icon { font-size: 48px; margin-bottom: 15px; text-align: center; }','    .card-title { font-size: 20px; font-weight: 600; color: #333; margin-bottom: 10px; }','    .card-desc { font-size: 14px; color: #666; line-height: 1.5; }','    .loading { display: none; text-align: center; padding: 40px; }','    .loading.active { display: block; }','  </style>','</head>','<body>','  <div class="container" id="mainContainer">','    <div class="header">','      <h1>å¼€åœºç™½é€‰æ‹©</h1>','      <p>é€‰æ‹©ä¸€ä¸ªåœºæ™¯å¼€å§‹ä½ çš„æ•…äº‹</p>','    </div>','    <div class="scene-grid" id="sceneGrid">',r.value.map((e,n)=>{const t=e.icon||'<i class="fa-solid fa-comment"></i>',a=e.title||(0===n?'é»˜è®¤å¼€åœºç™½':`å¼€åœºç™½ ${n}`),o=e.description||'ç‚¹å‡»å¼€å§‹å¯¹è¯';return'        <div class="scene-card" onclick="switchGreeting('+n+')"><div class="card-badge">'+(0===n?'é»˜è®¤':String(n).padStart(2,'0'))+'</div><div class="card-icon">'+t+'</div><div class="card-title">'+a+'</div><div class="card-desc">'+o+'</div></div>'}).join('\n\n'),'    </div>','  </div>','  <div class="loading" id="loading"><p>åˆ‡æ¢ä¸­...</p></div>','  <script>','    async function switchGreeting(id) {','      try {','        const loading = document.getElementById("loading");','        const mainContainer = document.getElementById("mainContainer");','        loading.classList.add("active"); mainContainer.style.display = "none";','        const messages = await getChatMessages(0, { include_swipe: true });','        if (!messages || messages.length === 0) { alert("æœªæ‰¾åˆ°æ¶ˆæ¯"); return; }','        const content = messages[0].swipes[id];','        if (!content) { alert("è¯¥å¼€åœºç™½æš‚æ— å†…å®¹"); return; }','        await setChatMessage(content, 0, { swipe_id: id, refresh: "display_and_render_current" });','        setTimeout(() => { loading.classList.remove("active"); mainContainer.style.display = "block"; }, 500);','      } catch (err) { console.error("åˆ‡æ¢å¤±è´¥:", err); alert("åˆ‡æ¢å¤±è´¥: " + err.message); }','    }','  <\/script>','</body>','</html>'].join('\n').replace('const messages = await getChatMessages','if (typeof window.getChatMessages !== "function") { alert("è¯·åœ¨é…’é¦†ç¯å¢ƒä¸­ä½¿ç”¨"); loading.classList.remove("active"); mainContainer.style.display = "block"; return; }\n        const messages = await window.getChatMessages').replace('await setChatMessage','await window.setChatMessage').replace('alert("æœªæ‰¾åˆ°æ¶ˆæ¯"); return;','alert("æœªæ‰¾åˆ°æ¶ˆæ¯"); loading.classList.remove("active"); mainContainer.style.display = "block"; return;').replace('alert("è¯¥å¼€åœºç™½æš‚æ— å†…å®¹"); return;','alert("è¯¥å¼€åœºç™½æš‚æ— å†…å®¹"); loading.classList.remove("active"); mainContainer.style.display = "block"; return;');g.value=e,c.value=!0,u.value='å¤åˆ¶ä»£ç '}async function L(){await(0,d.lW)(g.value,'âœ… ä»£ç å·²å¤åˆ¶åˆ°å‰ªè´´æ¿')&&(u.value='âœ“ å·²å¤åˆ¶',setTimeout(()=>{u.value='å¤åˆ¶ä»£ç '},2e3))}function H(){c.value=!1}function ke(){if(0===r.value.length)return void(C.value='');const e=V(),n=e?.name||'è§’è‰²';if(s.value.customHtml&&s.value.customHtml.trim()){console.log('ğŸ¨ ä½¿ç”¨AIç”Ÿæˆçš„è‡ªå®šä¹‰HTMLé¢„è§ˆ');try{const e=r.value.map((e,n)=>{const t=e.icon||'ğŸ’¬',a=e.title||(0===n?'é»˜è®¤å¼€åœºç™½':`å¼€åœºç™½ ${n}`),o=e.description||'ç‚¹å‡»å¼€å§‹å¯¹è¯';return`\n        <div class="scene-card">\n          <div class="card-badge">${0===n?'é»˜è®¤':String(n).padStart(2,'0')}</div>\n          <div class="card-icon">${t}</div>\n          <div class="card-title">${a}</div>\n          <div class="card-desc">${o}</div>\n        </div>`}).join('\n');let n=s.value.customHtml;const t=[/(<div[^>]*class="scene-grid"[^>]*>)([\s\S]*?)(<\/div>)/i,/(<div[^>]*class="[^"]*grid[^"]*"[^>]*>)([\s\S]*?)(<\/div>)/i,/(<div[^>]*class="[^"]*cards[^"]*"[^>]*>)([\s\S]*?)(<\/div>)/i,/(<div[^>]*class="[^"]*container[^"]*"[^>]*>[\s\S]*?<div[^>]*class="[^"]*grid[^"]*"[^>]*>)([\s\S]*?)(<\/div>)/i];for(const a of t){if(n.match(a))return n=n.replace(a,`$1\n${e}\n      $3`),C.value=n,void console.log('âœ… è‡ªå®šä¹‰HTMLé¢„è§ˆæ›´æ–°æˆåŠŸï¼ˆå­—ç¬¦ä¸²æ›¿æ¢ï¼‰')}console.warn('âš ï¸ æœªæ‰¾åˆ°åˆé€‚çš„å¡ç‰‡å®¹å™¨ï¼Œå°è¯•åœ¨bodyä¸­æ’å…¥');const a=/(<body[^>]*>)([\s\S]*?)(<\/body>)/i;if(n.match(a))return n=n.replace(a,`$1$2\n<div class="scene-grid">\n${e}\n</div>\n$3`),C.value=n,void console.log('âœ… å·²åœ¨bodyä¸­æ’å…¥å¡ç‰‡');console.warn('âš ï¸ æ— æ³•å¤„ç†è‡ªå®šä¹‰HTMLï¼Œä½¿ç”¨åŸå§‹HTML'),C.value=s.value.customHtml}catch(e){console.error('âŒ è§£æè‡ªå®šä¹‰HTMLå¤±è´¥:',e),y().warning('è‡ªå®šä¹‰HTMLè§£æå¤±è´¥ï¼Œä½¿ç”¨é»˜è®¤æ ·å¼')}}console.log('ğŸ“ ä½¿ç”¨é»˜è®¤æ ·å¼é¢„è§ˆ');const t=['<html>','<head>','  <meta charset="UTF-8">','  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">','  <style>','    * { margin: 0; padding: 0; box-sizing: border-box; }','    html, body { height: 100%; }','    body {','      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;','      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);','      padding: 20px; min-height: 100%; height: auto; display: flex; align-items: center; justify-content: center;','      overflow-y: auto;','    }','    .container { max-width: 900px; width: 100%; height: auto; background: rgba(255, 255, 255, 0.95);','      border-radius: 20px; padding: 40px; box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3); margin: 20px auto; }','    .header { text-align: center; margin-bottom: 40px; }','    .header h1 { font-size: 32px; color: #333; margin-bottom: 10px; }','    .header p { color: #666; font-size: 16px; }','    .scene-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(250px, 1fr)); gap: 20px; }','    .scene-card { background: white; border: 2px solid #e0e0e0; border-radius: 15px;','      padding: 25px; cursor: pointer; transition: all 0.3s ease; position: relative; overflow: hidden; }','    .scene-card:hover { transform: translateY(-5px); border-color: #667eea;','      box-shadow: 0 10px 30px rgba(102, 126, 234, 0.3); }','    .scene-card:active { transform: translateY(-2px); }','    .card-badge { position: absolute; top: 10px; right: 10px; background: #667eea;','      color: white; padding: 4px 10px; border-radius: 12px; font-size: 12px; font-weight: bold; }','    .card-icon { font-size: 48px; margin-bottom: 15px; text-align: center; }','    .card-title { font-size: 20px; font-weight: 600; color: #333; margin-bottom: 10px; }','    .card-desc { font-size: 14px; color: #666; line-height: 1.5; }','  </style>','</head>','<body>','  <div class="container">','    <div class="header">',`      <h1>${n} çš„å¼€åœºç™½</h1>`,'      <p>é€‰æ‹©ä¸€ä¸ªåœºæ™¯å¼€å§‹ä½ çš„æ•…äº‹</p>','    </div>','    <div class="scene-grid">',r.value.map((e,n)=>{const t=e.icon||'<i class="fa-solid fa-comment"></i>',a=e.title||(0===n?'é»˜è®¤å¼€åœºç™½':`å¼€åœºç™½ ${n}`),o=e.description||'ç‚¹å‡»å¼€å§‹å¯¹è¯';return'        <div class="scene-card"><div class="card-badge">'+(0===n?'é»˜è®¤':String(n).padStart(2,'0'))+'</div><div class="card-icon">'+t+'</div><div class="card-title">'+a+'</div><div class="card-desc">'+o+'</div></div>'}).join('\n\n'),'    </div>','  </div>','</body>','</html>'].join('\n');C.value=t}function Ae(){if(!C.value)return void y().error('æ²¡æœ‰å¯é¢„è§ˆçš„å†…å®¹');const e=V(),n=e?`${e.name} - å¼€åœºç™½é€‰æ‹©`:'å¼€åœºç™½é¢„è§ˆ',t=window.open('','_blank','width=1200,height=800,menubar=no,toolbar=no,location=no,status=no');t?(t.document.write(C.value),t.document.close(),t.document.title=n,y().success('å·²åœ¨æ–°çª—å£æ‰“å¼€é¢„è§ˆ')):y().error('æ— æ³•æ‰“å¼€æ–°çª—å£ï¼Œè¯·æ£€æŸ¥æµè§ˆå™¨å¼¹çª—è®¾ç½®')}async function Ce(){try{if(await F(),!g.value)return void y().error('è¯·å…ˆç”Ÿæˆä»£ç ');const e=V(),n=e?.name||'è§’è‰²',t={id:crypto.randomUUID(),scriptName:`${n}-å¼€åœºç™½å‰ç«¯`,disabled:!1,runOnEdit:!0,findRegex:'/ã€å¼€åœºç™½ã€‘/g',replaceString:'```html\n'+g.value+'\n```',trimStrings:[],placement:[1,2],substituteRegex:0,minDepth:null,maxDepth:null,markdownOnly:!0,promptOnly:!1},a=JSON.stringify(t,null,4),o=new Blob([a],{type:'application/json'}),r=URL.createObjectURL(o),s=document.createElement('a');s.href=r,s.download=`${n}-å¼€åœºç™½å‰ç«¯.json`,document.body.appendChild(s),s.click(),document.body.removeChild(s),URL.revokeObjectURL(r),y().success('å·²ç”Ÿæˆå¹¶ä¸‹è½½JSONæ–‡ä»¶')}catch(e){console.error('ä¸‹è½½å¤±è´¥:',e),y().error('ä¸‹è½½å¤±è´¥: '+e.message)}}return(0,i.onMounted)(()=>{M()}),(e,n)=>((0,i.openBlock)(),(0,i.createElementBlock)('div',G,[(0,i.createCommentVNode)(' æ ‡é¢˜åŒºåŸŸ '),(0,i.createElementVNode)('div',Y,[n[32]||(n[32]=(0,i.createElementVNode)('h3',{style:{margin:'0',color:'#fff','font-size':'15px !important','font-weight':'bold',display:'flex','align-items':'center',gap:'8px'}},[(0,i.createElementVNode)('i',{class:'fa-solid fa-comments',style:{color:'#667eea'}}),(0,i.createTextVNode)(' å¼€åœºç™½ç®¡ç†å™¨ ')],-1)),(0,i.createElementVNode)('div',J,[r.value.length>0?((0,i.openBlock)(),(0,i.createElementBlock)('span',W,(0,i.toDisplayString)(r.value.length)+' ä¸ªå¼€åœºç™½ ',1)):(0,i.createCommentVNode)('v-if',!0),r.value.length>0?((0,i.openBlock)(),(0,i.createElementBlock)('button',{key:1,class:'mini-button',style:(0,i.normalizeStyle)([{padding:'6px 12px',background:'#2a2a2a',border:'1px solid #3a3a3a','border-radius':'4px',cursor:'pointer','font-size':'12px',transition:'all 0.2s',display:'flex','align-items':'center',gap:'6px'},{color:A.value?'#667eea':'#e0e0e0',borderColor:A.value?'#667eea':'#3a3a3a'}]),onClick:n[0]||(n[0]=e=>A.value=!A.value)},[n[28]||(n[28]=(0,i.createElementVNode)('i',{class:'fa-solid fa-circle-question'},null,-1)),(0,i.createTextVNode)(' '+(0,i.toDisplayString)(A.value?'éšè—å¸®åŠ©':'æ˜¾ç¤ºå¸®åŠ©'),1)],4)):(0,i.createCommentVNode)('v-if',!0),r.value.length>0?((0,i.openBlock)(),(0,i.createElementBlock)('button',{key:2,class:'mini-button',style:{padding:'6px 12px',background:'#dc2626',border:'none','border-radius':'4px',color:'white',cursor:'pointer','font-size':'12px','font-weight':'600',transition:'all 0.2s',display:'flex','align-items':'center',gap:'6px'},onClick:D,onMouseenter:n[1]||(n[1]=e=>e.currentTarget.style.transform='translateY(-2px)'),onMouseleave:n[2]||(n[2]=e=>e.currentTarget.style.transform='translateY(0)')},[...n[29]||(n[29]=[(0,i.createElementVNode)('i',{class:'fa-solid fa-eraser'},null,-1),(0,i.createTextVNode)(' æ¸…ç©ºé…ç½® ',-1)])],32)):(0,i.createCommentVNode)('v-if',!0),r.value.length>0?((0,i.openBlock)(),(0,i.createElementBlock)('button',{key:3,class:'mini-button',style:{padding:'6px 12px',background:'linear-gradient(135deg, #fbbf24 0%, #f59e0b 100%)',border:'none','border-radius':'4px',color:'white',cursor:'pointer','font-size':'12px','font-weight':'600',transition:'all 0.2s',display:'flex','align-items':'center',gap:'6px'},onClick:n[3]||(n[3]=e=>N.value=!0),onMouseenter:n[4]||(n[4]=e=>e.currentTarget.style.transform='translateY(-2px)'),onMouseleave:n[5]||(n[5]=e=>e.currentTarget.style.transform='translateY(0)')},[...n[30]||(n[30]=[(0,i.createElementVNode)('i',{class:'fa-solid fa-wand-magic-sparkles'},null,-1),(0,i.createTextVNode)(' AIç”Ÿæˆç•Œé¢æ ·å¼ ',-1)])],32)):(0,i.createCommentVNode)('v-if',!0),(0,i.createElementVNode)('button',{class:'mini-button refresh-button',style:{padding:'6px 12px',background:'#2a2a2a',border:'1px solid #3a3a3a','border-radius':'4px',color:'#e0e0e0',cursor:'pointer','font-size':'12px',transition:'all 0.2s',display:'flex','align-items':'center',gap:'6px'},onClick:M},[...n[31]||(n[31]=[(0,i.createElementVNode)('i',{class:'fa-solid fa-refresh'},null,-1),(0,i.createTextVNode)(' åˆ·æ–° ',-1)])])])]),(0,i.createCommentVNode)(' ä¸»å†…å®¹åŒºåŸŸï¼šå·¦å³ä¸¤æ  '),(0,i.createElementVNode)('div',q,[(0,i.createCommentVNode)(' å·¦ä¾§ï¼šé…ç½®åŒºåŸŸ '),(0,i.createElementVNode)('div',K,[(0,i.createCommentVNode)(' ç©ºçŠ¶æ€ / ä½¿ç”¨è¯´æ˜ '),0===r.value.length?((0,i.openBlock)(),(0,i.createElementBlock)('div',X,[...n[33]||(n[33]=[(0,i.createElementVNode)('i',{class:'fa-solid fa-comment-dots',style:{'font-size':'64px','margin-bottom':'20px',opacity:'0.3'}},null,-1),(0,i.createElementVNode)('div',{style:{'font-size':'18px','font-weight':'600',color:'#e0e0e0','margin-bottom':'10px'}},'æš‚æ— å¼€åœºç™½',-1),(0,i.createElementVNode)('div',{style:{'font-size':'14px',color:'#888','max-width':'400px','line-height':'1.6'}},' è¯·åœ¨é…’é¦†ä¸­é€‰æ‹©ä¸€ä¸ªæœ‰å¼€åœºç™½çš„è§’è‰²å¡ï¼Œæˆ–ç‚¹å‡»ä¸Šæ–¹çš„åˆ·æ–°æŒ‰é’® ',-1)])])):A.value?((0,i.openBlock)(),(0,i.createElementBlock)(i.Fragment,{key:1},[(0,i.createCommentVNode)(' ä½¿ç”¨è¯´æ˜ '),(0,i.createElementVNode)('div',Q,[(0,i.createElementVNode)('div',Z,[n[35]||(n[35]=(0,i.createElementVNode)('h4',{style:{color:'#667eea',margin:'0',display:'flex','align-items':'center',gap:'8px'}},[(0,i.createElementVNode)('i',{class:'fa-solid fa-circle-info'}),(0,i.createTextVNode)(' ä½¿ç”¨è¯´æ˜ ')],-1)),(0,i.createElementVNode)('button',{style:{background:'transparent',border:'none',color:'#888',cursor:'pointer','font-size':'18px',padding:'4px'},onClick:n[6]||(n[6]=e=>A.value=!1)},[...n[34]||(n[34]=[(0,i.createElementVNode)('i',{class:'fa-solid fa-times'},null,-1)])])]),n[36]||(n[36]=(0,i.createStaticVNode)('<ol style="color:#ccc;margin:0;padding-left:20px;line-height:1.8;" data-v-3100a601><li data-v-3100a601>å·¥å…·ä¼šè‡ªåŠ¨è¯»å–å½“å‰è§’è‰²å¡çš„æ‰€æœ‰å¼€åœºç™½</li><li data-v-3100a601>ä¸ºæ¯ä¸ªå¼€åœºç™½è®¾ç½®å›¾æ ‡ã€æ ‡é¢˜å’Œæè¿°</li><li data-v-3100a601>ä½¿ç”¨AIç”Ÿæˆæè¿°åŠŸèƒ½ï¼Œæ ¹æ®å¼€åœºç™½å†…å®¹è‡ªåŠ¨ç”Ÿæˆå¸å¼•äººçš„æè¿°</li><li data-v-3100a601>ç‚¹å‡»&quot;AIç”Ÿæˆç•Œé¢æ ·å¼&quot;æŒ‰é’®ï¼Œæè¿°ä½ æƒ³è¦çš„é£æ ¼ï¼ˆå¦‚ï¼šæ·±è“è‰²èƒŒæ™¯ã€é‡‘è‰²æ ‡é¢˜ï¼‰</li><li data-v-3100a601>AIä¼šæ ¹æ®ä½ çš„æè¿°ç”Ÿæˆå®Œæ•´çš„HTMLæ ·å¼ä»£ç </li><li data-v-3100a601>å³ä¾§å®æ—¶é¢„è§ˆç”Ÿæˆçš„ç•Œé¢æ ·å¼æ•ˆæœ</li><li data-v-3100a601>ç‚¹å‡»&quot;ç”Ÿæˆå‰ç«¯é€‰æ‹©ç•Œé¢ä»£ç &quot;æŸ¥çœ‹å®Œæ•´ä»£ç </li><li data-v-3100a601>ç‚¹å‡»&quot;ä¸‹è½½ä¸ºSTScript JSON&quot;å¯¼å‡ºé…ç½®æ–‡ä»¶</li><li data-v-3100a601>åœ¨é…’é¦†ä¸­å¯¼å…¥JSONæ–‡ä»¶ï¼Œè¾“å…¥ /ã€å¼€åœºç™½ã€‘ ä½¿ç”¨</li></ol><div style="margin-top:15px;padding-top:15px;border-top:1px solid #3a3a3a;" data-v-3100a601><p style="color:#888;font-size:13px;margin:0;" data-v-3100a601><i class="fa-solid fa-lightbulb" style="color:#ffc107;" data-v-3100a601></i><strong data-v-3100a601>æç¤ºï¼š</strong>ç”Ÿæˆçš„åºå·å¯¹åº”è§’è‰²å¡ä¸­çš„å¼€åœºç™½åºå·ï¼ˆ0ä¸ºé»˜è®¤å¼€åœºç™½ï¼‰ </p></div>',2))])],2112)):((0,i.openBlock)(),(0,i.createElementBlock)(i.Fragment,{key:2},[(0,i.createCommentVNode)(' å¼€åœºç™½åˆ—è¡¨ '),(0,i.createElementVNode)('div',ee,[((0,i.openBlock)(!0),(0,i.createElementBlock)(i.Fragment,null,(0,i.renderList)(r.value,(e,t)=>((0,i.openBlock)(),(0,i.createElementBlock)('div',{key:t,class:'greeting-item',style:{background:'#2a2a2a',border:'1px solid #3a3a3a','border-radius':'8px',padding:'15px',transition:'all 0.3s ease'}},[(0,i.createCommentVNode)(' é¡¶éƒ¨ä¿¡æ¯æ  '),(0,i.createElementVNode)('div',ne,[(0,i.createElementVNode)('span',te,' #'+(0,i.toDisplayString)(t),1),(0,i.withDirectives)((0,i.createElementVNode)('input',{'onUpdate:modelValue':n=>e.icon=n,style:{width:'60px','text-align':'center','font-size':'20px',background:'#1a1a1a',border:'1px solid #3a3a3a','border-radius':'6px',padding:'6px',color:'#e0e0e0'},placeholder:'å›¾æ ‡',maxlength:'4',onInput:P},null,40,ae),[[i.vModelText,e.icon]]),(0,i.withDirectives)((0,i.createElementVNode)('input',{'onUpdate:modelValue':n=>e.title=n,style:{flex:'1',background:'#1a1a1a',border:'1px solid #3a3a3a','border-radius':'6px',padding:'8px 12px',color:'#e0e0e0','font-size':'14px'},placeholder:0===t?'é»˜è®¤å¼€åœºç™½':`å¼€åœºç™½ ${t}`,onInput:P},null,40,oe),[[i.vModelText,e.title]]),(0,i.createElementVNode)('button',{style:{background:'linear-gradient(135deg, #fbbf24 0%, #f59e0b 100%)',border:'none',color:'white',padding:'8px 16px','border-radius':'6px',cursor:'pointer',transition:'all 0.2s ease',display:'flex','align-items':'center',gap:'6px','font-size':'13px','font-weight':'600','box-shadow':'0 2px 8px rgba(251, 191, 36, 0.3)'},title:'æ ¹æ®å¼€åœºç™½å†…å®¹è‡ªåŠ¨ç”Ÿæˆæè¿°',onClick:e=>async function(e){k.value=e,m.value=!0,x.value=!0;const n=e;if(n<0||n>=r.value.length)return x.value=!1,void(m.value=!1);try{if(!o.value.api_endpoint||!o.value.api_key)return y().error('è¯·å…ˆåœ¨è®¾ç½®é¡µé¢é…ç½® API ç«¯ç‚¹å’Œ API Key'),m.value=!1,void(x.value=!1);const e=V();if(!e)return y().error('æœªæ‰¾åˆ°è§’è‰²å¡'),m.value=!1,void(x.value=!1);const t=[e.first_mes,...e.data?.alternate_greetings||[]][n]||'';if(!t.trim())return y().warning('è¯¥å¼€åœºç™½å†…å®¹ä¸ºç©º'),m.value=!1,void(x.value=!1);const a='ä½ æ˜¯ä¸€ä¸ªä¸“ä¸šçš„æ–‡æ¡ˆç¼–è¾‘åŠ©æ‰‹ï¼Œæ“…é•¿ä¸ºå°è¯´ã€æ¸¸æˆç­‰åˆ›ä½œç®€æ´å¸å¼•äººçš„å¼€åœºç™½æè¿°ã€‚\n\nè¦æ±‚ï¼š\n1. æè¿°è¦ç®€æ´æœ‰åŠ›ï¼Œæ§åˆ¶åœ¨ 20-50 å­—ä»¥å†…\n2. çªå‡ºå¼€åœºç™½çš„æ ¸å¿ƒåœºæ™¯ã€æƒ…æ„Ÿæˆ–å†²çªç‚¹\n3. ä½¿ç”¨å¸å¼•äººçš„è¯­è¨€ï¼Œè®©è¯»è€…äº§ç”Ÿé˜…è¯»å…´è¶£\n4. ä¸è¦ä½¿ç”¨"è¿™æ˜¯ä¸€ä¸ª..."ã€"åœ¨è¿™ä¸ªå¼€åœºç™½ä¸­..."ç­‰å†—ä½™è¡¨è¿°\n5. ç›´æ¥è¾“å‡ºæè¿°æ–‡æœ¬ï¼Œä¸è¦æ·»åŠ å¼•å·æˆ–å…¶ä»–æ ‡è®°',s=`è¯·ä¸ºä»¥ä¸‹å¼€åœºç™½å†…å®¹ç”Ÿæˆä¸€ä¸ªç®€æ´å¸å¼•äººçš„æè¿°ï¼š\n\n${t}\n\nç›´æ¥è¾“å‡ºæè¿°æ–‡æœ¬ï¼š`;console.log('å¼€å§‹ AI ç”Ÿæˆæè¿°...');const i=w(o.value.api_endpoint,'/chat/completions');console.log('ğŸ”— è§„èŒƒåŒ–åçš„ç«¯ç‚¹:',i);const l=await fetch(i,{method:'POST',headers:{'Content-Type':'application/json',Authorization:`Bearer ${o.value.api_key}`},body:JSON.stringify({model:o.value.model,messages:[{role:'system',content:a},{role:'user',content:s}],temperature:o.value.temperature,max_tokens:o.value.max_tokens,top_p:o.value.top_p,presence_penalty:o.value.presence_penalty,frequency_penalty:o.value.frequency_penalty})});if(!l.ok){const e=await l.text();throw new Error(`API è¯·æ±‚å¤±è´¥: ${l.status} ${l.statusText}\n${e}`)}const d=await l.json();console.log('âœ… [ç”Ÿæˆ] API å®Œæ•´å“åº”:',d);let c=d.choices?.[0]?.message?.content?.trim()||'';if(console.log('ğŸ“ [ç”Ÿæˆ] AI åŸå§‹è¿”å›:',c),!c){if(console.error('âŒ [ç”Ÿæˆ] AI å“åº”ä¸ºç©º'),console.error('å®Œæ•´å“åº”:',JSON.stringify(d,null,2)),d.error)throw new Error(`API é”™è¯¯: ${d.error.message||JSON.stringify(d.error)}`);if(!d.choices||0===d.choices.length)throw new Error('API è¿”å›æ ¼å¼é”™è¯¯ï¼šæ²¡æœ‰ choices å­—æ®µï¼Œè¯·æ£€æŸ¥ API ç«¯ç‚¹å’Œæ¨¡å‹');throw new Error('AI æœªè¿”å›æœ‰æ•ˆå†…å®¹ï¼Œè¯·æ£€æŸ¥ï¼š\n1. API Key æ˜¯å¦æœ‰æ•ˆ\n2. æ¨¡å‹æ˜¯å¦å¯ç”¨\n3. è´¦æˆ·ä½™é¢')}if(c=c.replace(/^["']|["']$/g,''),c=c.replace(/^```.*?\n?|```$/g,'').trim(),!c)throw new Error('AI è¿”å›å†…å®¹æ¸…ç†åä¸ºç©º');console.log('âœ¨ [ç”Ÿæˆ] AI æ¸…ç†åçš„æè¿°:',c),r.value[n].description=c,P(),y().success('æè¿°ç”ŸæˆæˆåŠŸ'),m.value=!1}catch(e){console.error('âŒ [ç”Ÿæˆ] AI ç”Ÿæˆå¤±è´¥:',e);const n='ç”Ÿæˆå¤±è´¥: '+e.message;y().error(n),setTimeout(()=>{},5e3)}finally{x.value=!1}}(t),onMouseenter:n[7]||(n[7]=e=>{e.currentTarget.style.transform='translateY(-2px)',e.currentTarget.style.boxShadow='0 4px 12px rgba(251, 191, 36, 0.5)'}),onMouseleave:n[8]||(n[8]=e=>{e.currentTarget.style.transform='translateY(0)',e.currentTarget.style.boxShadow='0 2px 8px rgba(251, 191, 36, 0.3)'})},[...n[37]||(n[37]=[(0,i.createElementVNode)('i',{class:'fa-solid fa-wand-magic-sparkles'},null,-1),(0,i.createElementVNode)('span',null,'AI ç”Ÿæˆæè¿°',-1)])],40,re),e.description?((0,i.openBlock)(),(0,i.createElementBlock)('button',{key:0,style:{background:'linear-gradient(135deg, #3b82f6 0%, #2563eb 100%)',border:'none',color:'white',padding:'8px 16px','border-radius':'6px',cursor:'pointer',transition:'all 0.2s ease',display:'flex','align-items':'center',gap:'6px','font-size':'13px','font-weight':'600','box-shadow':'0 2px 8px rgba(59, 130, 246, 0.3)'},title:'æ ¹æ®éœ€æ±‚ä¿®æ”¹å·²æœ‰æè¿°',onClick:e=>function(e){k.value=e,f.value=!0}(t),onMouseenter:n[9]||(n[9]=e=>{e.currentTarget.style.transform='translateY(-2px)',e.currentTarget.style.boxShadow='0 4px 12px rgba(59, 130, 246, 0.5)'}),onMouseleave:n[10]||(n[10]=e=>{e.currentTarget.style.transform='translateY(0)',e.currentTarget.style.boxShadow='0 2px 8px rgba(59, 130, 246, 0.3)'})},[...n[38]||(n[38]=[(0,i.createElementVNode)('i',{class:'fa-solid fa-edit'},null,-1),(0,i.createElementVNode)('span',null,'AI ç¼–è¾‘æè¿°',-1)])],40,se)):(0,i.createCommentVNode)('v-if',!0)]),(0,i.createCommentVNode)(' æè¿°è¾“å…¥æ¡† '),(0,i.withDirectives)((0,i.createElementVNode)('textarea',{'onUpdate:modelValue':n=>e.description=n,style:{width:'100%',background:'#1a1a1a',border:'1px solid #3a3a3a','border-radius':'6px',padding:'10px',color:'#e0e0e0','font-size':'13px','font-family':'inherit',resize:'vertical','min-height':'60px'},placeholder:'è¾“å…¥ç®€çŸ­æè¿°...',onInput:P},'            ',40,ie),[[i.vModelText,e.description]]),(0,i.createCommentVNode)(' æŸ¥çœ‹åŸæ–‡æŒ‰é’® '),(0,i.createElementVNode)('button',{style:{width:'100%',padding:'10px',background:'transparent',border:'1px solid #667eea','border-radius':'6px',color:'#667eea','font-size':'13px',cursor:'pointer',transition:'all 0.2s ease',display:'flex','align-items':'center','justify-content':'center',gap:'6px','margin-top':'10px'},onClick:e=>function(e){try{const n=V();if(!n)return void y().error('æœªæ‰¾åˆ°è§’è‰²å¡');const t=[n.first_mes,...n.data?.alternate_greetings||[]][e]||'';if(!t.trim())return void y().warning('è¯¥å¼€åœºç™½å†…å®¹ä¸ºç©º');S.value=t,T.value=!0}catch(e){console.error('æŸ¥çœ‹å¼€åœºç™½å¤±è´¥:',e),y().error('æŸ¥çœ‹å¼€åœºç™½å¤±è´¥: '+e.message)}}(t),onMouseenter:n[11]||(n[11]=e=>e.currentTarget.style.background='rgba(102, 126, 234, 0.1)'),onMouseleave:n[12]||(n[12]=e=>e.currentTarget.style.background='transparent')},[...n[39]||(n[39]=[(0,i.createElementVNode)('i',{class:'fa-solid fa-file-lines'},null,-1),(0,i.createElementVNode)('span',null,'æŸ¥çœ‹è§’è‰²å¡ä¸­çš„å¼€åœºç™½åŸæ–‡',-1)])],40,le)]))),128))])],2112)),(0,i.createCommentVNode)(' åº•éƒ¨æ“ä½œæŒ‰é’® '),r.value.length>0?((0,i.openBlock)(),(0,i.createElementBlock)('div',de,[(0,i.createElementVNode)('button',{style:{padding:'15px 35px',background:'linear-gradient(135deg, #667eea 0%, #764ba2 100%)',border:'none','border-radius':'10px',color:'white','font-size':'15px','font-weight':'600',cursor:'pointer',transition:'all 0.3s ease',display:'flex','align-items':'center',gap:'10px','box-shadow':'0 4px 15px rgba(102, 126, 234, 0.4)'},onClick:F,onMouseenter:n[13]||(n[13]=e=>{e.currentTarget.style.transform='translateY(-3px)',e.currentTarget.style.boxShadow='0 6px 20px rgba(102, 126, 234, 0.6)'}),onMouseleave:n[14]||(n[14]=e=>{e.currentTarget.style.transform='translateY(0)',e.currentTarget.style.boxShadow='0 4px 15px rgba(102, 126, 234, 0.4)'})},[...n[40]||(n[40]=[(0,i.createElementVNode)('i',{class:'fa-solid fa-code',style:{'font-size':'16px'}},null,-1),(0,i.createTextVNode)(' ç”ŸæˆHTMLä»£ç  ',-1)])],32),(0,i.createElementVNode)('button',{style:{padding:'15px 35px',background:'linear-gradient(135deg, #10b981 0%, #059669 100%)',border:'none','border-radius':'10px',color:'white','font-size':'15px','font-weight':'600',cursor:'pointer',transition:'all 0.3s ease',display:'flex','align-items':'center',gap:'10px','box-shadow':'0 4px 15px rgba(16, 185, 129, 0.4)'},onClick:Ce,onMouseenter:n[15]||(n[15]=e=>{e.currentTarget.style.transform='translateY(-3px)',e.currentTarget.style.boxShadow='0 6px 20px rgba(16, 185, 129, 0.6)'}),onMouseleave:n[16]||(n[16]=e=>{e.currentTarget.style.transform='translateY(0)',e.currentTarget.style.boxShadow='0 4px 15px rgba(16, 185, 129, 0.4)'})},[...n[41]||(n[41]=[(0,i.createElementVNode)('i',{class:'fa-solid fa-download',style:{'font-size':'16px'}},null,-1),(0,i.createTextVNode)(' ä¸‹è½½ä¸ºSTScript JSON ',-1)])],32)])):(0,i.createCommentVNode)('v-if',!0)]),(0,i.createCommentVNode)(' å³ä¾§ï¼šå®æ—¶é¢„è§ˆ '),(0,i.createElementVNode)('div',ce,[(0,i.createElementVNode)('div',pe,[n[43]||(n[43]=(0,i.createElementVNode)('h4',{style:{margin:'0',color:'white','font-size':'14px','font-weight':'600',display:'flex','align-items':'center',gap:'8px'}},[(0,i.createElementVNode)('i',{class:'fa-solid fa-eye'}),(0,i.createTextVNode)(' å®æ—¶é¢„è§ˆ ')],-1)),C.value?((0,i.openBlock)(),(0,i.createElementBlock)('button',{key:0,title:'æ–°çª—å£æ‰“å¼€',style:{width:'32px',height:'32px',background:'rgba(255, 255, 255, 0.2)',border:'none','border-radius':'6px',color:'white','font-size':'14px',cursor:'pointer',transition:'all 0.2s',display:'flex','align-items':'center','justify-content':'center'},onClick:Ae},[...n[42]||(n[42]=[(0,i.createElementVNode)('i',{class:'fa-solid fa-external-link-alt'},null,-1)])])):(0,i.createCommentVNode)('v-if',!0)]),(0,i.createElementVNode)('div',ge,[C.value?((0,i.openBlock)(),(0,i.createElementBlock)('iframe',{key:0,srcdoc:C.value,sandbox:'allow-scripts allow-same-origin allow-modals allow-forms',style:{width:'100%',height:'100%',border:'none',background:'white'}},null,8,ue)):((0,i.openBlock)(),(0,i.createElementBlock)('div',me,[...n[44]||(n[44]=[(0,i.createElementVNode)('div',null,[(0,i.createElementVNode)('i',{class:'fa-solid fa-eye-slash',style:{'font-size':'48px','margin-bottom':'15px',opacity:'0.3'}}),(0,i.createElementVNode)('p',{style:{margin:'0'}},'é…ç½®å¼€åœºç™½åå°†æ˜¾ç¤ºé¢„è§ˆ')],-1)])]))])])]),(0,i.createCommentVNode)(' AIç”Ÿæˆå¯¹è¯æ¡† '),(0,i.createVNode)(B,{show:m.value,'is-generating':x.value,title:'AI ç”Ÿæˆç®€çŸ­æè¿°',description:'AI æ­£åœ¨æ ¹æ®å¼€åœºç™½çš„å®é™…å†…å®¹è‡ªåŠ¨ç”Ÿæˆå¸å¼•äººçš„ç®€çŸ­æè¿°ï¼ˆ20-50å­—ï¼‰...','show-input':!1,onClose:j,onConfirm:()=>{}},null,8,['show','is-generating']),(0,i.createCommentVNode)(' AIç¼–è¾‘å¯¹è¯æ¡† '),(0,i.createVNode)(U,{show:f.value,'is-modifying':h.value,title:'AI ç¼–è¾‘ç®€çŸ­æè¿°',description:'æè¿°ä½ æƒ³è¦ä¿®æ”¹çš„åœ°æ–¹ï¼ŒAI ä¼šåœ¨å½“å‰æè¿°çš„åŸºç¡€ä¸Šè¿›è¡Œè°ƒæ•´ã€‚æ³¨æ„ï¼šä»…ä¿®æ”¹æè¿°ï¼Œä¸ä¼šæ”¹å˜å¼€åœºç™½å†…å®¹æœ¬èº«ã€‚',examples:['æ›´ç®€æ´ä¸€äº›','æ›´æ–‡è‰ºä¸€äº›','æ›´æ´»æ³¼ä¸€äº›','æ·»åŠ æƒ…æ„Ÿè‰²å½©'],onClose:n[17]||(n[17]=e=>f.value=!1),onConfirm:R},null,8,['show','is-modifying']),(0,i.createCommentVNode)(' AIç”Ÿæˆç•Œé¢æ ·å¼å¯¹è¯æ¡† '),(0,i.createVNode)(U,{show:N.value,'is-modifying':I.value,title:'AI ç”Ÿæˆå¼€åœºç™½ç•Œé¢æ ·å¼',description:'æè¿°ä½ æƒ³è¦çš„ç•Œé¢é£æ ¼ï¼ŒAI ä¼šç”Ÿæˆå®Œæ•´çš„HTMLæ ·å¼ä»£ç ã€‚ä¾‹å¦‚ï¼šæ·±è“è‰²èƒŒæ™¯ã€é‡‘è‰²æ ‡é¢˜ã€åœ†è§’å¡ç‰‡ç­‰ã€‚',examples:['æ·±è“è‰²æ¸å˜èƒŒæ™¯ï¼Œç™½è‰²åœ†è§’å¡ç‰‡ï¼Œé‡‘è‰²æ ‡é¢˜','ç²‰è‰²å¯çˆ±é£æ ¼ï¼Œå¸¦é˜´å½±çš„å¡ç‰‡','æ·±è‰²ç§‘æŠ€é£æ ¼ï¼Œéœ“è™¹ç¯æ•ˆæœ','å…¸é›…é‡‘è‰²é£æ ¼ï¼Œé«˜è´µå¤§æ°”','æ¸¸æˆåƒç´ é£æ ¼ï¼Œæ–¹å½¢å¡ç‰‡'],onClose:n[18]||(n[18]=e=>N.value=!1),onConfirm:O},null,8,['show','is-modifying']),(0,i.createCommentVNode)(' æŸ¥çœ‹å¼€åœºç™½åŸæ–‡å¯¹è¯æ¡† '),T.value?((0,i.openBlock)(),(0,i.createElementBlock)('div',{key:0,style:{position:'fixed',top:'0',left:'0',right:'0',bottom:'0',background:'rgba(0, 0, 0, 0.7)',display:'flex','align-items':'center','justify-content':'center','z-index':'10000',padding:'20px'},onClick:n[26]||(n[26]=(0,i.withModifiers)(e=>T.value=!1,['self']))},[(0,i.createElementVNode)('div',{style:{background:'linear-gradient(135deg, #1e3a8a 0%, #1e40af 100%)','border-radius':'12px',padding:'24px','max-width':'700px',width:'100%','max-height':'80vh',display:'flex','flex-direction':'column','box-shadow':'0 8px 32px rgba(0, 0, 0, 0.5)'},onClick:n[25]||(n[25]=(0,i.withModifiers)(()=>{},['stop']))},[(0,i.createCommentVNode)(' æ ‡é¢˜æ  '),(0,i.createElementVNode)('div',fe,[n[46]||(n[46]=(0,i.createElementVNode)('h3',{style:{margin:'0',color:'white',display:'flex','align-items':'center',gap:'8px'}},[(0,i.createElementVNode)('i',{class:'fa-solid fa-file-lines'}),(0,i.createElementVNode)('span',null,'å¼€åœºç™½åŸæ–‡')],-1)),(0,i.createElementVNode)('button',{style:{background:'transparent',border:'none',color:'rgba(255, 255, 255, 0.7)',cursor:'pointer','font-size':'20px',padding:'4px 8px',transition:'all 0.2s'},onClick:n[19]||(n[19]=e=>T.value=!1),onMouseenter:n[20]||(n[20]=e=>e.currentTarget.style.color='white'),onMouseleave:n[21]||(n[21]=e=>e.currentTarget.style.color='rgba(255, 255, 255, 0.7)')},[...n[45]||(n[45]=[(0,i.createElementVNode)('i',{class:'fa-solid fa-times'},null,-1)])],32)]),(0,i.createCommentVNode)(' å†…å®¹åŒºåŸŸ '),(0,i.createElementVNode)('div',xe,(0,i.toDisplayString)(S.value),1),(0,i.createCommentVNode)(' åº•éƒ¨æŒ‰é’® '),(0,i.createElementVNode)('div',be,[(0,i.createElementVNode)('button',{style:{padding:'10px 24px',background:'white',border:'none','border-radius':'6px',color:'#1e3a8a','font-size':'14px','font-weight':'600',cursor:'pointer',transition:'all 0.2s'},onClick:n[22]||(n[22]=e=>T.value=!1),onMouseenter:n[23]||(n[23]=e=>e.currentTarget.style.transform='translateY(-2px)'),onMouseleave:n[24]||(n[24]=e=>e.currentTarget.style.transform='translateY(0)')},' å…³é—­ ',32)])])])):(0,i.createCommentVNode)('v-if',!0),(0,i.createCommentVNode)(' ç”Ÿæˆä»£ç å¯¹è¯æ¡† '),c.value?((0,i.openBlock)(),(0,i.createElementBlock)('div',{key:1,style:{position:'fixed',top:'0',left:'0',right:'0',bottom:'0',background:'rgba(0, 0, 0, 0.7)',display:'flex','align-items':'center','justify-content':'center','z-index':'10000','backdrop-filter':'blur(5px)'},onClick:H},[(0,i.createElementVNode)('div',{style:{background:'#2a2a2a','border-radius':'15px','max-width':'800px',width:'90%','max-height':'80vh',display:'flex','flex-direction':'column','box-shadow':'0 20px 60px rgba(0, 0, 0, 0.5)'},onClick:n[27]||(n[27]=(0,i.withModifiers)(()=>{},['stop']))},[(0,i.createElementVNode)('div',{style:{padding:'20px','border-bottom':'1px solid #3a3a3a',display:'flex','justify-content':'space-between','align-items':'center'}},[n[48]||(n[48]=(0,i.createElementVNode)('h3',{style:{color:'#e0e0e0','font-size':'18px',margin:'0',display:'flex','align-items':'center',gap:'10px'}},[(0,i.createElementVNode)('i',{class:'fa-solid fa-code'}),(0,i.createTextVNode)(' ç”Ÿæˆçš„å‰ç«¯ä»£ç  ')],-1)),(0,i.createElementVNode)('button',{style:{background:'transparent',border:'none',color:'#888','font-size':'20px',cursor:'pointer',padding:'5px 10px',transition:'color 0.2s ease'},onClick:H},[...n[47]||(n[47]=[(0,i.createElementVNode)('i',{class:'fa-solid fa-times'},null,-1)])])]),(0,i.createElementVNode)('div',he,[n[50]||(n[50]=(0,i.createElementVNode)('div',{style:{background:'#1a1a1a',border:'1px solid #3a3a3a','border-radius':'8px',padding:'15px','margin-bottom':'20px',color:'#e0e0e0'}},[(0,i.createElementVNode)('p',{style:{'margin-bottom':'10px','font-weight':'600'}},[(0,i.createElementVNode)('strong',null,'ä½¿ç”¨æ–¹æ³•ï¼š')]),(0,i.createElementVNode)('ol',{style:{'margin-left':'20px',color:'#aaa','line-height':'1.8'}},[(0,i.createElementVNode)('li',null,'å¤åˆ¶ä¸‹é¢çš„ä»£ç '),(0,i.createElementVNode)('li',null,[(0,i.createTextVNode)(' åœ¨æ¶ˆæ¯ä¸­è¾“å…¥å ä½ç¬¦ï¼ˆå¦‚ '),(0,i.createElementVNode)('code',{style:{background:'#2a2a2a',padding:'2px 6px','border-radius':'4px',color:'#667eea'}},'ã€å¼€åœºç™½ã€‘'),(0,i.createTextVNode)('ï¼‰ ')]),(0,i.createElementVNode)('li',null,'åˆ›å»ºæ­£åˆ™è„šæœ¬ï¼Œå°†å ä½ç¬¦æ›¿æ¢ä¸ºæ­¤ä»£ç ')])],-1)),(0,i.createElementVNode)('div',ye,[(0,i.createElementVNode)('pre',ve,[(0,i.createElementVNode)('code',we,(0,i.toDisplayString)(g.value),1)])]),(0,i.createElementVNode)('button',{style:{width:'100%',background:'linear-gradient(135deg, #667eea 0%, #764ba2 100%)',color:'white',border:'none',padding:'12px','border-radius':'8px','font-size':'14px','font-weight':'600',cursor:'pointer',transition:'all 0.3s ease',display:'flex','align-items':'center','justify-content':'center',gap:'8px'},onClick:L},[n[49]||(n[49]=(0,i.createElementVNode)('i',{class:'fa-solid fa-copy'},null,-1)),(0,i.createTextVNode)(' '+(0,i.toDisplayString)(u.value),1)])])])])):(0,i.createCommentVNode)('v-if',!0)]))}});s(200);const Ae=(0,V.A)(ke,[['__scopeId','data-v-3100a601']]),Ce={class:'help-tab',style:{padding:'25px !important',background:'#1a1a1a !important'}},Ee={style:{background:'linear-gradient(135deg, #667eea 0%, #764ba2 100%)',padding:'35px 30px','border-radius':'20px','margin-bottom':'25px','box-shadow':'0 8px 32px rgba(0, 0, 0, 0.3)','text-align':'center',position:'relative',overflow:'hidden'}},Te={style:{position:'relative','z-index':'1'}},Se={style:{margin:'0 0 10px 0',color:'white','font-size':'24px','font-weight':'600'}},Ne={style:{color:'rgba(255, 255, 255, 0.9)','font-size':'14px','margin-bottom':'15px'},class:'version-info'},Ie={style:{display:'flex',gap:'12px','justify-content':'center','flex-wrap':'wrap'}},_e={style:{'margin-top':'25px',padding:'20px',background:'rgba(220, 53, 69, 0.15)',border:'2px solid rgba(220, 53, 69, 0.3)','border-radius':'12px','backdrop-filter':'blur(10px)'}},Ve={style:{display:'flex','align-items':'center',gap:'8px','margin-bottom':'10px','justify-content':'center'}},ze={style:{color:'white','font-weight':'600','font-size':'14px'}},Be={style:{color:'rgba(255, 255, 255, 0.95)','font-size':'13px','line-height':'1.8','text-align':'left'}},Me=['innerHTML'],Pe=['innerHTML'],$e=['innerHTML'],De=['innerHTML'],je={style:{background:'linear-gradient(135deg, #1e1e1e 0%, #2a2a2a 100%)',padding:'25px','border-radius':'16px','margin-bottom':'20px','box-shadow':'0 4px 20px rgba(0, 0, 0, 0.3)',border:'1px solid rgba(74, 158, 255, 0.2)'}},Re={style:{color:'#e0e0e0','font-size':'14px','line-height':'1.8',animation:'fadeIn 0.3s ease-in'}},Oe=['innerHTML'],Fe={style:{margin:'5px 0','padding-left':'20px'}},Le=['innerHTML'],He=['innerHTML'],Ue=['innerHTML'],Ge=['innerHTML'],Ye=['innerHTML'],Je=['innerHTML'],We={style:{background:'rgba(220, 53, 69, 0.1)','border-left':'4px solid #dc3545',padding:'15px','border-radius':'8px','margin-bottom':'15px'}},qe=['innerHTML'],Ke={style:{'font-size':'13px',color:'#e0e0e0','line-height':'1.6'}},Xe={style:{'margin-bottom':'8px'}},Qe=['innerHTML'],Ze={style:{margin:'5px 0','padding-left':'20px'}},en=['innerHTML'],nn=['innerHTML'],tn=['innerHTML'],an={style:{'margin-bottom':'5px'}},on=['innerHTML'],rn={style:{margin:'5px 0','padding-left':'20px'}},sn=['innerHTML'],ln=['innerHTML'],dn=['innerHTML'],cn={style:{background:'linear-gradient(135deg, #1e1e1e 0%, #2a2a2a 100%)',padding:'25px','border-radius':'16px','margin-bottom':'20px','box-shadow':'0 4px 20px rgba(0, 0, 0, 0.3)',border:'1px solid rgba(40, 167, 69, 0.2)'}},pn={style:{color:'#e0e0e0','font-size':'14px','line-height':'1.8',animation:'fadeIn 0.3s ease-in'}},gn={style:{padding:'20px',background:'rgba(76, 175, 80, 0.05)','border-left':'4px solid #4caf50','border-radius':'8px','margin-bottom':'15px'}},un={style:{display:'flex','justify-content':'space-between','align-items':'center','margin-bottom':'12px'}},mn={style:{'font-size':'13px',color:'#888'}},fn={class:'update-list'},xn={style:{padding:'20px',background:'rgba(255, 152, 0, 0.05)','border-left':'4px solid #ff9800','border-radius':'8px','margin-bottom':'15px'}},bn={style:{display:'flex','justify-content':'space-between','align-items':'center','margin-bottom':'12px'}},hn={style:{'font-size':'16px','font-weight':'600',color:'#ff9800',display:'flex','align-items':'center',gap:'8px'}},yn={style:{'font-size':'13px',color:'#888'}},vn={class:'update-list'},wn={style:{padding:'20px',background:'rgba(99, 102, 241, 0.05)','border-left':'4px solid #6366f1','border-radius':'8px','margin-bottom':'15px'}},kn={style:{display:'flex','justify-content':'space-between','align-items':'center','margin-bottom':'15px'}},An={style:{'font-size':'13px',color:'#888'}},Cn={style:{'margin-bottom':'15px'}},En={style:{color:'#6366f1','font-weight':'600','margin-bottom':'8px'}},Tn={style:{margin:'5px 0','padding-left':'20px','font-size':'14px'}},Sn={style:{padding:'20px',background:'rgba(99, 102, 241, 0.05)','border-left':'4px solid #6366f1','border-radius':'8px','margin-bottom':'15px'}},Nn={style:{display:'flex','justify-content':'space-between','align-items':'center','margin-bottom':'15px'}},In={style:{'font-size':'13px',color:'#888'}},_n={style:{'margin-bottom':'15px'}},Vn={style:{color:'#10b981','font-weight':'600','margin-bottom':'8px'}},zn={style:{margin:'5px 0','padding-left':'20px','font-size':'14px'}},Bn={style:{'margin-bottom':'15px'}},Mn={style:{color:'#6366f1','font-weight':'600','margin-bottom':'8px'}},Pn={style:{margin:'5px 0','padding-left':'20px','font-size':'14px'}},$n={style:{padding:'20px',background:'rgba(99, 102, 241, 0.05)','border-left':'4px solid #6366f1','border-radius':'8px','margin-bottom':'15px'}},Dn={style:{display:'flex','justify-content':'space-between','align-items':'center','margin-bottom':'15px'}},jn={style:{'font-size':'13px',color:'#888'}},Rn={style:{'margin-bottom':'15px'}},On={style:{color:'#10b981','font-weight':'600','margin-bottom':'8px'}},Fn={style:{margin:'5px 0','padding-left':'20px','font-size':'14px'}},Ln={style:{'margin-bottom':'15px'}},Hn={style:{color:'#6366f1','font-weight':'600','margin-bottom':'8px'}},Un={style:{margin:'5px 0','padding-left':'20px','font-size':'14px'}},Gn={style:{padding:'20px',background:'rgba(99, 102, 241, 0.05)','border-left':'4px solid #6366f1','border-radius':'8px','margin-bottom':'15px'}},Yn={style:{display:'flex','justify-content':'space-between','align-items':'center','margin-bottom':'15px'}},Jn={style:{'font-size':'13px',color:'#888'}},Wn={style:{'margin-bottom':'15px'}},qn={style:{color:'#10b981','font-weight':'600','margin-bottom':'8px'}},Kn={style:{margin:'5px 0','padding-left':'20px','font-size':'14px'}},Xn={style:{padding:'20px',background:'rgba(99, 102, 241, 0.05)','border-left':'4px solid #6366f1','border-radius':'8px','margin-bottom':'15px'}},Qn={style:{display:'flex','justify-content':'space-between','align-items':'center','margin-bottom':'15px'}},Zn={style:{'font-size':'13px',color:'#888'}},et={style:{'margin-bottom':'15px'}},nt={style:{color:'#dc3545','font-weight':'600','margin-bottom':'8px'}},tt={style:{margin:'5px 0','padding-left':'20px','font-size':'14px'}},at={style:{padding:'20px',background:'rgba(40, 167, 69, 0.05)','border-left':'4px solid #28a745','border-radius':'8px','margin-bottom':'15px'}},ot={style:{display:'flex','justify-content':'space-between','align-items':'center','margin-bottom':'15px'}},rt={style:{'font-size':'13px',color:'#888'}},st={style:{'margin-bottom':'15px'}},it={style:{color:'#28a745','font-weight':'600','margin-bottom':'8px'}},lt={style:{margin:'5px 0','padding-left':'20px','font-size':'14px'}},dt={style:{padding:'20px',background:'rgba(40, 167, 69, 0.05)','border-left':'4px solid #28a745','border-radius':'8px','margin-bottom':'15px'}},ct={style:{display:'flex','justify-content':'space-between','align-items':'center','margin-bottom':'15px'}},pt={style:{'font-size':'13px',color:'#888'}},gt={style:{'margin-bottom':'15px'}},ut={style:{color:'#28a745','font-weight':'600','margin-bottom':'8px'}},mt={style:{margin:'5px 0','padding-left':'20px','font-size':'14px'}},ft={style:{padding:'20px',background:'rgba(40, 167, 69, 0.05)','border-left':'4px solid #28a745','border-radius':'8px','margin-bottom':'15px'}},xt={style:{display:'flex','justify-content':'space-between','align-items':'center','margin-bottom':'15px'}},bt={style:{'font-size':'13px',color:'#888'}},ht={style:{'margin-bottom':'15px'}},yt={style:{color:'#28a745','font-weight':'600','margin-bottom':'8px'}},vt={style:{margin:'5px 0','padding-left':'20px','font-size':'14px'}},wt={style:{padding:'20px',background:'rgba(220, 53, 69, 0.05)','border-left':'4px solid #dc3545','border-radius':'8px','margin-bottom':'15px'}},kt={style:{display:'flex','justify-content':'space-between','align-items':'center','margin-bottom':'15px'}},At={style:{'font-size':'13px',color:'#888'}},Ct={style:{margin:'5px 0','padding-left':'20px','font-size':'14px'}},Et={style:{'text-align':'center',color:'#888','font-size':'13px',padding:'20px','border-top':'1px solid rgba(255, 255, 255, 0.1)'}},Tt={style:{'margin-bottom':'8px'}},St={style:{'font-size':'12px'}},Nt=(0,i.defineComponent)({__name:'HelpTab',setup(e){const{t:n,locale:t}=a(),o=(0,i.computed)(()=>t.value),r=(0,i.ref)({usage:!1,changelog:!1}),s=()=>{x(!0)},l=async()=>{try{window.toastr.info('zh-CN'===o.value?'æ­£åœ¨è·å–æœ€æ–°ç‰ˆæœ¬ä¿¡æ¯...':'Fetching latest version info...','zh-CN'===o.value?'ä¸‹è½½ä¸­':'Downloading',{timeOut:2e3});const e=Date.now(),n=await fetch(`https://testingcf.jsdelivr.net/gh/mzrodyu/maomao/dist/è®°å¿†_with_worldbook/version.json?_=${e}`);if(!n.ok)throw new Error('zh-CN'===o.value?'æ— æ³•è·å–ç‰ˆæœ¬ä¿¡æ¯':'Failed to fetch version info');const t=(await n.json()).version;window.toastr.info('zh-CN'===o.value?`æ­£åœ¨ä¸‹è½½ v${t}...`:`Downloading v${t}...`,'zh-CN'===o.value?'ä¸‹è½½ä¸­':'Downloading',{timeOut:2e3});const a=`https://testingcf.jsdelivr.net/gh/mzrodyu/maomao/dist/è®°å¿†_with_worldbook/çŒ«çŒ«çš„å†™å¡å°å·¥å…· v${t}.json?_=${e}`,r=await fetch(a);if(!r.ok)throw new Error('zh-CN'===o.value?`ä¸‹è½½å¤±è´¥: HTTP ${r.status}`:`Download failed: HTTP ${r.status}`);const s=await r.text(),i=new Blob([s],{type:'application/json'}),l=URL.createObjectURL(i),d=document.createElement('a');d.href=l,d.download=`çŒ«çŒ«çš„å†™å¡å°å·¥å…· v${t}.json`,document.body.appendChild(d),d.click(),document.body.removeChild(d),URL.revokeObjectURL(l),window.toastr.success('zh-CN'===o.value?`v${t} å·²ä¸‹è½½å®Œæˆï¼Œè¯·åœ¨é…’é¦†è„šæœ¬åº“é‡æ–°å¯¼å…¥è¯¥æ–‡ä»¶`:`v${t} downloaded successfully, please re-import the file in SillyTavern script library`,'zh-CN'===o.value?'ä¸‹è½½æˆåŠŸ':'Success',{timeOut:8e3})}catch(e){console.error('ä¸‹è½½å¤±è´¥:',e),window.toastr.error(('zh-CN'===o.value?'ä¸‹è½½å¤±è´¥: ':'Download failed: ')+e.message,'zh-CN'===o.value?'é”™è¯¯':'Error',{timeOut:5e3})}};return(e,t)=>((0,i.openBlock)(),(0,i.createElementBlock)('div',Ce,[(0,i.createCommentVNode)(' ç‰ˆæœ¬ä¿¡æ¯ '),(0,i.createElementVNode)('div',Ee,[(0,i.createCommentVNode)(' è£…é¥°å…ƒç´  '),t[10]||(t[10]=(0,i.createElementVNode)('div',{style:{position:'absolute',top:'-50px',right:'-50px',width:'150px',height:'150px',background:'rgba(255, 255, 255, 0.1)','border-radius':'50%'}},null,-1)),t[11]||(t[11]=(0,i.createElementVNode)('div',{style:{position:'absolute',bottom:'-30px',left:'-30px',width:'100px',height:'100px',background:'rgba(255, 255, 255, 0.1)','border-radius':'50%'}},null,-1)),(0,i.createElementVNode)('div',Te,[t[9]||(t[9]=(0,i.createElementVNode)('div',{style:{'font-size':'48px','margin-bottom':'10px'}},'ğŸ±',-1)),(0,i.createElementVNode)('h2',Se,(0,i.toDisplayString)('zh-CN'===o.value?'mzrodyuçŒ«çŒ«çš„å°ç ´çƒ‚':'mzrodyu\'s Tool'),1),(0,i.createElementVNode)('div',Ne,(0,i.toDisplayString)((0,i.unref)(n)('helpPage.version'))+' v1.34 ',1),(0,i.createCommentVNode)(' æŒ‰é’®ç»„ '),(0,i.createElementVNode)('div',Ie,[(0,i.createElementVNode)('button',{onClick:s,style:{padding:'12px 24px',background:'white',color:'#667eea',border:'none','border-radius':'10px','font-size':'15px','font-weight':'600',cursor:'pointer',transition:'all 0.3s','box-shadow':'0 4px 15px rgba(0, 0, 0, 0.2)',display:'flex','align-items':'center',gap:'8px'},onMouseover:t[0]||(t[0]=e=>e.target.style.transform='translateY(-2px)'),onMouseleave:t[1]||(t[1]=e=>e.target.style.transform='')},[t[6]||(t[6]=(0,i.createElementVNode)('i',{class:'fa-solid fa-rotate',style:{'margin-right':'6px'}},null,-1)),(0,i.createTextVNode)(' '+(0,i.toDisplayString)((0,i.unref)(n)('helpPage.checkUpdate')),1)],32),(0,i.createElementVNode)('button',{onClick:l,style:{padding:'12px 24px',background:'rgba(255, 255, 255, 0.2)',color:'white',border:'1px solid rgba(255, 255, 255, 0.5)','border-radius':'10px','font-size':'15px','font-weight':'600',cursor:'pointer',transition:'all 0.3s',display:'flex','align-items':'center',gap:'8px'},onMouseover:t[2]||(t[2]=e=>e.target.style.background='rgba(255, 255, 255, 0.3)'),onMouseleave:t[3]||(t[3]=e=>e.target.style.background='rgba(255, 255, 255, 0.2)')},[t[7]||(t[7]=(0,i.createElementVNode)('i',{class:'fa-solid fa-download',style:{'margin-right':'6px'}},null,-1)),(0,i.createTextVNode)(' '+(0,i.toDisplayString)((0,i.unref)(n)('helpPage.downloadLatest')),1)],32)]),(0,i.createCommentVNode)(' ç‰ˆæƒå£°æ˜ '),(0,i.createElementVNode)('div',_e,[(0,i.createElementVNode)('div',Ve,[t[8]||(t[8]=(0,i.createElementVNode)('i',{class:'fa-solid fa-shield-halved',style:{color:'#ffc107','font-size':'16px'}},null,-1)),(0,i.createElementVNode)('span',ze,(0,i.toDisplayString)((0,i.unref)(n)('helpPage.copyright')),1)]),(0,i.createElementVNode)('div',Be,[(0,i.createElementVNode)('div',{style:{'margin-bottom':'5px'},innerHTML:(0,i.unref)(n)('helpPage.copyrightContent.line1')},null,8,Me),(0,i.createElementVNode)('div',{style:{'margin-bottom':'5px'},innerHTML:(0,i.unref)(n)('helpPage.copyrightContent.line2')},null,8,Pe),(0,i.createElementVNode)('div',{style:{'margin-bottom':'5px'},innerHTML:(0,i.unref)(n)('helpPage.copyrightContent.line3')},null,8,$e),(0,i.createElementVNode)('div',{innerHTML:(0,i.unref)(n)('helpPage.copyrightContent.line4')},null,8,De)])])])]),(0,i.createCommentVNode)(' ä½¿ç”¨è¯´æ˜ '),(0,i.createElementVNode)('div',je,[(0,i.createElementVNode)('h3',{style:{margin:'0 0 20px 0',color:'#4a9eff','font-size':'20px','font-weight':'600',display:'flex','align-items':'center',gap:'12px',cursor:'pointer','user-select':'none'},onClick:t[4]||(t[4]=e=>r.value.usage=!r.value.usage)},[t[12]||(t[12]=(0,i.createElementVNode)('i',{class:'fa-solid fa-book-open',style:{color:'#4a9eff','font-size':'18px'}},null,-1)),(0,i.createTextVNode)(' '+(0,i.toDisplayString)((0,i.unref)(n)('helpPage.usageGuide'))+' ',1),(0,i.createElementVNode)('i',{class:(0,i.normalizeClass)([r.value.usage?'fa-chevron-up':'fa-chevron-down','fa-solid']),style:{'margin-left':'auto','font-size':'14px',transition:'transform 0.3s',color:'#888'}},null,2)]),(0,i.withDirectives)((0,i.createElementVNode)('div',Re,[(0,i.createElementVNode)('h4',{style:{color:'#4a9eff','margin-top':'0','margin-bottom':'15px','font-size':'16px'},innerHTML:(0,i.unref)(n)('helpPage.features.title')},null,8,Oe),(0,i.createElementVNode)('ul',Fe,[(0,i.createElementVNode)('li',{innerHTML:(0,i.unref)(n)('helpPage.features.summary')},null,8,Le),(0,i.createElementVNode)('li',{innerHTML:(0,i.unref)(n)('helpPage.features.cardAssist')},null,8,He),(0,i.createElementVNode)('li',{innerHTML:(0,i.unref)(n)('helpPage.features.statusBar')},null,8,Ue),(0,i.createElementVNode)('li',{innerHTML:(0,i.unref)(n)('helpPage.features.mvu')},null,8,Ge),(0,i.createElementVNode)('li',{innerHTML:(0,i.unref)(n)('helpPage.features.others')},null,8,Ye)]),(0,i.createElementVNode)('h4',{style:{color:'#4a9eff','margin-top':'25px','margin-bottom':'15px','font-size':'16px'},innerHTML:(0,i.unref)(n)('helpPage.usage.title')},null,8,Je),(0,i.createElementVNode)('div',We,[(0,i.createElementVNode)('div',{style:{color:'#dc3545','font-weight':'600','margin-bottom':'8px'},innerHTML:(0,i.unref)(n)('helpPage.usage.apiConfig')},null,8,qe),(0,i.createElementVNode)('div',Ke,[(0,i.createElementVNode)('div',Xe,[(0,i.createElementVNode)('span',{innerHTML:(0,i.unref)(n)('helpPage.usage.apiFormats')},null,8,Qe),(0,i.createElementVNode)('ul',Ze,[(0,i.createElementVNode)('li',{innerHTML:(0,i.unref)(n)('helpPage.usage.apiFormat1')},null,8,en),(0,i.createElementVNode)('li',{innerHTML:(0,i.unref)(n)('helpPage.usage.apiFormat2')},null,8,nn),(0,i.createElementVNode)('li',{innerHTML:(0,i.unref)(n)('helpPage.usage.apiFormat3')},null,8,tn)])]),(0,i.createElementVNode)('div',an,[(0,i.createElementVNode)('span',{innerHTML:(0,i.unref)(n)('helpPage.usage.apiExample')},null,8,on),t[13]||(t[13]=(0,i.createElementVNode)('code',{style:{background:'rgba(220, 53, 69, 0.2)',padding:'2px 6px','border-radius':'4px'}},'https://api.openai.com',-1))])])]),(0,i.createElementVNode)('ul',rn,[(0,i.createElementVNode)('li',{innerHTML:(0,i.unref)(n)('helpPage.usage.import')},null,8,sn),(0,i.createElementVNode)('li',{innerHTML:(0,i.unref)(n)('helpPage.usage.firstUse')},null,8,ln),(0,i.createElementVNode)('li',{innerHTML:(0,i.unref)(n)('helpPage.usage.autoSummary')},null,8,dn)])],512),[[i.vShow,r.value.usage]])]),(0,i.createCommentVNode)(' æ›´æ–°æ—¥å¿— '),(0,i.createElementVNode)('div',cn,[(0,i.createElementVNode)('h3',{style:{margin:'0 0 20px 0',color:'#28a745','font-size':'20px','font-weight':'600',display:'flex','align-items':'center',gap:'12px',cursor:'pointer','user-select':'none'},onClick:t[5]||(t[5]=e=>r.value.changelog=!r.value.changelog)},[t[14]||(t[14]=(0,i.createElementVNode)('i',{class:'fa-solid fa-clock-rotate-left',style:{color:'#28a745','font-size':'18px'}},null,-1)),(0,i.createTextVNode)(' '+(0,i.toDisplayString)((0,i.unref)(n)('helpPage.changelog'))+' ',1),(0,i.createElementVNode)('i',{class:(0,i.normalizeClass)([r.value.changelog?'fa-chevron-up':'fa-chevron-down','fa-solid']),style:{'margin-left':'auto','font-size':'14px',transition:'transform 0.3s',color:'#888'}},null,2)]),(0,i.withDirectives)((0,i.createElementVNode)('div',pn,[(0,i.createCommentVNode)(' v1.34 '),(0,i.createElementVNode)('div',gn,[(0,i.createElementVNode)('div',un,[t[15]||(t[15]=(0,i.createElementVNode)('div',{style:{'font-size':'16px','font-weight':'600',color:'#4caf50',display:'flex','align-items':'center',gap:'8px'}},' v1.34 ',-1)),(0,i.createElementVNode)('div',mn,(0,i.toDisplayString)((0,i.unref)(n)('helpPage.updates.v134.date')),1)]),(0,i.createElementVNode)('ul',fn,[((0,i.openBlock)(!0),(0,i.createElementBlock)(i.Fragment,null,(0,i.renderList)((0,i.unref)(n)('helpPage.updates.v134.features'),e=>((0,i.openBlock)(),(0,i.createElementBlock)('li',{key:e,class:'update-item'},(0,i.toDisplayString)(e),1))),128))])]),(0,i.createCommentVNode)(' v1.33 '),(0,i.createElementVNode)('div',xn,[(0,i.createElementVNode)('div',bn,[(0,i.createElementVNode)('div',hn,' v1.33 - '+(0,i.toDisplayString)((0,i.unref)(n)('helpPage.updates.v133.title')),1),(0,i.createElementVNode)('div',yn,(0,i.toDisplayString)((0,i.unref)(n)('helpPage.updates.v133.date')),1)]),(0,i.createElementVNode)('ul',vn,[((0,i.openBlock)(!0),(0,i.createElementBlock)(i.Fragment,null,(0,i.renderList)((0,i.unref)(n)('helpPage.updates.v133.features'),e=>((0,i.openBlock)(),(0,i.createElementBlock)('li',{key:e,class:'update-item'},(0,i.toDisplayString)(e),1))),128))])]),(0,i.createCommentVNode)(' v1.32 '),(0,i.createElementVNode)('div',wn,[(0,i.createElementVNode)('div',kn,[t[16]||(t[16]=(0,i.createElementVNode)('div',{style:{'font-size':'16px','font-weight':'600',color:'#6366f1'}},'v1.32',-1)),(0,i.createElementVNode)('div',An,(0,i.toDisplayString)((0,i.unref)(n)('helpPage.updates.v132.date')),1)]),(0,i.createElementVNode)('div',Cn,[(0,i.createElementVNode)('div',En,(0,i.toDisplayString)((0,i.unref)(n)('helpPage.updates.v132.optimize')),1),(0,i.createElementVNode)('ul',Tn,[((0,i.openBlock)(!0),(0,i.createElementBlock)(i.Fragment,null,(0,i.renderList)((0,i.unref)(n)('helpPage.updates.v132.optimizeFeatures'),e=>((0,i.openBlock)(),(0,i.createElementBlock)('li',{key:e},(0,i.toDisplayString)(e),1))),128))])])]),(0,i.createCommentVNode)(' v1.31 '),(0,i.createElementVNode)('div',Sn,[(0,i.createElementVNode)('div',Nn,[t[17]||(t[17]=(0,i.createElementVNode)('div',{style:{'font-size':'16px','font-weight':'600',color:'#6366f1'}},'v1.31',-1)),(0,i.createElementVNode)('div',In,(0,i.toDisplayString)((0,i.unref)(n)('helpPage.updates.v131.date')),1)]),(0,i.createElementVNode)('div',_n,[(0,i.createElementVNode)('div',Vn,(0,i.toDisplayString)((0,i.unref)(n)('helpPage.updates.v131.newFeatures')),1),(0,i.createElementVNode)('ul',zn,[((0,i.openBlock)(!0),(0,i.createElementBlock)(i.Fragment,null,(0,i.renderList)((0,i.unref)(n)('helpPage.updates.v131.newFeaturesList'),e=>((0,i.openBlock)(),(0,i.createElementBlock)('li',{key:e},(0,i.toDisplayString)(e),1))),128))])]),(0,i.createElementVNode)('div',Bn,[(0,i.createElementVNode)('div',Mn,(0,i.toDisplayString)((0,i.unref)(n)('helpPage.updates.v131.optimize')),1),(0,i.createElementVNode)('ul',Pn,[((0,i.openBlock)(!0),(0,i.createElementBlock)(i.Fragment,null,(0,i.renderList)((0,i.unref)(n)('helpPage.updates.v131.optimizeFeatures'),e=>((0,i.openBlock)(),(0,i.createElementBlock)('li',{key:e},(0,i.toDisplayString)(e),1))),128))])])]),(0,i.createCommentVNode)(' v1.30 '),(0,i.createElementVNode)('div',$n,[(0,i.createElementVNode)('div',Dn,[t[18]||(t[18]=(0,i.createElementVNode)('div',{style:{'font-size':'16px','font-weight':'600',color:'#6366f1'}},'v1.30',-1)),(0,i.createElementVNode)('div',jn,(0,i.toDisplayString)((0,i.unref)(n)('helpPage.updates.v130.date')),1)]),(0,i.createElementVNode)('div',Rn,[(0,i.createElementVNode)('div',On,(0,i.toDisplayString)((0,i.unref)(n)('helpPage.updates.v130.newFeatures')),1),(0,i.createElementVNode)('ul',Fn,[((0,i.openBlock)(!0),(0,i.createElementBlock)(i.Fragment,null,(0,i.renderList)((0,i.unref)(n)('helpPage.updates.v130.newFeaturesList'),e=>((0,i.openBlock)(),(0,i.createElementBlock)('li',{key:e},(0,i.toDisplayString)(e),1))),128))])]),(0,i.createElementVNode)('div',Ln,[(0,i.createElementVNode)('div',Hn,(0,i.toDisplayString)((0,i.unref)(n)('helpPage.updates.v130.optimize')),1),(0,i.createElementVNode)('ul',Un,[((0,i.openBlock)(!0),(0,i.createElementBlock)(i.Fragment,null,(0,i.renderList)((0,i.unref)(n)('helpPage.updates.v130.optimizeFeatures'),e=>((0,i.openBlock)(),(0,i.createElementBlock)('li',{key:e},(0,i.toDisplayString)(e),1))),128))])])]),(0,i.createCommentVNode)(' v1.29 '),(0,i.createElementVNode)('div',Gn,[(0,i.createElementVNode)('div',Yn,[t[19]||(t[19]=(0,i.createElementVNode)('div',{style:{'font-size':'16px','font-weight':'600',color:'#6366f1'}},'v1.29',-1)),(0,i.createElementVNode)('div',Jn,(0,i.toDisplayString)((0,i.unref)(n)('helpPage.updates.v129.date')),1)]),(0,i.createElementVNode)('div',Wn,[(0,i.createElementVNode)('div',qn,(0,i.toDisplayString)((0,i.unref)(n)('helpPage.updates.v129.newFeatures')),1),(0,i.createElementVNode)('ul',Kn,[((0,i.openBlock)(!0),(0,i.createElementBlock)(i.Fragment,null,(0,i.renderList)((0,i.unref)(n)('helpPage.updates.v129.newFeaturesList'),e=>((0,i.openBlock)(),(0,i.createElementBlock)('li',{key:e},(0,i.toDisplayString)(e),1))),128))])])]),(0,i.createCommentVNode)(' v1.28 '),(0,i.createElementVNode)('div',Xn,[(0,i.createElementVNode)('div',Qn,[t[20]||(t[20]=(0,i.createElementVNode)('div',{style:{'font-size':'16px','font-weight':'600',color:'#6366f1'}},'v1.28',-1)),(0,i.createElementVNode)('div',Zn,(0,i.toDisplayString)((0,i.unref)(n)('helpPage.updates.v128.date')),1)]),(0,i.createElementVNode)('div',et,[(0,i.createElementVNode)('div',nt,(0,i.toDisplayString)((0,i.unref)(n)('helpPage.updates.v128.majorUpdate')),1),(0,i.createElementVNode)('ul',tt,[((0,i.openBlock)(!0),(0,i.createElementBlock)(i.Fragment,null,(0,i.renderList)((0,i.unref)(n)('helpPage.updates.v128.majorUpdateList'),e=>((0,i.openBlock)(),(0,i.createElementBlock)('li',{key:e},(0,i.toDisplayString)(e),1))),128))])])]),(0,i.createCommentVNode)(' v1.27 '),(0,i.createElementVNode)('div',at,[(0,i.createElementVNode)('div',ot,[t[21]||(t[21]=(0,i.createElementVNode)('div',{style:{'font-size':'16px','font-weight':'600',color:'#28a745'}},'v1.27',-1)),(0,i.createElementVNode)('div',rt,(0,i.toDisplayString)((0,i.unref)(n)('helpPage.updates.v127.date')),1)]),(0,i.createElementVNode)('div',st,[(0,i.createElementVNode)('div',it,(0,i.toDisplayString)((0,i.unref)(n)('helpPage.updates.v127.newFeatures')),1),(0,i.createElementVNode)('ul',lt,[((0,i.openBlock)(!0),(0,i.createElementBlock)(i.Fragment,null,(0,i.renderList)((0,i.unref)(n)('helpPage.updates.v127.newFeaturesList'),e=>((0,i.openBlock)(),(0,i.createElementBlock)('li',{key:e},(0,i.toDisplayString)(e),1))),128))])])]),(0,i.createCommentVNode)(' v1.26 '),(0,i.createElementVNode)('div',dt,[(0,i.createElementVNode)('div',ct,[t[22]||(t[22]=(0,i.createElementVNode)('div',{style:{'font-size':'16px','font-weight':'600',color:'#28a745'}},'v1.26',-1)),(0,i.createElementVNode)('div',pt,(0,i.toDisplayString)((0,i.unref)(n)('helpPage.updates.v126.date')),1)]),(0,i.createElementVNode)('div',gt,[(0,i.createElementVNode)('div',ut,(0,i.toDisplayString)((0,i.unref)(n)('helpPage.updates.v126.newFeatures')),1),(0,i.createElementVNode)('ul',mt,[((0,i.openBlock)(!0),(0,i.createElementBlock)(i.Fragment,null,(0,i.renderList)((0,i.unref)(n)('helpPage.updates.v126.newFeaturesList'),e=>((0,i.openBlock)(),(0,i.createElementBlock)('li',{key:e},(0,i.toDisplayString)(e),1))),128))])])]),(0,i.createCommentVNode)(' v1.25 '),(0,i.createElementVNode)('div',ft,[(0,i.createElementVNode)('div',xt,[t[23]||(t[23]=(0,i.createElementVNode)('div',{style:{'font-size':'16px','font-weight':'600',color:'#28a745'}},'v1.25',-1)),(0,i.createElementVNode)('div',bt,(0,i.toDisplayString)((0,i.unref)(n)('helpPage.updates.v125.date')),1)]),(0,i.createElementVNode)('div',ht,[(0,i.createElementVNode)('div',yt,(0,i.toDisplayString)((0,i.unref)(n)('helpPage.updates.v125.newFeatures')),1),(0,i.createElementVNode)('ul',vt,[((0,i.openBlock)(!0),(0,i.createElementBlock)(i.Fragment,null,(0,i.renderList)((0,i.unref)(n)('helpPage.updates.v125.newFeaturesList'),e=>((0,i.openBlock)(),(0,i.createElementBlock)('li',{key:e},(0,i.toDisplayString)(e),1))),128))])])]),(0,i.createCommentVNode)(' v1.0.0 '),(0,i.createElementVNode)('div',wt,[(0,i.createElementVNode)('div',kt,[t[24]||(t[24]=(0,i.createElementVNode)('div',{style:{'font-size':'16px','font-weight':'600',color:'#dc3545'}},'v1.0.0',-1)),(0,i.createElementVNode)('div',At,(0,i.toDisplayString)((0,i.unref)(n)('helpPage.updates.v100.date')),1)]),(0,i.createElementVNode)('ul',Ct,[((0,i.openBlock)(!0),(0,i.createElementBlock)(i.Fragment,null,(0,i.renderList)((0,i.unref)(n)('helpPage.updates.v100.features'),e=>((0,i.openBlock)(),(0,i.createElementBlock)('li',{key:e},(0,i.toDisplayString)(e),1))),128))])])],512),[[i.vShow,r.value.changelog]])]),(0,i.createCommentVNode)(' å…³äº '),(0,i.createElementVNode)('div',Et,[(0,i.createElementVNode)('div',Tt,[(0,i.createTextVNode)((0,i.toDisplayString)((0,i.unref)(n)('helpPage.madeWith'))+' ',1),t[25]||(t[25]=(0,i.createElementVNode)('span',{style:{color:'#dc3545'}},'â¤ï¸',-1)),(0,i.createTextVNode)(' '+(0,i.toDisplayString)((0,i.unref)(n)('helpPage.by'))+' mzrodyu ',1)]),(0,i.createElementVNode)('div',St,[(0,i.createTextVNode)((0,i.toDisplayString)((0,i.unref)(n)('helpPage.basedOn'))+' ',1),t[26]||(t[26]=(0,i.createElementVNode)('a',{href:'https://github.com/SillyTavern/SillyTavern',target:'_blank',style:{color:'#4a9eff','text-decoration':'none'}},'SillyTavern',-1)),(0,i.createTextVNode)(' '+(0,i.toDisplayString)((0,i.unref)(n)('helpPage.and'))+' ',1),t[27]||(t[27]=(0,i.createElementVNode)('a',{href:'https://n0vi028.github.io/JS-Slash-Runner-Doc/',target:'_blank',style:{color:'#4a9eff','text-decoration':'none'}},'Tavern Helper',-1))])])]))}});s(884);const It=(0,V.A)(Nt,[['__scopeId','data-v-7e37d274']]),_t={class:'tools-tab',style:{padding:'25px !important',background:'#1a1a1a !important'}},Vt={class:'tool-section'},zt={key:0,class:'tool-content'},Bt={style:{background:'linear-gradient(135deg, rgba(102, 126, 234, 0.08), rgba(118, 75, 162, 0.08))',border:'1px solid rgba(102, 126, 234, 0.3)','border-radius':'8px',padding:'15px','margin-bottom':'20px'}},Mt={class:'form-group',style:{margin:'0 0 12px 0'}},Pt=['disabled'],$t={style:{position:'relative','z-index':'1'}},Dt={class:'form-group',style:{margin:'15px 0'}},jt={class:'form-group',style:{margin:'15px 0'}},Rt={key:0,class:'output-section'},Ot={class:'code-output'},Ft={style:{'margin-top':'15px',padding:'12px',background:'rgba(74, 158, 255, 0.05)',border:'1px solid rgba(74, 158, 255, 0.2)','border-radius':'8px'}},Lt={style:{display:'flex',gap:'10px','flex-wrap':'wrap'}},Ht={class:'tool-section'},Ut={key:0,class:'tool-content'},Gt={style:{background:'linear-gradient(135deg, rgba(251, 191, 36, 0.08), rgba(245, 158, 11, 0.08))',border:'1px solid rgba(251, 191, 36, 0.3)','border-radius':'8px',padding:'15px','margin-bottom':'20px'}},Yt={class:'form-group',style:{margin:'0 0 12px 0'}},Jt=['disabled'],Wt={style:{position:'relative','z-index':'1'}},qt={key:0,class:'form-group',style:{margin:'15px 0'}},Kt={key:1,class:'output-section'},Xt={class:'code-output'},Qt=(0,i.defineComponent)({__name:'MvuBetaTab',setup(e){const n=(0,l.C)(),{settings:t}=(0,p.storeToRefs)(n),a=(0,i.ref)({structure:!0,prompt:!1});function o(e){a.value[e]=!a.value[e]}const r=(0,i.ref)(''),s=(0,i.ref)(!1),c=(0,i.ref)(''),g=(0,i.ref)(!1),u=(0,i.ref)(''),m=(0,i.ref)(''),f=(0,i.ref)(!1),x=(0,i.ref)(!1),b=(0,i.ref)(!1),h=(0,i.ref)(!1),y=(0,i.ref)(''),v=(0,i.ref)(''),w=(0,i.ref)(''),k=(0,i.ref)(''),A=(0,i.ref)('');function C(e){navigator.clipboard.writeText(e).then(()=>{window.toastr.success('å·²å¤åˆ¶åˆ°å‰ªè´´æ¿')})}function E(){if(!y.value.trim())return void window.toastr.error('è¯·è¾“å…¥å˜é‡åç§°');const e={$meta:{extensible:!1,strictSet:!0}};e[y.value]=function(){const e=v.value.split('\n').filter(e=>e.trim()),n={};return e.forEach(e=>{const t=e.split(':').map(e=>e.trim()),a=t[0],o=t[1]||'string',r=t[2]||'æè¿°...';a&&(n[a]='number'===o?[0,r]:'string'===o?['',r]:'array'===o?[[],r]:'object'===o?[{},r]:[null,r])}),n}(),w.value=JSON.stringify(e,null,2)}function T(){C(w.value)}async function S(){if(r.value.trim())if(t.value.api_endpoint&&t.value.api_key){u.value=r.value,s.value=!0;try{const e='ä½ æ˜¯ MVU Beta ä¸“å®¶ã€‚ç”Ÿæˆ [InitVar] JSONã€‚\n\nè§„åˆ™ï¼š\n1. ä¸åŒ…å« "stat_data" æ ¹èŠ‚ç‚¹\n2. æ‰€æœ‰å­—æ®µ: [å€¼, "æè¿°"]\n3. $meta åœ¨æ ¹çº§åˆ«\n4. å­—ç¬¦ä¸²åœ¨ä¸€è¡Œå†…\n5. æè¿°ç®€çŸ­ï¼ˆ20å­—å†…ï¼‰\n\næ ¼å¼ï¼š\n{\n  "$meta": {"extensible": false, "strictSet": true},\n  "å˜é‡å": {\n    "å­—æ®µ": [é»˜è®¤å€¼, "ç®€çŸ­æè¿°"]\n  }\n}\n\nåªè¾“å‡º JSONã€‚',n=(0,l.normalizeApiEndpoint)(t.value.api_endpoint),a=await fetch(n,{method:'POST',headers:{'Content-Type':'application/json',Authorization:`Bearer ${t.value.api_key}`},body:JSON.stringify({model:t.value.model,messages:[{role:'system',content:e},{role:'user',content:`éœ€æ±‚ï¼š${r.value}\n\nè¯·ç”Ÿæˆ [InitVar] JSONã€‚`}],temperature:t.value.temperature||.7,max_tokens:t.value.max_tokens||4e3})}),o=await a.text();if(!a.ok){let n=`API é”™è¯¯: ${a.status}`;try{const e=JSON.parse(o);n=e.error?`${n} - ${e.error.message||JSON.stringify(e.error)}`:e.message?`${n} - ${e.message}`:`${n} - ${JSON.stringify(e)}`}catch(e){n=`${n} - ${o.slice(0,200)}`}throw console.error('API è¯·æ±‚å¤±è´¥:',n),console.error('è¯·æ±‚ URL:',t.value.api_endpoint),console.error('è¯·æ±‚ä½“:',JSON.stringify({model:t.value.model,messages:[{role:'system',content:e.substring(0,100)+'...'},{role:'user',content:`éœ€æ±‚ï¼š${r.value.substring(0,100)}...`}],temperature:t.value.temperature||.7,max_tokens:t.value.max_tokens||4e3},null,2)),new Error(n)}const s=JSON.parse(o);let i='';s.choices&&s.choices[0]&&s.choices[0].message?i=s.choices[0].message.content||'':s.data&&s.data.choices&&s.data.choices[0]?i=s.data.choices[0].message?.content||'':s.content&&(i='string'==typeof s.content?s.content:JSON.stringify(s.content)),console.log('AI è¿”å›å†…å®¹:',i);let d=i;d=d.replace(/```json\s*/gi,'').replace(/```\s*$/g,'');const c=d.match(/\{[\s\S]*$/);if(!c)throw new Error('æœªæ‰¾åˆ° JSON å¯¹è±¡');d=c[0];let p,g=0,u=!1,m=!1,f=d.length;for(let e=0;e<d.length;e++){const n=d[e];if(m)m=!1;else if('\\'!==n)if('"'!==n||u){if('"'===n&&u)u=!1;else if(!u&&('{'===n?g++:'}'===n&&g--,0===g)){f=e+1;break}}else u=!0;else m=!0}d=d.substring(0,f),g>0&&(console.warn(`JSON ä¸å®Œæ•´ï¼Œç¼ºå°‘ ${g} ä¸ªé—­åˆæ‹¬å·ï¼Œå°è¯•è¡¥å…¨...`),d+='}'.repeat(g)),d=d.replace(/,(\s*[}\]])/g,'$1'),d=d.replace(/\/\/[^\n]*/g,''),d=d.replace(/\/\*[\s\S]*?\*\//g,'');try{p=JSON.parse(d)}catch(e){throw console.error('JSON è§£æå¤±è´¥ï¼ŒåŸå§‹å†…å®¹:',d),new Error(`JSON è§£æå¤±è´¥: ${e.message}ã€‚è¯·è®© AI è¾“å‡ºæ­£ç¡®çš„ JSONï¼ˆå­—ç¬¦ä¸²åœ¨ä¸€è¡Œå†…ï¼Œæ— å°¾éšé€—å·ï¼‰`)}const x=Object.keys(p).find(e=>'$meta'!==e)||'myVar';y.value=x;const b=p[x]||{},h=[];for(const e in b){if('$meta'===e)continue;const n=b[e];if(Array.isArray(n)&&2===n.length){const t=n[0],a='number'==typeof t?'number':'string'==typeof t?'string':Array.isArray(t)?'array':'object',o=n[1]||'æè¿°...';h.push(`${e}:${a}:${o}`)}}v.value=h.join('\n'),w.value=JSON.stringify(p,null,2),window.toastr.success('AI ç”ŸæˆæˆåŠŸï¼')}catch(e){console.error('AIç”Ÿæˆå¤±è´¥:',e),window.toastr.error(`AIç”Ÿæˆå¤±è´¥: ${e.message}`)}finally{s.value=!1}}else window.toastr.error('è¯·å…ˆåœ¨è®¾ç½®é¡µé¢é…ç½® API ç«¯ç‚¹å’Œ API Key');else window.toastr.error('è¯·è¾“å…¥éœ€æ±‚æè¿°')}function N(){if(w.value)try{const e=JSON.parse(w.value),n=Object.keys(e).find(e=>'$meta'!==e)||'myVar',t=e[n]||{};let o=0;for(const e in t)'$meta'!==e&&o++;k.value=`${n} - ${o} fields`,a.value.prompt=!0,I(),window.toastr.success('å·²åŸºäºç»“æ„è‡ªåŠ¨ç”Ÿæˆ COT æç¤ºè¯'),setTimeout(()=>{const e=document.querySelector('.tool-section:nth-child(2)');e?.scrollIntoView({behavior:'smooth',block:'nearest'})},100)}catch(e){console.error('ç”Ÿæˆæç¤ºè¯å¤±è´¥:',e),window.toastr.error('ç”Ÿæˆå¤±è´¥ï¼Œè¯·æ£€æŸ¥å˜é‡ç»“æ„æ ¼å¼')}else window.toastr.error('è¯·å…ˆç”Ÿæˆ [InitVar] ç»“æ„')}function I(){const e=`<%_ setLocalVar('initialized_lorebooks.-YourLorebook[0]', true); _%>\nã€å˜é‡æ›´æ–°ã€‘\nåœ¨æ‰€æœ‰æ–‡æœ¬çš„æœ€åï¼Œè¿›è¡Œå˜é‡æ›´æ–°ã€‚\n\nä»¥ä¸‹æ˜¯æ•…äº‹ä¸­éœ€è¦è¿½è¸ªçš„å…³é”®å˜é‡ï¼Œå½“å‰çŠ¶æ€ä»¥è¿™äº›å˜é‡çš„å€¼ä¸ºå‡†ã€‚\n\n<status_current_variables>\n{{get_message_variable::stat_data}}\n</status_current_variables>\n\nä¸¥æ ¼æŒ‰ç…§ä»¥ä¸‹è§„åˆ™å’Œæ ¼å¼è¿›è¡Œè¾“å‡ºï¼Œå¹¶ç¡®å®šæ¯ä¸€ä¸ªå˜é‡æ˜¯å¦éœ€è¦æ›´æ–°ï¼Œä¸è¦é—æ¼ï¼š\n\nrule:\n  description:\n    - Output update analysis at the end of response\n    - Variable updates are omitted in context but you must still add them\n    - **CRITICAL**: For MVU format [value, description], ALWAYS use [0] suffix to access the value part\n    - 4 commands available: \\\`_.set\\\` (2-3 args), \\\`_.insert\\\` (2-3 args), \\\`_.remove\\\` (1-2 args), \\\`_.add\\\` (2 args)\n    - **RECOMMENDED**: Use \\\`_.insert\\\` instead of \\\`_.assign\\\`\n    - strictSet enabled: [0] suffix is mandatory for all value access\n\n  command_usage:\n    - \\\`_.set('path[0]', old?, new);//reason\\\` - Replace value\n    - \\\`_.add('path[0]', delta);//reason\\\` - Add/subtract numbers only\n    - \\\`_.insert('path[0]', value);//reason\\\` - Add to array end\n    - \\\`_.insert('path[0]', index, value);//reason\\\` - Insert to array at position\n    - \\\`_.insert('path', key, value);//reason\\\` - Add key-value to object\n    - \\\`_.remove('path[0]', value);//reason\\\` - Remove from array/object\n\n  analysis:\n    You MUST follow this Chain-of-Thought (COT) analysis process step by step:\n\n    **STEP 1: Scene Analysis (50 words max, IN ENGLISH)**\n    - Identify current scene/stage/phase\n    - Describe what happened\n    - Determine what changes occurred (time/location/status/progress)\n\n    **STEP 2: Time & Key Status Check**\n    - Extract current time/status from story context\n    - Read key variables from <status_current_variables>\n    - Calculate changes\n    - Decision: What needs to be updated?\n\n    **STEP 3: Systematic Variable Review (check EVERY variable category)**\n    Go through each variable category systematically and mark Y or N:\n\n    ${k.value.trim()||'å˜é‡åˆ†ç±» - X fields'}:\n      - å˜é‡1[0]: [Y/N] - explain\n      - å˜é‡2[0]: [Y/N] - explain\n\n    **STEP 4: Command Selection**\n    For each variable marked Y, determine which command to use\n\n    **STEP 5: Analyze Other Variable Systems**\n    - stat_data detailed COT: COMPLETED\n    - Other variable groups? [YES/NO]\n\n    **STEP 6: Final Validation Checklist**\n    - All [0] suffixes present? [YES/NO]\n    - All Y variables have corresponding commands? [YES/NO]\n    - All commands have clear Chinese comments? [YES/NO]\n\n  format: |-\n    <UpdateVariable>\n        <ThinkingProcess>\n            **STEP 1: Scene Analysis**\n            [50 words]\n\n            **STEP 2: Time & Key Status Check**\n            - Current status: ...\n            - Stored variable[0]: ...\n            - Changes: ...\n            - Update decision: ...\n\n            **STEP 3: Variable Review (stat_data)**\n            [List categories with Y/N]\n\n            **STEP 4: Command Selection**\n            [For each Y variable, state which command]\n\n            **STEP 5: Other Systems**\n            - stat_data COT: COMPLETED\n            - Other groups? NO\n\n            **STEP 6: Final Check**\n            - [0] suffixes? YES\n            - All Y have commands? YES\n            - Chinese comments? YES\n        </ThinkingProcess>\n\n        _.set('path[0]', old?, new);//reason\n        _.add('path[0]', delta);//reason\n        _.insert('path[0]', value);//reason\n        _.remove('path[0]', value);//reason\n    </UpdateVariable>\n\n  example: |-\n    <UpdateVariable>\n        <ThinkingProcess>\n            **STEP 1: Scene Analysis**\n            User and character had conversation at library. User helped find a book. Time advanced from 10:00 to 10:30. Character's impression improved.\n\n            **STEP 2: Time & Key Status Check**\n            - Current time: 10:30\n            - Stored æ—¶é—´[0]: "10:00"\n            - Time passed: 30 minutes\n            - Update decision: Time, Favor\n\n            **STEP 3: Variable Review (stat_data)**\n            åŸºç¡€ä¿¡æ¯ - 3 fields:\n              - æ—¶é—´[0]: Y - Time advanced\n              - æ—¥æœŸ[0]: N - Same day\n              - å½“å‰ä½ç½®[0]: N - Still at library\n\n            äººç‰©å…³ç³» - 1 field:\n              - å¥½æ„Ÿåº¦[0]: Y - Positive interaction\n\n            **STEP 4: Command Selection**\n            - æ—¶é—´: use _.set\n            - å¥½æ„Ÿåº¦: use _.add\n\n            **STEP 5: Other Systems**\n            - stat_data COT: COMPLETED\n            - Other groups? NO\n\n            **STEP 6: Final Check**\n            - [0] suffixes? YES\n            - All Y have commands? YES\n            - Chinese comments? YES\n        </ThinkingProcess>\n\n        _.set('æ—¶é—´[0]', '10:00', '10:30');//æ—¶é—´æ¨è¿›30åˆ†é’Ÿ\n        _.add('è§’è‰².å¥½æ„Ÿåº¦[0]', 3);//æ„‰å¿«çš„äº¤æµï¼Œå¥½æ„Ÿåº¦å°å¹…æå‡\n    </UpdateVariable>\n\n  specific_rules:\n    - æ—¶é—´æ¨è¿›ï¼šæ¯æ¬¡äº’åŠ¨åæ›´æ–°å…·ä½“æ—¶é—´ï¼Œä½¿ç”¨ _.set æ›´æ–°\n    - çŠ¶æ€åˆ‡æ¢ï¼šå½“çŠ¶æ€/é˜¶æ®µåˆ‡æ¢æ—¶ï¼Œå¿…é¡»æ›´æ–°å¯¹åº”çš„çŠ¶æ€å˜é‡\n    - è®¡æ•°å™¨ï¼šä½¿ç”¨ _.add å¢åŠ æˆ–å‡å°‘è®¡æ•°\n    - æ•°ç»„æ“ä½œï¼šæ·»åŠ å…ƒç´ å¿…é¡»ç”¨ _.insertï¼Œåˆ é™¤å…ƒç´ å¿…é¡»ç”¨ _.remove\n    - [0]åç¼€ï¼šæ‰€æœ‰å˜é‡è®¿é—®éƒ½å¿…é¡»åŠ [0]åç¼€\n    - æ‰©å±•æ•°ç»„ï¼šå¸¦æœ‰ $__META_EXTENSIBLE__$ æ ‡è®°çš„æ•°ç»„ä½¿ç”¨ _.insert æ·»åŠ å…ƒç´ \n    - å¯¹è±¡æ·»åŠ é”®å€¼ï¼šä½¿ç”¨ _.insert('è·¯å¾„', é”®å, å€¼) å‘å¯¹è±¡æ·»åŠ æ–°çš„é”®å€¼å¯¹`;A.value=e}function V(){C(A.value)}async function B(){if(c.value.trim())if(t.value.api_endpoint&&t.value.api_key){m.value=c.value,g.value=!0;try{const e='ä½ æ˜¯ MVU Beta COT æç¤ºè¯ä¸“å®¶ã€‚ç”Ÿæˆå®Œæ•´çš„ 6 æ­¥æ€ç»´é“¾æç¤ºè¯ã€‚\n\n## è¦æ±‚ï¼š\n1. åŒ…å« {{get_message_variable::stat_data}}\n2. ä½¿ç”¨ _.insert è€Œé _.assign\n3. æ‰€æœ‰è·¯å¾„ä½¿ç”¨ [0] åç¼€\n4. 6 æ­¥ COT æµç¨‹å®Œæ•´\n\nç›´æ¥è¾“å‡º EJS æ ¼å¼çš„æç¤ºè¯å†…å®¹ã€‚',n=(0,l.normalizeApiEndpoint)(t.value.api_endpoint),a=await fetch(n,{method:'POST',headers:{'Content-Type':'application/json',Authorization:`Bearer ${t.value.api_key}`},body:JSON.stringify({model:t.value.model,messages:[{role:'system',content:e},{role:'user',content:`åœºæ™¯ï¼š${c.value}\n\nè¯·ç”Ÿæˆ COT æç¤ºè¯ã€‚`}],temperature:t.value.temperature||.7,max_tokens:t.value.max_tokens||3e3})}),o=await a.text();if(!a.ok){let n=`API é”™è¯¯: ${a.status}`;try{const e=JSON.parse(o);n=e.error?`${n} - ${e.error.message||JSON.stringify(e.error)}`:e.message?`${n} - ${e.message}`:`${n} - ${JSON.stringify(e)}`}catch(e){n=`${n} - ${o.slice(0,200)}`}throw console.error('API è¯·æ±‚å¤±è´¥:',n),console.error('è¯·æ±‚ URL:',t.value.api_endpoint),console.error('è¯·æ±‚ä½“:',JSON.stringify({model:t.value.model,messages:[{role:'system',content:e.substring(0,100)+'...'},{role:'user',content:`åœºæ™¯ï¼š${c.value.substring(0,100)}...`}],temperature:t.value.temperature||.7,max_tokens:t.value.max_tokens||3e3},null,2)),new Error(n)}const r=JSON.parse(o);let s='';r.choices&&r.choices[0]&&r.choices[0].message?s=r.choices[0].message.content||'':r.data&&r.data.choices&&r.data.choices[0]?s=r.data.choices[0].message?.content||'':r.content&&(s='string'==typeof r.content?r.content:JSON.stringify(r.content)),A.value=s.trim(),window.toastr.success('AI ç”ŸæˆæˆåŠŸï¼')}catch(e){console.error('AIç”Ÿæˆå¤±è´¥:',e),window.toastr.error(`AIç”Ÿæˆå¤±è´¥: ${e.message}`)}finally{g.value=!1}}else window.toastr.error('è¯·å…ˆåœ¨è®¾ç½®é¡µé¢é…ç½® API ç«¯ç‚¹å’Œ API Key');else window.toastr.error('è¯·è¾“å…¥åœºæ™¯æè¿°')}async function M(e){if(u.value){x.value=!0;try{window.toastr.info('AI æ­£åœ¨ä¿®æ”¹ä¸­...');const n='ä½ æ˜¯ MVU Beta ä¸“å®¶ã€‚æ ¹æ®åŸå§‹éœ€æ±‚å’Œä¿®æ”¹å»ºè®®ï¼Œé‡æ–°ç”Ÿæˆ [InitVar] JSONã€‚\n\nè§„åˆ™ï¼š\n1. ä¸åŒ…å« "stat_data" æ ¹èŠ‚ç‚¹\n2. æ‰€æœ‰å­—æ®µ: [å€¼, "æè¿°"]\n3. $meta åœ¨æ ¹çº§åˆ«\n4. å­—ç¬¦ä¸²åœ¨ä¸€è¡Œå†…\n5. æè¿°ç®€çŸ­ï¼ˆ20å­—å†…ï¼‰\n\nåªè¾“å‡º JSONã€‚',a=`# åŸå§‹éœ€æ±‚ï¼š\n${u.value}\n\n# ä¿®æ”¹å»ºè®®ï¼š\n${e}\n\nè¯·æ ¹æ®åŸå§‹éœ€æ±‚å’Œä¿®æ”¹å»ºè®®ï¼Œé‡æ–°ç”Ÿæˆ [InitVar] JSONã€‚`,o=(0,l.normalizeApiEndpoint)(t.value.api_endpoint),r=await fetch(o,{method:'POST',headers:{'Content-Type':'application/json',Authorization:`Bearer ${t.value.api_key}`},body:JSON.stringify({model:t.value.model,messages:[{role:'system',content:n},{role:'user',content:a}],temperature:t.value.temperature||.7,max_tokens:t.value.max_tokens||4e3})});if(!r.ok)throw new Error(`API é”™è¯¯: ${r.status}`);const s=await r.json();let i=(s.choices?.[0]?.message?.content||'').replace(/```json\s*/gi,'').replace(/```\s*$/g,'');const d=i.match(/\{[\s\S]*$/);d&&(i=d[0]),i=i.replace(/,(\s*[}\]])/g,'$1');const c=JSON.parse(i),p=Object.keys(c).find(e=>'$meta'!==e)||'myVar';y.value=p;const g=c[p]||{},m=[];for(const e in g){if('$meta'===e)continue;const n=g[e];if(Array.isArray(n)&&2===n.length){const t=n[0],a='number'==typeof t?'number':'string'==typeof t?'string':Array.isArray(t)?'array':'object',o=n[1]||'æè¿°...';m.push(`${e}:${a}:${o}`)}}v.value=m.join('\n'),w.value=JSON.stringify(c,null,2),u.value+=`\n\nã€å·²åº”ç”¨çš„ä¿®æ”¹ã€‘ï¼š${e}`,window.toastr.success('âœ… AI ä¿®æ”¹å®Œæˆï¼'),f.value=!1}catch(e){console.error('AI ä¿®æ”¹å¤±è´¥:',e),window.toastr.error('AI ä¿®æ”¹å¤±è´¥: '+e.message)}finally{x.value=!1}}else window.toastr.warning('è¯·å…ˆç”Ÿæˆç»“æ„')}async function P(e){if(m.value){h.value=!0;try{window.toastr.info('AI æ­£åœ¨ä¿®æ”¹ä¸­...');const n='ä½ æ˜¯ MVU Beta COT æç¤ºè¯ä¸“å®¶ã€‚æ ¹æ®åŸå§‹åœºæ™¯æè¿°å’Œä¿®æ”¹å»ºè®®ï¼Œé‡æ–°ç”Ÿæˆ 6 æ­¥æ€ç»´é“¾æç¤ºè¯ã€‚\n\n## è¦æ±‚ï¼š\n1. åŒ…å« {{get_message_variable::stat_data}}\n2. ä½¿ç”¨ _.insert è€Œé _.assign\n3. æ‰€æœ‰è·¯å¾„ä½¿ç”¨ [0] åç¼€\n4. 6 æ­¥ COT æµç¨‹å®Œæ•´\n\nç›´æ¥è¾“å‡º EJS æ ¼å¼çš„æç¤ºè¯å†…å®¹ã€‚',a=`# åŸå§‹åœºæ™¯æè¿°ï¼š\n${m.value}\n\n# ä¿®æ”¹å»ºè®®ï¼š\n${e}\n\nè¯·æ ¹æ®åŸå§‹åœºæ™¯æè¿°å’Œä¿®æ”¹å»ºè®®ï¼Œé‡æ–°ç”Ÿæˆ COT æç¤ºè¯ã€‚`,o=(0,l.normalizeApiEndpoint)(t.value.api_endpoint),r=await fetch(o,{method:'POST',headers:{'Content-Type':'application/json',Authorization:`Bearer ${t.value.api_key}`},body:JSON.stringify({model:t.value.model,messages:[{role:'system',content:n},{role:'user',content:a}],temperature:t.value.temperature||.7,max_tokens:t.value.max_tokens||3e3})});if(!r.ok)throw new Error(`API é”™è¯¯: ${r.status}`);const s=await r.json();let i=s.choices?.[0]?.message?.content||'';A.value=i.trim(),m.value+=`\n\nã€å·²åº”ç”¨çš„ä¿®æ”¹ã€‘ï¼š${e}`,window.toastr.success('âœ… AI ä¿®æ”¹å®Œæˆï¼'),b.value=!1}catch(e){console.error('AI ä¿®æ”¹å¤±è´¥:',e),window.toastr.error('AI ä¿®æ”¹å¤±è´¥: '+e.message)}finally{h.value=!1}}else window.toastr.warning('è¯·å…ˆç”Ÿæˆæç¤ºè¯')}function D(){w.value?(A.value||N(),setTimeout(()=>{!function(){if(!w.value||!A.value)return void window.toastr.error('è¯·å…ˆç”Ÿæˆ [InitVar] ç»“æ„å’Œ COT æç¤ºè¯');let e='myVar';try{const n=JSON.parse(w.value);e=Object.keys(n).find(e=>'$meta'!==e)||'myVar'}catch(e){console.error('è§£æå˜é‡åå¤±è´¥:',e)}const n=[{uid:j(),key:[],keysecondary:[],comment:'[InitVar]',content:w.value,constant:!1,vectorized:!1,selective:!0,selectiveLogic:0,addMemo:!1,order:100,position:0,disable:!1,excludeRecursion:!1,delayUntilRecursion:!1,probability:100,useProbability:!0,depth:4,group:'',groupOverride:!1,groupWeight:100,scanDepth:null,caseSensitive:null,matchWholeWords:null,useGroupScoring:!1,automationId:'',role:0,sticky:0,cooldown:0,delay:0},{uid:j(),key:[],keysecondary:[],comment:'å˜é‡',content:A.value,constant:!0,vectorized:!1,selective:!1,selectiveLogic:0,addMemo:!1,order:100,position:1,disable:!1,excludeRecursion:!1,delayUntilRecursion:!1,probability:100,useProbability:!0,depth:0,group:'',groupOverride:!1,groupWeight:100,scanDepth:null,caseSensitive:null,matchWholeWords:null,useGroupScoring:!1,automationId:'',role:0,sticky:0,cooldown:0,delay:0}],t=JSON.stringify(n,null,2),a=new Blob([t],{type:'application/json'}),o=URL.createObjectURL(a),r=document.createElement('a');r.href=o,r.download=`${e}_MVU_worldbook.json`,document.body.appendChild(r),r.click(),document.body.removeChild(r),URL.revokeObjectURL(o),window.toastr.success('âœ… å·²å¯¼å‡ºä¸–ç•Œä¹¦ JSONï¼š[InitVar] + å˜é‡è§„åˆ™')}()},100)):window.toastr.error('è¯·å…ˆç”Ÿæˆ [InitVar] ç»“æ„')}function j(){return Date.now()+Math.floor(1e3*Math.random())}(0,i.onMounted)(()=>{!function(){try{const e=(0,d.Ut)();if(!e)return void console.warn('script_id ä¸ºç©ºï¼Œæ— æ³•åŠ è½½ MVU é…ç½®');const n=getVariables({type:'script',script_id:e}).mvu_beta_config;n&&(n.varName&&(y.value=n.varName),n.subFields&&(v.value=n.subFields),n.generatedStructure&&(w.value=n.generatedStructure),n.variableCategories&&(k.value=n.variableCategories),n.generatedPrompt&&(A.value=n.generatedPrompt),console.log('âœ… å·²åŠ è½½ä¿å­˜çš„ MVU Beta é…ç½®'))}catch(e){console.error('åŠ è½½ MVU Beta é…ç½®å¤±è´¥:',e)}}()});let R=null;return(0,i.watch)([y,v,w,k,A],()=>{R&&clearTimeout(R),R=window.setTimeout(()=>{!function(){try{const e=(0,d.Ut)();if(!e)return void console.warn('script_id ä¸ºç©ºï¼Œæ— æ³•ä¿å­˜ MVU é…ç½®');insertOrAssignVariables({mvu_beta_config:{varName:y.value,subFields:v.value,generatedStructure:w.value,variableCategories:k.value,generatedPrompt:A.value}},{type:'script',script_id:e})}catch(e){console.error('ä¿å­˜ MVU Beta é…ç½®å¤±è´¥:',e)}}()},1e3)}),(e,n)=>((0,i.openBlock)(),(0,i.createElementBlock)(i.Fragment,null,[(0,i.createElementVNode)('div',_t,[(0,i.createCommentVNode)(' å˜é‡ç»“æ„ç”Ÿæˆå™¨ '),(0,i.createElementVNode)('div',Vt,[(0,i.createElementVNode)('div',{class:'section-header',style:{display:'flex','justify-content':'space-between','align-items':'center',padding:'15px 20px',background:'linear-gradient(\n            135deg,\n            rgba(30, 30, 30, 0.95) 0%,\n            rgba(38, 38, 38, 0.9) 50%,\n            rgba(30, 30, 30, 0.95) 100%\n          )','backdrop-filter':'blur(12px)','border-radius':'12px','margin-bottom':'15px',border:'1px solid rgba(255, 255, 255, 0.06)','box-shadow':'0 3px 12px rgba(0, 0, 0, 0.3),\n            inset 0 1px 0 rgba(255, 255, 255, 0.04),\n            inset 0 -1px 0 rgba(0, 0, 0, 0.2)',cursor:'pointer',transition:'all 0.3s ease'},onClick:n[0]||(n[0]=e=>o('structure')),onMouseenter:n[1]||(n[1]=e=>e.currentTarget.style.transform='translateY(-1px)'),onMouseleave:n[2]||(n[2]=e=>e.currentTarget.style.transform='translateY(0)')},[n[41]||(n[41]=(0,i.createElementVNode)('h4',{style:{margin:'0',color:'#fff','font-size':'16px','font-weight':'600',display:'flex','align-items':'center',gap:'10px'}},[(0,i.createElementVNode)('i',{class:'fa-solid fa-database',style:{color:'#4a9eff','font-size':'18px'}}),(0,i.createTextVNode)(' [InitVar] å˜é‡ç»“æ„ç”Ÿæˆå™¨ ')],-1)),(0,i.createElementVNode)('i',{class:(0,i.normalizeClass)(a.value.structure?'fa-solid fa-chevron-up':'fa-solid fa-chevron-down'),style:{color:'#ccc',transition:'transform 0.3s ease','font-size':'14px'}},null,2)],32),a.value.structure?((0,i.openBlock)(),(0,i.createElementBlock)('div',zt,[n[57]||(n[57]=(0,i.createStaticVNode)('<div class="tool-instructions" style="margin-bottom:15px;" data-v-6329201c><p style="margin:0 0 8px 0;color:#ccc;font-size:12px;" data-v-6329201c><i class="fa-solid fa-info-circle" style="margin-right:6px;color:#17a2b8;" data-v-6329201c></i> ç”Ÿæˆç¬¦åˆ MVU Beta è§„èŒƒçš„ <strong style="color:#4a9eff;" data-v-6329201c>[InitVar]</strong> åˆå§‹åŒ–æ•°æ®ã€‚ </p><p style="margin:0;color:#ffa500;font-size:11px;background:#1a1a1a;padding:6px;border-radius:4px;border-left:3px solid #ffa500;" data-v-6329201c> âš ï¸ é‡è¦ï¼šInitVar JSON ä¸­<strong data-v-6329201c>ä¸è¦åŒ…å« &quot;stat_data&quot; æ ¹èŠ‚ç‚¹</strong>ï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨æ·»åŠ  </p></div>',1)),(0,i.createCommentVNode)(' AIæ™ºèƒ½ç”ŸæˆåŒºåŸŸ '),(0,i.createElementVNode)('div',Bt,[n[46]||(n[46]=(0,i.createElementVNode)('h4',{style:{color:'#667eea','font-size':'14px',margin:'0 0 12px 0',display:'flex','align-items':'center',gap:'8px'}},[(0,i.createElementVNode)('i',{class:'fa-solid fa-wand-magic-sparkles'}),(0,i.createTextVNode)(' AI æ™ºèƒ½ç”Ÿæˆï¼ˆæ¨èï¼‰ ')],-1)),(0,i.createElementVNode)('div',Mt,[n[42]||(n[42]=(0,i.createElementVNode)('label',{style:{display:'block','margin-bottom':'8px',color:'#ccc','font-size':'13px','font-weight':'500'}},' æè¿°ä½ çš„å˜é‡éœ€æ±‚ï¼š ',-1)),(0,i.withDirectives)((0,i.createElementVNode)('textarea',{'onUpdate:modelValue':n[3]||(n[3]=e=>r.value=e),placeholder:'ä¾‹å¦‚ï¼šæˆ‘éœ€è¦ä¸€ä¸ªè§’è‰²å±æ€§ç³»ç»Ÿï¼ŒåŒ…å«åå­—ï¼ˆå­—ç¬¦ä¸²ï¼‰ã€ç­‰çº§ï¼ˆæ•°å­—ï¼Œåˆå§‹ä¸º1ï¼‰ã€å¥½æ„Ÿåº¦ï¼ˆæ•°å­—ï¼ŒèŒƒå›´-30åˆ°100ï¼‰ã€èƒŒåŒ…ï¼ˆå¯æ‰©å±•æ•°ç»„ï¼‰ã€æˆå°±ï¼ˆå¯æ‰©å±•å¯¹è±¡ï¼‰',rows:'4',style:{width:'100%',padding:'12px',background:'#2a2a2a',border:'1px solid #3a3a3a','border-radius':'6px',color:'#e0e0e0','font-size':'13px',resize:'vertical','line-height':'1.5',transition:'all 0.2s ease'},onFocus:n[4]||(n[4]=e=>e.target.style.borderColor='#667eea'),onBlur:n[5]||(n[5]=e=>e.target.style.borderColor='#3a3a3a')},null,544),[[i.vModelText,r.value]])]),(0,i.createElementVNode)('button',{class:'ai-generate-btn',disabled:s.value||!r.value.trim(),style:(0,i.normalizeStyle)([{padding:'12px 24px',background:'linear-gradient(135deg, #667eea 0%, #764ba2 100%)',border:'none','border-radius':'8px',color:'white','font-size':'13px','font-weight':'600',cursor:'pointer',transition:'all 0.3s ease','box-shadow':'0 3px 12px rgba(102, 126, 234, 0.3)',position:'relative',overflow:'hidden'},{opacity:s.value||!r.value.trim()?.6:1,cursor:s.value||!r.value.trim()?'not-allowed':'pointer'}]),onClick:S,onMouseenter:n[6]||(n[6]=e=>{!s.value&&r.value.trim()&&(e.currentTarget.style.transform='translateY(-2px)',e.currentTarget.style.boxShadow='0 6px 20px rgba(102, 126, 234, 0.4)')}),onMouseleave:n[7]||(n[7]=e=>{e.currentTarget.style.transform='translateY(0)',e.currentTarget.style.boxShadow='0 3px 12px rgba(102, 126, 234, 0.3)'})},[n[43]||(n[43]=(0,i.createElementVNode)('div',{style:{position:'absolute',top:'0',left:'-100%',width:'100%',height:'100%',background:'linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent)',transition:'left 0.5s'},class:'shimmer-effect'},null,-1)),n[44]||(n[44]=(0,i.createElementVNode)('i',{class:'fa-solid fa-wand-magic-sparkles',style:{'font-size':'14px','margin-right':'6px',position:'relative','z-index':'1'}},null,-1)),(0,i.createElementVNode)('span',$t,(0,i.toDisplayString)(s.value?'AI ç”Ÿæˆä¸­...':'AI æ™ºèƒ½ç”Ÿæˆ'),1)],44,Pt),(0,i.createCommentVNode)(' AI ä¿®æ”¹æŒ‰é’® '),w.value&&u.value?((0,i.openBlock)(),(0,i.createElementBlock)('button',{key:0,style:{'margin-left':'12px',padding:'10px 20px',background:'linear-gradient(135deg, rgba(251, 191, 36, 0.2), rgba(245, 158, 11, 0.3))',border:'1px solid rgba(251, 191, 36, 0.4)','border-radius':'8px',color:'#fbbf24','font-size':'13px','font-weight':'600',cursor:'pointer',transition:'all 0.3s ease','box-shadow':'0 2px 8px rgba(251, 191, 36, 0.2)'},onClick:n[8]||(n[8]=e=>f.value=!0),onMouseenter:n[9]||(n[9]=e=>{e.currentTarget.style.background='linear-gradient(135deg, rgba(251, 191, 36, 0.35), rgba(245, 158, 11, 0.45))',e.currentTarget.style.borderColor='rgba(251, 191, 36, 0.6)',e.currentTarget.style.transform='translateY(-2px)',e.currentTarget.style.boxShadow='0 4px 12px rgba(251, 191, 36, 0.35)'}),onMouseleave:n[10]||(n[10]=e=>{e.currentTarget.style.background='linear-gradient(135deg, rgba(251, 191, 36, 0.2), rgba(245, 158, 11, 0.3))',e.currentTarget.style.borderColor='rgba(251, 191, 36, 0.4)',e.currentTarget.style.transform='translateY(0)',e.currentTarget.style.boxShadow='0 2px 8px rgba(251, 191, 36, 0.2)'})},[...n[45]||(n[45]=[(0,i.createElementVNode)('i',{class:'fa-solid fa-edit',style:{'margin-right':'6px'}},null,-1),(0,i.createTextVNode)(' AI ä¿®æ”¹ ',-1)])],32)):(0,i.createCommentVNode)('v-if',!0),n[47]||(n[47]=(0,i.createElementVNode)('p',{style:{color:'#888','font-size':'11px',margin:'8px 0 0 0'}},' ğŸ’¡ AI ä¼šæ ¹æ®ä½ çš„æè¿°è‡ªåŠ¨ç”Ÿæˆç»“æ„ã€é€‰æ‹©ç±»å‹ã€é…ç½® $meta ',-1))]),n[58]||(n[58]=(0,i.createElementVNode)('div',{style:{'text-align':'center',margin:'20px 0',position:'relative'}},[(0,i.createElementVNode)('span',{style:{background:'#1a1a1a',padding:'0 12px',color:'#666','font-size':'12px',position:'relative','z-index':'1'}},'æˆ–æ‰‹åŠ¨é…ç½®'),(0,i.createElementVNode)('div',{style:{position:'absolute',top:'50%',left:'0',right:'0',height:'1px',background:'rgba(255, 255, 255, 0.1)','z-index':'0'}})],-1)),(0,i.createElementVNode)('div',Dt,[n[48]||(n[48]=(0,i.createElementVNode)('label',{style:{display:'block','margin-bottom':'8px',color:'#ccc','font-size':'13px','font-weight':'500'}},' å˜é‡åç§°ï¼š ',-1)),(0,i.withDirectives)((0,i.createElementVNode)('input',{'onUpdate:modelValue':n[11]||(n[11]=e=>y.value=e),type:'text',placeholder:'ä¾‹å¦‚ï¼šè§’è‰²ã€èƒŒåŒ…ã€æŠ€èƒ½',style:{width:'100%',padding:'12px',background:'#2a2a2a',border:'1px solid #3a3a3a','border-radius':'6px',color:'#e0e0e0','font-size':'13px',transition:'all 0.2s ease'},onFocus:n[12]||(n[12]=e=>e.target.style.borderColor='#4a9eff'),onBlur:n[13]||(n[13]=e=>e.target.style.borderColor='#3a3a3a')},null,544),[[i.vModelText,y.value]])]),(0,i.createElementVNode)('div',jt,[n[49]||(n[49]=(0,i.createElementVNode)('label',{style:{display:'block','margin-bottom':'8px',color:'#ccc','font-size':'13px','font-weight':'500'}},' å­å­—æ®µï¼ˆæ¯è¡Œä¸€ä¸ªï¼Œæ ¼å¼ï¼šå­—æ®µå:ç±»å‹:æè¿°ï¼‰ï¼š ',-1)),(0,i.withDirectives)((0,i.createElementVNode)('textarea',{'onUpdate:modelValue':n[14]||(n[14]=e=>v.value=e),placeholder:'ä¾‹å¦‚ï¼š\nå¥½æ„Ÿåº¦:number:[-30,100]ä¹‹é—´ï¼Œä¸è§’è‰²äº¤æµæ—¶å˜åŒ–\nåå­—:string:è§’è‰²åç§°\nèƒŒåŒ…:array:è·å¾—æˆ–ä½¿ç”¨ç‰©å“æ—¶æ›´æ–°',rows:'5',style:{width:'100%',height:'120px',padding:'12px',background:'#2a2a2a',border:'1px solid #3a3a3a','border-radius':'6px',color:'#e0e0e0','font-size':'13px',resize:'vertical','font-family':'\'Courier New\', monospace','line-height':'1.5',transition:'all 0.2s ease'},onFocus:n[15]||(n[15]=e=>e.target.style.borderColor='#4a9eff'),onBlur:n[16]||(n[16]=e=>e.target.style.borderColor='#3a3a3a')},null,544),[[i.vModelText,v.value]]),n[50]||(n[50]=(0,i.createElementVNode)('p',{style:{color:'#888','font-size':'11px',margin:'6px 0 0 0'}},'ğŸ’¡ æ”¯æŒç±»å‹ï¼šnumberã€stringã€arrayã€object',-1))]),(0,i.createElementVNode)('button',{class:'generate-btn',style:{padding:'12px 24px',background:'linear-gradient(135deg, #667eea 0%, #764ba2 100%)',border:'none','border-radius':'8px',color:'white','font-size':'13px','font-weight':'600',cursor:'pointer',transition:'all 0.3s ease','box-shadow':'0 3px 12px rgba(102, 126, 234, 0.3)',position:'relative',overflow:'hidden'},onClick:E,onMouseenter:n[17]||(n[17]=e=>{e.currentTarget.style.transform='translateY(-2px)',e.currentTarget.style.boxShadow='0 6px 20px rgba(102, 126, 234, 0.4)'}),onMouseleave:n[18]||(n[18]=e=>{e.currentTarget.style.transform='translateY(0)',e.currentTarget.style.boxShadow='0 3px 12px rgba(102, 126, 234, 0.3)'})},[...n[51]||(n[51]=[(0,i.createElementVNode)('div',{style:{position:'absolute',top:'0',left:'-100%',width:'100%',height:'100%',background:'linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent)',transition:'left 0.5s'},class:'shimmer-effect'},null,-1),(0,i.createElementVNode)('i',{class:'fa-solid fa-magic',style:{'font-size':'14px','margin-right':'6px',position:'relative','z-index':'1'}},null,-1),(0,i.createElementVNode)('span',{style:{position:'relative','z-index':'1'}},'ç”Ÿæˆ [InitVar] ç»“æ„',-1)])],32),w.value?((0,i.openBlock)(),(0,i.createElementBlock)('div',Rt,[n[56]||(n[56]=(0,i.createElementVNode)('h4',{style:{color:'#4a9eff','font-size':'14px','margin-bottom':'10px'}},'ç”Ÿæˆçš„ [InitVar] ç»“æ„ï¼š',-1)),(0,i.createElementVNode)('div',Ot,[(0,i.createElementVNode)('pre',null,(0,i.toDisplayString)(w.value),1),(0,i.createElementVNode)('button',{class:'copy-btn-abs',onClick:T},[...n[52]||(n[52]=[(0,i.createElementVNode)('i',{class:'fa-solid fa-copy'},null,-1)])])]),(0,i.createCommentVNode)(' å¿«æ·æ“ä½œ '),(0,i.createElementVNode)('div',Ft,[n[55]||(n[55]=(0,i.createElementVNode)('p',{style:{margin:'0 0 10px 0',color:'#4a9eff','font-size':'12px','font-weight':'600'}},[(0,i.createElementVNode)('i',{class:'fa-solid fa-link'}),(0,i.createTextVNode)(' åŸºäºæ­¤ç»“æ„ç»§ç»­ç”Ÿæˆï¼š ')],-1)),(0,i.createElementVNode)('div',Lt,[(0,i.createElementVNode)('button',{style:{flex:'1','min-width':'140px',padding:'8px 16px',background:'linear-gradient(135deg, rgba(16, 185, 129, 0.2), rgba(5, 150, 105, 0.3))',color:'#10b981',border:'1px solid rgba(16, 185, 129, 0.4)','border-radius':'6px','font-size':'12px',cursor:'pointer',transition:'all 0.2s'},onClick:N,onMouseenter:n[19]||(n[19]=e=>{e.currentTarget.style.transform='translateY(-1px)',e.currentTarget.style.boxShadow='0 4px 12px rgba(16, 185, 129, 0.3)'}),onMouseleave:n[20]||(n[20]=e=>{e.currentTarget.style.transform='translateY(0)',e.currentTarget.style.boxShadow='none'})},[...n[53]||(n[53]=[(0,i.createElementVNode)('i',{class:'fa-solid fa-file-alt'},null,-1),(0,i.createTextVNode)(' ç”Ÿæˆ COT æç¤ºè¯ ',-1)])],32),(0,i.createElementVNode)('button',{style:{flex:'1','min-width':'140px',padding:'8px 16px',background:'linear-gradient(135deg, rgba(245, 158, 11, 0.2), rgba(217, 119, 6, 0.3))',color:'#f59e0b',border:'1px solid rgba(245, 158, 11, 0.4)','border-radius':'6px','font-size':'12px',cursor:'pointer',transition:'all 0.2s'},onClick:D,onMouseenter:n[21]||(n[21]=e=>{e.currentTarget.style.transform='translateY(-1px)',e.currentTarget.style.boxShadow='0 4px 12px rgba(245, 158, 11, 0.3)'}),onMouseleave:n[22]||(n[22]=e=>{e.currentTarget.style.transform='translateY(0)',e.currentTarget.style.boxShadow='none'})},[...n[54]||(n[54]=[(0,i.createElementVNode)('i',{class:'fa-solid fa-book'},null,-1),(0,i.createTextVNode)(' å¯¼å‡ºä¸–ç•Œä¹¦ JSON ',-1)])],32)])])])):(0,i.createCommentVNode)('v-if',!0)])):(0,i.createCommentVNode)('v-if',!0)]),(0,i.createCommentVNode)(' COT æç¤ºè¯ç”Ÿæˆå™¨ '),(0,i.createElementVNode)('div',Ht,[(0,i.createElementVNode)('div',{class:'section-header',style:{display:'flex','justify-content':'space-between','align-items':'center',padding:'15px 20px',background:'linear-gradient(\n            135deg,\n            rgba(30, 30, 30, 0.95) 0%,\n            rgba(38, 38, 38, 0.9) 50%,\n            rgba(30, 30, 30, 0.95) 100%\n          )','backdrop-filter':'blur(12px)','border-radius':'12px','margin-bottom':'15px',border:'1px solid rgba(255, 255, 255, 0.06)','box-shadow':'0 3px 12px rgba(0, 0, 0, 0.3),\n            inset 0 1px 0 rgba(255, 255, 255, 0.04),\n            inset 0 -1px 0 rgba(0, 0, 0, 0.2)',cursor:'pointer',transition:'all 0.3s ease'},onClick:n[23]||(n[23]=e=>o('prompt')),onMouseenter:n[24]||(n[24]=e=>e.currentTarget.style.transform='translateY(-1px)'),onMouseleave:n[25]||(n[25]=e=>e.currentTarget.style.transform='translateY(0)')},[n[59]||(n[59]=(0,i.createElementVNode)('h4',{style:{margin:'0',color:'#fff','font-size':'16px','font-weight':'600',display:'flex','align-items':'center',gap:'10px'}},[(0,i.createElementVNode)('i',{class:'fa-solid fa-file-code',style:{color:'#fbbf24','font-size':'18px'}}),(0,i.createTextVNode)(' COT æç¤ºè¯ç”Ÿæˆå™¨ï¼ˆ6 æ­¥æ€ç»´é“¾ï¼‰ ')],-1)),(0,i.createElementVNode)('i',{class:(0,i.normalizeClass)(a.value.prompt?'fa-solid fa-chevron-up':'fa-solid fa-chevron-down'),style:{color:'#ccc',transition:'transform 0.3s ease','font-size':'14px'}},null,2)],32),a.value.prompt?((0,i.openBlock)(),(0,i.createElementBlock)('div',Ut,[n[71]||(n[71]=(0,i.createElementVNode)('div',{class:'tool-instructions',style:{'margin-bottom':'15px'}},[(0,i.createElementVNode)('p',{style:{margin:'0 0 8px 0',color:'#ccc','font-size':'12px'}},[(0,i.createElementVNode)('i',{class:'fa-solid fa-info-circle',style:{'margin-right':'6px',color:'#17a2b8'}}),(0,i.createTextVNode)(' ç”Ÿæˆé€‚ç”¨äº MVU Beta çš„ '),(0,i.createElementVNode)('strong',{style:{color:'#fbbf24'}},'COTï¼ˆæ€ç»´é“¾ï¼‰æç¤ºè¯æ¨¡æ¿'),(0,i.createTextVNode)('ï¼ŒåŒ…å« 6 æ­¥åˆ†ææµç¨‹ã€‚ ')])],-1)),(0,i.createCommentVNode)(' AIæ™ºèƒ½ç”ŸæˆåŒºåŸŸ '),(0,i.createElementVNode)('div',Gt,[n[64]||(n[64]=(0,i.createElementVNode)('h4',{style:{color:'#fbbf24','font-size':'14px',margin:'0 0 12px 0',display:'flex','align-items':'center',gap:'8px'}},[(0,i.createElementVNode)('i',{class:'fa-solid fa-wand-magic-sparkles'}),(0,i.createTextVNode)(' AI æ™ºèƒ½ç”Ÿæˆï¼ˆæ¨èï¼‰ ')],-1)),(0,i.createElementVNode)('div',Yt,[n[60]||(n[60]=(0,i.createElementVNode)('label',{style:{display:'block','margin-bottom':'8px',color:'#ccc','font-size':'13px','font-weight':'500'}},' æè¿°ä½ çš„å˜é‡ç³»ç»Ÿå’Œä½¿ç”¨åœºæ™¯ï¼š ',-1)),(0,i.withDirectives)((0,i.createElementVNode)('textarea',{'onUpdate:modelValue':n[26]||(n[26]=e=>c.value=e),placeholder:'ä¾‹å¦‚ï¼šæˆ‘çš„è§’è‰²å¡æœ‰ä¸€ä¸ªå¥½æ„Ÿåº¦ç³»ç»Ÿå’Œæ—¶é—´ç³»ç»Ÿï¼Œéœ€è¦ AI åœ¨æ¯æ¬¡äº’åŠ¨åæ›´æ–°æ—¶é—´å’Œå¥½æ„Ÿåº¦',rows:'4',style:{width:'100%',padding:'12px',background:'#2a2a2a',border:'1px solid #3a3a3a','border-radius':'6px',color:'#e0e0e0','font-size':'13px',resize:'vertical','line-height':'1.5',transition:'all 0.2s ease'},onFocus:n[27]||(n[27]=e=>e.target.style.borderColor='#fbbf24'),onBlur:n[28]||(n[28]=e=>e.target.style.borderColor='#3a3a3a')},null,544),[[i.vModelText,c.value]])]),(0,i.createElementVNode)('button',{class:'ai-generate-btn',disabled:g.value||!c.value.trim(),style:(0,i.normalizeStyle)([{padding:'12px 24px',background:'linear-gradient(135deg, #fbbf24 0%, #f59e0b 100%)',border:'none','border-radius':'8px',color:'white','font-size':'13px','font-weight':'600',cursor:'pointer',transition:'all 0.3s ease','box-shadow':'0 3px 12px rgba(251, 191, 36, 0.3)',position:'relative',overflow:'hidden'},{opacity:g.value||!c.value.trim()?.6:1,cursor:g.value||!c.value.trim()?'not-allowed':'pointer'}]),onClick:B,onMouseenter:n[29]||(n[29]=e=>{!g.value&&c.value.trim()&&(e.currentTarget.style.transform='translateY(-2px)',e.currentTarget.style.boxShadow='0 6px 20px rgba(251, 191, 36, 0.4)')}),onMouseleave:n[30]||(n[30]=e=>{e.currentTarget.style.transform='translateY(0)',e.currentTarget.style.boxShadow='0 3px 12px rgba(251, 191, 36, 0.3)'})},[n[61]||(n[61]=(0,i.createElementVNode)('div',{style:{position:'absolute',top:'0',left:'-100%',width:'100%',height:'100%',background:'linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent)',transition:'left 0.5s'},class:'shimmer-effect'},null,-1)),n[62]||(n[62]=(0,i.createElementVNode)('i',{class:'fa-solid fa-wand-magic-sparkles',style:{'font-size':'14px','margin-right':'6px',position:'relative','z-index':'1'}},null,-1)),(0,i.createElementVNode)('span',Wt,(0,i.toDisplayString)(g.value?'AI ç”Ÿæˆä¸­...':'AI æ™ºèƒ½ç”Ÿæˆ'),1)],44,Jt),(0,i.createCommentVNode)(' AI ä¿®æ”¹æŒ‰é’® '),A.value&&m.value?((0,i.openBlock)(),(0,i.createElementBlock)('button',{key:0,style:{'margin-left':'12px',padding:'10px 20px',background:'linear-gradient(135deg, rgba(251, 191, 36, 0.2), rgba(245, 158, 11, 0.3))',border:'1px solid rgba(251, 191, 36, 0.4)','border-radius':'8px',color:'#fbbf24','font-size':'13px','font-weight':'600',cursor:'pointer',transition:'all 0.3s ease','box-shadow':'0 2px 8px rgba(251, 191, 36, 0.2)'},onClick:n[31]||(n[31]=e=>b.value=!0),onMouseenter:n[32]||(n[32]=e=>{e.currentTarget.style.background='linear-gradient(135deg, rgba(251, 191, 36, 0.35), rgba(245, 158, 11, 0.45))',e.currentTarget.style.borderColor='rgba(251, 191, 36, 0.6)',e.currentTarget.style.transform='translateY(-2px)',e.currentTarget.style.boxShadow='0 4px 12px rgba(251, 191, 36, 0.35)'}),onMouseleave:n[33]||(n[33]=e=>{e.currentTarget.style.background='linear-gradient(135deg, rgba(251, 191, 36, 0.2), rgba(245, 158, 11, 0.3))',e.currentTarget.style.borderColor='rgba(251, 191, 36, 0.4)',e.currentTarget.style.transform='translateY(0)',e.currentTarget.style.boxShadow='0 2px 8px rgba(251, 191, 36, 0.2)'})},[...n[63]||(n[63]=[(0,i.createElementVNode)('i',{class:'fa-solid fa-edit',style:{'margin-right':'6px'}},null,-1),(0,i.createTextVNode)(' AI ä¿®æ”¹ ',-1)])],32)):(0,i.createCommentVNode)('v-if',!0),n[65]||(n[65]=(0,i.createElementVNode)('p',{style:{color:'#888','font-size':'11px',margin:'8px 0 0 0'}},' ğŸ’¡ AI ä¼šæ ¹æ®ä½ çš„æè¿°è‡ªåŠ¨ç”Ÿæˆå®Œæ•´çš„ 6 æ­¥ COT æç¤ºè¯ ',-1))]),n[72]||(n[72]=(0,i.createElementVNode)('div',{style:{'text-align':'center',margin:'20px 0',position:'relative'}},[(0,i.createElementVNode)('span',{style:{background:'#1a1a1a',padding:'0 12px',color:'#666','font-size':'12px',position:'relative','z-index':'1'}},'æˆ–æ‰‹åŠ¨é…ç½®'),(0,i.createElementVNode)('div',{style:{position:'absolute',top:'50%',left:'0',right:'0',height:'1px',background:'rgba(255, 255, 255, 0.1)','z-index':'0'}})],-1)),w.value?((0,i.openBlock)(),(0,i.createElementBlock)('div',qt,[n[66]||(n[66]=(0,i.createElementVNode)('label',{style:{display:'block','margin-bottom':'8px',color:'#ccc','font-size':'13px','font-weight':'500'}},' å˜é‡åˆ†ç±»ï¼ˆç”¨äº STEP 3ï¼Œæ¯è¡Œä¸€ä¸ªåˆ†ç±»ï¼‰ï¼š ',-1)),(0,i.withDirectives)((0,i.createElementVNode)('textarea',{'onUpdate:modelValue':n[34]||(n[34]=e=>k.value=e),placeholder:'ä¾‹å¦‚ï¼š\nåŸºç¡€ä¿¡æ¯ - 3 fields\näººç‰©å…³ç³» - 2 fields\né‡è¦è®°å¿† - 1 field',rows:'4',style:{width:'100%',padding:'12px',background:'#2a2a2a',border:'1px solid #3a3a3a','border-radius':'6px',color:'#e0e0e0','font-size':'13px',resize:'vertical','font-family':'\'Courier New\', monospace','line-height':'1.5',transition:'all 0.2s ease'},onFocus:n[35]||(n[35]=e=>e.target.style.borderColor='#fbbf24'),onBlur:n[36]||(n[36]=e=>e.target.style.borderColor='#3a3a3a')},null,544),[[i.vModelText,k.value]]),n[67]||(n[67]=(0,i.createElementVNode)('p',{style:{color:'#888','font-size':'11px',margin:'6px 0 0 0'}},'ğŸ’¡ AI ä¼šåœ¨ STEP 3 ä¸­æŒ‰ç…§è¿™äº›åˆ†ç±»é€ä¸ªæ£€æŸ¥å˜é‡',-1))])):(0,i.createCommentVNode)('v-if',!0),(0,i.createElementVNode)('button',{class:'generate-btn',style:{'margin-top':'10px',padding:'12px 24px',background:'linear-gradient(135deg, #667eea 0%, #764ba2 100%)',border:'none','border-radius':'8px',color:'white','font-size':'13px','font-weight':'600',cursor:'pointer',transition:'all 0.3s ease','box-shadow':'0 3px 12px rgba(102, 126, 234, 0.3)',position:'relative',overflow:'hidden'},onClick:I,onMouseenter:n[37]||(n[37]=e=>{e.currentTarget.style.transform='translateY(-2px)',e.currentTarget.style.boxShadow='0 6px 20px rgba(102, 126, 234, 0.4)'}),onMouseleave:n[38]||(n[38]=e=>{e.currentTarget.style.transform='translateY(0)',e.currentTarget.style.boxShadow='0 3px 12px rgba(102, 126, 234, 0.3)'})},[...n[68]||(n[68]=[(0,i.createElementVNode)('div',{style:{position:'absolute',top:'0',left:'-100%',width:'100%',height:'100%',background:'linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent)',transition:'left 0.5s'},class:'shimmer-effect'},null,-1),(0,i.createElementVNode)('i',{class:'fa-solid fa-magic',style:{'font-size':'14px','margin-right':'6px',position:'relative','z-index':'1'}},null,-1),(0,i.createElementVNode)('span',{style:{position:'relative','z-index':'1'}},'ç”Ÿæˆ COT æç¤ºè¯',-1)])],32),A.value?((0,i.openBlock)(),(0,i.createElementBlock)('div',Kt,[n[70]||(n[70]=(0,i.createElementVNode)('h4',{style:{color:'#fbbf24','font-size':'14px','margin-bottom':'10px'}},'ç”Ÿæˆçš„ COT æç¤ºè¯ï¼š',-1)),(0,i.createElementVNode)('div',Xt,[(0,i.createElementVNode)('pre',null,(0,i.toDisplayString)(A.value),1),(0,i.createElementVNode)('button',{class:'copy-btn-abs',onClick:V},[...n[69]||(n[69]=[(0,i.createElementVNode)('i',{class:'fa-solid fa-copy'},null,-1)])])])])):(0,i.createCommentVNode)('v-if',!0)])):(0,i.createCommentVNode)('v-if',!0)])]),(0,i.createCommentVNode)(' AI ä¿®æ”¹å¯¹è¯æ¡† - ç»“æ„ '),(0,i.createVNode)(U,{show:f.value,'is-modifying':x.value,title:'AI ä¿®æ”¹ [InitVar] ç»“æ„',description:'å‘Šè¯‰ AI ä½ æƒ³å¦‚ä½•ä¿®æ”¹å½“å‰çš„ MVU ç»“æ„',examples:['å¢åŠ ä¸€ä¸ªã€å¥åº·å€¼ã€‘å­—æ®µï¼Œç±»å‹ä¸º number','åˆ é™¤ã€èƒŒåŒ…ã€‘å­—æ®µ','å°†ã€å¥½æ„Ÿåº¦ã€‘çš„æè¿°æ”¹ä¸ºæ›´è¯¦ç»†çš„è¯´æ˜','è°ƒæ•´å­—æ®µé¡ºåºï¼ŒæŠŠã€æ—¶é—´ã€‘æ”¾åˆ°æœ€å‰é¢'],onClose:n[39]||(n[39]=e=>f.value=!1),onConfirm:M},null,8,['show','is-modifying']),(0,i.createCommentVNode)(' AI ä¿®æ”¹å¯¹è¯æ¡† - æç¤ºè¯ '),(0,i.createVNode)(U,{show:b.value,'is-modifying':h.value,title:'AI ä¿®æ”¹ COT æç¤ºè¯',description:'å‘Šè¯‰ AI ä½ æƒ³å¦‚ä½•ä¿®æ”¹å½“å‰çš„æç¤ºè¯',examples:['åœ¨ STEP 2 ä¸­æ·»åŠ å¯¹åœºæ™¯å˜åŒ–çš„æ£€æŸ¥','å¼ºè°ƒæ—¶é—´å¿…é¡»ç²¾ç¡®åˆ°åˆ†é’Ÿ','å¢åŠ å¯¹ç‰¹æ®ŠçŠ¶æ€çš„å¤„ç†è¯´æ˜','ç®€åŒ– STEP 3 çš„åˆ†ææ­¥éª¤'],onClose:n[40]||(n[40]=e=>b.value=!1),onConfirm:P},null,8,['show','is-modifying'])],64))}});s(508);const Zt=(0,V.A)(Qt,[['__scopeId','data-v-6329201c']]),ea={key:0,class:'progress-overlay',style:{position:'fixed',top:'0',left:'0',right:'0',bottom:'0',background:'rgba(0, 0, 0, 0.85)',display:'flex','align-items':'center','justify-content':'center','z-index':'999999',animation:'fadeIn 0.2s ease'}},na={class:'progress-card',style:{background:'linear-gradient(145deg, #2a2a2a, #1e1e1e)','border-radius':'16px',padding:'35px',width:'520px','max-width':'90vw','box-shadow':'0 10px 40px rgba(0, 0, 0, 0.5)',border:'1px solid #3a3a3a',animation:'slideUp 0.3s ease'}},ta={style:{display:'flex','align-items':'center',gap:'12px','margin-bottom':'24px'}},aa={style:{margin:'0',color:'#fff','font-size':'18px','font-weight':'600'}},oa={class:'progress-bar-container',style:{width:'100%',height:'10px',background:'rgba(30, 30, 30, 0.8)','border-radius':'5px',overflow:'hidden','margin-bottom':'20px','box-shadow':'inset 0 1px 3px rgba(0, 0, 0, 0.3)'}},ra={class:'current-stage',style:{color:'#e0e0e0','font-size':'14px','margin-bottom':'12px','min-height':'20px'}},sa={key:0,class:'details-area',style:{'max-height':'150px','overflow-y':'auto',background:'rgba(10, 10, 10, 0.5)','border-radius':'8px',padding:'12px','margin-bottom':'16px','font-family':'\'Consolas\', \'Monaco\', monospace','font-size':'11px',color:'#a0a0a0','line-height':'1.6'}},ia={style:{display:'flex','justify-content':'space-between','align-items':'center'}},la={class:'progress-percent',style:{color:'#4a9eff','font-size':'16px','font-weight':'600'}},da={class:'elapsed-time',style:{color:'#888','font-size':'12px'}},ca=(0,i.defineComponent)({__name:'ProgressDialog',props:{show:{type:Boolean},title:{default:'AI æ­£åœ¨å¤„ç†'},initialMessage:{default:'æ­£åœ¨å‡†å¤‡...'},cancellable:{type:Boolean,default:!1}},emits:['cancel'],setup(e,{expose:n}){const t=e,a=(0,i.ref)(0),o=(0,i.ref)(t.initialMessage),r=(0,i.ref)([]),s=(0,i.ref)(0),l=(0,i.ref)(0);let d=null;return(0,i.watch)(()=>t.show,e=>{e?(a.value=0,o.value=t.initialMessage,r.value=[],s.value=Date.now(),l.value=0,d&&clearInterval(d),d=window.setInterval(()=>{l.value=Math.floor((Date.now()-s.value)/1e3)},1e3)):d&&(clearInterval(d),d=null)}),(0,i.onUnmounted)(()=>{d&&clearInterval(d)}),n({setProgress:function(e){a.value=Math.min(100,Math.max(0,e))},setMessage:function(e){o.value=e},addDetail:function(e){r.value.push(e),setTimeout(()=>{const e=document.querySelector('.details-area');e&&(e.scrollTop=e.scrollHeight)},50)},clearDetails:function(){r.value=[]},complete:function(){a.value=100,o.value='å®Œæˆï¼'}}),(n,t)=>e.show?((0,i.openBlock)(),(0,i.createElementBlock)('div',ea,[(0,i.createElementVNode)('div',na,[(0,i.createCommentVNode)(' æ ‡é¢˜ '),(0,i.createElementVNode)('div',ta,[t[3]||(t[3]=(0,i.createElementVNode)('div',{class:'spinner',style:{width:'28px',height:'28px',border:'3px solid #3a3a3a','border-top-color':'#4a9eff','border-radius':'50%',animation:'spin 0.8s linear infinite'}},null,-1)),(0,i.createElementVNode)('h3',aa,(0,i.toDisplayString)(e.title),1)]),(0,i.createCommentVNode)(' è¿›åº¦æ¡ '),(0,i.createElementVNode)('div',oa,[(0,i.createElementVNode)('div',{class:'progress-bar',style:(0,i.normalizeStyle)({width:a.value+'%',height:'100%',background:'linear-gradient(90deg, #4a9eff 0%, #7c3aed 50%, #10b981 100%)',transition:'width 0.3s ease',boxShadow:'0 0 10px rgba(74, 158, 255, 0.5)'})},null,4)]),(0,i.createCommentVNode)(' å½“å‰é˜¶æ®µ '),(0,i.createElementVNode)('div',ra,(0,i.toDisplayString)(o.value),1),(0,i.createCommentVNode)(' è¯¦ç»†ä¿¡æ¯åŒºåŸŸ '),r.value.length>0?((0,i.openBlock)(),(0,i.createElementBlock)('div',sa,[((0,i.openBlock)(!0),(0,i.createElementBlock)(i.Fragment,null,(0,i.renderList)(r.value,(e,n)=>((0,i.openBlock)(),(0,i.createElementBlock)('div',{key:n,style:{'margin-bottom':'4px'}},[t[4]||(t[4]=(0,i.createElementVNode)('span',{style:{color:'#4a9eff'}},'â€¢',-1)),(0,i.createTextVNode)(' '+(0,i.toDisplayString)(e),1)]))),128))])):(0,i.createCommentVNode)('v-if',!0),(0,i.createCommentVNode)(' ç™¾åˆ†æ¯”å’Œè€—æ—¶ '),(0,i.createElementVNode)('div',ia,[(0,i.createElementVNode)('div',la,(0,i.toDisplayString)(Math.round(a.value))+'% ',1),(0,i.createElementVNode)('div',da,'å·²è€—æ—¶: '+(0,i.toDisplayString)(l.value)+'ç§’',1)]),(0,i.createCommentVNode)(' å–æ¶ˆæŒ‰é’®ï¼ˆå¯é€‰ï¼‰ '),e.cancellable?((0,i.openBlock)(),(0,i.createElementBlock)('button',{key:1,style:{width:'100%','margin-top':'20px',padding:'10px',background:'#3a3a3a',border:'1px solid #4a4a4a','border-radius':'8px',color:'#e0e0e0','font-size':'13px',cursor:'pointer',transition:'all 0.2s'},onMouseenter:t[0]||(t[0]=e=>e.currentTarget.style.background='#4a4a4a'),onMouseleave:t[1]||(t[1]=e=>e.currentTarget.style.background='#3a3a3a'),onClick:t[2]||(t[2]=e=>n.$emit('cancel'))},' å–æ¶ˆ ',32)):(0,i.createCommentVNode)('v-if',!0)])])):(0,i.createCommentVNode)('v-if',!0)}});s(651);const pa=(0,V.A)(ca,[['__scopeId','data-v-e3e6a546']]),ga={class:'project-tab'},ua={class:'section-header',style:{display:'flex','justify-content':'space-between','align-items':'center',padding:'20px 28px',background:'#2a2a2a','backdrop-filter':'blur(12px)','border-radius':'14px','margin-bottom':'20px',border:'1px solid #333','box-shadow':'0 2px 8px rgba(0, 0, 0, 0.3)'}},ma={class:'project-action-buttons',style:{display:'flex',gap:'10px'}},fa={style:{display:'grid','grid-template-columns':'220px 1fr 650px',gap:'20px','min-height':'500px'}},xa={style:{background:'#2a2a2a','border-radius':'12px',padding:'15px',border:'1px solid #3a3a3a',display:'flex','flex-direction':'column'}},ba={key:0,style:{'text-align':'center',color:'#666','font-size':'12px',padding:'20px 10px'}},ha=['onClick','onMouseenter','onMouseleave'],ya={style:{'font-size':'13px',flex:'1'}},va=['onClick'],wa={key:1,style:{'margin-top':'20px','border-top':'1px solid #3a3a3a','padding-top':'15px'}},ka={style:{display:'flex','justify-content':'space-between','align-items':'center','margin-bottom':'10px'}},Aa={style:{display:'flex',gap:'5px'}},Ca=['onClick','onMouseenter','onMouseleave'],Ea=['onClick'],Ta={style:{background:'#2a2a2a','border-radius':'12px',padding:'15px',border:'1px solid #3a3a3a',display:'flex','flex-direction':'column'}},Sa={key:0,style:{flex:'1',display:'flex','align-items':'center','justify-content':'center',color:'#666','font-size':'14px'}},Na={key:1,style:{flex:'1',display:'flex','align-items':'center','justify-content':'center',color:'#666','font-size':'14px'}},Ia={key:2,style:{display:'flex','flex-direction':'column',height:'100%'}},_a={style:{'margin-bottom':'10px',display:'flex','justify-content':'space-between','align-items':'center'}},Va={style:{display:'flex','align-items':'center',gap:'8px'}},za={style:{color:'#fff','font-size':'14px','font-weight':'500'}},Ba={style:{display:'flex','align-items':'center',gap:'10px'}},Ma=['placeholder'],Pa={style:{background:'#2a2a2a','border-radius':'12px',padding:'15px',border:'1px solid #3a3a3a',display:'flex','flex-direction':'column'}},$a={style:{display:'flex','justify-content':'space-between','align-items':'center','margin-bottom':'15px'}},Da={style:{display:'flex',gap:'8px'}},ja={style:{flex:'1',background:'#1e1e1e','border-radius':'8px',overflow:'auto',position:'relative','min-height':'400px'}},Ra=['srcdoc'],Oa={key:1,style:{position:'absolute',top:'50%',left:'50%',transform:'translate(-50%, -50%)',color:'#666','font-size':'12px','text-align':'center'}},Fa={style:{background:'#2a2a2a','border-radius':'12px',padding:'25px',width:'90%','max-width':'600px',border:'1px solid #3a3a3a','box-shadow':'0 10px 40px rgba(0, 0, 0, 0.5)'}},La={style:{'margin-bottom':'15px'}},Ha={style:{'margin-top':'12px'}},Ua={style:{display:'flex','flex-wrap':'wrap',gap:'8px'}},Ga=['onClick'],Ya={style:{display:'flex','align-items':'center',gap:'10px','margin-bottom':'15px',padding:'10px',background:'#252525','border-radius':'6px'}},Ja={style:{display:'flex','align-items':'center',gap:'8px',cursor:'pointer',color:'#ccc','font-size':'13px','user-select':'none'}},Wa={key:0,style:{'margin-bottom':'15px',padding:'15px',background:'#1e1e1e',border:'1px solid #3a3a3a','border-radius':'6px','max-height':'200px','overflow-y':'auto','font-family':'\'Consolas\', monospace','font-size':'12px',color:'#e0e0e0','line-height':'1.5','white-space':'pre-wrap'}},qa={style:{display:'flex',gap:'10px','justify-content':'flex-end'}},Ka=['disabled'],Xa={key:0,class:'fa-solid fa-wand-magic-sparkles',style:{'margin-right':'6px'}},Qa={key:1,class:'fa-solid fa-spinner fa-spin',style:{'margin-right':'6px'}},Za={style:{background:'#2a2a2a','border-radius':'12px',padding:'25px',width:'90%','max-width':'650px',border:'1px solid #3a3a3a','box-shadow':'0 10px 40px rgba(0, 0, 0, 0.5)'}},eo={style:{'margin-bottom':'15px'}},no={style:{'margin-bottom':'15px'}},to={style:{'margin-bottom':'15px'}},ao={style:{display:'flex',gap:'10px','justify-content':'flex-end'}},oo=['disabled'],ro={key:0,class:'fa-solid fa-wrench',style:{'margin-right':'6px'}},so={key:1,class:'fa-solid fa-spinner fa-spin',style:{'margin-right':'6px'}},io={key:2,style:{position:'fixed',top:'0',left:'0',right:'0',bottom:'0',background:'rgba(0, 0, 0, 0.9)',display:'flex','align-items':'center','justify-content':'center','z-index':'10001',padding:'20px'}},lo={style:{background:'#2a2a2a','border-radius':'12px',width:'95%',height:'90%',border:'1px solid #3a3a3a','box-shadow':'0 10px 40px rgba(0, 0, 0, 0.5)',display:'flex','flex-direction':'column'}},co={style:{padding:'20px 25px','border-bottom':'1px solid #3a3a3a',display:'flex','justify-content':'space-between','align-items':'center'}},po={style:{display:'flex',gap:'10px'}},go={style:{flex:'1',display:'grid','grid-template-columns':'1fr 1fr 1.5fr',gap:'15px',padding:'20px',overflow:'hidden'}},uo={style:{display:'flex','flex-direction':'column',background:'#1e1e1e','border-radius':'8px',overflow:'hidden'}},mo={style:{flex:'1','overflow-y':'auto',padding:'15px'}},fo={style:{color:'#4a9eff','font-size':'12px','font-weight':'600','margin-bottom':'8px',display:'flex','align-items':'center',gap:'6px'}},xo={style:{margin:'0',padding:'12px',background:'#1a1a1a','border-radius':'6px',color:'#e0e0e0','font-family':'\'Consolas\', \'Monaco\', monospace','font-size':'12px','line-height':'1.5','overflow-x':'auto',border:'1px solid #3a3a3a'}},bo={style:{display:'flex','flex-direction':'column',background:'#1e1e1e','border-radius':'8px',overflow:'hidden'}},ho={style:{flex:'1','overflow-y':'auto',padding:'15px'}},yo={style:{color:'#4a9eff','font-size':'12px','font-weight':'600','margin-bottom':'8px',display:'flex','align-items':'center',gap:'6px'}},vo={style:{margin:'0',padding:'12px',background:'#1a1a1a','border-radius':'6px',color:'#e0e0e0','font-family':'\'Consolas\', \'Monaco\', monospace','font-size':'12px','line-height':'1.5','overflow-x':'auto',border:'1px solid #3a3a3a'}},wo={style:{display:'flex','flex-direction':'column',background:'#1e1e1e','border-radius':'8px',overflow:'hidden'}},ko={style:{padding:'12px 15px',background:'#2a2a2a','border-bottom':'1px solid #3a3a3a',display:'flex','justify-content':'space-between','align-items':'center'}},Ao={style:{display:'flex',gap:'8px'}},Co={style:{flex:'1',background:'white',overflow:'hidden'}},Eo=['srcdoc'],To={style:{background:'#2a2a2a','border-radius':'12px',width:'90%','max-width':'900px','max-height':'80%',border:'1px solid #3a3a3a','box-shadow':'0 10px 40px rgba(0, 0, 0, 0.5)',display:'flex','flex-direction':'column'}},So={style:{padding:'20px 25px','border-bottom':'1px solid #3a3a3a',display:'flex','justify-content':'space-between','align-items':'center'}},No={style:{flex:'1','overflow-y':'auto',padding:'20px'}},Io={key:0,style:{'text-align':'center',color:'#666',padding:'40px 20px'}},_o={style:{display:'flex','justify-content':'space-between','align-items':'start','margin-bottom':'10px'}},Vo={style:{color:'#fff','font-size':'14px','font-weight':'600','margin-bottom':'5px'}},zo={style:{color:'#888','font-size':'12px'}},Bo=['onClick'],Mo={style:{color:'#ccc','font-size':'13px','margin-top':'10px'}},Po={style:{'margin-top':'5px',display:'flex','flex-wrap':'wrap',gap:'8px'}},$o={style:{background:'#1e1e1e','border-radius':'16px','max-width':'850px',width:'100%','max-height':'90vh','overflow-y':'auto','box-shadow':'0 20px 60px rgba(0, 0, 0, 0.8)',border:'1px solid #333'}},Do={style:{padding:'24px 28px','border-bottom':'1px solid #2a2a2a',display:'flex','justify-content':'space-between','align-items':'center'}},jo={style:{padding:'28px'}},Ro={style:{display:'grid','grid-template-columns':'repeat(auto-fit, minmax(240px, 1fr))',gap:'20px'}},Oo=(0,i.defineComponent)({__name:'ProjectManager',setup(e){const n=(0,i.ref)([]),t=(0,i.ref)(''),a=(0,i.ref)(''),o=(0,i.ref)(''),r=(0,i.ref)(''),s=(0,i.ref)(!1),c=(0,i.ref)(''),p=(0,i.ref)(!1),g=(0,i.ref)(!1),u=(0,i.ref)(''),m=(0,i.ref)(!1),f=(0,i.ref)([]),x=(0,i.ref)('after'),h=(0,i.ref)(!1),y=(0,i.ref)({}),v=['æ·»åŠ å“åº”å¼å¸ƒå±€ï¼Œæ”¯æŒç§»åŠ¨ç«¯å’Œæ¡Œé¢ç«¯','æ·»åŠ æ·±è‰²/æµ…è‰²ä¸»é¢˜åˆ‡æ¢åŠŸèƒ½','ä¼˜åŒ–ä»£ç ç»“æ„ï¼Œæå–å¯å¤ç”¨ç»„ä»¶','æ·»åŠ åŠ è½½åŠ¨ç”»å’Œéª¨æ¶å±','æ·»åŠ è¡¨å•éªŒè¯å’Œé”™è¯¯æç¤º','ä¼˜åŒ–æ€§èƒ½ï¼Œå‡å°‘ä¸å¿…è¦çš„æ¸²æŸ“','æ·»åŠ é”®ç›˜å¿«æ·é”®æ”¯æŒ','æ”¹è¿›æ— éšœç¢è®¿é—®ï¼ˆARIAï¼‰'],w=(0,i.ref)(!1),k=(0,i.ref)(null),A=(0,i.ref)(!1),C=(0,i.ref)(!1),E=(0,i.ref)(''),T=(0,i.ref)(''),S=(0,i.ref)(''),N=(0,i.ref)(null),I=(0,i.computed)(()=>n.value.find(e=>e.id===t.value)),V=(0,i.computed)(()=>y.value[t.value]||[]),B=(0,i.computed)(()=>{if(0===f.value.length)return'';const e=I.value;if(!e)return'';return G(e.files.map(e=>{const n=f.value.find(n=>n.path===e.path);return{...e,content:n?'after'===x.value?n.newContent:n.oldContent:e.content}}))}),M={åŒå±‚å¯¹è¯ç•Œé¢:{name:'åŒå±‚å¯¹è¯ç•Œé¢',description:'æµå¼å¯¹è¯ã€æ¶ˆæ¯å†å²ã€æ­£åˆ™æ¸…ç†',icon:'ğŸ’¬',color:'#4a9eff',files:{'index.html':'<!DOCTYPE html>\n<html lang="zh-CN">\n<head>\n  <meta charset="UTF-8">\n  <meta name="viewport" content="width=device-width, initial-scale=1.0">\n  <title>åŒå±‚å¯¹è¯ç•Œé¢</title>\n  <link rel="stylesheet" href="style.css">\n</head>\n<body>\n  <div id="app">\n    <div class="chat-container">\n      <div class="message-list" id="messageList"></div>\n      <div class="input-area">\n        <textarea id="userInput" placeholder="è¾“å…¥æ¶ˆæ¯..."></textarea>\n        <button id="sendBtn">å‘é€</button>\n      </div>\n    </div>\n  </div>\n  <script src="https://cdn.jsdelivr.net/npm/vue@3/dist/vue.global.prod.js"><\/script>\n  <script src="script.js"><\/script>\n</body>\n</html>','style.css':'* {\n  margin: 0;\n  padding: 0;\n  box-sizing: border-box;\n}\n\nbody {\n  font-family: \'Segoe UI\', sans-serif;\n  background: #1a1a1a;\n  color: #e0e0e0;\n}\n\n.chat-container {\n  max-width: 800px;\n  margin: 20px auto;\n  height: calc(100vh - 40px);\n  display: flex;\n  flex-direction: column;\n  background: #2a2a2a;\n  border-radius: 12px;\n  overflow: hidden;\n}\n\n.message-list {\n  flex: 1;\n  padding: 20px;\n  overflow-y: auto;\n}\n\n.message {\n  margin-bottom: 15px;\n  padding: 10px 15px;\n  border-radius: 8px;\n  max-width: 70%;\n}\n\n.message.user {\n  background: #4a9eff;\n  margin-left: auto;\n  text-align: right;\n}\n\n.message.assistant {\n  background: #3a3a3a;\n}\n\n.input-area {\n  padding: 15px;\n  background: #2a2a2a;\n  border-top: 1px solid #3a3a3a;\n  display: flex;\n  gap: 10px;\n}\n\n#userInput {\n  flex: 1;\n  padding: 10px;\n  background: #1a1a1a;\n  border: 1px solid #3a3a3a;\n  border-radius: 6px;\n  color: #e0e0e0;\n  resize: none;\n  height: 60px;\n}\n\n#sendBtn {\n  padding: 10px 20px;\n  background: #4a9eff;\n  border: none;\n  border-radius: 6px;\n  color: white;\n  cursor: pointer;\n  font-weight: 600;\n}\n\n#sendBtn:hover {\n  background: #357abd;\n}','script.js':'// èŠå¤©å†å²\nlet chatHistory = [];\n\n// ä»é…’é¦†å˜é‡åŠ è½½å†å²\nfunction loadHistory() {\n  const saved = getVariables({ type: \'chat\' });\n  chatHistory = saved.chatHistory || [];\n  renderMessages();\n}\n\n// ä¿å­˜åˆ°é…’é¦†å˜é‡\nfunction saveHistory() {\n  insertOrAssignVariables({ chatHistory }, { type: \'chat\' });\n}\n\n// æ¸²æŸ“æ¶ˆæ¯\nfunction renderMessages() {\n  const list = document.getElementById(\'messageList\');\n  list.innerHTML = \'\';\n  chatHistory.forEach(msg => {\n    const div = document.createElement(\'div\');\n    div.className = \'message \' + msg.sender;\n    div.textContent = msg.content;\n    list.appendChild(div);\n  });\n  list.scrollTop = list.scrollHeight;\n}\n\n// å‘é€æ¶ˆæ¯\nasync function sendMessage() {\n  const input = document.getElementById(\'userInput\');\n  const text = input.value.trim();\n  if (!text) return;\n\n  // æ·»åŠ ç”¨æˆ·æ¶ˆæ¯\n  chatHistory.push({\n    id: Date.now(),\n    sender: \'user\',\n    content: text,\n    timestamp: new Date().toLocaleTimeString()\n  });\n  input.value = \'\';\n  renderMessages();\n  saveHistory();\n\n  // è°ƒç”¨ AIï¼ˆæµå¼ï¼‰\n  const prompt = \'ã€å¯¹è¯å†å²ã€‘\\n\' + chatHistory.map(m => m.sender + \': \' + m.content).join(\'\\n\');\n\n  let aiText = \'\';\n  await generate({\n    should_stream: true,\n    prompt: prompt,\n    on_stream_chunk: (chunk) => {\n      aiText += chunk;\n      // å®æ—¶æ˜¾ç¤º\n      const tempMsg = { id: \'temp\', sender: \'assistant\', content: aiText };\n      const tempIndex = chatHistory.findIndex(m => m.id === \'temp\');\n      if (tempIndex >= 0) {\n        chatHistory[tempIndex] = tempMsg;\n      } else {\n        chatHistory.push(tempMsg);\n      }\n      renderMessages();\n    },\n    on_stream_end: () => {\n      // å®Œæˆï¼Œæ›¿æ¢ä¸ºæ­£å¼æ¶ˆæ¯\n      const tempIndex = chatHistory.findIndex(m => m.id === \'temp\');\n      if (tempIndex >= 0) {\n        chatHistory[tempIndex] = {\n          id: Date.now(),\n          sender: \'assistant\',\n          content: aiText,\n          timestamp: new Date().toLocaleTimeString()\n        };\n      }\n      renderMessages();\n      saveHistory();\n    }\n  });\n}\n\n// åˆå§‹åŒ–\n$(() => {\n  loadHistory();\n  document.getElementById(\'sendBtn\').addEventListener(\'click\', sendMessage);\n  document.getElementById(\'userInput\').addEventListener(\'keydown\', (e) => {\n    if (e.key === \'Enter\' && !e.shiftKey) {\n      e.preventDefault();\n      sendMessage();\n    }\n  });\n});'}},çŠ¶æ€æ é¢æ¿:{name:'çŠ¶æ€æ é¢æ¿',description:'HP/MP/ç»éªŒå€¼ï¼Œè¿›åº¦æ¡åŠ¨ç”»',icon:'ğŸ“Š',color:'#10b981',files:{'index.html':'<!DOCTYPE html>\n<html lang="zh-CN">\n<head>\n  <meta charset="UTF-8">\n  <meta name="viewport" content="width=device-width, initial-scale=1.0">\n  <title>çŠ¶æ€æ </title>\n  <link rel="stylesheet" href="style.css">\n</head>\n<body>\n  <div id="app">\n    <div class="status-panel">\n      <h2>è§’è‰²çŠ¶æ€</h2>\n      <div class="stat-item">\n        <label>ç”Ÿå‘½å€¼ (HP)</label>\n        <div class="progress-bar">\n          <div class="progress-fill hp" id="hpBar"></div>\n        </div>\n        <span id="hpText">0/0</span>\n      </div>\n      <div class="stat-item">\n        <label>é­”æ³•å€¼ (MP)</label>\n        <div class="progress-bar">\n          <div class="progress-fill mp" id="mpBar"></div>\n        </div>\n        <span id="mpText">0/0</span>\n      </div>\n      <div class="stat-item">\n        <label>ç»éªŒå€¼ (EXP)</label>\n        <div class="progress-bar">\n          <div class="progress-fill exp" id="expBar"></div>\n        </div>\n        <span id="expText">0/0</span>\n      </div>\n    </div>\n  </div>\n  <script src="script.js"><\/script>\n</body>\n</html>','style.css':'* {\n  margin: 0;\n  padding: 0;\n  box-sizing: border-box;\n}\n\nbody {\n  font-family: \'Segoe UI\', sans-serif;\n  background: #1a1a1a;\n  color: #e0e0e0;\n  padding: 20px;\n}\n\n.status-panel {\n  max-width: 500px;\n  margin: 0 auto;\n  background: #2a2a2a;\n  border-radius: 12px;\n  padding: 25px;\n  border: 1px solid #3a3a3a;\n}\n\nh2 {\n  margin-bottom: 20px;\n  color: #4a9eff;\n}\n\n.stat-item {\n  margin-bottom: 20px;\n}\n\n.stat-item label {\n  display: block;\n  margin-bottom: 8px;\n  font-weight: 600;\n  font-size: 14px;\n}\n\n.progress-bar {\n  width: 100%;\n  height: 24px;\n  background: #1a1a1a;\n  border-radius: 12px;\n  overflow: hidden;\n  margin-bottom: 5px;\n}\n\n.progress-fill {\n  height: 100%;\n  transition: width 0.5s ease;\n  border-radius: 12px;\n}\n\n.progress-fill.hp {\n  background: linear-gradient(90deg, #ef4444, #10b981);\n}\n\n.progress-fill.mp {\n  background: linear-gradient(90deg, #3b82f6, #06b6d4);\n}\n\n.progress-fill.exp {\n  background: linear-gradient(90deg, #fbbf24, #f59e0b);\n}\n\n.stat-item span {\n  font-size: 13px;\n  color: #94a3b8;\n}','script.js':'// ä»é…’é¦†å˜é‡åŠ è½½æ•°æ®\nfunction loadStats() {\n  const data = getVariables({ type: \'chat\' });\n\n  const hp = data.hp || 850;\n  const maxHp = data.maxHp || 1000;\n  const mp = data.mp || 340;\n  const maxMp = data.maxMp || 500;\n  const exp = data.exp || 1250;\n  const maxExp = data.maxExp || 2000;\n\n  // æ›´æ–°è¿›åº¦æ¡\n  updateBar(\'hp\', hp, maxHp);\n  updateBar(\'mp\', mp, maxMp);\n  updateBar(\'exp\', exp, maxExp);\n}\n\nfunction updateBar(type, current, max) {\n  const percent = (current / max) * 100;\n  document.getElementById(type + \'Bar\').style.width = percent + \'%\';\n  document.getElementById(type + \'Text\').textContent = current + \'/\' + max;\n}\n\n// åˆå§‹åŒ–\ndocument.addEventListener(\'DOMContentLoaded\', loadStats);'}},å¥½æ„Ÿåº¦é¢æ¿:{name:'å¥½æ„Ÿåº¦é¢æ¿',description:'å¤šè§’è‰²å¡ç‰‡ï¼Œçˆ±å¿ƒå›¾æ ‡ï¼Œå¥½æ„Ÿåº¦å±•ç¤º',icon:'ğŸ’',color:'#ec4899',files:{'index.html':'<!DOCTYPE html>\n<html lang="zh-CN">\n<head>\n  <meta charset="UTF-8">\n  <meta name="viewport" content="width=device-width, initial-scale=1.0">\n  <title>å¥½æ„Ÿåº¦é¢æ¿</title>\n  <link rel="stylesheet" href="style.css">\n</head>\n<body>\n  <div id="app">\n    <div class="affection-container">\n      <h2>è§’è‰²å¥½æ„Ÿåº¦</h2>\n      <div class="character-grid" id="characterGrid"></div>\n    </div>\n  </div>\n  <script src="script.js"><\/script>\n</body>\n</html>','style.css':'* {\n  margin: 0;\n  padding: 0;\n  box-sizing: border-box;\n}\n\nbody {\n  font-family: \'Segoe UI\', sans-serif;\n  background: #1a1a1a;\n  color: #e0e0e0;\n  padding: 20px;\n}\n\n.affection-container {\n  max-width: 900px;\n  margin: 0 auto;\n}\n\nh2 {\n  margin-bottom: 25px;\n  color: #ec4899;\n  text-align: center;\n}\n\n.character-grid {\n  display: grid;\n  grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));\n  gap: 20px;\n}\n\n.character-card {\n  background: #2a2a2a;\n  border-radius: 12px;\n  padding: 20px;\n  border: 2px solid #3a3a3a;\n  transition: all 0.3s ease;\n}\n\n.character-card:hover {\n  transform: translateY(-5px);\n  border-color: #ec4899;\n  box-shadow: 0 10px 25px rgba(236, 72, 153, 0.3);\n}\n\n.character-name {\n  font-size: 18px;\n  font-weight: 600;\n  margin-bottom: 15px;\n  color: #e0e0e0;\n}\n\n.affection-bar {\n  width: 100%;\n  height: 20px;\n  background: #1a1a1a;\n  border-radius: 10px;\n  overflow: hidden;\n  margin-bottom: 8px;\n}\n\n.affection-fill {\n  height: 100%;\n  background: linear-gradient(90deg, #ec4899, #f472b6);\n  transition: width 0.5s ease;\n  border-radius: 10px;\n}\n\n.affection-text {\n  font-size: 13px;\n  color: #94a3b8;\n}','script.js':'// ä»é…’é¦†å˜é‡åŠ è½½è§’è‰²æ•°æ®\nfunction loadCharacters() {\n  const data = getVariables({ type: \'chat\' });\n  const characters = data.characters || [\n    { name: \'è§’è‰² A\', affection: 75 },\n    { name: \'è§’è‰² B\', affection: 50 },\n    { name: \'è§’è‰² C\', affection: 90 }\n  ];\n\n  const grid = document.getElementById(\'characterGrid\');\n  grid.innerHTML = \'\';\n\n  characters.forEach(char => {\n    const card = document.createElement(\'div\');\n    card.className = \'character-card\';\n    card.innerHTML = `\n      <div class="character-name">${char.name}</div>\n      <div class="affection-bar">\n        <div class="affection-fill" style="width: ${char.affection}%"></div>\n      </div>\n      <div class="affection-text">å¥½æ„Ÿåº¦: ${char.affection}/100</div>\n    `;\n    grid.appendChild(card);\n  });\n}\n\n// åˆå§‹åŒ–\ndocument.addEventListener(\'DOMContentLoaded\', loadCharacters);'}}};function P(){A.value=!0}function D(e){const r=M[e];if(!r)return;const s=prompt('é¡¹ç›®åç§°:',r.name);if(!s||!s.trim())return;const i={id:Date.now().toString(),name:s.trim(),files:Object.entries(r.files).map(([e,n])=>({path:e,name:e,content:n}))};n.value.push(i),t.value=i.id,a.value=i.files[0]?.name||'',o.value=i.files[0]?.content||'',J(),A.value=!1,window.toastr.success('âœ… é¡¹ç›®"'+s.trim()+'"åˆ›å»ºæˆåŠŸï¼')}function j(){N.value&&(N.value.value='',N.value.click())}async function R(e){const r=e.target.files;if(r&&0!==r.length)try{const e=r[0],s=e.webkitRelativePath.split('/')[0]||'å¯¼å…¥çš„é¡¹ç›®',i=prompt('é¡¹ç›®åç§°:',s);if(!i||!i.trim())return;const l=['.html','.css','.js','.ts','.scss','.sass','.json','.txt','.md'],d=[],c=[];for(let e=0;e<r.length;e++){const n=r[e],t=n.webkitRelativePath.split('/').slice(1).join('/');if(!t||t.startsWith('.')||t.includes('/.'))continue;if(t.includes('node_modules/')||t.includes('dist/')||t.includes('.git/')||t.includes('build/'))continue;const a='.'+t.split('.').pop()?.toLowerCase();if(!l.includes(a))continue;const o=new Promise((e,a)=>{const o=new FileReader;o.onload=n=>{const a=n.target?.result,o=t.split('/').pop()||t;d.push({path:t,name:o,content:a||''}),e()},o.onerror=()=>a(new Error(`è¯»å–æ–‡ä»¶å¤±è´¥: ${t}`)),o.readAsText(n)});c.push(o)}if(await Promise.all(c),0===d.length)return void window.toastr.warning('æœªæ‰¾åˆ°å¯å¯¼å…¥çš„æ–‡ä»¶ï¼ˆæ”¯æŒçš„æ ¼å¼ï¼šHTMLã€CSSã€JSã€TSã€SCSS ç­‰ï¼‰');const p={id:Date.now().toString(),name:i.trim(),files:d};n.value.push(p),t.value=p.id,a.value=p.files[0]?.path||'',o.value=p.files[0]?.content||'',J(),Y(),window.toastr.success(`æˆåŠŸå¯¼å…¥é¡¹ç›®"${i}"ï¼Œå…± ${d.length} ä¸ªæ–‡ä»¶`)}catch(e){console.error('å¯¼å…¥æ–‡ä»¶å¤¹å¤±è´¥:',e),window.toastr.error('å¯¼å…¥æ–‡ä»¶å¤¹å¤±è´¥: '+e.message)}}function O(){const e=prompt('é¡¹ç›®åç§°:');if(!e||!e.trim())return;const r=`<!DOCTYPE html>\n<html lang="zh-CN">\n<head>\n  <meta charset="UTF-8">\n  <meta name="viewport" content="width=device-width, initial-scale=1.0">\n  <title>${e.trim()}</title>\n  <link rel="stylesheet" href="style.css">\n</head>\n<body>\n  <div class="container">\n    <h1>æ¬¢è¿æ¥åˆ° ${e.trim()}!</h1>\n    <p>å¼€å§‹ä½ çš„åˆ›ä½œä¹‹æ—…</p>\n  </div>\n  <script src="script.js"><\/script>\n</body>\n</html>`,s={id:Date.now().toString(),name:e.trim(),files:[{path:'index.html',name:'index.html',content:r},{path:'style.css',name:'style.css',content:'* {\n  margin: 0;\n  padding: 0;\n  box-sizing: border-box;\n}\n\nbody {\n  font-family: \'Segoe UI\', Tahoma, Geneva, Verdana, sans-serif;\n  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);\n  color: #333;\n  min-height: 100vh;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n}\n\n.container {\n  background: white;\n  padding: 60px 40px;\n  border-radius: 20px;\n  box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);\n  text-align: center;\n  max-width: 600px;\n}\n\nh1 {\n  font-size: 2.5em;\n  color: #667eea;\n  margin-bottom: 20px;\n}\n\np {\n  font-size: 1.2em;\n  color: #666;\n  line-height: 1.6;\n}'},{path:'script.js',name:'script.js',content:'console.log(\'é¡¹ç›®å·²å¯åŠ¨ï¼\');\n\n// ä½¿ç”¨ jQuery ç¡®ä¿ DOM åŠ è½½å®Œæˆ\n$(function() {\n  console.log(\'é¡µé¢åŠ è½½å®Œæˆ\');\n\n  // ========== æ£€æµ‹æ˜¯å¦åœ¨é…’é¦†ç¯å¢ƒä¸­ ==========\n  const isInTavern = typeof SillyTavern !== \'undefined\' && typeof getVariables !== \'undefined\';\n\n  if (!isInTavern) {\n    console.log(\'é¢„è§ˆæ¨¡å¼ï¼šå½“å‰åœ¨é¢„è§ˆçª—å£ä¸­ï¼Œé…’é¦† API ä¸å¯ç”¨\');\n    // é¢„è§ˆæ¨¡å¼ä¸‹çš„é€»è¾‘ï¼ˆä½¿ç”¨ localStorage æˆ–ä¸ä¿å­˜æ•°æ®ï¼‰\n  }\n\n  // ========== æ•°æ®æŒä¹…åŒ–ç¤ºä¾‹ï¼ˆä»…åœ¨é…’é¦†ç¯å¢ƒä¸­å¯ç”¨ï¼‰==========\n  const storageKey = \'my_project_data\'; // è‡ªå®šä¹‰å­˜å‚¨é”®å\n\n  // åŠ è½½æ•°æ®\n  function loadData() {\n    if (isInTavern) {\n      const data = getVariables({ type: \'chat\' });\n      return data[storageKey] || { count: 0 };\n    } else {\n      // é¢„è§ˆæ¨¡å¼ï¼šä½¿ç”¨ localStorage\n      const stored = localStorage.getItem(storageKey);\n      return stored ? JSON.parse(stored) : { count: 0 };\n    }\n  }\n\n  // ä¿å­˜æ•°æ®\n  function saveData(data) {\n    if (isInTavern) {\n      insertOrAssignVariables({ [storageKey]: data }, { type: \'chat\' });\n      console.log(\'æ•°æ®å·²ä¿å­˜åˆ°é…’é¦†å˜é‡:\', data);\n    } else {\n      // é¢„è§ˆæ¨¡å¼ï¼šä½¿ç”¨ localStorage\n      localStorage.setItem(storageKey, JSON.stringify(data));\n      console.log(\'æ•°æ®å·²ä¿å­˜åˆ° localStorageï¼ˆé¢„è§ˆæ¨¡å¼ï¼‰:\', data);\n    }\n  }\n\n  // åˆå§‹åŒ–\n  let myData = loadData();\n  console.log(\'åŠ è½½çš„æ•°æ®:\', myData);\n\n  // ========== ç¤ºä¾‹ï¼šç‚¹å‡»è®¡æ•°å™¨ ==========\n  const container = $(\'.container\');\n  if (container.length) {\n    container.on(\'click\', function() {\n      myData.count++;\n      saveData(myData);\n      if (typeof toastr !== \'undefined\') {\n        toastr.success(`ç‚¹å‡»æ¬¡æ•°: ${myData.count}`);\n      } else {\n        alert(`ç‚¹å‡»æ¬¡æ•°: ${myData.count}`);\n      }\n    });\n  }\n\n  // é¡µé¢å¸è½½æ—¶ä¿å­˜ï¼ˆå¯é€‰ï¼‰\n  $(window).on(\'pagehide\', function() {\n    saveData(myData);\n  });\n});'}]};n.value.push(s),console.log('æ–°å»ºé¡¹ç›®:',s.name,'é¡¹ç›®æ€»æ•°:',n.value.length),J(),t.value=s.id,a.value='index.html',o.value=r,Y(),toastr.success(`é¡¹ç›® "${s.name}" å·²åˆ›å»ºå¹¶ä¿å­˜`)}function F(){const e=I.value;if(!e||!a.value)return void toastr.error('è¯·å…ˆé€‰æ‹©ä¸€ä¸ªæ–‡ä»¶');const n=e.files.find(e=>e.path===a.value);n&&(n.content=o.value,q&&(clearTimeout(q),q=null),J(),Y(),toastr.success('å·²ä¿å­˜'))}function L(){const e=I.value;if(!e)return;const n=prompt('è¯·è¾“å…¥æ–‡ä»¶å¤¹è·¯å¾„ï¼š\nä¾‹å¦‚ï¼šcss æˆ– js/utils','');if(!n||!n.trim())return;const t=n.trim().replace(/\/$/,''),a=`${t}/.gitkeep`;if(e.files.some(e=>e.path.startsWith(`${t}/`)))return void window.toastr.warning(`æ–‡ä»¶å¤¹ "${t}" å·²å­˜åœ¨ï¼ˆåŒ…å«æ–‡ä»¶ï¼‰`);const o={path:a,name:'.gitkeep',content:'# æ­¤æ–‡ä»¶ç”¨äºä¿æŒæ–‡ä»¶å¤¹ç»“æ„\n'};e.files.push(o),J(),window.toastr.success(`æ–‡ä»¶å¤¹ "${t}" å·²åˆ›å»º`)}function H(){const e=I.value;if(!e)return;const n=new Set;n.add(''),e.files.forEach(e=>{const t=e.path.split('/');if(t.length>1)for(let e=1;e<t.length;e++){const a=t.slice(0,e).join('/');a&&n.add(a)}});const t=Array.from(n).sort(),r=[{name:'HTML æ–‡ä»¶',ext:'.html',icon:'ğŸŒ'},{name:'CSS æ–‡ä»¶',ext:'.css',icon:'ğŸ¨'},{name:'JavaScript æ–‡ä»¶',ext:'.js',icon:'âš¡'},{name:'TypeScript æ–‡ä»¶',ext:'.ts',icon:'ğŸ“˜'},{name:'JSON æ–‡ä»¶',ext:'.json',icon:'ğŸ“„'},{name:'Markdown æ–‡ä»¶',ext:'.md',icon:'ğŸ“'},{name:'å…¶ä»–æ–‡ä»¶',ext:'',icon:'ğŸ“‹'}],s=r.map((e,n)=>`${n+1}. ${e.icon} ${e.name} (${e.ext||'è‡ªå®šä¹‰'})`).join('\n'),i=prompt(`è¯·é€‰æ‹©æ–‡ä»¶ç±»å‹ï¼ˆè¾“å…¥åºå· 1-${r.length}ï¼‰ï¼š\n\n${s}`,'1');if(!i)return;const l=parseInt(i)-1;if(l<0||l>=r.length)return void window.toastr.error('æ— æ•ˆçš„é€‰é¡¹');const d=r[l];let c='';if(t.length>1){const e=t.length>5?'è¾“å…¥æ–‡ä»¶å¤¹è·¯å¾„ï¼ˆç•™ç©ºä¸ºæ ¹ç›®å½•ï¼‰ï¼š':`è¯·é€‰æ‹©ç›®æ ‡æ–‡ä»¶å¤¹ï¼ˆè¾“å…¥åºå·ï¼‰ï¼š\n\n${t.map((e,n)=>`${n+1}. ${e||'æ ¹ç›®å½•'}`).join('\n')}\n\næˆ–ç›´æ¥è¾“å…¥æ–‡ä»¶å¤¹è·¯å¾„ï¼š`,n=prompt(e,'1');if(!n)return;const a=parseInt(n)-1;c=a>=0&&a<t.length?t[a]:n.trim().replace(/\/$/,'')}const p=prompt(`è¯·è¾“å…¥æ–‡ä»¶å${d.ext?`ï¼ˆå°†è‡ªåŠ¨æ·»åŠ  ${d.ext}ï¼‰`:'ï¼ˆéœ€åŒ…å«æ‰©å±•åï¼‰'}ï¼š`,d.ext?'new-file':'newfile.txt');if(!p||!p.trim())return;let g=p.trim();d.ext&&!g.endsWith(d.ext)&&(g+=d.ext);const u=c?`${c}/${g}`:g;if(e.files.some(e=>e.path===u))return void window.toastr.error(`æ–‡ä»¶ "${u}" å·²å­˜åœ¨ï¼`);const m=g.split('.').pop()?.toLowerCase();let f='';switch(m){case'html':f='<!DOCTYPE html>\n<html lang="zh-CN">\n<head>\n  <meta charset="UTF-8">\n  <meta name="viewport" content="width=device-width, initial-scale=1.0">\n  <title>'+g.replace('.html','')+'</title>\n  <link rel="stylesheet" href="style.css">\n</head>\n<body>\n  <div class="container">\n    <h1>æ¬¢è¿</h1>\n  </div>\n  <script src="script.js"><\/script>\n</body>\n</html>';break;case'css':case'scss':case'sass':f=`/* ${g} */\n\n* {\n  margin: 0;\n  padding: 0;\n  box-sizing: border-box;\n}\n`;break;case'js':case'ts':f=`// ${g}\n\nconsole.log('${g} å·²åŠ è½½');\n\n$(function() {\n  // åœ¨è¿™é‡Œç¼–å†™ä»£ç \n});\n`;break;case'json':f=`{\n  "name": "${g.replace('.json','')}",\n  "version": "1.0.0"\n}`;break;case'md':f=`# ${g.replace(/\.md$/,'')}\n\n`;break;default:f=''}const x={path:u,name:g,content:f};e.files.push(x),a.value=u,o.value=f,J(),Y(),window.toastr.success(`æ–‡ä»¶ "${u}" å·²åˆ›å»º`)}function U(e){const n=e.split('.').pop()?.toLowerCase();return'html'===n?'fa-brands fa-html5':'css'===n?'fa-brands fa-css3-alt':'js'===n?'fa-brands fa-js':'fa-solid fa-file-code'}function G(e){const n=e.find(e=>e.path.endsWith('.html')),t=e.find(e=>e.path.endsWith('.css')),a=e.find(e=>e.path.endsWith('.js'));if(!n)return'';const o=n.content,r='head',s='body',i=o.match(new RegExp(`<${r}[^>]*>([\\s\\S]*?)</${r}>`,'i')),l=o.match(new RegExp(`<${s}[^>]*>([\\s\\S]*?)</${s}>`,'i'));let d=i?i[1]:'',c=l?l[1]:o;const p=new RegExp('<script[^>]*><\/script>','gi');d=d.replace(/<link[^>]*rel=["']stylesheet["'][^>]*>/gi,''),c=c.replace(p,'');const g='script',u='style';return`<!DOCTYPE html>\n<html>\n<head>\n  <meta charset="UTF-8">\n  <meta name="viewport" content="width=device-width, initial-scale=1.0">\n  ${d}\n  <${u}>\n    html, body {\n      margin: 0 !important;\n      padding: 0 !important;\n      width: 100% !important;\n      height: auto !important;\n      min-height: 800px !important;\n      overflow: visible !important;\n    }\n    ${t?.content||''}\n  </${u}>\n  <${g} src="https://code.jquery.com/jquery-3.7.1.min.js"></${g}>\n  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/toastr.min.css">\n  <${g} src="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/toastr.min.js"></${g}>\n  <${g} src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.5/gsap.min.js"></${g}>\n  <${g} src="https://cdnjs.cloudflare.com/ajax/libs/lodash.js/4.17.21/lodash.min.js"></${g}>\n</head>\n<body>\n  ${c}\n  <${g}>${a?.content||''}</${g}>\n</body>\n</html>`}function Y(){const e=I.value;r.value=e?G(e.files):''}function J(){try{const e=SillyTavern.getCurrentChatId();console.log('ä¿å­˜æ•°æ®åˆ°èŠå¤©å˜é‡ï¼ŒèŠå¤© ID:',e);const t={frontend_projects_files:n.value,frontend_ai_history:y.value};if(e){console.log('å‡†å¤‡ä¿å­˜åˆ°èŠå¤©å˜é‡:',t.frontend_projects_files.length,'ä¸ªé¡¹ç›®'),insertOrAssignVariables(t,{type:'chat'}),console.log('ä¿å­˜æˆåŠŸï¼');const e=getVariables({type:'chat'});e?.frontend_projects_files?console.log('éªŒè¯ï¼šæ•°æ®å·²æˆåŠŸä¿å­˜ï¼Œå…±',e.frontend_projects_files.length,'ä¸ªé¡¹ç›®'):console.error('éªŒè¯å¤±è´¥ï¼šä¿å­˜åæ— æ³•è¯»å–æ•°æ®')}else console.log('æœªæ‰¾åˆ°èŠå¤© IDï¼Œä¿å­˜åˆ°å…¨å±€å˜é‡:',t.frontend_projects_files.length,'ä¸ªé¡¹ç›®'),insertOrAssignVariables(t,{type:'global'}),console.log('å·²ä¿å­˜åˆ°å…¨å±€å˜é‡'),toastr.info('é¡¹ç›®å·²ä¿å­˜åˆ°å…¨å±€å˜é‡ï¼ˆæ‰“å¼€èŠå¤©åå¯ä¿å­˜åˆ°èŠå¤©å˜é‡ï¼‰')}catch(e){console.error('ä¿å­˜å¤±è´¥:',e)}}function W(){try{const e=SillyTavern.getCurrentChatId();let t;console.log('æ­£åœ¨åŠ è½½æ•°æ®ï¼ŒèŠå¤© ID:',e),e?(t=getVariables({type:'chat'}),console.log('ä»èŠå¤©å˜é‡è¯»å–åˆ°çš„æ•°æ®:',t)):(t=getVariables({type:'global'}),console.log('æœªæ‰¾åˆ°èŠå¤© IDï¼Œä»å…¨å±€å˜é‡è¯»å–æ•°æ®:',t)),t?.frontend_projects_files&&Array.isArray(t.frontend_projects_files)?(n.value=t.frontend_projects_files,console.log('æˆåŠŸåŠ è½½é¡¹ç›®:',n.value.length,'ä¸ª')):(console.log('æ²¡æœ‰æ‰¾åˆ°å·²ä¿å­˜çš„é¡¹ç›®æ•°æ®'),n.value=[]),t?.frontend_ai_history?(y.value=t.frontend_ai_history,console.log('æˆåŠŸåŠ è½½å†å²è®°å½•')):y.value={}}catch(e){console.error('åŠ è½½å¤±è´¥:',e)}}W(),(0,i.watch)(()=>SillyTavern.getCurrentChatId(),()=>{W(),t.value='',a.value='',o.value='',r.value=''});let q=null;(0,i.watchEffect)(()=>{if(a.value&&void 0!==o.value){const e=I.value;if(e){const n=e.files.find(e=>e.path===a.value);n&&n.content!==o.value&&(n.content=o.value,q&&clearTimeout(q),q=setTimeout(()=>{J(),console.log('è‡ªåŠ¨ä¿å­˜:',a.value)},1e3))}}});let K=null;function X(){s.value=!0,c.value=''}function Q(){s.value=!1,c.value=''}function Z(){C.value=!0,E.value='',T.value='',S.value=''}function ee(){C.value=!1,E.value='',T.value='',S.value=''}async function ne(){const e=I.value;if(!e)return void window.toastr.error('è¯·å…ˆé€‰æ‹©é¡¹ç›®');if(!E.value.trim())return void window.toastr.error('è¯·æè¿°é—®é¢˜');p.value=!0,w.value=!0;let n='';try{k.value?.setProgress(5),k.value?.setMessage('æ­£åœ¨å‡†å¤‡ Bug ä¿®å¤è¯·æ±‚...'),await new Promise(e=>setTimeout(e,100));const t=(0,d.Ut)();if(!t)throw new Error('æ— æ³•è·å–è„šæœ¬ ID');const a=getVariables({type:'script',script_id:t}),o=a?.api_endpoint,r=a?.api_key,s=a?.model||'gpt-4o-mini';if(!o||!r)throw new Error('è¯·å…ˆåœ¨"è®¾ç½®"æ ‡ç­¾ä¸­é…ç½® API');n=(0,l.normalizeApiEndpoint)(o),k.value?.setProgress(15),k.value?.setMessage('æ­£åœ¨æ„å»º Bug ä¿®å¤æç¤ºè¯...'),await new Promise(e=>setTimeout(e,100));const i='ä½ æ˜¯ä¸“ä¸šçš„å‰ç«¯ Bug ä¿®å¤ä¸“å®¶ã€‚\n\n# ä¿®å¤è¦æ±‚\n\n1. **ä¸“æ³¨æ€§**ï¼šåªä¿®å¤ç”¨æˆ·æè¿°çš„å…·ä½“é—®é¢˜ï¼Œä¸è¦æ”¹åŠ¨å…¶ä»–åŠŸèƒ½\n2. **æœ€å°åŒ–æ”¹åŠ¨**ï¼šåªä¿®æ”¹å¿…è¦çš„ä»£ç ï¼Œä¿æŒå…¶ä»–éƒ¨åˆ†ä¸å˜\n3. **ç²¾å‡†å®šä½**ï¼šä¼˜å…ˆæ ¹æ® Console é”™è¯¯ä¿¡æ¯å®šä½é—®é¢˜\n4. **ä¿æŒé£æ ¼**ï¼šä¿®å¤åçš„ä»£ç è¦ä¿æŒåŸæœ‰çš„å‘½åã€æ ¼å¼ã€ç¼©è¿›é£æ ¼\n\n# å¸¸è§ Bug ç±»å‹å’Œä¿®å¤ç­–ç•¥\n\n**ç‚¹å‡»æ— å“åº”ï¼š**\n- æ£€æŸ¥äº‹ä»¶ç»‘å®šæ˜¯å¦æ­£ç¡®ï¼ˆID æ˜¯å¦åŒ¹é…ï¼‰\n- æ£€æŸ¥å‡½æ•°æ˜¯å¦åœ¨ `$(function() {})` å†…æ­£ç¡®å®šä¹‰\n- æ£€æŸ¥æ˜¯å¦æœ‰ JavaScript é”™è¯¯é˜»æ­¢äº†æ‰§è¡Œ\n\n**æ˜¾ç¤ºå¼‚å¸¸ï¼š**\n- æ£€æŸ¥ CSS æ ·å¼ï¼ˆdisplayã€visibilityã€z-indexï¼‰\n- æ£€æŸ¥ DOM ç»“æ„æ˜¯å¦æ­£ç¡®\n- æ£€æŸ¥æ•°æ®ç»‘å®šæ˜¯å¦æ­£å¸¸\n\n**æ•°æ®ä¿å­˜å¤±è´¥ï¼š**\n- æ£€æŸ¥ insertOrAssignVariables è°ƒç”¨\n- æ£€æŸ¥æ•°æ®æ ¼å¼æ˜¯å¦æ­£ç¡®\n- æ£€æŸ¥å˜é‡ä½œç”¨åŸŸ\n\n**é€»è¾‘é”™è¯¯ï¼š**\n- æ£€æŸ¥æ¡ä»¶åˆ¤æ–­\n- æ£€æŸ¥å¼‚æ­¥å¤„ç†\n- æ£€æŸ¥å˜é‡ä½œç”¨åŸŸ\n\n# è¾“å‡ºæ ¼å¼\n\nåªè¾“å‡ºéœ€è¦ä¿®æ”¹çš„æ–‡ä»¶ï¼Œä½¿ç”¨ä»¥ä¸‹æ ¼å¼ï¼š\n\n```\nFILE_START: æ–‡ä»¶å\n[ä¿®æ”¹åçš„å®Œæ•´æ–‡ä»¶å†…å®¹ï¼Œå¹¶åœ¨å…³é”®ä¿®å¤ä½ç½®æ·»åŠ æ³¨é‡Š]\nFILE_END\n```\n\nä¸è¦è¾“å‡ºä»»ä½•å…¶ä»–æ–‡å­—æˆ–è§£é‡Šï¼',c=`# å½“å‰é¡¹ç›®æ–‡ä»¶ï¼š\n${e.files.map(e=>`=== ${e.path} ===\n${e.content}`).join('\n\n')}\n\n# Bug æè¿°ï¼š\n${E.value}\n\n${T.value.trim()?`# Console é”™è¯¯ä¿¡æ¯ï¼š\n\`\`\`\n${T.value}\n\`\`\`\n`:''}\n\n${S.value?`# é—®é¢˜å¯èƒ½åœ¨æ–‡ä»¶ï¼š\n${S.value}\n`:''}\n\n# ä¿®å¤è¦æ±‚ï¼š\n1. ä¸“æ³¨ä¿®å¤ä¸Šè¿° bugï¼Œä¸è¦æ”¹å…¶ä»–åœ°æ–¹\n2. åªè¾“å‡ºéœ€è¦ä¿®æ”¹çš„æ–‡ä»¶\n3. åœ¨ä¿®å¤çš„å…³é”®ä½ç½®æ·»åŠ æ³¨é‡Šè¯´æ˜ä¿®å¤å†…å®¹\n4. ä¿æŒä»£ç é£æ ¼ä¸€è‡´\n\nè¯·ä¸¥æ ¼æŒ‰ system ä¸­çš„æ ¼å¼è¾“å‡ºï¼Œä¸è¦æ·»åŠ è§£é‡Šï¼`;k.value?.setProgress(25),k.value?.setMessage('æ­£åœ¨å‘é€è¯·æ±‚åˆ° AI æœåŠ¡å™¨...'),await new Promise(e=>setTimeout(e,100)),k.value?.setProgress(30),k.value?.setMessage('ç­‰å¾… AI åˆ†æ bug...'),await new Promise(e=>setTimeout(e,100));const p=await fetch(n,{method:'POST',headers:{'Content-Type':'application/json',Authorization:`Bearer ${r}`},body:JSON.stringify({model:s,messages:[{role:'system',content:i},{role:'user',content:c}],temperature:.3})});if(!p.ok){const e=await p.text();throw new Error(`API è¯·æ±‚å¤±è´¥ (${p.status}): ${e}`)}k.value?.setProgress(60),k.value?.setMessage('æ­£åœ¨æ¥æ”¶ AI ä¿®å¤æ–¹æ¡ˆ...'),await new Promise(e=>setTimeout(e,100));const g=await p.json(),u=g.choices?.[0]?.message?.content||'';if(!u)throw new Error('AI æœªè¿”å›ä¿®å¤æ–¹æ¡ˆ');k.value?.setProgress(75),k.value?.setMessage('æ­£åœ¨è§£æä¿®å¤æ–¹æ¡ˆ...'),await new Promise(e=>setTimeout(e,100));const h=/FILE_START:\s*(.+?)\s*\n([\s\S]*?)\nFILE_END/g,v=[];let A;for(;null!==(A=h.exec(u));){const n=A[1].trim(),t=A[2].trim(),a=e.files.find(e=>e.path===n);a&&v.push({path:n,oldContent:a.content,newContent:t})}if(0===v.length)throw new Error('AI æœªè¿”å›æœ‰æ•ˆçš„ä¿®å¤æ–¹æ¡ˆ');k.value?.setProgress(85),k.value?.setMessage('æ­£åœ¨å‡†å¤‡å¯¹æ¯”é¢„è§ˆ...'),await new Promise(e=>setTimeout(e,100)),y.value[e.id]||(y.value[e.id]=[]),y.value[e.id].unshift({timestamp:(new Date).toISOString(),prompt:`Bug ä¿®å¤: ${E.value}`,changes:(0,b.klona)(v)}),f.value=v,m.value=!0,x.value='after',k.value?.setProgress(95),k.value?.setMessage(`Bug ä¿®å¤æ–¹æ¡ˆå·²ç”Ÿæˆ (${v.length} ä¸ªæ–‡ä»¶)`),await new Promise(e=>setTimeout(e,100)),k.value?.setProgress(100),k.value?.setMessage('Bug ä¿®å¤æ–¹æ¡ˆå·²ç”Ÿæˆï¼'),setTimeout(()=>{w.value=!1,C.value=!1,window.toastr.success('AI å·²ç”Ÿæˆä¿®å¤æ–¹æ¡ˆï¼Œè¯·åœ¨å¯¹æ¯”çª—å£ä¸­æŸ¥çœ‹')},800)}catch(e){console.error('Bug ä¿®å¤å¤±è´¥:',e),window.toastr.error(`Bug ä¿®å¤å¤±è´¥: ${e?.message||String(e)}`),w.value=!1}finally{p.value=!1}}async function te(){if(!c.value.trim()||p.value)return;const e=I.value;if(!e)return void toastr.error('è¯·å…ˆé€‰æ‹©ä¸€ä¸ªé¡¹ç›®');const n=c.value.trim();if(['å®Œå–„','ä¼˜åŒ–','æ”¹è¿›','ç¾åŒ–','ä¿®æ”¹','è°ƒæ•´','æ›´æ–°'].some(e=>new RegExp(`^${e}[ä¸€ä¸‹äº†å§å‘—å•Šå—ã€‚ï¼ï¼Ÿ\\s]*$`,'i').test(n)))return void toastr.warning('è¯·è¯¦ç»†æè¿°ä½ çš„éœ€æ±‚ï¼\n\nä¾‹å¦‚ï¼š\nâŒ "ä¼˜åŒ–ä¸€ä¸‹"\nâœ… "ä¼˜åŒ–æŒ‰é’®æ ·å¼ï¼Œæ·»åŠ æ‚¬åœåŠ¨ç”»å’Œåœ†è§’æ•ˆæœ"\n\nâŒ "å®Œå–„"\nâœ… "æ·»åŠ å“åº”å¼å¸ƒå±€ï¼Œæ”¯æŒç§»åŠ¨ç«¯æ˜¾ç¤º"','éœ€æ±‚å¤ªæ¨¡ç³Šäº†',{timeOut:6e3});p.value=!0,w.value=!0;let t='';try{k.value?.setProgress(5),k.value?.setMessage('æ­£åœ¨å‡†å¤‡ AI è¯·æ±‚...'),await new Promise(e=>setTimeout(e,100));const n=(0,d.Ut)();if(!n)return toastr.error('æ— æ³•è·å–è„šæœ¬ ID'),p.value=!1,void(w.value=!1);const a=getVariables({type:'script',script_id:n}),o=a?.api_endpoint,r=a?.api_key,s=a?.model||'gpt-4o-mini',i=a?.temperature||.7,b=a?.max_tokens||4e3;if(!o||!r)return toastr.error('è¯·å…ˆåœ¨"è®¾ç½®"æ ‡ç­¾é¡µé…ç½® API'),p.value=!1,void(w.value=!1);try{t=(0,l.normalizeApiEndpoint)(o),console.log('ğŸ“ åŸå§‹ç«¯ç‚¹:',o),console.log('ğŸ”— è§„èŒƒåŒ–åçš„ç«¯ç‚¹:',t)}catch(e){return toastr.error('API ç«¯ç‚¹æ ¼å¼ä¸æ­£ç¡®ï¼š'+e.message),p.value=!1,void(w.value=!1)}b<2e3&&toastr.warning(`å½“å‰ max_tokens è®¾ç½®ä¸º ${b}ï¼Œå¯èƒ½å¯¼è‡´ AI è¿”å›å†…å®¹è¢«æˆªæ–­ã€‚å»ºè®®è®¾ç½®ä¸º 4000 ä»¥ä¸Šã€‚`),k.value?.setProgress(15),k.value?.setMessage('æ­£åœ¨æ„å»ºæç¤ºè¯...'),await new Promise(e=>setTimeout(e,100));const h=`ä½ æ˜¯ä¸“ä¸šçš„å‰ç«¯å¼€å‘åŠ©æ‰‹ã€‚è¿™æ˜¯ä¸€ä¸ªåœ¨ SillyTavernï¼ˆé…’é¦†ï¼‰ä¸­è¿è¡Œçš„å‰ç«¯ç•Œé¢é¡¹ç›®ã€‚\n\n# å½“å‰é¡¹ç›®æ–‡ä»¶ï¼š\n${e.files.map(e=>`- ${e.path}`).join('\n')}\n\n# å¯ç”¨çš„ API å’Œåº“ï¼ˆå¯ç›´æ¥ä½¿ç”¨ï¼Œæ— éœ€å¯¼å…¥ï¼‰ï¼š\n## ç¬¬ä¸‰æ–¹åº“ï¼š\n- jQuery ($): DOM æ“ä½œã€äº‹ä»¶å¤„ç†\n- toastr: æ¶ˆæ¯æç¤º\n- gsap: åŠ¨ç”»æ•ˆæœ\n- lodash (_): å·¥å…·å‡½æ•°\n- zod (z): æ•°æ®æ ¡éªŒ\n\n## é…’é¦†åŠ©æ‰‹ APIï¼ˆå…¨å±€å¯ç”¨ï¼‰ï¼š\n**æ•°æ®æŒä¹…åŒ–ï¼ˆé‡è¦ï¼ï¼‰ï¼š**\n- \`getVariables({ type: 'chat' })\`: è·å–èŠå¤©å˜é‡ï¼ˆå¯¹è±¡å½¢å¼ï¼‰\n- \`insertOrAssignVariables(data, { type: 'chat' })\`: ä¿å­˜æ•°æ®åˆ°èŠå¤©å˜é‡ï¼ˆæ¨èç”¨è¿™ä¸ªï¼‰\n- \`replaceVariables(data, { type: 'chat' })\`: å®Œå…¨æ›¿æ¢èŠå¤©å˜é‡\n\n**æ•°æ®æŒä¹…åŒ–ç¤ºä¾‹ä»£ç ï¼š**\n\`\`\`javascript\n// âš ï¸ é‡è¦ï¼šéœ€è¦æ£€æµ‹æ˜¯å¦åœ¨é…’é¦†ç¯å¢ƒä¸­ï¼ˆé¢„è§ˆæ¨¡å¼ä¸‹é…’é¦† API ä¸å¯ç”¨ï¼‰\nconst isInTavern = typeof SillyTavern !== 'undefined' && typeof getVariables !== 'undefined';\n\n// åŠ è½½æ•°æ®\nfunction loadData() {\n  if (isInTavern) {\n    const data = getVariables({ type: 'chat' });\n    return data.my_key || { count: 0 };\n  } else {\n    // é¢„è§ˆæ¨¡å¼ï¼šä½¿ç”¨ localStorage\n    const stored = localStorage.getItem('my_key');\n    return stored ? JSON.parse(stored) : { count: 0 };\n  }\n}\n\n// ä¿å­˜æ•°æ®\nfunction saveData(data) {\n  if (isInTavern) {\n    insertOrAssignVariables({ my_key: data }, { type: 'chat' });\n  } else {\n    localStorage.setItem('my_key', JSON.stringify(data));\n  }\n}\n\n// ä½¿ç”¨\nlet myData = loadData();\nmyData.count++;\nsaveData(myData);\n\`\`\`\n\n**å…¶ä»– APIï¼š**\n- getChatMessages(): è·å–å½“å‰èŠå¤©çš„æ‰€æœ‰æ¶ˆæ¯\n- getCurrentCharacter(): è·å–å½“å‰è§’è‰²å¡ä¿¡æ¯\n- getWorldbook(): è·å–ä¸–ç•Œä¹¦\n- replaceWorldbook(data): æ›¿æ¢ä¸–ç•Œä¹¦\n- eventOn(event, callback): ç›‘å¬é…’é¦†äº‹ä»¶\n- getIframeName(): è·å–å½“å‰ iframe åç§°\n- triggerSlash(command): æ‰§è¡Œ STScript å‘½ä»¤\n- SillyTavern.getCurrentChatId(): è·å–å½“å‰èŠå¤© ID\n\n## ä»æ¶ˆæ¯ä¸­è¯»å–æ•°æ®å¹¶æ›´æ–°ç•Œé¢\n\n**åœºæ™¯ï¼š** åˆ›å»ºçŠ¶æ€æ ç•Œé¢ï¼Œéœ€è¦ä»æœ€æ–°çš„ AI æ¶ˆæ¯ä¸­æå–è§’è‰²çŠ¶æ€å¹¶å®æ—¶æ˜¾ç¤ºã€‚\n\n**æ ¸å¿ƒä»£ç ç¤ºä¾‹ï¼š**\n\n\`\`\`javascript\n// 1. è¯»å–æœ€æ–°æ¶ˆæ¯å†…å®¹\nasync function updateStatusFromMessages() {\n  if (typeof getChatMessages !== 'function') return; // é¢„è§ˆæ¨¡å¼è·³è¿‡\n\n  const messages = await getChatMessages();\n  if (!messages || messages.length === 0) return;\n\n  // è·å–æœ€æ–°çš„ AI æ¶ˆæ¯ï¼ˆä»åå¾€å‰æ‰¾ç¬¬ä¸€æ¡ is_user: falseï¼‰\n  const latestAIMessage = messages.slice().reverse().find(m => !m.is_user);\n  if (!latestAIMessage) return;\n\n  const content = latestAIMessage.mes; // æ¶ˆæ¯æ–‡æœ¬å†…å®¹\n\n  // 2. ä½¿ç”¨æ­£åˆ™æå–çŠ¶æ€æ•°æ®ï¼ˆç¤ºä¾‹ï¼šæå–ä»£ç å—ä¸­çš„çŠ¶æ€ï¼‰\n  const statusMatch = content.match(/\`\`\`json([\\s\\S]*?)\`\`\`/);\n  if (statusMatch) {\n    try {\n      const status = JSON.parse(statusMatch[1]);\n      // 3. æ›´æ–°ç•Œé¢æ˜¾ç¤º\n      $('#health').text(status.health || 100);\n      $('#level').text(status.level || 1);\n    } catch (e) {\n      console.error('è§£æçŠ¶æ€å¤±è´¥:', e);\n    }\n  }\n\n  // æˆ–è€…ç”¨æ­£åˆ™ç›´æ¥æå–ç‰¹å®šæ ¼å¼ï¼ˆä¾‹å¦‚ï¼šã€ç”Ÿå‘½å€¼ï¼š80ã€‘ï¼‰\n  const healthMatch = content.match(/ã€ç”Ÿå‘½å€¼[ï¼š:](\\d+)ã€‘/);\n  if (healthMatch) {\n    $('#health').text(healthMatch[1]);\n  }\n}\n\n// 4. é¡µé¢åŠ è½½æ—¶æ›´æ–°\n$(function() {\n  updateStatusFromMessages();\n});\n\n// 5. ç›‘å¬æ–°æ¶ˆæ¯äº‹ä»¶ï¼Œè‡ªåŠ¨æ›´æ–°ï¼ˆå¯é€‰ï¼‰\nif (typeof eventOn === 'function') {\n  eventOn('MESSAGE_RECEIVED', () => {\n    updateStatusFromMessages();\n  });\n}\n\`\`\`\n\n---\n\n## ğŸ¯ çŠ¶æ€æ  XML ç¾åŒ–ï¼ˆé‡è¦ï¼ï¼‰\n\n**åœºæ™¯ï¼š** AI å›å¤ä¸­åŒ…å« XML æ ¼å¼çš„çŠ¶æ€æ ï¼ˆå¦‚ \`<state_bar><i>ã€å†…å®¹ã€‘</i></state_bar>\`ï¼‰ï¼Œéœ€è¦å°†å…¶ç¾åŒ–æ˜¾ç¤ºã€‚\n\n**æ ¸å¿ƒåŠŸèƒ½ï¼š**\n1. æå– \`<state_bar>\` æ ‡ç­¾å†…å®¹\n2. å°† XML æ ‡ç­¾è½¬æ¢ä¸ºç¾åŒ–çš„ HTML\n3. å®æ—¶æ˜¾ç¤ºåœ¨ç•Œé¢ä¸Š\n\n**å®Œæ•´å®ç°ç¤ºä¾‹ï¼š**\n\n\`\`\`typescript\n// ===== 1. æå–çŠ¶æ€æ å†…å®¹ =====\nfunction extractStateBar(text: string): string | null {\n  const match = text.match(/<state_bar>([\\s\\S]*?)<\\/state_bar>/i);\n  return match ? match[1].trim() : null;\n}\n\n// ===== 2. XML è½¬ HTMLï¼ˆæ”¯æŒå¤šç§æ ‡ç­¾æ ¼å¼ï¼‰=====\nfunction convertXmlToHtml(xml: string): string {\n  let html = xml;\n\n  // å¤„ç†ç¼©è¿›æ ‡ç­¾ï¼š<i>ã€<2i>ã€<3i> ç­‰\n  html = html.replace(/<i>([\\s\\S]*?)<\\/i>/g, '<div class="state-item indent-1">$1</div>');\n  html = html.replace(/<2i>([\\s\\S]*?)<\\/2i>/g, '<div class="state-item indent-2">$1</div>');\n  html = html.replace(/<3i>([\\s\\S]*?)<\\/3i>/g, '<div class="state-item indent-3">$1</div>');\n\n  // å¤„ç†è¯­ä¹‰åŒ–æ ‡ç­¾ï¼ˆå¸¸è§çš„çŠ¶æ€æ æ ‡ç­¾ï¼‰\n  html = html.replace(/<æ—¥æœŸ>([\\s\\S]*?)<\\/æ—¥æœŸ>/g, '<div class="state-date">ğŸ“… $1</div>');\n  html = html.replace(/<æ—¶é—´>([\\s\\S]*?)<\\/æ—¶é—´>/g, '<div class="state-time">ğŸ• $1</div>');\n  html = html.replace(/<åœ°ç‚¹>([\\s\\S]*?)<\\/åœ°ç‚¹>/g, '<div class="state-location">ğŸ“ $1</div>');\n  html = html.replace(/<è§’è‰²ç”Ÿç†çŠ¶æ€>([\\s\\S]*?)<\\/è§’è‰²ç”Ÿç†çŠ¶æ€>/g, '<div class="state-physical">ğŸ’“ $1</div>');\n  html = html.replace(/<è§’è‰²å¿ƒç†çŠ¶æ€>([\\s\\S]*?)<\\/è§’è‰²å¿ƒç†çŠ¶æ€>/g, '<div class="state-mental">ğŸ§  $1</div>');\n  html = html.replace(/<å½“å‰çŠ¶æ€>([\\s\\S]*?)<\\/å½“å‰çŠ¶æ€>/g, '<div class="state-current">âœ¨ $1</div>');\n\n  // å¤„ç†é¢œè‰²æ ‡ç­¾ï¼ˆå¦‚ <è§’è‰²ç”Ÿç†çŠ¶æ€>ã€æè¿°è§’è‰²å½“å‰ç”Ÿç†çŠ¶æ€ã€‘</è§’è‰²ç”Ÿç†çŠ¶æ€>ï¼‰\n  html = html.replace(/<è§’è‰²ç”Ÿç†çŠ¶æ€>([\\s\\S]*?)<\\/è§’è‰²ç”Ÿç†çŠ¶æ€>/g,\n    '<div class="state-colored" style="border-left: 3px solid #ff6b6b; background: rgba(255,107,107,0.1);">$1</div>');\n\n  // é€šç”¨æ ‡ç­¾å¤„ç†ï¼ˆå…œåº•æ–¹æ¡ˆï¼‰\n  html = html.replace(/<([^>\\/\\s]+)>([\\s\\S]*?)<\\/\\1>/g, '<div class="state-generic">$2</div>');\n\n  return html;\n}\n\n// ===== 3. ç›‘å¬æ¶ˆæ¯å¹¶æ›´æ–° =====\nasync function updateStateBar() {\n  if (typeof getChatMessages !== 'function') return;\n\n  const messages = await getChatMessages();\n  if (!messages || messages.length === 0) return;\n\n  // è·å–æœ€æ–°çš„ AI æ¶ˆæ¯\n  const latestAI = messages.slice().reverse().find(m => !m.is_user);\n  if (!latestAI) return;\n\n  // æå–çŠ¶æ€æ \n  const stateBarXml = extractStateBar(latestAI.mes);\n  if (stateBarXml) {\n    const stateBarHtml = convertXmlToHtml(stateBarXml);\n\n    // æ›´æ–°ç•Œé¢ï¼ˆå¸¦åŠ¨ç”»ï¼‰\n    const container = $('#state-bar-container');\n    container.fadeOut(200, () => {\n      container.html(stateBarHtml);\n      container.fadeIn(200);\n    });\n  }\n}\n\n// ===== 4. åˆå§‹åŒ–å’Œç›‘å¬ =====\n$(function() {\n  updateStateBar(); // é¡µé¢åŠ è½½æ—¶æ›´æ–°\n\n  // ç›‘å¬æ¶ˆæ¯æ¥æ”¶äº‹ä»¶\n  if (typeof eventOn === 'function') {\n    eventOn('MESSAGE_RECEIVED', updateStateBar);\n  }\n});\n\`\`\`\n\n**é…å¥— CSS æ ·å¼ï¼š**\n\n\`\`\`scss\n#state-bar-container {\n  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);\n  border-radius: 12px;\n  padding: 16px;\n  color: white;\n  box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);\n  margin-bottom: 16px;\n}\n\n.state-item {\n  padding: 8px 12px;\n  margin: 6px 0;\n  background: rgba(255, 255, 255, 0.1);\n  border-radius: 6px;\n  backdrop-filter: blur(10px);\n  transition: all 0.3s ease;\n\n  &:hover {\n    background: rgba(255, 255, 255, 0.15);\n    transform: translateX(4px);\n  }\n}\n\n// ç¼©è¿›æ ·å¼\n.indent-1 { margin-left: 20px; }\n.indent-2 { margin-left: 40px; }\n.indent-3 { margin-left: 60px; }\n\n// è¯­ä¹‰åŒ–æ ‡ç­¾æ ·å¼\n.state-date, .state-time, .state-location {\n  font-weight: 600;\n  font-size: 14px;\n  padding: 8px 12px;\n  margin: 8px 0;\n  border-radius: 6px;\n}\n\n.state-date { background: rgba(100, 181, 246, 0.2); }\n.state-time { background: rgba(129, 199, 132, 0.2); }\n.state-location { background: rgba(255, 167, 38, 0.2); }\n\n.state-physical {\n  padding: 10px 14px;\n  margin: 8px 0;\n  background: rgba(255, 107, 107, 0.15);\n  border-left: 4px solid #ff6b6b;\n  border-radius: 4px;\n}\n\n.state-mental {\n  padding: 10px 14px;\n  margin: 8px 0;\n  background: rgba(149, 117, 205, 0.15);\n  border-left: 4px solid #9575cd;\n  border-radius: 4px;\n}\n\n.state-colored {\n  padding: 10px 14px;\n  margin: 8px 0;\n  border-radius: 4px;\n  backdrop-filter: blur(5px);\n}\n\n.state-generic {\n  padding: 6px 10px;\n  margin: 4px 0;\n  opacity: 0.9;\n}\n\`\`\`\n\n**ä½¿ç”¨ GSAP åˆ¶ä½œé«˜çº§åŠ¨ç”»ï¼ˆå¯é€‰ï¼‰ï¼š**\n\n\`\`\`typescript\n// ä½¿ç”¨ GSAP åˆ¶ä½œæ›´æµç•…çš„åŠ¨ç”»\nfunction updateStateBarWithAnimation(stateBarHtml: string) {\n  const container = $('#state-bar-container');\n\n  // æ·¡å‡º\n  gsap.to(container, {\n    opacity: 0,\n    y: -10,\n    duration: 0.2,\n    onComplete: () => {\n      container.html(stateBarHtml);\n\n      // æ·¡å…¥\n      gsap.to(container, {\n        opacity: 1,\n        y: 0,\n        duration: 0.3,\n        ease: 'power2.out'\n      });\n\n      // å­å…ƒç´ ä¾æ¬¡å‡ºç°\n      gsap.from('.state-item', {\n        opacity: 0,\n        x: -20,\n        duration: 0.4,\n        stagger: 0.05,\n        ease: 'back.out(1.2)'\n      });\n    }\n  });\n}\n\`\`\`\n\`\`\`\n\n**å…³é”®ç‚¹ï¼š**\n- ä½¿ç”¨ \`getChatMessages()\` è·å–æ‰€æœ‰æ¶ˆæ¯\n- é€šè¿‡æ­£åˆ™è¡¨è¾¾å¼ä»æ¶ˆæ¯æ–‡æœ¬ä¸­æå–æ•°æ®\n- ç”¨ jQuery æ›´æ–° DOM å…ƒç´ æ˜¾ç¤º\n- ç›‘å¬ MESSAGE_RECEIVED äº‹ä»¶å®ç°è‡ªåŠ¨æ›´æ–°\n\n## å®ç°åŒå±‚å¯¹è¯ï¼ˆæµå¼ä¼ è¾“å‰ç«¯ç•Œé¢ï¼‰\n\n**æ ¸å¿ƒæ¦‚å¿µï¼š**\nåŒå±‚å¯¹è¯æ˜¯ä¸€ä¸ª**ç‹¬ç«‹çš„å‰ç«¯ç•Œé¢**ï¼ˆæœ‰è‡ªå·±çš„ index.htmlï¼‰ï¼Œç©å®¶åªåœ¨ç•Œé¢å†…æ¸¸ç©ï¼Œä¸çœ‹é…’é¦†ä¸»èŠå¤©ã€‚\n\n**ğŸš¨ğŸš¨ğŸš¨ ç»å¯¹ç¦æ­¢ï¼ˆå¦åˆ™åŠŸèƒ½å®Œå…¨ä¸å·¥ä½œï¼ï¼‰ğŸš¨ğŸš¨ğŸš¨**\n\n\`\`\`javascript\n// âŒâŒâŒ ç»å¯¹ç¦æ­¢ï¼ç»å¯¹ç¦æ­¢ï¼ç»å¯¹ç¦æ­¢ï¼\n$(function() {\n  let chatHistory = [];           // âŒ å¤–éƒ¨è®¿é—®ä¸åˆ°ï¼\n  function renderMessages() {}    // âŒ å¤–éƒ¨è®¿é—®ä¸åˆ°ï¼\n  function handleSend() {}        // âŒ å¤–éƒ¨è®¿é—®ä¸åˆ°ï¼\n\n  // æ‰€æœ‰ä»£ç éƒ½åœ¨è¿™é‡Œ âŒâŒâŒ\n});\n\n// âœ…âœ…âœ… å¿…é¡»è¿™æ ·å†™ï¼å¿…é¡»è¿™æ ·å†™ï¼å¿…é¡»è¿™æ ·å†™ï¼\nlet chatHistory = [];              // âœ… å…¨å±€å˜é‡\nfunction renderMessages() {}       // âœ… å…¨å±€å‡½æ•°\nfunction handleSend() {}           // âœ… å…¨å±€å‡½æ•°\n\n$(function() {\n  // åªåœ¨è¿™é‡Œè°ƒç”¨å‡½æ•°ï¼Œä¸å®šä¹‰ï¼\n  loadChatHistory();\n  setupStreamListeners();\n});\n\`\`\`\n\n**ä»£ç ç»“æ„å¿…é¡»ä¸¥æ ¼æŒ‰ä»¥ä¸‹é¡ºåºï¼ˆä¸èƒ½æ”¹ï¼ï¼‰ï¼š**\n1. å…¨å±€å˜é‡å®šä¹‰ï¼ˆlet/constï¼‰\n2. å…¨å±€å‡½æ•°å®šä¹‰ï¼ˆfunctionï¼‰\n3. \`$(function() {})\` - åªç”¨äºè°ƒç”¨ä¸Šé¢å®šä¹‰çš„å‡½æ•°\n4. \`$(window).on('pagehide', ...)\` - å¸è½½äº‹ä»¶\n\n**âš ï¸âš ï¸âš ï¸ ç¬¬äºŒé‡è¦çš„æ³¨æ„äº‹é¡¹ï¼šgeneration_id è¿‡æ»¤**\nåŒå±‚å¯¹è¯çš„æµå¼ç›‘å¬å™¨ä¼šç›‘å¬åˆ°**æ‰€æœ‰**é…’é¦†çš„ç”Ÿæˆäº‹ä»¶ï¼ˆåŒ…æ‹¬ä¸»ç•Œé¢çš„ç”Ÿæˆï¼‰ã€‚å› æ­¤**å¿…é¡»ä½¿ç”¨ generation_id è¿‡æ»¤**ï¼Œå¦åˆ™ä¼šå‡ºç°ï¼š\n- åŒå±‚å¯¹è¯æ¥æ”¶åˆ°ä¸»ç•Œé¢çš„ AI å›å¤\n- çŠ¶æ€ç®¡ç†æ··ä¹±ï¼Œç”ŸæˆçŠ¶æ€å¯¹ä¸ä¸Š\n- æŒ‰é’®çŠ¶æ€å¼‚å¸¸\n\n**å®ç°è¦ç‚¹ï¼š**\n1. åˆ›å»º**å‰ç«¯ç•Œé¢é¡¹ç›®**ï¼ˆindex.html + index.tsï¼‰\n2. ç•Œé¢å†…è®¾è®¡è¾“å…¥æ¡†å’Œå‘é€æŒ‰é’®\n3. ç‚¹å‡»å‘é€æ—¶ï¼Œè°ƒç”¨ \`generate(text)\`ï¼Œå¹¶**ä¿å­˜è¿”å›çš„ generation_id**\n4. **ç›‘å¬æµå¼ä¼ è¾“äº‹ä»¶**æ—¶ï¼Œå¿…é¡»æ£€æŸ¥ \`id === currentGenerationId\`ï¼š\n   - \`iframe_events.STREAM_TOKEN_RECEIVED_INCREMENTALLY\`: æ¯ä¸ª token çš„å¢é‡æ›´æ–°\n   - \`iframe_events.STREAM_TOKEN_RECEIVED_FULLY\`: æµå¼ä¼ è¾“å®Œæˆï¼Œè·å–å®Œæ•´æ–‡æœ¬\n   - \`iframe_events.GENERATION_ENDED\`: ç”Ÿæˆç»“æŸï¼ˆå¤‡ç”¨æ–¹æ¡ˆï¼‰\n5. åå°æ“ä½œæ¶ˆæ¯æ¥¼å±‚ï¼ˆå¯é€‰ï¼‰ï¼šä½¿ç”¨ \`setChatMessages\`ã€\`createChatMessages\` é…åˆ \`{ refresh: 'none' }\` å‚æ•°\n\n**âš ï¸âš ï¸âš ï¸ å…³é”® APIï¼ˆå¿…é¡»ä½¿ç”¨æ­¤æ–¹æ³•ï¼ç¦æ­¢ä½¿ç”¨ generate()ï¼ï¼‰ï¼š**\n- **\`triggerSlashWithResult(command)\`**: æ‰§è¡Œ STScript å‘½ä»¤å¹¶è·å–è¿”å›å€¼\n  - è¿”å›å€¼ï¼š\`Promise<string>\`ï¼ˆAI ç”Ÿæˆçš„å®Œæ•´æ–‡æœ¬ï¼‰\n  - ç¤ºä¾‹ï¼š\`const result = await triggerSlashWithResult('/gen lock=on "å¯¹è¯å†…å®¹"');\`\n  - **é‡è¦**ï¼šä½¿ç”¨ \`/gen\` å‘½ä»¤ä¼šè‡ªåŠ¨ä½¿ç”¨è§’è‰²å¡ã€é¢„è®¾ã€ä¸–ç•Œä¹¦\n  - **å…³é”®ä¼˜åŠ¿**ï¼šä¸éœ€è¦æµå¼ç›‘å¬ï¼Œä¸éœ€è¦ generation_idï¼Œç›´æ¥è¿”å›å®Œæ•´ç»“æœ\n- **\`getRegexScripts()\`**: è·å–å½“å‰å¯ç”¨çš„æ­£åˆ™è„šæœ¬åˆ—è¡¨\n  - ç”¨äºè¿‡æ»¤æ€ç»´é“¾ã€è°ƒè¯•ä¿¡æ¯ç­‰\n  - **å¿…é¡»åœ¨æ˜¾ç¤º AI å›å¤å‰åº”ç”¨æ­£åˆ™è¿‡æ»¤**\n- **æ„å»ºå¯¹è¯å†å²ä¸ºæç¤ºè¯**ï¼šå°†å¯¹è¯å†å²æ‹¼æ¥æˆæ–‡æœ¬ï¼Œè€Œä¸æ˜¯ç”¨ API å‚æ•°\n- **\`triggerSlash(command)\`**: æ‰§è¡Œ STScript å‘½ä»¤ä½†ä¸ç­‰å¾…è¿”å›å€¼\n\n**âš ï¸âš ï¸âš ï¸ AI å›å¤çš„æ ‡ç­¾æ¸…ç†ï¼ˆéå¸¸é‡è¦ï¼ï¼‰ï¼š**\nAI å¯èƒ½ä¼šåœ¨å›å¤ä¸­ç”Ÿæˆæ€ç»´é“¾æ ‡ç­¾ï¼Œå¦‚ï¼š\`<guide>\`ã€\`<dream>\`ã€\`<plot>\`ã€\`<status>\`ã€\`<think>\` ç­‰ã€‚\nè¿™äº›æ ‡ç­¾**å¿…é¡»åœ¨æ˜¾ç¤ºå‰ç§»é™¤**ï¼Œå¦åˆ™ä¼šç ´åç•Œé¢æ•ˆæœï¼\n\n**æ¸…ç†ç­–ç•¥ï¼ˆå‚è€ƒæ¢¦æ˜Ÿå¤§ä½¬çš„æ–¹æ¡ˆï¼‰ï¼š**\n1. **ä¼˜å…ˆæå–æ­£æ–‡æ ‡ç­¾**ï¼šå¦‚æœ AI ç”¨ç‰¹å®šæ ‡ç­¾åŒ…è£¹æ­£æ–‡ï¼ˆå¦‚ \`<gametxt>\`ï¼‰ï¼Œä¼˜å…ˆæå–\n2. **å¤‡ç”¨æ–¹æ¡ˆ**ï¼šç§»é™¤æ‰€æœ‰æ€ç»´é“¾æ ‡ç­¾\n3. **å¯é€‰å¢å¼º**ï¼šåº”ç”¨é…’é¦†çš„å…¨å±€æ­£åˆ™å’Œé¢„è®¾æ­£åˆ™\n\n**å®Œæ•´çš„æ¸…ç†å‡½æ•°æ¨¡æ¿ï¼ˆæ¢¦æ˜Ÿæ–¹æ¡ˆï¼‰ï¼š**\n\`\`\`typescript\n// è¾…åŠ©å‡½æ•°ï¼šæå–æ ‡ç­¾å†…å®¹ï¼ˆä»åå¾€å‰æŸ¥æ‰¾æœ€åä¸€ä¸ªï¼‰\nfunction extractLastTagContent(tagName: string, text: string, ignoreCase = false): string | null {\n  if (!text || typeof text !== 'string') return null;\n\n  const endTag = \`</\${tagName}>\`;\n  let searchPool = text;\n  let endTagPattern = endTag;\n\n  if (ignoreCase) {\n    searchPool = text.toLowerCase();\n    endTagPattern = endTag.toLowerCase();\n  }\n\n  const lastEndIndex = searchPool.lastIndexOf(endTagPattern);\n  if (lastEndIndex !== -1) {\n    const startTag = \`<\${tagName}>\`;\n    let startTagPattern = startTag;\n    if (ignoreCase) startTagPattern = startTag.toLowerCase();\n\n    const lastStartIndex = searchPool.lastIndexOf(startTagPattern, lastEndIndex);\n    if (lastStartIndex !== -1) {\n      const startIndex = lastStartIndex + startTag.length;\n      return text.substring(startIndex, lastEndIndex).trim();\n    }\n  }\n  return null;\n}\n\n// ä¸»æ¸…ç†å‡½æ•°\nfunction applyRegexFilters(text: string): string {\n  console.log('ğŸ” å¼€å§‹æ¸…ç†ï¼ŒåŸå§‹é•¿åº¦:', text.length);\n\n  if (!text || typeof text !== 'string') return '';\n\n  // ===== æ­¥éª¤ 0: ä¿®å¤æœªé—­åˆçš„æ ‡ç­¾ï¼ˆå®¹é”™å¤„ç†ï¼‰=====\n  // å“ˆåŸºç±³æµå£æ°´æ—¶ç»å¸¸ä¸é—­åˆæ ‡ç­¾ï¼Œå¯¼è‡´"å‰ç«¯å¤±è¸ª"ã€"ä»£ç æš´éœ²"ç­‰é—®é¢˜\n  // æ£€æµ‹å¸¸è§çš„æœªé—­åˆæ ‡ç­¾å¹¶è‡ªåŠ¨é—­åˆ\n  // âš ï¸ dream å’Œ gametxt æ˜¯æ­£æ–‡æ ‡ç­¾ï¼Œéœ€è¦è¡¥é½ä»¥ä¾¿æå–å†…å®¹\n  const criticalTags = ['thinking', 'UpdateVariable', 'guide', 'plot', 'status', 'dream', 'gametxt'];\n  criticalTags.forEach(tag => {\n    const openTagRegex = new RegExp(\`<\${tag}([^>]*)>\`, 'gi');\n    const closeTagRegex = new RegExp(\`</\${tag}>\`, 'gi');\n\n    const openMatches = text.match(openTagRegex);\n    const closeMatches = text.match(closeTagRegex);\n\n    const openCount = openMatches ? openMatches.length : 0;\n    const closeCount = closeMatches ? closeMatches.length : 0;\n\n    if (openCount > closeCount) {\n      // æœ‰æœªé—­åˆçš„æ ‡ç­¾ï¼Œè‡ªåŠ¨è¡¥é½é—­åˆæ ‡ç­¾\n      const missing = openCount - closeCount;\n      console.log(\`âš ï¸ å‘ç° \${missing} ä¸ªæœªé—­åˆçš„ <\${tag}> æ ‡ç­¾ï¼Œè‡ªåŠ¨è¡¥é½\`);\n      text = text + \`</\${tag}>\`.repeat(missing);\n    }\n  });\n\n  // ===== æ­¥éª¤ 1: ä¼˜å…ˆæå–æ­£æ–‡æ ‡ç­¾ï¼ˆæ¢¦æ˜Ÿæ–¹æ¡ˆï¼‰=====\n  // å¦‚æœ AI ç”¨ç‰¹å®šæ ‡ç­¾åŒ…è£¹æ­£æ–‡ï¼Œä¼˜å…ˆæå–è¯¥æ ‡ç­¾çš„å†…å®¹\n  // âš ï¸âš ï¸âš ï¸ dream æ˜¯å¸¸è§çš„æ­£æ–‡æ ‡ç­¾ï¼å¿…é¡»ä¼˜å…ˆæå–ï¼\n  const gameTextTags = ['dream', 'gametxt', 'output', 'display', 'text', 'content'];\n  for (const tag of gameTextTags) {\n    const extracted = extractLastTagContent(tag, text);\n    if (extracted !== null) {\n      console.log(\`âœ… æå–äº† <\${tag}> æ ‡ç­¾çš„å†…å®¹ï¼Œé•¿åº¦:\`, extracted.length);\n      return extracted; // ç›´æ¥è¿”å›æ­£æ–‡ï¼Œä¸éœ€è¦è¿›ä¸€æ­¥æ¸…ç†\n    }\n  }\n\n  // ===== æ­¥éª¤ 2: å¤‡ç”¨æ–¹æ¡ˆ - ç§»é™¤æ‰€æœ‰æ€ç»´é“¾æ ‡ç­¾ =====\n  let cleanedText = text;\n\n  // å¸¸è§çš„å›ºå®šæ ‡ç­¾ï¼ˆæ³¨æ„ï¼šdream/gametxt æ˜¯æ­£æ–‡æ ‡ç­¾ï¼Œä¸åº”ç§»é™¤ï¼ï¼‰\n  const tagsToRemove = [\n    'guide', 'plot', 'status',\n    'UpdateVariable', 'è§’è‰²æå–', 'æœ¬ä¸–å†ç¨‹', 'å¾€ä¸–æ¶Ÿæ¼ª'\n  ];\n\n  tagsToRemove.forEach(tag => {\n    // ç§»é™¤ <tag>...</tag> ç»“æ„\n    const regexWithContent = new RegExp(\`<\${tag}[^>]*>[\\\\s\\\\S]*?</\${tag}>\`, 'gi');\n    const before = cleanedText;\n    cleanedText = cleanedText.replace(regexWithContent, '');\n\n    // ç§»é™¤è‡ªé—­åˆçš„ <tag/> ç»“æ„\n    const regexSelfClosing = new RegExp(\`<\${tag}\\\\s*\\\\/>\`, 'gi');\n    cleanedText = cleanedText.replace(regexSelfClosing, '');\n\n    if (before !== cleanedText) {\n      console.log(\`  ğŸ§¹ ç§»é™¤äº† <\${tag}> æ ‡ç­¾\`);\n    }\n  });\n\n  // âš ï¸âš ï¸âš ï¸ ç‰¹æ®Šå¤„ç†ï¼šç§»é™¤æ‰€æœ‰åŒ…å« think/thinking çš„æ ‡ç­¾ï¼ˆæ€ç»´é“¾ï¼‰\n  // åŒ¹é… <xxx_think>ã€<thinking_xxx>ã€<think>ã€<thinking> ç­‰æ‰€æœ‰å˜ä½“\n  const thinkingRegex = /<[^>]*think[^>]*>[\\\\s\\\\S]*?<\\/[^>]*think[^>]*>/gi;\n  const beforeThinking = cleanedText;\n  cleanedText = cleanedText.replace(thinkingRegex, '');\n  if (beforeThinking !== cleanedText) {\n    console.log('  ğŸ§¹ ç§»é™¤äº†åŒ…å« think/thinking çš„æ€ç»´é“¾æ ‡ç­¾');\n  }\n\n  // ç§»é™¤è‡ªé—­åˆçš„ think æ ‡ç­¾\n  const thinkingSelfClosing = /<[^>]*think[^>]*\\\\/>/gi;\n  cleanedText = cleanedText.replace(thinkingSelfClosing, '');\n\n  // æ¸…ç† HTML æ³¨é‡Š\n  cleanedText = cleanedText.replace(/\x3c!--[\\s\\S]*?--\x3e/g, '');\n\n  if (cleanedText !== text) {\n    console.log('âœ… æ ‡ç­¾æ¸…ç†å®Œæˆï¼Œæ¸…ç†åé•¿åº¦:', cleanedText.length);\n    text = cleanedText;\n  }\n\n  // ===== æ­¥éª¤ 2-3: å°è¯•åº”ç”¨é…’é¦†æ­£åˆ™ï¼ˆå¯é€‰ï¼‰=====\n  let allRegexScripts: any[] = [];\n\n  // æ–¹å¼ 1: å…¨å±€æ­£åˆ™\n  if (typeof getRegexScripts === 'function') {\n    try {\n      const globalRegexes = getRegexScripts();\n      if (globalRegexes && globalRegexes.length > 0) {\n        console.log('ğŸ“‹ ä»å…¨å±€æ­£åˆ™è·å–åˆ°', globalRegexes.length, 'ä¸ªè„šæœ¬');\n        allRegexScripts = allRegexScripts.concat(globalRegexes);\n      }\n    } catch (e) {\n      console.warn('âš ï¸ è·å–å…¨å±€æ­£åˆ™å¤±è´¥:', e);\n    }\n  }\n\n  // æ–¹å¼ 2: é¢„è®¾å†…ç½®æ­£åˆ™ï¼ˆæ”¯æŒ SoliUmbra ç­‰è„šæœ¬ï¼‰\n  try {\n    const parentST = (window as any).parent?.SillyTavern || (window as any).SillyTavern;\n    if (parentST && typeof parentST.getContext === 'function') {\n      const context = parentST.getContext();\n      const prompts = context?.chatCompletionSettings?.prompts;\n\n      if (prompts && Array.isArray(prompts)) {\n        const possibleIdentifiers = ['regexes-bindings', 'SPresetSettings', 'regex-bindings'];\n\n        for (const identifier of possibleIdentifiers) {\n          const regexPrompt = prompts.find((p: any) => p.identifier === identifier);\n          if (regexPrompt?.content) {\n            try {\n              const data = JSON.parse(regexPrompt.content);\n              let presetRegexes: any = null;\n\n              if (Array.isArray(data)) {\n                presetRegexes = data;\n              } else if (data && typeof data === 'object') {\n                if (data.RegexBinding?.regexes && Array.isArray(data.RegexBinding.regexes)) {\n                  presetRegexes = data.RegexBinding.regexes;\n                } else if (data.regexes && Array.isArray(data.regexes)) {\n                  presetRegexes = data.regexes;\n                }\n              }\n\n              if (presetRegexes && presetRegexes.length > 0) {\n                console.log('ğŸ“‹ ä»é¢„è®¾å†…ç½®æ­£åˆ™è·å–åˆ°', presetRegexes.length, 'ä¸ªè„šæœ¬ (identifier:', identifier + ')');\n                allRegexScripts = allRegexScripts.concat(presetRegexes);\n                break;\n              }\n            } catch (parseError) {\n              console.warn('âš ï¸ è§£æ identifier', identifier, 'å¤±è´¥:', parseError);\n            }\n          }\n        }\n      }\n    }\n  } catch (e) {\n    console.warn('âš ï¸ è·å–é¢„è®¾å†…ç½®æ­£åˆ™å¤±è´¥:', e);\n  }\n\n  if (allRegexScripts.length > 0) {\n    console.log('ğŸ“‹ æ€»å…±è·å–åˆ°', allRegexScripts.length, 'ä¸ªæ­£åˆ™è„šæœ¬');\n\n    // è¿‡æ»¤å‡ºé€‚ç”¨äº AI è¾“å‡ºåå¤„ç†çš„æ­£åˆ™ï¼ˆplacement åŒ…å« 2ï¼‰\n    // âš ï¸ åªæ£€æŸ¥ disabled å’Œ placementï¼Œä¸æ£€æŸ¥ promptOnly\n    // å› ä¸ºæœ‰äº›é¢„è®¾æ­£åˆ™å¯èƒ½æ²¡æœ‰ promptOnly å­—æ®µï¼Œæˆ–è€…è®¾ç½®ä¸è§„èŒƒ\n    const activeScripts = allRegexScripts.filter((script: any) => {\n      if (script.disabled) return false;\n      if (!script.placement || !Array.isArray(script.placement)) return false;\n      if (!script.placement.includes(2)) return false;\n      return true;\n    });\n\n    console.log('âœ… æ‰¾åˆ°', activeScripts.length, 'ä¸ªé€‚ç”¨çš„æ­£åˆ™è„šæœ¬');\n\n    let result = text;\n    activeScripts.forEach((script: any, index: number) => {\n      try {\n        const regex = new RegExp(script.findRegex, 'gim');\n        const beforeLength = result.length;\n        result = result.replace(regex, script.replaceString || '');\n\n        if (beforeLength !== result.length) {\n          console.log('ğŸ§¹ æ­£åˆ™', index + 1, '(', script.scriptName, ') ç”Ÿæ•ˆ');\n        }\n      } catch (e) {\n        console.error('âŒ æ­£åˆ™', index + 1, 'åº”ç”¨å¤±è´¥:', e);\n      }\n    });\n\n    text = result;\n  }\n\n  console.log('ğŸ“Š æœ€ç»ˆé•¿åº¦:', text.length);\n  return text;\n}\n\`\`\`\n\n**ä½¿ç”¨æ–¹å¼ï¼ˆå®Œæ•´ç¤ºä¾‹ï¼‰ï¼š**\n\`\`\`typescript\n// å…¨å±€å˜é‡\nlet chatHistory: Array<{ role: string; content: string }> = [];\nlet isGenerating = false;\n\n// å‘é€æ¶ˆæ¯\nasync function handleSend() {\n  const input = $('#user-input');\n  const userInput = input.val().trim();\n  if (!userInput || isGenerating) return;\n\n  // 1. æ·»åŠ ç”¨æˆ·æ¶ˆæ¯åˆ°å†å²\n  chatHistory.push({ role: 'user', content: userInput });\n  input.val('');\n  renderMessages();\n\n  // 2. è®¾ç½®ç”ŸæˆçŠ¶æ€\n  isGenerating = true;\n  $('#send-btn').prop('disabled', true).text('ç”Ÿæˆä¸­...');\n\n  try {\n    // 3. æ„å»ºå¯¹è¯å†å²æç¤ºè¯\n    let prompt = '';\n    chatHistory.slice(-10).forEach(msg => {\n      prompt += (msg.role === 'user' ? 'ç©å®¶' : 'AI') + ': ' + msg.content + '\\n';\n    });\n\n    // 4. è°ƒç”¨ AIï¼ˆä¸éœ€è¦æµå¼ï¼ï¼‰\n    const rawResult = await triggerSlashWithResult('/gen lock=on "' + prompt.replace(/"/g, '\\\\"') + '"');\n\n    // 5. â­ å…³é”®ï¼šå¿…é¡»å…ˆæ¸…ç†æ ‡ç­¾å†æ˜¾ç¤º\n    const cleanedResult = applyRegexFilters(rawResult);\n\n    // 6. æ·»åŠ åˆ°èŠå¤©å†å²å¹¶æ¸²æŸ“\n    chatHistory.push({ role: 'assistant', content: cleanedResult });\n    renderMessages();\n    saveChatHistory(); // ä¿å­˜åˆ°é…’é¦†å˜é‡\n\n  } catch (error) {\n    console.error('ç”Ÿæˆå¤±è´¥:', error);\n    toastr.error('ç”Ÿæˆå¤±è´¥: ' + (error?.message || String(error)));\n  } finally {\n    isGenerating = false;\n    $('#send-btn').prop('disabled', false).text('å‘é€');\n  }\n}\n\n// æ¸²æŸ“æ¶ˆæ¯\nfunction renderMessages() {\n  const container = $('#messages');\n  container.empty();\n\n  chatHistory.forEach(msg => {\n    const div = $('<div>')\n      .addClass('message')\n      .addClass(msg.role === 'user' ? 'user-message' : 'ai-message')\n      .text(msg.content); // ä½¿ç”¨ text() é˜²æ­¢ XSS\n    container.append(div);\n  });\n\n  container.scrollTop(container[0].scrollHeight);\n}\n\n// ä¿å­˜èŠå¤©å†å²\nfunction saveChatHistory() {\n  if (typeof insertOrAssignVariables === 'function') {\n    insertOrAssignVariables({ chat_history: chatHistory }, { type: 'chat' });\n  } else {\n    localStorage.setItem('chat_history', JSON.stringify(chatHistory));\n  }\n}\n\`\`\`\n\n**âš ï¸ é‡è¦è¯´æ˜ï¼šæµå¼ä¼ è¾“çš„æ­£ç¡®å®ç°æ–¹å¼ï¼**\n\n**ğŸš¨ åŒå±‚å¯¹è¯å¿…é¡»ä½¿ç”¨çœŸæµå¼ä¼ è¾“ï¼ğŸš¨**\n\n### â­ çœŸæµå¼æ¨¡å¼ï¼ˆå”¯ä¸€æ­£ç¡®çš„å®ç°æ–¹å¼ï¼‰\n- ä½¿ç”¨ \`generate({ should_stream: true, generation_id })\` å¯ç”¨æµå¼\n- ç›‘å¬ \`iframe_events.STREAM_TOKEN_RECEIVED_INCREMENTALLY\` å®æ—¶æ¥æ”¶æ–‡æœ¬\n- è¾¹æ¥æ”¶è¾¹æ¸…ç†æ ‡ç­¾è¾¹æ˜¾ç¤º\n- âœ… å®æ—¶æ˜¾ç¤º AI ç”Ÿæˆï¼Œæ— éœ€ç­‰å¾…ï¼Œä½“éªŒæœ€ä½³\n- âœ… ç”¨æˆ·å¯ä»¥ç«‹å³çœ‹åˆ° AI çš„å›å¤ï¼Œä½“éªŒæµç•…\n\n### âŒ ç¦æ­¢ä½¿ç”¨ä»¥ä¸‹æ–¹æ¡ˆï¼š\n- âŒ \`triggerSlashWithResult\`ï¼ˆéœ€è¦ç­‰å¾…å…¨éƒ¨ç”Ÿæˆï¼Œä½“éªŒå·®ï¼‰\n- âŒ æ‰“å­—æœºæ•ˆæœï¼ˆå‡æµå¼ï¼Œä»éœ€ç­‰å¾…ï¼Œä¸æ˜¯çœŸæ­£çš„æµå¼ï¼‰\n- âŒ \`generateRaw\`ï¼ˆä¸ä½¿ç”¨è§’è‰²å¡å’Œé¢„è®¾ï¼‰\n\n**ğŸ¯ çœŸæµå¼æ¨¡å¼çš„æ­£ç¡®å®ç°ï¼ˆå¼ºçƒˆæ¨èï¼‰ï¼š**\n\n\`\`\`typescript\n// ===== å…¨å±€å˜é‡ =====\nlet chatHistory: Array<{ role: string; content: string }> = [];\nlet isGenerating = false;\nlet currentGenerationId: string | null = null;\n\n// ===== çœŸæµå¼ç›‘å¬ï¼ˆæ ¸å¿ƒï¼ï¼‰=====\nfunction setupStreamListeners() {\n  // âš ï¸ ç›‘å¬å¢é‡æ–‡æœ¬ï¼ˆæ¯æ¬¡æ¥æ”¶ä¸€å°æ®µï¼‰\n  eventOn(iframe_events.STREAM_TOKEN_RECEIVED_INCREMENTALLY, (text: string, id: string) => {\n    if (!isGenerating || id !== currentGenerationId) return;\n\n    // âš ï¸âš ï¸âš ï¸ æ ¸å¿ƒï¼å¿…é¡»å®æ—¶æ¸…ç†æ ‡ç­¾ï¼\n    const cleanedText = applyRegexFilters(text);\n\n    // æ›´æ–° DOMï¼ˆæ‰¾åˆ°æœ€åä¸€æ¡æ¶ˆæ¯å¹¶æ›´æ–°ï¼‰\n    const container = $('#inner-messages');  // æ ¹æ®å®é™…å®¹å™¨ ID ä¿®æ”¹\n    const charName = SillyTavern?.name2 || 'AI';\n    const lastMsg = container.find('.message:last-child');\n\n    if (lastMsg.length && !lastMsg.hasClass('user-message')) {\n      // æ›´æ–°å·²æœ‰çš„ AI æ¶ˆæ¯\n      lastMsg.html('<strong>' + charName + ':</strong> ' + cleanedText);\n    } else {\n      // åˆ›å»ºæ–°çš„ AI æ¶ˆæ¯\n      const msgDiv = $('<div>')\n        .addClass('message ai-message')\n        .html('<strong>' + charName + ':</strong> ' + cleanedText);\n      container.append(msgDiv);\n    }\n\n    // è‡ªåŠ¨æ»šåŠ¨åˆ°åº•éƒ¨\n    container.scrollTop(container[0].scrollHeight);\n  });\n\n  // âš ï¸ ç›‘å¬ç”Ÿæˆå®Œæˆ\n  eventOn(iframe_events.GENERATION_ENDED, (text: string, id: string) => {\n    if (id === currentGenerationId) {\n      console.log('âœ… æµå¼ç”Ÿæˆå®Œæˆ');\n\n      // âš ï¸âš ï¸âš ï¸ æ ¸å¿ƒï¼æœ€åæ¸…ç†ä¸€æ¬¡å†ä¿å­˜åˆ°å†å²ï¼\n      const cleanedText = applyRegexFilters(text);\n\n      // ä¿å­˜åˆ°èŠå¤©å†å²\n      chatHistory.push({ role: 'assistant', content: cleanedText });\n      saveChatHistory();\n\n      // é‡æ–°æ¸²æŸ“ï¼ˆç¡®ä¿æ˜¾ç¤ºçš„æ˜¯æ¸…ç†åçš„å†…å®¹ï¼‰\n      renderMessages();\n\n      // é‡ç½®çŠ¶æ€\n      isGenerating = false;\n      currentGenerationId = null;\n      $('#inner-send-btn').prop('disabled', false).text('å‘é€');  // æ ¹æ®å®é™…æŒ‰é’® ID ä¿®æ”¹\n    }\n  });\n}\n\n// ===== å‘é€æ¶ˆæ¯ï¼ˆçœŸæµå¼ç‰ˆæœ¬ï¼‰=====\nasync function handleSend() {\n  const input = $('#inner-input');  // æ ¹æ®å®é™…è¾“å…¥æ¡† ID ä¿®æ”¹\n  const userInput = input.val().trim();\n  if (!userInput || isGenerating) return;\n\n  // 1. æ·»åŠ ç”¨æˆ·æ¶ˆæ¯\n  chatHistory.push({ role: 'user', content: userInput });\n  input.val('');\n  saveChatHistory();\n  renderMessages();\n\n  // 2. ç”Ÿæˆå”¯ä¸€ ID\n  currentGenerationId = 'chat-' + Date.now() + '-' + Math.random().toString(36).slice(2);\n\n  // 3. è®¾ç½®ç”ŸæˆçŠ¶æ€\n  isGenerating = true;\n  $('#inner-send-btn').prop('disabled', true).text('ç”Ÿæˆä¸­...');  // æ ¹æ®å®é™…æŒ‰é’® ID ä¿®æ”¹\n\n  try {\n    // 4. âš ï¸âš ï¸âš ï¸ æ ¸å¿ƒï¼šè°ƒç”¨ generate å¹¶å¯ç”¨æµå¼\n    await generate({\n      user_input: userInput,\n      should_stream: true,           // âš ï¸ å¿…é¡»å¯ç”¨æµå¼\n      generation_id: currentGenerationId,  // âš ï¸ å¿…é¡»ä¼ å…¥ ID ç”¨äºäº‹ä»¶è¿‡æ»¤\n      overrides: {\n        chat_history: {\n          prompts: chatHistory.map(msg => ({\n            role: msg.role === 'user' ? 'user' : 'assistant',\n            content: msg.content\n          }))\n        }\n      }\n    });\n\n    // æ³¨æ„ï¼šç”±äºæ˜¯æµå¼ï¼Œå®é™…çš„æ–‡æœ¬æ›´æ–°æ˜¯é€šè¿‡äº‹ä»¶ç›‘å¬å™¨å®æ—¶æ›´æ–°çš„\n    // GENERATION_ENDED äº‹ä»¶ä¼šè‡ªåŠ¨ä¿å­˜ AI å›å¤åˆ°å†å²\n\n  } catch (error) {\n    console.error('âŒ ç”Ÿæˆå¤±è´¥:', error);\n    toastr.error('ç”Ÿæˆå¤±è´¥: ' + error.message);\n\n    // é‡ç½®çŠ¶æ€\n    isGenerating = false;\n    currentGenerationId = null;\n    $('#inner-send-btn').prop('disabled', false).text('å‘é€');\n  }\n}\n\n// ===== æ¸²æŸ“æ¶ˆæ¯ =====\nfunction renderMessages() {\n  const container = $('#messages');\n  container.empty();\n\n  chatHistory.forEach((msg, index) => {\n    const div = $('<div>')\n      .attr('id', \\\`message-\\\${index}\\\`)  // âš ï¸ å¿…é¡»æœ‰ id\n      .addClass('message')\n      .addClass(msg.role === 'user' ? 'user-message' : 'ai-message')\n      .text(msg.content);\n    container.append(div);\n  });\n\n  container.scrollTop(container[0].scrollHeight);\n}\n\n// ===== åˆå§‹åŒ– =====\n$(() => {\n  loadChatHistory();\n  setupStreamListeners();  // âš ï¸ å¿…é¡»åœ¨åŠ è½½æ—¶å°±è®¾ç½®ç›‘å¬\n\n  $('#send-btn').on('click', handleSend);\n  $('#user-input').on('keypress', (e) => {\n    if (e.key === 'Enter' && !e.shiftKey) {\n      e.preventDefault();\n      handleSend();\n    }\n  });\n});\n\\\`\\\`\\\`\n\n**ğŸ¨ CSS æ ·å¼ï¼ˆå¯é€‰ï¼Œæ·»åŠ å…‰æ ‡æ•ˆæœï¼‰ï¼š**\n\\\`\\\`\\\`css\n.streaming {\n  border-right: 2px solid #165DFF;\n  animation: blink 1s infinite;\n}\n\n@keyframes blink {\n  0%, 50% { border-right-color: transparent; }\n  51%, 100% { border-right-color: #165DFF; }\n}\n\\\`\\\`\\\`\n\n**ğŸ’¡ æ¨¡å¼é€‰æ‹©å»ºè®®ï¼ˆé‡è¦ï¼ï¼‰ï¼š**\n- **åŒå±‚å¯¹è¯ï¼ˆå‰ç«¯ç•Œé¢ï¼‰**ï¼šå¿…é¡»ä½¿ç”¨çœŸæµå¼æ¨¡å¼ï¼ˆæ¨¡å¼ 3ï¼‰â­â­â­\n- **è„šæœ¬åå°ä»»åŠ¡**ï¼šå¯ä»¥ä½¿ç”¨ triggerSlashWithResultï¼ˆä¸éœ€è¦æµå¼ï¼‰\n- **åŸå› **ï¼šåŒå±‚å¯¹è¯éœ€è¦å®æ—¶æ˜¾ç¤º AI ç”Ÿæˆï¼Œç»™ç”¨æˆ·æœ€ä½³ä½“éªŒ\n- **ä¸è¦ç”¨å‡æµå¼ï¼** å‡æµå¼éœ€è¦ç­‰å¾…å®Œæ•´ç”Ÿæˆï¼Œä½“éªŒå·®\n\n**ğŸ”‘ çœŸæµå¼çš„å…³é”®è¦ç‚¹ï¼š**\n1. âœ… å¿…é¡»è°ƒç”¨ \`generate({ should_stream: true, generation_id: uniqueId })\`\n2. âœ… å¿…é¡»åœ¨åŠ è½½æ—¶å°±è®¾ç½®ç›‘å¬ï¼š\`setupStreamListeners()\`\n3. âœ… ç›‘å¬äº‹ä»¶ï¼š\`eventOn(iframe_events.STREAM_TOKEN_RECEIVED_INCREMENTALLY, (text, id) => ...)\`\n4. âœ… è¿‡æ»¤ IDï¼šç¡®ä¿åªå¤„ç†è‡ªå·±çš„ \`generation_id\`\n5. âœ… ä½¿ç”¨ \`overrides.chat_history.prompts\` ä¼ é€’èŠå¤©å†å²\n\n**ğŸš¨ğŸš¨ğŸš¨ æœ€å…³é”®ï¼å¿…é¡»åœ¨è¿™äº›åœ°æ–¹è°ƒç”¨ \`applyRegexFilters\`ï¼š**\n1. âš ï¸ **STREAM_TOKEN_RECEIVED_INCREMENTALLY äº‹ä»¶ä¸­**ï¼š\n   \`\`\`typescript\n   const cleanedText = applyRegexFilters(text);  // æ¸…ç†åå†æ˜¾ç¤ºï¼\n   lastMsg.html('<strong>' + charName + ':</strong> ' + cleanedText);\n   \`\`\`\n\n2. âš ï¸ **GENERATION_ENDED äº‹ä»¶ä¸­**ï¼š\n   \`\`\`typescript\n   const cleanedText = applyRegexFilters(text);  // æ¸…ç†åå†ä¿å­˜ï¼\n   chatHistory.push({ role: 'assistant', content: cleanedText });\n   \`\`\`\n\n**ğŸ’¡ \`applyRegexFilters\` çš„å®¹é”™æœºåˆ¶ï¼ˆå››å±‚ä¿æŠ¤ï¼‰ï¼š**\n1. âœ… **è‡ªåŠ¨è¡¥é½æœªé—­åˆçš„æ ‡ç­¾**ï¼ˆé˜²æ­¢"å‰ç«¯å¤±è¸ª"ã€"ä»£ç æš´éœ²"ï¼‰\n2. âœ… **ä¼˜å…ˆæå–æ­£æ–‡æ ‡ç­¾**ï¼ˆå¦‚ \`<dream>\`ã€\`<gametxt>\`ï¼‰â­â­â­ æœ€é‡è¦ï¼\n3. âœ… **ç§»é™¤æ€ç»´é“¾æ ‡ç­¾**ï¼ˆé€šé…ç¬¦åŒ¹é…æ‰€æœ‰åŒ…å« \`think\` çš„æ ‡ç­¾ï¼‰\n4. âœ… **åº”ç”¨é¢„è®¾æ­£åˆ™**ï¼ˆæ”¯æŒå…¨å±€æ­£åˆ™å’Œé¢„è®¾å†…ç½®æ­£åˆ™ï¼‰\n\n**ğŸš¨ğŸš¨ğŸš¨ æ­£æ–‡æ ‡ç­¾æå–ï¼ˆæ ¸å¿ƒåŸç†ï¼‰ï¼š**\n- **ä¸åŒé¢„è®¾ä½¿ç”¨ä¸åŒçš„æ­£æ–‡æ ‡ç­¾**ï¼š\`<dream>\`ã€\`<gametxt>\`ã€\`<output>\` ç­‰\n- **ä¼˜å…ˆæå–é¡ºåº**ï¼š\`['dream', 'gametxt', 'output', 'display', 'text', 'content']\`\n- **æå–é€»è¾‘**ï¼šæ‰¾åˆ°ç¬¬ä¸€ä¸ªåŒ¹é…çš„æ ‡ç­¾ï¼Œæå–å…¶å†…å®¹å¹¶ç›´æ¥è¿”å›\n- **ç¤ºä¾‹**ï¼š\n  \`\`\`\n  åŸå§‹ï¼š<guide>æ€ç»´</guide><dream>æ­£æ–‡å†…å®¹</dream><plot>å…ƒæ•°æ®</plot>\n  æå–ï¼šæ­£æ–‡å†…å®¹  â† åªä¿ç•™ <dream> é‡Œçš„å†…å®¹ï¼\n  \`\`\`\n\n**ğŸ¯ æ€ç»´é“¾æ ‡ç­¾å¤„ç†ï¼ˆé‡ç‚¹ï¼ï¼‰ï¼š**\n- æ€ç»´é“¾æ ‡ç­¾åé€šå¸¸åŒ…å« \`think\` æˆ– \`thinking\`\n- ä½¿ç”¨é€šé…ç¬¦æ­£åˆ™ï¼š\`/<[^>]*think[^>]*>[\\s\\S]*?<\\/[^>]*think[^>]*>/gi\`\n- è‡ªåŠ¨åŒ¹é…æ‰€æœ‰å˜ä½“ï¼š\`<think>\`ã€\`<thinking>\`ã€\`<xxx_think>\`ã€\`<thinking_xxx>\` ç­‰\n- å³ä½¿æ ‡ç­¾åå˜åŒ–ï¼Œä¹Ÿèƒ½æ­£ç¡®æ¸…ç†\n\n**å¸¸è§é—®é¢˜åŠè§£å†³æ–¹æ¡ˆï¼š**\n- âŒ æ€è€ƒå†…å®¹æš´éœ² â†’ \`<thinking>\` æœªé—­åˆ â†’ è‡ªåŠ¨è¡¥é½ + æ¸…ç†\n- âŒ å‰ç«¯å¤±è¸ª â†’ \`<UpdateVariable>\` æœªé—­åˆ â†’ è‡ªåŠ¨è¡¥é½ + æ¸…ç†\n- âŒ ä»£ç æš´éœ² â†’ å¤šä½™çš„ \`<UpdateVariable>\` â†’ æ¸…ç†æ‰€æœ‰ \`<UpdateVariable>\` æ ‡ç­¾\n\n**âŒ è‡´å‘½é”™è¯¯ï¼ˆç»å¯¹ä¸èƒ½çŠ¯ï¼‰ï¼š**\n- âŒ ç›´æ¥æ˜¾ç¤º/ä¿å­˜åŸå§‹ textï¼Œæ²¡æœ‰è°ƒç”¨ \`applyRegexFilters\`\n- âŒ åªåœ¨æ˜¾ç¤ºæ—¶æ¸…ç†ï¼Œä½†ä¿å­˜æ—¶ç”¨åŸå§‹ text\n- âŒ åªåœ¨ä¿å­˜æ—¶æ¸…ç†ï¼Œä½†æ˜¾ç¤ºæ—¶ç”¨åŸå§‹ text\n- âŒ ä¸è®¾ç½® \`should_stream: true\`\n- âŒ ä¸è®¾ç½® \`generation_id\`ï¼ˆä¼šæ”¶åˆ°æ‰€æœ‰äº‹ä»¶ï¼‰\n- âŒ ä¸è¿‡æ»¤ IDï¼ˆä¼šå¤„ç†å…¶ä»–åŒå±‚å¯¹è¯çš„äº‹ä»¶ï¼‰\n- âŒ ä¸åœ¨åŠ è½½æ—¶è®¾ç½®ç›‘å¬ï¼ˆä¼šä¸¢å¤±äº‹ä»¶ï¼‰\n\n**âš ï¸âš ï¸âš ï¸ ä½œç”¨åŸŸé—®é¢˜ï¼ˆæœ€å¸¸è§é”™è¯¯ï¼ï¼‰ï¼š**\nå˜é‡å’Œå‡½æ•°**å¿…é¡»åœ¨å…¨å±€ä½œç”¨åŸŸ**å®šä¹‰ï¼Œä¸èƒ½åœ¨ \`$(function() {})\` å†…éƒ¨ï¼\n\n\`\`\`javascript\n// âŒ é”™è¯¯ç¤ºä¾‹ï¼šå˜é‡åœ¨å±€éƒ¨ä½œç”¨åŸŸ\n$(function() {\n  let chatHistory = [];  // âŒ å¤–éƒ¨è®¿é—®ä¸åˆ°ï¼\n  function renderMessages() {}  // âŒ å¤–éƒ¨è®¿é—®ä¸åˆ°ï¼\n});\n\n// âœ… æ­£ç¡®ç¤ºä¾‹ï¼šå˜é‡åœ¨å…¨å±€ä½œç”¨åŸŸ\nlet chatHistory = [];  // âœ… å…¨å±€å¯è®¿é—®\nfunction renderMessages() {}  // âœ… å…¨å±€å¯è®¿é—®\n\n$(function() {\n  // åœ¨è¿™é‡Œè°ƒç”¨ä¸Šé¢å®šä¹‰çš„å‡½æ•°\n  loadChatHistory();\n});\n\`\`\`\n\n**ğŸ“‹ ä»£ç ç»“æ„å¤§çº²ï¼ˆå¿…é¡»ä¸¥æ ¼æŒ‰æ­¤é¡ºåºï¼ï¼‰ï¼š**\n\n\`\`\`javascript\n// index.ts æ–‡ä»¶ç»“æ„ï¼š\n//\n// 1ï¸âƒ£ å…¨å±€å˜é‡å®šä¹‰åŒºï¼ˆç¬¬ 1-10 è¡Œå·¦å³ï¼‰\n//    let chatHistory = [];\n//    let isGenerating = false;\n//    ...\n//\n// 2ï¸âƒ£ å…¨å±€å‡½æ•°å®šä¹‰åŒºï¼ˆç¬¬ 10-250 è¡Œå·¦å³ï¼‰\n//    function loadChatHistory() { ... }\n//    function saveChatHistory() { ... }\n//    function renderMessages() { ... }\n//    function applyRegexFilters(text) { ... }  // âš ï¸ å¿…é¡»ï¼ç”¨äºè¿‡æ»¤æ€ç»´é“¾\n//    function handleSend() { ... }\n//\n// 3ï¸âƒ£ jQuery åˆå§‹åŒ–åŒºï¼ˆç¬¬ 250-270 è¡Œå·¦å³ï¼‰\n//    $(function() {\n//      // åªè°ƒç”¨å‡½æ•°ï¼Œä¸å®šä¹‰ï¼\n//      loadChatHistory();\n//      $('#btn').on('click', handleSend);\n//    });\n//\n// 4ï¸âƒ£ å¸è½½äº‹ä»¶ï¼ˆç¬¬ 270-275 è¡Œå·¦å³ï¼‰\n//    $(window).on('pagehide', () => { ... });\n\`\`\`\n\n**å®Œæ•´å®ç°ç¤ºä¾‹ï¼ˆå¿…é¡» 100% æŒ‰æ­¤ç»“æ„ï¼ï¼‰ï¼š**\n\n\`\`\`javascript\n// =====================================================\n// âš ï¸âš ï¸âš ï¸ ä»¥ä¸‹æ‰€æœ‰ä»£ç éƒ½åœ¨å…¨å±€ä½œç”¨åŸŸï¼Œä¸è¦æ”¾åœ¨ $(function() {}) å†…ï¼\n// =====================================================\n\n// ===== 1. çŠ¶æ€ç®¡ç†ï¼ˆå¿…é¡»åœ¨å…¨å±€ä½œç”¨åŸŸï¼ï¼‰=====\nlet chatHistory = []; // { role: 'user'|'assistant', content: string }\nlet isGenerating = false;\n\n// ===== 2. æ•°æ®æŒä¹…åŒ–ï¼ˆä½¿ç”¨èŠå¤©å˜é‡ï¼‰ =====\nfunction loadChatHistory() {\n  const isInTavern = typeof getVariables === 'function';\n  if (!isInTavern) {\n    // é¢„è§ˆæ¨¡å¼\n    const saved = localStorage.getItem('inner_chat_history');\n    chatHistory = saved ? JSON.parse(saved) : [];\n  } else {\n    // é…’é¦†æ¨¡å¼ï¼šä»èŠå¤©å˜é‡è¯»å–\n    const data = getVariables({ type: 'chat' });\n    chatHistory = data?.inner_chat_history || [];\n  }\n  renderMessages();\n}\n\nfunction saveChatHistory() {\n  const isInTavern = typeof insertOrAssignVariables === 'function';\n  if (!isInTavern) {\n    localStorage.setItem('inner_chat_history', JSON.stringify(chatHistory));\n  } else {\n    insertOrAssignVariables({ inner_chat_history: chatHistory }, { type: 'chat' });\n  }\n}\n\n// ===== 3. ç•Œé¢æ¸²æŸ“ =====\nfunction renderMessages() {\n  console.log('ğŸ¨ renderMessages å¼€å§‹ï¼ŒèŠå¤©å†å²:', chatHistory.length, 'æ¡');\n\n  const container = $('#inner-messages');\n  console.log('ğŸ“¦ æ¶ˆæ¯å®¹å™¨:', container.length > 0 ? 'âœ… å­˜åœ¨' : 'âŒ ä¸å­˜åœ¨');\n\n  container.empty();\n\n  chatHistory.forEach((msg, index) => {\n    // è·å–æ˜¾ç¤ºåç§°\n    const name = msg.role === 'user'\n      ? (typeof getCurrentUser === 'function' ? getCurrentUser()?.name : null) || '{{user}}'\n      : (typeof getCurrentCharacter === 'function' ? getCurrentCharacter()?.name : null) || '{{char}}';\n\n    console.log('ğŸ’¬ æ¸²æŸ“æ¶ˆæ¯', index + 1, ':', msg.role, '-', name, '- é•¿åº¦:', msg.content.length);\n\n    const msgDiv = $('<div>')\n      .addClass('message')\n      .addClass(msg.role === 'user' ? 'user-message' : 'ai-message')\n      .html('<strong>' + name + ':</strong> ' + msg.content);\n    container.append(msgDiv);\n  });\n\n  console.log('âœ… renderMessages å®Œæˆï¼Œå®¹å™¨å†…æ¶ˆæ¯æ•°:', container.find('.message').length);\n\n  // æ»šåŠ¨åˆ°åº•éƒ¨\n  container.scrollTop(container[0].scrollHeight);\n}\n\n// ===== 4. æ­£åˆ™è¿‡æ»¤ï¼ˆéšè—æ€ç»´é“¾ç­‰ï¼‰ =====\n/**\n * åº”ç”¨æ­£åˆ™è„šæœ¬æ¥æ¸…ç† AI å›å¤\n * æ”¯æŒä¸‰ç§æ¸…ç†æ–¹å¼ï¼š\n * 1. é…’é¦†åŸç”Ÿå…¨å±€æ­£åˆ™ï¼ˆé€šè¿‡ getRegexScriptsï¼‰\n * 2. é¢„è®¾å†…ç½®æ­£åˆ™ï¼ˆé€šè¿‡ SoliUmbra çš„é¢„è®¾ç»‘å®šè„šæœ¬ï¼‰\n * 3. å†…ç½®çš„ç®€å•æ ‡ç­¾æ¸…ç†ï¼ˆä½œä¸ºå¤‡ç”¨æ–¹æ¡ˆï¼‰\n */\nfunction applyRegexFilters(text) {\n  console.log('ğŸ” å¼€å§‹åº”ç”¨æ­£åˆ™è¿‡æ»¤ï¼ŒåŸå§‹æ–‡æœ¬é•¿åº¦:', text.length);\n\n  // ===== æ­¥éª¤ 0: å†…ç½®çš„ç®€å•æ ‡ç­¾æ¸…ç†ï¼ˆå¤‡ç”¨æ–¹æ¡ˆï¼‰=====\n  // æ¸…ç†å¸¸è§çš„æ€ç»´é“¾æ ‡ç­¾ï¼š<guide>ã€<dream>ã€<plot>ã€<status>ã€<think> ç­‰\n  let cleanedText = text;\n  const commonTags = [\n    'guide', 'dream', 'plot', 'status', 'think', 'thinking',\n    'thought', 'reasoning', 'analysis', 'plan', 'reflection',\n    'meta', 'ooc', 'system', 'debug'\n  ];\n\n  commonTags.forEach(tag => {\n    // åŒ¹é… <tag>...</tag> æ ¼å¼ï¼ˆåŒ…æ‹¬æ¢è¡Œï¼‰\n    const regex = new RegExp(\`<\${tag}[^>]*>[\\\\s\\\\S]*?</\${tag}>\`, 'gi');\n    const before = cleanedText;\n    cleanedText = cleanedText.replace(regex, '');\n    if (before !== cleanedText) {\n      console.log(\`  ğŸ§¹ å†…ç½®æ¸…ç†: ç§»é™¤äº† <\${tag}> æ ‡ç­¾\`);\n    }\n  });\n\n  // æ¸…ç† HTML æ³¨é‡Šä¸­çš„è°ƒè¯•ä¿¡æ¯\n  cleanedText = cleanedText.replace(/\x3c!--[\\s\\S]*?--\x3e/g, '');\n\n  // å¦‚æœå†…ç½®æ¸…ç†ç”Ÿæ•ˆäº†ï¼Œå…ˆæ˜¾ç¤ºç»“æœ\n  if (cleanedText !== text) {\n    console.log('âœ… å†…ç½®æ ‡ç­¾æ¸…ç†å®Œæˆï¼Œæ¸…ç†åé•¿åº¦:', cleanedText.length);\n    text = cleanedText;\n  }\n\n  // ===== æ­¥éª¤ 1-2: å°è¯•ä½¿ç”¨é…’é¦†çš„æ­£åˆ™è„šæœ¬ =====\n  let allRegexScripts = [];\n\n  // æ–¹å¼ 1: å°è¯•ä»é…’é¦†åŸç”Ÿå…¨å±€æ­£åˆ™è·å–\n  if (typeof getRegexScripts === 'function') {\n    try {\n      const globalRegex = getRegexScripts();\n      console.log('ğŸ“‹ ä»å…¨å±€æ­£åˆ™è·å–åˆ°', globalRegex.length, 'ä¸ªè„šæœ¬');\n      allRegexScripts = allRegexScripts.concat(globalRegex);\n    } catch (e) {\n      console.warn('âš ï¸ è·å–å…¨å±€æ­£åˆ™å¤±è´¥:', e);\n    }\n  }\n\n  // æ–¹å¼ 2: å°è¯•ä»é¢„è®¾å†…ç½®æ­£åˆ™è·å–ï¼ˆSoliUmbra çš„æ–¹æ¡ˆï¼‰\n  // âš ï¸ åŒå±‚å¯¹è¯åœ¨ iframe ä¸­ï¼Œéœ€è¦é€šè¿‡ window.parent.SillyTavern.getContext() è®¿é—®\n  try {\n    const parentST = window.parent?.SillyTavern || window.SillyTavern;\n    if (parentST && typeof parentST.getContext === 'function') {\n      const context = parentST.getContext();\n      const prompts = context?.chatCompletionSettings?.prompts;\n\n      if (prompts && Array.isArray(prompts)) {\n        // å°è¯•å¤šä¸ªå¯èƒ½çš„ identifierï¼ˆä¸åŒé¢„è®¾ä½¿ç”¨ä¸åŒçš„å‘½åï¼‰\n        const possibleIdentifiers = ['regexes-bindings', 'SPresetSettings', 'regex-bindings'];\n\n        for (const identifier of possibleIdentifiers) {\n          const regexPrompt = prompts.find(p => p.identifier === identifier);\n          if (regexPrompt?.content) {\n            try {\n              const data = JSON.parse(regexPrompt.content);\n              let presetRegexes = null;\n\n              // å¤„ç†ä¸åŒçš„æ•°æ®æ ¼å¼\n              if (Array.isArray(data)) {\n                // ç›´æ¥æ˜¯æ•°ç»„ï¼ˆå¦‚ regexes-bindingsï¼‰\n                presetRegexes = data;\n              } else if (data && typeof data === 'object') {\n                // åµŒå¥—å¯¹è±¡ï¼ˆå¦‚ SPresetSettings.RegexBinding.regexesï¼‰\n                if (data.RegexBinding?.regexes && Array.isArray(data.RegexBinding.regexes)) {\n                  presetRegexes = data.RegexBinding.regexes;\n                } else if (data.regexes && Array.isArray(data.regexes)) {\n                  presetRegexes = data.regexes;\n                }\n              }\n\n              if (presetRegexes && presetRegexes.length > 0) {\n                console.log('ğŸ“‹ ä»é¢„è®¾å†…ç½®æ­£åˆ™è·å–åˆ°', presetRegexes.length, 'ä¸ªè„šæœ¬ (identifier:', identifier + ')');\n                allRegexScripts = allRegexScripts.concat(presetRegexes);\n                break; // æ‰¾åˆ°å°±é€€å‡ºå¾ªç¯\n              }\n            } catch (parseError) {\n              console.warn('âš ï¸ è§£æ identifier', identifier, 'å¤±è´¥:', parseError);\n            }\n          }\n        }\n      }\n    }\n  } catch (e) {\n    console.warn('âš ï¸ è·å–é¢„è®¾å†…ç½®æ­£åˆ™å¤±è´¥:', e);\n  }\n\n  if (allRegexScripts.length === 0) {\n    console.log('âš ï¸ æœªæ‰¾åˆ°ä»»ä½•æ­£åˆ™è„šæœ¬ï¼Œè·³è¿‡è¿‡æ»¤');\n    return text;\n  }\n\n  console.log('ğŸ“‹ æ€»å…±è·å–åˆ°', allRegexScripts.length, 'ä¸ªæ­£åˆ™è„šæœ¬');\n\n  // è¿‡æ»¤å‡ºå¯ç”¨çš„ã€é€‚ç”¨äº AI è¾“å‡ºåå¤„ç†çš„æ­£åˆ™\n  // placement æ•°ç»„:\n  //   0 = æç¤ºè¯ä¹‹å‰\n  //   1 = æç¤ºè¯ä¹‹åï¼ˆå‘é€ç»™ AI ä¹‹å‰ï¼‰\n  //   2 = AI è¾“å‡ºä¹‹åï¼ˆæ˜¾ç¤ºç»™ç”¨æˆ·ä¹‹å‰ï¼‰â­ è¿™æ˜¯æˆ‘ä»¬éœ€è¦çš„ï¼\n  // promptOnly: true = ä»…ç”¨äºæç¤ºè¯å¤„ç†\n  // promptOnly: false = ç”¨äºè¾“å‡ºåå¤„ç† â­ è¿™æ˜¯æˆ‘ä»¬éœ€è¦çš„ï¼\n  const activeScripts = allRegexScripts.filter(script => {\n    return !script.disabled &&\n           !script.promptOnly &&  // åªè¦ promptOnly ä¸º false çš„\n           script.placement &&\n           script.placement.includes(2);  // åªè¦ placement åŒ…å« 2 çš„ï¼ˆAI è¾“å‡ºåï¼‰\n  });\n\n  console.log('âœ… æ‰¾åˆ°', activeScripts.length, 'ä¸ªé€‚ç”¨çš„æ­£åˆ™è„šæœ¬');\n\n  let result = text;\n\n  // ä¾æ¬¡åº”ç”¨æ¯ä¸ªæ­£åˆ™\n  activeScripts.forEach((script, index) => {\n    try {\n      const regex = new RegExp(script.findRegex, 'gim');\n      const beforeLength = result.length;\n      result = result.replace(regex, script.replaceString || '');\n\n      if (beforeLength !== result.length) {\n        console.log('ğŸ§¹ æ­£åˆ™', index + 1, '(', script.scriptName, ') ç”Ÿæ•ˆï¼Œç§»é™¤äº†', beforeLength - result.length, 'ä¸ªå­—ç¬¦');\n      }\n    } catch (e) {\n      console.error('âŒ æ­£åˆ™', index + 1, '(', script.scriptName, ') åº”ç”¨å¤±è´¥:', e);\n    }\n  });\n\n  console.log('ğŸ¯ æ­£åˆ™è¿‡æ»¤å®Œæˆï¼ŒåŸå§‹é•¿åº¦:', text.length, 'è¿‡æ»¤åé•¿åº¦:', result.length);\n\n  return result;\n}\n\n// ===== 5. å‘é€æ¶ˆæ¯ =====\n// âš ï¸ å‡½æ•°åå¿…é¡»é¿å…ä¸é…’é¦†å†²çªï¼ˆä¸è¦ç”¨ sendChatMessageï¼‰\n// âš ï¸ è¿™ä¸ªå‡½æ•°å¿…é¡»åœ¨å…¨å±€ä½œç”¨åŸŸå®šä¹‰ï¼\nasync function handleSend() {\n  const input = $('#inner-user-input');\n  const text = input.val().trim();\n\n  if (!text || isGenerating) return;\n\n  // æ·»åŠ ç”¨æˆ·æ¶ˆæ¯\n  chatHistory.push({ role: 'user', content: text });\n  input.val('');\n  renderMessages();\n  saveChatHistory();\n\n  // è®¾ç½®ç”ŸæˆçŠ¶æ€\n  isGenerating = true;\n  $('#inner-send-btn').prop('disabled', true).text('ç”Ÿæˆä¸­...');\n\n  try {\n    // âš ï¸ æ£€æŸ¥ STScript API å¯ç”¨æ€§\n    if (typeof triggerSlashWithResult !== 'function') {\n      throw new Error('è¯·åœ¨é…’é¦†ä¸­ä½¿ç”¨æ­¤åŠŸèƒ½');\n    }\n\n    // è·å–ç”¨æˆ·åå’Œè§’è‰²å\n    const userName = SillyTavern?.name1 || 'You';\n    const charName = SillyTavern?.name2 || 'AI';\n\n    // æ„å»ºå®Œæ•´çš„å¯¹è¯ä¸Šä¸‹æ–‡ï¼ˆåŒ…å«å†å²è®°å½•ï¼‰\n    let fullPrompt = '';\n    if (chatHistory.length > 0) {\n      fullPrompt += 'ã€å¯¹è¯å†å²ã€‘\\n';\n      chatHistory.forEach((msg) => {\n        const name = msg.role === 'user' ? userName : charName;\n        fullPrompt += name + ': ' + msg.content + '\\n';\n      });\n      fullPrompt += '\\n';\n    }\n    fullPrompt += userName + ': ' + text;\n\n    console.log('ğŸš€ å¼€å§‹ç”Ÿæˆï¼Œæç¤ºè¯é•¿åº¦:', fullPrompt.length);\n\n    // âš ï¸âš ï¸âš ï¸ ä½¿ç”¨ /gen å‘½ä»¤ï¼ˆä¼šè‡ªåŠ¨ä½¿ç”¨è§’è‰²å¡ã€é¢„è®¾ã€ä¸–ç•Œä¹¦ï¼‰\n    const command = '/gen lock=on "' + fullPrompt.replace(/"/g, '\\\\"') + '"';\n    const result = await triggerSlashWithResult(command);\n\n    console.log('ğŸ“¥ AI è¿”å›å€¼é•¿åº¦:', result ? result.length : 0);\n\n    if (result && result.length > 0) {\n      // âš ï¸âš ï¸âš ï¸ åº”ç”¨æ­£åˆ™è¿‡æ»¤ï¼ˆéšè—æ€ç»´é“¾ç­‰è°ƒè¯•ä¿¡æ¯ï¼‰\n      const cleanedResult = applyRegexFilters(result);\n      console.log('ğŸ§¹ æ­£åˆ™è¿‡æ»¤åé•¿åº¦:', cleanedResult.length);\n\n      // æ·»åŠ  AI å›å¤åˆ°å†å²\n      chatHistory.push({ role: 'assistant', content: cleanedResult });\n      saveChatHistory();\n      renderMessages();\n      toastr.success('å›å¤æˆåŠŸ');\n    } else {\n      toastr.warning('AI æœªè¿”å›å†…å®¹');\n    }\n\n  } catch (error) {\n    console.error('ç”Ÿæˆå¤±è´¥:', error);\n    toastr.error('ç”Ÿæˆå¤±è´¥: ' + (error?.message || String(error)));\n  } finally {\n    // é‡ç½®çŠ¶æ€\n    isGenerating = false;\n    $('#inner-send-btn').prop('disabled', false).text('å‘é€');\n  }\n}\n\n// =====================================================\n// âš ï¸âš ï¸âš ï¸ ä»è¿™é‡Œå¼€å§‹æ‰èƒ½ç”¨ $(function() {})ï¼Œä¸Šé¢çš„ä»£ç éƒ½æ˜¯å…¨å±€çš„ï¼\n// =====================================================\n\n// ===== 6. åˆå§‹åŒ– =====\n// âš ï¸âš ï¸âš ï¸ å…³é”®ï¼šåªåœ¨è¿™é‡Œè°ƒç”¨å‡½æ•°ï¼Œä¸è¦åœ¨è¿™é‡Œå®šä¹‰å˜é‡å’Œå‡½æ•°ï¼\n$(function() {\n  // è°ƒè¯•è¾“å‡ºï¼Œç¡®ä¿ä»£ç åŠ è½½æˆåŠŸ\n  console.log('âœ… åŒå±‚å¯¹è¯åˆå§‹åŒ–å¼€å§‹');\n  console.log('ğŸ“‹ chatHistory å¯è®¿é—®:', typeof chatHistory !== 'undefined');\n  console.log('ğŸ”§ renderMessages å¯è®¿é—®:', typeof renderMessages === 'function');\n  console.log('ğŸ”§ handleSend å¯è®¿é—®:', typeof handleSend === 'function');\n\n  // âš ï¸ å¦‚æœä¸Šé¢ä»»ä½•ä¸€ä¸ªæ˜¯ falseï¼Œè¯´æ˜å‡½æ•°å®šä¹‰åœ¨ $(function() {}) å†…éƒ¨äº†ï¼\n  if (typeof chatHistory === 'undefined' || typeof renderMessages !== 'function') {\n    console.error('âŒâŒâŒ ä¸¥é‡é”™è¯¯ï¼šå˜é‡/å‡½æ•°å®šä¹‰åœ¨äº†å±€éƒ¨ä½œç”¨åŸŸï¼');\n    console.error('è¯·æ£€æŸ¥ä»£ç ï¼Œç¡®ä¿æ‰€æœ‰å˜é‡å’Œå‡½æ•°éƒ½åœ¨ $(function() {}) å¤–éƒ¨å®šä¹‰ï¼');\n    toastr.error('ä»£ç ç»“æ„é”™è¯¯ï¼šå˜é‡ä½œç”¨åŸŸé—®é¢˜');\n    return;\n  }\n\n  loadChatHistory();\n\n  // ç»‘å®šäº‹ä»¶\n  $('#inner-send-btn').on('click', handleSend);\n  $('#inner-user-input').on('keypress', (e) => {\n    if (e.key === 'Enter' && !e.shiftKey) {\n      e.preventDefault();\n      handleSend();\n    }\n  });\n\n  // æ¸…ç©ºæŒ‰é’®\n  $('#inner-clear-btn').on('click', () => {\n    if (confirm('ç¡®å®šæ¸…ç©ºå¯¹è¯å†å²ï¼Ÿ')) {\n      chatHistory = [];\n      renderMessages();\n      saveChatHistory();\n    }\n  });\n\n  console.log('âœ… åŒå±‚å¯¹è¯åˆå§‹åŒ–å®Œæˆ');\n  console.log('ğŸ“Š æ¶ˆæ¯å®¹å™¨:', $('#inner-messages').length > 0 ? 'âœ… å­˜åœ¨' : 'âŒ ä¸å­˜åœ¨');\n});\n\n// ===== 7. å¸è½½æ—¶ä¿å­˜ =====\n$(window).on('pagehide', () => {\n  saveChatHistory();\n});\n\`\`\`\n\n**HTML ç»“æ„ç¤ºä¾‹ï¼ˆå¿…é¡»åŒ…å«ä»¥ä¸‹æ‰€æœ‰å…ƒç´ ï¼‰ï¼š**\n\`\`\`html\n<div class="inner-chat-container">\n  <div class="inner-chat-header">\n    <h3>åŒå±‚å¯¹è¯</h3>\n    <button id="inner-clear-btn">æ¸…ç©º</button>\n  </div>\n\n  \x3c!-- âš ï¸ å¿…éœ€ï¼šæ¶ˆæ¯å®¹å™¨ï¼ŒID å¿…é¡»æ˜¯ inner-messages --\x3e\n  <div id="inner-messages" class="inner-messages"></div>\n\n  <div class="inner-input-area">\n    \x3c!-- âš ï¸ å¿…éœ€ï¼šè¾“å…¥æ¡†ï¼ŒID å¿…é¡»æ˜¯ inner-user-input --\x3e\n    <textarea id="inner-user-input" placeholder="è¾“å…¥æ¶ˆæ¯..."></textarea>\n    \x3c!-- âš ï¸ å¿…éœ€ï¼šå‘é€æŒ‰é’®ï¼ŒID å¿…é¡»æ˜¯ inner-send-btn --\x3e\n    <button id="inner-send-btn">å‘é€</button>\n  </div>\n</div>\n\`\`\`\n\n**âš ï¸ HTML æ£€æŸ¥æ¸…å•ï¼š**\n- [ ] æ˜¯å¦æœ‰ \`id="inner-messages"\` çš„æ¶ˆæ¯å®¹å™¨ï¼Ÿ\n- [ ] æ˜¯å¦æœ‰ \`id="inner-user-input"\` çš„è¾“å…¥æ¡†ï¼Ÿ\n- [ ] æ˜¯å¦æœ‰ \`id="inner-send-btn"\` çš„å‘é€æŒ‰é’®ï¼Ÿ\n- [ ] æ˜¯å¦æœ‰ \`id="inner-clear-btn"\` çš„æ¸…ç©ºæŒ‰é’®ï¼Ÿ\n- [ ] ID æ˜¯å¦ä¸ JS ä»£ç ä¸­ä½¿ç”¨çš„å®Œå…¨ä¸€è‡´ï¼Ÿ\n\n**CSS æ ·å¼ç¤ºä¾‹ï¼ˆå¿…é¡»ä¸¥æ ¼éµå®ˆï¼Œç¡®ä¿æ¶ˆæ¯æ­£ç¡®å·¦å³å¯¹é½ï¼‰ï¼š**\n\`\`\`css\n/* æ¶ˆæ¯å®¹å™¨ */\n.inner-messages {\n  height: 400px;\n  overflow-y: auto;\n  padding: 15px;\n  display: flex;  /* âš ï¸ å¿…é¡»ç”¨ flex */\n  flex-direction: column;\n  gap: 10px;\n}\n\n/* æ¶ˆæ¯åŸºç¡€æ ·å¼ */\n.message {\n  max-width: 70%;\n  padding: 10px 15px;\n  border-radius: 12px;\n  word-wrap: break-word;\n}\n\n/* âš ï¸ ç”¨æˆ·æ¶ˆæ¯ï¼šå³å¯¹é½ï¼Œè“è‰² */\n.user-message {\n  align-self: flex-end;  /* âœ… å³å¯¹é½å…³é”®ï¼*/\n  background: #4a9eff;\n  color: white;\n}\n\n/* âš ï¸ AI æ¶ˆæ¯ï¼šå·¦å¯¹é½ï¼Œç°è‰² */\n.ai-message {\n  align-self: flex-start;  /* âœ… å·¦å¯¹é½å…³é”®ï¼*/\n  background: #2a2a2a;\n  color: #e0e0e0;\n}\n\`\`\`\n\n**âš ï¸ å…³é”®ç‚¹ï¼š**\n- ID å¿…é¡»ç”¨å”¯ä¸€å‰ç¼€ï¼ˆ\`inner-\`ï¼‰\n- å®¹å™¨å¿…é¡» \`display: flex; flex-direction: column\`\n- ç”¨æˆ·æ¶ˆæ¯ç”¨ \`align-self: flex-end\` å³å¯¹é½\n- AI æ¶ˆæ¯ç”¨ \`align-self: flex-start\` å·¦å¯¹é½\n\n**å…³é”® APIï¼š**\n- **\`generate(prompt)\`**: **è°ƒç”¨ AI ç”Ÿæˆï¼ˆä½¿ç”¨å½“å‰é¢„è®¾ã€è§’è‰²å¡ã€ä¸–ç•Œä¹¦ï¼‰**\n- \`generateRaw(prompt)\`: è°ƒç”¨ AI ç”Ÿæˆï¼ˆä¸ä½¿ç”¨é¢„è®¾ï¼Œçº¯æ–‡æœ¬ç”Ÿæˆï¼‰\n- \`getVariables({ type: 'message', message_id })\`: è¯»å–æ¶ˆæ¯æ¥¼å±‚å˜é‡\n- \`insertOrAssignVariables(data, { type: 'message', message_id })\`: ä¿å­˜åˆ°æ¶ˆæ¯æ¥¼å±‚å˜é‡\n- \`getChatMessages()\`: è·å–æ‰€æœ‰æ¶ˆæ¯\n\n**é‡è¦åŒºåˆ«ï¼š**\n- **\`generate\`**: ä½¿ç”¨å®Œæ•´çš„è§’è‰²é¢„è®¾ï¼Œé€‚åˆåŒå±‚å¯¹è¯ï¼ˆæ¨èï¼ï¼‰\n- **\`generateRaw\`**: ä¸ä½¿ç”¨é¢„è®¾ï¼Œé€‚åˆçº¯æ–‡æœ¬ç”Ÿæˆä»»åŠ¡\n\n**âš ï¸ å…³é”®æ³¨æ„äº‹é¡¹ï¼ˆå¿…è¯»ï¼‰ï¼š**\n1. **ä½œç”¨åŸŸé—®é¢˜ï¼ˆæœ€å¸¸è§é”™è¯¯ï¼80% çš„é—®é¢˜éƒ½æ˜¯è¿™ä¸ªï¼ï¼‰**ï¼š\n   - âŒ **ç¦æ­¢**ï¼šåœ¨ \`$(function() {})\` å†…éƒ¨ç”¨ \`let\`/\`const\`/\`function\` å®šä¹‰å˜é‡å’Œå‡½æ•°\n   - âœ… **æ­£ç¡®**ï¼šæ‰€æœ‰å˜é‡å’Œå‡½æ•°éƒ½åœ¨**å…¨å±€ä½œç”¨åŸŸ**å®šä¹‰ï¼Œ\`$(function() {})\` åªç”¨äºè°ƒç”¨\n   - **éªŒè¯æ–¹æ³•**ï¼šåœ¨åˆå§‹åŒ–æ—¶æ‰“å° \`console.log(typeof chatHistory)\`ï¼Œåº”è¯¥æ˜¯ \`'object'\` è€Œé \`'undefined'\`\n\n1.5. **ç¦æ­¢å†™æ¨¡æ‹Ÿ/å‡å›å¤ï¼ˆå¸¸è§å¤šä½™ä»£ç ï¼ï¼‰**ï¼š\n   - âŒ **ç¦æ­¢**ï¼š\`chatHistory.push({ role: 'assistant', content: 'è¿™æ˜¯æ¨¡æ‹Ÿå›å¤' });\`\n   - âŒ **ç¦æ­¢**ï¼š\`chatHistory.push({ role: 'assistant', content: 'è¿™æ˜¯ AI çš„å›å¤' });\`\n   - âŒ **ç¦æ­¢**ï¼šä»»ä½•ç¡¬ç¼–ç çš„å‡ AI å›å¤\n   - âœ… **æ­£ç¡®**ï¼šåªè°ƒç”¨ \`generate()\`ï¼ŒAI å›å¤é€šè¿‡ \`STREAM_TOKEN_RECEIVED_FULLY\` äº‹ä»¶è‡ªåŠ¨æ¥æ”¶\n   - **åŸå› **ï¼š\`generate()\` ä¼šçœŸæ­£è°ƒç”¨ AI APIï¼Œä¸éœ€è¦å†™å‡å›å¤æ¥æµ‹è¯•\n\n2. **generation_id çš„æ­£ç¡®ç”¨æ³•ï¼ˆéå¸¸é‡è¦ï¼ï¼‰**ï¼š\n   - âŒ é”™è¯¯ï¼š\`const result = await generate(...); const id = result.generation_id;\`\n   - âœ… æ­£ç¡®ï¼š\n     \`\`\`javascript\n     const myId = 'chat-' + Date.now() + '-' + Math.random().toString(36).slice(2);\n     await generate({ user_input: text, generation_id: myId });\n     // ç›‘å¬å™¨ä¸­çš„ id å‚æ•°å°±æ˜¯ myId\n     \`\`\`\n   - \`generate()\` è¿”å› \`Promise<string>\`ï¼Œä¸è¿”å›å¯¹è±¡ï¼\n   - å¿…é¡»è‡ªå·±ç”Ÿæˆå”¯ä¸€ ID å¹¶ä¼ å…¥ï¼Œä¸æ˜¯ä»è¿”å›å€¼è·å–ï¼\n\n3. **è¿™æ˜¯å‰ç«¯ç•Œé¢é¡¹ç›®ï¼Œä¸æ˜¯æ¶ˆæ¯æ¥¼å±‚åµŒå…¥ï¼**\n   - éœ€è¦åˆ›å»º \`index.html\` + \`index.ts\`ï¼ˆå‰ç«¯ç•Œé¢é¡¹ç›®ï¼‰\n   - ç©å®¶åœ¨ç•Œé¢å†…æ¸¸ç©ï¼Œä¸çœ‹é…’é¦†ä¸»èŠå¤©\n   - åå°å¯ç”¨ \`setChatMessages(..., { refresh: 'none' })\` æ“ä½œæ¶ˆæ¯ä½†ä¸åˆ·æ–°\n\n4. **å‡½æ•°å‘½åå¿…é¡»é¿å…å†²çª**ï¼š\n   - âŒ ç¦æ­¢ä½¿ç”¨ \`sendChatMessage\`ï¼ˆä¸é…’é¦†åŸç”Ÿå‡½æ•°é‡åï¼ï¼‰\n   - âŒ ç¦æ­¢ä½¿ç”¨ \`generate\`ã€\`getChatMessages\` ç­‰é…’é¦† API åä½œä¸ºå‡½æ•°å\n   - âœ… ä½¿ç”¨å¸¦å‰ç¼€çš„åç§°ï¼š\`handleSend\`ã€\`innerSendMessage\`ã€\`sendInnerMessage\`\n   - **åŸå› **ï¼šé‡åä¼šå¯¼è‡´è°ƒç”¨é…’é¦†å†…éƒ¨å‡½æ•° \`sk()\` ç­‰ï¼Œå¼•å‘é”™è¯¯\n\n5. **å…ƒç´  ID å¿…é¡»å”¯ä¸€**ï¼š\n   - ä½¿ç”¨ \`inner-\` ç­‰å‰ç¼€é¿å…ä¸é…’é¦†å†²çª\n   - ä¸è¦ç”¨ \`send-button\`ã€\`user-input\` ç­‰å¸¸è§åç§°\n   - **éªŒè¯æ–¹æ³•**ï¼šæ£€æŸ¥ \`$('#inner-messages').length\` åº”è¯¥æ˜¯ 1ï¼Œä¸æ˜¯ 0\n\n6. **æµå¼ä¼ è¾“ç›‘å¬ï¼ˆæ ¸å¿ƒï¼æœ€å®¹æ˜“å‡ºé”™ï¼ï¼‰**ï¼š\n   - âš ï¸ **äº‹ä»¶åï¼šä½¿ç”¨å¸¸é‡ \`iframe_events.XXX\`ï¼Œä¸è¦ç”¨å­—ç¬¦ä¸² \`'iframe_events.XXX'\`**\n   - âš ï¸ **å›è°ƒå‚æ•°ï¼šæ˜¯ \`(text, id)\`ï¼Œä¸æ˜¯ \`(data)\`ï¼ç›´æ¥ç”¨ \`text\` ä¸è¦ç”¨ \`data.text\`**\n   - âš ï¸ **å¿…é¡»å¯ç”¨æµå¼ï¼š\`generate({ user_input: text, should_stream: true, generation_id: myId })\`**\n   - ä½¿ç”¨ \`eventOn(iframe_events.STREAM_TOKEN_RECEIVED_FULLY, (text, id) => ...)\` è·å–å®Œæ•´å›å¤\n   - ä½¿ç”¨ \`eventOn(iframe_events.STREAM_TOKEN_RECEIVED_INCREMENTALLY, (text, id) => ...)\` è·å–å¢é‡æ›´æ–°\n\n7. **API ä½¿ç”¨è§„èŒƒ**ï¼š\n   - âœ… \`generate(prompt)\`ï¼šåŒ…å«è§’è‰²å¡ã€é¢„è®¾ã€ä¸–ç•Œä¹¦ï¼ˆæ¨èï¼ï¼‰\n   - âœ… \`generateRaw(prompt)\`ï¼šçº¯æ–‡æœ¬ç”Ÿæˆï¼Œä¸ä½¿ç”¨é¢„è®¾\n   - ä¸¤è€…éƒ½ä¼šè§¦å‘æµå¼ä¼ è¾“äº‹ä»¶\n\n8. **æ•°æ®æŒä¹…åŒ–**ï¼š\n   - æ¨èä½¿ç”¨ \`getVariables({ type: 'chat' })\` å’Œ \`insertOrAssignVariables(data, { type: 'chat' })\`\n   - æˆ–ä½¿ç”¨æ¶ˆæ¯æ¥¼å±‚å˜é‡ï¼š\`{ type: 'message', message_id }\`\n   - é¡µé¢å¸è½½æ—¶å¿…é¡»ä¿å­˜æ•°æ®\n\n**æ ¸å¿ƒç¤ºä¾‹ï¼ˆå¿…é¡»ä¸¥æ ¼éµå®ˆï¼ï¼‰ï¼š**\n\`\`\`javascript\n// ========== âš ï¸ å…³é”®ï¼šæµå¼äº‹ä»¶ç›‘å¬ï¼ˆæœ€å®¹æ˜“å‡ºé”™ï¼ï¼‰==========\n\n// âŒâŒâŒ é”™è¯¯å†™æ³•ï¼ˆç¦æ­¢ï¼ï¼‰ï¼š\n// eventOn('iframe_events.STREAM_TOKEN_RECEIVED_FULLY', (data) => { ... })\n// âŒ ä¸è¦ç”¨å­—ç¬¦ä¸² 'iframe_events.XXX'\n// âŒ ä¸è¦ç”¨å‚æ•° (data)\n\n// âœ…âœ…âœ… æ­£ç¡®å†™æ³•ï¼ˆå¿…é¡»è¿™æ ·å†™ï¼ï¼‰ï¼š\neventOn(iframe_events.STREAM_TOKEN_RECEIVED_INCREMENTALLY, (text, id) => {\n  // text æ˜¯ç´¯ç§¯çš„å®Œæ•´æ–‡æœ¬\n  $('#ai-reply').text(text); // âœ… ç›´æ¥ç”¨ textï¼Œä¸æ˜¯ text.text æˆ– data.text\n  console.log('å¢é‡æ›´æ–°:', text);\n});\n\neventOn(iframe_events.STREAM_TOKEN_RECEIVED_FULLY, (text, id) => {\n  // text æ˜¯æœ€ç»ˆå®Œæ•´æ–‡æœ¬\n  console.log('âœ… ç”Ÿæˆå®Œæˆ:', text); // âœ… ç›´æ¥ç”¨ text\n  chatHistory.push({ role: 'assistant', content: text });\n  saveChatHistory();\n  isGenerating = false;\n  $('#send-btn').prop('disabled', false).text('å‘é€');\n});\n\n// å¤‡é€‰æ–¹æ¡ˆï¼šå¦‚æœæµå¼ä¸å·¥ä½œï¼Œç”¨ GENERATION_ENDED\neventOn(iframe_events.GENERATION_ENDED, (text, id) => {\n  console.log('âœ… ç”Ÿæˆç»“æŸ:', text);\n  chatHistory.push({ role: 'assistant', content: text });\n  saveChatHistory();\n  isGenerating = false;\n  $('#send-btn').prop('disabled', false).text('å‘é€');\n});\n\n// ========== å‘é€æ¶ˆæ¯ ==========\nasync function handleSend() {\n  const userInput = $('#user-input').val();\n  chatHistory.push({ role: 'user', content: userInput });\n\n  isGenerating = true;\n  $('#send-btn').prop('disabled', true).text('ç”Ÿæˆä¸­...');\n\n  // âœ…âœ…âœ… å¿…é¡»è¿™æ ·è°ƒç”¨ï¼ˆä½¿ç”¨ STScript å‘½ä»¤ï¼‰ï¼š\n  const command = '/gen lock=on "' + userInput.replace(/"/g, '\\\\"') + '"';\n  const result = await triggerSlashWithResult(command);\n\n  if (result) {\n    chatHistory.push({ role: 'assistant', content: result });\n    renderMessages();\n  }\n\n  // âŒâŒâŒ ç¦æ­¢ä½¿ç”¨ generate APIï¼š\n  // await generate({ user_input: userInput });  // âŒ ä¸æ¨è\n}\n\`\`\`\n\n**ä¸ºä»€ä¹ˆç”¨ triggerSlashWithResultï¼Ÿ**\n- ä½¿ç”¨ \`/gen\` å‘½ä»¤ä¼šè‡ªåŠ¨åº”ç”¨è§’è‰²å¡ã€é¢„è®¾ã€ä¸–ç•Œä¹¦\n- è¿”å›å€¼ç›´æ¥æ˜¯ç”Ÿæˆçš„æ–‡æœ¬ï¼Œç®€å•ç›´æ¥\n- ä¸éœ€è¦å¤æ‚çš„æµå¼ç›‘å¬å’Œ generation_id ç®¡ç†\n\n**\`/gen\` å‘½ä»¤è¯´æ˜ï¼š**\n- \`/gen lock=on "æç¤ºè¯"\`ï¼šç”Ÿæˆæ—¶é”å®šè¾“å…¥æ¡†ï¼ˆæ¨èï¼ï¼‰\n- ä¼šè‡ªåŠ¨ä½¿ç”¨å½“å‰è§’è‰²å¡ã€é¢„è®¾ã€ä¸–ç•Œä¹¦\n- è¿”å›å€¼æ˜¯ AI ç”Ÿæˆçš„å®Œæ•´æ–‡æœ¬\n\n---\n\n# ğŸŒŠ åŒå±‚å¯¹è¯çš„ä¸¤ç§å®ç°æ–¹å¼ï¼ˆAI è‡ªåŠ¨é€‰æ‹©ï¼‰\n\nå½“ç”¨æˆ·éœ€æ±‚ä¸­æåˆ°**"å®æ—¶æ˜¾ç¤º"ã€"æ‰“å­—æ•ˆæœ"ã€"æµå¼"ã€"è¾¹ç”Ÿæˆè¾¹æ˜¾ç¤º"**æ—¶ï¼Œä½¿ç”¨**çœŸæµå¼æ–¹æ¡ˆ**ï¼ˆæ–¹æ¡ˆBï¼‰ã€‚\nå¦åˆ™ï¼Œä½¿ç”¨**ç®€å•æ–¹æ¡ˆ**ï¼ˆæ–¹æ¡ˆAï¼‰ã€‚\n\n## âš ï¸âš ï¸âš ï¸ å¿…é¡»åŒ…å«çš„æ ¸å¿ƒåŠŸèƒ½ï¼ˆä¸¤ç§æ–¹æ¡ˆéƒ½è¦æœ‰ï¼ï¼‰\n\n### 1. æ•°æ®æŒä¹…åŒ–ï¼ˆæœ€é‡è¦ï¼ï¼‰\n- âœ… **ä¿å­˜åˆ°èŠå¤©å˜é‡**ï¼šä½¿ç”¨ \`insertOrAssignVariables({ inner_chat_history: chatHistory }, { type: 'chat' })\`\n- âœ… **é¡µé¢åŠ è½½æ—¶æ¢å¤**ï¼šåœ¨ \`$(function() {})\` ä¸­è°ƒç”¨ \`loadChatHistory()\`\n- âœ… **åˆ‡æ¢èŠå¤©æ—¶é‡æ–°åŠ è½½**ï¼šç›‘å¬ \`SillyTavern.getCurrentChatId()\` å˜åŒ–\n- âœ… **é¡µé¢å¸è½½æ—¶ä¿å­˜**ï¼šåœ¨ \`$(window).on('pagehide', ...)\` ä¸­ä¿å­˜\n- âœ… **å®æ—¶ä¿å­˜**ï¼šæ¯æ¬¡å‘é€/æ¥æ”¶æ¶ˆæ¯åç«‹å³è°ƒç”¨ \`saveChatHistory()\`\n\n### 2. ä¸æ‰“æ–­ç”Ÿæˆï¼ˆå…³é”®ï¼ï¼‰\n- âœ… **æœ€å°åŒ–é¢æ¿ä¸æ‰“æ–­**ï¼šé¢æ¿åªæ˜¯éšè—ï¼ˆ\`display: none\`ï¼‰ï¼Œiframe ä¸å¸è½½\n- âœ… **åˆ‡æ¢æ ‡ç­¾é¡µä¸æ‰“æ–­**ï¼šæ•°æ®å·²ä¿å­˜åˆ°å˜é‡ï¼Œåˆ‡æ¢å›æ¥è‡ªåŠ¨æ¢å¤\n- âœ… **åˆ·æ–°é¡µé¢åæ¢å¤**ï¼šä»èŠå¤©å˜é‡è¯»å– \`chatHistory\`ï¼Œå®Œæ•´æ¢å¤å¯¹è¯\n\n### 3. è·¨èŠå¤©éš”ç¦»\n- âœ… **æ¯ä¸ªèŠå¤©ç‹¬ç«‹**ï¼šæ•°æ®å­˜å‚¨åœ¨ \`{ type: 'chat' }\`ï¼Œä¸åŒèŠå¤©æ–‡ä»¶æ•°æ®äº’ä¸å½±å“\n- âœ… **åˆ‡æ¢èŠå¤©è‡ªåŠ¨åˆ‡æ¢æ•°æ®**ï¼šç›‘å¬ \`getCurrentChatId()\` å˜åŒ–ï¼Œè‡ªåŠ¨åŠ è½½å¯¹åº”èŠå¤©çš„å†å²\n\n## ğŸ“š ç®€å•æ–¹æ¡ˆï¼ˆtriggerSlashWithResultï¼‰\n\n**ç‰¹ç‚¹ï¼š** ä»£ç ç®€å•ï¼Œç­‰å¾…å®Œæ•´ç”Ÿæˆåä¸€æ¬¡æ€§æ˜¾ç¤ºã€‚\n\n**å®Œæ•´å®ç°ï¼ˆåŒ…å«æ•°æ®æŒä¹…åŒ–ï¼ï¼‰ï¼š**\n\n\`\`\`typescript\n// ===== 1. å…¨å±€å˜é‡ï¼ˆå¿…é¡»åœ¨å…¨å±€ä½œç”¨åŸŸï¼ï¼‰=====\nlet chatHistory: Array<{ role: string; content: string }> = [];\nlet isGenerating = false;\n\n// ===== 2. æ•°æ®æŒä¹…åŒ– =====\nfunction loadChatHistory() {\n  const isInTavern = typeof getVariables === 'function';\n  if (!isInTavern) {\n    const saved = localStorage.getItem('inner_chat_history');\n    chatHistory = saved ? JSON.parse(saved) : [];\n  } else {\n    const data = getVariables({ type: 'chat' });\n    chatHistory = data?.inner_chat_history || [];\n  }\n  renderMessages();\n}\n\nfunction saveChatHistory() {\n  const isInTavern = typeof insertOrAssignVariables === 'function';\n  if (!isInTavern) {\n    localStorage.setItem('inner_chat_history', JSON.stringify(chatHistory));\n  } else {\n    insertOrAssignVariables({ inner_chat_history: chatHistory }, { type: 'chat' });\n  }\n}\n\n// ===== 3. æ­£åˆ™è¿‡æ»¤ï¼ˆæ ¸å¿ƒï¼ï¼‰=====\nfunction applyRegexFilters(text: string): string {\n  console.log('ğŸ” å¼€å§‹æ¸…ç†ï¼ŒåŸå§‹é•¿åº¦:', text.length);\n\n  if (!text || typeof text !== 'string') return '';\n\n  // ===== æ­¥éª¤ 0: ä¿®å¤æœªé—­åˆçš„æ ‡ç­¾ =====\n  const criticalTags = ['thinking', 'UpdateVariable', 'guide', 'plot', 'status', 'dream', 'gametxt'];\n  criticalTags.forEach(tag => {\n    const openTagRegex = new RegExp(\\\`<\\\${tag}([^>]*)>\\\`, 'gi');\n    const closeTagRegex = new RegExp(\\\`</\\\${tag}>\\\`, 'gi');\n\n    const openMatches = text.match(openTagRegex);\n    const closeMatches = text.match(closeTagRegex);\n\n    const openCount = openMatches ? openMatches.length : 0;\n    const closeCount = closeMatches ? closeMatches.length : 0;\n\n    if (openCount > closeCount) {\n      const missing = openCount - closeCount;\n      console.log(\\\`âš ï¸ å‘ç° \\\${missing} ä¸ªæœªé—­åˆçš„ <\\\${tag}> æ ‡ç­¾ï¼Œè‡ªåŠ¨è¡¥é½\\\`);\n      text = text + \\\`</\\\${tag}>\\\`.repeat(missing);\n    }\n  });\n\n  // ===== æ­¥éª¤ 1: ä¼˜å…ˆæå–æ­£æ–‡æ ‡ç­¾ï¼ˆæ¢¦æ˜Ÿæ–¹æ¡ˆï¼‰=====\n  function extractLastTagContent(tagName: string, text: string): string | null {\n    if (!text || typeof text !== 'string') return null;\n\n    const endTag = \\\`</\\\${tagName}>\\\`;\n    const searchPool = text.toLowerCase();\n    const endTagPattern = endTag.toLowerCase();\n\n    const lastEndIndex = searchPool.lastIndexOf(endTagPattern);\n    if (lastEndIndex !== -1) {\n      const startTag = \\\`<\\\${tagName}>\\\`;\n      const startTagPattern = startTag.toLowerCase();\n\n      const lastStartIndex = searchPool.lastIndexOf(startTagPattern, lastEndIndex);\n      if (lastStartIndex !== -1) {\n        const startIndex = lastStartIndex + startTag.length;\n        return text.substring(startIndex, lastEndIndex).trim();\n      }\n    }\n    return null;\n  }\n\n  const gameTextTags = ['dream', 'gametxt', 'output', 'display', 'text', 'content'];\n  for (const tag of gameTextTags) {\n    const extracted = extractLastTagContent(tag, text);\n    if (extracted !== null) {\n      console.log(\\\`âœ… æå–äº† <\\\${tag}> æ ‡ç­¾çš„å†…å®¹ï¼Œé•¿åº¦:\\\`, extracted.length);\n      return extracted;\n    }\n  }\n\n  // ===== æ­¥éª¤ 2: ç§»é™¤æ‰€æœ‰æ€ç»´é“¾æ ‡ç­¾ =====\n  let cleanedText = text;\n\n  const tagsToRemove = [\n    'guide', 'plot', 'status',\n    'UpdateVariable', 'è§’è‰²æå–', 'æœ¬ä¸–å†ç¨‹', 'å¾€ä¸–æ¶Ÿæ¼ª'\n  ];\n\n  tagsToRemove.forEach(tag => {\n    const regexWithContent = new RegExp(\\\`<\\\${tag}[^>]*>[\\\\\\\\s\\\\\\\\S]*?</\\\${tag}>\\\`, 'gi');\n    const before = cleanedText;\n    cleanedText = cleanedText.replace(regexWithContent, '');\n\n    const regexSelfClosing = new RegExp(\\\`<\\\${tag}\\\\\\\\s*\\\\\\\\/>\\\`, 'gi');\n    cleanedText = cleanedText.replace(regexSelfClosing, '');\n\n    if (before !== cleanedText) {\n      console.log(\\\`  ğŸ§¹ ç§»é™¤äº† <\\\${tag}> æ ‡ç­¾\\\`);\n    }\n  });\n\n  // ç‰¹æ®Šå¤„ç†ï¼šç§»é™¤æ‰€æœ‰åŒ…å« think/thinking çš„æ ‡ç­¾\n  const thinkingRegex = /<[^>]*think[^>]*>[\\\\s\\\\S]*?<\\\\/[^>]*think[^>]*>/gi;\n  const beforeThinking = cleanedText;\n  cleanedText = cleanedText.replace(thinkingRegex, '');\n  if (beforeThinking !== cleanedText) {\n    console.log('  ğŸ§¹ ç§»é™¤äº†åŒ…å« think/thinking çš„æ€ç»´é“¾æ ‡ç­¾');\n  }\n\n  const thinkingSelfClosing = /<[^>]*think[^>]*\\\\/>/gi;\n  cleanedText = cleanedText.replace(thinkingSelfClosing, '');\n\n  cleanedText = cleanedText.replace(/\x3c!--[\\s\\S]*?--\x3e/g, '');\n\n  if (cleanedText !== text) {\n    console.log('âœ… æ ‡ç­¾æ¸…ç†å®Œæˆï¼Œæ¸…ç†åé•¿åº¦:', cleanedText.length);\n    text = cleanedText;\n  }\n\n  // ===== æ­¥éª¤ 3: å°è¯•åº”ç”¨é…’é¦†æ­£åˆ™ï¼ˆå¯é€‰ï¼‰=====\n  let allRegexScripts: any[] = [];\n\n  if (typeof getRegexScripts === 'function') {\n    try {\n      const globalRegexes = getRegexScripts();\n      if (globalRegexes && globalRegexes.length > 0) {\n        console.log('ğŸ“‹ ä»å…¨å±€æ­£åˆ™è·å–åˆ°', globalRegexes.length, 'ä¸ªè„šæœ¬');\n        allRegexScripts = allRegexScripts.concat(globalRegexes);\n      }\n    } catch (e) {\n      console.warn('âš ï¸ è·å–å…¨å±€æ­£åˆ™å¤±è´¥:', e);\n    }\n  }\n\n  try {\n    const parentST = (window as any).parent?.SillyTavern || (window as any).SillyTavern;\n    if (parentST && typeof parentST.getContext === 'function') {\n      const context = parentST.getContext();\n      const prompts = context?.chatCompletionSettings?.prompts;\n\n      if (prompts && Array.isArray(prompts)) {\n        const possibleIdentifiers = ['regexes-bindings', 'SPresetSettings', 'regex-bindings'];\n\n        for (const identifier of possibleIdentifiers) {\n          const regexPrompt = prompts.find((p: any) => p.identifier === identifier);\n          if (regexPrompt?.content) {\n            try {\n              const data = JSON.parse(regexPrompt.content);\n              let presetRegexes: any = null;\n\n              if (Array.isArray(data)) {\n                presetRegexes = data;\n              } else if (data && typeof data === 'object') {\n                if (data.RegexBinding?.regexes && Array.isArray(data.RegexBinding.regexes)) {\n                  presetRegexes = data.RegexBinding.regexes;\n                } else if (data.regexes && Array.isArray(data.regexes)) {\n                  presetRegexes = data.regexes;\n                }\n              }\n\n              if (presetRegexes && presetRegexes.length > 0) {\n                console.log('ğŸ“‹ ä»é¢„è®¾å†…ç½®æ­£åˆ™è·å–åˆ°', presetRegexes.length, 'ä¸ªè„šæœ¬ (identifier:', identifier + ')');\n                allRegexScripts = allRegexScripts.concat(presetRegexes);\n                break;\n              }\n            } catch (parseError) {\n              console.warn('âš ï¸ è§£æ identifier', identifier, 'å¤±è´¥:', parseError);\n            }\n          }\n        }\n      }\n    }\n  } catch (e) {\n    console.warn('âš ï¸ è·å–é¢„è®¾å†…ç½®æ­£åˆ™å¤±è´¥:', e);\n  }\n\n  if (allRegexScripts.length > 0) {\n    console.log('ğŸ“‹ æ€»å…±è·å–åˆ°', allRegexScripts.length, 'ä¸ªæ­£åˆ™è„šæœ¬');\n\n    const activeScripts = allRegexScripts.filter((script: any) => {\n      if (script.disabled) return false;\n      if (!script.placement || !Array.isArray(script.placement)) return false;\n      if (!script.placement.includes(2)) return false;\n      return true;\n    });\n\n    console.log('âœ… æ‰¾åˆ°', activeScripts.length, 'ä¸ªé€‚ç”¨çš„æ­£åˆ™è„šæœ¬');\n\n    let result = text;\n    activeScripts.forEach((script: any, index: number) => {\n      try {\n        const regex = new RegExp(script.findRegex, 'gim');\n        const beforeLength = result.length;\n        result = result.replace(regex, script.replaceString || '');\n\n        if (beforeLength !== result.length) {\n          console.log('ğŸ§¹ æ­£åˆ™', index + 1, '(', script.scriptName, ') ç”Ÿæ•ˆ');\n        }\n      } catch (e) {\n        console.error('âŒ æ­£åˆ™', index + 1, 'åº”ç”¨å¤±è´¥:', e);\n      }\n    });\n\n    text = result;\n  }\n\n  console.log('ğŸ“Š æœ€ç»ˆé•¿åº¦:', text.length);\n  return text;\n}\n\n// ===== 4. å‘é€æ¶ˆæ¯ =====\nasync function handleSend() {\n  const input = $('#inner-input');\n  const userInput = input.val().trim();\n  if (!userInput || isGenerating) return;\n\n  chatHistory.push({ role: 'user', content: userInput });\n  input.val('');\n  saveChatHistory();\n  renderMessages();\n\n  isGenerating = true;\n  $('#inner-send-btn').prop('disabled', true).text('ç”Ÿæˆä¸­...');\n\n  try {\n    if (typeof triggerSlashWithResult !== 'function') {\n      throw new Error('è¯·åœ¨é…’é¦†ä¸­ä½¿ç”¨æ­¤åŠŸèƒ½');\n    }\n\n    const userName = SillyTavern?.name1 || 'You';\n    const charName = SillyTavern?.name2 || 'AI';\n\n    let fullPrompt = '';\n    if (chatHistory.length > 1) {\n      fullPrompt += 'ã€å¯¹è¯å†å²ã€‘\\n';\n      chatHistory.slice(0, -1).forEach((msg) => {\n        const name = msg.role === 'user' ? userName : charName;\n        fullPrompt += name + ': ' + msg.content + '\\n';\n      });\n      fullPrompt += '\\n';\n    }\n    fullPrompt += userName + ': ' + userInput;\n\n    console.log('ğŸš€ å¼€å§‹ç”Ÿæˆï¼Œæç¤ºè¯é•¿åº¦:', fullPrompt.length);\n\n    const command = '/gen lock=on "' + fullPrompt.replace(/"/g, '\\\\"') + '"';\n    const result = await triggerSlashWithResult(command);\n\n    console.log('ğŸ“¥ AI è¿”å›å€¼é•¿åº¦:', result ? result.length : 0);\n\n    if (result && result.length > 0) {\n      const cleanedResult = applyRegexFilters(result);\n      console.log('ğŸ§¹ æ­£åˆ™è¿‡æ»¤åé•¿åº¦:', cleanedResult.length);\n\n      chatHistory.push({ role: 'assistant', content: cleanedResult });\n      saveChatHistory();\n      renderMessages();\n      toastr.success('å›å¤æˆåŠŸ');\n    } else {\n      toastr.warning('AI æœªè¿”å›å†…å®¹');\n    }\n\n  } catch (error) {\n    console.error('ç”Ÿæˆå¤±è´¥:', error);\n    toastr.error('ç”Ÿæˆå¤±è´¥: ' + (error?.message || String(error)));\n  } finally {\n    isGenerating = false;\n    $('#inner-send-btn').prop('disabled', false).text('å‘é€');\n  }\n}\n\n// ===== 5. æ¸²æŸ“æ¶ˆæ¯ =====\nfunction renderMessages() {\n  const container = $('#inner-messages');\n  container.empty();\n\n  chatHistory.forEach((msg, index) => {\n    const name = msg.role === 'user'\n      ? (typeof getCurrentUser === 'function' ? getCurrentUser()?.name : null) || '{{user}}'\n      : (typeof getCurrentCharacter === 'function' ? getCurrentCharacter()?.name : null) || '{{char}}';\n\n    const msgDiv = $('<div>')\n      .addClass('message')\n      .addClass(msg.role === 'user' ? 'user-message' : 'ai-message')\n      .html('<strong>' + name + ':</strong> ' + msg.content);\n    container.append(msgDiv);\n  });\n\n  container.scrollTop(container[0].scrollHeight);\n}\n\n// ===== 6. ç›‘å¬èŠå¤©åˆ‡æ¢ï¼ˆé‡è¦ï¼ï¼‰=====\nlet currentChatId = SillyTavern.getCurrentChatId();\nif (typeof eventOn === 'function') {\n  eventOn('CHAT_CHANGED', (newChatId: string) => {\n    if (currentChatId !== newChatId) {\n      console.log('ğŸ”„ æ£€æµ‹åˆ°èŠå¤©åˆ‡æ¢:', currentChatId, '->', newChatId);\n      currentChatId = newChatId;\n\n      // é‡æ–°åŠ è½½æ–°èŠå¤©çš„å†å²\n      loadChatHistory();\n\n      // é‡ç½®ç”ŸæˆçŠ¶æ€ï¼ˆå¦‚æœæ­£åœ¨ç”Ÿæˆï¼Œä¼šè¢«æ‰“æ–­ï¼‰\n      if (isGenerating) {\n        isGenerating = false;\n        $('#inner-send-btn').prop('disabled', false).text('å‘é€');\n        console.log('âš ï¸ åˆ‡æ¢èŠå¤©ï¼Œå·²ä¸­æ–­ç”Ÿæˆ');\n      }\n    }\n  });\n}\n\n// ===== 7. åˆå§‹åŒ– =====\n$(function() {\n  console.log('âœ… åŒå±‚å¯¹è¯åˆå§‹åŒ–å¼€å§‹ï¼ˆæ–¹æ¡ˆAï¼‰');\n  console.log('ğŸ“Š å½“å‰èŠå¤© ID:', currentChatId);\n\n  // åŠ è½½èŠå¤©å†å²ï¼ˆä»èŠå¤©å˜é‡æ¢å¤ï¼‰\n  loadChatHistory();\n\n  $('#inner-send-btn').on('click', handleSend);\n  $('#inner-input').on('keypress', (e) => {\n    if (e.key === 'Enter' && !e.shiftKey) {\n      e.preventDefault();\n      handleSend();\n    }\n  });\n\n  $('#inner-clear-btn').on('click', () => {\n    if (confirm('ç¡®å®šæ¸…ç©ºå¯¹è¯å†å²ï¼Ÿ')) {\n      chatHistory = [];\n      renderMessages();\n      saveChatHistory();\n    }\n  });\n\n  console.log('âœ… åŒå±‚å¯¹è¯åˆå§‹åŒ–å®Œæˆï¼ˆæ–¹æ¡ˆAï¼‰');\n  console.log('ğŸ’¾ å·²åŠ è½½', chatHistory.length, 'æ¡å†å²æ¶ˆæ¯');\n});\n\n// ===== 8. å¸è½½æ—¶ä¿å­˜ =====\n$(window).on('pagehide', () => {\n  console.log('ğŸ’¾ é¡µé¢å¸è½½ï¼Œä¿å­˜æ•°æ®');\n  saveChatHistory();\n});\n\`\`\`\n\n---\n\n## ğŸŒŠ çœŸæµå¼æ–¹æ¡ˆï¼ˆgenerate + äº‹ä»¶ç›‘å¬ï¼‰\n\n**ç‰¹ç‚¹ï¼š** å®æ—¶æ˜¾ç¤º AI æ‰“å­—æ•ˆæœï¼Œä½“éªŒæœ€ä½³ã€‚\n\n**å®Œæ•´å®ç°ï¼š**\n\n\`\`\`typescript\n// ===== 1. å…¨å±€å˜é‡ï¼ˆå¿…é¡»åœ¨å…¨å±€ä½œç”¨åŸŸï¼ï¼‰=====\nlet chatHistory: Array<{ role: string; content: string }> = [];\nlet isGenerating = false;\nlet currentGenerationId: string | null = null;\n\n// ===== 2. æ•°æ®æŒä¹…åŒ–ï¼ˆä¸æ–¹æ¡ˆAç›¸åŒï¼‰=====\nfunction loadChatHistory() {\n  const isInTavern = typeof getVariables === 'function';\n  if (!isInTavern) {\n    const saved = localStorage.getItem('inner_chat_history');\n    chatHistory = saved ? JSON.parse(saved) : [];\n  } else {\n    const data = getVariables({ type: 'chat' });\n    chatHistory = data?.inner_chat_history || [];\n  }\n  renderMessages();\n}\n\nfunction saveChatHistory() {\n  const isInTavern = typeof insertOrAssignVariables === 'function';\n  if (!isInTavern) {\n    localStorage.setItem('inner_chat_history', JSON.stringify(chatHistory));\n  } else {\n    insertOrAssignVariables({ inner_chat_history: chatHistory }, { type: 'chat' });\n  }\n}\n\n// ===== 3. æ­£åˆ™è¿‡æ»¤ï¼ˆä¸æ–¹æ¡ˆAç›¸åŒï¼‰=====\nfunction applyRegexFilters(text: string): string {\n  // ... ä¸æ–¹æ¡ˆAå®Œå…¨ç›¸åŒï¼Œæ­¤å¤„çœç•¥ ...\n  // ï¼ˆè¯·å¤åˆ¶æ–¹æ¡ˆAä¸­çš„ applyRegexFilters å®Œæ•´å®ç°ï¼‰\n  return text;\n}\n\n// ===== 4. çœŸæµå¼ç›‘å¬ï¼ˆæ ¸å¿ƒï¼ï¼‰=====\nfunction setupStreamListeners() {\n  // âš ï¸ ç›‘å¬å¢é‡æ–‡æœ¬ï¼ˆå®æ—¶æ›´æ–°ï¼‰\n  eventOn(iframe_events.STREAM_TOKEN_RECEIVED_INCREMENTALLY, (text: string, id: string) => {\n    if (!isGenerating || id !== currentGenerationId) return;\n\n    console.log('ğŸ“¥ æ”¶åˆ°å¢é‡æ–‡æœ¬ï¼Œé•¿åº¦:', text.length);\n\n    // âš ï¸ å®æ—¶æ¸…ç†æ ‡ç­¾\n    const cleanedText = applyRegexFilters(text);\n\n    // æ›´æ–° DOM\n    const container = $('#inner-messages');\n    const charName = (typeof getCurrentCharacter === 'function' ? getCurrentCharacter()?.name : null) || '{{char}}';\n    const lastMsg = container.find('.message:last-child');\n\n    if (lastMsg.length && lastMsg.hasClass('ai-message')) {\n      // æ›´æ–°å·²æœ‰çš„ AI æ¶ˆæ¯\n      lastMsg.html('<strong>' + charName + ':</strong> <span class="streaming">' + cleanedText + '</span>');\n    } else {\n      // åˆ›å»ºæ–°çš„ AI æ¶ˆæ¯\n      const msgDiv = $('<div>')\n        .addClass('message ai-message')\n        .html('<strong>' + charName + ':</strong> <span class="streaming">' + cleanedText + '</span>');\n      container.append(msgDiv);\n    }\n\n    // è‡ªåŠ¨æ»šåŠ¨åˆ°åº•éƒ¨\n    container.scrollTop(container[0].scrollHeight);\n  });\n\n  // âš ï¸ ç›‘å¬ç”Ÿæˆå®Œæˆ\n  eventOn(iframe_events.GENERATION_ENDED, (text: string, id: string) => {\n    if (id === currentGenerationId) {\n      console.log('âœ… æµå¼ç”Ÿæˆå®Œæˆï¼Œé•¿åº¦:', text.length);\n\n      // âš ï¸ æœ€åæ¸…ç†ä¸€æ¬¡å†ä¿å­˜\n      const cleanedText = applyRegexFilters(text);\n\n      // ä¿å­˜åˆ°èŠå¤©å†å²\n      chatHistory.push({ role: 'assistant', content: cleanedText });\n      saveChatHistory();\n\n      // é‡æ–°æ¸²æŸ“ï¼ˆç§»é™¤å…‰æ ‡æ•ˆæœï¼‰\n      renderMessages();\n\n      // é‡ç½®çŠ¶æ€\n      isGenerating = false;\n      currentGenerationId = null;\n      $('#inner-send-btn').prop('disabled', false).text('å‘é€');\n\n      toastr.success('å›å¤å®Œæˆ');\n    }\n  });\n}\n\n// ===== 5. å‘é€æ¶ˆæ¯ï¼ˆçœŸæµå¼ç‰ˆæœ¬ï¼‰=====\nasync function handleSend() {\n  const input = $('#inner-input');\n  const userInput = input.val().trim();\n  if (!userInput || isGenerating) return;\n\n  // æ·»åŠ ç”¨æˆ·æ¶ˆæ¯\n  chatHistory.push({ role: 'user', content: userInput });\n  input.val('');\n  saveChatHistory();\n  renderMessages();\n\n  // ç”Ÿæˆå”¯ä¸€ ID\n  currentGenerationId = 'chat-' + Date.now() + '-' + Math.random().toString(36).slice(2);\n\n  // è®¾ç½®ç”ŸæˆçŠ¶æ€\n  isGenerating = true;\n  $('#inner-send-btn').prop('disabled', true).text('ç”Ÿæˆä¸­...');\n\n  try {\n    if (typeof generate !== 'function') {\n      throw new Error('è¯·åœ¨é…’é¦†ä¸­ä½¿ç”¨æ­¤åŠŸèƒ½');\n    }\n\n    console.log('ğŸš€ å¼€å§‹ç”Ÿæˆï¼ˆçœŸæµå¼ï¼‰ï¼Œgeneration_id:', currentGenerationId);\n\n    // âš ï¸ æ ¸å¿ƒï¼šè°ƒç”¨ generate å¹¶å¯ç”¨æµå¼\n    await generate({\n      user_input: userInput,\n      should_stream: true,           // âš ï¸ å¿…é¡»å¯ç”¨æµå¼\n      generation_id: currentGenerationId,  // âš ï¸ å¿…é¡»ä¼ å…¥ ID\n      overrides: {\n        chat_history: {\n          prompts: chatHistory.map(msg => ({\n            role: msg.role === 'user' ? 'user' : 'assistant',\n            content: msg.content\n          }))\n        }\n      }\n    });\n\n    // æ³¨æ„ï¼šå®é™…çš„æ–‡æœ¬æ›´æ–°æ˜¯é€šè¿‡äº‹ä»¶ç›‘å¬å™¨å®æ—¶æ›´æ–°çš„\n    // GENERATION_ENDED äº‹ä»¶ä¼šè‡ªåŠ¨ä¿å­˜ AI å›å¤åˆ°å†å²\n\n  } catch (error) {\n    console.error('âŒ ç”Ÿæˆå¤±è´¥:', error);\n    toastr.error('ç”Ÿæˆå¤±è´¥: ' + (error?.message || String(error)));\n\n    // é‡ç½®çŠ¶æ€\n    isGenerating = false;\n    currentGenerationId = null;\n    $('#inner-send-btn').prop('disabled', false).text('å‘é€');\n  }\n}\n\n// ===== 6. æ¸²æŸ“æ¶ˆæ¯ï¼ˆä¸æ–¹æ¡ˆAç›¸åŒï¼‰=====\nfunction renderMessages() {\n  const container = $('#inner-messages');\n  container.empty();\n\n  chatHistory.forEach((msg, index) => {\n    const name = msg.role === 'user'\n      ? (typeof getCurrentUser === 'function' ? getCurrentUser()?.name : null) || '{{user}}'\n      : (typeof getCurrentCharacter === 'function' ? getCurrentCharacter()?.name : null) || '{{char}}';\n\n    const msgDiv = $('<div>')\n      .addClass('message')\n      .addClass(msg.role === 'user' ? 'user-message' : 'ai-message')\n      .html('<strong>' + name + ':</strong> ' + msg.content);\n    container.append(msgDiv);\n  });\n\n  container.scrollTop(container[0].scrollHeight);\n}\n\n// ===== 7. ç›‘å¬èŠå¤©åˆ‡æ¢ï¼ˆé‡è¦ï¼ï¼‰=====\nlet currentChatId = SillyTavern.getCurrentChatId();\nif (typeof eventOn === 'function') {\n  eventOn('CHAT_CHANGED', (newChatId: string) => {\n    if (currentChatId !== newChatId) {\n      console.log('ğŸ”„ æ£€æµ‹åˆ°èŠå¤©åˆ‡æ¢:', currentChatId, '->', newChatId);\n      currentChatId = newChatId;\n\n      // é‡æ–°åŠ è½½æ–°èŠå¤©çš„å†å²\n      loadChatHistory();\n\n      // é‡ç½®ç”ŸæˆçŠ¶æ€ï¼ˆå¦‚æœæ­£åœ¨ç”Ÿæˆï¼Œä¼šè¢«æ‰“æ–­ï¼‰\n      if (isGenerating) {\n        isGenerating = false;\n        currentGenerationId = null;\n        $('#inner-send-btn').prop('disabled', false).text('å‘é€');\n        console.log('âš ï¸ åˆ‡æ¢èŠå¤©ï¼Œå·²ä¸­æ–­ç”Ÿæˆ');\n      }\n    }\n  });\n}\n\n// ===== 8. åˆå§‹åŒ– =====\n$(function() {\n  console.log('âœ… åŒå±‚å¯¹è¯åˆå§‹åŒ–å¼€å§‹ï¼ˆæ–¹æ¡ˆB - çœŸæµå¼ï¼‰');\n  console.log('ğŸ“Š å½“å‰èŠå¤© ID:', currentChatId);\n\n  // åŠ è½½èŠå¤©å†å²ï¼ˆä»èŠå¤©å˜é‡æ¢å¤ï¼‰\n  loadChatHistory();\n\n  // è®¾ç½®æµå¼ç›‘å¬ï¼ˆâš ï¸ å¿…é¡»åœ¨åŠ è½½æ—¶å°±è®¾ç½®ï¼‰\n  setupStreamListeners();\n\n  $('#inner-send-btn').on('click', handleSend);\n  $('#inner-input').on('keypress', (e) => {\n    if (e.key === 'Enter' && !e.shiftKey) {\n      e.preventDefault();\n      handleSend();\n    }\n  });\n\n  $('#inner-clear-btn').on('click', () => {\n    if (confirm('ç¡®å®šæ¸…ç©ºå¯¹è¯å†å²ï¼Ÿ')) {\n      chatHistory = [];\n      renderMessages();\n      saveChatHistory();\n    }\n  });\n\n  console.log('âœ… åŒå±‚å¯¹è¯åˆå§‹åŒ–å®Œæˆï¼ˆæ–¹æ¡ˆBï¼‰');\n  console.log('ğŸ’¾ å·²åŠ è½½', chatHistory.length, 'æ¡å†å²æ¶ˆæ¯');\n});\n\n// ===== 9. å¸è½½æ—¶ä¿å­˜ =====\n$(window).on('pagehide', () => {\n  console.log('ğŸ’¾ é¡µé¢å¸è½½ï¼Œä¿å­˜æ•°æ®');\n  saveChatHistory();\n});\n\`\`\`\n\n**CSS æ ·å¼ï¼ˆä¸ºæ–¹æ¡ˆBæ·»åŠ å…‰æ ‡æ•ˆæœï¼‰ï¼š**\n\n\`\`\`css\n.streaming {\n  border-right: 2px solid #165DFF;\n  padding-right: 4px;\n  animation: blink 1s infinite;\n}\n\n@keyframes blink {\n  0%, 50% { border-right-color: #165DFF; }\n  51%, 100% { border-right-color: transparent; }\n}\n\`\`\`\n\n---\n\n## ğŸ¤– AI é€‰æ‹©ç­–ç•¥\n\n**åˆ†æç”¨æˆ·éœ€æ±‚æè¿°ï¼Œè‡ªåŠ¨é€‰æ‹©åˆé€‚æ–¹æ¡ˆï¼š**\n\n1. **ä½¿ç”¨çœŸæµå¼æ–¹æ¡ˆï¼ˆç¬¬äºŒç§ï¼‰**ï¼Œå¦‚æœç”¨æˆ·æåˆ°ï¼š\n   - "å®æ—¶æ˜¾ç¤º"ã€"è¾¹ç”Ÿæˆè¾¹æ˜¾ç¤º"\n   - "æ‰“å­—æ•ˆæœ"ã€"æµå¼"\n   - "ä¸æƒ³ç­‰å¾…"ã€"å³æ—¶åé¦ˆ"\n   - æˆ–æ˜ç¡®è¦æ±‚åŒå±‚å¯¹è¯\n\n2. **ä½¿ç”¨ç®€å•æ–¹æ¡ˆï¼ˆç¬¬ä¸€ç§ï¼‰**ï¼Œå¦‚æœï¼š\n   - ç”¨æˆ·æ²¡æœ‰æ˜ç¡®è¦æ±‚æµå¼æ˜¾ç¤º\n   - æˆ–ç”¨æˆ·è¯´"ç®€å•çš„å¯¹è¯ç•Œé¢"\n\n**âš ï¸ é»˜è®¤æ¨èï¼š** å½“ç”¨æˆ·æåˆ°"åŒå±‚å¯¹è¯"æ—¶ï¼Œé»˜è®¤ä½¿ç”¨**çœŸæµå¼æ–¹æ¡ˆ**ï¼ˆä½“éªŒæ›´å¥½ï¼‰ã€‚\n\n## éœ€æ±‚æ”¶é›†ä¸ç•Œé¢è®¾è®¡å¼•å¯¼ï¼ˆé‡è¦ï¼ï¼‰\n\n**å½“ç”¨æˆ·éœ€æ±‚ä¸å¤Ÿè¯¦ç»†æ—¶ï¼Œå¿…é¡»å…ˆå¼•å¯¼ç”¨æˆ·è¡¥å……ä¿¡æ¯ï¼Œä¸è¦ç«‹å³ç”Ÿæˆä»£ç ï¼**\n\n### AI äº¤äº’æµç¨‹ï¼ˆå¿…é¡»éµå®ˆï¼‰\n\n**æ­¥éª¤1ï¼šæ£€æŸ¥ç”¨æˆ·éœ€æ±‚æ˜¯å¦å®Œæ•´**\n\næ£€æŸ¥ç”¨æˆ·æ˜¯å¦æ˜ç¡®äº†ä»¥ä¸‹å†…å®¹ï¼š\n- ç•Œé¢å¸ƒå±€ï¼ˆå¯¹è¯æ¡†ã€è¾“å…¥åŒºåŸŸã€åŠŸèƒ½åŒºçš„æ’å¸ƒï¼‰\n- é…è‰²æ–¹æ¡ˆï¼ˆæ·±è‰²/æµ…è‰²æ¨¡å¼ã€ä¸»è‰²è°ƒï¼‰\n- ç‰¹æ®Šæ•ˆæœï¼ˆåŠ¨ç”»ã€è¿‡æ¸¡æ•ˆæœï¼‰\n- é¢å¤–åŠŸèƒ½ï¼ˆæ–‡ä»¶ä¸Šä¼ ã€è¯­éŸ³è¾“å…¥ã€æ¶ˆæ¯ç¼–è¾‘ç­‰ï¼‰\n\n**æ­¥éª¤2ï¼šæ ¹æ®éœ€æ±‚å®Œæ•´åº¦å†³å®šè¾“å‡º**\n\n### æƒ…å†µAï¼šéœ€æ±‚ä¸å®Œæ•´ï¼ˆç”¨æˆ·åªè¯´äº†"åŒå±‚å¯¹è¯"ã€"æµå¼å¯¹è¯"ç­‰æ ¸å¿ƒåŠŸèƒ½ï¼‰\n\n**ä¸è¦ç«‹å³ç”Ÿæˆä»£ç ï¼åº”è¯¥å…ˆå¼•å¯¼ç”¨æˆ·è¡¥å……éœ€æ±‚ï¼**\n\nè¾“å‡ºæ ¼å¼ï¼š\n\`\`\`\nFILE_START: NEED_MORE_INFO\n\nä½ å¥½ï¼æˆ‘çœ‹åˆ°ä½ æƒ³è¦åˆ›å»ºä¸€ä¸ªå¯¹è¯å‰ç«¯ç•Œé¢ï¼Œæ ¸å¿ƒåŠŸèƒ½åŒ…æ‹¬ï¼š\n- çœŸæµå¼ä¼ è¾“ï¼ˆå®æ—¶æ˜¾ç¤º AI ç”Ÿæˆï¼‰\n- æ¶ˆæ¯å†å²è‡ªåŠ¨ç®¡ç†ï¼ˆä¿å­˜åˆ°èŠå¤©å˜é‡ï¼‰\n- æ­£æ–‡æ ‡ç­¾å®æ—¶æ¸…ç†ï¼ˆè¿‡æ»¤æ€ç»´é“¾ç­‰ï¼‰\n\nä½†æ˜¯ï¼Œä¸ºäº†ç»™ä½ ç”Ÿæˆæœ€ç¬¦åˆéœ€æ±‚çš„ç•Œé¢ï¼Œæˆ‘éœ€è¦äº†è§£æ›´å¤šç»†èŠ‚ï¼š\n\n**1. ç•Œé¢å¸ƒå±€**\n- å¯¹è¯æ¡†çš„ä½ç½®å’Œå¤§å°ï¼Ÿ\n- è¾“å…¥åŒºåŸŸæ”¾åœ¨åº•éƒ¨è¿˜æ˜¯å…¶ä»–ä½ç½®ï¼Ÿ\n- æ˜¯å¦éœ€è¦ä¾§è¾¹æ ã€é¡¶éƒ¨æ æˆ–åº•éƒ¨åŠŸèƒ½åŒºï¼Ÿ\n- æ¶ˆæ¯åˆ—è¡¨å¦‚ä½•æ»šåŠ¨ï¼ˆè‡ªåŠ¨æ»šåŠ¨åˆ°åº•éƒ¨ï¼Ÿï¼‰\n\n**2. é…è‰²æ–¹æ¡ˆ**\n- åå¥½æ·±è‰²æ¨¡å¼è¿˜æ˜¯æµ…è‰²æ¨¡å¼ï¼Ÿ\n- ä¸»è‰²è°ƒåå¥½ï¼ˆè“è‰²ã€ç»¿è‰²ã€ç´«è‰²ç­‰ï¼‰ï¼Ÿ\n- ç”¨æˆ·æ¶ˆæ¯å’Œ AI æ¶ˆæ¯å¦‚ä½•åŒºåˆ†é¢œè‰²ï¼Ÿ\n\n**3. ç‰¹æ®Šæ•ˆæœ**\n- æ˜¯å¦éœ€è¦åŠ¨ç”»æ•ˆæœï¼ˆæ·¡å…¥æ·¡å‡ºã€æ»‘åŠ¨ç­‰ï¼‰ï¼Ÿ\n- æ¶ˆæ¯å‡ºç°æ—¶çš„è¿‡æ¸¡æ•ˆæœï¼Ÿ\n- æŒ‰é’®ç‚¹å‡»ã€è¾“å…¥æ¡†èšç„¦çš„äº¤äº’åé¦ˆï¼Ÿ\n\n**4. é¢å¤–åŠŸèƒ½**\n- æ˜¯å¦éœ€è¦æ–‡ä»¶ä¸Šä¼ åŠŸèƒ½ï¼Ÿ\n- æ˜¯å¦éœ€è¦è¯­éŸ³è¾“å…¥ï¼Ÿ\n- æ˜¯å¦éœ€è¦æ¶ˆæ¯ç¼–è¾‘/åˆ é™¤åŠŸèƒ½ï¼Ÿ\n- æ˜¯å¦éœ€è¦æ¸…ç©ºå†å²æŒ‰é’®ï¼Ÿ\n- æ˜¯å¦éœ€è¦æ­£åˆ™é¢„è®¾åˆ‡æ¢ï¼ˆä¸‹æ‹‰èœå•æˆ–æŒ‰é’®ç»„ï¼‰ï¼Ÿ\n\n---\n\n**åœ¨ä½ æä¾›è¿™äº›è¯¦ç»†ä¿¡æ¯ä¹‹å‰ï¼Œæˆ‘å…ˆè¯´æ˜ä¸€ä¸‹æ ¸å¿ƒåŠŸèƒ½çš„å®ç°åŸç†ï¼š**\n\n### æ ¸å¿ƒç»„ä»¶ç»“æ„\n\nä¸€ä¸ªåŸºæœ¬çš„å¯¹è¯ç•Œé¢åŒ…å«ï¼š\n\n1. **æ¶ˆæ¯æ˜¾ç¤ºåŒº**ï¼šç”¨äºæ¸²æŸ“æ‰€æœ‰å†å²æ¶ˆæ¯å’Œæ­£åœ¨è¿›è¡Œçš„æµå¼æ¶ˆæ¯ï¼Œæ”¯æŒæ»šåŠ¨æ˜¾ç¤º\n2. **æ¶ˆæ¯è¾“å…¥åŒº**ï¼šç”¨æˆ·è¾“å…¥æ–‡æœ¬çš„åŒºåŸŸï¼Œé€šå¸¸åŒ…å«å‘é€æŒ‰é’®\n3. **åŠŸèƒ½æ§åˆ¶åŒº**ï¼ˆå¯é€‰ï¼‰ï¼šåˆ‡æ¢æ­£åˆ™é¢„è®¾ã€æ¸…é™¤å†å²ç­‰åŠŸèƒ½æŒ‰é’®\n\n### çœŸæµå¼å¯¹è¯çš„å®ç°æœºåˆ¶\n\n**æµç¨‹ï¼š**\n1. ç”¨æˆ·å‘é€æ¶ˆæ¯ â†’ è°ƒç”¨ \`generate({ should_stream: true, generation_id })\`\n2. ç›‘å¬ \`iframe_events.STREAM_TOKEN_RECEIVED_INCREMENTALLY\` äº‹ä»¶å®æ—¶æ¥æ”¶æ–‡æœ¬ç‰‡æ®µ\n3. æ¯æ¥æ”¶ä¸€ä¸ªç‰‡æ®µ â†’ æ¸…ç†æ ‡ç­¾ â†’ é™„åŠ åˆ°æ˜¾ç¤ºåŒºï¼ˆå½¢æˆæ‰“å­—æœºæ•ˆæœï¼‰\n4. æµå¼ç»“æŸ â†’ ä¿å­˜å®Œæ•´çš„æ¸…ç†åæ¶ˆæ¯åˆ° \`chatHistory\` â†’ æŒä¹…åŒ–åˆ°èŠå¤©å˜é‡\n\n**å…³é”®ç‚¹ï¼š**\n- ä½¿ç”¨ \`generation_id\` è¿‡æ»¤äº‹ä»¶ï¼ˆé¿å…æ¥æ”¶å…¶ä»–å¯¹è¯çš„æ¶ˆæ¯ï¼‰\n- å®æ—¶æ¸…ç†æ ‡ç­¾ï¼ˆ\`applyRegexFilters\`ï¼‰é˜²æ­¢æ€ç»´é“¾æš´éœ²\n- ç¦ç”¨å‘é€æŒ‰é’®é˜²æ­¢ç”¨æˆ·é‡å¤å‘é€\n\n### æ¶ˆæ¯å†å²è‡ªåŠ¨ä¿å­˜\n\n**æ•°æ®ç»“æ„ï¼š**\n\`\`\`javascript\nlet chatHistory = [\n  { role: 'user', content: 'ç”¨æˆ·æ¶ˆæ¯', timestamp: '...' },\n  { role: 'assistant', content: 'AIå›å¤ï¼ˆå·²æ¸…ç†æ ‡ç­¾ï¼‰', timestamp: '...' }\n];\n\`\`\`\n\n**ä¿å­˜æ—¶æœºï¼š**\n- ç”¨æˆ·æ¶ˆæ¯ï¼šç‚¹å‡»å‘é€åç«‹å³ä¿å­˜\n- AI æ¶ˆæ¯ï¼šæµå¼ä¼ è¾“å®Œæˆåï¼Œæ¸…ç†æ ‡ç­¾å†ä¿å­˜\n\n**æŒä¹…åŒ–ï¼š**\nä½¿ç”¨ \`insertOrAssignVariables({ inner_chat_history: chatHistory }, { type: 'chat' })\` ä¿å­˜åˆ°èŠå¤©å˜é‡\n\n### æ­£æ–‡æ ‡ç­¾å®æ—¶æ¸…ç†\n\n**\`applyRegexFilters\` å‡½æ•°çš„æ ¸å¿ƒé€»è¾‘ï¼š**\n1. è‡ªåŠ¨è¡¥é½æœªé—­åˆçš„æ ‡ç­¾ï¼ˆé˜²æ­¢"å‰ç«¯å¤±è¸ª"ï¼‰\n2. ä¼˜å…ˆæå–æ­£æ–‡æ ‡ç­¾ï¼ˆ\`<dream>\`ã€\`<gametxt>\` ç­‰ï¼‰\n3. ç§»é™¤æ€ç»´é“¾æ ‡ç­¾ï¼ˆ\`<think>\`ã€\`<guide>\`ã€\`<plot>\` ç­‰ï¼‰\n4. åº”ç”¨é…’é¦†å…¨å±€æ­£åˆ™å’Œé¢„è®¾æ­£åˆ™\n\n**è°ƒç”¨æ—¶æœºï¼š**\n- æµå¼æ¥æ”¶æ—¶ï¼šæ¯ä¸ªç‰‡æ®µéƒ½æ¸…ç†åå†æ˜¾ç¤º\n- ä¿å­˜æ—¶ï¼šå®Œæ•´æ¶ˆæ¯æ¸…ç†åå†ä¿å­˜åˆ°å†å²\n\n---\n\n**è¯·è¡¥å……ä¸Šè¿°ç»†èŠ‚ï¼Œæˆ‘ä¼šä¸ºä½ ç”Ÿæˆå®Œæ•´çš„ä»£ç ï¼**\n\nå¦‚æœä½ ç°åœ¨ä¸æƒ³çº ç»“è¿™äº›ç»†èŠ‚ï¼Œä¹Ÿå¯ä»¥ç›´æ¥è¯´"ç”¨é»˜è®¤è®¾è®¡"ï¼Œæˆ‘ä¼šä½¿ç”¨ä»¥ä¸‹é»˜è®¤é…ç½®ï¼š\n- æ·±è‰²æ¨¡å¼ï¼ˆèƒŒæ™¯ #1a1a1aï¼‰\n- ç”¨æˆ·æ¶ˆæ¯ï¼šå³å¯¹é½è“è‰²ï¼ˆ#4a9effï¼‰\n- AI æ¶ˆæ¯ï¼šå·¦å¯¹é½ç°è‰²ï¼ˆ#3a3a3aï¼‰\n- åœ†è§’è®¾è®¡ + åŸºç¡€åŠ¨ç”»\n- è‡ªåŠ¨æ»šåŠ¨åˆ°åº•éƒ¨\n\nFILE_END\n\`\`\`\n\n### æƒ…å†µBï¼šéœ€æ±‚å®Œæ•´ï¼ˆç”¨æˆ·æä¾›äº†è¯¦ç»†çš„ç•Œé¢è®¾è®¡éœ€æ±‚ï¼‰\n\n**ç›´æ¥ç”Ÿæˆä»£ç ï¼**\n\nè¾“å‡ºæ ¼å¼ï¼š\n\`\`\`\nFILE_START: index.html\n[å®Œæ•´çš„ HTML ä»£ç ]\nFILE_END\n\nFILE_START: style.css\n[å®Œæ•´çš„ CSS ä»£ç ]\nFILE_END\n\nFILE_START: script.js\n[å®Œæ•´çš„ JavaScript ä»£ç ]\nFILE_END\n\`\`\`\n\n### æƒ…å†µCï¼šç”¨æˆ·æ˜ç¡®è¯´"ç”¨é»˜è®¤è®¾è®¡"æˆ–"ç®€å•çš„å¯¹è¯ç•Œé¢å°±è¡Œ"\n\n**ä½¿ç”¨é»˜è®¤è®¾è®¡è§„èŒƒç”Ÿæˆä»£ç **\n\n**é»˜è®¤ç•Œé¢è®¾è®¡è§„èŒƒï¼š**\n- æ·±è‰²æ¨¡å¼ï¼ˆèƒŒæ™¯ #1a1a1aï¼Œæ¶ˆæ¯åŒº #2a2a2aï¼‰\n- ç”¨æˆ·æ¶ˆæ¯ï¼šå³å¯¹é½ï¼Œè“è‰²èƒŒæ™¯ï¼ˆ#4a9effï¼‰\n- AI æ¶ˆæ¯ï¼šå·¦å¯¹é½ï¼Œç°è‰²èƒŒæ™¯ï¼ˆ#3a3a3aï¼‰\n- åœ†è§’è®¾è®¡ï¼ˆborder-radius: 12pxï¼‰\n- åŸºç¡€è¿‡æ¸¡åŠ¨ç”»ï¼ˆfadeIn/fadeOutï¼‰\n- è‡ªåŠ¨æ»šåŠ¨åˆ°åº•éƒ¨\n- æ¸…ç©ºå†å²æŒ‰é’®\n- åŸºç¡€çš„æ¶ˆæ¯åˆ—è¡¨å’Œè¾“å…¥æ¡†\n\n---\n\n### æ­£åˆ™é¢„è®¾åˆ‡æ¢åŠŸèƒ½ï¼ˆå¯é€‰ï¼‰\n\nå¦‚æœç”¨æˆ·æ˜ç¡®éœ€è¦æ”¯æŒä¸åŒçš„æ­£åˆ™æ¸…ç†é¢„è®¾ï¼š\n\n\`\`\`typescript\n// å®šä¹‰æ­£åˆ™é¢„è®¾\nconst regexPresets = {\n  "é»˜è®¤æ¸…ç†": [\n    { pattern: /<tag1>/g, replacement: "" },\n    { pattern: /\\[tag2\\]/g, replacement: "" },\n  ],\n  "ç‰¹æ®Šæ ¼å¼æ¸…ç†": [\n    { pattern: /\\{\\{some_meta_data\\}\\}/g, replacement: "" },\n  ]\n};\n\nlet currentPreset = "é»˜è®¤æ¸…ç†";\n\nfunction applyRegexFilters(text: string, presetName?: string): string {\n  const preset = presetName || currentPreset;\n  const rules = regexPresets[preset] || regexPresets["é»˜è®¤æ¸…ç†"];\n\n  let cleanedText = text;\n  rules.forEach(rule => {\n    cleanedText = cleanedText.replace(rule.pattern, rule.replacement);\n  });\n\n  // ä»ç„¶åº”ç”¨é…’é¦†çš„å…¨å±€æ­£åˆ™\n  // ... åŸæœ‰é€»è¾‘ ...\n\n  return cleanedText;\n}\n\nfunction switchPreset(presetName: string) {\n  currentPreset = presetName;\n  renderMessages(); // é‡æ–°æ¸²æŸ“åº”ç”¨æ–°é¢„è®¾\n}\n\`\`\`\n\n**ç•Œé¢å®ç°ï¼š**åœ¨é¡¶éƒ¨æ·»åŠ ä¸‹æ‹‰èœå•æˆ–æŒ‰é’®ç»„åˆ‡æ¢é¢„è®¾\n\n---\n\n# è¾“å‡ºæ ¼å¼ï¼ˆå¿…é¡»ä¸¥æ ¼éµå®ˆï¼‰ï¼š\nåªåœ¨ FILE_START å’Œ FILE_END ä¹‹é—´è¾“å‡ºä»£ç ï¼Œä¸è¦æ·»åŠ ä»»ä½•å…¶ä»–æ–‡å­—ã€‚\n\n**ç¤ºä¾‹ï¼ˆåˆ›å»ºç•Œé¢æ—¶å¿…é¡»è¾“å‡ºä¸‰ä¸ªæ–‡ä»¶ï¼‰ï¼š**\n\nFILE_START: index.html\n[å®Œæ•´çš„ HTML ä»£ç ï¼ŒåŒ…å« headã€bodyã€å¼•ç”¨ CSS å’Œ JS]\nFILE_END\n\nFILE_START: style.css\n[å®Œæ•´çš„ CSS æ ·å¼ä»£ç ]\nFILE_END\n\nFILE_START: script.js\n[å®Œæ•´çš„ JavaScript ä»£ç ï¼Œä½¿ç”¨ jQuery]\nFILE_END\n\n**âš ï¸ ä»£ç è§„èŒƒï¼ˆå¿…é¡»éµå®ˆï¼‰ï¼š**\n1. **å‡½æ•°å‘½å**ï¼šå¿…é¡»ä½¿ç”¨å”¯ä¸€å‰ç¼€ï¼ˆå¦‚ \`inner\`ã€\`my\`ï¼‰ï¼Œé¿å…ä¸é…’é¦†å‡½æ•°é‡å\n   - âŒ ç¦æ­¢ï¼š\`sendChatMessage\`ã€\`generate\`ã€\`getChatMessages\`\n   - âœ… æ­£ç¡®ï¼š\`innerSendMessage\`ã€\`handleSendMessage\`ã€\`sendInnerMessage\`\n2. **å…ƒç´  ID**ï¼šå¿…é¡»ä½¿ç”¨å”¯ä¸€å‰ç¼€ï¼ˆå¦‚ \`inner-\`ã€\`my-\`ï¼‰\n   - âŒ ç¦æ­¢ï¼š\`#send-button\`ã€\`#user-input\`\n   - âœ… æ­£ç¡®ï¼š\`#inner-send-btn\`ã€\`#inner-user-input\`\n3. **æ¯ä¸ªæ–‡ä»¶éƒ½è¦è¾“å‡ºå®Œæ•´å†…å®¹ï¼Œä¸èƒ½çœç•¥ï¼**\n\n# ğŸ”‘ æ ¸å¿ƒåŸåˆ™ï¼šä¼˜å…ˆå¢é‡ä¿®æ”¹ï¼Œé¿å…é‡å†™ï¼\n**é™¤éç”¨æˆ·æ˜ç¡®è¦æ±‚"é‡å†™"ã€"ä»å¤´å¼€å§‹"ã€"é‡æ–°åˆ›å»º"ï¼Œå¦åˆ™å¿…é¡»åŸºäºç°æœ‰ä»£ç è¿›è¡Œæœ€å°åŒ–ä¿®æ”¹ï¼**\n\n- âœ… ç”¨æˆ·è¯´"æŠŠæŒ‰é’®æ”¹æˆç»¿è‰²" â†’ **åªè¾“å‡º style.css**ï¼ˆåªæ”¹é¢œè‰²ï¼‰\n- âœ… ç”¨æˆ·è¯´"æ·»åŠ ä¸€ä¸ªé‡ç½®åŠŸèƒ½" â†’ **åªè¾“å‡º script.js**ï¼ˆåªåŠ å‡½æ•°ï¼‰\n- âœ… ç”¨æˆ·è¯´"ä¿®å¤ç‚¹å‡»æ— å“åº”" â†’ **åªè¾“å‡º script.js**ï¼ˆåªæ”¹äº‹ä»¶ï¼‰\n- âŒ ç¦æ­¢ï¼šå› ä¸ºå°æ”¹åŠ¨å°±é‡å†™æ•´ä¸ªæ–‡ä»¶ï¼\n\n# è¾“å‡ºæ–‡ä»¶ç­–ç•¥ï¼š\n## å°æ”¹åŠ¨ï¼ˆåªè¾“å‡ºå¿…è¦çš„æ–‡ä»¶ï¼‰ï¼š\n- åªä¿®æ”¹é¢œè‰²/å­—ä½“/è¾¹è·/åŠ¨ç”» â†’ **åªè¾“å‡º style.css**\n- åªä¿®æ”¹ä¸€ä¸ªå‡½æ•°é€»è¾‘/ä¿®å¤ bug â†’ **åªè¾“å‡º script.js**\n- åªæ·»åŠ ä¸€ä¸ªæŒ‰é’®/è¾“å…¥æ¡† â†’ **åªè¾“å‡º index.html**\n- åªä¿®æ”¹æ–‡æ¡ˆ/æ ‡ç­¾å†…å®¹ â†’ **åªè¾“å‡º index.html**\n\n## å¤§æ”¹åŠ¨ï¼ˆè¾“å‡ºæ‰€æœ‰ç›¸å…³æ–‡ä»¶ï¼‰ï¼š\n- åˆ›å»ºæ–°ç•Œé¢/æ–°åŠŸèƒ½ â†’ **è¾“å‡º index.htmlã€style.cssã€script.js**\n- é‡æ„æ•´ä½“å¸ƒå±€/å®Œå…¨é‡è®¾è®¡ â†’ **è¾“å‡ºæ‰€æœ‰æ–‡ä»¶**\n- æ·»åŠ éœ€è¦æ–°æ ·å¼å’Œæ–°é€»è¾‘çš„å¤æ‚åŠŸèƒ½ â†’ **è¾“å‡ºç›¸å…³çš„æ‰€æœ‰æ–‡ä»¶**\n\n# å…¶ä»–è§„åˆ™ï¼š\n1. **âš ï¸ æ•°æ®æŒä¹…åŒ–ï¼šæ¶‰åŠç”¨æˆ·æ•°æ®å¿…é¡»ä½¿ç”¨ getVariables/insertOrAssignVariablesï¼**\n2. **âš ï¸ é¢„è§ˆå…¼å®¹ï¼šå¿…é¡»æ£€æµ‹ \`typeof SillyTavern !== 'undefined'\`ï¼Œé¢„è§ˆæ¨¡å¼ä¸‹ç”¨ localStorage æ›¿ä»£é…’é¦† API**\n3. å¿…é¡»è¾“å‡ºå®Œæ•´å†…å®¹ï¼Œå³ä½¿æ–‡ä»¶å¾ˆé•¿ä¹Ÿä¸èƒ½çœç•¥ï¼ˆä½†ä¼˜å…ˆåªè¾“å‡ºéœ€è¦ä¿®æ”¹çš„æ–‡ä»¶ï¼‰\n4. ä¸è¦åœ¨ä»£ç å¤–æ·»åŠ ä»»ä½•è§£é‡Šæ–‡å­—\n5. CSS è¦ç¾è§‚ä¸”ç¬¦åˆç°ä»£è®¾è®¡\n6. JavaScript ä½¿ç”¨ \`$(function() { ... })\` ç¡®ä¿ DOM åŠ è½½\n7. æ•°æ®å­˜å‚¨ï¼š\`{ type: 'chat' }\` ç»‘å®šèŠå¤©ï¼Œ\`{ type: 'global' }\` ä¸ºå…¨å±€\n8. ä¿æŒç°æœ‰ä»£ç çš„å‘½åé£æ ¼ã€ç¼©è¿›ã€æ ¼å¼ï¼Œä¸è¦éšæ„é‡æ„`,y=`# å½“å‰é¡¹ç›®æ–‡ä»¶ï¼š\n${e.files.map(e=>`=== ${e.path} ===\n${e.content}`).join('\n\n')}\n\n# ç”¨æˆ·éœ€æ±‚ï¼š\n${c.value}\n\n# âš ï¸ æ ¸å¿ƒæé†’ï¼š\n1. **ä¼˜å…ˆå¢é‡ä¿®æ”¹**ï¼šé™¤éç”¨æˆ·æ˜ç¡®è¦æ±‚é‡å†™ï¼Œå¦åˆ™åŸºäºç°æœ‰ä»£ç æœ€å°åŒ–ä¿®æ”¹\n2. **åªè¾“å‡ºéœ€è¦æ”¹çš„æ–‡ä»¶**ï¼šå°æ”¹åŠ¨åªè¾“å‡º 1 ä¸ªæ–‡ä»¶ï¼Œå¤§æ”¹åŠ¨æ‰è¾“å‡ºå¤šä¸ª\n3. **ä¿æŒä»£ç é£æ ¼ä¸€è‡´**ï¼šä¸è¦éšæ„é‡æ„ç°æœ‰ä»£ç \n4. **æ•°æ®æŒä¹…åŒ–**ï¼šä½¿ç”¨ getVariables/insertOrAssignVariables\n\nè¯·ä¸¥æ ¼æŒ‰ system ä¸­çš„æ ¼å¼è¾“å‡ºï¼Œä¸è¦æ·»åŠ è§£é‡Šï¼`;u.value='';let v='';if(k.value?.setProgress(25),k.value?.setMessage('æ­£åœ¨å‘é€è¯·æ±‚åˆ° AI æœåŠ¡å™¨...'),await new Promise(e=>setTimeout(e,100)),g.value){k.value?.setProgress(30),k.value?.setMessage('ç­‰å¾… AI æµå¼å“åº”...'),await new Promise(e=>setTimeout(e,100));const e=await fetch(t,{method:'POST',headers:{'Content-Type':'application/json',Authorization:`Bearer ${r}`},body:JSON.stringify({model:s,messages:[{role:'system',content:h},{role:'user',content:y}],temperature:i,max_tokens:b,stream:!0})});if(!e.ok){let n=`API è¯·æ±‚å¤±è´¥: ${e.status} ${e.statusText}`;try{const t=await e.json();console.error('API é”™è¯¯è¯¦æƒ…:',t),n+=`\n${JSON.stringify(t,null,2)}`}catch(e){console.error('æ— æ³•è§£æé”™è¯¯å“åº”')}throw new Error(n)}const n=e.body?.getReader(),a=new TextDecoder;if(!n)throw new Error('æ— æ³•è¯»å–å“åº”æµ');let o=0;for(;;){const{done:e,value:t}=await n.read();if(e)break;const r=a.decode(t,{stream:!0}).split('\n');for(const e of r)if(e.startsWith('data: ')){const n=e.slice(6);if('[DONE]'===n)continue;try{const e=JSON.parse(n),t=e.choices?.[0]?.delta?.content||'';if(t){v+=t,u.value+=t,o++;const e=Math.min(60,30+o/10);k.value?.setProgress(e),o%10==0&&k.value?.setMessage(`æ­£åœ¨æ¥æ”¶ AI å“åº”... (${v.length} å­—ç¬¦)`)}}catch(e){}}}}else{k.value?.setProgress(30),k.value?.setMessage('ç­‰å¾… AI å“åº”...'),await new Promise(e=>setTimeout(e,100));const e=await fetch(t,{method:'POST',headers:{'Content-Type':'application/json',Authorization:`Bearer ${r}`},body:JSON.stringify({model:s,messages:[{role:'system',content:h},{role:'user',content:y}],temperature:i,max_tokens:b})});if(!e.ok){let n=`API è¯·æ±‚å¤±è´¥: ${e.status} ${e.statusText}`;try{const t=await e.json();console.error('API é”™è¯¯è¯¦æƒ…:',t),n+=`\n${JSON.stringify(t,null,2)}`}catch(e){console.error('æ— æ³•è§£æé”™è¯¯å“åº”')}throw new Error(n)}k.value?.setProgress(60),k.value?.setMessage('æ­£åœ¨æ¥æ”¶ AI å“åº”...');const n=await e.json();v=n.choices?.[0]?.message?.content||''}if(k.value?.setProgress(75),k.value?.setMessage('æ­£åœ¨è§£æ AI ç”Ÿæˆçš„ä»£ç ...'),console.log('AI åŸå§‹å›å¤:',v),console.log('AI å›å¤é•¿åº¦:',v.length),!v||0===v.trim().length)throw new Error('AI è¿”å›å†…å®¹ä¸ºç©ºï¼Œè¯·æ£€æŸ¥ API é…ç½®æˆ–é‡è¯•');const A=[],C=/FILE_START:\s*(.+?)[\r\n]+([\s\S]*?)FILE_END/gi;let E;console.log('å¼€å§‹è§£æ AI è¿”å›å†…å®¹...');const T=v.match(/FILE_START:\s*NEED_MORE_INFO\s*[\r\n]+([\s\S]*?)FILE_END/i);if(T){const e=T[1].trim();return console.log('ğŸ¤– AI éœ€è¦æ›´å¤šä¿¡æ¯ï¼Œæ˜¾ç¤ºå¼•å¯¼å†…å®¹'),Q(),toastr.info('AI éœ€è¦æ›´å¤šä¿¡æ¯','',{timeOut:3e3}),alert(e),void(p.value=!1)}for(;null!==(E=C.exec(v));){const n=E[1].trim(),t=E[2].trim();console.log(`æ‰¾åˆ°æ–‡ä»¶: ${n}, å†…å®¹é•¿åº¦: ${t.length}`);const a=e.files.find(e=>e.path===n);a?A.push({path:n,oldContent:a.content,newContent:t}):console.warn(`æ–‡ä»¶ ${n} ä¸å­˜åœ¨äºé¡¹ç›®ä¸­ï¼Œå·²å¿½ç•¥`)}if(0===A.length){if(console.error('æœªèƒ½ä» AI å›å¤ä¸­è§£æå‡ºæ–‡ä»¶ä¿®æ”¹'),console.error('AI è¿”å›å†…å®¹é¢„è§ˆ:',v.substring(0,500)),v.length<500||!v.includes('FILE_END'))throw new Error(`AI è¿”å›å†…å®¹è¢«æˆªæ–­ï¼ˆä»… ${v.length} å­—ç¬¦ï¼‰ã€‚è¯·åœ¨"è®¾ç½®"ä¸­å¢åŠ  max_tokensï¼ˆå»ºè®® 4000 ä»¥ä¸Šï¼‰ï¼Œç„¶åé‡è¯•ã€‚`);throw new Error('AI æœªè¿”å›æœ‰æ•ˆçš„æ–‡ä»¶ä¿®æ”¹æ ¼å¼ã€‚è¯·ç¡®ä¿ AI è¿”å›çš„å†…å®¹åŒ…å« FILE_START å’Œ FILE_END æ ‡è®°ã€‚')}console.log('è§£æåˆ°çš„ä¿®æ”¹:',A.length,'ä¸ªæ–‡ä»¶'),k.value?.setProgress(85),k.value?.setMessage('æ­£åœ¨å‡†å¤‡å¯¹æ¯”é¢„è§ˆ...'),1===A.length&&'index.html'===A[0].path&&toastr.warning('AI å¯èƒ½åªç”Ÿæˆäº† HTMLï¼Œå»ºè®®é‡æ–°ç”Ÿæˆæˆ–æ‰‹åŠ¨è¡¥å…… CSS/JS');(v.trim().split('FILE_START').pop()||'').includes('FILE_END')||toastr.error('AI å›å¤å¯èƒ½è¢«æˆªæ–­ï¼Œå»ºè®®ç®€åŒ–éœ€æ±‚æˆ–é‡è¯•');const S={changes:A};if(!S.changes||!Array.isArray(S.changes))throw new Error('AI è¿”å›æ ¼å¼é”™è¯¯');f.value=S.changes,k.value?.setProgress(95),k.value?.setMessage(`æ­£åœ¨ç”Ÿæˆé¢„è§ˆ... (${A.length} ä¸ªæ–‡ä»¶)`),Q(),m.value=!0,x.value='after',k.value?.setProgress(100),k.value?.setMessage('âœ… AI ç”Ÿæˆå®Œæˆï¼'),setTimeout(()=>{w.value=!1,toastr.success(`âœ… AI ç”Ÿæˆå®Œæˆï¼å·²æ›´æ–° ${A.length} ä¸ªæ–‡ä»¶`)},800)}catch(e){console.error('AI ç”Ÿæˆå¤±è´¥:',e),w.value=!1;const n=e.message||String(e);n.includes('CORS')||n.includes('Failed to fetch')||n.includes('Access-Control-Allow-Origin')?toastr.error(`âš ï¸ CORS é”™è¯¯ï¼šæ— æ³•è®¿é—® API\n\nåŸå› ï¼šAPI æœåŠ¡å™¨ï¼ˆ${new URL(t).origin}ï¼‰æœªé…ç½® CORS å¤´\n\nè§£å†³æ–¹æ¡ˆï¼š\n1. åœ¨ API æœåŠ¡å™¨é…ç½® CORS\n2. æˆ–ä½¿ç”¨æ”¯æŒ CORS çš„ API ç«¯ç‚¹\n3. æˆ–é€šè¿‡é…’é¦†çš„ API ä»£ç†åŠŸèƒ½è°ƒç”¨`):n.includes('307')||n.includes('Temporary Redirect')?toastr.error(`âš ï¸ URL é‡å®šå‘é”™è¯¯\n\nç«¯ç‚¹ï¼š${t}\n\nå¯èƒ½åŸå› ï¼šURL æ ¼å¼ä¸æ­£ç¡®\nè¯·æ£€æŸ¥ç«¯ç‚¹è®¾ç½®ï¼Œç¡®ä¿æ ¼å¼ä¸ºï¼šhttps://æœåŠ¡å™¨/v1`):toastr.error(`AI ç”Ÿæˆå¤±è´¥: ${n}`)}finally{p.value=!1}}function ae(){const e=I.value;if(!e)return;const n={timestamp:(new Date).toISOString(),prompt:c.value,changes:f.value};if(y.value[t.value]||(y.value[t.value]=[]),y.value[t.value].unshift(n),console.log('æ·»åŠ  AI å†å²è®°å½•ï¼Œå½“å‰é¡¹ç›®å†å²æ•°:',y.value[t.value].length),f.value.forEach(n=>{const t=e.files.find(e=>e.path===n.path);t&&(t.content=n.newContent)}),J(),Y(),a.value){const n=e.files.find(e=>e.path===a.value);n&&(o.value=n.content)}m.value=!1,f.value=[],toastr.success('æ›´æ”¹å·²åº”ç”¨')}function oe(){m.value=!1,f.value=[],toastr.info('å·²æ‹’ç»æ›´æ”¹')}function re(){h.value=!0}function se(){h.value=!1}function ie(){const e=I.value;if(!e)return void toastr.error('è¯·å…ˆé€‰æ‹©ä¸€ä¸ªé¡¹ç›®');const n=e.files.find(e=>e.name===a.value);if(n&&o.value!==n.content){if(!confirm('æ£€æµ‹åˆ°æœ‰æœªä¿å­˜çš„ä¿®æ”¹ï¼Œå»ºè®®å…ˆæ‰‹åŠ¨ä¿å­˜ã€‚\n\næ˜¯å¦ç»§ç»­å¯¼å‡ºï¼ˆå°†ä½¿ç”¨ä¸Šæ¬¡ä¿å­˜çš„ç‰ˆæœ¬ï¼‰ï¼Ÿ'))return}const t=prompt(`æ­£åœ¨å¯¼å‡ºé¡¹ç›®ï¼š${e.name}\n\nè¯·è¾“å…¥è§¦å‘è¯ï¼ˆæ­£åˆ™è¡¨è¾¾å¼ï¼‰ï¼š\nä¾‹å¦‚ï¼šã€å¼€åœºç™½ã€‘ æˆ– /å¼€åœºç™½/g`,`ã€${e.name}ã€‘`);if(t)try{const n=G(e.files),a='xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g,function(e){const n=16*Math.random()|0;return('x'===e?n:3&n|8).toString(16)});let o=n.replace(/\r/g,'');o=o.replace(/^<!DOCTYPE html>\n/,'');const r={id:a,scriptName:e.name,findRegex:t.startsWith('/')?t:`/${t}/g`,replaceString:'```html\n\n'+o+'\n```',trimStrings:[],placement:[1,2],disabled:!1,markdownOnly:!0,promptOnly:!1,runOnEdit:!0,substituteRegex:0,minDepth:null,maxDepth:null},s=JSON.stringify(r,null,4),i=new Blob([s],{type:'application/json'}),l=URL.createObjectURL(i),d=document.createElement('a');d.href=l,d.download=`${e.name}_regex.json`,document.body.appendChild(d),d.click(),document.body.removeChild(d),URL.revokeObjectURL(l),console.log('å¯¼å‡ºçš„æ­£åˆ™ JSON:',r),toastr.success(`é¡¹ç›® "${e.name}" å·²å¯¼å‡ºä¸ºæ­£åˆ™ JSON`)}catch(e){console.error('å¯¼å‡ºå¤±è´¥:',e),toastr.error(`å¯¼å‡ºå¤±è´¥: ${e.message}`)}else toastr.info('å·²å–æ¶ˆå¯¼å‡º')}function le(){if(!r.value)return void toastr.error('æ²¡æœ‰å¯é¢„è§ˆçš„å†…å®¹');const e=I.value,n=e?e.name:'é¢„è§ˆ',t=window.open('','_blank','width=1200,height=800,menubar=no,toolbar=no,location=no,status=no');t?(t.document.write(r.value),t.document.close(),t.document.title=n,toastr.success('å·²åœ¨æ–°çª—å£æ‰“å¼€é¢„è§ˆ')):toastr.error('æ— æ³•æ‰“å¼€æ–°çª—å£ï¼Œè¯·æ£€æŸ¥æµè§ˆå™¨å¼¹çª—è®¾ç½®')}return(0,i.watch)(()=>[a.value,o.value],()=>{K&&clearTimeout(K),K=setTimeout(Y,500)},{deep:!0}),(0,i.onBeforeUnmount)(()=>{if(console.log('ç»„ä»¶å¸è½½ï¼Œä¿å­˜æ•°æ®...'),q&&clearTimeout(q),K&&clearTimeout(K),a.value&&void 0!==o.value){const e=I.value;if(e){const n=e.files.find(e=>e.path===a.value);n&&(n.content=o.value)}}J(),console.log('æ•°æ®å·²ä¿å­˜')}),(e,l)=>((0,i.openBlock)(),(0,i.createElementBlock)('div',ga,[(0,i.createCommentVNode)(' é¡¶éƒ¨æ“ä½œæ  '),(0,i.createElementVNode)('div',ua,[l[68]||(l[68]=(0,i.createElementVNode)('h3',{style:{margin:'0',color:'#fff','font-size':'16px !important','font-weight':'600',display:'flex','align-items':'center',gap:'12px','letter-spacing':'0.5px','text-shadow':'0 1px 2px rgba(0, 0, 0, 0.5)'}},[(0,i.createElementVNode)('i',{class:'fa-solid fa-laptop-code',style:{color:'#4a9eff','font-size':'18px'}}),(0,i.createTextVNode)(' å‰ç«¯é¡¹ç›®ç®¡ç†å™¨ ')],-1)),(0,i.createElementVNode)('div',ma,[t.value?((0,i.openBlock)(),(0,i.createElementBlock)('button',{key:0,style:{padding:'8px 16px',background:'#444',border:'none','border-radius':'8px',color:'#e0e0e0','font-size':'13px','font-weight':'500',cursor:'pointer',transition:'all 0.2s'},onClick:ie,onMouseenter:l[0]||(l[0]=e=>e.currentTarget.style.background='#555'),onMouseleave:l[1]||(l[1]=e=>e.currentTarget.style.background='#444')},[...l[61]||(l[61]=[(0,i.createElementVNode)('i',{class:'fa-solid fa-download',style:{'margin-right':'6px'}},null,-1),(0,i.createTextVNode)(' å¯¼å‡ºä¸ºæ­£åˆ™ ',-1)])],32)):(0,i.createCommentVNode)('v-if',!0),t.value?((0,i.openBlock)(),(0,i.createElementBlock)('button',{key:1,style:{padding:'8px 16px',background:'#444',border:'none','border-radius':'8px',color:'#e0e0e0','font-size':'13px','font-weight':'500',cursor:'pointer',transition:'all 0.2s'},onClick:re,onMouseenter:l[2]||(l[2]=e=>e.currentTarget.style.background='#555'),onMouseleave:l[3]||(l[3]=e=>e.currentTarget.style.background='#444')},[...l[62]||(l[62]=[(0,i.createElementVNode)('i',{class:'fa-solid fa-history',style:{'margin-right':'6px'}},null,-1),(0,i.createTextVNode)(' å†å²è®°å½• ',-1)])],32)):(0,i.createCommentVNode)('v-if',!0),t.value?((0,i.openBlock)(),(0,i.createElementBlock)('button',{key:2,style:{padding:'8px 16px',background:'#8b5cf6',border:'none','border-radius':'8px',color:'white','font-size':'13px','font-weight':'500',cursor:'pointer',transition:'all 0.2s'},onClick:X,onMouseenter:l[4]||(l[4]=e=>e.currentTarget.style.background='#7c3aed'),onMouseleave:l[5]||(l[5]=e=>e.currentTarget.style.background='#8b5cf6')},[...l[63]||(l[63]=[(0,i.createElementVNode)('i',{class:'fa-solid fa-wand-magic-sparkles',style:{'margin-right':'6px'}},null,-1),(0,i.createTextVNode)(' AI æ™ºèƒ½ç¼–å†™ ',-1)])],32)):(0,i.createCommentVNode)('v-if',!0),t.value?((0,i.openBlock)(),(0,i.createElementBlock)('button',{key:3,style:{padding:'8px 16px',background:'#ef4444',border:'none','border-radius':'8px',color:'white','font-size':'13px','font-weight':'500',cursor:'pointer',transition:'all 0.2s'},onClick:Z,onMouseenter:l[6]||(l[6]=e=>e.currentTarget.style.background='#dc2626'),onMouseleave:l[7]||(l[7]=e=>e.currentTarget.style.background='#ef4444')},[...l[64]||(l[64]=[(0,i.createElementVNode)('i',{class:'fa-solid fa-bug',style:{'margin-right':'6px'}},null,-1),(0,i.createTextVNode)(' Bug ä¿®å¤ ',-1)])],32)):(0,i.createCommentVNode)('v-if',!0),(0,i.createElementVNode)('button',{style:{padding:'8px 16px',background:'#444',border:'none','border-radius':'8px',color:'#e0e0e0','font-size':'13px','font-weight':'500',cursor:'pointer',transition:'all 0.2s'},onClick:P,onMouseenter:l[8]||(l[8]=e=>e.currentTarget.style.background='#555'),onMouseleave:l[9]||(l[9]=e=>e.currentTarget.style.background='#444')},[...l[65]||(l[65]=[(0,i.createElementVNode)('i',{class:'fa-solid fa-file-lines',style:{'margin-right':'6px'}},null,-1),(0,i.createTextVNode)(' ä½¿ç”¨æ¨¡æ¿ ',-1)])],32),(0,i.createElementVNode)('button',{style:{padding:'8px 16px',background:'#444',border:'none','border-radius':'8px',color:'#e0e0e0','font-size':'13px','font-weight':'500',cursor:'pointer',transition:'all 0.2s'},onClick:j,onMouseenter:l[10]||(l[10]=e=>e.currentTarget.style.background='#555'),onMouseleave:l[11]||(l[11]=e=>e.currentTarget.style.background='#444')},[...l[66]||(l[66]=[(0,i.createElementVNode)('i',{class:'fa-solid fa-folder-open',style:{'margin-right':'6px'}},null,-1),(0,i.createTextVNode)(' å¯¼å…¥æ–‡ä»¶å¤¹ ',-1)])],32),(0,i.createElementVNode)('button',{style:{padding:'8px 16px',background:'#10b981',border:'none','border-radius':'8px',color:'white','font-size':'13px','font-weight':'500',cursor:'pointer',transition:'all 0.2s'},onClick:O,onMouseenter:l[12]||(l[12]=e=>e.currentTarget.style.background='#059669'),onMouseleave:l[13]||(l[13]=e=>e.currentTarget.style.background='#10b981')},[...l[67]||(l[67]=[(0,i.createElementVNode)('i',{class:'fa-solid fa-plus',style:{'margin-right':'6px'}},null,-1),(0,i.createTextVNode)(' æ–°å»ºé¡¹ç›® ',-1)])],32)])]),(0,i.createCommentVNode)(' éšè—çš„æ–‡ä»¶å¤¹è¾“å…¥æ¡† '),(0,i.createElementVNode)('input',{ref_key:'folderInputRef',ref:N,type:'file',webkitdirectory:'',directory:'',multiple:'',style:{display:'none'},onChange:R},null,544),(0,i.createCommentVNode)(' é¡¹ç›®åˆ—è¡¨å’Œç¼–è¾‘å™¨åŒºåŸŸ '),(0,i.createElementVNode)('div',fa,[(0,i.createCommentVNode)(' å·¦ä¾§ï¼šé¡¹ç›®åˆ—è¡¨å’Œæ–‡ä»¶åˆ—è¡¨ '),(0,i.createElementVNode)('div',xa,[l[73]||(l[73]=(0,i.createElementVNode)('h4',{style:{margin:'0 0 15px 0',color:'#fff','font-size':'14px','font-weight':'600'}},'é¡¹ç›®åˆ—è¡¨',-1)),0===n.value.length?((0,i.openBlock)(),(0,i.createElementBlock)('div',ba,[...l[69]||(l[69]=[(0,i.createTextVNode)(' æš‚æ— é¡¹ç›®',-1),(0,i.createElementVNode)('br',null,null,-1),(0,i.createTextVNode)(' ç‚¹å‡»"æ–°å»ºé¡¹ç›®"å¼€å§‹ ',-1)])])):(0,i.createCommentVNode)('v-if',!0),((0,i.openBlock)(!0),(0,i.createElementBlock)(i.Fragment,null,(0,i.renderList)(n.value,e=>((0,i.openBlock)(),(0,i.createElementBlock)('div',{key:e.id,style:(0,i.normalizeStyle)({padding:'10px 12px',marginBottom:'8px',background:t.value===e.id?'#4a9eff':'#1e1e1e',borderRadius:'8px',cursor:'pointer',transition:'all 0.2s ease',display:'flex',justifyContent:'space-between',alignItems:'center',color:t.value===e.id?'#fff':'#e0e0e0'}),onClick:n=>function(e){t.value=e;const n=I.value;n&&n.files.length>0?(a.value=n.files[0].path,o.value=n.files[0].content,Y()):(a.value='',o.value='',r.value='')}(e.id),onMouseenter:n=>t.value!==e.id&&(n.currentTarget.style.background='#3a3a3a'),onMouseleave:n=>t.value!==e.id&&(n.currentTarget.style.background='#1e1e1e')},[(0,i.createElementVNode)('span',ya,(0,i.toDisplayString)(e.name),1),(0,i.createElementVNode)('button',{style:{width:'20px',height:'20px',background:'rgba(239, 68, 68, 0.2)',border:'none','border-radius':'4px',color:'#ff4444','font-size':'14px','line-height':'1',cursor:'pointer',opacity:'0.6',transition:'all 0.2s ease'},onClick:(0,i.withModifiers)(s=>function(e){const s=n.value.find(n=>n.id===e);s&&confirm(`ç¡®å®šåˆ é™¤é¡¹ç›® "${s.name}" å—ï¼Ÿ`)&&(n.value=n.value.filter(n=>n.id!==e),console.log('åˆ é™¤é¡¹ç›®åï¼Œå‰©ä½™é¡¹ç›®æ•°:',n.value.length),t.value===e&&(t.value='',a.value='',o.value='',r.value=''),J(),toastr.success(`é¡¹ç›® "${s.name}" å·²åˆ é™¤`))}(e.id),['stop']),onMouseenter:l[14]||(l[14]=e=>(e.currentTarget.style.opacity='1',e.currentTarget.style.background='#ef4444',e.currentTarget.style.color='#fff')),onMouseleave:l[15]||(l[15]=e=>(e.currentTarget.style.opacity='0.6',e.currentTarget.style.background='rgba(239, 68, 68, 0.2)',e.currentTarget.style.color='#ff4444'))},' Ã— ',40,va)],44,ha))),128)),(0,i.createCommentVNode)(' æ–‡ä»¶åˆ—è¡¨ '),t.value&&I.value?((0,i.openBlock)(),(0,i.createElementBlock)('div',wa,[(0,i.createElementVNode)('div',ka,[l[72]||(l[72]=(0,i.createElementVNode)('h4',{style:{margin:'0',color:'#fff','font-size':'13px','font-weight':'600'}},'æ–‡ä»¶',-1)),(0,i.createElementVNode)('div',Aa,[(0,i.createElementVNode)('button',{style:{padding:'4px 8px',background:'#444',border:'none','border-radius':'5px',color:'#e0e0e0','font-size':'11px',cursor:'pointer',transition:'all 0.2s',display:'flex','align-items':'center',gap:'4px'},title:'æ–°å»ºæ–‡ä»¶å¤¹',onClick:L,onMouseenter:l[16]||(l[16]=e=>e.currentTarget.style.background='#555'),onMouseleave:l[17]||(l[17]=e=>e.currentTarget.style.background='#444')},[...l[70]||(l[70]=[(0,i.createElementVNode)('i',{class:'fa-solid fa-folder-plus',style:{'font-size':'10px'}},null,-1)])],32),(0,i.createElementVNode)('button',{style:{padding:'4px 8px',background:'#10b981',border:'none','border-radius':'5px',color:'white','font-size':'11px',cursor:'pointer',transition:'all 0.2s',display:'flex','align-items':'center',gap:'4px'},title:'æ–°å»ºæ–‡ä»¶',onClick:H,onMouseenter:l[18]||(l[18]=e=>e.currentTarget.style.background='#059669'),onMouseleave:l[19]||(l[19]=e=>e.currentTarget.style.background='#10b981')},[...l[71]||(l[71]=[(0,i.createElementVNode)('i',{class:'fa-solid fa-plus',style:{'font-size':'10px'}},null,-1)])],32)])]),((0,i.openBlock)(!0),(0,i.createElementBlock)(i.Fragment,null,(0,i.renderList)(I.value.files,e=>((0,i.openBlock)(),(0,i.createElementBlock)('div',{key:e.path,style:(0,i.normalizeStyle)({padding:'8px 10px',marginBottom:'5px',background:a.value===e.path?'#10b981':'#1e1e1e',borderRadius:'6px',cursor:'pointer',transition:'all 0.2s ease',color:a.value===e.path?'#fff':'#e0e0e0',fontSize:'12px',display:'flex',justifyContent:'space-between',alignItems:'center'}),onClick:n=>function(e){a.value=e;const n=I.value;if(n){const t=n.files.find(n=>n.path===e);t&&(o.value=t.content)}}(e.path),onMouseenter:n=>a.value!==e.path&&(n.currentTarget.style.background='#3a3a3a'),onMouseleave:n=>a.value!==e.path&&(n.currentTarget.style.background='#1e1e1e')},[(0,i.createElementVNode)('span',null,[(0,i.createElementVNode)('i',{class:(0,i.normalizeClass)(U(e.path)),style:{'margin-right':'6px'}},null,2),(0,i.createTextVNode)(' '+(0,i.toDisplayString)(e.name),1)]),(0,i.createElementVNode)('button',{style:{width:'18px',height:'18px',background:'rgba(239, 68, 68, 0.2)',border:'none','border-radius':'3px',color:'#ff4444','font-size':'12px','line-height':'1',cursor:'pointer',opacity:'0',transition:'all 0.2s ease'},title:'åˆ é™¤æ–‡ä»¶',onClick:(0,i.withModifiers)(n=>function(e){const n=I.value;if(!n)return;const t=n.files.find(n=>n.path===e);t&&confirm(`ç¡®å®šåˆ é™¤æ–‡ä»¶ "${t.path}" å—ï¼Ÿ`)&&(n.files=n.files.filter(n=>n.path!==e),a.value===e&&(n.files.length>0?(a.value=n.files[0].path,o.value=n.files[0].content):(a.value='',o.value='')),J(),Y(),window.toastr.success(`æ–‡ä»¶ "${t.path}" å·²åˆ é™¤`))}(e.path),['stop']),onMouseenter:l[20]||(l[20]=e=>(e.currentTarget.style.opacity='1',e.currentTarget.style.background='#ef4444',e.currentTarget.style.color='#fff')),onMouseleave:l[21]||(l[21]=e=>(e.currentTarget.style.opacity='0.6',e.currentTarget.style.background='rgba(239, 68, 68, 0.2)',e.currentTarget.style.color='#ff4444'))},' Ã— ',40,Ea)],44,Ca))),128))])):(0,i.createCommentVNode)('v-if',!0)]),(0,i.createCommentVNode)(' ä¸­é—´ï¼šä»£ç ç¼–è¾‘å™¨ '),(0,i.createElementVNode)('div',Ta,[t.value?a.value?((0,i.openBlock)(),(0,i.createElementBlock)('div',Ia,[(0,i.createElementVNode)('div',_a,[(0,i.createElementVNode)('div',Va,[(0,i.createElementVNode)('i',{class:(0,i.normalizeClass)(U(a.value)),style:{color:'#4a9eff'}},null,2),(0,i.createElementVNode)('span',za,(0,i.toDisplayString)(a.value),1)]),(0,i.createElementVNode)('div',Ba,[l[75]||(l[75]=(0,i.createElementVNode)('span',{style:{color:'#888','font-size':'11px'}},[(0,i.createElementVNode)('i',{class:'fa-solid fa-circle-check',style:{color:'#10b981','margin-right':'4px'}}),(0,i.createTextVNode)(' è‡ªåŠ¨ä¿å­˜ ')],-1)),(0,i.createElementVNode)('button',{style:{padding:'6px 12px',background:'linear-gradient(135deg, #10b981 0%, #059669 100%)',border:'none','border-radius':'6px',color:'white','font-size':'12px','font-weight':'600',cursor:'pointer',transition:'all 0.2s ease'},onClick:F,onMouseenter:l[22]||(l[22]=e=>e.currentTarget.style.transform='translateY(-1px)'),onMouseleave:l[23]||(l[23]=e=>e.currentTarget.style.transform='translateY(0)')},[...l[74]||(l[74]=[(0,i.createElementVNode)('i',{class:'fa-solid fa-floppy-disk',style:{'margin-right':'4px'}},null,-1),(0,i.createTextVNode)(' æ‰‹åŠ¨ä¿å­˜ ',-1)])],32)])]),(0,i.withDirectives)((0,i.createElementVNode)('textarea',{'onUpdate:modelValue':l[24]||(l[24]=e=>o.value=e),placeholder:`åœ¨è¿™é‡Œç¼–å†™ ${a.value.split('.').pop()?.toUpperCase()} ä»£ç ...`,style:{flex:'1',background:'#1e1e1e',border:'1px solid #3a3a3a','border-radius':'8px',color:'#e0e0e0','font-family':'\'Consolas\', \'Monaco\', monospace','font-size':'13px','line-height':'1.6',padding:'15px',resize:'none',outline:'none','min-height':'400px'}},null,8,Ma),[[i.vModelText,o.value]])])):((0,i.openBlock)(),(0,i.createElementBlock)('div',Na,' â† è¯·é€‰æ‹©ä¸€ä¸ªæ–‡ä»¶ ')):((0,i.openBlock)(),(0,i.createElementBlock)('div',Sa,' â† è¯·é€‰æ‹©ä¸€ä¸ªé¡¹ç›® '))]),(0,i.createCommentVNode)(' å³ä¾§ï¼šå®æ—¶é¢„è§ˆ '),(0,i.createElementVNode)('div',Pa,[(0,i.createElementVNode)('div',$a,[l[77]||(l[77]=(0,i.createElementVNode)('h4',{style:{margin:'0',color:'#fff','font-size':'14px','font-weight':'600'}},[(0,i.createElementVNode)('i',{class:'fa-solid fa-eye',style:{'margin-right':'8px',color:'#4a9eff'}}),(0,i.createTextVNode)(' å®æ—¶é¢„è§ˆ ')],-1)),(0,i.createElementVNode)('div',Da,[r.value?((0,i.openBlock)(),(0,i.createElementBlock)('button',{key:0,title:'æ–°çª—å£æ‰“å¼€',style:{width:'28px',height:'28px',padding:'0',background:'#3a3a3a',border:'none','border-radius':'6px',color:'#e0e0e0',cursor:'pointer',display:'flex','align-items':'center','justify-content':'center',transition:'all 0.2s ease'},onClick:le,onMouseenter:l[25]||(l[25]=e=>e.currentTarget.style.background='#4a9eff'),onMouseleave:l[26]||(l[26]=e=>e.currentTarget.style.background='#3a3a3a')},[...l[76]||(l[76]=[(0,i.createElementVNode)('i',{class:'fa-solid fa-external-link-alt',style:{'font-size':'12px'}},null,-1)])],32)):(0,i.createCommentVNode)('v-if',!0)])]),(0,i.createElementVNode)('div',ja,[r.value?((0,i.openBlock)(),(0,i.createElementBlock)('iframe',{key:0,srcdoc:r.value,sandbox:'allow-scripts allow-same-origin allow-modals allow-forms',style:{width:'100%',height:'100%',border:'none',background:'white'}},null,8,Ra)):((0,i.openBlock)(),(0,i.createElementBlock)('div',Oa,' ä¿å­˜ä»£ç åå°†æ˜¾ç¤ºé¢„è§ˆ '))])])]),(0,i.createCommentVNode)(' AI æ™ºèƒ½ç¼–å†™å¯¹è¯æ¡† '),s.value?((0,i.openBlock)(),(0,i.createElementBlock)('div',{key:0,style:{position:'fixed',top:'0',left:'0',right:'0',bottom:'0',background:'rgba(0, 0, 0, 0.8)',display:'flex','align-items':'center','justify-content':'center','z-index':'10000'},onClick:(0,i.withModifiers)(Q,['self'])},[(0,i.createElementVNode)('div',Fa,[l[85]||(l[85]=(0,i.createElementVNode)('h3',{style:{margin:'0 0 20px 0',color:'#fff','font-size':'18px','font-weight':'600',display:'flex','align-items':'center',gap:'10px'}},[(0,i.createElementVNode)('i',{class:'fa-solid fa-wand-magic-sparkles',style:{color:'#8b5cf6'}}),(0,i.createTextVNode)(' AI æ™ºèƒ½ç¼–å†™ ')],-1)),(0,i.createElementVNode)('div',La,[l[79]||(l[79]=(0,i.createElementVNode)('label',{style:{display:'block','margin-bottom':'8px',color:'#ccc','font-size':'13px'}},[(0,i.createElementVNode)('i',{class:'fa-solid fa-pencil',style:{color:'#8b5cf6','margin-right':'6px'}}),(0,i.createTextVNode)(' è¯¦ç»†æè¿°ä½ çš„éœ€æ±‚ï¼ˆè¶Šè¯¦ç»†æ•ˆæœè¶Šå¥½ï¼‰ï¼š ')],-1)),l[80]||(l[80]=(0,i.createElementVNode)('div',{style:{'margin-bottom':'10px',padding:'10px 12px',background:'rgba(139, 92, 246, 0.1)','border-left':'3px solid #8b5cf6','border-radius':'4px','font-size':'12px',color:'#ccc','line-height':'1.6'}},[(0,i.createElementVNode)('strong',{style:{color:'#8b5cf6'}},'ğŸ’¡ æç¤ºï¼š'),(0,i.createTextVNode)(' ä¸è¦åªè¯´"ä¼˜åŒ–"ã€"å®Œå–„"ï¼Œè¦å…·ä½“è¯´æ˜ä½ æƒ³è¦ä»€ä¹ˆæ•ˆæœã€ä»€ä¹ˆæ ·å¼ã€ä»€ä¹ˆåŠŸèƒ½ï¼ ')],-1)),(0,i.withDirectives)((0,i.createElementVNode)('textarea',{'onUpdate:modelValue':l[27]||(l[27]=e=>c.value=e),placeholder:'è¯·è¯¦ç»†æè¿°ä½ çš„éœ€æ±‚ï¼Œä¾‹å¦‚ï¼šæ·»åŠ ä¸€ä¸ªå“åº”å¼å¯¼èˆªæ ï¼Œå¸¦æ±‰å ¡èœå•å’Œå¹³æ»‘æ»šåŠ¨æ•ˆæœ...',style:{width:'100%',height:'120px',background:'#1e1e1e',border:'1px solid #3a3a3a','border-radius':'8px',color:'#e0e0e0','font-size':'13px','line-height':'1.6',padding:'12px',resize:'none',outline:'none'}},null,512),[[i.vModelText,c.value]]),(0,i.createCommentVNode)(' å¿«æ·å»ºè®® '),(0,i.createElementVNode)('div',Ha,[l[78]||(l[78]=(0,i.createElementVNode)('div',{style:{color:'#888','font-size':'12px','margin-bottom':'8px'}},[(0,i.createElementVNode)('i',{class:'fa-solid fa-lightbulb',style:{color:'#fbbf24','margin-right':'4px'}}),(0,i.createTextVNode)(' å¿«æ·å»ºè®®ï¼ˆç‚¹å‡»å¡«å…¥ï¼‰ï¼š ')],-1)),(0,i.createElementVNode)('div',Ua,[((0,i.openBlock)(),(0,i.createElementBlock)(i.Fragment,null,(0,i.renderList)(v,e=>(0,i.createElementVNode)('button',{key:e,style:{padding:'6px 12px',background:'#2a2a2a',border:'1px solid #3a3a3a','border-radius':'6px',color:'#ccc','font-size':'12px',cursor:'pointer',transition:'all 0.2s'},onClick:n=>c.value=e,onMouseenter:l[28]||(l[28]=e=>e.currentTarget.style.background='#3a3a3a'),onMouseleave:l[29]||(l[29]=e=>e.currentTarget.style.background='#2a2a2a')},(0,i.toDisplayString)(e),41,Ga)),64))])])]),(0,i.createCommentVNode)(' æµå¼ä¼ è¾“å¼€å…³ '),(0,i.createElementVNode)('div',Ya,[(0,i.createElementVNode)('label',Ja,[(0,i.withDirectives)((0,i.createElementVNode)('input',{'onUpdate:modelValue':l[30]||(l[30]=e=>g.value=e),type:'checkbox',style:{width:'16px',height:'16px',cursor:'pointer'}},null,512),[[i.vModelCheckbox,g.value]]),l[81]||(l[81]=(0,i.createElementVNode)('i',{class:'fa-solid fa-water',style:{color:'#4a9eff'}},null,-1)),l[82]||(l[82]=(0,i.createTextVNode)(' å¯ç”¨æµå¼ä¼ è¾“ ',-1))]),l[83]||(l[83]=(0,i.createElementVNode)('span',{style:{color:'#888','font-size':'12px'}},' ï¼ˆå®æ—¶æŸ¥çœ‹ç”Ÿæˆè¿‡ç¨‹ï¼Œä½“éªŒæ›´æµç•…ï¼‰ ',-1))]),(0,i.createCommentVNode)(' æµå¼ä¼ è¾“å®æ—¶æ˜¾ç¤ºåŒºåŸŸ '),p.value&&g.value&&u.value?((0,i.openBlock)(),(0,i.createElementBlock)('div',Wa,[(0,i.createTextVNode)((0,i.toDisplayString)(u.value)+' ',1),l[84]||(l[84]=(0,i.createElementVNode)('span',{style:{animation:'blink 1s infinite'}},'â–Š',-1))])):(0,i.createCommentVNode)('v-if',!0),(0,i.createElementVNode)('div',qa,[(0,i.createElementVNode)('button',{style:{padding:'8px 16px',background:'#3a3a3a',border:'none','border-radius':'6px',color:'#e0e0e0','font-size':'13px',cursor:'pointer',transition:'all 0.2s ease'},onClick:Q,onMouseenter:l[31]||(l[31]=e=>e.currentTarget.style.background='#4a4a4a'),onMouseleave:l[32]||(l[32]=e=>e.currentTarget.style.background='#3a3a3a')},' å–æ¶ˆ ',32),(0,i.createElementVNode)('button',{disabled:p.value||!c.value.trim(),style:(0,i.normalizeStyle)([{padding:'8px 16px',background:'linear-gradient(135deg, #8b5cf6 0%, #7c3aed 100%)',border:'none','border-radius':'6px',color:'white','font-size':'13px','font-weight':'600',cursor:'pointer',transition:'all 0.2s ease'},{opacity:p.value||!c.value.trim()?.5:1,cursor:p.value||!c.value.trim()?'not-allowed':'pointer'}]),onClick:te},[p.value?((0,i.openBlock)(),(0,i.createElementBlock)('i',Qa)):((0,i.openBlock)(),(0,i.createElementBlock)('i',Xa)),(0,i.createTextVNode)(' '+(0,i.toDisplayString)(p.value?'ç”Ÿæˆä¸­...':'å¼€å§‹ç”Ÿæˆ'),1)],12,Ka)])])])):(0,i.createCommentVNode)('v-if',!0),(0,i.createCommentVNode)(' Bug ä¿®å¤å¯¹è¯æ¡† '),C.value?((0,i.openBlock)(),(0,i.createElementBlock)('div',{key:1,style:{position:'fixed',top:'0',left:'0',right:'0',bottom:'0',background:'rgba(0, 0, 0, 0.8)',display:'flex','align-items':'center','justify-content':'center','z-index':'10000'},onClick:(0,i.withModifiers)(ee,['self'])},[(0,i.createElementVNode)('div',Za,[l[90]||(l[90]=(0,i.createElementVNode)('h3',{style:{margin:'0 0 20px 0',color:'#fff','font-size':'18px','font-weight':'600',display:'flex','align-items':'center',gap:'10px'}},[(0,i.createElementVNode)('i',{class:'fa-solid fa-bug',style:{color:'#ef4444'}}),(0,i.createTextVNode)(' Bug ä¿®å¤åŠ©æ‰‹ ')],-1)),(0,i.createCommentVNode)(' é—®é¢˜æè¿° '),(0,i.createElementVNode)('div',eo,[l[86]||(l[86]=(0,i.createElementVNode)('label',{style:{display:'block','margin-bottom':'8px',color:'#ccc','font-size':'13px','font-weight':'600'}},[(0,i.createElementVNode)('i',{class:'fa-solid fa-circle-exclamation',style:{color:'#f59e0b','margin-right':'6px'}}),(0,i.createTextVNode)(' å“ªé‡Œæœ‰é—®é¢˜ï¼Ÿï¼ˆå¿…å¡«ï¼‰ ')],-1)),(0,i.withDirectives)((0,i.createElementVNode)('textarea',{'onUpdate:modelValue':l[33]||(l[33]=e=>E.value=e),placeholder:'ä¾‹å¦‚ï¼šç‚¹å‡»å‘é€æŒ‰é’®æ²¡æœ‰ååº”\næˆ–è€…ï¼šæ¶ˆæ¯åˆ—è¡¨ä¸æ˜¾ç¤ºå†…å®¹\næˆ–è€…ï¼šè¾“å…¥æ¡†è¾“å…¥åæ•°æ®æ²¡æœ‰ä¿å­˜',style:{width:'100%',height:'90px',background:'#1e1e1e',border:'1px solid #3a3a3a','border-radius':'8px',color:'#e0e0e0','font-size':'13px','line-height':'1.6',padding:'12px',resize:'none',outline:'none'}},null,512),[[i.vModelText,E.value]])]),(0,i.createCommentVNode)(' Console é”™è¯¯ä¿¡æ¯ '),(0,i.createElementVNode)('div',no,[l[87]||(l[87]=(0,i.createElementVNode)('label',{style:{display:'block','margin-bottom':'8px',color:'#ccc','font-size':'13px','font-weight':'600'}},[(0,i.createElementVNode)('i',{class:'fa-solid fa-terminal',style:{color:'#ef4444','margin-right':'6px'}}),(0,i.createTextVNode)(' æµè§ˆå™¨ Console é”™è¯¯ä¿¡æ¯ï¼ˆæŒ‰ F12 æŸ¥çœ‹ï¼‰ ')],-1)),(0,i.withDirectives)((0,i.createElementVNode)('textarea',{'onUpdate:modelValue':l[34]||(l[34]=e=>T.value=e),placeholder:'å¦‚æœæµè§ˆå™¨ Console ä¸­æœ‰çº¢è‰²é”™è¯¯ï¼Œè¯·å¤åˆ¶ç²˜è´´åˆ°è¿™é‡Œ\nä¾‹å¦‚ï¼šUncaught TypeError: xxx is not a function\n\nå¦‚æœæ²¡æœ‰é”™è¯¯ï¼Œç•™ç©ºå³å¯',style:{width:'100%',height:'80px',background:'#1e1e1e',border:'1px solid #3a3a3a','border-radius':'8px',color:'#ff6b6b','font-size':'12px','font-family':'\'Consolas\', monospace','line-height':'1.5',padding:'12px',resize:'none',outline:'none'}},null,512),[[i.vModelText,T.value]])]),(0,i.createCommentVNode)(' é—®é¢˜æ–‡ä»¶ '),(0,i.createElementVNode)('div',to,[l[89]||(l[89]=(0,i.createElementVNode)('label',{style:{display:'block','margin-bottom':'8px',color:'#ccc','font-size':'13px','font-weight':'600'}},[(0,i.createElementVNode)('i',{class:'fa-solid fa-file-code',style:{color:'#4a9eff','margin-right':'6px'}}),(0,i.createTextVNode)(' é—®é¢˜å¯èƒ½åœ¨å“ªä¸ªæ–‡ä»¶ï¼Ÿ ')],-1)),(0,i.withDirectives)((0,i.createElementVNode)('select',{'onUpdate:modelValue':l[35]||(l[35]=e=>S.value=e),style:{width:'100%',background:'#1e1e1e',border:'1px solid #3a3a3a','border-radius':'8px',color:'#e0e0e0','font-size':'13px',padding:'10px 12px',outline:'none',cursor:'pointer'}},[...l[88]||(l[88]=[(0,i.createElementVNode)('option',{value:''},'è®© AI è‡ªåŠ¨åˆ¤æ–­',-1),(0,i.createElementVNode)('option',{value:'index.html'},'HTML æ–‡ä»¶ï¼ˆindex.htmlï¼‰',-1),(0,i.createElementVNode)('option',{value:'style.css'},'CSS æ–‡ä»¶ï¼ˆstyle.cssï¼‰',-1),(0,i.createElementVNode)('option',{value:'script.js'},'JavaScript æ–‡ä»¶ï¼ˆscript.jsï¼‰',-1)])],512),[[i.vModelSelect,S.value]])]),(0,i.createCommentVNode)(' æç¤ºä¿¡æ¯ '),l[91]||(l[91]=(0,i.createElementVNode)('div',{style:{padding:'12px',background:'rgba(74, 158, 255, 0.1)',border:'1px solid rgba(74, 158, 255, 0.3)','border-radius':'6px','margin-bottom':'15px'}},[(0,i.createElementVNode)('p',{style:{margin:'0',color:'#4a9eff','font-size':'12px','line-height':'1.6'}},[(0,i.createElementVNode)('i',{class:'fa-solid fa-lightbulb',style:{'margin-right':'6px'}}),(0,i.createElementVNode)('strong',null,'æç¤ºï¼š'),(0,i.createTextVNode)('AI ä¼šä¸“æ³¨äºä¿®å¤è¿™ä¸ªå…·ä½“çš„ bugï¼Œä¸ä¼šæ”¹åŠ¨å…¶ä»–åŠŸèƒ½ã€‚å¦‚æœæœ‰ Console é”™è¯¯ä¿¡æ¯ï¼Œä¿®å¤æˆåŠŸç‡ä¼šæ›´é«˜ï¼ ')])],-1)),(0,i.createElementVNode)('div',ao,[(0,i.createElementVNode)('button',{style:{padding:'8px 16px',background:'#3a3a3a',border:'none','border-radius':'6px',color:'#e0e0e0','font-size':'13px',cursor:'pointer',transition:'all 0.2s ease'},onClick:ee,onMouseenter:l[36]||(l[36]=e=>e.currentTarget.style.background='#4a4a4a'),onMouseleave:l[37]||(l[37]=e=>e.currentTarget.style.background='#3a3a3a')},' å–æ¶ˆ ',32),(0,i.createElementVNode)('button',{disabled:p.value||!E.value.trim(),style:(0,i.normalizeStyle)([{padding:'8px 16px',background:'linear-gradient(135deg, #ef4444 0%, #dc2626 100%)',border:'none','border-radius':'6px',color:'white','font-size':'13px','font-weight':'600',cursor:'pointer',transition:'all 0.2s ease'},{opacity:p.value||!E.value.trim()?.5:1,cursor:p.value||!E.value.trim()?'not-allowed':'pointer'}]),onClick:ne},[p.value?((0,i.openBlock)(),(0,i.createElementBlock)('i',so)):((0,i.openBlock)(),(0,i.createElementBlock)('i',ro)),(0,i.createTextVNode)(' '+(0,i.toDisplayString)(p.value?'ä¿®å¤ä¸­...':'å¼€å§‹ä¿®å¤'),1)],12,oo)])])])):(0,i.createCommentVNode)('v-if',!0),(0,i.createCommentVNode)(' AI ç”Ÿæˆç»“æœå¯¹æ¯”å¯¹è¯æ¡† '),m.value?((0,i.openBlock)(),(0,i.createElementBlock)('div',io,[(0,i.createElementVNode)('div',lo,[(0,i.createCommentVNode)(' æ ‡é¢˜æ  '),(0,i.createElementVNode)('div',co,[l[94]||(l[94]=(0,i.createElementVNode)('h3',{style:{margin:'0',color:'#fff','font-size':'18px','font-weight':'600',display:'flex','align-items':'center',gap:'10px'}},[(0,i.createElementVNode)('i',{class:'fa-solid fa-code-compare',style:{color:'#8b5cf6'}}),(0,i.createTextVNode)(' AI ç”Ÿæˆç»“æœå¯¹æ¯” ')],-1)),(0,i.createElementVNode)('div',po,[(0,i.createElementVNode)('button',{style:{padding:'8px 16px',background:'#ef4444',border:'none','border-radius':'6px',color:'white','font-size':'13px',cursor:'pointer',transition:'all 0.2s ease'},onClick:oe,onMouseenter:l[38]||(l[38]=e=>e.currentTarget.style.background='#dc2626'),onMouseleave:l[39]||(l[39]=e=>e.currentTarget.style.background='#ef4444')},[...l[92]||(l[92]=[(0,i.createElementVNode)('i',{class:'fa-solid fa-xmark',style:{'margin-right':'6px'}},null,-1),(0,i.createTextVNode)(' æ‹’ç» ',-1)])],32),(0,i.createElementVNode)('button',{style:{padding:'8px 16px',background:'#10b981',border:'none','border-radius':'6px',color:'white','font-size':'13px','font-weight':'500',cursor:'pointer',transition:'all 0.2s'},onClick:ae,onMouseenter:l[40]||(l[40]=e=>e.currentTarget.style.background='#059669'),onMouseleave:l[41]||(l[41]=e=>e.currentTarget.style.background='#10b981')},[...l[93]||(l[93]=[(0,i.createElementVNode)('i',{class:'fa-solid fa-check',style:{'margin-right':'6px'}},null,-1),(0,i.createTextVNode)(' åº”ç”¨æ›´æ”¹ ',-1)])],32)])]),(0,i.createCommentVNode)(' å†…å®¹åŒº '),(0,i.createElementVNode)('div',go,[(0,i.createCommentVNode)(' ä¿®æ”¹å‰ä»£ç  '),(0,i.createElementVNode)('div',uo,[l[95]||(l[95]=(0,i.createElementVNode)('div',{style:{padding:'12px 15px',background:'#2a2a2a','border-bottom':'1px solid #3a3a3a'}},[(0,i.createElementVNode)('h4',{style:{margin:'0',color:'#fff','font-size':'14px','font-weight':'600'}},[(0,i.createElementVNode)('i',{class:'fa-solid fa-file-code',style:{'margin-right':'8px',color:'#ef4444'}}),(0,i.createTextVNode)(' ä¿®æ”¹å‰ ')])],-1)),(0,i.createElementVNode)('div',mo,[((0,i.openBlock)(!0),(0,i.createElementBlock)(i.Fragment,null,(0,i.renderList)(f.value,e=>((0,i.openBlock)(),(0,i.createElementBlock)('div',{key:e.path,style:{'margin-bottom':'20px'}},[(0,i.createElementVNode)('div',fo,[(0,i.createElementVNode)('i',{class:(0,i.normalizeClass)(U(e.path))},null,2),(0,i.createTextVNode)(' '+(0,i.toDisplayString)(e.path),1)]),(0,i.createElementVNode)('pre',xo,(0,i.toDisplayString)(e.oldContent),1)]))),128))])]),(0,i.createCommentVNode)(' ä¿®æ”¹åä»£ç  '),(0,i.createElementVNode)('div',bo,[l[96]||(l[96]=(0,i.createElementVNode)('div',{style:{padding:'12px 15px',background:'#2a2a2a','border-bottom':'1px solid #3a3a3a'}},[(0,i.createElementVNode)('h4',{style:{margin:'0',color:'#fff','font-size':'14px','font-weight':'600'}},[(0,i.createElementVNode)('i',{class:'fa-solid fa-file-code',style:{'margin-right':'8px',color:'#10b981'}}),(0,i.createTextVNode)(' ä¿®æ”¹å ')])],-1)),(0,i.createElementVNode)('div',ho,[((0,i.openBlock)(!0),(0,i.createElementBlock)(i.Fragment,null,(0,i.renderList)(f.value,e=>((0,i.openBlock)(),(0,i.createElementBlock)('div',{key:e.path,style:{'margin-bottom':'20px'}},[(0,i.createElementVNode)('div',yo,[(0,i.createElementVNode)('i',{class:(0,i.normalizeClass)(U(e.path))},null,2),(0,i.createTextVNode)(' '+(0,i.toDisplayString)(e.path),1)]),(0,i.createElementVNode)('pre',vo,(0,i.toDisplayString)(e.newContent),1)]))),128))])]),(0,i.createCommentVNode)(' é¢„è§ˆæ•ˆæœ '),(0,i.createElementVNode)('div',wo,[(0,i.createElementVNode)('div',ko,[l[97]||(l[97]=(0,i.createElementVNode)('h4',{style:{margin:'0',color:'#fff','font-size':'14px','font-weight':'600'}},[(0,i.createElementVNode)('i',{class:'fa-solid fa-eye',style:{'margin-right':'8px',color:'#4a9eff'}}),(0,i.createTextVNode)(' é¢„è§ˆæ•ˆæœ ')],-1)),(0,i.createElementVNode)('div',Ao,[(0,i.createElementVNode)('button',{style:(0,i.normalizeStyle)({padding:'4px 10px',background:'before'===x.value?'#ef4444':'#3a3a3a',border:'none',borderRadius:'4px',color:'white',fontSize:'11px',cursor:'pointer',transition:'all 0.2s ease'}),onClick:l[42]||(l[42]=e=>x.value='before')},' ä¿®æ”¹å‰ ',4),(0,i.createElementVNode)('button',{style:(0,i.normalizeStyle)({padding:'4px 10px',background:'after'===x.value?'#10b981':'#3a3a3a',border:'none',borderRadius:'4px',color:'white',fontSize:'11px',cursor:'pointer',transition:'all 0.2s ease'}),onClick:l[43]||(l[43]=e=>x.value='after')},' ä¿®æ”¹å ',4)])]),(0,i.createElementVNode)('div',Co,[(0,i.createElementVNode)('iframe',{srcdoc:B.value,sandbox:'allow-scripts allow-same-origin allow-modals allow-forms',style:{width:'100%',height:'100%',border:'none'}},null,8,Eo)])])])])])):(0,i.createCommentVNode)('v-if',!0),(0,i.createCommentVNode)(' å†å²è®°å½•å¯¹è¯æ¡† '),h.value?((0,i.openBlock)(),(0,i.createElementBlock)('div',{key:3,style:{position:'fixed',top:'0',left:'0',right:'0',bottom:'0',background:'rgba(0, 0, 0, 0.8)',display:'flex','align-items':'center','justify-content':'center','z-index':'10000',padding:'20px'},onClick:(0,i.withModifiers)(se,['self'])},[(0,i.createElementVNode)('div',To,[(0,i.createElementVNode)('div',So,[l[98]||(l[98]=(0,i.createElementVNode)('h3',{style:{margin:'0',color:'#fff','font-size':'18px','font-weight':'600',display:'flex','align-items':'center',gap:'10px'}},[(0,i.createElementVNode)('i',{class:'fa-solid fa-history',style:{color:'#f59e0b'}}),(0,i.createTextVNode)(' AI ç¼–å†™å†å² ')],-1)),(0,i.createElementVNode)('button',{style:{width:'28px',height:'28px',background:'#3a3a3a',border:'none','border-radius':'6px',color:'#e0e0e0',cursor:'pointer',transition:'all 0.2s ease'},onClick:se,onMouseenter:l[44]||(l[44]=e=>e.currentTarget.style.background='#4a4a4a'),onMouseleave:l[45]||(l[45]=e=>e.currentTarget.style.background='#3a3a3a')},' Ã— ',32)]),(0,i.createElementVNode)('div',No,[0===V.value.length?((0,i.openBlock)(),(0,i.createElementBlock)('div',Io,[...l[99]||(l[99]=[(0,i.createElementVNode)('i',{class:'fa-solid fa-inbox',style:{'font-size':'48px','margin-bottom':'15px',opacity:'0.3'}},null,-1),(0,i.createElementVNode)('p',null,'æš‚æ— å†å²è®°å½•',-1)])])):(0,i.createCommentVNode)('v-if',!0),((0,i.openBlock)(!0),(0,i.createElementBlock)(i.Fragment,null,(0,i.renderList)(V.value,(e,n)=>((0,i.openBlock)(),(0,i.createElementBlock)('div',{key:n,style:{background:'#1e1e1e','border-radius':'8px',padding:'15px','margin-bottom':'15px',border:'1px solid #3a3a3a'}},[(0,i.createElementVNode)('div',_o,[(0,i.createElementVNode)('div',null,[(0,i.createElementVNode)('div',Vo,(0,i.toDisplayString)(e.prompt),1),(0,i.createElementVNode)('div',zo,(0,i.toDisplayString)(new Date(e.timestamp).toLocaleString('zh-CN')),1)]),(0,i.createElementVNode)('button',{style:{padding:'6px 12px',background:'#4a9eff',border:'none','border-radius':'6px',color:'white','font-size':'12px','font-weight':'500',cursor:'pointer',transition:'all 0.2s'},onClick:n=>function(e){if(!confirm(`ç¡®å®šè¦æ¢å¤åˆ°è¿™ä¸ªå†å²ç‰ˆæœ¬å—ï¼Ÿ\n\n"${e.prompt}"\n\nå½“å‰çš„ä¿®æ”¹å°†è¢«è¦†ç›–ã€‚`))return;const n=I.value;if(n){if(e.changes.forEach(e=>{const t=n.files.find(n=>n.path===e.path);t&&(t.content=e.newContent)}),console.log('æ¢å¤å†å²ç‰ˆæœ¬:',e.prompt),J(),Y(),a.value){const e=n.files.find(e=>e.path===a.value);e&&(o.value=e.content)}se(),toastr.success('å·²æ¢å¤åˆ°å†å²ç‰ˆæœ¬')}}(e),onMouseenter:l[46]||(l[46]=e=>e.currentTarget.style.background='#3b82f6'),onMouseleave:l[47]||(l[47]=e=>e.currentTarget.style.background='#4a9eff')},[...l[100]||(l[100]=[(0,i.createElementVNode)('i',{class:'fa-solid fa-undo',style:{'margin-right':'4px'}},null,-1),(0,i.createTextVNode)(' æ¢å¤ ',-1)])],40,Bo)]),(0,i.createElementVNode)('div',Mo,[l[101]||(l[101]=(0,i.createElementVNode)('strong',null,'ä¿®æ”¹çš„æ–‡ä»¶ï¼š',-1)),(0,i.createElementVNode)('div',Po,[((0,i.openBlock)(!0),(0,i.createElementBlock)(i.Fragment,null,(0,i.renderList)(e.changes,e=>((0,i.openBlock)(),(0,i.createElementBlock)('span',{key:e.path,style:{background:'#2a2a2a',padding:'4px 10px','border-radius':'4px','font-size':'12px',display:'inline-flex','align-items':'center',gap:'6px'}},[(0,i.createElementVNode)('i',{class:(0,i.normalizeClass)(U(e.path))},null,2),(0,i.createTextVNode)(' '+(0,i.toDisplayString)(e.path),1)]))),128))])])]))),128))])])])):(0,i.createCommentVNode)('v-if',!0),(0,i.createCommentVNode)(' é¡¹ç›®æ¨¡æ¿é€‰æ‹©å¯¹è¯æ¡† '),A.value?((0,i.openBlock)(),(0,i.createElementBlock)('div',{key:4,style:{position:'fixed',top:'0',left:'0',right:'0',bottom:'0',background:'rgba(0, 0, 0, 0.8)',display:'flex','align-items':'center','justify-content':'center','z-index':'10000',padding:'20px'},onClick:l[60]||(l[60]=(0,i.withModifiers)(e=>A.value=!1,['self']))},[(0,i.createElementVNode)('div',$o,[(0,i.createCommentVNode)(' å¯¹è¯æ¡†å¤´éƒ¨ '),(0,i.createElementVNode)('div',Do,[l[103]||(l[103]=(0,i.createElementVNode)('h3',{style:{margin:'0',color:'#fff','font-size':'20px','font-weight':'600',display:'flex','align-items':'center',gap:'12px'}},[(0,i.createElementVNode)('span',{style:{width:'40px',height:'40px',background:'#2a2a2a','border-radius':'10px',display:'flex','align-items':'center','justify-content':'center','font-size':'20px'}},' ğŸ“ '),(0,i.createTextVNode)(' é€‰æ‹©é¡¹ç›®æ¨¡æ¿ ')],-1)),(0,i.createElementVNode)('button',{style:{width:'36px',height:'36px',background:'#2a2a2a',border:'none','border-radius':'8px',color:'#888','font-size':'18px',cursor:'pointer',transition:'all 0.2s',display:'flex','align-items':'center','justify-content':'center'},onClick:l[48]||(l[48]=e=>A.value=!1),onMouseenter:l[49]||(l[49]=e=>{e.currentTarget.style.background='#333',e.currentTarget.style.color='#fff'}),onMouseleave:l[50]||(l[50]=e=>{e.currentTarget.style.background='#2a2a2a',e.currentTarget.style.color='#888'})},[...l[102]||(l[102]=[(0,i.createElementVNode)('i',{class:'fa-solid fa-times'},null,-1)])],32)]),(0,i.createCommentVNode)(' æ¨¡æ¿åˆ—è¡¨ '),(0,i.createElementVNode)('div',jo,[(0,i.createElementVNode)('div',Ro,[(0,i.createCommentVNode)(' åŒå±‚å¯¹è¯ç•Œé¢ '),(0,i.createElementVNode)('div',{style:{background:'#252525',border:'1px solid transparent','border-radius':'12px',padding:'24px',cursor:'pointer',transition:'all 0.25s cubic-bezier(0.4, 0, 0.2, 1)','box-shadow':'0 2px 8px rgba(0, 0, 0, 0.3)'},onClick:l[51]||(l[51]=e=>D('åŒå±‚å¯¹è¯ç•Œé¢')),onMouseenter:l[52]||(l[52]=e=>{e.currentTarget.style.transform='translateY(-4px)',e.currentTarget.style.borderColor='#555',e.currentTarget.style.boxShadow='0 8px 24px rgba(0, 0, 0, 0.5)'}),onMouseleave:l[53]||(l[53]=e=>{e.currentTarget.style.transform='translateY(0)',e.currentTarget.style.borderColor='transparent',e.currentTarget.style.boxShadow='0 2px 8px rgba(0, 0, 0, 0.3)'})},[...l[104]||(l[104]=[(0,i.createElementVNode)('div',{style:{width:'56px',height:'56px',background:'#2a2a2a','border-radius':'12px',display:'flex','align-items':'center','justify-content':'center','font-size':'28px','margin-bottom':'16px'}},' ğŸ’¬ ',-1),(0,i.createElementVNode)('h4',{style:{margin:'0 0 8px 0',color:'#fff','font-size':'17px','font-weight':'600'}},'åŒå±‚å¯¹è¯ç•Œé¢',-1),(0,i.createElementVNode)('p',{style:{margin:'0',color:'#999','font-size':'13px','line-height':'1.6'}},'æµå¼å¯¹è¯ã€æ¶ˆæ¯å†å²ã€æ­£åˆ™æ¸…ç†',-1)])],32),(0,i.createCommentVNode)(' çŠ¶æ€æ é¢æ¿ '),(0,i.createElementVNode)('div',{style:{background:'#252525',border:'1px solid transparent','border-radius':'12px',padding:'24px',cursor:'pointer',transition:'all 0.25s cubic-bezier(0.4, 0, 0.2, 1)','box-shadow':'0 2px 8px rgba(0, 0, 0, 0.3)'},onClick:l[54]||(l[54]=e=>D('çŠ¶æ€æ é¢æ¿')),onMouseenter:l[55]||(l[55]=e=>{e.currentTarget.style.transform='translateY(-4px)',e.currentTarget.style.borderColor='#555',e.currentTarget.style.boxShadow='0 8px 24px rgba(0, 0, 0, 0.5)'}),onMouseleave:l[56]||(l[56]=e=>{e.currentTarget.style.transform='translateY(0)',e.currentTarget.style.borderColor='transparent',e.currentTarget.style.boxShadow='0 2px 8px rgba(0, 0, 0, 0.3)'})},[...l[105]||(l[105]=[(0,i.createElementVNode)('div',{style:{width:'56px',height:'56px',background:'#2a2a2a','border-radius':'12px',display:'flex','align-items':'center','justify-content':'center','font-size':'28px','margin-bottom':'16px'}},' ğŸ“Š ',-1),(0,i.createElementVNode)('h4',{style:{margin:'0 0 8px 0',color:'#fff','font-size':'17px','font-weight':'600'}},'çŠ¶æ€æ é¢æ¿',-1),(0,i.createElementVNode)('p',{style:{margin:'0',color:'#999','font-size':'13px','line-height':'1.6'}},'HP/MP/ç»éªŒå€¼ï¼Œè¿›åº¦æ¡åŠ¨ç”»',-1)])],32),(0,i.createCommentVNode)(' å¥½æ„Ÿåº¦é¢æ¿ '),(0,i.createElementVNode)('div',{style:{background:'#252525',border:'1px solid transparent','border-radius':'12px',padding:'24px',cursor:'pointer',transition:'all 0.25s cubic-bezier(0.4, 0, 0.2, 1)','box-shadow':'0 2px 8px rgba(0, 0, 0, 0.3)'},onClick:l[57]||(l[57]=e=>D('å¥½æ„Ÿåº¦é¢æ¿')),onMouseenter:l[58]||(l[58]=e=>{e.currentTarget.style.transform='translateY(-4px)',e.currentTarget.style.borderColor='#555',e.currentTarget.style.boxShadow='0 8px 24px rgba(0, 0, 0, 0.5)'}),onMouseleave:l[59]||(l[59]=e=>{e.currentTarget.style.transform='translateY(0)',e.currentTarget.style.borderColor='transparent',e.currentTarget.style.boxShadow='0 2px 8px rgba(0, 0, 0, 0.3)'})},[...l[106]||(l[106]=[(0,i.createElementVNode)('div',{style:{width:'56px',height:'56px',background:'#2a2a2a','border-radius':'12px',display:'flex','align-items':'center','justify-content':'center','font-size':'28px','margin-bottom':'16px'}},' ğŸ’ ',-1),(0,i.createElementVNode)('h4',{style:{margin:'0 0 8px 0',color:'#fff','font-size':'17px','font-weight':'600'}},'å¥½æ„Ÿåº¦é¢æ¿',-1),(0,i.createElementVNode)('p',{style:{margin:'0',color:'#999','font-size':'13px','line-height':'1.6'}},'å¤šè§’è‰²å¡ç‰‡ï¼Œçˆ±å¿ƒå›¾æ ‡',-1)])],32)]),l[107]||(l[107]=(0,i.createElementVNode)('div',{style:{'margin-top':'24px',padding:'16px 18px',background:'#252525',border:'1px solid #333','border-radius':'10px'}},[(0,i.createElementVNode)('div',{style:{color:'#ccc','font-weight':'500','margin-bottom':'6px','font-size':'13px',display:'flex','align-items':'center',gap:'8px'}},[(0,i.createElementVNode)('span',{style:{color:'#fbbf24','font-size':'16px'}},'ğŸ’¡'),(0,i.createTextVNode)(' ä½¿ç”¨æç¤º ')]),(0,i.createElementVNode)('p',{style:{margin:'0',color:'#888','font-size':'13px','line-height':'1.7'}},' é€‰æ‹©æ¨¡æ¿åï¼Œä¼šè‡ªåŠ¨åˆ›å»ºåŒ…å«å®Œæ•´ä»£ç çš„é¡¹ç›®ï¼Œä½ å¯ä»¥ç›´æ¥é¢„è§ˆå’Œç¼–è¾‘ ')],-1))])])])):(0,i.createCommentVNode)('v-if',!0),(0,i.createCommentVNode)(' è¿›åº¦å¯¹è¯æ¡† '),(0,i.createVNode)(pa,{ref_key:'progressDialogRef',ref:k,show:w.value,title:'AI æ­£åœ¨å¤„ç†'},null,8,['show'])]))}});s(127);const Fo=(0,V.A)(Oo,[['__scopeId','data-v-434cf372']]),Lo={class:'regex-ui-generator',style:{padding:'25px !important',background:'#1a1a1a !important'}},Ho={style:{display:'grid','grid-template-columns':'1fr 1fr',gap:'20px','margin-bottom':'20px'}},Uo={style:{display:'flex','flex-direction':'column',gap:'20px'}},Go={style:{background:'#2a2a2a',padding:'20px','border-radius':'8px'}},Yo={style:{background:'#2a2a2a',padding:'20px','border-radius':'8px',flex:'1',display:'flex','flex-direction':'column'}},Jo={style:{display:'flex',gap:'12px','margin-top':'15px'}},Wo=['disabled'],qo=['disabled'],Ko={style:{background:'#2a2a2a',padding:'20px','border-radius':'8px',display:'flex','flex-direction':'column'}},Xo={style:{color:'#51cf66',margin:'0 0 15px 0','font-size':'16px',display:'flex','align-items':'center',gap:'8px'}},Qo={key:0,style:{'margin-left':'auto',background:'#51cf66',color:'white',padding:'4px 12px','border-radius':'12px','font-size':'12px'}},Zo={style:{flex:'1',background:'#1a1a1a',border:'2px solid #444','border-radius':'6px',overflow:'hidden',display:'flex','align-items':'center','justify-content':'center','min-height':'400px'}},er={key:0,style:{'text-align':'center',color:'#666',padding:'40px'}},nr=['srcdoc'],tr={key:0,style:{background:'#2a2a2a',padding:'20px','border-radius':'8px'}},ar={key:0,style:{background:'#1a1a1a',padding:'15px','border-radius':'4px',border:'1px solid #444','max-height':'300px','overflow-y':'auto'}},or={style:{margin:'0',color:'#e0e0e0','font-family':'\'Consolas\', monospace','font-size':'13px','white-space':'pre-wrap','word-wrap':'break-word'}},rr={style:{display:'flex',gap:'12px'}},sr=['disabled'],ir=(0,i.defineComponent)({__name:'RegexUIGenerator',setup(e){const n=(0,l.C)().settings,t=(0,i.ref)('ã€å¼€åœºç™½ã€‘'),a=(0,i.ref)(''),o=(0,i.ref)(''),r=(0,i.ref)(''),s=(0,i.ref)(!1),c=(0,i.ref)(!1),p=(0,i.ref)(!1),g=(0,i.ref)(!1),u=(0,i.ref)(''),m=(0,i.ref)(null),f=async()=>{if(t.value&&a.value){s.value=!0;try{const e=`ä½ æ˜¯ä¸€ä¸ªé…’é¦†æ­£åˆ™æ›¿æ¢ä¸“å®¶ã€‚è¯·æ ¹æ®ç”¨æˆ·çš„æè¿°ï¼Œç”Ÿæˆä¸€ä¸ªå®Œæ•´çš„ HTML ç•Œé¢ä»£ç ã€‚\n\nç”¨æˆ·æä¾›çš„è§¦å‘å…³é”®è¯ï¼š${t.value}\n\nç”¨æˆ·çš„ç•Œé¢æè¿°ï¼š\n${a.value}\n\nè¯·ç”Ÿæˆå®Œæ•´çš„ HTML ä»£ç ï¼ŒåŒ…å«ï¼š\n1. HTML ç»“æ„\n2. å†…åµŒçš„ <style> æ ‡ç­¾ï¼ˆCSS æ ·å¼ï¼‰\n3. å†…åµŒçš„ <script> æ ‡ç­¾ï¼ˆå¦‚æœéœ€è¦ JS åŠŸèƒ½ï¼‰\n\nè¦æ±‚ï¼š\n- HTML ä»£ç è¦ç¾è§‚ã€ç°ä»£åŒ–\n- CSS æ ·å¼è¦ç²¾ç¾ï¼Œç¬¦åˆç”¨æˆ·æè¿°çš„é£æ ¼\n- JS ä»£ç è¦ç®€æ´å®ç”¨ï¼ˆå¦‚æœéœ€è¦ï¼‰\n- æ•´ä½“ç•Œé¢è¦ç¬¦åˆç”¨æˆ·çš„æè¿°\n- ä»£ç è¦å®Œæ•´å¯ç”¨ï¼Œå¯ä»¥ç›´æ¥åœ¨æµè§ˆå™¨ä¸­è¿è¡Œ\n\nç›´æ¥è¾“å‡ºå®Œæ•´çš„ HTML ä»£ç ï¼Œä» <!DOCTYPE html> æˆ– <div> å¼€å§‹ï¼Œä¸è¦æœ‰å…¶ä»–è¯´æ˜æ–‡å­—ã€‚`,s=(0,l.normalizeApiEndpoint)(n.api_endpoint),i=await fetch(s,{method:'POST',headers:{'Content-Type':'application/json',Authorization:`Bearer ${n.api_key}`},body:JSON.stringify({model:n.model,messages:[{role:'system',content:'ä½ æ˜¯ä¸€ä¸ªä¸“ä¸šçš„å‰ç«¯å¼€å‘ä¸“å®¶ï¼Œæ“…é•¿ç”Ÿæˆç¾è§‚çš„ HTML/CSS/JS ä»£ç ã€‚è¯·æ ¹æ®ç”¨æˆ·æè¿°ç”Ÿæˆå®Œæ•´çš„ç•Œé¢ä»£ç ã€‚'},{role:'user',content:e}],temperature:.7,max_tokens:4e3})});if(!i.ok)throw new Error(`API è¯·æ±‚å¤±è´¥: ${i.status}`);const d=await i.json();let c=d.choices?.[0]?.message?.content||'';console.log('ğŸ“ [ç•Œé¢ç”Ÿæˆ] AI åŸå§‹è¿”å›é•¿åº¦:',c.length),console.log('ğŸ“ [ç•Œé¢ç”Ÿæˆ] AI åŸå§‹è¿”å›å‰500å­—ç¬¦:',c.substring(0,500)),c=c.replace(/```html\n?/g,'').replace(/```\n?/g,'').trim();const p=c.match(/<!DOCTYPE html>[\s\S]*/i);if(p)c=p[0].trim(),console.log('âœ… [ç•Œé¢ç”Ÿæˆ] æå–åˆ°å®Œæ•´çš„HTMLæ–‡æ¡£ï¼ˆå«DOCTYPEï¼‰');else{const e=c.match(/<html[\s\S]*/i);if(e)c=e[0].trim(),console.log('âœ… [ç•Œé¢ç”Ÿæˆ] æå–åˆ°HTMLæ–‡æ¡£ï¼ˆä¸å«DOCTYPEï¼‰');else{if(!c.includes('<')||!c.includes('>'))throw console.error('âŒ [ç•Œé¢ç”Ÿæˆ] AIæœªè¿”å›æœ‰æ•ˆçš„HTMLä»£ç '),console.error('AIè¿”å›å†…å®¹:',c),new Error('AIæœªè¿”å›æœ‰æ•ˆçš„HTMLä»£ç ï¼Œè¯·å°è¯•æ›´è¯¦ç»†çš„ç•Œé¢æè¿°æˆ–æ›´æ¢æ¨¡å‹');console.log('âš ï¸ [ç•Œé¢ç”Ÿæˆ] åŒ…å«HTMLæ ‡ç­¾ä½†æ ¼å¼ä¸æ ‡å‡†ï¼Œå°è¯•åŒ…è£…'),c.includes('<html')||(c=`<!DOCTYPE html>\n<html>\n<head>\n  <meta charset="UTF-8">\n  <meta name="viewport" content="width=device-width, initial-scale=1.0">\n</head>\n<body>\n${c}\n</body>\n</html>`,console.log('âœ… [ç•Œé¢ç”Ÿæˆ] å·²è‡ªåŠ¨åŒ…è£…ä¸ºå®Œæ•´HTMLæ–‡æ¡£'))}}console.log('ğŸ“ [ç•Œé¢ç”Ÿæˆ] æœ€ç»ˆHTMLé•¿åº¦:',c.length),o.value=c;const g=t.value.replace(/[.*+?^${}()|[\]\\]/g,'\\$&'),u={id:`regex_ui_${Date.now()}`,scriptName:`ç•Œé¢_${t.value}`,findRegex:g,replaceString:c,trimStrings:[],placement:[2],disabled:!1,markdownOnly:!0,promptOnly:!1,runOnEdit:!0,substituteRegex:0,minDepth:null,maxDepth:null};r.value=JSON.stringify(u,null,2),window.toastr.success('AI ç”ŸæˆæˆåŠŸï¼')}catch(e){console.error('AI ç”Ÿæˆå¤±è´¥:',e),window.toastr.error('AI ç”Ÿæˆå¤±è´¥: '+e.message)}finally{s.value=!1}}else window.toastr.warning('è¯·å¡«å†™è§¦å‘å…³é”®è¯å’Œç•Œé¢æè¿°')},x=()=>{u.value='',g.value=!0},b=async()=>{if(u.value){c.value=!0;try{const e=`ä½ æ˜¯ä¸€ä¸ªé…’é¦†æ­£åˆ™æ›¿æ¢ä¸“å®¶ã€‚è¯·æ ¹æ®ç”¨æˆ·çš„ç•Œé¢æè¿°å’Œä¿®æ”¹å»ºè®®ï¼Œç”Ÿæˆå®Œæ•´çš„ HTML ç•Œé¢ä»£ç ã€‚\n\nç”¨æˆ·æä¾›çš„è§¦å‘å…³é”®è¯ï¼š${t.value}\n\nåŸå§‹ç•Œé¢æè¿°ï¼š\n${a.value}\n\nç”¨æˆ·çš„ä¿®æ”¹å»ºè®®ï¼š\n${u.value}\n\nè¯·æ ¹æ®åŸå§‹æè¿°å’Œä¿®æ”¹å»ºè®®ï¼Œç”Ÿæˆå®Œæ•´çš„ HTML ä»£ç ï¼ŒåŒ…å«ï¼š\n1. HTML ç»“æ„\n2. å†…åµŒçš„ <style> æ ‡ç­¾ï¼ˆCSS æ ·å¼ï¼‰\n3. å†…åµŒçš„ <script> æ ‡ç­¾ï¼ˆå¦‚æœéœ€è¦ JS åŠŸèƒ½ï¼‰\n\nè¦æ±‚ï¼š\n- åœ¨åŸå§‹æè¿°çš„åŸºç¡€ä¸Šï¼Œåº”ç”¨ç”¨æˆ·çš„ä¿®æ”¹å»ºè®®\n- HTML ä»£ç è¦ç¾è§‚ã€ç°ä»£åŒ–\n- CSS æ ·å¼è¦ç²¾ç¾\n- JS ä»£ç è¦ç®€æ´å®ç”¨ï¼ˆå¦‚æœéœ€è¦ï¼‰\n- ä»£ç è¦å®Œæ•´å¯ç”¨ï¼Œå¯ä»¥ç›´æ¥åœ¨æµè§ˆå™¨ä¸­è¿è¡Œ\n\nç›´æ¥è¾“å‡ºå®Œæ•´çš„ HTML ä»£ç ï¼Œä» <!DOCTYPE html> æˆ– <div> å¼€å§‹ï¼Œä¸è¦æœ‰å…¶ä»–è¯´æ˜æ–‡å­—ã€‚`,s=(0,l.normalizeApiEndpoint)(n.api_endpoint),i=await fetch(s,{method:'POST',headers:{'Content-Type':'application/json',Authorization:`Bearer ${n.api_key}`},body:JSON.stringify({model:n.model,messages:[{role:'system',content:'ä½ æ˜¯ä¸€ä¸ªä¸“ä¸šçš„å‰ç«¯å¼€å‘ä¸“å®¶ï¼Œæ“…é•¿ç”Ÿæˆå’Œä¿®æ”¹ç¾è§‚çš„ HTML/CSS/JS ä»£ç ã€‚ä½ ä¼šæ ¹æ®ç”¨æˆ·çš„æè¿°å’Œä¿®æ”¹å»ºè®®ï¼Œç”Ÿæˆå®Œæ•´çš„ç•Œé¢ä»£ç ã€‚'},{role:'user',content:e}],temperature:.7,max_tokens:4e3})});if(!i.ok)throw new Error(`API è¯·æ±‚å¤±è´¥: ${i.status}`);const d=await i.json();let c=d.choices?.[0]?.message?.content||'';console.log('ğŸ“ [ç•Œé¢ä¿®æ”¹] AI åŸå§‹è¿”å›é•¿åº¦:',c.length),console.log('ğŸ“ [ç•Œé¢ä¿®æ”¹] AI åŸå§‹è¿”å›å‰500å­—ç¬¦:',c.substring(0,500)),c=c.replace(/```html\n?/g,'').replace(/```\n?/g,'').trim();const p=c.match(/<!DOCTYPE html>[\s\S]*/i);if(p)c=p[0].trim(),console.log('âœ… [ç•Œé¢ä¿®æ”¹] æå–åˆ°å®Œæ•´çš„HTMLæ–‡æ¡£ï¼ˆå«DOCTYPEï¼‰');else{const e=c.match(/<html[\s\S]*/i);if(e)c=e[0].trim(),console.log('âœ… [ç•Œé¢ä¿®æ”¹] æå–åˆ°HTMLæ–‡æ¡£ï¼ˆä¸å«DOCTYPEï¼‰');else{if(!c.includes('<')||!c.includes('>'))throw console.error('âŒ [ç•Œé¢ä¿®æ”¹] AIæœªè¿”å›æœ‰æ•ˆçš„HTMLä»£ç '),console.error('AIè¿”å›å†…å®¹:',c),new Error('AIæœªè¿”å›æœ‰æ•ˆçš„HTMLä»£ç ï¼Œè¯·å°è¯•æ›´è¯¦ç»†çš„ä¿®æ”¹å»ºè®®æˆ–æ›´æ¢æ¨¡å‹');console.log('âš ï¸ [ç•Œé¢ä¿®æ”¹] åŒ…å«HTMLæ ‡ç­¾ä½†æ ¼å¼ä¸æ ‡å‡†ï¼Œå°è¯•åŒ…è£…'),c.includes('<html')||(c=`<!DOCTYPE html>\n<html>\n<head>\n  <meta charset="UTF-8">\n  <meta name="viewport" content="width=device-width, initial-scale=1.0">\n</head>\n<body>\n${c}\n</body>\n</html>`,console.log('âœ… [ç•Œé¢ä¿®æ”¹] å·²è‡ªåŠ¨åŒ…è£…ä¸ºå®Œæ•´HTMLæ–‡æ¡£'))}}console.log('ğŸ“ [ç•Œé¢ä¿®æ”¹] æœ€ç»ˆHTMLé•¿åº¦:',c.length),o.value=c;const m=t.value.replace(/[.*+?^${}()|[\]\\]/g,'\\$&'),f={id:`regex_ui_${Date.now()}`,scriptName:`ç•Œé¢_${t.value}`,findRegex:m,replaceString:c,trimStrings:[],placement:[2],disabled:!1,markdownOnly:!0,promptOnly:!1,runOnEdit:!0,substituteRegex:0,minDepth:null,maxDepth:null};r.value=JSON.stringify(f,null,2),a.value=`${a.value}\n\nã€å·²åº”ç”¨çš„ä¿®æ”¹ã€‘ï¼š\n${u.value}`,window.toastr.success('AI ä¿®æ”¹æˆåŠŸï¼'),g.value=!1}catch(e){console.error('AI ä¿®æ”¹å¤±è´¥:',e),window.toastr.error('AI ä¿®æ”¹å¤±è´¥: '+e.message)}finally{c.value=!1}}else window.toastr.warning('è¯·è¾“å…¥ä¿®æ”¹å»ºè®®')},h=()=>{(0,d.lW)(r.value,'æ­£åˆ™ä»£ç å·²å¤åˆ¶åˆ°å‰ªè´´æ¿')};return(e,n)=>((0,i.openBlock)(),(0,i.createElementBlock)('div',Lo,[(0,i.createCommentVNode)(' æ ‡é¢˜ '),n[21]||(n[21]=(0,i.createElementVNode)('div',{style:{background:'linear-gradient(135deg, rgba(102, 126, 234, 0.1) 0%, rgba(118, 75, 162, 0.1) 100%)',padding:'20px','border-radius':'12px','margin-bottom':'20px',border:'1px solid rgba(102, 126, 234, 0.2)'}},[(0,i.createElementVNode)('h3',{style:{color:'#4a9eff',margin:'0 0 10px 0','font-size':'20px','font-weight':'600'}},'ğŸ”§ é…’é¦†æ­£åˆ™ç•Œé¢ç”Ÿæˆå™¨'),(0,i.createElementVNode)('p',{style:{color:'#888',margin:'0','font-size':'14px','line-height':'1.6'}},' AI è¾…åŠ©ç”Ÿæˆé…’é¦†æ­£åˆ™æ›¿æ¢ç•Œé¢ï¼Œç”¨è‡ªç„¶è¯­è¨€æè¿°å³å¯ç”Ÿæˆå®Œæ•´çš„ HTML/CSS/JS ä»£ç  ')],-1)),(0,i.createCommentVNode)(' æ–°æ‰‹ä½¿ç”¨æµç¨‹ '),n[22]||(n[22]=(0,i.createStaticVNode)('<div style="background:#2a2a2a;padding:20px;border-radius:8px;margin-bottom:20px;border-left:4px solid #ffc107;" data-v-f1283e36><h4 style="color:#ffc107;margin:0 0 15px 0;font-size:16px;display:flex;align-items:center;gap:8px;" data-v-f1283e36><i class="fa-solid fa-lightbulb" data-v-f1283e36></i> æ–°æ‰‹ä½¿ç”¨æµç¨‹ï¼ˆè¶…ç®€å•ï¼ï¼‰ï¼š </h4><ol style="margin:0;padding-left:20px;color:#ccc;line-height:2;" data-v-f1283e36><li data-v-f1283e36><strong style="color:#fff;" data-v-f1283e36>ç¬¬1æ­¥ï¼š</strong> è¾“å…¥è§¦å‘è¯ï¼ˆæ¯”å¦‚ <code style="background:#1a1a1a;padding:2px 6px;border-radius:3px;color:#4a9eff;" data-v-f1283e36>ã€çŠ¶æ€æ ã€‘</code> ï¼‰ </li><li data-v-f1283e36><strong style="color:#fff;" data-v-f1283e36>ç¬¬2æ­¥ï¼š</strong> ç”¨è‡ªç„¶è¯­è¨€æè¿°ä½ æƒ³è¦çš„ç•Œé¢ï¼ˆçœç•¥æŠ€æœ¯ç»†èŠ‚ï¼‰</li><li data-v-f1283e36><strong style="color:#fff;" data-v-f1283e36>ç¬¬3æ­¥ï¼š</strong> ç‚¹å‡»&quot;AI ç”Ÿæˆ&quot;ï¼Œç­‰å‡ ç§’é’Ÿï¼ŒAI è‡ªåŠ¨ç”Ÿæˆä»£ç </li><li data-v-f1283e36><strong style="color:#fff;" data-v-f1283e36>ç¬¬4æ­¥ï¼š</strong> çœ‹å³ä¾§<strong style="color:#51cf66;" data-v-f1283e36>å®æ—¶é¢„è§ˆ</strong>ï¼Œä¸æ»¡æ„å°±ç‚¹&quot;AI ä¿®æ”¹&quot;ç»§ç»­è°ƒæ•´ </li><li data-v-f1283e36><strong style="color:#fff;" data-v-f1283e36>ç¬¬5æ­¥ï¼š</strong> ç‚¹å‡»&quot;å¤åˆ¶æ­£åˆ™&quot;ï¼Œç›´æ¥ç²˜è´´åˆ°é…’é¦†æ­£åˆ™é‡Œå°±å®Œäº†ï¼</li><li data-v-f1283e36><strong style="color:#fff;" data-v-f1283e36>å®Œæˆï¼</strong> ç°åœ¨åœ¨èŠå¤©ä¸­è¾“å…¥ <code style="background:#1a1a1a;padding:2px 6px;border-radius:3px;color:#51cf66;" data-v-f1283e36>ã€çŠ¶æ€æ ã€‘</code> å°±ä¼šæ˜¾ç¤ºä½ çš„ç•Œé¢äº†ï¼ </li></ol></div>',1)),(0,i.createCommentVNode)(' ä¸»å†…å®¹åŒºåŸŸï¼šå·¦å³åˆ†æ  '),(0,i.createElementVNode)('div',Ho,[(0,i.createCommentVNode)(' å·¦ä¾§ï¼šè¾“å…¥åŒºåŸŸ '),(0,i.createElementVNode)('div',Uo,[(0,i.createCommentVNode)(' è§¦å‘å…³é”®è¯ '),(0,i.createElementVNode)('div',Go,[n[7]||(n[7]=(0,i.createElementVNode)('h4',{style:{color:'#4a9eff',margin:'0 0 15px 0','font-size':'16px'}},[(0,i.createElementVNode)('i',{class:'fa-solid fa-key'}),(0,i.createTextVNode)(' è§¦å‘å…³é”®è¯: ')],-1)),(0,i.withDirectives)((0,i.createElementVNode)('input',{'onUpdate:modelValue':n[0]||(n[0]=e=>t.value=e),type:'text',placeholder:'è¾“å…¥è§¦å‘è¯ï¼Œä¾‹å¦‚ï¼šã€å¼€åœºç™½ã€‘',style:{width:'100%',background:'#1a1a1a',color:'#e0e0e0',border:'1px solid #444','border-radius':'4px',padding:'12px','font-size':'14px'}},null,512),[[i.vModelText,t.value]])]),(0,i.createCommentVNode)(' ç•Œé¢æè¿°ï¼ˆAI ç”Ÿæˆï¼‰ '),(0,i.createElementVNode)('div',Yo,[n[10]||(n[10]=(0,i.createElementVNode)('h4',{style:{color:'#4a9eff',margin:'0 0 15px 0','font-size':'16px'}},[(0,i.createElementVNode)('i',{class:'fa-solid fa-magic'}),(0,i.createTextVNode)(' ç•Œé¢æè¿°ï¼ˆAI ç”Ÿæˆï¼‰: ')],-1)),n[11]||(n[11]=(0,i.createElementVNode)('p',{style:{color:'#888',margin:'0 0 10px 0','font-size':'13px'}},' ç”¨è‡ªç„¶è¯­è¨€æè¿°ä½ æƒ³è¦çš„ç•Œé¢ï¼Œæ¯”å¦‚ï¼šä¸€ä¸ªRPGæ¸¸æˆé£æ ¼çš„çŠ¶æ€æ ï¼Œæ˜¾ç¤ºç”Ÿå‘½å€¼ã€é­”åŠ›å€¼ã€ç»éªŒå€¼... ',-1)),(0,i.withDirectives)((0,i.createElementVNode)('textarea',{'onUpdate:modelValue':n[1]||(n[1]=e=>a.value=e),placeholder:'è¯¦ç»†æè¿°ä½ æƒ³è¦çš„ç•Œé¢ï¼ˆè¶Šè¯¦ç»†è¶Šå¥½ï¼‰ï¼š\n- è¯´æ¸…æ¥šä½ æƒ³è¦ä»€ä¹ˆåŠŸèƒ½ï¼ˆå¦‚ï¼šç”Ÿå‘½å€¼ã€é­”åŠ›å€¼ã€ç»éªŒå€¼ï¼‰\n- è¯´æ¸…æ¥šä½ æƒ³è¦ä»€ä¹ˆæ ·å¼ï¼ˆå¦‚ï¼šRPGæ¸¸æˆé£æ ¼ã€èµ›åšæœ‹å…‹ã€å¯çˆ±é£ç­‰ï¼‰\n- å¦‚æœæƒ³è¦ç‰¹æ®Šæ•ˆæœï¼ˆå¦‚ï¼šè¿›åº¦æ¡ã€åŠ¨ç”»ã€æŒ‰é’®ï¼‰ï¼Œä¹Ÿå†™æ¸…æ¥š\n\nä¾‹å¦‚ï¼š\næˆ‘æƒ³è¦ä¸€ä¸ªç°ä»£ç®€æ´é£æ ¼çš„çŠ¶æ€æ ï¼Œæ˜¾ç¤ºå½“å‰æ—¥æœŸã€æ—¶é—´ã€åœ°ç‚¹ã€å¤©æ°”æ¸©åº¦ã€‚',style:{width:'100%',flex:'1','min-height':'200px',background:'#1a1a1a',color:'#e0e0e0',border:'1px solid #444','border-radius':'4px',padding:'12px','font-size':'14px','font-family':'\'Consolas\', monospace',resize:'none','line-height':'1.6'}},null,512),[[i.vModelText,a.value]]),(0,i.createCommentVNode)(' AI ç”Ÿæˆ/ä¿®æ”¹æŒ‰é’® '),(0,i.createElementVNode)('div',Jo,[(0,i.createElementVNode)('button',{disabled:!t.value||!a.value||s.value,style:(0,i.normalizeStyle)([{flex:'1',background:'linear-gradient(135deg, #667eea 0%, #764ba2 100%)',color:'white',border:'none',padding:'12px 24px','border-radius':'6px',cursor:'pointer','font-size':'14px','font-weight':'600',transition:'all 0.3s'},{opacity:t.value&&a.value&&!s.value?1:.5}]),onClick:f},[n[8]||(n[8]=(0,i.createElementVNode)('i',{class:'fa-solid fa-wand-magic-sparkles'},null,-1)),(0,i.createTextVNode)(' '+(0,i.toDisplayString)(s.value?'AI ç”Ÿæˆä¸­...':o.value?'AI é‡æ–°ç”Ÿæˆ':'AI ç”Ÿæˆç•Œé¢'),1)],12,Wo),o.value?((0,i.openBlock)(),(0,i.createElementBlock)('button',{key:0,disabled:c.value,style:(0,i.normalizeStyle)([{flex:'1',background:'#ffc107',color:'#000',border:'none',padding:'12px 24px','border-radius':'6px',cursor:'pointer','font-size':'14px','font-weight':'600',transition:'all 0.3s'},{opacity:c.value?.5:1}]),onClick:x},[n[9]||(n[9]=(0,i.createElementVNode)('i',{class:'fa-solid fa-edit'},null,-1)),(0,i.createTextVNode)(' '+(0,i.toDisplayString)(c.value?'ä¿®æ”¹ä¸­...':'AI ä¿®æ”¹ç•Œé¢'),1)],12,qo)):(0,i.createCommentVNode)('v-if',!0)])])]),(0,i.createCommentVNode)(' å³ä¾§ï¼šå®æ—¶é¢„è§ˆ '),(0,i.createElementVNode)('div',Ko,[(0,i.createElementVNode)('h4',Xo,[n[12]||(n[12]=(0,i.createElementVNode)('i',{class:'fa-solid fa-eye'},null,-1)),n[13]||(n[13]=(0,i.createTextVNode)(' å®æ—¶é¢„è§ˆ ',-1)),o.value?((0,i.openBlock)(),(0,i.createElementBlock)('span',Qo,'å·²ç”Ÿæˆ')):(0,i.createCommentVNode)('v-if',!0)]),(0,i.createElementVNode)('div',Zo,[o.value?((0,i.openBlock)(),(0,i.createElementBlock)('iframe',{key:1,ref_key:'previewFrame',ref:m,srcdoc:o.value,style:{width:'100%',height:'100%',border:'none',background:'white'}},null,8,nr)):((0,i.openBlock)(),(0,i.createElementBlock)('div',er,[...n[14]||(n[14]=[(0,i.createElementVNode)('i',{class:'fa-solid fa-image',style:{'font-size':'64px','margin-bottom':'20px',opacity:'0.3'}},null,-1),(0,i.createElementVNode)('p',{style:{'font-size':'16px',margin:'0'}},'ç­‰å¾…ç”Ÿæˆ...',-1),(0,i.createElementVNode)('p',{style:{'font-size':'14px',margin:'10px 0 0 0'}},'ç‚¹å‡»"AI ç”Ÿæˆç•Œé¢"åï¼Œé¢„è§ˆå°†æ˜¾ç¤ºåœ¨è¿™é‡Œ',-1)])]))]),(0,i.createCommentVNode)(' å¤åˆ¶æ­£åˆ™æŒ‰é’® '),o.value?((0,i.openBlock)(),(0,i.createElementBlock)('button',{key:0,style:{'margin-top':'15px',background:'#51cf66',color:'white',border:'none',padding:'12px 24px','border-radius':'6px',cursor:'pointer','font-size':'14px','font-weight':'600',transition:'all 0.2s'},onClick:h},[...n[15]||(n[15]=[(0,i.createElementVNode)('i',{class:'fa-solid fa-copy'},null,-1),(0,i.createTextVNode)(' å¤åˆ¶æ­£åˆ™ä»£ç  ',-1)])])):(0,i.createCommentVNode)('v-if',!0)])]),(0,i.createCommentVNode)(' ç”Ÿæˆçš„æ­£åˆ™ä»£ç ï¼ˆå¯æŠ˜å ï¼‰ '),r.value?((0,i.openBlock)(),(0,i.createElementBlock)('div',tr,[(0,i.createElementVNode)('div',{style:{display:'flex','justify-content':'space-between','align-items':'center',cursor:'pointer','margin-bottom':'15px'},onClick:n[2]||(n[2]=e=>p.value=!p.value)},[n[16]||(n[16]=(0,i.createElementVNode)('h4',{style:{color:'#4a9eff',margin:'0'}},[(0,i.createElementVNode)('i',{class:'fa-solid fa-code'}),(0,i.createTextVNode)(' ç”Ÿæˆçš„æ­£åˆ™ä»£ç  ')],-1)),(0,i.createElementVNode)('i',{class:(0,i.normalizeClass)(p.value?'fa-solid fa-chevron-up':'fa-solid fa-chevron-down'),style:{color:'#888',transition:'transform 0.3s'}},null,2)]),p.value?((0,i.openBlock)(),(0,i.createElementBlock)('div',ar,[(0,i.createElementVNode)('pre',or,(0,i.toDisplayString)(r.value),1)])):(0,i.createCommentVNode)('v-if',!0)])):(0,i.createCommentVNode)('v-if',!0),(0,i.createCommentVNode)(' AI ä¿®æ”¹å¯¹è¯æ¡† '),g.value?((0,i.openBlock)(),(0,i.createElementBlock)('div',{key:1,style:{position:'fixed',top:'0',left:'0',right:'0',bottom:'0',background:'rgba(0, 0, 0, 0.8)','z-index':'1000000',display:'flex','align-items':'center','justify-content':'center',padding:'20px'},onClick:n[6]||(n[6]=(0,i.withModifiers)(e=>g.value=!1,['self']))},[(0,i.createElementVNode)('div',{style:{background:'#2a2a2a',border:'2px solid #ffc107','border-radius':'12px',padding:'30px','max-width':'600px',width:'100%'},onClick:n[5]||(n[5]=(0,i.withModifiers)(()=>{},['stop']))},[n[18]||(n[18]=(0,i.createElementVNode)('h3',{style:{color:'#ffc107',margin:'0 0 20px 0'}},[(0,i.createElementVNode)('i',{class:'fa-solid fa-edit'}),(0,i.createTextVNode)(' AI ä¿®æ”¹ç•Œé¢ ')],-1)),n[19]||(n[19]=(0,i.createElementVNode)('p',{style:{color:'#888',margin:'0 0 15px 0','line-height':'1.6'}},' æè¿°ä½ æƒ³è¦ä¿®æ”¹çš„åœ°æ–¹ï¼ŒAI ä¼šåœ¨å½“å‰ç•Œé¢çš„åŸºç¡€ä¸Šè¿›è¡Œè°ƒæ•´ã€‚ä¾‹å¦‚ï¼š ',-1)),n[20]||(n[20]=(0,i.createElementVNode)('ul',{style:{color:'#888',margin:'0 0 20px 0','padding-left':'20px','line-height':'1.8'}},[(0,i.createElementVNode)('li',null,'æŠŠç”Ÿå‘½å€¼è¿›åº¦æ¡æ”¹æˆçº¢è‰²'),(0,i.createElementVNode)('li',null,'å¢åŠ ä¸€ä¸ªé‡‘å¸æ˜¾ç¤º'),(0,i.createElementVNode)('li',null,'è°ƒæ•´æ•´ä½“å¸ƒå±€ï¼Œæ”¹æˆç«–å‘æ’åˆ—'),(0,i.createElementVNode)('li',null,'æ·»åŠ ä¸€ä¸ªæŒ‰é’®ï¼Œç‚¹å‡»åæ˜¾ç¤ºè¯¦ç»†ä¿¡æ¯')],-1)),(0,i.withDirectives)((0,i.createElementVNode)('textarea',{'onUpdate:modelValue':n[3]||(n[3]=e=>u.value=e),placeholder:'è¾“å…¥ä¿®æ”¹å»ºè®®...',style:{width:'100%','min-height':'150px',background:'#1a1a1a',color:'#e0e0e0',border:'1px solid #444','border-radius':'4px',padding:'12px','font-size':'14px','margin-bottom':'20px',resize:'vertical'}},null,512),[[i.vModelText,u.value]]),(0,i.createElementVNode)('div',rr,[(0,i.createElementVNode)('button',{disabled:!u.value||c.value,style:(0,i.normalizeStyle)([{flex:'1',background:'#ffc107',color:'#000',border:'none',padding:'12px 24px','border-radius':'6px',cursor:'pointer','font-size':'14px','font-weight':'600'},{opacity:!u.value||c.value?.5:1}]),onClick:b},[n[17]||(n[17]=(0,i.createElementVNode)('i',{class:'fa-solid fa-wand-magic-sparkles'},null,-1)),(0,i.createTextVNode)(' '+(0,i.toDisplayString)(c.value?'ä¿®æ”¹ä¸­...':'ç¡®è®¤ä¿®æ”¹'),1)],12,sr),(0,i.createElementVNode)('button',{style:{flex:'1',background:'#666',color:'white',border:'none',padding:'12px 24px','border-radius':'6px',cursor:'pointer','font-size':'14px','font-weight':'600'},onClick:n[4]||(n[4]=e=>g.value=!1)},' å–æ¶ˆ ')])])])):(0,i.createCommentVNode)('v-if',!0)]))}});s(705);const lr=(0,V.A)(ir,[['__scopeId','data-v-f1283e36']]),dr={class:'settings-tab',style:{padding:'25px !important',background:'#1a1a1a !important'}},cr={class:'config-section',style:{padding:'20px 25px !important','border-bottom':'1px solid #3a3a3a','margin-bottom':'5px'}},pr={class:'form-group',style:{'margin-bottom':'18px !important'}},gr={class:'form-group',style:{'margin-bottom':'18px !important'}},ur={class:'form-group',style:{'margin-bottom':'18px !important'}},mr={class:'form-group'},fr={class:'model-controls',style:{display:'flex','flex-direction':'column',gap:'10px'}},xr={style:{display:'block','margin-bottom':'6px',color:'#ccc','font-size':'13px'}},br={key:0,style:{color:'#888','font-size':'11px','margin-left':'8px'}},hr={class:'button-group',style:{display:'flex',gap:'12px','flex-wrap':'wrap','margin-top':'5px'}},yr=['disabled'],vr=['value'],wr={class:'form-group',style:{'margin-bottom':'18px !important'}},kr={class:'form-group',style:{'margin-bottom':'18px !important'}},Ar={class:'form-group',style:{'margin-bottom':'18px !important'}},Cr={class:'form-group',style:{'margin-bottom':'18px !important'}},Er={class:'form-group',style:{'margin-bottom':'18px !important'}},Tr={class:'config-section',style:{padding:'20px 25px !important','border-bottom':'1px solid #3a3a3a','margin-bottom':'5px'}},Sr={class:'form-group',style:{'margin-bottom':'18px !important'}},Nr={class:'checkbox-label',style:{display:'flex','align-items':'center',gap:'8px',color:'#ccc','font-size':'13px'}},Ir={key:0,class:'form-group',style:{'margin-bottom':'18px !important'}},_r={class:'config-section',style:{padding:'20px 25px !important','border-bottom':'1px solid #3a3a3a','margin-bottom':'5px'}},Vr={class:'form-group',style:{'margin-bottom':'18px !important'}},zr={class:'form-group',style:{'margin-bottom':'18px !important'}},Br={class:'button-group',style:{display:'flex',gap:'12px','flex-wrap':'wrap','margin-top':'5px'}},Mr=['disabled'],Pr=['disabled'],$r={key:0,class:'fa-solid fa-magic'},Dr={key:1,class:'fa-solid fa-spinner fa-spin'},jr={class:'config-section',style:{padding:'20px 25px !important','border-bottom':'1px solid #3a3a3a','margin-bottom':'5px'}},Rr={class:'form-group',style:{'margin-bottom':'18px !important'}},Or={class:'form-group',style:{'margin-bottom':'18px !important'}},Fr={class:'form-group',style:{'margin-bottom':'18px !important'}},Lr={style:{display:'flex',gap:'8px','margin-bottom':'8px'}},Hr=['value'],Ur={key:0,style:{display:'flex',gap:'8px'}},Gr={class:'form-group',style:{'margin-bottom':'18px !important'}},Yr={style:{display:'flex',gap:'12px','align-items':'center'}},Jr={style:{display:'flex','align-items':'center',gap:'6px'}},Wr={style:{display:'flex','align-items':'center',gap:'6px'}},qr={key:0,style:{'margin-left':'auto'}},Kr={class:'button-group',style:{display:'flex',gap:'12px','flex-wrap':'wrap','margin-top':'5px'}},Xr=['disabled'],Qr={key:0,class:'fa-solid fa-robot'},Zr={key:1,class:'fa-solid fa-spinner fa-spin'},es={class:'config-section',style:{padding:'20px 25px !important','border-bottom':'1px solid #3a3a3a','margin-bottom':'5px'}},ns={class:'form-group',style:{'margin-bottom':'18px !important'}},ts={class:'button-group',style:{display:'flex',gap:'12px','flex-wrap':'wrap','margin-top':'5px'}},as=['disabled'],os={key:0,class:'hidden-messages-section'},rs={class:'form-group'},ss={class:'flex-label'},is={key:0,class:'hidden-messages-list'},ls={class:'message-info'},ds={class:'message-id'},cs={class:'message-preview'},ps=['onClick'],gs={key:1,class:'empty-state'},us=(0,i.defineComponent)({__name:'SettingsTab',setup(e){const n=(0,l.C)(),{settings:t}=(0,p.storeToRefs)(n),a=(0,l.l)(),o=(0,i.ref)({api:!0,autoSummary:!0,manualSummary:!0,tableGeneration:!0,messageManagement:!0}),r=e=>{o.value[e]=!o.value[e]},c=(0,i.ref)([]),g=(0,i.ref)(!1),u=(0,i.ref)(''),m=(0,i.ref)([]),f=(0,i.ref)(!1),x=(0,i.ref)(!1),h=(0,i.ref)(!1),y=(0,i.ref)(!1),v=(0,i.ref)(null),w=(0,i.ref)([]),k=(0,i.ref)(''),A=(0,i.ref)({name:'',headers:''}),C=()=>{try{const e=(0,d.Ut)();if(!e)return void console.warn('script_id ä¸ºç©ºï¼Œæ— æ³•ä¿å­˜ç”ŸæˆçŠ¶æ€');insertOrAssignVariables({is_summarizing:x.value,is_generating_table:h.value},{type:'script',script_id:e}),console.log('å·²ä¿å­˜ç”ŸæˆçŠ¶æ€')}catch(e){console.error('ä¿å­˜ç”ŸæˆçŠ¶æ€å¤±è´¥:',e)}},E=()=>{(x.value||h.value)&&(x.value=!1,h.value=!1,C(),window.toastr.info('å·²åœæ­¢æ‰€æœ‰ç”Ÿæˆä»»åŠ¡'))},T=()=>{try{const e=(0,d.Ut)();if(!e)return void console.warn('script_id ä¸ºç©ºï¼Œæ— æ³•ä¿å­˜åˆ—å¤´æ¨¡æ¿');insertOrAssignVariables((0,b.klona)({header_templates:w.value}),{type:'script',script_id:e}),console.log('å·²ä¿å­˜åˆ—å¤´æ¨¡æ¿')}catch(e){console.error('ä¿å­˜åˆ—å¤´æ¨¡æ¿å¤±è´¥:',e)}},S=()=>{if(''!==k.value){const e=parseInt(k.value);e>=0&&e<w.value.length&&(A.value={...w.value[e]})}},N=()=>{const e=window.prompt('è¯·è¾“å…¥æ¨¡æ¿åç§°ï¼š');if(e&&e.trim()){const n=window.prompt('è¯·è¾“å…¥åˆ—å¤´ï¼ˆç”¨é€—å·åˆ†éš”ï¼‰ï¼š');n&&n.trim()&&(w.value.push({name:e.trim(),headers:n.trim()}),T(),k.value=(w.value.length-1).toString(),S(),window.toastr.success('æ¨¡æ¿æ·»åŠ æˆåŠŸ'))}},I=()=>{if(''!==k.value&&A.value.name.trim()&&A.value.headers.trim()){const e=parseInt(k.value);e>=0&&e<w.value.length&&(w.value[e]={...A.value},T(),window.toastr.success('æ¨¡æ¿ä¿å­˜æˆåŠŸ'))}else window.toastr.warning('è¯·å¡«å†™æ¨¡æ¿åç§°å’Œåˆ—å¤´')},V=()=>{if(''!==k.value&&confirm('ç¡®å®šè¦åˆ é™¤è¿™ä¸ªæ¨¡æ¿å—ï¼Ÿ')){const e=parseInt(k.value);e>=0&&e<w.value.length&&(w.value.splice(e,1),T(),k.value='',A.value={name:'',headers:''},window.toastr.success('æ¨¡æ¿åˆ é™¤æˆåŠŸ'))}},B=()=>{try{const e=(0,d.Ut)();if(!e)return void console.warn('script_id ä¸ºç©ºï¼Œæ— æ³•åŠ è½½éšè—æ¥¼å±‚æ•°æ®');console.log('è„šæœ¬ID:',e);const n=getVariables({type:'script',script_id:e});if(console.log('ä»é…’é¦†å˜é‡åŠ è½½çš„æ•°æ®:',n),console.log('æ£€æŸ¥ hidden_messages å­—æ®µ:',n?.hidden_messages),n&&n.hidden_messages)m.value=n.hidden_messages,console.log('æˆåŠŸåŠ è½½éšè—æ¥¼å±‚æ•°æ®:',m.value.length,'ä¸ª');else{console.log('æ²¡æœ‰æ‰¾åˆ°éšè—æ¥¼å±‚æ•°æ®ï¼Œå°è¯•å…¶ä»–å­—æ®µå...');const e=['hiddenMessages','hidden_floors','hiddenFloors','floor_data'];for(const t of e)if(n&&n[t]){console.log(`æ‰¾åˆ°å­—æ®µ ${t}:`,n[t]),m.value=n[t];break}}}catch(e){console.error('åŠ è½½éšè—æ¥¼å±‚æ•°æ®å¤±è´¥:',e)}},M=()=>{try{const e=(0,d.Ut)();if(!e)return void console.warn('script_id ä¸ºç©ºï¼Œæ— æ³•ä¿å­˜éšè—æ¥¼å±‚æ•°æ®');console.log('ä¿å­˜åˆ°è„šæœ¬ID:',e),console.log('è¦ä¿å­˜çš„æ•°æ®:',(0,b.klona)(m.value));const n={hidden_messages:m.value};console.log('å‡†å¤‡ä¿å­˜çš„æ•°æ®å¯¹è±¡:',(0,b.klona)(n)),insertOrAssignVariables((0,b.klona)(n),{type:'script',script_id:e}),console.log('æˆåŠŸä¿å­˜éšè—æ¥¼å±‚æ•°æ®:',m.value.length,'ä¸ª'),setTimeout(()=>{const n=getVariables({type:'script',script_id:e});console.log('éªŒè¯ä¿å­˜ç»“æœ:',n),console.log('éªŒè¯ hidden_messages å­—æ®µ:',n?.hidden_messages)},100)}catch(e){console.error('ä¿å­˜éšè—æ¥¼å±‚æ•°æ®å¤±è´¥:',e)}};(0,i.onMounted)(()=>{console.log('SettingsTab ç»„ä»¶å·²æŒ‚è½½ï¼Œå¼€å§‹åŠ è½½æ•°æ®'),(()=>{if(!t.value.api_provider||''===t.value.api_provider){const e=t.value.api_endpoint||'';e.includes('generativelanguage.googleapis.com')?t.value.api_provider='gemini':e.includes('open.bigmodel.cn')?t.value.api_provider='zhipu':t.value.api_provider='openai'}})(),B(),(()=>{try{const e=(0,d.Ut)();if(!e)return void console.warn('script_id ä¸ºç©ºï¼Œæ— æ³•åŠ è½½åˆ—å¤´æ¨¡æ¿');let n=getVariables({type:'script',script_id:e}).header_templates;Array.isArray(n)||(n=[]),w.value=n,console.log('å·²åŠ è½½åˆ—å¤´æ¨¡æ¿:',w.value.length,'ä¸ª')}catch(e){console.error('åŠ è½½åˆ—å¤´æ¨¡æ¿å¤±è´¥:',e),w.value=[]}})(),(()=>{try{const e=(0,d.Ut)();if(!e)return void console.warn('script_id ä¸ºç©ºï¼Œæ— æ³•åŠ è½½ç”ŸæˆçŠ¶æ€');const n=getVariables({type:'script',script_id:e});x.value=n.is_summarizing||!1,h.value=n.is_generating_table||!1,console.log('å·²åŠ è½½ç”ŸæˆçŠ¶æ€:',{summarizing:x.value,generating_table:h.value})}catch(e){console.error('åŠ è½½ç”ŸæˆçŠ¶æ€å¤±è´¥:',e),x.value=!1,h.value=!1}})()});const P=()=>{console.log('ğŸ’¾ æ‰‹åŠ¨ä¿å­˜è®¾ç½®...');n.saveSettings()?console.log('âœ… è®¾ç½®ä¿å­˜æˆåŠŸ'):console.error('âŒ è®¾ç½®ä¿å­˜å¤±è´¥')},D=()=>{console.log('ğŸ”„ é‡æ–°åŠ è½½è®¾ç½®...');n.reloadSettings()?console.log('âœ… è®¾ç½®é‡æ–°åŠ è½½æˆåŠŸ'):console.error('âŒ è®¾ç½®é‡æ–°åŠ è½½å¤±è´¥')},j=()=>{console.log('ğŸ”„ é‡ç½®è‡ªåŠ¨æ€»ç»“èµ·å§‹æ¥¼å±‚...');try{'function'==typeof window.resetAutoSummaryStart?window.resetAutoSummaryStart():window.toastr.error('é‡ç½®å‡½æ•°ä¸å¯ç”¨ï¼Œè¯·åˆ·æ–°é¡µé¢åé‡è¯•')}catch(e){console.error('âŒ é‡ç½®èµ·å§‹æ¥¼å±‚å¤±è´¥:',e),window.toastr.error('é‡ç½®å¤±è´¥: '+e.message)}},R=()=>{const e=t.value.api_provider,n={openai:'https://api.openai.com/v1',gemini:'https://generativelanguage.googleapis.com/v1beta/openai'};n[e]&&(t.value.api_endpoint=n[e],window.toastr.success('å·²åˆ‡æ¢åˆ° '+('openai'===e?'OpenAI':'Gemini AI Studio')))},O=()=>{try{if(!t.value.api_endpoint||!t.value.api_key)return void window.toastr.warning('è¯·å…ˆå¡«å†™ API ç«¯ç‚¹å’Œ API Key');n.saveSettings()&&console.log('API é…ç½®å·²ä¿å­˜:',{endpoint:t.value.api_endpoint,model:t.value.model,provider:t.value.api_provider,api_key:t.value.api_key?'***'+t.value.api_key.slice(-4):''})}catch(e){console.error('ä¿å­˜ API é…ç½®å¤±è´¥:',e),window.toastr.error('ä¿å­˜å¤±è´¥ï¼š'+e.message)}},F=async()=>{if(!g.value)try{if(g.value=!0,console.log('ğŸš€ å¼€å§‹æ‹‰å–æ¨¡å‹åˆ—è¡¨...'),console.log('ğŸ“ API ç«¯ç‚¹:',t.value.api_endpoint),console.log('ğŸ”‘ API Key:',t.value.api_key?'***'+t.value.api_key.slice(-4):'æœªè®¾ç½®'),!t.value.api_endpoint||!t.value.api_key)return void window.toastr.warning('è¯·å…ˆé…ç½® API ç«¯ç‚¹å’Œ API Key');window.toastr.info('æ­£åœ¨æ‹‰å–æ¨¡å‹åˆ—è¡¨ï¼Œè¯·æŸ¥çœ‹æ§åˆ¶å°äº†è§£è¯¦ç»†è¿‡ç¨‹...');const{fetchAvailableModels:e}=await Promise.resolve().then(s.bind(s,472)),n=await e();console.log('âœ… æœ€ç»ˆè·å–åˆ°çš„æ¨¡å‹åˆ—è¡¨:',n),n.length>0?(c.value=n,window.toastr.success(`ğŸ‰ æˆåŠŸè·å– ${n.length} ä¸ªæ¨¡å‹ï¼\næ¨¡å‹åˆ—è¡¨: ${n.slice(0,3).join(', ')}${n.length>3?'...':''}`),!t.value.model&&n[0]&&(t.value.model=n[0],console.log('âœ… è‡ªåŠ¨é€‰æ‹©æ¨¡å‹:',n[0]))):window.toastr.warning('æœªæ‰¾åˆ°å¯ç”¨æ¨¡å‹ï¼Œè¯·æ‰‹åŠ¨è¾“å…¥')}catch(e){console.error('âŒ æ‹‰å–æ¨¡å‹å¤±è´¥:',e);const n=e.message;n.length>200?window.toastr.error('âŒ æ‹‰å–æ¨¡å‹å¤±è´¥\n\nè¯·æ‰“å¼€æµè§ˆå™¨æ§åˆ¶å°ï¼ˆF12ï¼‰æŸ¥çœ‹è¯¦ç»†çš„è°ƒè¯•ä¿¡æ¯\n\nå¯èƒ½çš„åŸå› ï¼š\nâ€¢ API ä¸æ”¯æŒ /v1/models æ¥å£\nâ€¢ API Key æƒé™ä¸è¶³\nâ€¢ ç½‘ç»œè¿æ¥é—®é¢˜æˆ– CORS é™åˆ¶'):window.toastr.error(`âŒ æ‹‰å–æ¨¡å‹å¤±è´¥\n\n${n}`),console.error('ğŸ“‹ å®Œæ•´é”™è¯¯ä¿¡æ¯:',n)}finally{g.value=!1}},L=async()=>{try{if(console.log('æµ‹è¯•è¿æ¥...'),!t.value.api_endpoint||!t.value.api_key)return void window.toastr.warning('è¯·å…ˆé…ç½® API ç«¯ç‚¹å’Œ API Key');window.toastr.info('æ­£åœ¨æµ‹è¯•è¿æ¥ï¼Œè¯·ç¨å€™...');const{normalizeApiEndpoint:e}=await Promise.resolve().then(s.bind(s,507)),n=e(t.value.api_endpoint);console.log('ğŸ“ è§„èŒƒåŒ–çš„ç«¯ç‚¹:',n);const a=await fetch(n,{method:'POST',headers:{'Content-Type':'application/json',Authorization:`Bearer ${t.value.api_key}`},body:JSON.stringify({model:t.value.model||'gpt-3.5-turbo',messages:[{role:'user',content:'Hello'}],max_tokens:5,temperature:t.value.temperature,top_p:t.value.top_p,presence_penalty:t.value.presence_penalty,frequency_penalty:t.value.frequency_penalty})});if(a.ok){const e=await a.json();console.log('API æµ‹è¯•å“åº”:',e);const n=e.choices?.[0]?.message?.content||'(æ— å†…å®¹)',o=e.model||t.value.model;window.toastr.success(`âœ… è¿æ¥æˆåŠŸï¼\nğŸ“¦ æ¨¡å‹: ${o}\nğŸ’¬ å›å¤: ${n.substring(0,50)}...`)}else{const e=await a.text();console.error('API é”™è¯¯å“åº”:',e),window.toastr.error(`âŒ è¿æ¥å¤±è´¥ (${a.status})\nè¯¦æƒ…: ${e.substring(0,100)}`)}}catch(e){console.error('è¿æ¥æµ‹è¯•å¤±è´¥:',e),window.toastr.error('è¿æ¥æµ‹è¯•å¤±è´¥: '+e.message)}},H=async()=>{try{if(x.value)return;if(console.log('å¼€å§‹æ‰‹åŠ¨æ€»ç»“...'),x.value=!0,C(),!t.value.api_endpoint||!t.value.api_key)return void window.toastr.warning('è¯·å…ˆé…ç½® API ç«¯ç‚¹å’Œ API Key');if(void 0===t.value.start_message_id||void 0===t.value.end_message_id)return void window.toastr.warning('è¯·è®¾ç½®å¼€å§‹æ¥¼å±‚å’Œç»“æŸæ¥¼å±‚');if(t.value.start_message_id<0||t.value.end_message_id<t.value.start_message_id)return void window.toastr.warning('æ¥¼å±‚èŒƒå›´æ— æ•ˆï¼Œè¯·ç¡®ä¿ç»“æŸæ¥¼å±‚å¤§äºç­‰äºå¼€å§‹æ¥¼å±‚');console.log(`æ€»ç»“èŒƒå›´: ${t.value.start_message_id} - ${t.value.end_message_id}`),y.value=!0,v.value?.setProgress(10),v.value?.setMessage('æ­£åœ¨å‡†å¤‡ç”Ÿæˆæ€»ç»“...'),v.value?.addDetail(`æ¥¼å±‚èŒƒå›´: ${t.value.start_message_id} - ${t.value.end_message_id}`),v.value?.setProgress(30),v.value?.setMessage('æ­£åœ¨è°ƒç”¨ AI ç”Ÿæˆæ€»ç»“...'),v.value?.addDetail('è¿™å¯èƒ½éœ€è¦ 10-30 ç§’ï¼Œè¯·è€å¿ƒç­‰å¾…');const{summarizeMessages:e}=await Promise.resolve().then(s.bind(s,472)),n=await e(t.value.start_message_id,t.value.end_message_id);v.value?.setProgress(90),v.value?.setMessage('æ­£åœ¨ä¿å­˜æ€»ç»“ç»“æœ...'),console.log('æ€»ç»“å®Œæˆ:',n);const o=(0,d.Ut)();o&&insertOrAssignVariables((0,b.klona)({last_summary:n}),{type:'script',script_id:o}),a.addSummary(t.value.start_message_id??0,t.value.end_message_id??t.value.start_message_id??0,n),window.dispatchEvent(new CustomEvent('summary-history-updated')),v.value?.setProgress(100),v.value?.setMessage('âœ… æ€»ç»“å®Œæˆï¼'),v.value?.addDetail('æ€»ç»“å·²ä¿å­˜åˆ°å†å²è®°å½•'),setTimeout(()=>{y.value=!1,window.toastr.success('æ€»ç»“å®Œæˆå¹¶å·²ä¿å­˜åˆ°å†å²ï¼')},800)}catch(e){console.error('æ€»ç»“å¤±è´¥:',e),y.value=!1,window.toastr.error('æ€»ç»“å¤±è´¥: '+e.message)}finally{x.value=!1,C()}},U=async()=>{try{if(h.value)return;if(console.log('å¼€å§‹ç”Ÿæˆè¡¨æ ¼...'),h.value=!0,C(),!t.value.api_endpoint||!t.value.api_key)return void window.toastr.warning('è¯·å…ˆé…ç½® API ç«¯ç‚¹å’Œ API Key');if(y.value=!0,v.value?.setProgress(5),v.value?.setMessage('æ­£åœ¨å‡†å¤‡ç”Ÿæˆè¡¨æ ¼...'),!t.value.table_start_message_id||!t.value.table_end_message_id)return void window.toastr.warning('è¯·è®¾ç½®å¼€å§‹æ¥¼å±‚å’Œç»“æŸæ¥¼å±‚');let e=null;if(A.value.headers.trim()){confirm(`æ˜¯å¦ä½¿ç”¨æ¨¡æ¿"${A.value.name}"çš„åˆ—å¤´ï¼Ÿ\nåˆ—å¤´ï¼š${A.value.headers}`)&&(e=A.value.headers)}if(e||(e=window.prompt('è¯·è¾“å…¥è¡¨æ ¼åˆ—å¤´ï¼ˆç”¨é€—å·åˆ†éš”ï¼Œå¦‚ï¼šæ—¶é—´,äº‹ä»¶,åœ°ç‚¹,äººç‰©ï¼‰ï¼š')),!e||!e.trim())return void window.toastr.warning('è¯·è®¾ç½®è¡¨æ ¼åˆ—å¤´');const n=e.split(',').map(e=>e.trim()).filter(e=>e);if(0===n.length)return void window.toastr.warning('è¯·è®¾ç½®æœ‰æ•ˆçš„è¡¨æ ¼åˆ—å¤´');let a;v.value?.setProgress(15),v.value?.setMessage('æ­£åœ¨è·å–èŠå¤©æ¶ˆæ¯...'),v.value?.addDetail(`æ¥¼å±‚èŒƒå›´: ${t.value.table_start_message_id} - ${t.value.table_end_message_id}`);try{const e=`${t.value.table_start_message_id}-${t.value.table_end_message_id}`;console.log('è·å–æ¶ˆæ¯èŒƒå›´:',e),a=getChatMessages(e,{hide_state:'all'}),console.log('è·å–åˆ°çš„æ¶ˆæ¯æ•°é‡:',a.length),v.value?.addDetail(`è·å–åˆ° ${a.length} æ¡æ¶ˆæ¯`)}catch(e){return console.error('è·å–èŠå¤©æ¶ˆæ¯å¤±è´¥:',e),y.value=!1,void window.toastr.error('è·å–èŠå¤©æ¶ˆæ¯å¤±è´¥: '+e.message)}if(!a||0===a.length)return void window.toastr.warning('æŒ‡å®šèŒƒå›´å†…æ²¡æœ‰æ¶ˆæ¯');const o=a.map(e=>`${'user'===e.role?'ç”¨æˆ·':'AI'}: ${e.message}`).join('\n\n'),r=`è¯·æ ¹æ®ä»¥ä¸‹èŠå¤©å†…å®¹ï¼Œç”Ÿæˆè¡¨æ ¼æ•°æ®ã€‚è¡¨æ ¼åˆ—å¤´ä¸ºï¼š${n.join(', ')}\n\nèŠå¤©å†…å®¹ï¼š\n${o}\n\n**é‡è¦è¦æ±‚**ï¼š\n1. æ ¹æ®èŠå¤©å†…å®¹æå–ç›¸å…³ä¿¡æ¯å¡«å…¥è¡¨æ ¼\n2. ä¸¥æ ¼æŒ‰ç…§æä¾›çš„åˆ—å¤´é¡ºåºç”Ÿæˆæ•°æ®ï¼š${n.join(', ')}\n3. æ¯è¡Œæ•°æ®åº”è¯¥æ˜¯æœ‰æ„ä¹‰çš„ç›¸å…³ä¿¡æ¯\n4. å¦‚æœæŸä¸ªå­—æ®µæ²¡æœ‰ç›¸å…³ä¿¡æ¯ï¼Œå¡«å†™"æ— "æˆ–"-"\n5. å¿…é¡»è¿”å›çº¯JSONæ ¼å¼ï¼Œä¸è¦æ·»åŠ ä»»ä½•markdownæ ‡è®°æˆ–å…¶ä»–æ–‡å­—è¯´æ˜\n6. åªè¿”å›dataæ•°ç»„å³å¯ï¼Œheadersæˆ‘å·²ç»æœ‰äº†\n\n**è¾“å‡ºæ ¼å¼ï¼ˆåªè¿”å›è¿™ä¸ªJSONï¼Œä¸è¦å…¶ä»–å†…å®¹ï¼‰**ï¼š\n{\n  "data": [\n    ["æ•°æ®1", "æ•°æ®2", "æ•°æ®3"],\n    ["æ•°æ®4", "æ•°æ®5", "æ•°æ®6"]\n  ]\n}\n\næ³¨æ„ï¼šdataæ•°ç»„ä¸­æ¯ä¸ªå­æ•°ç»„çš„é•¿åº¦å¿…é¡»ç­‰äº${n.length}ï¼Œå¯¹åº”åˆ—å¤´ï¼š${n.join(', ')}`;console.log('å‘é€AIè¯·æ±‚...'),v.value?.setProgress(30),v.value?.setMessage('æ­£åœ¨å‘é€è¯·æ±‚åˆ° AI æœåŠ¡å™¨...'),v.value?.addDetail(`è¡¨æ ¼åˆ—å¤´: ${n.join(', ')}`);const{normalizeApiEndpoint:i}=await Promise.resolve().then(s.bind(s,507)),l=i(t.value.api_endpoint);v.value?.setProgress(40),v.value?.setMessage('ç­‰å¾… AI åˆ†æå¹¶ç”Ÿæˆè¡¨æ ¼...'),v.value?.addDetail('è¿™å¯èƒ½éœ€è¦ 10-30 ç§’ï¼Œè¯·è€å¿ƒç­‰å¾…');const c=await fetch(l,{method:'POST',headers:{'Content-Type':'application/json',Authorization:`Bearer ${t.value.api_key}`},body:JSON.stringify({model:t.value.model,messages:[{role:'user',content:r}],max_tokens:t.value.max_tokens,temperature:t.value.temperature,top_p:t.value.top_p,presence_penalty:t.value.presence_penalty,frequency_penalty:t.value.frequency_penalty})});if(!c.ok)throw new Error(`APIè¯·æ±‚å¤±è´¥: ${c.status} ${c.statusText}`);v.value?.setProgress(70),v.value?.setMessage('æ­£åœ¨æ¥æ”¶ AI å“åº”...');const p=await c.json();if(console.log('AIå“åº”:',p),!p.choices||!p.choices[0]||!p.choices[0].message)throw new Error('AIå“åº”æ ¼å¼é”™è¯¯');const g=p.choices[0].message.content;let u;console.log('AIè¿”å›å†…å®¹:',g),v.value?.setProgress(85),v.value?.setMessage('æ­£åœ¨è§£æè¡¨æ ¼æ•°æ®...');try{let e=g.trim();e=e.replace(/^```json\s*/i,'').replace(/^```\s*/,'').replace(/```\s*$/,'');const n=e.match(/\{[\s\S]*\}/);if(!n)throw new Error('æ— æ³•æ‰¾åˆ°JSONæ ¼å¼çš„è¡¨æ ¼æ•°æ®');u=JSON.parse(n[0])}catch(e){return console.error('è§£æAIå“åº”å¤±è´¥:',e),console.log('AIåŸå§‹å“åº”:',g),void window.toastr.error('AIè¿”å›çš„æ•°æ®æ ¼å¼ä¸æ­£ç¡®ï¼Œè¯·é‡è¯•')}if(!u.data||!Array.isArray(u.data))return void window.toastr.error('AIè¿”å›çš„è¡¨æ ¼æ•°æ®æ ¼å¼ä¸æ­£ç¡®ï¼šç¼ºå°‘dataæ•°ç»„');for(let e=0;e<u.data.length;e++){if(!Array.isArray(u.data[e]))return void window.toastr.error(`ç¬¬${e+1}è¡Œæ•°æ®æ ¼å¼é”™è¯¯ï¼šä¸æ˜¯æ•°ç»„`);if(u.data[e].length!==n.length)return window.toastr.error(`ç¬¬${e+1}è¡Œæ•°æ®åˆ—æ•°ä¸åŒ¹é…ï¼šæœŸæœ›${n.length}åˆ—ï¼Œå®é™…${u.data[e].length}åˆ—`),console.log('æœŸæœ›åˆ—å¤´:',n),void console.log('å®é™…æ•°æ®:',u.data[e])}const m={headers:n,data:u.data};if((0,d.pA)()){const e=getVariables({type:'chat'}).table_history||[];e.push({start_id:t.value.table_start_message_id,end_id:t.value.table_end_message_id,headers:m.headers,data:m.data}),insertOrAssignVariables((0,b.klona)({table_history:e}),{type:'chat'}),v.value?.setProgress(100),v.value?.setMessage('âœ… è¡¨æ ¼ç”Ÿæˆå®Œæˆï¼'),v.value?.addDetail(`å…±ç”Ÿæˆ ${m.data.length} è¡Œæ•°æ®`),setTimeout(()=>{y.value=!1,window.toastr.success(`è¡¨æ ¼ç”ŸæˆæˆåŠŸï¼å…±${m.data.length}è¡Œæ•°æ®`)},800),console.log('è¡¨æ ¼å·²ä¿å­˜åˆ°èŠå¤©å˜é‡:',e)}else y.value=!1,window.toastr.warning('æ— æ³•è·å–èŠå¤©IDï¼Œè¡¨æ ¼ç”Ÿæˆå¤±è´¥')}catch(e){console.error('ç”Ÿæˆè¡¨æ ¼å¤±è´¥:',e),y.value=!1,window.toastr.error('ç”Ÿæˆè¡¨æ ¼å¤±è´¥: '+e.message)}finally{h.value=!1,C()}},G=()=>{try{if(!t.value.table_start_message_id||!t.value.table_end_message_id)return void window.toastr.warning('è¯·è®¾ç½®å¼€å§‹æ¥¼å±‚å’Œç»“æŸæ¥¼å±‚');const e=window.prompt('è¯·è¾“å…¥è¡¨æ ¼åˆ—å¤´ï¼ˆç”¨é€—å·åˆ†éš”ï¼Œå¦‚ï¼šæ—¶é—´,äº‹ä»¶,åœ°ç‚¹,äººç‰©ï¼‰ï¼š');if(!e||!e.trim())return void window.toastr.warning('è¯·è®¾ç½®è¡¨æ ¼åˆ—å¤´');const n=e.split(',').map(e=>e.trim()).filter(e=>e);if(0===n.length)return void window.toastr.warning('è¯·è®¾ç½®æœ‰æ•ˆçš„è¡¨æ ¼åˆ—å¤´');const a={start_id:t.value.table_start_message_id,end_id:t.value.table_end_message_id,headers:n,data:[]};if((0,d.pA)()){const e=getVariables({type:'chat'}).table_history||[];e.push(a),insertOrAssignVariables((0,b.klona)({table_history:e}),{type:'chat'}),window.toastr.success(`ç©ºè¡¨æ ¼åˆ›å»ºæˆåŠŸï¼åˆ—å¤´ï¼š${n.join(', ')}`),console.log('ç©ºè¡¨æ ¼å·²ä¿å­˜åˆ°èŠå¤©å˜é‡:',a)}else window.toastr.warning('æ— æ³•è·å–èŠå¤©IDï¼Œè¡¨æ ¼åˆ›å»ºå¤±è´¥')}catch(e){console.error('åˆ›å»ºè¡¨æ ¼å¤±è´¥:',e),window.toastr.error('åˆ›å»ºè¡¨æ ¼å¤±è´¥: '+e.message)}},Y=async()=>{try{if(console.log('éšè—æ¥¼å±‚...'),!u.value.trim())return void window.toastr.warning('è¯·è¾“å…¥è¦éšè—çš„æ¥¼å±‚èŒƒå›´');const e=u.value.split(',').map(e=>e.trim()),n=[];for(const t of e)if(t.includes('-')){const[e,a]=t.split('-').map(Number);if(e&&a&&e<=a)for(let t=e;t<=a;t++)n.push(t)}else{const e=Number(t);e&&n.push(e)}if(0===n.length)return void window.toastr.warning('è¯·è¾“å…¥æœ‰æ•ˆçš„æ¥¼å±‚èŒƒå›´');let t;try{const e=getLastMessageId();console.log('æœ€æ–°æ¶ˆæ¯ID:',e),t=getChatMessages(`0-${e}`,{hide_state:'all'}),console.log('è·å–åˆ°çš„æ¶ˆæ¯æ•°é‡:',t.length)}catch(e){return console.error('è·å–èŠå¤©æ¶ˆæ¯å¤±è´¥:',e),void window.toastr.error('è·å–èŠå¤©æ¶ˆæ¯å¤±è´¥: '+e.message)}if(!t||0===t.length)return void window.toastr.warning('å½“å‰èŠå¤©æ²¡æœ‰æ¶ˆæ¯');let a=0;const o=[];for(const e of n){if(m.value.some(n=>n.message_id===e)){console.log(`æ¥¼å±‚ ${e} å·²ç»è¢«éšè—ï¼Œè·³è¿‡`);continue}const n=t.find(n=>n.message_id===e);n&&(o.push({message_id:e,is_hidden:!0}),m.value.push({message_id:e,name:n.name||'Unknown',role:n.role||'user',message:n.message||''}),a++)}if(o.length>0)try{console.log('å‡†å¤‡è°ƒç”¨ slash å‘½ä»¤éšè—æ¥¼å±‚:',n);for(const e of n)try{await triggerSlash(`/hide ${e}`),console.log(`æˆåŠŸéšè—æ¥¼å±‚ ${e}`)}catch(n){console.error(`éšè—æ¥¼å±‚ ${e} å¤±è´¥:`,n)}window.toastr.success('æ¥¼å±‚å·²çœŸæ­£éšè—')}catch(e){console.error('è°ƒç”¨éšè—APIå¤±è´¥:',e),window.toastr.error('éšè—æ¥¼å±‚APIè°ƒç”¨å¤±è´¥: '+e.message)}a>0?(M(),window.toastr.success(`æˆåŠŸéšè— ${a} ä¸ªæ¥¼å±‚`),u.value=''):window.toastr.warning('æœªæ‰¾åˆ°è¦éšè—çš„æ¥¼å±‚')}catch(e){console.error('éšè—æ¥¼å±‚å¤±è´¥:',e),window.toastr.error('éšè—æ¥¼å±‚å¤±è´¥: '+e.message)}},J=async()=>{try{if(console.log('æ˜¾ç¤ºæŒ‡å®šæ¥¼å±‚...'),!u.value.trim())return void window.toastr.warning('è¯·è¾“å…¥è¦æ˜¾ç¤ºçš„æ¥¼å±‚èŒƒå›´');const e=(e=>{if(!e.trim())return[];const n=[],t=e.split(',');for(const e of t){const t=e.trim();if(t)if(t.includes('-')){const[e,a]=t.split('-').map(e=>parseInt(e.trim()));if(!isNaN(e)&&!isNaN(a)&&e>=0&&a>=0)for(let t=e;t<=a;t++)n.push(t)}else{const e=parseInt(t);!isNaN(e)&&e>=0&&n.push(e)}}return n})(u.value.trim());if(0===e.length)return void window.toastr.warning('è¯·è¾“å…¥æœ‰æ•ˆçš„æ¥¼å±‚èŒƒå›´');let n;try{const e=getLastMessageId();console.log('æœ€æ–°æ¶ˆæ¯ID:',e),n=getChatMessages(`0-${e}`,{hide_state:'all'}),console.log('è·å–åˆ°çš„æ¶ˆæ¯æ•°é‡:',n.length)}catch(e){return console.error('è·å–èŠå¤©æ¶ˆæ¯å¤±è´¥:',e),void window.toastr.error('è·å–èŠå¤©æ¶ˆæ¯å¤±è´¥: '+e.message)}if(!n||0===n.length)return void window.toastr.warning('å½“å‰èŠå¤©æ²¡æœ‰æ¶ˆæ¯');const t=[];let a=0;for(const o of e){n.find(e=>e.message_id===o)&&(t.push({message_id:o,is_hidden:!1}),a++)}if(0===t.length)return void window.toastr.warning('æœªæ‰¾åˆ°è¦æ˜¾ç¤ºçš„æ¥¼å±‚');try{for(const n of e)try{await triggerSlash(`/unhide ${n}`),console.log(`æˆåŠŸæ˜¾ç¤ºæ¥¼å±‚ ${n}`)}catch(e){console.error(`æ˜¾ç¤ºæ¥¼å±‚ ${n} å¤±è´¥:`,e)}}catch(e){return console.error('è°ƒç”¨æ˜¾ç¤ºAPIå¤±è´¥:',e),void window.toastr.error('æ˜¾ç¤ºæ¥¼å±‚APIè°ƒç”¨å¤±è´¥: '+e.message)}m.value=m.value.filter(n=>!e.includes(n.message_id)),M(),window.toastr.success(`æˆåŠŸæ˜¾ç¤º ${a} ä¸ªæ¥¼å±‚`),u.value=''}catch(e){console.error('æ˜¾ç¤ºæ¥¼å±‚å¤±è´¥:',e),window.toastr.error('æ˜¾ç¤ºæ¥¼å±‚å¤±è´¥: '+e.message)}};return(e,n)=>((0,i.openBlock)(),(0,i.createElementBlock)('div',dr,[(0,i.createCommentVNode)(' API é…ç½® '),(0,i.createElementVNode)('div',cr,[(0,i.createElementVNode)('div',{style:{cursor:'pointer','user-select':'none',display:'flex','align-items':'center','justify-content':'space-between',padding:'20px 28px',background:'linear-gradient(\n            135deg,\n            rgba(30, 30, 30, 0.95) 0%,\n            rgba(38, 38, 38, 0.9) 50%,\n            rgba(30, 30, 30, 0.95) 100%\n          )','backdrop-filter':'blur(12px)','border-radius':'14px','margin-bottom':'20px',border:'1px solid rgba(255, 255, 255, 0.06)','box-shadow':'0 3px 12px rgba(0, 0, 0, 0.3),\n            inset 0 1px 0 rgba(255, 255, 255, 0.04),\n            inset 0 -1px 0 rgba(0, 0, 0, 0.2)',position:'relative',overflow:'hidden',transition:'all 0.25s cubic-bezier(0.4, 0, 0.2, 1)'},onClick:n[0]||(n[0]=e=>r('api')),onMouseenter:n[1]||(n[1]=e=>{e.currentTarget.style.background='linear-gradient(135deg, rgba(42, 42, 42, 0.98) 0%, rgba(50, 50, 50, 0.95) 50%, rgba(42, 42, 42, 0.98) 100%)',e.currentTarget.style.transform='translateX(4px) scale(1.005)',e.currentTarget.style.borderLeft='3px solid rgba(255, 193, 7, 0.6)'}),onMouseleave:n[2]||(n[2]=e=>{e.currentTarget.style.background='linear-gradient(135deg, rgba(30, 30, 30, 0.95) 0%, rgba(38, 38, 38, 0.9) 50%, rgba(30, 30, 30, 0.95) 100%)',e.currentTarget.style.transform='none',e.currentTarget.style.borderLeft='1px solid rgba(255, 255, 255, 0.06)'})},[n[37]||(n[37]=(0,i.createElementVNode)('h3',{style:{position:'relative','z-index':'1',display:'flex','align-items':'center',gap:'12px',margin:'0',color:'#fff','font-size':'16px','font-weight':'600','letter-spacing':'0.5px','text-shadow':'0 1px 2px rgba(0, 0, 0, 0.5)'}},[(0,i.createElementVNode)('i',{class:'fa-solid fa-cog',style:{color:'#17a2b8','font-size':'18px'}}),(0,i.createTextVNode)(' API é…ç½® ')],-1)),(0,i.createElementVNode)('i',{class:(0,i.normalizeClass)([o.value.api?'fa-chevron-up':'fa-chevron-down','fa-solid']),style:{color:'rgba(255, 255, 255, 0.6)','font-size':'14px',transition:'transform 0.3s'}},null,2)],32),(0,i.withDirectives)((0,i.createElementVNode)('div',null,[(0,i.createElementVNode)('div',pr,[n[39]||(n[39]=(0,i.createElementVNode)('label',{style:{display:'block','margin-bottom':'6px',color:'#ccc','font-size':'13px'}},'API æä¾›å•†',-1)),(0,i.withDirectives)((0,i.createElementVNode)('select',{'onUpdate:modelValue':n[3]||(n[3]=e=>(0,i.unref)(t).api_provider=e),onChange:R,style:{width:'100%',padding:'10px 12px',background:'#2a2a2a',border:'1px solid #3a3a3a','border-radius':'6px',color:'#e0e0e0','font-size':'13px',transition:'border-color 0.2s',cursor:'pointer'}},[...n[38]||(n[38]=[(0,i.createElementVNode)('option',{value:'openai'},'OpenAI',-1),(0,i.createElementVNode)('option',{value:'gemini'},'Gemini AI Studio',-1)])],544),[[i.vModelSelect,(0,i.unref)(t).api_provider]])]),(0,i.createElementVNode)('div',gr,[n[40]||(n[40]=(0,i.createElementVNode)('label',{style:{display:'block','margin-bottom':'6px',color:'#ccc','font-size':'13px'}},[(0,i.createTextVNode)(' API ç«¯ç‚¹ '),(0,i.createElementVNode)('span',{style:{color:'#888','font-size':'11px','margin-left':'8px'}},' (å…¼å®¹é…’é¦†æ ¼å¼ï¼Œå¡«å†™ base URL å³å¯) ')],-1)),(0,i.withDirectives)((0,i.createElementVNode)('input',{'onUpdate:modelValue':n[4]||(n[4]=e=>(0,i.unref)(t).api_endpoint=e),type:'text',placeholder:'https://ä½ çš„æœåŠ¡å™¨/v1',style:{width:'100%',padding:'10px 12px',background:'#2a2a2a',border:'1px solid #3a3a3a','border-radius':'6px',color:'#e0e0e0','font-size':'13px',transition:'border-color 0.2s'}},null,512),[[i.vModelText,(0,i.unref)(t).api_endpoint]]),n[41]||(n[41]=(0,i.createStaticVNode)('<div style="margin-top:8px;padding:8px 12px;background:rgba(74, 158, 255, 0.1);border-radius:4px;border-left:3px solid #4a9eff;"><div style="color:#4a9eff;font-size:12px;font-weight:bold;margin-bottom:4px;"> ğŸ“Œ å¸¸è§ç«¯ç‚¹ç¤ºä¾‹ï¼ˆä¸é…’é¦†æ ¼å¼ä¸€è‡´ï¼‰ï¼š </div><div style="color:#999;font-size:11px;line-height:1.6;"> â€¢ <strong>OpenAI å®˜æ–¹:</strong> https://api.openai.com/v1<br> â€¢ <strong>Gemini AI Studio:</strong> https://generativelanguage.googleapis.com/v1beta/openai/<br> â€¢ <strong>NewAPI / One API:</strong> https://ä½ çš„æœåŠ¡å™¨/v1<br> â€¢ <strong>æœ¬åœ°æ¨¡å‹ (Ollama):</strong> http://localhost:11434/v1<br> ğŸ’¡ <strong>æç¤ºï¼š</strong>ä¼šè‡ªåŠ¨è¡¥å…¨ /chat/completionsï¼Œä¹Ÿå¯ä»¥ç›´æ¥å¡«å®Œæ•´è·¯å¾„ </div></div>',1))]),(0,i.createElementVNode)('div',ur,[n[42]||(n[42]=(0,i.createElementVNode)('label',{style:{display:'block','margin-bottom':'6px',color:'#ccc','font-size':'13px'}},'API Key',-1)),(0,i.withDirectives)((0,i.createElementVNode)('input',{'onUpdate:modelValue':n[5]||(n[5]=e=>(0,i.unref)(t).api_key=e),type:'password',placeholder:'sk-...',style:{width:'100%',padding:'10px 12px',background:'#2a2a2a',border:'1px solid #3a3a3a','border-radius':'6px',color:'#e0e0e0','font-size':'13px',transition:'border-color 0.2s'}},null,512),[[i.vModelText,(0,i.unref)(t).api_key]])]),(0,i.createElementVNode)('div',mr,[(0,i.createElementVNode)('div',fr,[(0,i.createElementVNode)('label',xr,[n[43]||(n[43]=(0,i.createTextVNode)(' æ¨¡å‹åç§° ',-1)),0===c.value.length?((0,i.openBlock)(),(0,i.createElementBlock)('span',br,' (æ‰‹åŠ¨è¾“å…¥æ¨¡å‹åç§°ï¼Œå¦‚ gpt-4o-mini) ')):(0,i.createCommentVNode)('v-if',!0)]),(0,i.createElementVNode)('div',hr,[(0,i.createElementVNode)('button',{disabled:g.value,class:'fetch-button',style:{flex:'1','min-width':'120px',padding:'12px 16px',border:'1px solid #5aaeff','border-radius':'6px',cursor:'pointer','font-weight':'500','font-size':'13px',transition:'all 0.2s',display:'flex','align-items':'center','justify-content':'center',gap:'6px',background:'linear-gradient(135deg, #4a9eff 0%, #3a8edf 100%)','box-shadow':'0 2px 8px rgba(74, 158, 255, 0.25),\n                    inset 0 1px 0 rgba(255, 255, 255, 0.15)',color:'white'},onmouseover:'this.style.transform=\'translateY(-2px)\'; this.style.boxShadow=\'0 4px 12px rgba(74, 158, 255, 0.4), inset 0 1px 0 rgba(255, 255, 255, 0.15)\'',onmouseout:'this.style.transform=\'translateY(0)\'; this.style.boxShadow=\'0 2px 8px rgba(74, 158, 255, 0.25), inset 0 1px 0 rgba(255, 255, 255, 0.15)\'',onClick:F},(0,i.toDisplayString)(g.value?'æ‹‰å–ä¸­...':'ğŸ” æ‹‰å–æ¨¡å‹åˆ—è¡¨'),9,yr),(0,i.createElementVNode)('button',{class:'save-button',style:{flex:'1','min-width':'120px',padding:'12px 16px',border:'1px solid #28a745','border-radius':'6px',cursor:'pointer','font-weight':'500','font-size':'13px',transition:'all 0.2s',display:'flex','align-items':'center','justify-content':'center',gap:'6px',background:'linear-gradient(135deg, #51cf66 0%, #40c057 100%)','box-shadow':'0 2px 8px rgba(81, 207, 102, 0.25),\n                    inset 0 1px 0 rgba(255, 255, 255, 0.15)',color:'white'},onmouseover:'this.style.transform=\'translateY(-2px)\'; this.style.boxShadow=\'0 4px 12px rgba(81, 207, 102, 0.4), inset 0 1px 0 rgba(255, 255, 255, 0.15)\'',onmouseout:'this.style.transform=\'translateY(0)\'; this.style.boxShadow=\'0 2px 8px rgba(81, 207, 102, 0.25), inset 0 1px 0 rgba(255, 255, 255, 0.15)\'',onClick:O},' ğŸ’¾ ä¿å­˜é…ç½® ')])]),0===c.value.length?(0,i.withDirectives)(((0,i.openBlock)(),(0,i.createElementBlock)('input',{key:0,'onUpdate:modelValue':n[6]||(n[6]=e=>(0,i.unref)(t).model=e),type:'text',placeholder:'gpt-4o-mini æˆ– deepseek-chat ç­‰',style:{width:'100%',padding:'10px 12px',background:'#2a2a2a',border:'1px solid #3a3a3a','border-radius':'6px',color:'#e0e0e0','font-size':'13px',transition:'border-color 0.2s'}},null,512)),[[i.vModelText,(0,i.unref)(t).model]]):(0,i.withDirectives)(((0,i.openBlock)(),(0,i.createElementBlock)('select',{key:1,'onUpdate:modelValue':n[7]||(n[7]=e=>(0,i.unref)(t).model=e),class:'model-select',style:{width:'100%',padding:'10px 12px',background:'#2a2a2a',border:'1px solid #3a3a3a','border-radius':'6px',color:'#e0e0e0','font-size':'13px',transition:'border-color 0.2s'}},[((0,i.openBlock)(!0),(0,i.createElementBlock)(i.Fragment,null,(0,i.renderList)(c.value,e=>((0,i.openBlock)(),(0,i.createElementBlock)('option',{key:e,value:e},(0,i.toDisplayString)(e),9,vr))),128))],512)),[[i.vModelSelect,(0,i.unref)(t).model]])]),(0,i.createElementVNode)('div',wr,[n[44]||(n[44]=(0,i.createElementVNode)('label',{style:{display:'block','margin-bottom':'6px',color:'#ccc','font-size':'13px'}},'æœ€å¤§ Token æ•°ï¼ˆå»ºè®®4000ä»¥ä¸Šè·å¾—æ›´è¯¦ç»†çš„æ€»ç»“ï¼‰',-1)),(0,i.withDirectives)((0,i.createElementVNode)('input',{'onUpdate:modelValue':n[8]||(n[8]=e=>(0,i.unref)(t).max_tokens=e),type:'number',min:'100',max:'16000',style:{width:'100%',padding:'10px 12px',background:'#2a2a2a',border:'1px solid #3a3a3a','border-radius':'6px',color:'#e0e0e0','font-size':'13px',transition:'border-color 0.2s'}},null,512),[[i.vModelText,(0,i.unref)(t).max_tokens,void 0,{number:!0}]])]),(0,i.createElementVNode)('div',kr,[n[45]||(n[45]=(0,i.createElementVNode)('label',{style:{display:'block','margin-bottom':'6px',color:'#ccc','font-size':'13px'}},[(0,i.createTextVNode)(' Temperature (æ¸©åº¦) '),(0,i.createElementVNode)('span',{style:{color:'#888','font-size':'11px'}},'(0-2ï¼Œæ¨è 0.7)')],-1)),(0,i.withDirectives)((0,i.createElementVNode)('input',{'onUpdate:modelValue':n[9]||(n[9]=e=>(0,i.unref)(t).temperature=e),type:'number',min:'0',max:'2',step:'0.1',style:{width:'100%',padding:'10px 12px',background:'#2a2a2a',border:'1px solid #3a3a3a','border-radius':'6px',color:'#e0e0e0','font-size':'13px',transition:'border-color 0.2s'}},null,512),[[i.vModelText,(0,i.unref)(t).temperature,void 0,{number:!0}]]),n[46]||(n[46]=(0,i.createElementVNode)('div',{style:{'margin-top':'4px',color:'#888','font-size':'11px'}},' è¾ƒé«˜å€¼ï¼ˆå¦‚ 0.8ï¼‰ä½¿è¾“å‡ºæ›´éšæœºï¼Œè¾ƒä½å€¼ï¼ˆå¦‚ 0.2ï¼‰ä½¿å…¶æ›´ç¡®å®š ',-1))]),(0,i.createElementVNode)('div',Ar,[n[47]||(n[47]=(0,i.createElementVNode)('label',{style:{display:'block','margin-bottom':'6px',color:'#ccc','font-size':'13px'}},[(0,i.createTextVNode)(' Top P (æ ¸é‡‡æ ·) '),(0,i.createElementVNode)('span',{style:{color:'#888','font-size':'11px'}},'(0-1ï¼Œæ¨è 1.0)')],-1)),(0,i.withDirectives)((0,i.createElementVNode)('input',{'onUpdate:modelValue':n[10]||(n[10]=e=>(0,i.unref)(t).top_p=e),type:'number',min:'0',max:'1',step:'0.01',style:{width:'100%',padding:'10px 12px',background:'#2a2a2a',border:'1px solid #3a3a3a','border-radius':'6px',color:'#e0e0e0','font-size':'13px',transition:'border-color 0.2s'}},null,512),[[i.vModelText,(0,i.unref)(t).top_p,void 0,{number:!0}]]),n[48]||(n[48]=(0,i.createElementVNode)('div',{style:{'margin-top':'4px',color:'#888','font-size':'11px'}},' âš ï¸ ä¸€èˆ¬å»ºè®®åªæ”¹ Temperature æˆ– Top Pï¼Œä¸è¦åŒæ—¶ä¿®æ”¹ ',-1))]),(0,i.createElementVNode)('div',Cr,[n[49]||(n[49]=(0,i.createElementVNode)('label',{style:{display:'block','margin-bottom':'6px',color:'#ccc','font-size':'13px'}},[(0,i.createTextVNode)(' Presence Penalty (å­˜åœ¨æƒ©ç½š) '),(0,i.createElementVNode)('span',{style:{color:'#888','font-size':'11px'}},'(-2.0 to 2.0ï¼Œæ¨è 0)')],-1)),(0,i.withDirectives)((0,i.createElementVNode)('input',{'onUpdate:modelValue':n[11]||(n[11]=e=>(0,i.unref)(t).presence_penalty=e),type:'number',min:'-2',max:'2',step:'0.1',style:{width:'100%',padding:'10px 12px',background:'#2a2a2a',border:'1px solid #3a3a3a','border-radius':'6px',color:'#e0e0e0','font-size':'13px',transition:'border-color 0.2s'}},null,512),[[i.vModelText,(0,i.unref)(t).presence_penalty,void 0,{number:!0}]]),n[50]||(n[50]=(0,i.createElementVNode)('div',{style:{'margin-top':'4px',color:'#888','font-size':'11px'}},' æ­£å€¼æ ¹æ®æ ‡è®°æ˜¯å¦å‡ºç°è¿‡æ¥æƒ©ç½šï¼Œå¢åŠ è®¨è®ºæ–°ä¸»é¢˜çš„å¯èƒ½æ€§ ',-1))]),(0,i.createElementVNode)('div',Er,[n[51]||(n[51]=(0,i.createElementVNode)('label',{style:{display:'block','margin-bottom':'6px',color:'#ccc','font-size':'13px'}},[(0,i.createTextVNode)(' Frequency Penalty (é¢‘ç‡æƒ©ç½š) '),(0,i.createElementVNode)('span',{style:{color:'#888','font-size':'11px'}},'(-2.0 to 2.0ï¼Œæ¨è 0)')],-1)),(0,i.withDirectives)((0,i.createElementVNode)('input',{'onUpdate:modelValue':n[12]||(n[12]=e=>(0,i.unref)(t).frequency_penalty=e),type:'number',min:'-2',max:'2',step:'0.1',style:{width:'100%',padding:'10px 12px',background:'#2a2a2a',border:'1px solid #3a3a3a','border-radius':'6px',color:'#e0e0e0','font-size':'13px',transition:'border-color 0.2s'}},null,512),[[i.vModelText,(0,i.unref)(t).frequency_penalty,void 0,{number:!0}]]),n[52]||(n[52]=(0,i.createElementVNode)('div',{style:{'margin-top':'4px',color:'#888','font-size':'11px'}},' æ­£å€¼æ ¹æ®æ ‡è®°é¢‘ç‡æ¥æƒ©ç½šï¼Œé™ä½é€å­—é‡å¤åŒä¸€è¡Œçš„å¯èƒ½æ€§ ',-1))])],512),[[i.vShow,o.value.api]])]),(0,i.createCommentVNode)(' è‡ªåŠ¨æ€»ç»“ '),(0,i.createElementVNode)('div',Tr,[(0,i.createElementVNode)('div',{style:{cursor:'pointer','user-select':'none',display:'flex','align-items':'center','justify-content':'space-between',padding:'20px 28px',background:'linear-gradient(\n            135deg,\n            rgba(30, 30, 30, 0.95) 0%,\n            rgba(38, 38, 38, 0.9) 50%,\n            rgba(30, 30, 30, 0.95) 100%\n          )','backdrop-filter':'blur(12px)','border-radius':'14px','margin-bottom':'20px',border:'1px solid rgba(255, 255, 255, 0.06)','box-shadow':'0 3px 12px rgba(0, 0, 0, 0.3),\n            inset 0 1px 0 rgba(255, 255, 255, 0.04),\n            inset 0 -1px 0 rgba(0, 0, 0, 0.2)',position:'relative',overflow:'hidden',transition:'all 0.25s cubic-bezier(0.4, 0, 0.2, 1)'},onClick:n[13]||(n[13]=e=>r('autoSummary')),onMouseenter:n[14]||(n[14]=e=>{e.currentTarget.style.background='linear-gradient(135deg, rgba(42, 42, 42, 0.98) 0%, rgba(50, 50, 50, 0.95) 50%, rgba(42, 42, 42, 0.98) 100%)',e.currentTarget.style.transform='translateX(4px) scale(1.005)',e.currentTarget.style.borderLeft='3px solid rgba(255, 193, 7, 0.6)'}),onMouseleave:n[15]||(n[15]=e=>{e.currentTarget.style.background='linear-gradient(135deg, rgba(30, 30, 30, 0.95) 0%, rgba(38, 38, 38, 0.9) 50%, rgba(30, 30, 30, 0.95) 100%)',e.currentTarget.style.transform='none',e.currentTarget.style.borderLeft='1px solid rgba(255, 255, 255, 0.06)'})},[n[53]||(n[53]=(0,i.createElementVNode)('h3',{style:{position:'relative','z-index':'1',display:'flex','align-items':'center',gap:'12px',margin:'0',color:'#fff','font-size':'16px','font-weight':'600','letter-spacing':'0.5px','text-shadow':'0 1px 2px rgba(0, 0, 0, 0.5)'}},[(0,i.createElementVNode)('i',{class:'fa-solid fa-bolt',style:{color:'#ffc107','font-size':'18px'}}),(0,i.createTextVNode)(' è‡ªåŠ¨æ€»ç»“ ')],-1)),(0,i.createElementVNode)('i',{class:(0,i.normalizeClass)([o.value.autoSummary?'fa-chevron-up':'fa-chevron-down','fa-solid']),style:{color:'rgba(255, 255, 255, 0.6)','font-size':'14px',transition:'transform 0.3s'}},null,2)],32),(0,i.withDirectives)((0,i.createElementVNode)('div',null,[(0,i.createElementVNode)('div',Sr,[(0,i.createElementVNode)('label',Nr,[(0,i.withDirectives)((0,i.createElementVNode)('input',{'onUpdate:modelValue':n[16]||(n[16]=e=>(0,i.unref)(t).auto_summarize_enabled=e),type:'checkbox',style:{width:'16px',height:'16px'}},null,512),[[i.vModelCheckbox,(0,i.unref)(t).auto_summarize_enabled]]),n[54]||(n[54]=(0,i.createTextVNode)(' å¯ç”¨è‡ªåŠ¨æ€»ç»“ ',-1))])]),(0,i.unref)(t).auto_summarize_enabled?((0,i.openBlock)(),(0,i.createElementBlock)('div',Ir,[n[55]||(n[55]=(0,i.createElementVNode)('label',{style:{display:'block','margin-bottom':'6px',color:'#ccc','font-size':'13px'}},'æ¯å¤šå°‘æ¥¼å±‚æ€»ç»“ä¸€æ¬¡',-1)),(0,i.withDirectives)((0,i.createElementVNode)('input',{'onUpdate:modelValue':n[17]||(n[17]=e=>(0,i.unref)(t).summarize_interval=e),type:'number',min:'1',style:{width:'100%',padding:'10px 12px',background:'#2a2a2a',border:'1px solid #3a3a3a','border-radius':'6px',color:'#e0e0e0','font-size':'13px',transition:'border-color 0.2s'}},null,512),[[i.vModelText,(0,i.unref)(t).summarize_interval,void 0,{number:!0}]]),(0,i.createElementVNode)('div',{style:{'margin-top':'10px',display:'flex',gap:'10px'}},[(0,i.createElementVNode)('button',{style:{padding:'8px 16px',background:'linear-gradient(135deg, #667eea 0%, #764ba2 100%)',border:'none','border-radius':'6px',color:'white','font-size':'12px',cursor:'pointer',transition:'all 0.3s ease','box-shadow':'0 2px 4px rgba(0, 0, 0, 0.2)'},onmouseover:'this.style.transform=\'translateY(-1px)\'; this.style.boxShadow=\'0 4px 8px rgba(0,0,0,0.3)\'',onmouseout:'this.style.transform=\'translateY(0)\'; this.style.boxShadow=\'0 2px 4px rgba(0,0,0,0.2)\'',onClick:P},' ğŸ’¾ ä¿å­˜è®¾ç½® '),(0,i.createElementVNode)('button',{style:{padding:'8px 16px',background:'linear-gradient(135deg, #f093fb 0%, #f5576c 100%)',border:'none','border-radius':'6px',color:'white','font-size':'12px',cursor:'pointer',transition:'all 0.3s ease','box-shadow':'0 2px 4px rgba(0, 0, 0, 0.2)'},onmouseover:'this.style.transform=\'translateY(-1px)\'; this.style.boxShadow=\'0 4px 8px rgba(0,0,0,0.3)\'',onmouseout:'this.style.transform=\'translateY(0)\'; this.style.boxShadow=\'0 2px 4px rgba(0,0,0,0.2)\'',onClick:D},' ğŸ”„ é‡æ–°åŠ è½½ '),(0,i.createElementVNode)('button',{style:{padding:'8px 16px',background:'linear-gradient(135deg, #ff9a9e 0%, #fecfef 100%)',border:'none','border-radius':'6px',color:'white','font-size':'12px',cursor:'pointer',transition:'all 0.3s ease','box-shadow':'0 2px 4px rgba(0, 0, 0, 0.2)'},onmouseover:'this.style.transform=\'translateY(-1px)\'; this.style.boxShadow=\'0 4px 8px rgba(0,0,0,0.3)\'',onmouseout:'this.style.transform=\'translateY(0)\'; this.style.boxShadow=\'0 2px 4px rgba(0,0,0,0.2)\'',onClick:j},' ğŸ”„ é‡ç½®èµ·å§‹æ¥¼å±‚ ')])])):(0,i.createCommentVNode)('v-if',!0)],512),[[i.vShow,o.value.autoSummary]])]),(0,i.createCommentVNode)(' æ‰‹åŠ¨æ€»ç»“ '),(0,i.createElementVNode)('div',_r,[(0,i.createElementVNode)('div',{style:{cursor:'pointer','user-select':'none',display:'flex','align-items':'center','justify-content':'space-between',padding:'20px 28px',background:'linear-gradient(\n            135deg,\n            rgba(30, 30, 30, 0.95) 0%,\n            rgba(38, 38, 38, 0.9) 50%,\n            rgba(30, 30, 30, 0.95) 100%\n          )','backdrop-filter':'blur(12px)','border-radius':'14px','margin-bottom':'20px',border:'1px solid rgba(255, 255, 255, 0.06)','box-shadow':'0 3px 12px rgba(0, 0, 0, 0.3),\n            inset 0 1px 0 rgba(255, 255, 255, 0.04),\n            inset 0 -1px 0 rgba(0, 0, 0, 0.2)',position:'relative',overflow:'hidden',transition:'all 0.25s cubic-bezier(0.4, 0, 0.2, 1)'},onClick:n[18]||(n[18]=e=>r('manualSummary')),onMouseenter:n[19]||(n[19]=e=>{e.currentTarget.style.background='linear-gradient(135deg, rgba(42, 42, 42, 0.98) 0%, rgba(50, 50, 50, 0.95) 50%, rgba(42, 42, 42, 0.98) 100%)',e.currentTarget.style.transform='translateX(4px) scale(1.005)',e.currentTarget.style.borderLeft='3px solid rgba(255, 193, 7, 0.6)'}),onMouseleave:n[20]||(n[20]=e=>{e.currentTarget.style.background='linear-gradient(135deg, rgba(30, 30, 30, 0.95) 0%, rgba(38, 38, 38, 0.9) 50%, rgba(30, 30, 30, 0.95) 100%)',e.currentTarget.style.transform='none',e.currentTarget.style.borderLeft='1px solid rgba(255, 255, 255, 0.06)'})},[n[56]||(n[56]=(0,i.createElementVNode)('h3',{style:{position:'relative','z-index':'1',display:'flex','align-items':'center',gap:'12px',margin:'0',color:'#fff','font-size':'16px','font-weight':'600','letter-spacing':'0.5px','text-shadow':'0 1px 2px rgba(0, 0, 0, 0.5)'}},[(0,i.createElementVNode)('i',{class:'fa-solid fa-pen-to-square',style:{color:'#28a745','font-size':'18px'}}),(0,i.createTextVNode)(' æ‰‹åŠ¨æ€»ç»“ ')],-1)),(0,i.createElementVNode)('i',{class:(0,i.normalizeClass)([o.value.manualSummary?'fa-chevron-up':'fa-chevron-down','fa-solid']),style:{color:'rgba(255, 255, 255, 0.6)','font-size':'14px',transition:'transform 0.3s'}},null,2)],32),(0,i.withDirectives)((0,i.createElementVNode)('div',null,[(0,i.createElementVNode)('div',Vr,[n[57]||(n[57]=(0,i.createElementVNode)('label',{style:{display:'block','margin-bottom':'6px',color:'#ccc','font-size':'13px'}},'å¼€å§‹æ¥¼å±‚',-1)),(0,i.withDirectives)((0,i.createElementVNode)('input',{'onUpdate:modelValue':n[21]||(n[21]=e=>(0,i.unref)(t).start_message_id=e),type:'number',min:'0',style:{width:'100%',padding:'10px 12px',background:'#2a2a2a',border:'1px solid #3a3a3a','border-radius':'6px',color:'#e0e0e0','font-size':'13px',transition:'border-color 0.2s'}},null,512),[[i.vModelText,(0,i.unref)(t).start_message_id,void 0,{number:!0}]])]),(0,i.createElementVNode)('div',zr,[n[58]||(n[58]=(0,i.createElementVNode)('label',{style:{display:'block','margin-bottom':'6px',color:'#ccc','font-size':'13px'}},'ç»“æŸæ¥¼å±‚',-1)),(0,i.withDirectives)((0,i.createElementVNode)('input',{'onUpdate:modelValue':n[22]||(n[22]=e=>(0,i.unref)(t).end_message_id=e),type:'number',min:'0',style:{width:'100%',padding:'10px 12px',background:'#2a2a2a',border:'1px solid #3a3a3a','border-radius':'6px',color:'#e0e0e0','font-size':'13px',transition:'border-color 0.2s'}},null,512),[[i.vModelText,(0,i.unref)(t).end_message_id,void 0,{number:!0}]])]),(0,i.createElementVNode)('div',Br,[(0,i.createElementVNode)('button',{class:'action-button test-button',disabled:x.value,style:{flex:'1','min-width':'120px',padding:'12px 16px',border:'1px solid #4a4a4a','border-radius':'6px',cursor:'pointer','font-weight':'500','font-size':'13px',transition:'all 0.2s',display:'flex','align-items':'center','justify-content':'center',gap:'6px',background:'#3a3a3a',color:'#e0e0e0'},onClick:L},[...n[59]||(n[59]=[(0,i.createElementVNode)('i',{class:'fa-solid fa-plug'},null,-1),(0,i.createTextVNode)(' æµ‹è¯•è¿æ¥ ',-1)])],8,Mr),(0,i.createElementVNode)('button',{class:'action-button summarize-button',disabled:x.value||!(0,i.unref)(t).api_key,style:{flex:'1','min-width':'120px',padding:'12px 16px',border:'1px solid #5aaeff','border-radius':'6px',cursor:'pointer','font-weight':'500','font-size':'13px',transition:'all 0.2s',display:'flex','align-items':'center','justify-content':'center',gap:'6px',background:'linear-gradient(135deg, #4a9eff 0%, #3a8edf 100%)','box-shadow':'0 2px 8px rgba(74, 158, 255, 0.25),\n                inset 0 1px 0 rgba(255, 255, 255, 0.15)',color:'white'},onClick:H},[x.value?((0,i.openBlock)(),(0,i.createElementBlock)('i',Dr)):((0,i.openBlock)(),(0,i.createElementBlock)('i',$r)),(0,i.createTextVNode)(' '+(0,i.toDisplayString)(x.value?'æ­£åœ¨æ€»ç»“...':'æ‰‹åŠ¨æ€»ç»“'),1)],8,Pr)])],512),[[i.vShow,o.value.manualSummary]])]),(0,i.createCommentVNode)(' è¡¨æ ¼ç”Ÿæˆ '),(0,i.createElementVNode)('div',jr,[(0,i.createElementVNode)('div',{style:{cursor:'pointer','user-select':'none',display:'flex','align-items':'center','justify-content':'space-between',padding:'20px 28px',background:'linear-gradient(\n            135deg,\n            rgba(30, 30, 30, 0.95) 0%,\n            rgba(38, 38, 38, 0.9) 50%,\n            rgba(30, 30, 30, 0.95) 100%\n          )','backdrop-filter':'blur(12px)','border-radius':'14px','margin-bottom':'20px',border:'1px solid rgba(255, 255, 255, 0.06)','box-shadow':'0 3px 12px rgba(0, 0, 0, 0.3),\n            inset 0 1px 0 rgba(255, 255, 255, 0.04),\n            inset 0 -1px 0 rgba(0, 0, 0, 0.2)',position:'relative',overflow:'hidden',transition:'all 0.25s cubic-bezier(0.4, 0, 0.2, 1)'},onClick:n[23]||(n[23]=e=>r('tableGeneration')),onMouseenter:n[24]||(n[24]=e=>{e.currentTarget.style.background='linear-gradient(135deg, rgba(42, 42, 42, 0.98) 0%, rgba(50, 50, 50, 0.95) 50%, rgba(42, 42, 42, 0.98) 100%)',e.currentTarget.style.transform='translateX(4px) scale(1.005)',e.currentTarget.style.borderLeft='3px solid rgba(255, 193, 7, 0.6)'}),onMouseleave:n[25]||(n[25]=e=>{e.currentTarget.style.background='linear-gradient(135deg, rgba(30, 30, 30, 0.95) 0%, rgba(38, 38, 38, 0.9) 50%, rgba(30, 30, 30, 0.95) 100%)',e.currentTarget.style.transform='none',e.currentTarget.style.borderLeft='1px solid rgba(255, 255, 255, 0.06)'})},[n[60]||(n[60]=(0,i.createElementVNode)('h3',{style:{position:'relative','z-index':'1',display:'flex','align-items':'center',gap:'12px',margin:'0',color:'#fff','font-size':'16px','font-weight':'600','letter-spacing':'0.5px','text-shadow':'0 1px 2px rgba(0, 0, 0, 0.5)'}},[(0,i.createElementVNode)('i',{class:'fa-solid fa-table',style:{color:'#6f42c1','font-size':'18px'}}),(0,i.createTextVNode)(' è¡¨æ ¼ç”Ÿæˆ ')],-1)),(0,i.createElementVNode)('i',{class:(0,i.normalizeClass)([o.value.tableGeneration?'fa-chevron-up':'fa-chevron-down','fa-solid']),style:{color:'rgba(255, 255, 255, 0.6)','font-size':'14px',transition:'transform 0.3s'}},null,2)],32),(0,i.withDirectives)((0,i.createElementVNode)('div',null,[(0,i.createElementVNode)('div',Rr,[n[61]||(n[61]=(0,i.createElementVNode)('label',{style:{display:'block','margin-bottom':'6px',color:'#ccc','font-size':'13px'}},'å¼€å§‹æ¥¼å±‚',-1)),(0,i.withDirectives)((0,i.createElementVNode)('input',{'onUpdate:modelValue':n[26]||(n[26]=e=>(0,i.unref)(t).table_start_message_id=e),type:'number',min:'0',style:{width:'100%',padding:'10px 12px',background:'#2a2a2a',border:'1px solid #3a3a3a','border-radius':'6px',color:'#e0e0e0','font-size':'13px',transition:'border-color 0.2s'}},null,512),[[i.vModelText,(0,i.unref)(t).table_start_message_id,void 0,{number:!0}]])]),(0,i.createElementVNode)('div',Or,[n[62]||(n[62]=(0,i.createElementVNode)('label',{style:{display:'block','margin-bottom':'6px',color:'#ccc','font-size':'13px'}},'ç»“æŸæ¥¼å±‚',-1)),(0,i.withDirectives)((0,i.createElementVNode)('input',{'onUpdate:modelValue':n[27]||(n[27]=e=>(0,i.unref)(t).table_end_message_id=e),type:'number',min:'0',style:{width:'100%',padding:'10px 12px',background:'#2a2a2a',border:'1px solid #3a3a3a','border-radius':'6px',color:'#e0e0e0','font-size':'13px',transition:'border-color 0.2s'}},null,512),[[i.vModelText,(0,i.unref)(t).table_end_message_id,void 0,{number:!0}]])]),(0,i.createElementVNode)('div',Fr,[n[67]||(n[67]=(0,i.createElementVNode)('label',{style:{display:'block','margin-bottom':'6px',color:'#ccc','font-size':'13px'}},'è¡¨æ ¼åˆ—å¤´æ¨¡æ¿',-1)),(0,i.createElementVNode)('div',Lr,[(0,i.withDirectives)((0,i.createElementVNode)('select',{'onUpdate:modelValue':n[28]||(n[28]=e=>k.value=e),style:{flex:'1',padding:'8px 12px',background:'#2a2a2a',border:'1px solid #3a3a3a','border-radius':'6px',color:'#e0e0e0','font-size':'13px'},onChange:S},[n[63]||(n[63]=(0,i.createElementVNode)('option',{value:''},'é€‰æ‹©æ¨¡æ¿...',-1)),((0,i.openBlock)(!0),(0,i.createElementBlock)(i.Fragment,null,(0,i.renderList)(w.value,(e,n)=>((0,i.openBlock)(),(0,i.createElementBlock)('option',{key:n,value:n},(0,i.toDisplayString)(e.name),9,Hr))),128))],544),[[i.vModelSelect,k.value]]),(0,i.createElementVNode)('button',{style:{padding:'8px 12px',background:'#4a9eff',border:'none','border-radius':'6px',color:'white',cursor:'pointer','font-size':'12px','white-space':'nowrap'},onClick:N},[...n[64]||(n[64]=[(0,i.createElementVNode)('i',{class:'fa-solid fa-plus'},null,-1),(0,i.createTextVNode)(' æ·»åŠ  ',-1)])])]),''!==k.value?((0,i.openBlock)(),(0,i.createElementBlock)('div',Ur,[(0,i.withDirectives)((0,i.createElementVNode)('input',{'onUpdate:modelValue':n[29]||(n[29]=e=>A.value.name=e),type:'text',placeholder:'æ¨¡æ¿åç§°',style:{flex:'1',padding:'8px 12px',background:'#2a2a2a',border:'1px solid #3a3a3a','border-radius':'6px',color:'#e0e0e0','font-size':'13px'}},null,512),[[i.vModelText,A.value.name]]),(0,i.withDirectives)((0,i.createElementVNode)('input',{'onUpdate:modelValue':n[30]||(n[30]=e=>A.value.headers=e),type:'text',placeholder:'åˆ—å¤´ï¼ˆç”¨é€—å·åˆ†éš”ï¼‰',style:{flex:'2',padding:'8px 12px',background:'#2a2a2a',border:'1px solid #3a3a3a','border-radius':'6px',color:'#e0e0e0','font-size':'13px'}},null,512),[[i.vModelText,A.value.headers]]),(0,i.createElementVNode)('button',{style:{padding:'8px 12px',background:'#28a745',border:'none','border-radius':'6px',color:'white',cursor:'pointer','font-size':'12px','white-space':'nowrap'},onClick:I},[...n[65]||(n[65]=[(0,i.createElementVNode)('i',{class:'fa-solid fa-save'},null,-1),(0,i.createTextVNode)(' ä¿å­˜ ',-1)])]),(0,i.createElementVNode)('button',{style:{padding:'8px 12px',background:'#dc3545',border:'none','border-radius':'6px',color:'white',cursor:'pointer','font-size':'12px','white-space':'nowrap'},onClick:V},[...n[66]||(n[66]=[(0,i.createElementVNode)('i',{class:'fa-solid fa-trash'},null,-1),(0,i.createTextVNode)(' åˆ é™¤ ',-1)])])])):(0,i.createCommentVNode)('v-if',!0)]),(0,i.createCommentVNode)(' ç”ŸæˆçŠ¶æ€æ˜¾ç¤º '),(0,i.createElementVNode)('div',Gr,[n[71]||(n[71]=(0,i.createElementVNode)('label',{style:{display:'block','margin-bottom':'6px',color:'#ccc','font-size':'13px'}},'ç”ŸæˆçŠ¶æ€',-1)),(0,i.createElementVNode)('div',Yr,[(0,i.createElementVNode)('div',Jr,[(0,i.createElementVNode)('div',{style:(0,i.normalizeStyle)({width:'8px',height:'8px',borderRadius:'50%',backgroundColor:x.value?'#ff6b6b':'#4caf50',transition:'background-color 0.3s'})},null,4),n[68]||(n[68]=(0,i.createElementVNode)('span',{style:{color:'#ccc','font-size':'12px'}},'æ€»ç»“ç”Ÿæˆ',-1))]),(0,i.createElementVNode)('div',Wr,[(0,i.createElementVNode)('div',{style:(0,i.normalizeStyle)({width:'8px',height:'8px',borderRadius:'50%',backgroundColor:h.value?'#ff6b6b':'#4caf50',transition:'background-color 0.3s'})},null,4),n[69]||(n[69]=(0,i.createElementVNode)('span',{style:{color:'#ccc','font-size':'12px'}},'è¡¨æ ¼ç”Ÿæˆ',-1))]),x.value||h.value?((0,i.openBlock)(),(0,i.createElementBlock)('div',qr,[(0,i.createElementVNode)('button',{style:{padding:'4px 8px',background:'#dc3545',border:'none','border-radius':'4px',color:'white',cursor:'pointer','font-size':'11px'},onClick:E},[...n[70]||(n[70]=[(0,i.createElementVNode)('i',{class:'fa-solid fa-stop'},null,-1),(0,i.createTextVNode)(' åœæ­¢ç”Ÿæˆ ',-1)])])])):(0,i.createCommentVNode)('v-if',!0)])]),(0,i.createElementVNode)('div',Kr,[(0,i.createElementVNode)('button',{class:'action-button summarize-button',disabled:h.value||!(0,i.unref)(t).api_key,style:{flex:'1','min-width':'120px',padding:'12px 16px',border:'1px solid #5aaeff','border-radius':'6px',cursor:'pointer','font-weight':'500','font-size':'13px',transition:'all 0.2s',display:'flex','align-items':'center','justify-content':'center',gap:'6px',background:'linear-gradient(135deg, #4a9eff 0%, #3a8edf 100%)','box-shadow':'0 2px 8px rgba(74, 158, 255, 0.25),\n                inset 0 1px 0 rgba(255, 255, 255, 0.15)',color:'white'},onClick:U},[h.value?((0,i.openBlock)(),(0,i.createElementBlock)('i',Zr)):((0,i.openBlock)(),(0,i.createElementBlock)('i',Qr)),(0,i.createTextVNode)(' '+(0,i.toDisplayString)(h.value?'AIå¡«å……ä¸­...':'AIå¡«å……è¡¨æ ¼'),1)],8,Xr),(0,i.createElementVNode)('button',{class:'action-button create-button',style:{flex:'1','min-width':'120px',padding:'12px 16px',border:'1px solid #40c057','border-radius':'6px',cursor:'pointer','font-weight':'500','font-size':'13px',transition:'all 0.2s',display:'flex','align-items':'center','justify-content':'center',gap:'6px',background:'linear-gradient(135deg, #51cf66 0%, #40c057 100%)','box-shadow':'0 2px 8px rgba(81, 207, 102, 0.25),\n                inset 0 1px 0 rgba(255, 255, 255, 0.15)',color:'white'},onClick:G},[...n[72]||(n[72]=[(0,i.createElementVNode)('i',{class:'fa-solid fa-plus'},null,-1),(0,i.createTextVNode)(' åˆ›å»ºç©ºè¡¨æ ¼ ',-1)])])])],512),[[i.vShow,o.value.tableGeneration]])]),(0,i.createCommentVNode)(' æ¥¼å±‚ç®¡ç† '),(0,i.createElementVNode)('div',es,[(0,i.createElementVNode)('div',{style:{cursor:'pointer','user-select':'none',display:'flex','align-items':'center','justify-content':'space-between',padding:'20px 28px',background:'linear-gradient(\n            135deg,\n            rgba(30, 30, 30, 0.95) 0%,\n            rgba(38, 38, 38, 0.9) 50%,\n            rgba(30, 30, 30, 0.95) 100%\n          )','backdrop-filter':'blur(12px)','border-radius':'14px','margin-bottom':'20px',border:'1px solid rgba(255, 255, 255, 0.06)','box-shadow':'0 3px 12px rgba(0, 0, 0, 0.3),\n            inset 0 1px 0 rgba(255, 255, 255, 0.04),\n            inset 0 -1px 0 rgba(0, 0, 0, 0.2)',position:'relative',overflow:'hidden',transition:'all 0.25s cubic-bezier(0.4, 0, 0.2, 1)'},onClick:n[31]||(n[31]=e=>r('messageManagement')),onMouseenter:n[32]||(n[32]=e=>{e.currentTarget.style.background='linear-gradient(135deg, rgba(42, 42, 42, 0.98) 0%, rgba(50, 50, 50, 0.95) 50%, rgba(42, 42, 42, 0.98) 100%)',e.currentTarget.style.transform='translateX(4px) scale(1.005)',e.currentTarget.style.borderLeft='3px solid rgba(255, 193, 7, 0.6)'}),onMouseleave:n[33]||(n[33]=e=>{e.currentTarget.style.background='linear-gradient(135deg, rgba(30, 30, 30, 0.95) 0%, rgba(38, 38, 38, 0.9) 50%, rgba(30, 30, 30, 0.95) 100%)',e.currentTarget.style.transform='none',e.currentTarget.style.borderLeft='1px solid rgba(255, 255, 255, 0.06)'})},[n[73]||(n[73]=(0,i.createElementVNode)('h3',{style:{position:'relative','z-index':'1',display:'flex','align-items':'center',gap:'12px',margin:'0',color:'#fff','font-size':'16px','font-weight':'600','letter-spacing':'0.5px','text-shadow':'0 1px 2px rgba(0, 0, 0, 0.5)'}},[(0,i.createElementVNode)('i',{class:'fa-solid fa-layer-group',style:{color:'#dc3545','font-size':'18px'}}),(0,i.createTextVNode)(' æ¥¼å±‚ç®¡ç† ')],-1)),(0,i.createElementVNode)('i',{class:(0,i.normalizeClass)([o.value.messageManagement?'fa-chevron-up':'fa-chevron-down','fa-solid']),style:{color:'rgba(255, 255, 255, 0.6)','font-size':'14px',transition:'transform 0.3s'}},null,2)],32),(0,i.withDirectives)((0,i.createElementVNode)('div',null,[(0,i.createElementVNode)('div',ns,[n[74]||(n[74]=(0,i.createElementVNode)('label',{style:{display:'block','margin-bottom':'6px',color:'#ccc','font-size':'13px'}},'éšè—æ¥¼å±‚èŒƒå›´ï¼ˆå¦‚ï¼š1-10 æˆ–å•ä¸ªæ¥¼å±‚å¦‚ï¼š5ï¼‰',-1)),(0,i.withDirectives)((0,i.createElementVNode)('input',{'onUpdate:modelValue':n[34]||(n[34]=e=>u.value=e),type:'text',placeholder:'1-10',style:{width:'100%',padding:'10px 12px',background:'#2a2a2a',border:'1px solid #3a3a3a','border-radius':'6px',color:'#e0e0e0','font-size':'13px',transition:'border-color 0.2s'}},null,512),[[i.vModelText,u.value]])]),(0,i.createElementVNode)('div',ts,[(0,i.createElementVNode)('button',{class:'action-button',style:{flex:'1','min-width':'120px',padding:'12px 16px',border:'1px solid #ff5252','border-radius':'6px',cursor:'pointer','font-weight':'500','font-size':'13px',transition:'all 0.2s',display:'flex','align-items':'center','justify-content':'center',gap:'6px',background:'#ff6b6b',color:'white'},onClick:Y},[...n[75]||(n[75]=[(0,i.createElementVNode)('i',{class:'fa-solid fa-eye-slash'},null,-1),(0,i.createTextVNode)(' éšè—æ¥¼å±‚ ',-1)])]),(0,i.createElementVNode)('button',{class:'action-button',style:{flex:'1','min-width':'120px',padding:'12px 16px',border:'1px solid #40c057','border-radius':'6px',cursor:'pointer','font-weight':'500','font-size':'13px',transition:'all 0.2s',display:'flex','align-items':'center','justify-content':'center',gap:'6px',background:'linear-gradient(135deg, #51cf66 0%, #40c057 100%)','box-shadow':'0 2px 8px rgba(81, 207, 102, 0.25),\n                inset 0 1px 0 rgba(255, 255, 255, 0.15)',color:'white'},disabled:!u.value.trim(),onClick:J},[...n[76]||(n[76]=[(0,i.createElementVNode)('i',{class:'fa-solid fa-eye'},null,-1),(0,i.createTextVNode)(' æ˜¾ç¤ºæ¥¼å±‚ ',-1)])],8,as),(0,i.createElementVNode)('button',{class:'action-button',style:{flex:'1','min-width':'120px',padding:'12px 16px',border:'1px solid #ffcc02','border-radius':'6px',cursor:'pointer','font-weight':'500','font-size':'13px',transition:'all 0.2s',display:'flex','align-items':'center','justify-content':'center',gap:'6px',background:'#ffd43b',color:'#333'},onClick:n[35]||(n[35]=()=>(async(e=!1)=>{try{let n;console.log('åˆ·æ–°éšè—æ¥¼å±‚',e),0===m.value.length&&(console.log('éšè—æ¥¼å±‚åˆ—è¡¨ä¸ºç©ºï¼Œå…ˆåŠ è½½æ•°æ®...'),B());try{const e=getLastMessageId();console.log('æœ€æ–°æ¶ˆæ¯ID:',e),n=getChatMessages(`0-${e}`,{hide_state:'all'}),console.log('è·å–åˆ°çš„æ¶ˆæ¯æ•°é‡:',n.length)}catch(n){return console.error('è·å–èŠå¤©æ¶ˆæ¯å¤±è´¥:',n),void(e&&window.toastr.error('è·å–èŠå¤©æ¶ˆæ¯å¤±è´¥: '+n.message))}if(!n||0===n.length)return void(e&&window.toastr.warning('å½“å‰èŠå¤©æ²¡æœ‰æ¶ˆæ¯'));const t=[];let a=0;for(const e of m.value){const o=n.find(n=>n.message_id===e.message_id);o?t.push({message_id:e.message_id,name:o.name||e.name,role:o.role||e.role,message:o.message||e.message}):a++}m.value=t,M(),e&&(a>0?window.toastr.success(`åˆ·æ–°å®Œæˆï¼Œç§»é™¤äº† ${a} ä¸ªä¸å­˜åœ¨çš„æ¥¼å±‚`):window.toastr.success('åˆ·æ–°å®Œæˆï¼Œæ‰€æœ‰éšè—æ¥¼å±‚ä»ç„¶æœ‰æ•ˆ')),console.log(`åˆ·æ–°å®Œæˆï¼š${t.length} ä¸ªæœ‰æ•ˆéšè—æ¥¼å±‚ï¼Œ${a} ä¸ªå·²ç§»é™¤`)}catch(n){console.error('åˆ·æ–°éšè—æ¥¼å±‚å¤±è´¥:',n),e&&window.toastr.error('åˆ·æ–°éšè—æ¥¼å±‚å¤±è´¥: '+n.message)}})(!0))},[...n[77]||(n[77]=[(0,i.createElementVNode)('i',{class:'fa-solid fa-refresh'},null,-1),(0,i.createTextVNode)(' åˆ·æ–° ',-1)])])]),(0,i.createCommentVNode)(' æ˜¾ç¤ºéšè—çš„æ¥¼å±‚åˆ—è¡¨ '),m.value.length>0?((0,i.openBlock)(),(0,i.createElementBlock)('div',os,[(0,i.createElementVNode)('div',rs,[(0,i.createElementVNode)('label',ss,[(0,i.createElementVNode)('span',null,'å·²éšè—çš„æ¥¼å±‚ ('+(0,i.toDisplayString)(m.value.length)+' ä¸ª)',1),(0,i.createElementVNode)('button',{class:'mini-button',onClick:n[36]||(n[36]=e=>f.value=!f.value)},(0,i.toDisplayString)(f.value?'æ”¶èµ·':'å±•å¼€'),1)])]),f.value?((0,i.openBlock)(),(0,i.createElementBlock)('div',is,[((0,i.openBlock)(!0),(0,i.createElementBlock)(i.Fragment,null,(0,i.renderList)(m.value,e=>((0,i.openBlock)(),(0,i.createElementBlock)('div',{key:e.message_id,class:'hidden-message-item'},[(0,i.createElementVNode)('div',ls,[(0,i.createElementVNode)('span',ds,'#'+(0,i.toDisplayString)(e.message_id),1),(0,i.createElementVNode)('span',{class:(0,i.normalizeClass)(['message-role','role-'+e.role])},(0,i.toDisplayString)('user'===e.role?'ğŸ‘¤':'assistant'===e.role?'ğŸ¤–':'âš™ï¸')+' '+(0,i.toDisplayString)(e.name),3),(0,i.createElementVNode)('span',cs,(0,i.toDisplayString)(e.message.substring(0,50))+(0,i.toDisplayString)(e.message.length>50?'...':''),1)]),(0,i.createElementVNode)('button',{class:'show-button',onClick:()=>(async e=>{try{console.log('æ˜¾ç¤ºå•ä¸ªæ¥¼å±‚',e);const n=m.value.findIndex(n=>n.message_id===e);if(-1===n)return void window.toastr.warning(`æ¥¼å±‚ #${e} ä¸åœ¨éšè—åˆ—è¡¨ä¸­`);try{await triggerSlash(`/unhide ${e}`),console.log('æˆåŠŸæ˜¾ç¤ºæ¥¼å±‚:',e)}catch(e){return console.error('è°ƒç”¨æ˜¾ç¤ºAPIå¤±è´¥:',e),void window.toastr.warning('æ˜¾ç¤ºæ¥¼å±‚APIè°ƒç”¨å¤±è´¥')}m.value.splice(n,1),M(),window.toastr.success(`å·²æ˜¾ç¤ºæ¥¼å±‚ #${e}`)}catch(e){console.error('æ˜¾ç¤ºå•ä¸ªæ¥¼å±‚å¤±è´¥:',e),window.toastr.error('æ˜¾ç¤ºå•ä¸ªæ¥¼å±‚å¤±è´¥: '+e.message)}})(e.message_id)},'æ˜¾ç¤º',8,ps)]))),128))])):(0,i.createCommentVNode)('v-if',!0)])):((0,i.openBlock)(),(0,i.createElementBlock)('div',gs,'æš‚æ— éšè—çš„æ¥¼å±‚'))],512),[[i.vShow,o.value.messageManagement]])]),(0,i.createCommentVNode)(' è¿›åº¦å¯¹è¯æ¡† '),(0,i.createVNode)(pa,{ref_key:'progressDialogRef',ref:v,show:y.value,title:'AI æ­£åœ¨å¤„ç†'},null,8,['show'])]))}});s(954);const ms=us,fs={class:'statusbar-generator'},xs={class:'section-header',style:{display:'flex','justify-content':'space-between','align-items':'center',padding:'20px 28px',background:'linear-gradient(\n          135deg,\n          rgba(30, 30, 30, 0.95) 0%,\n          rgba(38, 38, 38, 0.9) 50%,\n          rgba(30, 30, 30, 0.95) 100%\n        )','backdrop-filter':'blur(12px)','border-radius':'14px','margin-bottom':'20px',border:'1px solid rgba(255, 255, 255, 0.06)','box-shadow':'0 3px 12px rgba(0, 0, 0, 0.3),\n          inset 0 1px 0 rgba(255, 255, 255, 0.04),\n          inset 0 -1px 0 rgba(0, 0, 0, 0.2)'}},bs={style:{display:'flex',gap:'10px','flex-wrap':'wrap'}},hs={style:{display:'grid','grid-template-columns':'280px 1fr 500px',gap:'20px','min-height':'600px'}},ys={style:{background:'#2a2a2a','border-radius':'12px',padding:'15px',border:'1px solid #3a3a3a',display:'flex','flex-direction':'column','overflow-y':'auto'}},vs={style:{'margin-bottom':'15px'}},ws={style:{flex:'1',display:'flex','flex-direction':'column',gap:'10px','margin-bottom':'15px'}},ks={style:{display:'flex','justify-content':'space-between','align-items':'center','margin-bottom':'8px'}},As={style:{color:'#4a9eff','font-size':'11px','font-weight':'600'}},Cs=['disabled','onClick'],Es=['onUpdate:modelValue'],Ts=['onUpdate:modelValue'],Ss={style:{display:'flex',gap:'6px','align-items':'center'}},Ns=['onUpdate:modelValue'],Is=['onClick'],_s={key:1,class:'fa-solid fa-icons'},Vs={style:{background:'#2a2a2a','border-radius':'12px',padding:'15px',border:'1px solid #3a3a3a',display:'flex','flex-direction':'column'}},zs={style:{display:'flex',gap:'8px','margin-bottom':'12px','border-bottom':'1px solid #3a3a3a','padding-bottom':'8px'}},Bs=['onClick'],Ms={style:{display:'flex','flex-direction':'column',gap:'15px','overflow-y':'auto'}},Ps={style:{background:'#2a2a2a','border-radius':'12px',padding:'15px',border:'1px solid #3a3a3a'}},$s={style:{background:'#1e1e1e','border-radius':'8px',padding:'12px',border:'1px solid #3a3a3a',overflow:'auto','max-height':'200px'}},Ds={style:{margin:'0',color:'#e0e0e0','font-size':'11px','line-height':'1.6','white-space':'pre-wrap','word-wrap':'break-word','font-family':'\'Consolas\', \'Monaco\', monospace'}},js={style:{background:'#2a2a2a','border-radius':'12px',padding:'15px',border:'1px solid #3a3a3a',flex:'1'}},Rs=['innerHTML'],Os={style:{background:'#2a2a2a','border-radius':'12px',padding:'20px',width:'600px','max-width':'90vw',border:'1px solid #3a3a3a'}},Fs={style:{display:'grid','grid-template-columns':'repeat(8, 1fr)',gap:'8px','margin-bottom':'16px','max-height':'400px','overflow-y':'auto'}},Ls=['title','onClick'],Hs={style:{display:'flex',gap:'10px','justify-content':'flex-end'}},Us={style:{background:'#2a2a2a','border-radius':'12px',padding:'24px',width:'600px','max-width':'90vw','max-height':'90vh','overflow-y':'auto',border:'1px solid #3a3a3a'}},Gs={style:{background:'linear-gradient(135deg, rgba(59, 130, 246, 0.15) 0%, rgba(37, 99, 235, 0.1) 100%)',border:'1px solid rgba(59, 130, 246, 0.3)','border-radius':'8px',padding:'12px 16px','margin-bottom':'16px'}},Ys={style:{display:'flex','align-items':'center','justify-content':'space-between','margin-bottom':'10px'}},Js={style:{display:'flex','align-items':'center',gap:'10px'}},Ws={style:{color:'#93c5fd','font-size':'13px','font-weight':'600'}},qs={key:0,style:{display:'flex','flex-direction':'column',gap:'8px'}},Ks={style:{color:'#60a5fa','font-weight':'600','font-size':'11px','min-width':'50px'}},Xs=['onUpdate:modelValue'],Qs=['onUpdate:modelValue'],Zs=['onClick'],ei=['disabled','onClick'],ni={key:1,style:{color:'#fbbf24','font-size':'12px',padding:'8px 0'}},ti={style:{display:'flex',gap:'10px','justify-content':'flex-end'}},ai={key:0,style:{'margin-top':'16px',display:'flex',gap:'10px','justify-content':'flex-end'}},oi=['disabled'],ri={style:{background:'#2a2a2a','border-radius':'12px',padding:'24px',width:'90%','max-width':'700px','max-height':'80vh','overflow-y':'auto','box-shadow':'0 8px 32px rgba(0, 0, 0, 0.5)'}},si={style:{'margin-bottom':'16px'}},ii={style:{display:'flex',gap:'10px','justify-content':'flex-end'}},li=['disabled'],di=['disabled'],ci={style:{background:'#2a2a2a','border-radius':'12px',padding:'24px',width:'90%','max-width':'700px','max-height':'80vh','overflow-y':'auto','box-shadow':'0 8px 32px rgba(0, 0, 0, 0.5)'}},pi={style:{'margin-bottom':'16px'}},gi={style:{display:'flex',gap:'10px','justify-content':'flex-end'}},ui=['disabled'],mi=['disabled'],fi=(0,i.defineComponent)({__name:'StatusBarGenerator',setup(e){const n=(0,l.C)(),{settings:t}=(0,p.storeToRefs)(n),a={simple:{name:'ç®€å•çŠ¶æ€æ ',findRegex:'<-CHARACTER_STATUS->',fields:[{name:'å§“å',label:'å§“å',icon:'fa-solid fa-user'},{name:'æ€§åˆ«',label:'æ€§åˆ«',icon:'fa-solid fa-venus-mars'},{name:'å¹´é¾„',label:'å¹´é¾„',icon:'fa-solid fa-cake-candles'},{name:'å¥½æ„Ÿåº¦',label:'å¥½æ„Ÿåº¦',icon:'fa-solid fa-heart'}]},abo:{name:'ABOè®¾å®šçŠ¶æ€æ ',findRegex:'<-ENVIRONMENT_DATA->[\\r\\n]*\\|([^|]+)\\|([^|]+)\\|([^|]+)\\|([^|]+)\\|[\\r\\n]*<-CHARACTER_STATUS->[\\r\\n]*\\|([^|]+)\\|([^|]+)\\|([^|]+)\\|([^|]+)\\|[\\r\\n]*',fields:[{name:'æ—¥æœŸ',label:'æ—¥æœŸ',icon:'fa-solid fa-calendar'},{name:'æ—¶é—´',label:'æ—¶é—´',icon:'fa-solid fa-clock'},{name:'åœ°ç‚¹',label:'åœ°ç‚¹',icon:'fa-solid fa-location-dot'},{name:'å¤©æ°”æ¸©åº¦',label:'å¤©æ°”æ¸©åº¦',icon:'fa-solid fa-cloud-sun'},{name:'ç€è£…',label:'ç€è£…',icon:'fa-solid fa-shirt'},{name:'é»äººç¨‹åº¦',label:'é»äººç¨‹åº¦',icon:'fa-solid fa-heart'},{name:'å‘æƒ…çŠ¶æ€',label:'å‘æƒ…çŠ¶æ€',icon:'fa-solid fa-fire'},{name:'æ ‡è®°æƒ…å†µ',label:'æ ‡è®°æƒ…å†µ',icon:'fa-solid fa-bookmark'}]}},o=(0,i.ref)({name:'è§’è‰²çŠ¶æ€æ ',findRegex:'<-CHARACTER_STATUS->',fields:[{name:'å§“å',label:'å§“å',icon:'fa-solid fa-user'},{name:'æ€§åˆ«',label:'æ€§åˆ«',icon:'fa-solid fa-venus-mars'},{name:'å¹´é¾„',label:'å¹´é¾„',icon:'fa-solid fa-cake-candles'},{name:'å¥½æ„Ÿåº¦',label:'å¥½æ„Ÿåº¦',icon:'fa-solid fa-heart'}]}),r=(0,i.ref)([{path:'index.html',content:''},{path:'style.css',content:''},{path:'script.js',content:''}]),s=(0,i.ref)(r.value[0]),c=(0,i.ref)(!1),g=(0,i.ref)(''),u=(0,i.ref)(''),m=(0,i.ref)(!1),f=(0,i.ref)(!1),x=(0,i.ref)(null),b=(0,i.ref)(!1),h=(0,i.ref)(null),y=(0,i.ref)(''),v=(0,i.ref)(!1),w=(0,i.ref)(!1),k=(0,i.ref)(''),A=(0,i.ref)(!1),C=(0,i.ref)(!1),E=(0,i.ref)(!1),T=(0,i.ref)(''),S=(0,i.ref)(!1),N=(0,i.ref)(!1),I=(0,i.ref)(''),V=(0,i.ref)(!1),B=['fa-solid fa-cat','fa-solid fa-dog','fa-solid fa-dove','fa-solid fa-fish','fa-solid fa-paw','fa-solid fa-spider','fa-solid fa-horse','fa-solid fa-heart','fa-solid fa-heart-pulse','fa-solid fa-face-smile','fa-solid fa-face-grin-stars','fa-solid fa-face-grin-beam','fa-solid fa-face-laugh','fa-solid fa-star','fa-solid fa-wand-magic-sparkles','fa-solid fa-hat-wizard','fa-solid fa-bolt','fa-solid fa-fire','fa-solid fa-meteor','fa-solid fa-rocket','fa-solid fa-sun','fa-solid fa-moon','fa-solid fa-cloud','fa-solid fa-seedling','fa-solid fa-leaf','fa-solid fa-tree','fa-solid fa-snowflake','fa-solid fa-cake-candles','fa-solid fa-candy-cane','fa-solid fa-apple','fa-solid fa-ice-cream','fa-solid fa-gem','fa-solid fa-crown','fa-solid fa-gift','fa-solid fa-ribbon','fa-solid fa-medal','fa-solid fa-trophy','fa-solid fa-shield','fa-solid fa-scroll','fa-solid fa-book','fa-solid fa-book-open','fa-solid fa-feather','fa-solid fa-pen','fa-solid fa-paintbrush','fa-solid fa-palette','fa-solid fa-music','fa-solid fa-headphones','fa-solid fa-gamepad','fa-solid fa-chess','fa-solid fa-puzzle-piece','fa-solid fa-dice','fa-solid fa-mobile-screen','fa-solid fa-tablet','fa-solid fa-laptop','fa-solid fa-camera','fa-solid fa-video','fa-solid fa-tv','fa-solid fa-bell','fa-solid fa-envelope'],M=(0,i.computed)(()=>{o.value.fields.map(e=>`{{${e.label||e.name}}}`).join('|');const e=o.value.fields.map(e=>{const n=e.icon?`<i class="${e.icon}"></i> `:'',t=e.label||e.name;return`  - ${n}${t}ï¼šæè¿°{{char}}çš„${t}çŠ¶æ€`}).join('\n'),{formatExample:n,exampleOutput:t}=(o.value.fields.map(e=>e.label||e.name||'ç¤ºä¾‹å€¼').join('|'),((e,n)=>{if(0===(e.match(/<-[^>]+->/g)||[]).length){return{formatExample:`|${n.map(e=>`{{${e.label||e.name}}}`).join('|')}|`,exampleOutput:`|${n.map(e=>e.label||e.name).join('|')}|`}}let t=e.replace(/\\\\/g,'\\').replace(/\\\|/g,'|').replace(/\\\(/g,'(').replace(/\\\)/g,')').replace(/\\\[/g,'[').replace(/\\\]/g,']').replace(/\\\+/g,'+');console.log('ğŸ” åŸå§‹æ­£åˆ™:',e),console.log('ğŸ” è§„èŒƒåŒ–æ­£åˆ™:',t);const a=[],o=[];let r=0;const s=t.split(/(<-[^>]+->)/);console.log('ğŸ” åˆ†å‰²åçš„éƒ¨åˆ†:',s);for(let e=0;e<s.length;e++){const t=s[e];if(t.match(/<-[^>]+->/))a.push(t),o.push(t),console.log(`ğŸ“ æ ‡è®°: ${t}`);else if(t.trim().length>0&&!t.match(/<-[^>]+->/)){const e=t.match(/\([^\)]+\)/g)||[],s=e.length;if(console.log(`ğŸ”¢ éƒ¨åˆ†å†…å®¹ (å‰100å­—ç¬¦): "${t.substring(0,100)}"`),console.log('ğŸ”¢ åŒ¹é…åˆ°çš„æ•è·ç»„:',e),console.log(`ğŸ”¢ æ•è·ç»„æ•°é‡: ${s}, å½“å‰å­—æ®µç´¢å¼•: ${r}, æ€»å­—æ®µæ•°: ${n.length}`),0===s){console.warn('âš ï¸ æœªæ‰¾åˆ°æ•è·ç»„ï¼Œè·³è¿‡æ­¤éƒ¨åˆ†');continue}const i=4;for(let e=0;e<s;e+=i){const t=Math.min(i,s-e);if(t>0){const e=n.slice(r,r+t);for(;e.length<t;)e.push({name:`å­—æ®µ${r+e.length+1}`,label:`å­—æ®µ${r+e.length+1}`,icon:''});const s=e.map(e=>`{{${e.label||e.name}}}`).join('|'),i=e.map(e=>e.label||e.name).join('|');a.push(`|${s}|`),o.push(`|${i}|`),console.log(`âœ… æ·»åŠ å­—æ®µè¡Œ: |${i}|`),r+=t}}}}return console.log('ğŸ“Š æœ€ç»ˆæ ¼å¼ç¤ºä¾‹:',a.join('\n')),console.log('ğŸ“Š æœ€ç»ˆè¾“å‡ºç¤ºä¾‹:',o.join('\n')),{formatExample:a.join('\n'),exampleOutput:o.join('\n')}})(o.value.findRegex,o.value.fields));return`<status_rule>\n#æ¯ä¸€æ¬¡å›å¤éƒ½å¿…é¡»åœ¨æœ«å°¾åŠ ä¸Šå®Œæ•´çš„çŠ¶æ€æ ï¼Œå®æ—¶æ›´æ–°{{char}}çš„çŠ¶æ€ã€‚\n\n##çŠ¶æ€æ æ ¼å¼ï¼š\n<status>\n${n}\n</status>\n\n##å­—æ®µè¯´æ˜\n${e||'  - æš‚æ— å­—æ®µï¼Œè¯·å…ˆåœ¨ç”Ÿæˆå™¨ä¸­æ·»åŠ å­—æ®µ'}\n\n##è¾“å‡ºç¤ºä¾‹\næ­¤å¤„ä»…ä¸ºæ ¼å¼ç¤ºä¾‹ï¼Œå…·ä½“å†…å®¹éœ€æ ¹æ®å‰§æƒ…å¡«å†™\n<status>\n${t}\n</status>\n\n##æ ¼å¼è¦æ±‚ï¼ˆå¿…è¯»ï¼‰ï¼š\n1. **å¿…é¡»åŒ…å« <status> æ ‡ç­¾**ï¼š\n   - âœ… å¼€å¤´ï¼š<status>\n   - âœ… ç»“å°¾ï¼š</status>\n   - âŒ ç¼ºå°‘æ ‡ç­¾å°†æ— æ³•æ­£ç¡®æ¸²æŸ“\n\n2. **ä¸¥æ ¼æŒ‰ç…§ä¸Šè¿°ç¤ºä¾‹æ ¼å¼è¾“å‡º**ï¼š\n   - æ¯ä¸ªæ ‡è®°ï¼ˆå¦‚ <-ENVIRONMENT_DATA->ï¼‰å¿…é¡»ç‹¬å ä¸€è¡Œ\n   - æ¯è¡Œå­—æ®µç”¨ç«–çº¿ | åˆ†éš”ï¼Œå­—æ®µæ•°é‡å¿…é¡»å®Œå…¨ä¸€è‡´\n   - ä¸è¦æ”¹å˜è¡Œæ•°ã€ä¸è¦åˆå¹¶è¡Œã€ä¸è¦è°ƒæ¢é¡ºåº\n   - å®Œå…¨æŒ‰ç…§ç¤ºä¾‹æ ¼å¼ï¼Œåªæ›¿æ¢å­—æ®µå†…å®¹\n\n3. **å­—æ®µå€¼æ ¼å¼**ï¼š\n   - âŒ é”™è¯¯ï¼š|ä¼´ä¾£: æ— |ä¿¡æ¯ç´ : é›ªåå†·æ‰|\n   - âœ… æ­£ç¡®ï¼š|æ— |é›ªåå†·æ‰|\n   - åªè¾“å‡ºå®é™…å€¼ï¼Œä¸è¦åŠ å­—æ®µåå‰ç¼€\n\n4. **æ¢è¡Œè¦æ±‚**ï¼š\n   - ä¸¥æ ¼éµå®ˆç¤ºä¾‹ä¸­çš„æ¢è¡Œ\n   - æ ‡è®°åå¿…é¡»æ¢è¡Œ\n   - æ¯è¡Œå­—æ®µåå¿…é¡»æ¢è¡Œ\n   - ç»ä¸æŠŠå¤šè¡Œåˆå¹¶æˆä¸€è¡Œ\n\n5. **å…¶ä»–è¦æ±‚**ï¼š\n   - çŠ¶æ€æ ç´§è´´æ­£æ–‡æœ€åä¸€å¥\n   - {{å­—æ®µå}} ä»…ä¸ºå ä½ç¬¦ï¼Œè¾“å‡ºæ—¶æ›¿æ¢ä¸ºå®é™…å†…å®¹\n   - è¿™æ˜¯ {{char}} çš„çŠ¶æ€ï¼Œä¸æ˜¯ {{user}} çš„çŠ¶æ€\n</status_rule>`}),P=(0,i.computed)(()=>{const e=r.value.find(e=>'index.html'===e.path),n=r.value.find(e=>'style.css'===e.path),t=r.value.find(e=>'script.js'===e.path);if(!e)return'';const a='script',s='style';let i=e.content||'';return o.value.fields.forEach((e,n)=>{const t=e.name||`ç¤ºä¾‹${n+1}`;i=i.replace(new RegExp(`\\$${n+1}(?!\\d)`,'g'),t)}),`<!DOCTYPE html>\n<html>\n<head>\n  <meta charset="UTF-8">\n  <meta name="viewport" content="width=device-width, initial-scale=1.0">\n  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">\n  <${s}>\n    html, body {\n      margin: 0;\n      padding: 0;\n      width: 100%;\n      height: auto;\n      min-height: 800px;\n      overflow: visible;\n    }\n    ${n?.content||''}\n  </${s}>\n  <${a} src="https://code.jquery.com/jquery-3.7.1.min.js"></${a}>\n  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/toastr.min.css">\n  <${a} src="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/toastr.min.js"></${a}>\n  <${a} src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.5/gsap.min.js"></${a}>\n  <${a} src="https://cdnjs.cloudflare.com/ajax/libs/lodash.js/4.17.21/lodash.min.js"></${a}>\n</head>\n<body>\n  ${i}\n  <${a}>${t?.content||''}</${a}>\n</body>\n</html>`});function D(){}function j(){o.value.fields.push({name:'',label:'',icon:''})}function R(){E.value=!0,T.value=''}function O(){N.value=!0,I.value=''}async function F(){if(T.value.trim())if(t.value.api_endpoint&&t.value.api_key){y.value=T.value,S.value=!0,b.value=!0;try{h.value?.setProgress(10),h.value?.setMessage('æ­£åœ¨å‡†å¤‡è§£æ XML...'),h.value?.addDetail(`XML é•¿åº¦: ${T.value.length} å­—ç¬¦`);const e='ä½ æ˜¯ä¸€ä¸ªä¸“ä¸šçš„ XML è§£æåŠ©æ‰‹ã€‚ç”¨æˆ·ä¼šç»™ä½ ä¸€ä¸ª XML æ ¼å¼çš„çŠ¶æ€æ ä»£ç ï¼Œä½ éœ€è¦ï¼š\n\n1. **è¯†åˆ«æ‰€æœ‰æ ‡ç­¾**ï¼šæå–æ‰€æœ‰çš„ XML æ ‡ç­¾åï¼ˆå¦‚ <i>ã€<2i>ã€<æ—¥æœŸ>ã€<è§’è‰²ç”Ÿç†çŠ¶æ€> ç­‰ï¼‰\n2. **åˆ†ææ ‡ç­¾å«ä¹‰**ï¼š\n   - å¦‚æœæ ‡ç­¾åæ˜¯ <i>ã€<2i>ã€<3i> ç­‰ï¼Œè¿™è¡¨ç¤ºç¼©è¿›å±‚çº§ï¼Œæ ‡ç­¾å†…å®¹æ‰æ˜¯å®é™…å­—æ®µå\n   - å¦‚æœæ ‡ç­¾åæ˜¯ä¸­æ–‡æˆ–è‹±æ–‡åç§°ï¼ˆå¦‚ <æ—¥æœŸ>ã€<è§’è‰²ç”Ÿç†çŠ¶æ€>ï¼‰ï¼Œè¿™æœ¬èº«å°±æ˜¯å­—æ®µå\n3. **ç”Ÿæˆå­—æ®µé…ç½®**ï¼šä¸ºæ¯ä¸ªå­—æ®µç”Ÿæˆ nameã€labelã€iconï¼ˆå¯é€‰ï¼‰\n\nè¯·**ä¸¥æ ¼æŒ‰ç…§ä»¥ä¸‹ JSON æ ¼å¼**è¾“å‡ºï¼Œä¸è¦æ·»åŠ ä»»ä½•å…¶ä»–æ–‡å­—ï¼š\n\n[\n  { "name": "å­—æ®µå1", "label": "å­—æ®µè¯´æ˜1", "icon": "fa-solid fa-xxx" },\n  { "name": "å­—æ®µå2", "label": "å­—æ®µè¯´æ˜2", "icon": "" }\n]\n\n**é‡è¦è§„åˆ™**ï¼š\n- name åº”è¯¥æ˜¯ç®€æ´çš„è‹±æ–‡æˆ–æ‹¼éŸ³ï¼ˆå¦‚ date, location, statusï¼‰\n- label åº”è¯¥æ˜¯ä¸­æ–‡æè¿°ï¼ˆå¦‚ æ—¥æœŸã€åœ°ç‚¹ã€è§’è‰²ç”Ÿç†çŠ¶æ€ï¼‰\n- icon å¯ä»¥ç•™ç©ºï¼Œæˆ–è€…æ ¹æ®å­—æ®µå«ä¹‰é€‰æ‹©åˆé€‚çš„ Font Awesome å›¾æ ‡\n- è¾“å‡º**å¿…é¡»**æ˜¯æœ‰æ•ˆçš„ JSON æ•°ç»„æ ¼å¼\n- **ç¦æ­¢**è¾“å‡ºä»»ä½•è§£é‡Šæ€§æ–‡å­—ï¼Œåªè¾“å‡º JSON\n\nç¤ºä¾‹è¾“å…¥ï¼š\n<state_bar>\n<i>ã€å†…å®¹ã€‘</i>\n<æ—¥æœŸ>ã€å½“å‰æ—¥æœŸã€‘</æ—¥æœŸ>\n<è§’è‰²ç”Ÿç†çŠ¶æ€>ã€æè¿°è§’è‰²å½“å‰ç”Ÿç†çŠ¶æ€ã€‘</è§’è‰²ç”Ÿç†çŠ¶æ€>\n</state_bar>\n\nç¤ºä¾‹è¾“å‡ºï¼š\n[\n  { "name": "content", "label": "å†…å®¹", "icon": "" },\n  { "name": "date", "label": "æ—¥æœŸ", "icon": "fa-solid fa-calendar" },\n  { "name": "physical_status", "label": "è§’è‰²ç”Ÿç†çŠ¶æ€", "icon": "fa-solid fa-heart-pulse" }\n]',n=`è¯·è§£æä»¥ä¸‹ XML çŠ¶æ€æ ä»£ç ï¼Œç”Ÿæˆå­—æ®µé…ç½®ï¼š\n\n\`\`\`xml\n${T.value.trim()}\n\`\`\`\n\nè¯·ä¸¥æ ¼æŒ‰ç…§ JSON æ ¼å¼è¾“å‡ºï¼Œä¸è¦æ·»åŠ ä»»ä½•è§£é‡Šã€‚`;console.log('ğŸ¤– å¼€å§‹ AI è§£æ XML...'),console.log('ğŸ“ ä½¿ç”¨ API:',t.value.api_endpoint),console.log('ğŸ¤– ä½¿ç”¨æ¨¡å‹:',t.value.model),h.value?.setProgress(20),h.value?.setMessage('æ­£åœ¨å‘é€ XML åˆ° AI æœåŠ¡å™¨...');const a=(0,l.normalizeApiEndpoint)(t.value.api_endpoint);console.log('ğŸ”— è§„èŒƒåŒ–åçš„ç«¯ç‚¹:',a),h.value?.setProgress(30),h.value?.setMessage('ç­‰å¾… AI è§£æ XML ç»“æ„...');const r=await fetch(a,{method:'POST',headers:{'Content-Type':'application/json',Authorization:`Bearer ${t.value.api_key}`},body:JSON.stringify({model:t.value.model,messages:[{role:'system',content:e},{role:'user',content:n}],max_tokens:2e3,temperature:.7})});if(!r.ok){const e=await r.text();throw new Error(`APIè¯·æ±‚å¤±è´¥: ${r.status} ${r.statusText}\n${e}`)}const s=await r.json();if(console.log('âœ… AI å®Œæ•´å“åº”:',s),!s.choices||!s.choices[0]||!s.choices[0].message)throw new Error('AIå“åº”æ ¼å¼é”™è¯¯');const i=s.choices[0].message.content;if(console.log('âœ… AI åŸå§‹è¿”å›:',i),!i||'string'!=typeof i)throw new Error('AI æœªè¿”å›æœ‰æ•ˆå†…å®¹');let d=i.trim();d=d.replace(/^```(?:json)?\s*\n?/i,'').replace(/\n?```\s*$/i,'');const c=d.match(/\[\s*{[\s\S]*}\s*\]/);let p;c&&(d=c[0]);try{p=JSON.parse(d)}catch(e){throw new Error(`AI è¿”å›çš„ä¸æ˜¯æœ‰æ•ˆçš„ JSON æ ¼å¼\n\nè¯·æ£€æŸ¥ AI é…ç½®ï¼Œæˆ–è€…æ‰‹åŠ¨æ·»åŠ å­—æ®µã€‚\n\nåŸå§‹è¿”å›ï¼ˆå‰200å­—ç¬¦ï¼‰:\n${s.slice(0,200)}`)}if(!Array.isArray(p))throw new Error('AI è¿”å›çš„ä¸æ˜¯æœ‰æ•ˆçš„æ•°ç»„æ ¼å¼');const g=p.filter(e=>e.name&&e.label);if(0===g.length)throw new Error('æœªèƒ½ä» AI è¿”å›ä¸­è§£æå‡ºæœ‰æ•ˆçš„å­—æ®µ');o.value.fields=g.map(e=>({name:e.name||'',label:e.label||'',icon:e.icon||''})),h.value?.setProgress(100),h.value?.setMessage('âœ… è§£æå®Œæˆï¼'),h.value?.addDetail(`æˆåŠŸè§£æ ${g.length} ä¸ªå­—æ®µ`),setTimeout(()=>{b.value=!1,E.value=!1,T.value='',toastr.success(`æˆåŠŸè§£æ ${g.length} ä¸ªå­—æ®µï¼`)},800)}catch(e){console.error('âŒ XML è§£æå¤±è´¥:',e),b.value=!1;const n=e.message||'æœªçŸ¥é”™è¯¯';n.includes('APIè¯·æ±‚å¤±è´¥')||n.includes('403')||n.includes('401')||n.includes('Unauthorized')?toastr.error('âš ï¸ API è¯·æ±‚å¤±è´¥ï¼è¯·æ£€æŸ¥ï¼š\n1. API å¯†é’¥æ˜¯å¦æœ‰æ•ˆ\n2. æ¨¡å‹åç§°æ˜¯å¦æ­£ç¡®\n3. è´¦æˆ·ä½™é¢æ˜¯å¦å……è¶³','',{timeOut:0,extendedTimeOut:0,closeButton:!0}):toastr.error(`è§£æå¤±è´¥: ${n}`,'',{timeOut:8e3,closeButton:!0})}finally{S.value=!1}}else toastr.error('âš ï¸ API æœªé…ç½®ï¼è¯·ç‚¹å‡»å³ä¸Šè§’"âš™ï¸ è®¾ç½®"æ£€æŸ¥ API é…ç½®','',{timeOut:0,extendedTimeOut:0,closeButton:!0});else toastr.warning('è¯·å…ˆè¾“å…¥ XML ä»£ç ')}async function L(e){if(y.value){w.value=!0,b.value=!0;try{h.value?.setProgress(20),h.value?.setMessage('æ­£åœ¨å‡†å¤‡ä¿®æ”¹å­—æ®µé…ç½®...'),h.value?.addDetail(`ä¿®æ”¹æŒ‡ä»¤: ${e}`);const n='ä½ æ˜¯ä¸€ä¸ªä¸“ä¸šçš„ XML è§£æåŠ©æ‰‹ã€‚æ ¹æ®ç”¨æˆ·çš„åŸå§‹ XML å’Œä¿®æ”¹å»ºè®®ï¼Œé‡æ–°è§£æå¹¶ç”Ÿæˆå­—æ®µé…ç½®ã€‚',a=`# åŸå§‹ XMLï¼š\n${y.value}\n\n# ä¿®æ”¹å»ºè®®ï¼š\n${e}\n\nè¯·æ ¹æ®åŸå§‹ XML å’Œä¿®æ”¹å»ºè®®ï¼Œé‡æ–°ç”Ÿæˆå­—æ®µé…ç½®ã€‚\nè¾“å‡ºæ ¼å¼è¦æ±‚ï¼ˆJSON æ•°ç»„ï¼‰ï¼š\n[\n  { "name": "å­—æ®µå1", "label": "å­—æ®µè¯´æ˜1", "icon": "fa-solid fa-xxx" },\n  { "name": "å­—æ®µå2", "label": "å­—æ®µè¯´æ˜2", "icon": "" }\n]`;h.value?.setProgress(40),h.value?.setMessage('æ­£åœ¨è°ƒç”¨ AI ä¿®æ”¹...');const r=(0,l.normalizeApiEndpoint)(t.value.api_endpoint),s=await fetch(r,{method:'POST',headers:{'Content-Type':'application/json',Authorization:`Bearer ${t.value.api_key}`},body:JSON.stringify({model:t.value.model,messages:[{role:'system',content:n},{role:'user',content:a}],max_tokens:2e3,temperature:.7})});if(!s.ok)throw new Error(`API é”™è¯¯: ${s.statusText}`);h.value?.setProgress(70),h.value?.setMessage('æ­£åœ¨æ¥æ”¶ AI å“åº”...');const i=await s.json(),d=i.choices[0]?.message?.content||'';h.value?.setProgress(85),h.value?.setMessage('æ­£åœ¨è§£æå­—æ®µé…ç½®...');let c=d.trim().replace(/^```(?:json)?\s*\n?/i,'').replace(/\n?```\s*$/i,'');const p=c.match(/\[\s*{[\s\S]*}\s*\]/);p&&(c=p[0]);const g=JSON.parse(c);if(!Array.isArray(g))throw new Error('AI è¿”å›çš„ä¸æ˜¯æœ‰æ•ˆçš„æ•°ç»„æ ¼å¼');o.value.fields=g.map(e=>({name:e.name||'',label:e.label||e.name||'',icon:e.icon||''})),y.value+=`\n\nã€å·²åº”ç”¨çš„ä¿®æ”¹ã€‘ï¼š${e}`,h.value?.setProgress(100),h.value?.setMessage('âœ… ä¿®æ”¹å®Œæˆï¼'),h.value?.addDetail(`å·²æ›´æ–° ${g.length} ä¸ªå­—æ®µ`),setTimeout(()=>{b.value=!1,v.value=!1,window.toastr.success('âœ… AI ä¿®æ”¹å®Œæˆï¼')},800)}catch(e){console.error('AI ä¿®æ”¹å¤±è´¥:',e),b.value=!1,window.toastr.error('AI ä¿®æ”¹å¤±è´¥: '+e.message)}finally{w.value=!1}}else window.toastr.warning('è¯·å…ˆè§£æ XML')}async function H(){if(I.value.trim())if(t.value.api_endpoint&&t.value.api_key){k.value=I.value,V.value=!0,b.value=!0;try{h.value?.setProgress(10),h.value?.setMessage('æ­£åœ¨å‡†å¤‡æ™ºèƒ½ç”Ÿæˆ...'),h.value?.addDetail('AI æ­£åœ¨åˆ†æä½ çš„éœ€æ±‚');const e='ä½ æ˜¯ä¸€ä¸ªä¸“ä¸šçš„çŠ¶æ€æ å­—æ®µè®¾è®¡åŠ©æ‰‹ã€‚ç”¨æˆ·ä¼šç”¨è‡ªç„¶è¯­è¨€æè¿°ä»–ä»¬æƒ³è¦çš„çŠ¶æ€æ ï¼Œä½ éœ€è¦ï¼š\n\n1. **ç†è§£ç”¨æˆ·éœ€æ±‚**ï¼šåˆ†æç”¨æˆ·æè¿°çš„åœºæ™¯ã€ç±»å‹ï¼ˆå¦‚ä¿®ä»™ã€ç°ä»£ã€ABOç­‰ï¼‰\n2. **è®¾è®¡åˆç†çš„å­—æ®µ**ï¼šæ ¹æ®åœºæ™¯è®¾è®¡å®Œæ•´ã€å®ç”¨çš„å­—æ®µ\n3. **ç”Ÿæˆå­—æ®µé…ç½®**ï¼šä¸ºæ¯ä¸ªå­—æ®µç”Ÿæˆ nameã€labelã€icon\n\nè¯·**ä¸¥æ ¼æŒ‰ç…§ä»¥ä¸‹ JSON æ ¼å¼**è¾“å‡ºï¼Œä¸è¦æ·»åŠ ä»»ä½•å…¶ä»–æ–‡å­—ï¼š\n\n[\n  { "name": "å­—æ®µå1", "label": "å­—æ®µè¯´æ˜1", "icon": "fa-solid fa-xxx" },\n  { "name": "å­—æ®µå2", "label": "å­—æ®µè¯´æ˜2", "icon": "fa-solid fa-xxx" }\n]\n\n**é‡è¦è§„åˆ™**ï¼š\n- name åº”è¯¥æ˜¯ç®€æ´çš„è‹±æ–‡æˆ–æ‹¼éŸ³ï¼ˆå¦‚ realm, spiritual_power, locationï¼‰\n- label åº”è¯¥æ˜¯ä¸­æ–‡æè¿°ï¼ˆå¦‚ å¢ƒç•Œã€çµåŠ›ã€ä½ç½®ï¼‰\n- icon å¿…é¡»é€‰æ‹©åˆé€‚çš„ Font Awesome å›¾æ ‡ï¼ˆå¦‚ fa-solid fa-star, fa-solid fa-boltï¼‰\n- è¾“å‡º**å¿…é¡»**æ˜¯æœ‰æ•ˆçš„ JSON æ•°ç»„æ ¼å¼\n- **ç¦æ­¢**è¾“å‡ºä»»ä½•è§£é‡Šæ€§æ–‡å­—ï¼Œåªè¾“å‡º JSON\n\nå¸¸ç”¨å›¾æ ‡å‚è€ƒï¼š\n- äººç‰©ï¼šfa-solid fa-user, fa-solid fa-user-ninja, fa-solid fa-user-secret\n- çŠ¶æ€ï¼šfa-solid fa-heart, fa-solid fa-heart-pulse, fa-solid fa-star\n- ä½ç½®ï¼šfa-solid fa-location-dot, fa-solid fa-map-marker\n- æ—¶é—´ï¼šfa-solid fa-clock, fa-solid fa-calendar\n- èƒ½é‡ï¼šfa-solid fa-bolt, fa-solid fa-fire, fa-solid fa-droplet\n- ç‰©å“ï¼šfa-solid fa-book, fa-solid fa-wand-magic-sparkles, fa-solid fa-scroll\n- æƒ…æ„Ÿï¼šfa-solid fa-heart, fa-solid fa-face-smile, fa-solid fa-face-sad-tear\n\nç¤ºä¾‹ï¼š\nç”¨æˆ·ï¼š"å¸®æˆ‘ç”Ÿæˆä¸€ä¸ªä¿®ä»™æ¸¸æˆçš„çŠ¶æ€æ "\nè¾“å‡ºï¼š\n[\n  { "name": "name", "label": "å§“å", "icon": "fa-solid fa-user-ninja" },\n  { "name": "realm", "label": "å¢ƒç•Œ", "icon": "fa-solid fa-star" },\n  { "name": "spiritual_power", "label": "çµåŠ›", "icon": "fa-solid fa-bolt" },\n  { "name": "cultivation_method", "label": "åŠŸæ³•", "icon": "fa-solid fa-scroll" },\n  { "name": "location", "label": "ä½ç½®", "icon": "fa-solid fa-location-dot" },\n  { "name": "status", "label": "çŠ¶æ€", "icon": "fa-solid fa-heart-pulse" }\n]',n=`è¯·æ ¹æ®ä»¥ä¸‹æè¿°ï¼Œç”ŸæˆçŠ¶æ€æ å­—æ®µé…ç½®ï¼š\n\n${I.value.trim()}\n\nè¯·ä¸¥æ ¼æŒ‰ç…§ JSON æ ¼å¼è¾“å‡ºï¼Œä¸è¦æ·»åŠ ä»»ä½•è§£é‡Šã€‚`;console.log('ğŸ¤– å¼€å§‹ AI æ™ºèƒ½ç”Ÿæˆå­—æ®µ...'),console.log('ğŸ“ ä½¿ç”¨ API:',t.value.api_endpoint),console.log('ğŸ¤– ä½¿ç”¨æ¨¡å‹:',t.value.model),h.value?.setProgress(20),h.value?.setMessage('æ­£åœ¨å‘é€éœ€æ±‚åˆ° AI...');const a=(0,l.normalizeApiEndpoint)(t.value.api_endpoint);console.log('ğŸ”— è§„èŒƒåŒ–åçš„ç«¯ç‚¹:',a),h.value?.setProgress(30),h.value?.setMessage('ç­‰å¾… AI è®¾è®¡å­—æ®µ...');const r=await fetch(a,{method:'POST',headers:{'Content-Type':'application/json',Authorization:`Bearer ${t.value.api_key}`},body:JSON.stringify({model:t.value.model,messages:[{role:'system',content:e},{role:'user',content:n}],max_tokens:3e3,temperature:.8})});if(!r.ok){const e=await r.text();throw new Error(`APIè¯·æ±‚å¤±è´¥: ${r.status} ${r.statusText}\n${e}`)}const s=await r.json();if(console.log('âœ… AI å®Œæ•´å“åº”:',s),!s.choices||!s.choices[0]||!s.choices[0].message)throw new Error('AIå“åº”æ ¼å¼é”™è¯¯');const i=s.choices[0].message.content;if(console.log('âœ… AI åŸå§‹è¿”å›:',i),!i||'string'!=typeof i)throw new Error('AI æœªè¿”å›æœ‰æ•ˆå†…å®¹');let d=i.trim();d=d.replace(/^```(?:json)?\s*\n?/i,'').replace(/\n?```\s*$/i,'');const c=d.match(/\[\s*{[\s\S]*}\s*\]/);let p;c&&(d=c[0]);try{p=JSON.parse(d)}catch(e){throw new Error(`AI è¿”å›çš„ä¸æ˜¯æœ‰æ•ˆçš„ JSON æ ¼å¼\n\nè¯·æ£€æŸ¥ AI é…ç½®ï¼Œæˆ–è€…æ‰‹åŠ¨æ·»åŠ å­—æ®µã€‚\n\nåŸå§‹è¿”å›ï¼ˆå‰200å­—ç¬¦ï¼‰:\n${i.slice(0,200)}`)}if(!Array.isArray(p))throw new Error('AI è¿”å›çš„ä¸æ˜¯æœ‰æ•ˆçš„æ•°ç»„æ ¼å¼');const g=p.filter(e=>e.name&&e.label);if(0===g.length)throw new Error('æœªèƒ½ä» AI è¿”å›ä¸­è§£æå‡ºæœ‰æ•ˆçš„å­—æ®µ');o.value.fields=g.map(e=>({name:e.name||'',label:e.label||'',icon:e.icon||''})),h.value?.setProgress(100),h.value?.setMessage('âœ… ç”Ÿæˆå®Œæˆï¼'),h.value?.addDetail(`æˆåŠŸç”Ÿæˆ ${g.length} ä¸ªå­—æ®µ`),setTimeout(()=>{b.value=!1,N.value=!1,I.value='',toastr.success(`æˆåŠŸç”Ÿæˆ ${g.length} ä¸ªå­—æ®µï¼`)},800)}catch(e){console.error('âŒ AI ç”Ÿæˆå­—æ®µå¤±è´¥:',e),b.value=!1;const n=e.message||'æœªçŸ¥é”™è¯¯';n.includes('APIè¯·æ±‚å¤±è´¥')||n.includes('403')||n.includes('401')||n.includes('Unauthorized')?toastr.error('âš ï¸ API è¯·æ±‚å¤±è´¥ï¼è¯·æ£€æŸ¥ï¼š\n1. API å¯†é’¥æ˜¯å¦æœ‰æ•ˆ\n2. æ¨¡å‹åç§°æ˜¯å¦æ­£ç¡®\n3. è´¦æˆ·ä½™é¢æ˜¯å¦å……è¶³','',{timeOut:0,extendedTimeOut:0,closeButton:!0}):toastr.error(`ç”Ÿæˆå¤±è´¥: ${n}`,'',{timeOut:8e3,closeButton:!0})}finally{V.value=!1}}else toastr.error('âš ï¸ API æœªé…ç½®ï¼è¯·ç‚¹å‡»å³ä¸Šè§’"âš™ï¸ è®¾ç½®"æ£€æŸ¥ API é…ç½®','',{timeOut:0,extendedTimeOut:0,closeButton:!0});else toastr.warning('è¯·å…ˆæè¿°ä½ æƒ³è¦çš„çŠ¶æ€æ ')}async function G(e){if(k.value){C.value=!0,b.value=!0;try{h.value?.setProgress(20),h.value?.setMessage('æ­£åœ¨å‡†å¤‡ä¿®æ”¹å­—æ®µé…ç½®...'),h.value?.addDetail(`ä¿®æ”¹æŒ‡ä»¤: ${e}`);const n='ä½ æ˜¯ä¸€ä¸ªä¸“ä¸šçš„çŠ¶æ€æ å­—æ®µè®¾è®¡åŠ©æ‰‹ã€‚æ ¹æ®ç”¨æˆ·çš„åŸå§‹æè¿°å’Œä¿®æ”¹å»ºè®®ï¼Œé‡æ–°ç”Ÿæˆå­—æ®µé…ç½®ã€‚',a=`# åŸå§‹æè¿°ï¼š\n${k.value}\n\n# ä¿®æ”¹å»ºè®®ï¼š\n${e}\n\nè¯·æ ¹æ®åŸå§‹æè¿°å’Œä¿®æ”¹å»ºè®®ï¼Œé‡æ–°ç”Ÿæˆå­—æ®µé…ç½®ã€‚\nè¾“å‡ºæ ¼å¼è¦æ±‚ï¼ˆJSON æ•°ç»„ï¼‰ï¼š\n[\n  { "name": "å­—æ®µå1", "label": "å­—æ®µè¯´æ˜1", "icon": "fa-solid fa-xxx" },\n  { "name": "å­—æ®µå2", "label": "å­—æ®µè¯´æ˜2", "icon": "" }\n]`;h.value?.setProgress(40),h.value?.setMessage('æ­£åœ¨è°ƒç”¨ AI ä¿®æ”¹...');const r=(0,l.normalizeApiEndpoint)(t.value.api_endpoint),s=await fetch(r,{method:'POST',headers:{'Content-Type':'application/json',Authorization:`Bearer ${t.value.api_key}`},body:JSON.stringify({model:t.value.model,messages:[{role:'system',content:n},{role:'user',content:a}],max_tokens:2e3,temperature:.7})});if(!s.ok)throw new Error(`API é”™è¯¯: ${s.statusText}`);h.value?.setProgress(70),h.value?.setMessage('æ­£åœ¨æ¥æ”¶ AI å“åº”...');const i=await s.json(),d=i.choices[0]?.message?.content||'';h.value?.setProgress(85),h.value?.setMessage('æ­£åœ¨è§£æå­—æ®µé…ç½®...');let c=d.trim().replace(/^```(?:json)?\s*\n?/i,'').replace(/\n?```\s*$/i,'');const p=c.match(/\[\s*{[\s\S]*}\s*\]/);p&&(c=p[0]);const g=JSON.parse(c);if(!Array.isArray(g))throw new Error('AI è¿”å›çš„ä¸æ˜¯æœ‰æ•ˆçš„æ•°ç»„æ ¼å¼');o.value.fields=g.map(e=>({name:e.name||'',label:e.label||e.name||'',icon:e.icon||''})),k.value+=`\n\nã€å·²åº”ç”¨çš„ä¿®æ”¹ã€‘ï¼š${e}`,h.value?.setProgress(100),h.value?.setMessage('âœ… ä¿®æ”¹å®Œæˆï¼'),h.value?.addDetail(`å·²æ›´æ–° ${g.length} ä¸ªå­—æ®µ`),setTimeout(()=>{b.value=!1,A.value=!1,window.toastr.success('âœ… AI ä¿®æ”¹å®Œæˆï¼')},800)}catch(e){console.error('AI ä¿®æ”¹å¤±è´¥:',e),b.value=!1,window.toastr.error('AI ä¿®æ”¹å¤±è´¥: '+e.message)}finally{C.value=!1}}else window.toastr.warning('è¯·å…ˆç”Ÿæˆå­—æ®µ')}function Y(){const e=o.value.fields,n=e.length;if(0===n)return o.value.findRegex='<-CHARACTER_STATUS->',void console.log('âš ï¸ æ²¡æœ‰å­—æ®µï¼Œä½¿ç”¨é»˜è®¤æ ‡è®°');if(n<=4)o.value.findRegex=`<-CHARACTER_STATUS->[\\r\\n]*\\|${e.map(()=>'([^|]+)').join('\\|')}\\|[\\r\\n]*`,console.log('âœ… è‡ªåŠ¨ç”Ÿæˆçš„ findRegex (å•æ ‡è®°):',o.value.findRegex),console.log('ğŸ“Š å­—æ®µæ•°é‡:',n);else{const t=n<=8?Math.ceil(n/2):4,a=Math.min(Math.ceil(n/2),n<=12?4:Math.ceil(n/3)),r=[];r.push('<-ENVIRONMENT_DATA->[\\r\\n]*');for(let n=0;n<a;n+=t){const o=Math.min(t,a-n);r.push('\\|'+e.slice(n,n+o).map(()=>'([^|]+)').join('\\|')+'\\|[\\r\\n]*')}r.push('<-CHARACTER_STATUS->[\\r\\n]*');for(let o=a;o<n;o+=t){const a=Math.min(t,n-o);r.push('\\|'+e.slice(o,o+a).map(()=>'([^|]+)').join('\\|')+'\\|[\\r\\n]*')}o.value.findRegex=r.join(''),console.log('âœ… è‡ªåŠ¨ç”Ÿæˆçš„ findRegex (åŒæ ‡è®°):',o.value.findRegex),console.log('ğŸ“Š å­—æ®µæ•°é‡:',n),console.log('ğŸ“Š åˆ†é…æ–¹æ¡ˆ:',`ç¬¬ä¸€ä¸ªæ ‡è®°: ${a}ä¸ªå­—æ®µ, ç¬¬äºŒä¸ªæ ‡è®°: ${n-a}ä¸ªå­—æ®µ, æ¯è¡Œ: ${t}ä¸ª`)}const t=e.map((e,n)=>`        <div class="status-field">\n          <div class="field-label">${e.icon?`<i class="${e.icon}"></i> `:''}${e.label||'å­—æ®µ'+(n+1)}</div>\n          <div class="field-value">$${n+1}</div>\n        </div>`).join('\n'),a=`<details>\n<summary> ${o.value.name} </summary>\n<div class="status-card">\n    <div class="status-header">\n        <span>ğŸ“‹</span>\n        <span>${o.value.name}</span>\n    </div>\n    <div class="status-content">\n        <div class="status-grid">\n${t}\n        </div>\n    </div>\n</div>\n</details>`,i=`// çŠ¶æ€æ äº¤äº’è„šæœ¬\n(function() {\n  // ç­‰å¾…å†…å®¹æ¸²æŸ“\n  setTimeout(function() {\n    console.log('${o.value.name} å·²åŠ è½½');\n\n    // å¯ä»¥æ·»åŠ åŠ¨ç”»æ•ˆæœ\n    if (typeof gsap !== 'undefined') {\n      gsap.from('.status-field', {\n        opacity: 0,\n        y: 20,\n        duration: 0.5,\n        stagger: 0.1,\n        ease: 'power2.out'\n      });\n\n      // é¼ æ ‡æ‚¬åœæ•ˆæœ\n      $('.status-field').hover(\n        function() {\n          gsap.to($(this), { scale: 1.05, duration: 0.2 });\n        },\n        function() {\n          gsap.to($(this), { scale: 1, duration: 0.2 });\n        }\n      );\n    }\n  }, 100);\n})();`;r.value[0].content=a,r.value[1].content='.status-card {\n    font-family: \'Microsoft YaHei\', sans-serif;\n    background: linear-gradient(145deg, #1e293b, #334155);\n    border-radius: 14px;\n    margin: 16px 0;\n    box-shadow: 0 8px 25px rgba(15, 23, 42, 0.4);\n    overflow: hidden;\n    border: 1px solid rgba(148, 163, 184, 0.2);\n    max-width: 600px;\n}\n\n.status-header {\n    background: linear-gradient(135deg, #0f172a, #1e293b);\n    color: #e2e8f0;\n    padding: 12px 20px;\n    font-size: 15px;\n    font-weight: 600;\n    display: flex;\n    align-items: center;\n    gap: 8px;\n    border-bottom: 1px solid rgba(148, 163, 184, 0.15);\n}\n\n.status-content {\n    padding: 20px;\n    background: rgba(30, 41, 59, 0.5);\n}\n\n.status-grid {\n    display: grid;\n    grid-template-columns: repeat(2, 1fr);\n    gap: 16px;\n}\n\n.status-field {\n    background: rgba(30, 41, 59, 0.8);\n    padding: 16px;\n    border-radius: 10px;\n    border-left: 3px solid #6366f1;\n}\n\n.field-label {\n    font-size: 11px;\n    color: #94a3b8;\n    margin-bottom: 8px;\n    font-weight: 600;\n    text-transform: uppercase;\n}\n\n.field-value {\n    font-size: 14px;\n    color: #e2e8f0;\n    line-height: 1.5;\n    font-weight: 600;\n}',r.value[2].content=i,s.value=r.value[0],window.toastr.success('âœ… æ¨¡æ¿å·²ç”Ÿæˆï¼')}function J(){c.value=!0,g.value=''}function W(){o.value.fields.push({name:`å­—æ®µ${o.value.fields.length+1}`,label:`å­—æ®µ${o.value.fields.length+1}`,icon:''})}async function q(){if(g.value.trim()){u.value=g.value,b.value=!0;try{if(!t.value.api_endpoint||!t.value.api_key)return window.toastr.error('è¯·å…ˆåœ¨è®¾ç½®é¡µé¢é…ç½® API ç«¯ç‚¹å’Œ API Key'),void(b.value=!1);h.value?.setProgress(10),h.value?.setMessage('æ­£åœ¨å‡†å¤‡ AI è¯·æ±‚...'),h.value?.addDetail(`å­—æ®µæ•°é‡: ${o.value.fields.length} ä¸ª`),h.value?.addDetail(`æ¨¡å‹: ${t.value.model}`);const e=r.value.map(e=>`=== ${e.path} ===\n${e.content}`).join('\n\n'),n='ä½ æ˜¯ä¸€ä¸ªä¸“ä¸šçš„å‰ç«¯å¼€å‘åŠ©æ‰‹ï¼Œä¸“é—¨ä¸º SillyTavern çŠ¶æ€æ ç”Ÿæˆ HTML/CSS/JS ä»£ç ç‰‡æ®µã€‚\n\nã€é‡è¦ã€‘æœ€ç»ˆä»£ç ä¼šè¢«åµŒå…¥åˆ° Regex è„šæœ¬çš„ replaceString å­—æ®µä¸­ï¼Œç”¨äºæ›¿æ¢ AI è¾“å‡ºçš„çº¯æ–‡æœ¬çŠ¶æ€æ ã€‚\nã€é‡è¦ã€‘è¿™æ˜¯**{{char}}ï¼ˆè§’è‰²ï¼‰çš„çŠ¶æ€æ **ï¼Œç”¨äºæ˜¾ç¤ºè§’è‰²çš„çŠ¶æ€ä¿¡æ¯ï¼Œä¸æ˜¯{{user}}ï¼ˆç”¨æˆ·ï¼‰çš„çŠ¶æ€ã€‚\n\nå¯ç”¨ç¯å¢ƒï¼š\n- Font Awesome å›¾æ ‡åº“ï¼ˆå·²åŠ è½½ï¼‰\n- jQuery ($) - å·²å…¨å±€å¯ç”¨\n- toastrï¼ˆæ¶ˆæ¯æç¤ºï¼‰- å·²å…¨å±€å¯ç”¨\n- gsapï¼ˆåŠ¨ç”»åº“ï¼‰- å·²å…¨å±€å¯ç”¨\n- lodash (_) - å·²å…¨å±€å¯ç”¨\n\nå­—æ®µå ä½ç¬¦è§„åˆ™ï¼š\n- ç”¨ $1ã€$2ã€$3 ç­‰è¡¨ç¤ºæ­£åˆ™æ•è·çš„å­—æ®µå€¼\n- $1 ä»£è¡¨ç¬¬ä¸€ä¸ªå­—æ®µï¼Œ$2 ä»£è¡¨ç¬¬äºŒä¸ªå­—æ®µï¼Œä»¥æ­¤ç±»æ¨\n- ç”¨æˆ·ä¼šæ˜ç¡®å‘Šè¯‰ä½ æ¯ä¸ªå ä½ç¬¦å¯¹åº”çš„å­—æ®µåï¼Œä½ å¿…é¡»ä¸¥æ ¼æŒ‰ç…§ç”¨æˆ·çš„å­—æ®µé…ç½®æ¥ç”Ÿæˆä»£ç \n- **ç¦æ­¢**æ ¹æ®å½“å‰ä»£ç æ–‡ä»¶ä¸­çš„å­—æ®µæ¥æ¨æ–­ï¼Œå¿…é¡»ä½¿ç”¨ç”¨æˆ·æ˜ç¡®æä¾›çš„å­—æ®µåˆ—è¡¨\n\nè¾“å‡ºæ ¼å¼ï¼ˆä¸‰ä¸ªç‹¬ç«‹æ–‡ä»¶ï¼‰ï¼š\nFILE_START: index.html\n<details>\n<summary> çŠ¶æ€æ æ ‡é¢˜ </summary>\n<div class="status-card">\n  \x3c!-- ä½¿ç”¨ $1, $2, $3 ç­‰å ä½ç¬¦ï¼Œå¿…é¡»ä¸ç”¨æˆ·æä¾›çš„å­—æ®µä¸€ä¸€å¯¹åº” --\x3e\n  <div class="field-value">$1</div>\n</div>\n</details>\nFILE_END\n\nFILE_START: style.css\n.status-card {\n  /* å®Œæ•´æ ·å¼ */\n}\nFILE_END\n\nFILE_START: script.js\n(function() {\n  // ç«‹å³æ‰§è¡Œå‡½æ•°ï¼Œé¿å…å…¨å±€æ±¡æŸ“\n  // å¯ä»¥ç›´æ¥ä½¿ç”¨ $ å’Œ document\n})();\nFILE_END\n\nã€å…³é”®è¦æ±‚ã€‘ï¼š\n1. index.html å¿…é¡»ä»¥ <details> å¼€å¤´ï¼Œä»¥ </details> ç»“å°¾ï¼Œä¸è¦ <!DOCTYPE> å’Œ <html> æ ‡ç­¾\n2. FILE_START å’Œ FILE_END ä¹‹é—´ç›´æ¥å†™çº¯ä»£ç ï¼Œ**ç»å¯¹ç¦æ­¢**æ·»åŠ ä»£ç å—æ ‡è®°ï¼ˆ\\`\\`\\`htmlã€"""html ç­‰ï¼‰\n3. HTML ä¸­ä½¿ç”¨çš„å ä½ç¬¦ï¼ˆ$1, $2, $3...ï¼‰å¿…é¡»ä¸ç”¨æˆ·æä¾›çš„å­—æ®µé…ç½®å®Œå…¨ä¸€è‡´\n4. CSS æ ·å¼è¦å®Œæ•´ã€ç¾è§‚ï¼Œä½¿ç”¨ç°ä»£è®¾è®¡\n5. JS ä½¿ç”¨ç«‹å³æ‰§è¡Œå‡½æ•° (function() { ... })()ï¼Œä¸éœ€è¦ $(function() { ... })\n6. ä»£ç ä¼šç›´æ¥åµŒå…¥åˆ°èŠå¤©æ¶ˆæ¯ä¸­ï¼Œä¸éœ€è¦è€ƒè™‘ DOM åŠ è½½æ—¶æœº\n7. **æœ€é‡è¦**ï¼šå¦‚æœç”¨æˆ·æä¾›çš„å­—æ®µé…ç½®ä¸å½“å‰ä»£ç æ–‡ä»¶ä¸­çš„å­—æ®µä¸åŒï¼Œå¿…é¡»ä½¿ç”¨ç”¨æˆ·é…ç½®çš„å­—æ®µï¼Œåˆ é™¤ä»£ç ä¸­ä¸åœ¨ç”¨æˆ·é…ç½®åˆ—è¡¨é‡Œçš„å­—æ®µ',a=`# ã€å¼ºåˆ¶è¦æ±‚ã€‘å­—æ®µé…ç½®ï¼ˆè¿™æ˜¯å”¯ä¸€çš„å­—æ®µæ¥æºï¼Œç¦æ­¢è‡ªè¡Œæ·»åŠ æˆ–åˆ é™¤å­—æ®µï¼‰ï¼š\n${o.value.fields.map((e,n)=>`å­—æ®µ${n+1}ï¼š${e.label} (å˜é‡å: ${e.name}) - å ä½ç¬¦: $${n+1}${e.icon?` - å›¾æ ‡: ${e.icon}`:''}`).join('\n')}\n\nã€âš ï¸ é‡è¦ã€‘ä½ çš„ä»»åŠ¡ï¼š\n1. HTML ä¸­å¿…é¡»ä¸”åªèƒ½åŒ…å«ä¸Šè¿° ${o.value.fields.length} ä¸ªå­—æ®µ\n2. å­—æ®µé¡ºåºå¿…é¡»ä¸¥æ ¼æŒ‰ç…§ï¼š$1 = ${o.value.fields[0]?.label||'å­—æ®µ1'}, $2 = ${o.value.fields[1]?.label||'å­—æ®µ2'}${o.value.fields[2]?`, $3 = ${o.value.fields[2].label}`:''}${o.value.fields[3]?`, $4 = ${o.value.fields[3].label}`:''}${o.value.fields[4]?`, $5 = ${o.value.fields[4].label}`:''}\n3. ç¦æ­¢æ·»åŠ ä»»ä½•é¢å¤–çš„å­—æ®µï¼ˆå¦‚"å§“å"ã€"æ€§åˆ«"ã€"å¹´é¾„"ç­‰ï¼Œé™¤éå®ƒä»¬åœ¨ä¸Šé¢çš„å­—æ®µåˆ—è¡¨ä¸­ï¼‰\n4. ç¦æ­¢ä½¿ç”¨ $${o.value.fields.length+1} åŠä»¥ä¸Šçš„å ä½ç¬¦\n\n# ã€é‡è¦è¯´æ˜ã€‘çŠ¶æ€æ ç”¨é€”ï¼š\nè¿™æ˜¯**{{char}}ï¼ˆè§’è‰²ï¼‰çš„çŠ¶æ€æ **ï¼Œç”¨äºæ˜¾ç¤ºè§’è‰²çš„çŠ¶æ€ä¿¡æ¯ï¼ˆå¦‚æ—¶é—´ã€åœ°ç‚¹ã€ç€è£…ã€çŠ¶æ€ç­‰ï¼‰ï¼Œ**ä¸æ˜¯{{user}}ï¼ˆç”¨æˆ·ï¼‰çš„çŠ¶æ€**ã€‚\nçŠ¶æ€æ ä¼šé€šè¿‡MVU Betaå˜é‡ç³»ç»Ÿè¯»å–{{char}}çš„stat_dataå˜é‡ï¼Œæ˜¾ç¤ºåœ¨èŠå¤©æ¶ˆæ¯ä¸­ã€‚\n\n# è§¦å‘æ­£åˆ™ï¼š\n${o.value.findRegex}\n\n# ç”¨æˆ·éœ€æ±‚ï¼š\n${g.value}\n\n# å½“å‰ä»£ç æ–‡ä»¶ï¼ˆä»…ä¾›å‚è€ƒæ ·å¼ï¼Œå­—æ®µå¿…é¡»æŒ‰ä¸Šé¢çš„é…ç½®ï¼‰ï¼š\n${e}\n\nã€è¾“å‡ºè¦æ±‚ã€‘ï¼š\n1. æ ¹æ®ç”¨æˆ·éœ€æ±‚è®¾è®¡çŠ¶æ€æ æ ·å¼å’Œå¸ƒå±€\n2. ä½¿ç”¨ä¸Šè¿° ${o.value.fields.length} ä¸ªå­—æ®µï¼Œæ¯ä¸ªå ä½ç¬¦ï¼ˆ$1, $2, $3...ï¼‰å¿…é¡»å‡ºç°åœ¨ HTML ä¸­\n3. å¯ä»¥ç¾åŒ–æ ·å¼ã€è°ƒæ•´å¸ƒå±€ã€æ·»åŠ åŠ¨ç”»æ•ˆæœ\n4. å¿…é¡»åŒæ—¶è¾“å‡º index.htmlã€style.cssã€script.js ä¸‰ä¸ªæ–‡ä»¶\n5. å¦‚æœå½“å‰ä»£ç ä¸­æœ‰å­—æ®µä¸åœ¨ä¸Šè¿°åˆ—è¡¨ä¸­ï¼Œè¯·åˆ é™¤å®ƒä»¬`;h.value?.setProgress(20),h.value?.setMessage('æ­£åœ¨å‘é€è¯·æ±‚åˆ° AI æœåŠ¡å™¨...'),h.value?.addDetail(`API ç«¯ç‚¹: ${t.value.api_endpoint}`);const i=(0,l.normalizeApiEndpoint)(t.value.api_endpoint),d=await fetch(i,{method:'POST',headers:{'Content-Type':'application/json',Authorization:`Bearer ${t.value.api_key}`},body:JSON.stringify({model:t.value.model,messages:[{role:'system',content:n},{role:'user',content:a}],temperature:t.value.temperature||.7,max_tokens:t.value.max_tokens||65500})});if(h.value?.setProgress(40),h.value?.setMessage('ç­‰å¾… AI å“åº”...'),h.value?.addDetail('è¿™å¯èƒ½éœ€è¦ 10-30 ç§’ï¼Œè¯·è€å¿ƒç­‰å¾…'),!d.ok)throw new Error(`API é”™è¯¯: ${d.statusText}`);const p=await d.json(),u=p.choices[0]?.message?.content||'';h.value?.setProgress(70),h.value?.setMessage('æ­£åœ¨è§£æ AI ç”Ÿæˆçš„ä»£ç ...'),h.value?.addDetail(`æ”¶åˆ°å“åº”ï¼Œé•¿åº¦: ${u.length} å­—ç¬¦`);const m=/FILE_START:\s*([^\n]+)\n([\s\S]*?)(?=FILE_START:|FILE_END:|$)/g,f=[...u.matchAll(m)];if(0===f.length)throw new Error('AI æœªè¿”å›ä»»ä½•æ–‡ä»¶ä¿®æ”¹');for(const e of f){const n=e[1].trim().replace(/^\.\//,'');let t=Q(n,e[2]);t.endsWith('FILE_END')&&(t=t.slice(0,-8).trim());const a=r.value.find(e=>e.path===n);a?a.content=t:'index.html'!==n&&'style.css'!==n&&'script.js'!==n||r.value.push({path:n,content:t})}r.value.forEach(e=>{e.path=e.path.replace(/^\.\//,'')});const x=new Map;r.value.forEach(e=>{x.set(e.path,e)}),r.value=Array.from(x.values()),h.value?.setProgress(90),h.value?.setMessage('æ­£åœ¨æ›´æ–°é¢„è§ˆç•Œé¢...'),h.value?.addDetail(`å·²ç”Ÿæˆ ${f.length} ä¸ªæ–‡ä»¶`);const y=r.value.find(e=>'index.html'===e.path)||r.value[0];s.value=y,h.value?.setProgress(100),h.value?.setMessage('âœ… AI ç”Ÿæˆå®Œæˆï¼'),setTimeout(()=>{b.value=!1,c.value=!1,window.toastr.success('âœ… AI ç”Ÿæˆå®Œæˆï¼')},800)}catch(e){console.error('AI ç”Ÿæˆå¤±è´¥:',e),b.value=!1,window.toastr.error('AI ç”Ÿæˆå¤±è´¥: '+e.message)}}else window.toastr.error('è¯·è¾“å…¥ä¿®æ”¹éœ€æ±‚')}async function K(e){if(u.value){f.value=!0,b.value=!0;try{h.value?.setProgress(10),h.value?.setMessage('æ­£åœ¨å‡†å¤‡ AI ä¿®æ”¹è¯·æ±‚...'),h.value?.addDetail(`ä¿®æ”¹æŒ‡ä»¤: ${e}`);const n=r.value.map(e=>`=== ${e.path} ===\n${e.content}`).join('\n\n'),a='ä½ æ˜¯ä¸€ä¸ªä¸“ä¸šçš„å‰ç«¯å¼€å‘åŠ©æ‰‹ï¼Œä¸“é—¨ä¸º SillyTavern çŠ¶æ€æ ç”Ÿæˆ HTML/CSS/JS ä»£ç ç‰‡æ®µã€‚\n\nã€å…³é”®è¦æ±‚ã€‘ï¼š\n1. **å¿…é¡»åŒæ—¶è¾“å‡º index.htmlã€style.cssã€script.js ä¸‰ä¸ªæ–‡ä»¶**\n2. å³ä½¿ç”¨æˆ·åªæåˆ°ä¿®æ”¹æ ·å¼ï¼Œä½ ä¹Ÿå¿…é¡»å®Œæ•´è¾“å‡ºæ‰€æœ‰ä¸‰ä¸ªæ–‡ä»¶\n3. ä¸è¦åªä¿®æ”¹ä¸€ä¸ªæ–‡ä»¶å°±åœæ­¢ï¼Œä¸€å®šè¦è¾“å‡ºå®Œæ•´çš„ä¸‰ä¸ªæ–‡ä»¶\n4. ä½¿ç”¨ FILE_START å’Œ FILE_END æ ¼å¼ä¸¥æ ¼æ ‡è®°æ¯ä¸ªæ–‡ä»¶\n\nè¯·æ ¹æ®ç”¨æˆ·çš„åŸå§‹éœ€æ±‚å’Œä¿®æ”¹å»ºè®®ï¼Œ**å®Œæ•´åœ°**é‡æ–°ç”Ÿæˆæ‰€æœ‰ä»£ç æ–‡ä»¶ã€‚',s=`# åŸå§‹éœ€æ±‚ï¼š\n${u.value}\n\n# ä¿®æ”¹å»ºè®®ï¼š\n${e}\n\n# å­—æ®µé…ç½®ï¼ˆå¿…é¡»ä¸¥æ ¼éµå®ˆï¼‰ï¼š\n${o.value.fields.map((e,n)=>`å­—æ®µ${n+1}ï¼š${e.label} (å˜é‡å: ${e.name}) - å ä½ç¬¦: $${n+1}${e.icon?` - å›¾æ ‡: ${e.icon}`:''}`).join('\n')}\n\n# å½“å‰ä»£ç ï¼ˆä½œä¸ºä¿®æ”¹åŸºç¡€ï¼‰ï¼š\n${n}\n\nã€âš ï¸ é‡è¦ã€‘è¯·æ ¹æ®ä¿®æ”¹å»ºè®®ï¼Œ**å®Œæ•´åœ°è¾“å‡ºä»¥ä¸‹ä¸‰ä¸ªæ–‡ä»¶**ï¼š\n\nFILE_START: index.html\n<details>\n  \x3c!-- å®Œæ•´çš„ HTMLï¼Œå¿…é¡»ä½¿ç”¨ $1, $2, $3 ç­‰å ä½ç¬¦ --\x3e\n</details>\nFILE_END\n\nFILE_START: style.css\n/* å®Œæ•´çš„ CSS æ ·å¼ */\nFILE_END\n\nFILE_START: script.js\n(function() {\n  // å®Œæ•´çš„ JS ä»£ç \n})();\nFILE_END\n\n**ä¸è¦é—æ¼ä»»ä½•æ–‡ä»¶**ï¼Œå³ä½¿æŸä¸ªæ–‡ä»¶æ²¡æœ‰ä¿®æ”¹ä¹Ÿè¦å®Œæ•´è¾“å‡ºï¼`;h.value?.setProgress(20),h.value?.setMessage('æ­£åœ¨å‘é€ä¿®æ”¹è¯·æ±‚åˆ° AI æœåŠ¡å™¨...'),h.value?.addDetail(`å½“å‰æ–‡ä»¶æ•°: ${r.value.length} ä¸ª`);const i=(0,l.normalizeApiEndpoint)(t.value.api_endpoint);h.value?.setProgress(30),h.value?.setMessage('ç­‰å¾… AI ä¿®æ”¹ä»£ç ...'),h.value?.addDetail('è¿™å¯èƒ½éœ€è¦ 10-30 ç§’ï¼Œè¯·è€å¿ƒç­‰å¾…');const d=await fetch(i,{method:'POST',headers:{'Content-Type':'application/json',Authorization:`Bearer ${t.value.api_key}`},body:JSON.stringify({model:t.value.model,messages:[{role:'system',content:a},{role:'user',content:s}],temperature:.7,max_tokens:65500})});if(!d.ok)throw new Error(`API é”™è¯¯: ${d.statusText}`);h.value?.setProgress(60),h.value?.setMessage('æ­£åœ¨æ¥æ”¶ AI å“åº”...');const c=await d.json(),p=c.choices[0]?.message?.content||'';h.value?.setProgress(80),h.value?.setMessage('æ­£åœ¨è§£æä¿®æ”¹åçš„ä»£ç ...'),h.value?.addDetail(`å“åº”é•¿åº¦: ${p.length} å­—ç¬¦`);const g=/FILE_START:\s*([^\n]+)\n([\s\S]*?)(?=FILE_START:|FILE_END:|$)/g,f=[...p.matchAll(g)];if(0===f.length)throw new Error('AI æœªè¿”å›ä»»ä½•æ–‡ä»¶ä¿®æ”¹ã€‚è¯·å°è¯•æ›´æ˜ç¡®çš„ä¿®æ”¹æŒ‡ä»¤ã€‚');h.value?.addDetail(`è§£æåˆ° ${f.length} ä¸ªæ–‡ä»¶`);const x=f.map(e=>e[1].trim().replace(/^\.\//,'')),y=['index.html','style.css','script.js'].filter(e=>!x.includes(e));if(y.length>0&&(h.value?.addDetail(`âš ï¸ è­¦å‘Š: AI æœªç”Ÿæˆä»¥ä¸‹æ–‡ä»¶: ${y.join(', ')}`),window.toastr.warning(`AI å¯èƒ½åªç”Ÿæˆäº†éƒ¨åˆ†æ–‡ä»¶ï¼Œç¼ºå°‘: ${y.join(', ')}`,'',{timeOut:5e3})),f.length>0)for(const e of f){const n=e[1].trim().replace(/^\.\//,'');let t=Q(n,e[2]);t.endsWith('FILE_END')&&(t=t.slice(0,-8).trim());const a=r.value.find(e=>e.path===n);a&&(a.content=t,h.value?.addDetail(`âœ“ å·²æ›´æ–°: ${n}`))}h.value?.setProgress(95),h.value?.setMessage('æ­£åœ¨æ›´æ–°é¢„è§ˆ...'),u.value+=`\n\nã€å·²åº”ç”¨çš„ä¿®æ”¹ã€‘ï¼š${e}`,h.value?.setProgress(100),h.value?.setMessage('âœ… AI ä¿®æ”¹å®Œæˆï¼'),setTimeout(()=>{b.value=!1,m.value=!1,window.toastr.success(`âœ… AI ä¿®æ”¹å®Œæˆï¼å·²æ›´æ–° ${f.length} ä¸ªæ–‡ä»¶`)},800)}catch(e){console.error('AI ä¿®æ”¹å¤±è´¥:',e),b.value=!1,window.toastr.error('AI ä¿®æ”¹å¤±è´¥: '+e.message)}finally{f.value=!1}}else window.toastr.warning('è¯·å…ˆç”Ÿæˆå†…å®¹')}async function X(){await(0,d.lW)(M.value,'âœ… ä¸–ç•Œä¹¦å†…å®¹å·²å¤åˆ¶åˆ°å‰ªè´´æ¿ï¼')}function Q(e,n){let t=n.trim();const a=t.match(/^```[a-zA-Z0-9]*\s*([\s\S]*?)\s*```$/);a&&(t=a[1].trim());const o=t.match(/^("""|''')[a-zA-Z0-9]*\s*([\s\S]*?)\s*\1$/);return o&&(t=o[2].trim()),t=t.replace(/^(```|"""|''')[a-zA-Z0-9]*\s*\n?/,''),t=t.replace(/\n?\s*(```|"""|''')$/,''),e.endsWith('.html')&&(t=t.replace(/<!DOCTYPE html>/i,e=>e.toUpperCase())),t}function Z(){const e=r.value.find(e=>'index.html'===e.path),n=r.value.find(e=>'style.css'===e.path),t=r.value.find(e=>'script.js'===e.path);if(!e||''===e.content.trim())return void window.toastr.error('è¯·å…ˆç”Ÿæˆæˆ–ç¼–è¾‘çŠ¶æ€æ ä»£ç ');const a='xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g,function(e){const n=16*Math.random()|0;return('x'===e?n:3&n|8).toString(16)}),s='script',i='style',l=`${e.content.trim()}\n<${i}>\n${n?.content||''}\n</${i}>\n\n<${s}>\n${t?.content||''}\n</${s}>`;let d=o.value.findRegex;const c=(d.match(/\([^)]+\)/g)||[]).length,p=o.value.fields.length;0===c&&(d=`${d.replace(/[.*+?^${}()|[\]\\]/g,'\\$&')}[\\r\\n]*${Array(p).fill('\\|([^|]+)').join('')}\\|[\\r\\n]*`);const g=l.replace(/\r\n/g,'\n').replace(/\r/g,'\n'),u={id:a,scriptName:o.value.name,findRegex:d,replaceString:g,trimStrings:[],placement:[2],disabled:!1,markdownOnly:!0,promptOnly:!1,runOnEdit:!0,substituteRegex:0,minDepth:null,maxDepth:null},m=new Blob([JSON.stringify(u,null,2)],{type:'application/json'}),f=URL.createObjectURL(m),x=document.createElement('a');x.href=f,x.download=`regex-${o.value.name}.json`,x.click(),URL.revokeObjectURL(f),window.toastr.success('âœ… æ­£åˆ™ JSON å·²å¯¼å‡ºæˆåŠŸï¼')}return(0,i.onMounted)(()=>{!function(){try{const e=(0,d.Ut)();if(!e)return void console.warn('script_id ä¸ºç©ºï¼Œæ— æ³•åŠ è½½çŠ¶æ€æ é…ç½®');const n=getVariables({type:'script',script_id:e}).statusbar_generator_config;n&&(o.value={...o.value,...n},console.log('âœ… å·²åŠ è½½ä¿å­˜çš„çŠ¶æ€æ é…ç½®'))}catch(e){console.error('åŠ è½½çŠ¶æ€æ é…ç½®å¤±è´¥:',e)}}()}),(0,i.watch)(()=>o.value,()=>{!function(){try{const e=(0,d.Ut)();if(!e)return void console.warn('script_id ä¸ºç©ºï¼Œæ— æ³•ä¿å­˜çŠ¶æ€æ é…ç½®');insertOrAssignVariables({statusbar_generator_config:o.value},{type:'script',script_id:e})}catch(e){console.error('ä¿å­˜çŠ¶æ€æ é…ç½®å¤±è´¥:',e)}}()},{deep:!0}),(e,n)=>((0,i.openBlock)(),(0,i.createElementBlock)('div',fs,[(0,i.createCommentVNode)(' é¡¶éƒ¨æ“ä½œæ  '),(0,i.createElementVNode)('div',xs,[n[32]||(n[32]=(0,i.createElementVNode)('h3',{style:{margin:'0',color:'#fff','font-size':'16px !important','font-weight':'600',display:'flex','align-items':'center',gap:'12px','letter-spacing':'0.5px','text-shadow':'0 1px 2px rgba(0, 0, 0, 0.5)'}},[(0,i.createElementVNode)('i',{class:'fa-solid fa-chart-bar',style:{color:'#4a9eff','font-size':'18px'}}),(0,i.createTextVNode)(' çŠ¶æ€æ ç”Ÿæˆå™¨ ')],-1)),(0,i.createElementVNode)('div',bs,[(0,i.createElementVNode)('button',{style:{padding:'8px 16px',background:'linear-gradient(135deg, #10b981 0%, #059669 100%)',border:'none','border-radius':'8px',color:'white','font-size':'13px','font-weight':'600',cursor:'pointer',transition:'all 0.3s ease'},onClick:n[0]||(n[0]=e=>function(e){const n=a[e];n&&(o.value=JSON.parse(JSON.stringify(n)),window.toastr.success(`âœ… å·²åŠ è½½"${n.name}"æ¨¡æ¿`))}('abo')),onMouseenter:n[1]||(n[1]=e=>e.currentTarget.style.transform='translateY(-2px)'),onMouseleave:n[2]||(n[2]=e=>e.currentTarget.style.transform='translateY(0)')},[...n[29]||(n[29]=[(0,i.createElementVNode)('i',{class:'fa-solid fa-magic',style:{'margin-right':'6px'}},null,-1),(0,i.createTextVNode)(' å¿«é€ŸåŠ è½½ ABO æ¨¡æ¿ ',-1)])],32),(0,i.createElementVNode)('button',{style:{padding:'8px 16px',background:'linear-gradient(135deg, #8b5cf6 0%, #7c3aed 100%)',border:'none','border-radius':'8px',color:'white','font-size':'13px','font-weight':'600',cursor:'pointer',transition:'all 0.3s ease'},onClick:J,onMouseenter:n[3]||(n[3]=e=>e.currentTarget.style.transform='translateY(-2px)'),onMouseleave:n[4]||(n[4]=e=>e.currentTarget.style.transform='translateY(0)')},[...n[30]||(n[30]=[(0,i.createElementVNode)('i',{class:'fa-solid fa-wand-magic-sparkles',style:{'margin-right':'6px'}},null,-1),(0,i.createTextVNode)(' AI æ™ºèƒ½ç¼–è¾‘ ',-1)])],32),(0,i.createElementVNode)('button',{style:{padding:'8px 16px',background:'linear-gradient(135deg, #06b6d4 0%, #0891b2 100%)',border:'none','border-radius':'8px',color:'white','font-size':'13px','font-weight':'600',cursor:'pointer',transition:'all 0.3s ease'},onClick:Z,onMouseenter:n[5]||(n[5]=e=>e.currentTarget.style.transform='translateY(-2px)'),onMouseleave:n[6]||(n[6]=e=>e.currentTarget.style.transform='translateY(0)')},[...n[31]||(n[31]=[(0,i.createElementVNode)('i',{class:'fa-solid fa-download',style:{'margin-right':'6px'}},null,-1),(0,i.createTextVNode)(' å¯¼å‡ºæ­£åˆ™ JSON ',-1)])],32)])]),(0,i.createCommentVNode)(' ä¸»å†…å®¹åŒºï¼šä¸‰åˆ—å¸ƒå±€ '),(0,i.createElementVNode)('div',hs,[(0,i.createCommentVNode)(' å·¦ä¾§ï¼šå­—æ®µé…ç½® '),(0,i.createElementVNode)('div',ys,[n[38]||(n[38]=(0,i.createElementVNode)('h4',{style:{margin:'0 0 15px 0',color:'#fff','font-size':'14px','font-weight':'600',display:'flex','align-items':'center',gap:'8px'}},[(0,i.createElementVNode)('i',{class:'fa-solid fa-cog',style:{color:'#4a9eff'}}),(0,i.createTextVNode)(' å­—æ®µé…ç½® ')],-1)),(0,i.createCommentVNode)(' è§¦å‘æ­£åˆ™ '),(0,i.createElementVNode)('div',vs,[n[33]||(n[33]=(0,i.createElementVNode)('label',{style:{display:'block','margin-bottom':'8px',color:'#c0c0c0','font-size':'12px','font-weight':'600'}},'è§¦å‘æ­£åˆ™',-1)),(0,i.withDirectives)((0,i.createElementVNode)('input',{'onUpdate:modelValue':n[7]||(n[7]=e=>o.value.findRegex=e),type:'text',placeholder:'<-CHARACTER_STATUS->',style:{width:'100%',padding:'8px 12px',background:'#1e1e1e',border:'1px solid #3a3a3a','border-radius':'6px',color:'#e0e0e0','font-size':'12px'}},null,512),[[i.vModelText,o.value.findRegex]])]),(0,i.createCommentVNode)(' å­—æ®µåˆ—è¡¨ '),(0,i.createElementVNode)('div',ws,[((0,i.openBlock)(!0),(0,i.createElementBlock)(i.Fragment,null,(0,i.renderList)(o.value.fields,(e,n)=>((0,i.openBlock)(),(0,i.createElementBlock)('div',{key:n,style:{padding:'10px',background:'#1e1e1e','border-radius':'6px',border:'1px solid #3a3a3a'}},[(0,i.createElementVNode)('div',ks,[(0,i.createElementVNode)('span',As,'å­—æ®µ '+(0,i.toDisplayString)(n+1),1),(0,i.createElementVNode)('button',{disabled:o.value.fields.length<=1,style:(0,i.normalizeStyle)({padding:'4px 8px',background:'#ef4444',border:'none',borderRadius:'4px',color:'white',fontSize:'10px',cursor:'pointer',opacity:o.value.fields.length<=1?.4:1}),onClick:e=>function(e){o.value.fields.splice(e,1)}(n)},' åˆ é™¤ ',12,Cs)]),(0,i.withDirectives)((0,i.createElementVNode)('input',{'onUpdate:modelValue':n=>e.name=n,type:'text',placeholder:'å­—æ®µåç§°',style:{width:'100%',padding:'6px 10px',background:'#2a2a2a',border:'1px solid #3a3a3a','border-radius':'4px',color:'#e0e0e0','font-size':'11px','margin-bottom':'6px'}},null,8,Es),[[i.vModelText,e.name]]),(0,i.withDirectives)((0,i.createElementVNode)('input',{'onUpdate:modelValue':n=>e.label=n,type:'text',placeholder:'æ˜¾ç¤ºåç§°',style:{width:'100%',padding:'6px 10px',background:'#2a2a2a',border:'1px solid #3a3a3a','border-radius':'4px',color:'#e0e0e0','font-size':'11px','margin-bottom':'6px'}},null,8,Ts),[[i.vModelText,e.label]]),(0,i.createElementVNode)('div',Ss,[(0,i.withDirectives)((0,i.createElementVNode)('input',{'onUpdate:modelValue':n=>e.icon=n,type:'text',placeholder:'å›¾æ ‡ç±»åï¼ˆå¯é€‰ï¼Œå¦‚ï¼šfa-solid fa-userï¼‰',style:{flex:'1',padding:'6px 10px',background:'#2a2a2a',border:'1px solid #3a3a3a','border-radius':'4px',color:'#e0e0e0','font-size':'11px','font-family':'monospace'}},null,8,Ns),[[i.vModelText,e.icon]]),(0,i.createElementVNode)('button',{style:{padding:'6px 10px',background:'#3a3a3a',border:'1px solid #4a4a4a','border-radius':'4px',color:'#fff','font-size':'12px',cursor:'pointer','min-width':'36px'},title:'é€‰æ‹©å›¾æ ‡',onClick:e=>function(e){x.value=e}(n)},[e.icon?((0,i.openBlock)(),(0,i.createElementBlock)('i',{key:0,class:(0,i.normalizeClass)(e.icon)},null,2)):((0,i.openBlock)(),(0,i.createElementBlock)('i',_s))],8,Is)])]))),128))]),(0,i.createElementVNode)('button',{style:{width:'100%',padding:'8px',background:'linear-gradient(135deg, #8b5cf6 0%, #7c3aed 100%)',border:'none','border-radius':'6px',color:'white','font-size':'12px','font-weight':'600',cursor:'pointer'},onClick:j},[...n[34]||(n[34]=[(0,i.createElementVNode)('i',{class:'fa-solid fa-plus',style:{'margin-right':'6px'}},null,-1),(0,i.createTextVNode)(' æ·»åŠ å­—æ®µ ',-1)])]),(0,i.createElementVNode)('button',{style:{width:'100%',padding:'8px','margin-top':'10px',background:'linear-gradient(135deg, #f59e0b 0%, #d97706 100%)',border:'none','border-radius':'6px',color:'white','font-size':'12px','font-weight':'600',cursor:'pointer'},onClick:R},[...n[35]||(n[35]=[(0,i.createElementVNode)('i',{class:'fa-solid fa-code',style:{'margin-right':'6px'}},null,-1),(0,i.createTextVNode)(' AI è§£æ XML ç”Ÿæˆå­—æ®µ ',-1)])]),(0,i.createElementVNode)('button',{style:{width:'100%',padding:'8px','margin-top':'10px',background:'linear-gradient(135deg, #10b981 0%, #059669 100%)',border:'none','border-radius':'6px',color:'white','font-size':'12px','font-weight':'600',cursor:'pointer'},onClick:O},[...n[36]||(n[36]=[(0,i.createElementVNode)('i',{class:'fa-solid fa-wand-magic-sparkles',style:{'margin-right':'6px'}},null,-1),(0,i.createTextVNode)(' AI æ™ºèƒ½ç”Ÿæˆå­—æ®µ ',-1)])]),(0,i.createElementVNode)('button',{style:{width:'100%',padding:'8px','margin-top':'10px',background:'linear-gradient(135deg, #10b981 0%, #059669 100%)',border:'none','border-radius':'6px',color:'white','font-size':'12px','font-weight':'600',cursor:'pointer'},onClick:Y},[...n[37]||(n[37]=[(0,i.createElementVNode)('i',{class:'fa-solid fa-sparkles',style:{'margin-right':'6px'}},null,-1),(0,i.createTextVNode)(' æ ¹æ®å­—æ®µç”Ÿæˆæ¨¡æ¿ ',-1)])])]),(0,i.createCommentVNode)(' ä¸­é—´ï¼šä»£ç ç¼–è¾‘å™¨ '),(0,i.createElementVNode)('div',Vs,[(0,i.createCommentVNode)(' æ–‡ä»¶æ ‡ç­¾ '),(0,i.createElementVNode)('div',zs,[((0,i.openBlock)(!0),(0,i.createElementBlock)(i.Fragment,null,(0,i.renderList)(r.value,e=>((0,i.openBlock)(),(0,i.createElementBlock)('div',{key:e.path,style:(0,i.normalizeStyle)({padding:'6px 14px',background:s.value?.path===e.path?'#4a9eff':'#1e1e1e',color:s.value?.path===e.path?'#fff':'#c0c0c0',borderRadius:'6px',fontSize:'12px',fontWeight:'600',cursor:'pointer',transition:'all 0.2s ease'}),onClick:n=>s.value=e},(0,i.toDisplayString)(e.path),13,Bs))),128))]),(0,i.createCommentVNode)(' ä»£ç ç¼–è¾‘å™¨ '),s.value?(0,i.withDirectives)(((0,i.openBlock)(),(0,i.createElementBlock)('textarea',{key:0,'onUpdate:modelValue':n[8]||(n[8]=e=>s.value.content=e),style:{flex:'1',width:'100%',padding:'12px',background:'#1e1e1e',border:'1px solid #3a3a3a','border-radius':'8px',color:'#e0e0e0','font-size':'13px','font-family':'\'Consolas\', \'Monaco\', monospace','line-height':'1.6',resize:'none','min-height':'400px'},onInput:D},null,544)),[[i.vModelText,s.value.content]]):(0,i.createCommentVNode)('v-if',!0)]),(0,i.createCommentVNode)(' å³ä¾§ï¼šé¢„è§ˆå’Œä¸–ç•Œä¹¦ '),(0,i.createElementVNode)('div',Ms,[(0,i.createCommentVNode)(' ä¸–ç•Œä¹¦æ¡ç›® '),(0,i.createElementVNode)('div',Ps,[(0,i.createElementVNode)('div',{style:{display:'flex','justify-content':'space-between','align-items':'center','margin-bottom':'12px'}},[n[40]||(n[40]=(0,i.createElementVNode)('h4',{style:{margin:'0',color:'#fff','font-size':'14px','font-weight':'600',display:'flex','align-items':'center',gap:'8px'}},[(0,i.createElementVNode)('i',{class:'fa-solid fa-book',style:{color:'#4a9eff'}}),(0,i.createTextVNode)(' ä¸–ç•Œä¹¦æ¡ç›® ')],-1)),(0,i.createElementVNode)('button',{style:{padding:'6px 12px',background:'linear-gradient(135deg, #10b981 0%, #059669 100%)',border:'none','border-radius':'6px',color:'white','font-size':'12px','font-weight':'600',cursor:'pointer'},onClick:X},[...n[39]||(n[39]=[(0,i.createElementVNode)('i',{class:'fa-solid fa-copy',style:{'margin-right':'4px'}},null,-1),(0,i.createTextVNode)(' å¤åˆ¶ ',-1)])])]),(0,i.createElementVNode)('div',$s,[(0,i.createElementVNode)('pre',Ds,(0,i.toDisplayString)(M.value),1)])]),(0,i.createCommentVNode)(' çŠ¶æ€æ é¢„è§ˆ '),(0,i.createElementVNode)('div',js,[n[41]||(n[41]=(0,i.createElementVNode)('h4',{style:{margin:'0 0 12px 0',color:'#fff','font-size':'14px','font-weight':'600',display:'flex','align-items':'center',gap:'8px'}},[(0,i.createElementVNode)('i',{class:'fa-solid fa-eye',style:{color:'#4a9eff'}}),(0,i.createTextVNode)(' å®æ—¶é¢„è§ˆ ')],-1)),(0,i.createElementVNode)('div',{style:{background:'#1e1e1e','border-radius':'8px',padding:'20px','min-height':'400px',border:'1px solid #3a3a3a',overflow:'auto'},innerHTML:P.value},null,8,Rs)])])]),(0,i.createCommentVNode)(' å›¾æ ‡é€‰æ‹©å™¨å¯¹è¯æ¡† '),null!==x.value?((0,i.openBlock)(),(0,i.createElementBlock)('div',{key:0,style:{position:'fixed',top:'0',left:'0',right:'0',bottom:'0',background:'rgba(0, 0, 0, 0.8)',display:'flex','align-items':'center','justify-content':'center','z-index':'10000'},onClick:n[13]||(n[13]=(0,i.withModifiers)(e=>x.value=null,['self']))},[(0,i.createElementVNode)('div',Os,[n[42]||(n[42]=(0,i.createElementVNode)('h3',{style:{margin:'0 0 16px 0',color:'#fff','font-size':'15px','font-weight':'600'}},'é€‰æ‹©å›¾æ ‡',-1)),(0,i.createElementVNode)('div',Fs,[((0,i.openBlock)(),(0,i.createElementBlock)(i.Fragment,null,(0,i.renderList)(B,(e,t)=>(0,i.createElementVNode)('div',{key:t,style:{padding:'14px',background:'#1e1e1e',borderRadius:'8px',cursor:'pointer',textAlign:'center',border:'1px solid #3a3a3a',transition:'all 0.2s ease',display:'flex',alignItems:'center',justifyContent:'center'},title:e,onClick:n=>function(e){null!==x.value&&(o.value.fields[x.value].icon=e,x.value=null)}(e),onMouseenter:n[9]||(n[9]=e=>{e.currentTarget.style.background='#3a3a3a',e.currentTarget.style.borderColor='#4a9eff',e.currentTarget.style.transform='scale(1.1)',e.currentTarget.style.boxShadow='0 4px 12px rgba(74, 158, 255, 0.3)'}),onMouseleave:n[10]||(n[10]=e=>{e.currentTarget.style.background='#1e1e1e',e.currentTarget.style.borderColor='#3a3a3a',e.currentTarget.style.transform='scale(1)',e.currentTarget.style.boxShadow='none'})},[(0,i.createElementVNode)('i',{class:(0,i.normalizeClass)(e),style:{'font-size':'20px',color:'#4a9eff'}},null,2)],40,Ls)),64))]),(0,i.createElementVNode)('div',Hs,[(0,i.createElementVNode)('button',{style:{padding:'8px 16px',background:'#3a3a3a',border:'none','border-radius':'6px',color:'#fff','font-size':'13px','font-weight':'600',cursor:'pointer'},onClick:n[11]||(n[11]=e=>x.value=null)},' å–æ¶ˆ '),(0,i.createElementVNode)('button',{style:{padding:'8px 16px',background:'#ef4444',border:'none','border-radius':'6px',color:'white','font-size':'13px','font-weight':'600',cursor:'pointer'},onClick:n[12]||(n[12]=e=>{o.value.fields[x.value].icon='',x.value=null})},' æ¸…é™¤å›¾æ ‡ ')])])])):(0,i.createCommentVNode)('v-if',!0),(0,i.createCommentVNode)(' AI ç¼–è¾‘å¯¹è¯æ¡† '),c.value?((0,i.openBlock)(),(0,i.createElementBlock)('div',{key:1,style:{position:'fixed',top:'0',left:'0',right:'0',bottom:'0',background:'rgba(0, 0, 0, 0.8)',display:'flex','align-items':'center','justify-content':'center','z-index':'10000'},onClick:n[17]||(n[17]=(0,i.withModifiers)(e=>c.value=!1,['self']))},[(0,i.createElementVNode)('div',Us,[n[48]||(n[48]=(0,i.createElementVNode)('h3',{style:{margin:'0 0 16px 0',color:'#fff','font-size':'16px','font-weight':'600'}},'AI æ™ºèƒ½ç¼–è¾‘',-1)),(0,i.createCommentVNode)(' å­—æ®µé…ç½®åŒºåŸŸï¼ˆå¯ç¼–è¾‘ï¼‰ '),(0,i.createElementVNode)('div',Gs,[(0,i.createElementVNode)('div',Ys,[(0,i.createElementVNode)('div',Js,[n[43]||(n[43]=(0,i.createElementVNode)('i',{class:'fa-solid fa-cog',style:{color:'#60a5fa','font-size':'16px'}},null,-1)),(0,i.createElementVNode)('div',Ws,' å­—æ®µé…ç½®ï¼ˆå…± '+(0,i.toDisplayString)(o.value.fields.length)+' ä¸ªï¼‰ ',1)]),(0,i.createElementVNode)('button',{style:{padding:'4px 10px',background:'rgba(16, 185, 129, 0.2)',border:'1px solid rgba(16, 185, 129, 0.4)','border-radius':'4px',color:'#10b981','font-size':'11px',cursor:'pointer'},onClick:W},[...n[44]||(n[44]=[(0,i.createElementVNode)('i',{class:'fa-solid fa-plus'},null,-1),(0,i.createTextVNode)(' æ·»åŠ å­—æ®µ ',-1)])])]),o.value.fields.length>0?((0,i.openBlock)(),(0,i.createElementBlock)('div',qs,[((0,i.openBlock)(!0),(0,i.createElementBlock)(i.Fragment,null,(0,i.renderList)(o.value.fields,(e,t)=>((0,i.openBlock)(),(0,i.createElementBlock)('div',{key:t,style:{background:'rgba(15, 23, 42, 0.6)',border:'1px solid rgba(148, 163, 184, 0.15)','border-radius':'6px',padding:'8px 10px',display:'flex','align-items':'center',gap:'8px'}},[(0,i.createElementVNode)('span',Ks,'å­—æ®µ'+(0,i.toDisplayString)(t+1)+':',1),(0,i.withDirectives)((0,i.createElementVNode)('input',{'onUpdate:modelValue':n=>e.label=n,type:'text',placeholder:'æ˜¾ç¤ºåç§°',style:{flex:'1',padding:'4px 8px',background:'#1e1e1e',border:'1px solid #3a3a3a','border-radius':'4px',color:'#e0e0e0','font-size':'11px'}},null,8,Xs),[[i.vModelText,e.label]]),(0,i.withDirectives)((0,i.createElementVNode)('input',{'onUpdate:modelValue':n=>e.name=n,type:'text',placeholder:'å˜é‡å',style:{flex:'1',padding:'4px 8px',background:'#1e1e1e',border:'1px solid #3a3a3a','border-radius':'4px',color:'#e0e0e0','font-size':'11px'}},null,8,Qs),[[i.vModelText,e.name]]),e.icon?((0,i.openBlock)(),(0,i.createElementBlock)('button',{key:0,style:{padding:'4px 8px',background:'rgba(139, 92, 246, 0.2)',border:'1px solid rgba(139, 92, 246, 0.3)','border-radius':'4px',color:'#a78bfa','font-size':'11px',cursor:'pointer','min-width':'30px'},title:'ç§»é™¤å›¾æ ‡',onClick:n=>e.icon=''},[(0,i.createElementVNode)('i',{class:(0,i.normalizeClass)(e.icon)},null,2)],8,Zs)):(0,i.createCommentVNode)('v-if',!0),(0,i.createElementVNode)('button',{disabled:o.value.fields.length<=1,style:(0,i.normalizeStyle)([{padding:'4px 8px',background:'rgba(239, 68, 68, 0.2)',border:'1px solid rgba(239, 68, 68, 0.3)','border-radius':'4px',color:'#ef4444','font-size':'11px',cursor:'pointer'},{opacity:o.value.fields.length<=1?.4:1,cursor:o.value.fields.length<=1?'not-allowed':'pointer'}]),title:'åˆ é™¤å­—æ®µ',onClick:e=>{return n=t,void(o.value.fields.length<=1?window.toastr.warning('è‡³å°‘éœ€è¦ä¿ç•™ä¸€ä¸ªå­—æ®µ'):o.value.fields.splice(n,1));var n}},[...n[45]||(n[45]=[(0,i.createElementVNode)('i',{class:'fa-solid fa-trash'},null,-1)])],12,ei)]))),128))])):((0,i.openBlock)(),(0,i.createElementBlock)('div',ni,'âš ï¸ æš‚æ— å­—æ®µï¼Œè¯·ç‚¹å‡»"æ·»åŠ å­—æ®µ"æŒ‰é’®'))]),(0,i.withDirectives)((0,i.createElementVNode)('textarea',{'onUpdate:modelValue':n[14]||(n[14]=e=>g.value=e),placeholder:'æè¿°æ‚¨æƒ³è¦çš„æ ·å¼å’Œæ•ˆæœï¼Œä¾‹å¦‚ï¼š\nâ€¢ ä¿æŒç°æœ‰æ ·å¼ï¼Œç¾åŒ–çŠ¶æ€æ ç•Œé¢\nâ€¢ æŠŠèƒŒæ™¯è‰²æ”¹æˆæ·±è“è‰²æ¸å˜\nâ€¢ æ·»åŠ åŠ¨ç”»æ•ˆæœï¼Œè®©å­—æ®µæ·¡å…¥æ˜¾ç¤º\nâ€¢ ä½¿ç”¨å¡ç‰‡å¸ƒå±€ï¼Œæ¯ä¸ªå­—æ®µç‹¬ç«‹æ˜¾ç¤º\n\nâš ï¸ æ³¨æ„ï¼š\nâ€¢ AI ä¼šåŸºäºä¸Šæ–¹é…ç½®çš„å­—æ®µç”Ÿæˆä»£ç ï¼Œä¸ä¼šæ”¹å˜å­—æ®µæ•°é‡å’Œé¡ºåº\nâ€¢ ä»£ç ä¼šä½¿ç”¨é€šç”¨æ ¼å¼ï¼Œå¯è¿ç§»åˆ°ä»»ä½•è§’è‰²',style:{width:'100%',padding:'12px',background:'#1e1e1e',border:'1px solid #3a3a3a','border-radius':'6px',color:'#e0e0e0','font-size':'13px','min-height':'120px','margin-bottom':'16px',resize:'vertical'}},null,512),[[i.vModelText,g.value]]),(0,i.createElementVNode)('div',ti,[(0,i.createElementVNode)('button',{style:{padding:'8px 16px',background:'#3a3a3a',border:'none','border-radius':'6px',color:'#fff','font-size':'13px','font-weight':'600',cursor:'pointer'},onClick:n[15]||(n[15]=e=>c.value=!1)},' å–æ¶ˆ '),(0,i.createElementVNode)('button',{style:{padding:'8px 16px',background:'linear-gradient(135deg, #8b5cf6 0%, #7c3aed 100%)',border:'none','border-radius':'6px',color:'white','font-size':'13px','font-weight':'600',cursor:'pointer'},onClick:q},[...n[46]||(n[46]=[(0,i.createElementVNode)('i',{class:'fa-solid fa-wand-magic-sparkles',style:{'margin-right':'6px'}},null,-1),(0,i.createTextVNode)(' ç”Ÿæˆ ',-1)])])]),u.value?((0,i.openBlock)(),(0,i.createElementBlock)('div',ai,[(0,i.createElementVNode)('button',{style:{padding:'10px 20px',background:'#ffc107',border:'none','border-radius':'6px',color:'#000','font-size':'13px','font-weight':'600',cursor:'pointer'},disabled:f.value,onClick:n[16]||(n[16]=e=>m.value=!0)},[n[47]||(n[47]=(0,i.createElementVNode)('i',{class:'fa-solid fa-edit',style:{'margin-right':'6px'}},null,-1)),(0,i.createTextVNode)(' '+(0,i.toDisplayString)(f.value?'ä¿®æ”¹ä¸­...':'AI ä¿®æ”¹'),1)],8,oi)])):(0,i.createCommentVNode)('v-if',!0)])])):(0,i.createCommentVNode)('v-if',!0),(0,i.createCommentVNode)(' AI ä¿®æ”¹å¯¹è¯æ¡† '),(0,i.createVNode)(U,{show:m.value,'is-modifying':f.value,title:'AI ä¿®æ”¹ç•Œé¢ä»£ç ',description:'æè¿°ä½ æƒ³è¦ä¿®æ”¹çš„åœ°æ–¹ï¼ŒAI ä¼šåœ¨å½“å‰ä»£ç çš„åŸºç¡€ä¸Šè¿›è¡Œè°ƒæ•´ã€‚',examples:['æŠŠèƒŒæ™¯è‰²æ”¹æˆæ·±è“è‰²æ¸å˜','æ·»åŠ åŠ¨ç”»æ•ˆæœï¼Œè®©å­—æ®µæ·¡å…¥æ˜¾ç¤º','ä½¿ç”¨å¡ç‰‡å¸ƒå±€ï¼Œæ¯ä¸ªå­—æ®µç‹¬ç«‹æ˜¾ç¤º','å¢åŠ æ‚¬åœæ•ˆæœ'],onClose:n[18]||(n[18]=e=>m.value=!1),onConfirm:K},null,8,['show','is-modifying']),(0,i.createCommentVNode)(' XML è§£æå¯¹è¯æ¡† '),E.value?((0,i.openBlock)(),(0,i.createElementBlock)('div',{key:2,style:{position:'fixed',top:'0',left:'0',right:'0',bottom:'0',background:'rgba(0, 0, 0, 0.7)',display:'flex','align-items':'center','justify-content':'center','z-index':'10000'},onClick:n[22]||(n[22]=(0,i.withModifiers)(e=>E.value=!1,['self']))},[(0,i.createElementVNode)('div',ri,[n[52]||(n[52]=(0,i.createStaticVNode)('<h3 style="margin:0 0 16px 0;color:#f59e0b;font-size:18px;font-weight:600;" data-v-22fa8ffd><i class="fa-solid fa-robot" style="margin-right:8px;" data-v-22fa8ffd></i> AI è§£æ XML ç”Ÿæˆå­—æ®µ </h3><div style="background:rgba(251, 191, 36, 0.1);border:1px solid rgba(251, 191, 36, 0.3);border-radius:6px;padding:12px;margin-bottom:16px;" data-v-22fa8ffd><p style="margin:0;color:#fbbf24;font-size:12px;line-height:1.6;" data-v-22fa8ffd><i class="fa-solid fa-circle-info" style="margin-right:6px;" data-v-22fa8ffd></i><strong data-v-22fa8ffd>æ¸©é¦¨æç¤ºï¼š</strong>æ­¤åŠŸèƒ½éœ€è¦è°ƒç”¨ AIï¼Œè¯·ç¡®ä¿å·²åœ¨å³ä¸Šè§’ <i class="fa-solid fa-cog" data-v-22fa8ffd></i> è®¾ç½®ä¸­é…ç½®äº†æœ‰æ•ˆçš„ API å¯†é’¥ã€‚ </p></div>',2)),(0,i.createElementVNode)('div',si,[n[49]||(n[49]=(0,i.createElementVNode)('label',{style:{display:'block','margin-bottom':'8px',color:'#e0e0e0','font-size':'13px'}},' ç²˜è´´ XML çŠ¶æ€æ ä»£ç ï¼š ',-1)),(0,i.withDirectives)((0,i.createElementVNode)('textarea',{'onUpdate:modelValue':n[19]||(n[19]=e=>T.value=e),placeholder:'ä¾‹å¦‚ï¼š\n<state_bar>\n<i>ã€å†…å®¹ã€‘</i>\n<æ—¥æœŸ>ã€å½“å‰æ—¥æœŸã€‘</æ—¥æœŸ>\n<è§’è‰²ç”Ÿç†çŠ¶æ€>ã€æè¿°è§’è‰²å½“å‰ç”Ÿç†çŠ¶æ€ã€‘</è§’è‰²ç”Ÿç†çŠ¶æ€>\n</state_bar>',style:{width:'100%','min-height':'200px',padding:'12px',background:'#1a1a1a',border:'1px solid #404040','border-radius':'6px',color:'#e0e0e0','font-family':'\'Consolas\', \'Monaco\', monospace','font-size':'13px',resize:'vertical'}},null,512),[[i.vModelText,T.value]])]),(0,i.createElementVNode)('div',ii,[(0,i.createElementVNode)('button',{style:{padding:'10px 20px',background:'#404040',border:'none','border-radius':'6px',color:'white','font-size':'13px',cursor:'pointer'},onClick:n[20]||(n[20]=e=>E.value=!1)},' å–æ¶ˆ '),(0,i.createElementVNode)('button',{style:{padding:'10px 20px',background:'linear-gradient(135deg, #f59e0b 0%, #d97706 100%)',border:'none','border-radius':'6px',color:'white','font-size':'13px',cursor:'pointer','margin-right':'10px'},disabled:!T.value.trim()||S.value,onClick:F},[n[50]||(n[50]=(0,i.createElementVNode)('i',{class:'fa-solid fa-robot',style:{'margin-right':'6px'}},null,-1)),(0,i.createTextVNode)(' '+(0,i.toDisplayString)(S.value?'AI è§£æä¸­...':'å¼€å§‹è§£æ'),1)],8,li),y.value?((0,i.openBlock)(),(0,i.createElementBlock)('button',{key:0,style:{padding:'10px 20px',background:'#ffc107',border:'none','border-radius':'6px',color:'#000','font-size':'13px',cursor:'pointer'},disabled:w.value,onClick:n[21]||(n[21]=e=>v.value=!0)},[n[51]||(n[51]=(0,i.createElementVNode)('i',{class:'fa-solid fa-edit',style:{'margin-right':'6px'}},null,-1)),(0,i.createTextVNode)(' '+(0,i.toDisplayString)(w.value?'ä¿®æ”¹ä¸­...':'AI ä¿®æ”¹'),1)],8,di)):(0,i.createCommentVNode)('v-if',!0)])])])):(0,i.createCommentVNode)('v-if',!0),(0,i.createCommentVNode)(' XML ä¿®æ”¹å¯¹è¯æ¡† '),(0,i.createVNode)(U,{show:v.value,'is-modifying':w.value,title:'AI ä¿®æ”¹ XML è§£æ',description:'æè¿°ä½ æƒ³è¦ä¿®æ”¹çš„å­—æ®µï¼ŒAI ä¼šåœ¨å½“å‰è§£æç»“æœçš„åŸºç¡€ä¸Šè¿›è¡Œè°ƒæ•´ã€‚',examples:['æ·»åŠ ä¸€ä¸ªã€èº«é«˜ã€‘å­—æ®µ','åˆ é™¤ã€å¹´é¾„ã€‘å­—æ®µ','æŠŠã€ä½ç½®ã€‘æ”¹æˆã€æ‰€åœ¨åœ°ç‚¹ã€‘','å¢åŠ 3ä¸ªç”¨äºæè¿°å¤–è²Œçš„å­—æ®µ'],onClose:n[23]||(n[23]=e=>v.value=!1),onConfirm:L},null,8,['show','is-modifying']),(0,i.createCommentVNode)(' AI æ™ºèƒ½ç”Ÿæˆå­—æ®µå¯¹è¯æ¡† '),N.value?((0,i.openBlock)(),(0,i.createElementBlock)('div',{key:3,style:{position:'fixed',top:'0',left:'0',right:'0',bottom:'0',background:'rgba(0, 0, 0, 0.7)',display:'flex','align-items':'center','justify-content':'center','z-index':'10000'},onClick:n[27]||(n[27]=(0,i.withModifiers)(e=>N.value=!1,['self']))},[(0,i.createElementVNode)('div',ci,[n[56]||(n[56]=(0,i.createStaticVNode)('<h3 style="margin:0 0 16px 0;color:#10b981;font-size:18px;font-weight:600;" data-v-22fa8ffd><i class="fa-solid fa-wand-magic-sparkles" style="margin-right:8px;" data-v-22fa8ffd></i> AI æ™ºèƒ½ç”Ÿæˆå­—æ®µ </h3><div style="background:rgba(16, 185, 129, 0.1);border:1px solid rgba(16, 185, 129, 0.3);border-radius:6px;padding:12px;margin-bottom:16px;" data-v-22fa8ffd><p style="margin:0;color:#10b981;font-size:12px;line-height:1.6;" data-v-22fa8ffd><i class="fa-solid fa-lightbulb" style="margin-right:6px;" data-v-22fa8ffd></i><strong data-v-22fa8ffd>ä½¿ç”¨è¯´æ˜ï¼š</strong>ç”¨è‡ªç„¶è¯­è¨€æè¿°ä½ æƒ³è¦çš„çŠ¶æ€æ ï¼ŒAI ä¼šè‡ªåŠ¨å¸®ä½ ç”Ÿæˆå­—æ®µé…ç½®ï¼ </p></div>',2)),(0,i.createElementVNode)('div',pi,[n[53]||(n[53]=(0,i.createElementVNode)('label',{style:{display:'block','margin-bottom':'8px',color:'#e0e0e0','font-size':'13px'}},' æè¿°ä½ æƒ³è¦çš„çŠ¶æ€æ ï¼š ',-1)),(0,i.withDirectives)((0,i.createElementVNode)('textarea',{'onUpdate:modelValue':n[24]||(n[24]=e=>I.value=e),placeholder:'ä¾‹å¦‚ï¼š\nå¸®æˆ‘ç”Ÿæˆä¸€ä¸ªä¿®ä»™æ¸¸æˆçš„çŠ¶æ€æ ï¼ŒåŒ…å«ä»¥ä¸‹å­—æ®µï¼š\n- è§’è‰²å§“å\n- ä¿®ç‚¼å¢ƒç•Œ\n- çµåŠ›å€¼\n- å½“å‰åŠŸæ³•\n- æ‰€åœ¨ä½ç½®\n- è§’è‰²çŠ¶æ€ï¼ˆå¦‚å—ä¼¤ã€ä¸­æ¯’ç­‰ï¼‰\n- å¥½æ„Ÿåº¦',style:{width:'100%','min-height':'180px',padding:'12px',background:'#1a1a1a',border:'1px solid #404040','border-radius':'6px',color:'#e0e0e0','font-size':'13px',resize:'vertical','line-height':'1.6'}},null,512),[[i.vModelText,I.value]])]),(0,i.createElementVNode)('div',gi,[(0,i.createElementVNode)('button',{style:{padding:'10px 20px',background:'#404040',border:'none','border-radius':'6px',color:'white','font-size':'13px',cursor:'pointer'},onClick:n[25]||(n[25]=e=>N.value=!1)},' å–æ¶ˆ '),(0,i.createElementVNode)('button',{style:{padding:'10px 20px',background:'linear-gradient(135deg, #10b981 0%, #059669 100%)',border:'none','border-radius':'6px',color:'white','font-size':'13px',cursor:'pointer','margin-right':'10px'},disabled:!I.value.trim()||V.value,onClick:H},[n[54]||(n[54]=(0,i.createElementVNode)('i',{class:'fa-solid fa-wand-magic-sparkles',style:{'margin-right':'6px'}},null,-1)),(0,i.createTextVNode)(' '+(0,i.toDisplayString)(V.value?'AI ç”Ÿæˆä¸­...':'å¼€å§‹ç”Ÿæˆ'),1)],8,ui),k.value?((0,i.openBlock)(),(0,i.createElementBlock)('button',{key:0,style:{padding:'10px 20px',background:'#ffc107',border:'none','border-radius':'6px',color:'#000','font-size':'13px',cursor:'pointer'},disabled:C.value,onClick:n[26]||(n[26]=e=>A.value=!0)},[n[55]||(n[55]=(0,i.createElementVNode)('i',{class:'fa-solid fa-edit',style:{'margin-right':'6px'}},null,-1)),(0,i.createTextVNode)(' '+(0,i.toDisplayString)(C.value?'ä¿®æ”¹ä¸­...':'AI ä¿®æ”¹'),1)],8,mi)):(0,i.createCommentVNode)('v-if',!0)])])])):(0,i.createCommentVNode)('v-if',!0),(0,i.createCommentVNode)(' å­—æ®µç”Ÿæˆä¿®æ”¹å¯¹è¯æ¡† '),(0,i.createVNode)(U,{show:A.value,'is-modifying':C.value,title:'AI ä¿®æ”¹å­—æ®µé…ç½®',description:'æè¿°ä½ æƒ³è¦ä¿®æ”¹çš„å­—æ®µï¼ŒAI ä¼šåœ¨å½“å‰å­—æ®µé…ç½®çš„åŸºç¡€ä¸Šè¿›è¡Œè°ƒæ•´ã€‚',examples:['æ·»åŠ ä¸€ä¸ªã€èº«é«˜ã€‘å­—æ®µ','åˆ é™¤ç¬¬3ä¸ªå­—æ®µ','æŠŠã€å¥½æ„Ÿåº¦ã€‘æ”¹æˆã€äº²å¯†åº¦ã€‘','å¢åŠ 2ä¸ªç”¨äºæè¿°çŠ¶æ€çš„å­—æ®µ'],onClose:n[28]||(n[28]=e=>A.value=!1),onConfirm:G},null,8,['show','is-modifying']),(0,i.createCommentVNode)(' è¿›åº¦å¯¹è¯æ¡† '),(0,i.createVNode)(pa,{ref_key:'progressDialogRef',ref:h,show:b.value,title:'AI æ­£åœ¨å¤„ç†'},null,8,['show'])]))}});s(572);const xi=(0,V.A)(fi,[['__scopeId','data-v-22fa8ffd']]),bi={class:'summary-tab',style:{padding:'25px !important',background:'#1a1a1a !important'}},hi={class:'section-header',style:{display:'flex','justify-content':'space-between','align-items':'center',padding:'20px 25px !important','border-bottom':'1px solid #3a3a3a','margin-bottom':'5px'}},yi={class:'header-actions',style:{display:'flex','align-items':'center',gap:'10px'}},vi={key:0,class:'count-badge',style:{background:'#4a9eff',color:'white',padding:'4px 8px','border-radius':'12px','font-size':'12px'}},wi={key:0,class:'history-list',style:{display:'flex','flex-direction':'column',gap:'15px','margin-top':'20px'}},ki=['onClick'],Ai={class:'history-info',style:{display:'flex','align-items':'center',gap:'10px',flex:'1'}},Ci={class:'history-number',style:{color:'#4a9eff','font-weight':'bold'}},Ei={class:'history-range',style:{color:'#888','font-size':'12px'}},Ti={class:'expand-icon',style:{color:'#888','font-size':'12px'}},Si={key:0,class:'history-content',style:{padding:'15px',background:'#2a2a2a','border-radius':'0 0 6px 6px'}},Ni={class:'history-actions',style:{display:'flex',gap:'8px','margin-bottom':'12px','padding-bottom':'8px','border-bottom':'1px solid #3a3a3a'}},Ii=['onClick'],_i=['onClick'],Vi=['onClick'],zi={class:'history-text',style:{'font-family':'\'Courier New\', monospace','font-size':'13px','line-height':'1.6',color:'#e0e0e0','white-space':'pre-wrap','word-wrap':'break-word','user-select':'text',cursor:'text'}},Bi={key:1,class:'empty-state',style:{'text-align':'center',padding:'40px 20px',color:'#888'}},Mi=(0,i.defineComponent)({__name:'SummaryTab',setup(e){const n=(0,l.l)(),t=(0,i.ref)([]),a=(0,i.ref)(new Map),o=()=>{try{t.value=n.getSummaryHistory(),console.log('å·²åˆ·æ–°æ€»ç»“å†å²ï¼Œå½“å‰èŠå¤©è®°å½•æ•°:',t.value.length)}catch(e){console.error('åˆ·æ–°æ€»ç»“å†å²å¤±è´¥:',e),t.value=[]}},r=e=>a.value.get(e)||!1,s=async()=>{console.log('åˆ·æ–°æ•°æ®æŒ‰é’®è¢«ç‚¹å‡»');try{await o(),window.toastr.success('æ•°æ®å·²åˆ·æ–°')}catch(e){console.error('åˆ·æ–°æ•°æ®å¤±è´¥:',e),window.toastr.error('åˆ·æ–°æ•°æ®å¤±è´¥: '+e.message)}},c=async e=>new Promise(n=>{try{const t=window.parent.document,a=window.parent.document.body,o=t.createElement('textarea');o.value=e,o.style.cssText='\n        position: fixed;\n        left: -9999px;\n        top: -9999px;\n        opacity: 0;\n        pointer-events: none;\n        z-index: -1000;\n      ',o.setAttribute('readonly',''),a.appendChild(o),o.focus(),o.select(),o.setSelectionRange(0,e.length);const r=t.execCommand('copy');a.removeChild(o),n(r)}catch(e){console.error('çˆ¶çª—å£å¤åˆ¶å¤±è´¥:',e),n(!1)}}),p=async e=>new Promise(n=>{try{const t=document.createElement('textarea');t.value=e,t.style.position='fixed',t.style.left='-9999px',t.style.top='-9999px',t.style.opacity='0',t.style.pointerEvents='none',t.setAttribute('readonly',''),document.body.appendChild(t),t.select(),t.setSelectionRange(0,e.length);const a=document.execCommand('copy');document.body.removeChild(t),n(a)}catch(e){console.error('execCommand å¤åˆ¶å¤±è´¥:',e),n(!1)}}),g=e=>{console.log('æ˜¾ç¤ºæ‰‹åŠ¨å¤åˆ¶å¯¹è¯æ¡†ï¼Œæ–‡æœ¬é•¿åº¦:',e.length);try{const n=window.parent.document,t=window.parent.document.body,a=n.getElementById('manual-copy-overlay');a&&t.removeChild(a);const o=n.createElement('div');o.id='manual-copy-overlay',o.style.cssText='\n      position: fixed;\n      top: 0;\n      left: 0;\n      right: 0;\n      bottom: 0;\n      background: rgba(0, 0, 0, 0.95);\n      z-index: 999999;\n      display: flex;\n      align-items: center;\n      justify-content: center;\n      font-family: -apple-system, BlinkMacSystemFont, \'Segoe UI\', Roboto, sans-serif;\n    ';const r=n.createElement('div');r.style.cssText='\n      background: #2a2a2a;\n      border: 2px solid #4a9eff;\n      border-radius: 12px;\n      padding: 25px;\n      max-width: 900px;\n      width: 95%;\n      max-height: 85vh;\n      display: flex;\n      flex-direction: column;\n      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);\n    ';const s=n.createElement('div');s.innerHTML='\n      <h3 style="margin: 0 0 15px 0; color: #4a9eff; text-align: center; font-size: 18px; font-weight: 600;">\n        ğŸ“‹ æ‰‹åŠ¨å¤åˆ¶æ€»ç»“å†…å®¹\n      </h3>\n      <div style="background: #1a1a1a; border: 1px solid #444; border-radius: 6px; padding: 12px; margin-bottom: 15px;">\n        <p style="margin: 0 0 8px 0; color: #e0e0e0; font-size: 14px;">\n          <strong>æ“ä½œæ­¥éª¤ï¼š</strong>\n        </p>\n        <ol style="margin: 0; padding-left: 20px; color: #ccc; font-size: 13px; line-height: 1.6;">\n          <li>ç‚¹å‡»ä¸‹æ–¹æ–‡æœ¬æ¡†</li>\n          <li>æŒ‰ <kbd style="background: #444; padding: 2px 6px; border-radius: 3px; color: #fff;">Ctrl+A</kbd> å…¨é€‰æ–‡æœ¬</li>\n          <li>æŒ‰ <kbd style="background: #444; padding: 2px 6px; border-radius: 3px; color: #fff;">Ctrl+C</kbd> å¤åˆ¶åˆ°å‰ªè´´æ¿</li>\n          <li>ç‚¹å‡»"å…³é—­"æŒ‰é’®æˆ–æŒ‰ <kbd style="background: #444; padding: 2px 6px; border-radius: 3px; color: #fff;">Esc</kbd> å…³é—­å¯¹è¯æ¡†</li>\n        </ol>\n      </div>\n    ';const i=n.createElement('textarea');i.value=e,i.style.cssText='\n      width: 100%;\n      height: 400px;\n      background: #1a1a1a;\n      border: 2px solid #444;\n      border-radius: 6px;\n      padding: 15px;\n      color: #e0e0e0;\n      font-family: \'Courier New\', \'Consolas\', monospace;\n      font-size: 13px;\n      line-height: 1.5;\n      resize: vertical;\n      white-space: pre-wrap;\n      word-wrap: break-word;\n      outline: none;\n      margin-bottom: 20px;\n      box-sizing: border-box;\n    ';const l=n.createElement('div');l.style.cssText='\n      display: flex;\n      gap: 12px;\n      justify-content: center;\n      align-items: center;\n    ';const d=n.createElement('button');d.textContent='å…³é—­',d.style.cssText='\n      background: #4a9eff;\n      color: white;\n      border: none;\n      padding: 12px 24px;\n      border-radius: 6px;\n      cursor: pointer;\n      font-size: 14px;\n      font-weight: 500;\n      transition: background 0.2s;\n    ',d.onmouseover=()=>{d.style.background='#5ba8ff'},d.onmouseout=()=>{d.style.background='#4a9eff'};const c=n.createElement('button');c.textContent='å°è¯•è‡ªåŠ¨å¤åˆ¶',c.style.cssText='\n      background: #28a745;\n      color: white;\n      border: none;\n      padding: 12px 24px;\n      border-radius: 6px;\n      cursor: pointer;\n      font-size: 14px;\n      font-weight: 500;\n      transition: background 0.2s;\n    ',c.onmouseover=()=>{c.style.background='#218838'},c.onmouseout=()=>{c.style.background='#28a745'},l.appendChild(c),l.appendChild(d),r.appendChild(s),r.appendChild(i),r.appendChild(l),o.appendChild(r),t.appendChild(o),d.onclick=()=>{console.log('å…³é—­æŒ‰é’®è¢«ç‚¹å‡»'),t.removeChild(o)},c.onclick=async()=>{console.log('å°è¯•è‡ªåŠ¨å¤åˆ¶æŒ‰é’®è¢«ç‚¹å‡»');try{i.focus(),i.select();document.execCommand('copy')?(window.toastr.success('è‡ªåŠ¨å¤åˆ¶æˆåŠŸï¼'),t.removeChild(o)):window.toastr.warning('è‡ªåŠ¨å¤åˆ¶å¤±è´¥ï¼Œè¯·æ‰‹åŠ¨å¤åˆ¶')}catch(e){console.error('è‡ªåŠ¨å¤åˆ¶å¤±è´¥:',e),window.toastr.warning('è‡ªåŠ¨å¤åˆ¶å¤±è´¥ï¼Œè¯·æ‰‹åŠ¨å¤åˆ¶')}},o.onclick=e=>{e.target===o&&(console.log('ç‚¹å‡»èƒŒæ™¯å…³é—­'),t.removeChild(o))};const p=e=>{'Escape'===e.key&&(console.log('æŒ‰ESCé”®å…³é—­'),t.removeChild(o),n.removeEventListener('keydown',p))};n.addEventListener('keydown',p),setTimeout(()=>{console.log('è‡ªåŠ¨é€‰ä¸­æ–‡æœ¬'),i.focus(),i.select()},200),window.toastr.info('æ‰‹åŠ¨å¤åˆ¶å¯¹è¯æ¡†å·²æ‰“å¼€ï¼Œè¯·æŒ‰ç…§æç¤ºæ“ä½œ')}catch(e){console.error('åˆ›å»ºæ‰‹åŠ¨å¤åˆ¶å¯¹è¯æ¡†å¤±è´¥:',e),window.toastr.error('æ— æ³•æ˜¾ç¤ºå¤åˆ¶å¯¹è¯æ¡†ï¼Œè¯·æ£€æŸ¥æµè§ˆå™¨æƒé™')}},u=e=>{(async(e,n='å†…å®¹å·²å¤åˆ¶åˆ°å‰ªè´´æ¿')=>{console.log('å¼€å§‹å¤åˆ¶ï¼Œæ–‡æœ¬é•¿åº¦:',e.length);try{if(window.parent&&window.parent!==window&&(console.log('æ£€æµ‹åˆ°iframeç¯å¢ƒï¼Œå°è¯•åœ¨çˆ¶çª—å£å¤åˆ¶'),await c(e)))return console.log('çˆ¶çª—å£å¤åˆ¶æˆåŠŸ'),void window.toastr.success(n);if(navigator.clipboard&&window.isSecureContext){console.log('ä½¿ç”¨ç°ä»£ Clipboard API');try{return await navigator.clipboard.writeText(e),console.log('Clipboard API å¤åˆ¶æˆåŠŸ'),void window.toastr.success(n)}catch(e){console.warn('Clipboard API å¤±è´¥:',e)}}if(console.log('ä½¿ç”¨ execCommand æ–¹æ³•'),await p(e))return console.log('execCommand å¤åˆ¶æˆåŠŸ'),void window.toastr.success(n);console.log('æ‰€æœ‰è‡ªåŠ¨å¤åˆ¶æ–¹æ³•éƒ½å¤±è´¥ï¼Œæ˜¾ç¤ºæ‰‹åŠ¨å¤åˆ¶ç•Œé¢'),g(e)}catch(n){console.error('å¤åˆ¶å¼‚å¸¸:',n),g(e)}})(e,'æ€»ç»“å·²å¤åˆ¶åˆ°å‰ªè´´æ¿')},m=async()=>{try{let e='æœªçŸ¥è§’è‰²';try{const n=getCharData('current');n&&n.name&&(e=n.name,e=e.replace(/[<>:"/\\|?*]/g,'_').trim())}catch(e){console.warn('è·å–è§’è‰²ä¿¡æ¯å¤±è´¥:',e)}const n=`æ€»ç»“_${e}_${(new Date).toISOString().slice(0,10)}`;console.log('å‡†å¤‡åˆ›å»ºä¸–ç•Œä¹¦:',n);if(getWorldbookNames().includes(n))return void window.toastr.warning(`ä¸–ç•Œä¹¦ "${n}" å·²å­˜åœ¨`);await createWorldbook(n,[]);try{await rebindChatWorldbook('current',n),window.toastr.success(`å·²åˆ›å»ºæ€»ç»“ä¸–ç•Œä¹¦ "${n}" å¹¶ç»‘å®šåˆ°å½“å‰èŠå¤©`)}catch(e){console.warn('ç»‘å®šåˆ°èŠå¤©å¤±è´¥:',e),window.toastr.success(`å·²åˆ›å»ºæ€»ç»“ä¸–ç•Œä¹¦ "${n}"ï¼Œè¯·æ‰‹åŠ¨åœ¨èŠå¤©çŸ¥è¯†ä¹¦ä¸­ç»‘å®š`)}}catch(e){console.error('åˆ›å»ºæ€»ç»“ä¸–ç•Œä¹¦å¤±è´¥:',e),window.toastr.error('åˆ›å»ºæ€»ç»“ä¸–ç•Œä¹¦å¤±è´¥: '+e.message)}},f=async e=>new Promise(n=>{const t=$(`\n      <div style="\n        position: fixed;\n        top: 50%;\n        left: 50%;\n        transform: translate(-50%, -50%);\n        background: #2a2a2a;\n        border: 1px solid #3a3a3a;\n        border-radius: 8px;\n        padding: 20px;\n        z-index: 1000000;\n        min-width: 300px;\n      ">\n        <h3 style="margin: 0 0 15px 0; color: #e0e0e0;">é€‰æ‹©ä¸–ç•Œä¹¦</h3>\n        <div style="margin-bottom: 15px;">\n          ${e.map(e=>`\n            <label style="display: block; margin: 5px 0; color: #e0e0e0;">\n              <input type="radio" name="worldbook" value="${e}" style="margin-right: 8px;">\n              ${e}\n            </label>\n          `).join('')}\n        </div>\n        <div style="text-align: right;">\n          <button id="cancelWorldbook" style="\n            background: #666;\n            color: white;\n            border: none;\n            padding: 8px 16px;\n            border-radius: 4px;\n            margin-right: 10px;\n            cursor: pointer;\n          ">å–æ¶ˆ</button>\n          <button id="confirmWorldbook" style="\n            background: #4a9eff;\n            color: white;\n            border: none;\n            padding: 8px 16px;\n            border-radius: 4px;\n            cursor: pointer;\n          ">ç¡®å®š</button>\n        </div>\n      </div>\n    `),a=$('\n      <div style="\n        position: fixed;\n        top: 0;\n        left: 0;\n        width: 100%;\n        height: 100%;\n        background: rgba(0, 0, 0, 0.5);\n        z-index: 999999;\n      "></div>\n    ');$('body').append(a).append(t),$('#cancelWorldbook').on('click',()=>{a.remove(),t.remove(),n(null)}),$('#confirmWorldbook').on('click',()=>{const e=$('input[name="worldbook"]:checked').val();a.remove(),t.remove(),n(e||null)}),$('input[name="worldbook"]:first').prop('checked',!0)}),x=()=>{try{const e=window.parent.document,n=window.parent.document.body,t=e.getElementById('debug-panel-overlay');t&&n.removeChild(t);const a=e.createElement('div');a.id='debug-panel-overlay',a.style.cssText='\n      position: fixed;\n      top: 0;\n      left: 0;\n      right: 0;\n      bottom: 0;\n      background: rgba(0, 0, 0, 0.95);\n      z-index: 999999;\n      display: flex;\n      align-items: center;\n      justify-content: center;\n      font-family: -apple-system, BlinkMacSystemFont, \'Segoe UI\', Roboto, sans-serif;\n    ';const o=e.createElement('div');o.style.cssText='\n      background: #2a2a2a;\n      border: 2px solid #ffc107;\n      border-radius: 12px;\n      padding: 25px;\n      max-width: 800px;\n      width: 95%;\n      max-height: 85vh;\n      display: flex;\n      flex-direction: column;\n      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);\n    ';const r=e.createElement('div');r.innerHTML='\n      <h3 style="margin: 0 0 15px 0; color: #ffc107; text-align: center; font-size: 18px; font-weight: 600;">\n        ğŸ› è‡ªåŠ¨æ€»ç»“è°ƒè¯•å·¥å…·\n      </h3>\n      <div style="background: #1a1a1a; border: 1px solid #444; border-radius: 6px; padding: 12px; margin-bottom: 15px;">\n        <p style="margin: 0 0 8px 0; color: #e0e0e0; font-size: 14px;">\n          <strong>è°ƒè¯•åŠŸèƒ½ï¼š</strong>\n        </p>\n        <ul style="margin: 0; padding-left: 20px; color: #ccc; font-size: 13px; line-height: 1.6;">\n          <li>æµ‹è¯•è‡ªåŠ¨æ€»ç»“æµç¨‹</li>\n          <li>åŒæ­¥localStorageæ•°æ®åˆ°é…’é¦†åŠ©æ‰‹å˜é‡</li>\n          <li>æ£€æŸ¥å½“å‰æ¥¼å±‚çŠ¶æ€</li>\n          <li>éªŒè¯è§¦å‘æ¡ä»¶è®¡ç®—</li>\n        </ul>\n      </div>\n    ';const s=e.createElement('div');s.style.cssText='\n      display: grid;\n      grid-template-columns: 1fr 1fr;\n      gap: 12px;\n      margin-bottom: 20px;\n    ';[{id:'testComplete',text:'ğŸ§ª æµ‹è¯•å®Œæ•´æµç¨‹',color:'#4a9eff'},{id:'syncData',text:'ğŸ”„ åŒæ­¥æ•°æ®',color:'#28a745'},{id:'checkFloor',text:'ğŸ” æ£€æŸ¥æ¥¼å±‚',color:'#17a2b8'},{id:'testCalculation',text:'ğŸ§® éªŒè¯è®¡ç®—',color:'#6f42c1'},{id:'showStatus',text:'ğŸ“Š æ˜¾ç¤ºçŠ¶æ€',color:'#fd7e14'},{id:'resetStartId',text:'ğŸ”„ é‡ç½®èµ·å§‹æ¥¼å±‚',color:'#dc3545'}].forEach(n=>{const t=e.createElement('button');t.id=n.id,t.textContent=n.text,t.style.cssText=`\n        background: ${n.color};\n        color: white;\n        border: none;\n        padding: 12px 16px;\n        border-radius: 6px;\n        cursor: pointer;\n        font-size: 13px;\n        font-weight: 500;\n        transition: background 0.2s;\n      `,t.onmouseover=()=>{t.style.opacity='0.8'},t.onmouseout=()=>{t.style.opacity='1'},s.appendChild(t)});const i=e.createElement('div');i.id='debug-output',i.style.cssText='\n      background: #1a1a1a;\n      border: 1px solid #444;\n      border-radius: 6px;\n      padding: 15px;\n      height: 200px;\n      overflow-y: auto;\n      font-family: \'Courier New\', \'Consolas\', monospace;\n      font-size: 12px;\n      color: #e0e0e0;\n      white-space: pre-wrap;\n      margin-bottom: 20px;\n    ',i.textContent='ç‚¹å‡»ä¸Šæ–¹æŒ‰é’®å¼€å§‹è°ƒè¯•...\n';const l=e.createElement('button');l.textContent='å…³é—­',l.style.cssText='\n      background: #6c757d;\n      color: white;\n      border: none;\n      padding: 12px 24px;\n      border-radius: 6px;\n      cursor: pointer;\n      font-size: 14px;\n      font-weight: 500;\n      transition: background 0.2s;\n      align-self: center;\n    ',o.appendChild(r),o.appendChild(s),o.appendChild(i),o.appendChild(l),a.appendChild(o),n.appendChild(a);const d=n=>{const t=e.getElementById('debug-output');t&&(t.textContent+=n+'\n',t.scrollTop=t.scrollHeight)};l.onclick=()=>{n.removeChild(a)},e.getElementById('testComplete')?.addEventListener('click',()=>{d('ğŸ§ª å¼€å§‹æµ‹è¯•å®Œæ•´è‡ªåŠ¨æ€»ç»“æµç¨‹...');try{window.testCompleteAutoSummary?(window.testCompleteAutoSummary(),d('âœ… æµ‹è¯•å‡½æ•°å·²æ‰§è¡Œï¼Œè¯·æŸ¥çœ‹æ§åˆ¶å°è¾“å‡º')):d('âŒ æµ‹è¯•å‡½æ•°ä¸å¯ç”¨')}catch(e){d('âŒ æµ‹è¯•å¤±è´¥: '+e.message)}}),e.getElementById('syncData')?.addEventListener('click',()=>{d('ğŸ”„ å¼€å§‹åŒæ­¥æ•°æ®...');try{window.syncAutoSummaryData?(window.syncAutoSummaryData(),d('âœ… åŒæ­¥å‡½æ•°å·²æ‰§è¡Œï¼Œè¯·æŸ¥çœ‹æ§åˆ¶å°è¾“å‡º')):d('âŒ åŒæ­¥å‡½æ•°ä¸å¯ç”¨')}catch(e){d('âŒ åŒæ­¥å¤±è´¥: '+e.message)}}),e.getElementById('checkFloor')?.addEventListener('click',()=>{d('ğŸ” å¼€å§‹æ£€æŸ¥æ¥¼å±‚...');try{window.checkCurrentFloor?(window.checkCurrentFloor(),d('âœ… æ¥¼å±‚æ£€æŸ¥å‡½æ•°å·²æ‰§è¡Œï¼Œè¯·æŸ¥çœ‹æ§åˆ¶å°è¾“å‡º')):d('âŒ æ¥¼å±‚æ£€æŸ¥å‡½æ•°ä¸å¯ç”¨')}catch(e){d('âŒ æ¥¼å±‚æ£€æŸ¥å¤±è´¥: '+e.message)}}),e.getElementById('testCalculation')?.addEventListener('click',()=>{d('ğŸ§® å¼€å§‹éªŒè¯è®¡ç®—...');try{window.testFloorCalculation?(window.testFloorCalculation(),d('âœ… è®¡ç®—éªŒè¯å‡½æ•°å·²æ‰§è¡Œï¼Œè¯·æŸ¥çœ‹æ§åˆ¶å°è¾“å‡º')):d('âŒ è®¡ç®—éªŒè¯å‡½æ•°ä¸å¯ç”¨')}catch(e){d('âŒ è®¡ç®—éªŒè¯å¤±è´¥: '+e.message)}}),e.getElementById('showStatus')?.addEventListener('click',()=>{d('ğŸ“Š å¼€å§‹æ˜¾ç¤ºçŠ¶æ€...');try{window.checkAutoSummaryStatus?(window.checkAutoSummaryStatus(),d('âœ… çŠ¶æ€æ£€æŸ¥å‡½æ•°å·²æ‰§è¡Œï¼Œè¯·æŸ¥çœ‹æ§åˆ¶å°è¾“å‡º')):d('âŒ çŠ¶æ€æ£€æŸ¥å‡½æ•°ä¸å¯ç”¨')}catch(e){d('âŒ çŠ¶æ€æ£€æŸ¥å¤±è´¥: '+e.message)}}),e.getElementById('resetStartId')?.addEventListener('click',()=>{d('ğŸ”„ å¼€å§‹é‡ç½®èµ·å§‹æ¥¼å±‚...');try{window.smartResetChat?(window.smartResetChat(),d('âœ… é‡ç½®å‡½æ•°å·²æ‰§è¡Œï¼Œè¯·æŸ¥çœ‹æ§åˆ¶å°è¾“å‡º')):d('âŒ é‡ç½®å‡½æ•°ä¸å¯ç”¨')}catch(e){d('âŒ é‡ç½®å¤±è´¥: '+e.message)}}),a.onclick=e=>{e.target===a&&n.removeChild(a)};const c=t=>{'Escape'===t.key&&(n.removeChild(a),e.removeEventListener('keydown',c))};e.addEventListener('keydown',c),window.toastr?.info('è°ƒè¯•é¢æ¿å·²æ‰“å¼€')}catch(e){console.error('åˆ›å»ºè°ƒè¯•é¢æ¿å¤±è´¥:',e),window.toastr?.error('æ— æ³•æ˜¾ç¤ºè°ƒè¯•é¢æ¿ï¼Œè¯·æ£€æŸ¥æµè§ˆå™¨æƒé™')}};return o(),(e,n)=>((0,i.openBlock)(),(0,i.createElementBlock)('div',bi,[(0,i.createElementVNode)('div',hi,[n[3]||(n[3]=(0,i.createElementVNode)('h3',{style:{margin:'0',color:'#fff','font-size':'15px !important','font-weight':'bold',display:'flex','align-items':'center',gap:'8px'}},' ğŸ“ å†å²æ€»ç»“è®°å½• ',-1)),(0,i.createElementVNode)('div',yi,[t.value.length>0?((0,i.openBlock)(),(0,i.createElementBlock)('span',vi,(0,i.toDisplayString)(t.value.length)+' æ¡è®°å½•',1)):(0,i.createCommentVNode)('v-if',!0),(0,i.createElementVNode)('button',{class:'mini-button refresh-button',style:{padding:'6px 12px',background:'#2a2a2a',border:'1px solid #3a3a3a','border-radius':'4px',color:'#e0e0e0',cursor:'pointer','font-size':'12px',transition:'all 0.2s',display:'flex','align-items':'center',gap:'6px'},onClick:s},[...n[0]||(n[0]=[(0,i.createElementVNode)('i',{class:'fa-solid fa-refresh'},null,-1),(0,i.createTextVNode)(' åˆ·æ–°æ•°æ® ',-1)])]),(0,i.createElementVNode)('button',{class:'mini-button create-worldbook-button',style:{padding:'6px 12px',background:'#51cf66',border:'1px solid #40c057','border-radius':'4px',color:'white',cursor:'pointer','font-size':'12px',transition:'all 0.2s',display:'flex','align-items':'center',gap:'6px'},onClick:m},[...n[1]||(n[1]=[(0,i.createElementVNode)('i',{class:'fa-solid fa-plus'},null,-1),(0,i.createTextVNode)(' åˆ›å»ºæ€»ç»“ä¸–ç•Œä¹¦ ',-1)])]),(0,i.createElementVNode)('button',{class:'mini-button debug-button',style:{padding:'6px 12px',background:'#ffc107',border:'1px solid #ffb300','border-radius':'4px',color:'#000',cursor:'pointer','font-size':'12px',transition:'all 0.2s',display:'flex','align-items':'center',gap:'6px'},onClick:x},[...n[2]||(n[2]=[(0,i.createElementVNode)('i',{class:'fa-solid fa-bug'},null,-1),(0,i.createTextVNode)(' è°ƒè¯•å·¥å…· ',-1)])])])]),t.value&&t.value.length>0?((0,i.openBlock)(),(0,i.createElementBlock)('div',wi,[((0,i.openBlock)(!0),(0,i.createElementBlock)(i.Fragment,null,(0,i.renderList)(t.value,(e,o)=>((0,i.openBlock)(),(0,i.createElementBlock)('div',{key:o,class:'history-item',style:{background:'#2a2a2a',border:'1px solid #444','border-radius':'8px',padding:'15px',transition:'all 0.3s ease'}},[(0,i.createElementVNode)('div',{class:'history-header',style:{padding:'12px 15px',background:'#1a1a1a',display:'flex','justify-content':'space-between','align-items':'center',cursor:'pointer','user-select':'none',transition:'background 0.2s','border-radius':'6px'},onClick:e=>(e=>{const n=a.value.get(e)||!1;a.value.set(e,!n)})(o)},[(0,i.createElementVNode)('div',Ai,[(0,i.createElementVNode)('span',Ci,'#'+(0,i.toDisplayString)(o+1),1),(0,i.createElementVNode)('span',Ei,'æ¥¼å±‚ '+(0,i.toDisplayString)(e.start_id)+' - '+(0,i.toDisplayString)(e.end_id),1)]),(0,i.createElementVNode)('span',Ti,(0,i.toDisplayString)(r(o)?'â–¼':'â–¶'),1)],8,ki),r(o)?((0,i.openBlock)(),(0,i.createElementBlock)('div',Si,[(0,i.createElementVNode)('div',Ni,[(0,i.createElementVNode)('button',{class:'mini-button',style:{flex:'1',padding:'6px 12px',background:'#2a2a2a',border:'1px solid #3a3a3a','border-radius':'4px',color:'#e0e0e0',cursor:'pointer','font-size':'12px',transition:'background 0.2s',display:'flex','align-items':'center','justify-content':'center',gap:'6px'},onClick:n=>u(e.content)},[...n[4]||(n[4]=[(0,i.createElementVNode)('i',{class:'fa-solid fa-copy'},null,-1),(0,i.createTextVNode)(' å¤åˆ¶ ',-1)])],8,Ii),(0,i.createElementVNode)('button',{class:'mini-button worldbook-button',style:{flex:'1',padding:'6px 12px',background:'#4a9eff',border:'1px solid #5aaeff','border-radius':'4px',color:'white',cursor:'pointer','font-size':'12px',transition:'all 0.2s',display:'flex','align-items':'center','justify-content':'center',gap:'6px'},onClick:n=>(async(e,n)=>{try{const a=getWorldbookNames();if(0===a.length)return void window.toastr.warning('æ²¡æœ‰å¯ç”¨çš„ä¸–ç•Œä¹¦ï¼Œè¯·å…ˆåˆ›å»ºæ€»ç»“ä¸–ç•Œä¹¦');const o=1===a.length?a[0]:await f(a);if(!o)return;const r={name:`æ€»ç»“_${n+1}_${(new Date).toLocaleDateString()}`,enabled:!0,strategy:{type:'constant',keys:[],keys_secondary:{logic:'and_any',keys:[]},scan_depth:'same_as_global'},position:{type:'before_character_definition',role:'system',depth:1},content:e,comment:`è‡ªåŠ¨ç”Ÿæˆçš„æ€»ç»“æ¡ç›® - æ¥¼å±‚èŒƒå›´: ${t.value[n]?.start_id||'?'} - ${t.value[n]?.end_id||'?'}`,insertion_order:0,case_sensitive:!1,name_is_regex:!1,keys_are_regex:!1,selective_logic:'and',secondary_keys_logic:'and',activation_threshold:0,disabled:!1,order:0,group:'',local_id:0,depth_entries:[],depth_entries_all:!1,search_range:0,force_activation:!1,disable:!1,exclude_recursion:!1,hidden:!1,priority:0,comment_is_regex:!1,content_is_regex:!1,secondary_keys_are_regex:!1,keys_secondary_are_regex:!1,uid:Date.now()};await createWorldbookEntries(o,[r]),window.toastr.success(`æ€»ç»“å·²ç»‘å®šåˆ°ä¸–ç•Œä¹¦: ${o}`)}catch(e){console.error('ç»‘å®šåˆ°ä¸–ç•Œä¹¦å¤±è´¥:',e),window.toastr.error('ç»‘å®šåˆ°ä¸–ç•Œä¹¦å¤±è´¥: '+e.message)}})(e.content,o)},[...n[5]||(n[5]=[(0,i.createElementVNode)('i',{class:'fa-solid fa-book'},null,-1),(0,i.createTextVNode)(' ç»‘å®šåˆ°ä¸–ç•Œä¹¦ ',-1)])],8,_i),(0,i.createElementVNode)('button',{class:'mini-button delete-button',style:{flex:'1',padding:'6px 12px',background:'#ff6b6b',border:'1px solid #ff5252','border-radius':'4px',color:'white',cursor:'pointer','font-size':'12px',transition:'all 0.2s',display:'flex','align-items':'center','justify-content':'center',gap:'6px'},onClick:e=>(e=>{if(confirm('ç¡®å®šè¦åˆ é™¤è¿™æ¡æ€»ç»“å—ï¼Ÿ'))try{if(!(0,d.pA)())return void window.toastr.error('æ— æ³•è·å–å½“å‰èŠå¤©ä¿¡æ¯');t.value.splice(e,1),insertOrAssignVariables({summary_history:t.value},{type:'chat'}),window.toastr.success('æ€»ç»“å·²åˆ é™¤')}catch(e){console.error('åˆ é™¤æ€»ç»“å¤±è´¥:',e),window.toastr.error('åˆ é™¤æ€»ç»“å¤±è´¥')}})(o)},[...n[6]||(n[6]=[(0,i.createElementVNode)('i',{class:'fa-solid fa-trash'},null,-1),(0,i.createTextVNode)(' åˆ é™¤ ',-1)])],8,Vi)]),(0,i.createElementVNode)('div',zi,(0,i.toDisplayString)(e.content),1)])):(0,i.createCommentVNode)('v-if',!0)]))),128))])):((0,i.openBlock)(),(0,i.createElementBlock)('div',Bi,[...n[7]||(n[7]=[(0,i.createElementVNode)('i',{class:'fa-solid fa-inbox',style:{'font-size':'48px','margin-bottom':'10px',opacity:'0.3'}},null,-1),(0,i.createElementVNode)('p',{style:{margin:'10px 0','font-size':'16px'}},'è¿˜æ²¡æœ‰æ€»ç»“è®°å½•',-1),(0,i.createElementVNode)('small',{style:{'font-size':'12px',color:'#666'}},'ä½¿ç”¨"è®¾ç½®"æ ‡ç­¾é¡µæ‰‹åŠ¨åˆ›å»ºæ€»ç»“',-1)])]))]))}});s(6);const Pi=(0,V.A)(Mi,[['__scopeId','data-v-f8bd87fc']]),$i={class:'table-tab',style:{padding:'25px !important',background:'#1a1a1a !important'}},Di={class:'section-header',style:{display:'flex','justify-content':'space-between','align-items':'center',padding:'20px 25px !important','border-bottom':'1px solid #3a3a3a','margin-bottom':'5px'}},ji={key:0,class:'count-badge',style:{background:'#4a9eff',color:'white',padding:'4px 8px','border-radius':'12px','font-size':'12px'}},Ri={key:0,class:'history-list',style:{display:'flex','flex-direction':'column',gap:'15px','margin-top':'20px'}},Oi=['onClick'],Fi={class:'history-info',style:{display:'flex','align-items':'center',gap:'10px',flex:'1'}},Li={class:'history-number',style:{color:'#4a9eff','font-weight':'bold'}},Hi={class:'history-range',style:{color:'#888','font-size':'12px'}},Ui={class:'expand-icon',style:{color:'#888','font-size':'12px'}},Gi={key:0,class:'history-content',style:{padding:'15px',background:'#2a2a2a','border-radius':'0 0 6px 6px'}},Yi={class:'history-actions',style:{display:'flex',gap:'10px','margin-bottom':'12px','padding-bottom':'8px','border-bottom':'1px solid #3a3a3a','flex-wrap':'wrap'}},Ji=['onClick'],Wi=['onClick'],qi={class:'table-display',style:{'overflow-x':'auto','border-radius':'6px',border:'1px solid #3a3a3a'}},Ki={style:{width:'100%','border-collapse':'collapse',background:'#1a1a1a'}},Xi={style:{background:'#2a2a2a'}},Qi={key:1,class:'empty-state',style:{'text-align':'center',padding:'40px 20px',color:'#888'}},Zi=(0,i.defineComponent)({__name:'TableTab',setup(e){const n=(0,i.ref)([]),t=(0,i.ref)(new Map),a=e=>t.value.get(e)||!1,o=async e=>new Promise(n=>{try{const t=window.parent.document,a=window.parent.document.body,o=t.createElement('textarea');o.value=e,o.style.cssText='\n        position: fixed;\n        left: -9999px;\n        top: -9999px;\n        opacity: 0;\n        pointer-events: none;\n        z-index: -1000;\n      ',o.setAttribute('readonly',''),a.appendChild(o),o.focus(),o.select(),o.setSelectionRange(0,e.length);const r=t.execCommand('copy');a.removeChild(o),n(r)}catch(e){console.error('çˆ¶çª—å£å¤åˆ¶å¤±è´¥:',e),n(!1)}}),r=async e=>new Promise(n=>{try{const t=document.createElement('textarea');t.value=e,t.style.position='fixed',t.style.left='-9999px',t.style.top='-9999px',t.style.opacity='0',t.style.pointerEvents='none',t.setAttribute('readonly',''),document.body.appendChild(t),t.select(),t.setSelectionRange(0,e.length);const a=document.execCommand('copy');document.body.removeChild(t),n(a)}catch(e){console.error('execCommand å¤åˆ¶å¤±è´¥:',e),n(!1)}}),s=e=>{console.log('æ˜¾ç¤ºæ‰‹åŠ¨å¤åˆ¶å¯¹è¯æ¡†ï¼Œæ–‡æœ¬é•¿åº¦:',e.length);try{const n=window.parent.document,t=window.parent.document.body,a=n.getElementById('manual-copy-overlay');a&&t.removeChild(a);const o=n.createElement('div');o.id='manual-copy-overlay',o.style.cssText='\n      position: fixed;\n      top: 0;\n      left: 0;\n      right: 0;\n      bottom: 0;\n      background: rgba(0, 0, 0, 0.95);\n      z-index: 999999;\n      display: flex;\n      align-items: center;\n      justify-content: center;\n      font-family: -apple-system, BlinkMacSystemFont, \'Segoe UI\', Roboto, sans-serif;\n    ';const r=n.createElement('div');r.style.cssText='\n      background: #2a2a2a;\n      border: 2px solid #4a9eff;\n      border-radius: 12px;\n      padding: 25px;\n      max-width: 900px;\n      width: 95%;\n      max-height: 85vh;\n      display: flex;\n      flex-direction: column;\n      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);\n    ';const s=n.createElement('div');s.innerHTML='\n      <h3 style="margin: 0 0 15px 0; color: #4a9eff; text-align: center; font-size: 18px; font-weight: 600;">\n        ğŸ“‹ æ‰‹åŠ¨å¤åˆ¶è¡¨æ ¼å†…å®¹\n      </h3>\n      <div style="background: #1a1a1a; border: 1px solid #444; border-radius: 6px; padding: 12px; margin-bottom: 15px;">\n        <p style="margin: 0 0 8px 0; color: #e0e0e0; font-size: 14px;">\n          <strong>æ“ä½œæ­¥éª¤ï¼š</strong>\n        </p>\n        <ol style="margin: 0; padding-left: 20px; color: #ccc; font-size: 13px; line-height: 1.6;">\n          <li>ç‚¹å‡»ä¸‹æ–¹æ–‡æœ¬æ¡†</li>\n          <li>æŒ‰ <kbd style="background: #444; padding: 2px 6px; border-radius: 3px; color: #fff;">Ctrl+A</kbd> å…¨é€‰æ–‡æœ¬</li>\n          <li>æŒ‰ <kbd style="background: #444; padding: 2px 6px; border-radius: 3px; color: #fff;">Ctrl+C</kbd> å¤åˆ¶åˆ°å‰ªè´´æ¿</li>\n          <li>ç‚¹å‡»"å…³é—­"æŒ‰é’®æˆ–æŒ‰ <kbd style="background: #444; padding: 2px 6px; border-radius: 3px; color: #fff;">Esc</kbd> å…³é—­å¯¹è¯æ¡†</li>\n        </ol>\n      </div>\n    ';const i=n.createElement('textarea');i.value=e,i.style.cssText='\n      width: 100%;\n      height: 400px;\n      background: #1a1a1a;\n      border: 2px solid #444;\n      border-radius: 6px;\n      padding: 15px;\n      color: #e0e0e0;\n      font-family: \'Courier New\', \'Consolas\', monospace;\n      font-size: 13px;\n      line-height: 1.5;\n      resize: vertical;\n      white-space: pre-wrap;\n      word-wrap: break-word;\n      outline: none;\n      margin-bottom: 20px;\n      box-sizing: border-box;\n    ';const l=n.createElement('div');l.style.cssText='\n      display: flex;\n      gap: 12px;\n      justify-content: center;\n      align-items: center;\n    ';const d=n.createElement('button');d.textContent='å…³é—­',d.style.cssText='\n      background: #4a9eff;\n      color: white;\n      border: none;\n      padding: 12px 24px;\n      border-radius: 6px;\n      cursor: pointer;\n      font-size: 14px;\n      font-weight: 500;\n      transition: background 0.2s;\n    ',d.onmouseover=()=>{d.style.background='#5ba8ff'},d.onmouseout=()=>{d.style.background='#4a9eff'};const c=n.createElement('button');c.textContent='å°è¯•è‡ªåŠ¨å¤åˆ¶',c.style.cssText='\n      background: #28a745;\n      color: white;\n      border: none;\n      padding: 12px 24px;\n      border-radius: 6px;\n      cursor: pointer;\n      font-size: 14px;\n      font-weight: 500;\n      transition: background 0.2s;\n    ',c.onmouseover=()=>{c.style.background='#218838'},c.onmouseout=()=>{c.style.background='#28a745'},l.appendChild(c),l.appendChild(d),r.appendChild(s),r.appendChild(i),r.appendChild(l),o.appendChild(r),t.appendChild(o),d.onclick=()=>{console.log('å…³é—­æŒ‰é’®è¢«ç‚¹å‡»'),t.removeChild(o)},c.onclick=async()=>{console.log('å°è¯•è‡ªåŠ¨å¤åˆ¶æŒ‰é’®è¢«ç‚¹å‡»');try{i.focus(),i.select();document.execCommand('copy')?(window.toastr.success('è‡ªåŠ¨å¤åˆ¶æˆåŠŸï¼'),t.removeChild(o)):window.toastr.warning('è‡ªåŠ¨å¤åˆ¶å¤±è´¥ï¼Œè¯·æ‰‹åŠ¨å¤åˆ¶')}catch(e){console.error('è‡ªåŠ¨å¤åˆ¶å¤±è´¥:',e),window.toastr.warning('è‡ªåŠ¨å¤åˆ¶å¤±è´¥ï¼Œè¯·æ‰‹åŠ¨å¤åˆ¶')}},o.onclick=e=>{e.target===o&&(console.log('ç‚¹å‡»èƒŒæ™¯å…³é—­'),t.removeChild(o))};const p=e=>{'Escape'===e.key&&(console.log('æŒ‰ESCé”®å…³é—­'),t.removeChild(o),n.removeEventListener('keydown',p))};n.addEventListener('keydown',p),setTimeout(()=>{console.log('è‡ªåŠ¨é€‰ä¸­æ–‡æœ¬'),i.focus(),i.select()},200),window.toastr.info('æ‰‹åŠ¨å¤åˆ¶å¯¹è¯æ¡†å·²æ‰“å¼€ï¼Œè¯·æŒ‰ç…§æç¤ºæ“ä½œ')}catch(e){console.error('åˆ›å»ºæ‰‹åŠ¨å¤åˆ¶å¯¹è¯æ¡†å¤±è´¥:',e),window.toastr.error('æ— æ³•æ˜¾ç¤ºå¤åˆ¶å¯¹è¯æ¡†ï¼Œè¯·æ£€æŸ¥æµè§ˆå™¨æƒé™')}},l=e=>{try{(async(e,n='å†…å®¹å·²å¤åˆ¶åˆ°å‰ªè´´æ¿')=>{console.log('å¼€å§‹å¤åˆ¶ï¼Œæ–‡æœ¬é•¿åº¦:',e.length);try{if(window.parent&&window.parent!==window&&(console.log('æ£€æµ‹åˆ°iframeç¯å¢ƒï¼Œå°è¯•åœ¨çˆ¶çª—å£å¤åˆ¶'),await o(e)))return console.log('çˆ¶çª—å£å¤åˆ¶æˆåŠŸ'),void window.toastr.success(n);if(navigator.clipboard&&window.isSecureContext){console.log('ä½¿ç”¨ç°ä»£ Clipboard API');try{return await navigator.clipboard.writeText(e),console.log('Clipboard API å¤åˆ¶æˆåŠŸ'),void window.toastr.success(n)}catch(e){console.warn('Clipboard API å¤±è´¥:',e)}}if(console.log('ä½¿ç”¨ execCommand æ–¹æ³•'),await r(e))return console.log('execCommand å¤åˆ¶æˆåŠŸ'),void window.toastr.success(n);console.log('æ‰€æœ‰è‡ªåŠ¨å¤åˆ¶æ–¹æ³•éƒ½å¤±è´¥ï¼Œæ˜¾ç¤ºæ‰‹åŠ¨å¤åˆ¶ç•Œé¢'),s(e)}catch(n){console.error('å¤åˆ¶å¼‚å¸¸:',n),s(e)}})([e.headers.join('\t'),...e.data.map(e=>e.join('\t'))].join('\n'),'è¡¨æ ¼å·²å¤åˆ¶åˆ°å‰ªè´´æ¿')}catch(e){console.error('å¤åˆ¶è¡¨æ ¼å¤±è´¥:',e),window.toastr.error('å¤åˆ¶å¤±è´¥ï¼Œè¯·æ‰‹åŠ¨å¤åˆ¶')}};return(()=>{try{if(!(0,d.pA)())return console.warn('æ— æ³•è·å–èŠå¤©IDï¼Œæ¸…ç©ºè¡¨æ ¼å†å²'),void(n.value=[]);const e=getVariables({type:'chat'});console.log('ä»èŠå¤©å˜é‡è¯»å–çš„æ•°æ®:',e),console.log('è¡¨æ ¼å†å²æ•°æ®:',e.table_history),n.value=e.table_history||[],console.log('å·²åˆ·æ–°è¡¨æ ¼å†å²ï¼Œå½“å‰èŠå¤©è¡¨æ ¼æ•°:',n.value.length)}catch(e){console.error('åˆ·æ–°è¡¨æ ¼å†å²å¤±è´¥:',e),n.value=[]}})(),(e,o)=>((0,i.openBlock)(),(0,i.createElementBlock)('div',$i,[(0,i.createElementVNode)('div',Di,[o[0]||(o[0]=(0,i.createElementVNode)('h3',{style:{margin:'0',color:'#fff','font-size':'15px !important','font-weight':'bold',display:'flex','align-items':'center',gap:'8px'}},' ğŸ“Š è¡¨æ ¼åˆ†æ ',-1)),n.value.length>0?((0,i.openBlock)(),(0,i.createElementBlock)('span',ji,(0,i.toDisplayString)(n.value.length)+' æ¡è®°å½•',1)):(0,i.createCommentVNode)('v-if',!0)]),(0,i.createCommentVNode)(' è¡¨æ ¼å†å²åˆ—è¡¨ '),n.value&&n.value.length>0?((0,i.openBlock)(),(0,i.createElementBlock)('div',Ri,[((0,i.openBlock)(!0),(0,i.createElementBlock)(i.Fragment,null,(0,i.renderList)(n.value,(e,r)=>((0,i.openBlock)(),(0,i.createElementBlock)('div',{key:r,class:'history-item',style:{background:'#2a2a2a',border:'1px solid #444','border-radius':'8px',padding:'15px',transition:'all 0.3s ease'}},[(0,i.createElementVNode)('div',{class:'history-header',style:{padding:'12px 15px',background:'#1a1a1a',display:'flex','justify-content':'space-between','align-items':'center',cursor:'pointer','user-select':'none',transition:'background 0.2s','border-radius':'6px'},onClick:e=>(e=>{const n=t.value.get(e)||!1;t.value.set(e,!n)})(r)},[(0,i.createElementVNode)('div',Fi,[(0,i.createElementVNode)('span',Li,'#'+(0,i.toDisplayString)(r+1),1),(0,i.createElementVNode)('span',Hi,'æ¥¼å±‚ '+(0,i.toDisplayString)(e.start_id)+' - '+(0,i.toDisplayString)(e.end_id),1)]),(0,i.createElementVNode)('span',Ui,(0,i.toDisplayString)(a(r)?'â–¼':'â–¶'),1)],8,Oi),a(r)?((0,i.openBlock)(),(0,i.createElementBlock)('div',Gi,[(0,i.createElementVNode)('div',Yi,[(0,i.createElementVNode)('button',{class:'copy-button',style:{padding:'8px 16px',background:'linear-gradient(135deg, #28a745 0%, #20c997 100%)',border:'none','border-radius':'6px',color:'white',cursor:'pointer','font-size':'12px','font-weight':'600',transition:'all 0.3s ease',display:'flex','align-items':'center',gap:'6px','box-shadow':'0 3px 12px rgba(40, 167, 69, 0.3)',position:'relative',overflow:'hidden'},onClick:n=>l(e)},[...o[1]||(o[1]=[(0,i.createElementVNode)('div',{style:{position:'absolute',top:'0',left:'-100%',width:'100%',height:'100%',background:'linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent)',transition:'left 0.5s'},class:'shimmer-effect'},null,-1),(0,i.createElementVNode)('i',{class:'fa-solid fa-copy',style:{'font-size':'12px'}},null,-1),(0,i.createTextVNode)(' å¤åˆ¶ ',-1)])],8,Ji),(0,i.createElementVNode)('button',{class:'delete-button',style:{padding:'8px 16px',background:'linear-gradient(135deg, #ff6b6b 0%, #ee5a52 100%)',border:'none','border-radius':'6px',color:'white',cursor:'pointer','font-size':'12px','font-weight':'600',transition:'all 0.3s ease',display:'flex','align-items':'center',gap:'6px','box-shadow':'0 3px 12px rgba(255, 107, 107, 0.3)',position:'relative',overflow:'hidden'},onClick:e=>(e=>{confirm('ç¡®å®šè¦åˆ é™¤è¿™ä¸ªè¡¨æ ¼å—ï¼Ÿ')&&(n.value.splice(e,1),(0,d.pA)()&&(insertOrAssignVariables({table_history:n.value},{type:'chat'}),window.toastr.success('è¡¨æ ¼å·²åˆ é™¤')))})(r)},[...o[2]||(o[2]=[(0,i.createElementVNode)('div',{style:{position:'absolute',top:'0',left:'-100%',width:'100%',height:'100%',background:'linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent)',transition:'left 0.5s'},class:'shimmer-effect'},null,-1),(0,i.createElementVNode)('i',{class:'fa-solid fa-trash',style:{'font-size':'12px'}},null,-1),(0,i.createTextVNode)(' åˆ é™¤ ',-1)])],8,Wi)]),(0,i.createElementVNode)('div',qi,[(0,i.createElementVNode)('table',Ki,[(0,i.createElementVNode)('thead',Xi,[(0,i.createElementVNode)('tr',null,[((0,i.openBlock)(!0),(0,i.createElementBlock)(i.Fragment,null,(0,i.renderList)(e.headers,(e,n)=>((0,i.openBlock)(),(0,i.createElementBlock)('th',{key:n,style:{padding:'12px 16px','text-align':'left','font-weight':'bold',color:'#fff','border-bottom':'2px solid #3a3a3a','border-right':'1px solid #3a3a3a'}},(0,i.toDisplayString)(e),1))),128))])]),(0,i.createElementVNode)('tbody',null,[((0,i.openBlock)(!0),(0,i.createElementBlock)(i.Fragment,null,(0,i.renderList)(e.data,(e,n)=>((0,i.openBlock)(),(0,i.createElementBlock)('tr',{key:n,style:{'border-bottom':'1px solid #3a3a3a'}},[((0,i.openBlock)(!0),(0,i.createElementBlock)(i.Fragment,null,(0,i.renderList)(e,(e,n)=>((0,i.openBlock)(),(0,i.createElementBlock)('td',{key:n,style:{padding:'10px 16px',color:'#e0e0e0','border-right':'1px solid #3a3a3a'}},(0,i.toDisplayString)(e),1))),128))]))),128))])])])])):(0,i.createCommentVNode)('v-if',!0)]))),128))])):((0,i.openBlock)(),(0,i.createElementBlock)('div',Qi,[...o[3]||(o[3]=[(0,i.createElementVNode)('i',{class:'fa-solid fa-table',style:{'font-size':'48px','margin-bottom':'10px',opacity:'0.3'}},null,-1),(0,i.createElementVNode)('p',{style:{margin:'10px 0','font-size':'16px'}},'è¿˜æ²¡æœ‰è¡¨æ ¼è®°å½•',-1),(0,i.createElementVNode)('small',{style:{'font-size':'12px',color:'#666'}},'ä½¿ç”¨"è®¾ç½®"æ ‡ç­¾é¡µæ‰‹åŠ¨ç”Ÿæˆè¡¨æ ¼',-1)])]))]))}});s(419);const el=(0,V.A)(Zi,[['__scopeId','data-v-170043aa']]),nl=_,tl={class:'tools-tab',style:{padding:'25px !important',background:'#1a1a1a !important'}},al={class:'tool-section'},ol={key:0,class:'tool-content'},rl={class:'form-group',style:{margin:'15px 0'}},sl={class:'form-group',style:{margin:'15px 0'}},il={style:{display:'flex','align-items':'center',gap:'8px',color:'#ccc','font-size':'13px',cursor:'pointer'}},ll={key:0,class:'progress-bar-container',style:{margin:'15px 0'}},dl={class:'progress-bar',style:{width:'100%',height:'8px',background:'#2a2a2a','border-radius':'4px',overflow:'hidden',position:'relative'}},cl={style:{'text-align':'center','margin-top':'8px',color:'#667eea','font-size':'12px','font-weight':'500'}},pl={class:'button-group',style:{display:'flex',gap:'12px','margin-bottom':'20px'}},gl=['disabled'],ul={key:1,class:'output-section'},ml={class:'output-content',style:{background:'#1e1e1e',border:'1px solid #3a3a3a','border-radius':'6px',padding:'15px',color:'#e0e0e0','font-size':'13px','line-height':'1.6','white-space':'pre-wrap','word-wrap':'break-word','max-height':'300px','overflow-y':'auto'}},fl={style:{'margin-top':'20px','padding-top':'20px','border-top':'1px solid #3a3a3a'}},xl={class:'form-group',style:{'margin-bottom':'12px'}},bl={style:{display:'flex',gap:'10px'}},hl=['disabled'],yl=['disabled'],vl={class:'tool-section'},wl={key:0,class:'tool-content'},kl={class:'form-group',style:{margin:'15px 0'}},Al={class:'form-group',style:{margin:'15px 0'}},Cl={style:{display:'flex','align-items':'center',gap:'8px',color:'#ccc','font-size':'13px',cursor:'pointer'}},El={key:0,class:'progress-bar-container',style:{margin:'15px 0'}},Tl={class:'progress-bar',style:{width:'100%',height:'8px',background:'#2a2a2a','border-radius':'4px',overflow:'hidden',position:'relative'}},Sl={style:{'text-align':'center','margin-top':'8px',color:'#ffc107','font-size':'12px','font-weight':'500'}},Nl={class:'button-group',style:{display:'flex',gap:'12px','margin-bottom':'20px'}},Il=['disabled'],_l={key:1,class:'output-section'},Vl={class:'entry-preview',style:{background:'#1e1e1e',border:'1px solid #3a3a3a','border-radius':'6px',padding:'15px','margin-bottom':'15px'}},zl={class:'entry-field',style:{'margin-bottom':'10px'}},Bl={style:{color:'#e0e0e0','font-size':'13px'}},Ml={class:'entry-field',style:{'margin-bottom':'10px'}},Pl={style:{color:'#e0e0e0','font-size':'13px'}},$l={class:'entry-field',style:{'margin-bottom':'10px'}},Dl={style:{color:'#e0e0e0','font-size':'13px','line-height':'1.6','white-space':'pre-wrap','max-height':'200px','overflow-y':'auto'}},jl={class:'entry-field'},Rl={style:{color:'#e0e0e0','font-size':'13px'}},Ol={class:'modify-section',style:{'margin-top':'25px','border-top':'2px dashed #3a3a3a','padding-top':'20px'}},Fl={class:'form-group',style:{margin:'15px 0'}},Ll={key:0,class:'progress-bar-container',style:{margin:'12px 0'}},Hl={class:'progress-bar',style:{width:'100%',height:'8px',background:'#2a2a2a','border-radius':'4px',overflow:'hidden',position:'relative'}},Ul={style:{'text-align':'center','margin-top':'8px',color:'#ffa500','font-size':'12px','font-weight':'500'}},Gl={class:'button-group',style:{display:'flex',gap:'12px','margin-bottom':'15px'}},Yl=['disabled'],Jl={class:'insert-section',style:{background:'#1a1a1a',padding:'15px','border-radius':'6px','margin-top':'20px'}},Wl={class:'form-group',style:{'margin-bottom':'12px'}},ql=['value'],Kl={class:'output-actions',style:{display:'flex',gap:'12px'}},Xl=['disabled'],Ql={class:'tool-section'},Zl={key:0,class:'tool-content'},ed={class:'form-group',style:{'margin-bottom':'20px'}},nd=['value'],td={key:0,class:'form-group',style:{'margin-bottom':'20px'}},ad={key:1,style:{display:'flex',gap:'10px','margin-bottom':'15px'}},od={key:2,style:{'margin-bottom':'15px',color:'#888','font-size':'12px'}},rd={key:0},sd={key:1,style:{color:'#ff6b6b'}},id={key:3,style:{display:'flex','flex-direction':'column',gap:'12px'}},ld=['onClick'],dd={style:{flex:'1','line-height':'1.6'}},cd={style:{display:'flex','align-items':'center',gap:'6px','margin-bottom':'8px'}},pd={key:0,style:{'font-size':'14px'}},gd={key:1,style:{'font-size':'14px'}},ud={key:2,style:{'font-size':'14px'}},md={style:{color:'#fff','font-weight':'600','font-size':'14px'}},fd={style:{'padding-left':'20px','margin-bottom':'6px','font-size':'12px',color:'#ccc'}},xd={key:0},bd={key:1},hd={key:2},yd={key:3},vd={style:{'padding-left':'20px','font-size':'12px',color:'#999','font-style':'italic'}},wd={key:0,style:{'margin-top':'15px','padding-top':'15px','border-top':'1px solid #3a3a3a'}},kd={style:{'margin-bottom':'12px'}},Ad={style:{display:'flex','align-items':'center',gap:'8px'}},Cd={key:0,style:{padding:'4px 10px',background:'#4a9eff',color:'white','border-radius':'12px','font-size':'11px','font-weight':'bold'}},Ed={key:1,style:{padding:'4px 10px',background:'#28a745',color:'white','border-radius':'12px','font-size':'11px','font-weight':'bold'}},Td={key:2,style:{padding:'4px 10px',background:'#888',color:'white','border-radius':'12px','font-size':'11px','font-weight':'bold'}},Sd={style:{'margin-bottom':'12px'}},Nd={style:{color:'#888','font-size':'12px','font-weight':'600',display:'block','margin-bottom':'6px'}},Id={key:0,style:{color:'#ffa500','font-size':'10px','margin-left':'6px'}},_d={style:{display:'flex','flex-wrap':'wrap',gap:'6px'}},Vd={key:0,style:{color:'#888','font-size':'11px'}},zd={style:{'margin-bottom':'12px'}},Bd={style:{padding:'12px',background:'#1a1a1a',border:'1px solid #3a3a3a','border-radius':'6px',color:'#ccc','font-size':'12px','line-height':'1.6','max-height':'200px','overflow-y':'auto','white-space':'pre-wrap'}},Md={style:{display:'flex',gap:'10px','margin-top':'12px'}},Pd=['onClick'],$d=['onClick'],Dd={style:{background:'#2a2a2a',border:'1px solid rgba(255, 255, 255, 0.1)','border-radius':'12px',padding:'25px','max-width':'700px',width:'90%','max-height':'85vh','overflow-y':'auto','box-shadow':'0 10px 40px rgba(0, 0, 0, 0.5)'}},jd={style:{display:'flex','justify-content':'space-between','align-items':'center','margin-bottom':'20px'}},Rd={style:{display:'flex','flex-direction':'column',gap:'15px'}},Od={style:{display:'flex','align-items':'center',gap:'10px'}},Fd=['value'],Ld=['value'],Hd=['value'],Ud={style:{display:'grid','grid-template-columns':'1fr 1fr',gap:'10px'}},Gd=['value'],Yd=['value'],Jd={style:{background:'#1a1a1a',padding:'15px','border-radius':'8px',border:'1px solid rgba(255, 255, 255, 0.1)'}},Wd={style:{display:'flex','flex-direction':'column',gap:'10px'}},qd={style:{color:'#ccc','font-size':'13px',display:'flex','align-items':'center',gap:'10px',cursor:'pointer'}},Kd=['checked'],Xd={style:{color:'#ccc','font-size':'13px',display:'flex','align-items':'center',gap:'10px',cursor:'pointer'}},Qd=['checked'],Zd=['value'],ec={style:{display:'flex',gap:'10px','margin-top':'20px','justify-content':'flex-end'}},nc={class:'tool-section'},tc={key:0,class:'tool-content'},ac={class:'form-group',style:{margin:'15px 0'}},oc={class:'form-group',style:{margin:'15px 0'}},rc={style:{display:'flex','align-items':'center',gap:'8px',color:'#ccc','font-size':'13px',cursor:'pointer'}},sc={key:0,class:'progress-bar-container',style:{margin:'15px 0'}},ic={class:'progress-bar',style:{width:'100%',height:'8px',background:'#2a2a2a','border-radius':'4px',overflow:'hidden',position:'relative'}},lc={style:{'text-align':'center','margin-top':'8px',color:'#17a2b8','font-size':'12px','font-weight':'500'}},dc={class:'button-group',style:{display:'flex',gap:'12px','margin-bottom':'20px'}},cc=['disabled'],pc={key:1,class:'output-section'},gc={class:'output-content',style:{background:'#1e1e1e',border:'1px solid #3a3a3a','border-radius':'6px',padding:'15px',color:'#e0e0e0','font-size':'13px','line-height':'1.6','white-space':'pre-wrap','word-wrap':'break-word','max-height':'300px','overflow-y':'auto'}},uc={class:'modify-section',style:{'margin-top':'25px','border-top':'2px dashed #3a3a3a','padding-top':'20px'}},mc={class:'form-group',style:{margin:'15px 0'}},fc={key:0,class:'progress-bar-container',style:{margin:'15px 0'}},xc={class:'progress-bar',style:{width:'100%',height:'8px',background:'#2a2a2a','border-radius':'4px',overflow:'hidden',position:'relative'}},bc={style:{'text-align':'center','margin-top':'8px',color:'#17a2b8','font-size':'12px','font-weight':'500'}},hc={class:'button-group',style:{display:'flex',gap:'12px','margin-bottom':'15px'}},yc=['disabled'],vc=(0,i.defineComponent)({__name:'ToolsTab',setup(e){const n=(0,l.C)(),{settings:t}=(0,p.storeToRefs)(n),a=(0,i.ref)(new Map),o=(0,i.ref)(''),r=(0,i.ref)(''),s=(0,i.ref)(!1),c=(0,i.ref)(!1),g=(0,i.ref)(0),u=(0,i.ref)(''),m=(0,i.ref)(!1),f=(0,i.ref)(''),x=(0,i.ref)(''),h=(0,i.ref)(!1),y=(0,i.ref)(''),v=(0,i.ref)(!1),w=(0,i.ref)(!1),k=(0,i.ref)(0),A=(0,i.ref)(''),C=(0,i.ref)(null),E=(0,i.ref)(!1),T=(0,i.ref)([]),S=(0,i.ref)(''),N=(0,i.ref)(!1),I=(0,i.ref)(''),V=(0,i.ref)(!1),B=(0,i.ref)(!1),M=(0,i.ref)(0),P=(0,i.ref)(''),D=(0,i.ref)([]),j=(0,i.ref)(''),R=(0,i.ref)('original'),O=(0,i.ref)(new Map),F=(0,i.ref)(!1),L=(0,i.ref)({}),H=(0,i.ref)(null),U=(0,i.ref)(!1),G=()=>{if(U.value)try{const e=(0,d.Ut)();if(!e)return void console.warn('âš ï¸ script_id ä¸ºç©ºï¼Œæ— æ³•ä¿å­˜æ•°æ®');const n={tools_antiCliche:{input:o.value,output:r.value,enableStreaming:c.value,modifyRequest:u.value},tools_characterCard:{description:f.value,output:x.value,modifyRequest:y.value,enableStreaming:w.value},tools_worldbookEntry:{description:A.value,output:C.value,selectedWorldbook:S.value,modifyRequest:I.value,enableStreaming:B.value},tools_worldbookViewer:{selectedWorldbook:P.value,searchQuery:j.value,sortBy:R.value},tools_expandedState:Object.fromEntries(a.value)};insertOrAssignVariables((0,b.klona)(n),{type:'script',script_id:e}),console.log('ğŸ’¾ å·¥å…·æ•°æ®å·²ä¿å­˜:',{antiCliche_input_length:o.value.length,antiCliche_output_length:r.value.length,character_desc_length:f.value.length,character_output_length:x.value.length})}catch(e){console.error('âŒ ä¿å­˜å·¥å…·æ•°æ®å¤±è´¥:',e)}else console.log('â¸ï¸ è·³è¿‡ä¿å­˜ï¼šæ•°æ®å°šæœªåŠ è½½å®Œæˆ')},Y=(0,nl.debounce)(G,300);(0,i.watch)([o,r,c,u,f,x,y,w,A,C,S,I,B,P,j,R,a],()=>{U.value&&(console.log('ğŸ“ æ•°æ®å˜åŒ–ï¼Œè§¦å‘ä¿å­˜...'),Y())},{deep:!0}),(0,i.onMounted)(()=>{console.log('ğŸ”§ ToolsTab ç»„ä»¶å·²æŒ‚è½½ï¼ŒåŠ è½½æ•°æ®...'),(()=>{try{U.value=!1;const e=(0,d.Ut)();if(!e)return console.warn('âš ï¸ script_id ä¸ºç©ºï¼Œæ— æ³•åŠ è½½æ•°æ®'),void(U.value=!0);const n=getVariables({type:'script',script_id:e});console.log('ğŸ“¥ åŠ è½½å·¥å…·æ•°æ®:',n),n.tools_antiCliche&&(o.value=n.tools_antiCliche.input||'',r.value=n.tools_antiCliche.output||'',c.value=n.tools_antiCliche.enableStreaming||!1,u.value=n.tools_antiCliche.modifyRequest||'',console.log('âœ… å·²æ¢å¤åå…«è‚¡æ•°æ®:',{input:o.value.substring(0,50),output:r.value.substring(0,50),enableStreaming:c.value,modifyRequest:u.value.substring(0,30)})),n.tools_characterCard&&(f.value=n.tools_characterCard.description||'',x.value=n.tools_characterCard.output||'',y.value=n.tools_characterCard.modifyRequest||'',w.value=n.tools_characterCard.enableStreaming||!1,console.log('âœ… å·²æ¢å¤è§’è‰²å¡æ•°æ®:',{description:f.value.substring(0,50),output:x.value.substring(0,50),modifyRequest:y.value.substring(0,50),enableStreaming:w.value})),n.tools_worldbookEntry&&(A.value=n.tools_worldbookEntry.description||'',C.value=n.tools_worldbookEntry.output||null,S.value=n.tools_worldbookEntry.selectedWorldbook||'',I.value=n.tools_worldbookEntry.modifyRequest||'',B.value=n.tools_worldbookEntry.enableStreaming||!1,console.log('âœ… å·²æ¢å¤ä¸–ç•Œä¹¦æ¡ç›®æ•°æ®:',{description:A.value.substring(0,50),output:C.value?'æœ‰è¾“å‡º':'æ— è¾“å‡º',selectedWorldbook:S.value,modifyRequest:I.value.substring(0,50),enableStreaming:B.value})),n.tools_expandedState&&(a.value=new Map(Object.entries(n.tools_expandedState)),console.log('âœ… å·²æ¢å¤å±•å¼€çŠ¶æ€:',Object.fromEntries(a.value))),n.tools_worldbookViewer&&(P.value=n.tools_worldbookViewer.selectedWorldbook||'',j.value=n.tools_worldbookViewer.searchQuery||'',R.value=n.tools_worldbookViewer.sortBy||'original',console.log('âœ… å·²æ¢å¤ä¸–ç•Œä¹¦æŸ¥çœ‹å™¨æ•°æ®:',{selectedWorldbook:P.value,searchQuery:j.value,sortBy:R.value}),P.value&&(console.log('ğŸ”„ è‡ªåŠ¨åŠ è½½å·²é€‰æ‹©çš„ä¸–ç•Œä¹¦æ¡ç›®...'),setTimeout(()=>{ge()},200))),setTimeout(()=>{U.value=!0,console.log('âœ… æ•°æ®åŠ è½½å®Œæˆï¼Œå¯ç”¨è‡ªåŠ¨ä¿å­˜')},100)}catch(e){console.error('âŒ åŠ è½½å·¥å…·æ•°æ®å¤±è´¥:',e),U.value=!0}})(),(()=>{try{T.value=getWorldbookNames(),console.log('âœ… å·²åŠ è½½ä¸–ç•Œä¹¦åˆ—è¡¨:',T.value)}catch(e){console.error('âŒ åŠ è½½ä¸–ç•Œä¹¦åˆ—è¡¨å¤±è´¥:',e),window.toastr.error('åŠ è½½ä¸–ç•Œä¹¦åˆ—è¡¨å¤±è´¥ï¼š'+e.message)}})()}),(0,i.onBeforeUnmount)(()=>{console.log('ğŸ”„ ToolsTab ç»„ä»¶å³å°†å¸è½½ï¼Œä¿å­˜æ•°æ®...'),Y.cancel(),G()});const J=e=>{console.log('toggleToolExpanded è¢«è°ƒç”¨ï¼Œå·¥å…·åç§°:',e);const n=a.value.get(e)||!1;console.log('å½“å‰å±•å¼€çŠ¶æ€:',n),a.value.set(e,!n),console.log('æ–°çš„å±•å¼€çŠ¶æ€:',!n)},W=e=>a.value.get(e)||!1,q=async()=>{if(o.value.trim())try{s.value=!0,g.value=0,window.toastr.info('AIæ­£åœ¨åˆ†ææ–‡æœ¬...','åå…«è‚¡æ¸…ç†',{timeOut:15e3});const e={model:t.value.model,max_tokens:t.value.max_tokens||8e3,temperature:.7,stream:c.value,messages:[{role:'system',content:'ä½ æ˜¯ä¸€ä¸ªæ–‡æœ¬ç¼–è¾‘åŠ©æ‰‹ï¼Œè´Ÿè´£æ¸…ç†è§’è‰²å¡ã€ä¸–ç•Œä¹¦å’Œå¼€åœºç™½ä¸­çš„**æ˜æ˜¾å…«è‚¡è¡¨è¿°**ã€‚\n\n## ğŸ¯ æ ¸å¿ƒåŸåˆ™ï¼ˆæœ€é‡è¦ï¼ï¼‰\n\nâš ï¸ **ä¿æŒä¿¡æ¯å®Œæ•´åº¦ï¼šæ¸…ç†å…«è‚¡çš„åŒæ—¶ï¼Œå¿…é¡»ä¿ç•™åŸæ–‡çš„æ ¸å¿ƒä¿¡æ¯å’Œå†…å®¹é‡**\nâš ï¸ **é€‚åº¦æ¸…ç†ï¼šåªåˆ é™¤æœ€æ˜æ˜¾çš„å…«è‚¡ï¼Œä¸è¦è¿‡åº¦åˆ å‡**\nâš ï¸ **ä¿æŒé•¿åº¦ï¼šè¾“å‡ºé•¿åº¦åº”è¯¥æ¥è¿‘è¾“å…¥é•¿åº¦ï¼Œä¸è¦å¤§å¹…ç¼©çŸ­**\nâš ï¸ **åˆ é™¤ç²¾ç¡®æ•°å­—ï¼šèº«é«˜ã€ä½“é‡ã€ç½©æ¯ç­‰ç²¾ç¡®æ•°å­—è¦åˆ é™¤æˆ–æ”¹ä¸ºæ¨¡ç³Šæè¿°ï¼ˆ"é«˜"ã€"ç˜¦"ã€"ä¸°æ»¡"ï¼‰**\n\n## æ¸…ç†é‡ç‚¹ï¼ˆæŒ‰ä¼˜å…ˆçº§æ’åºï¼‰\n\n### ğŸ”´ åå…«è‚¡æ ¸å¿ƒè§„åˆ™ï¼ˆå¿…é¡»ä¸¥æ ¼éµå®ˆï¼‰\n\n#### 1. ç¦æ­¢çš„è¯æ±‡å’Œå¥å¼\n- **æ¨¡ç³Šè¯**ï¼šä¸€ä¸ã€ä¸€æŠ¹ã€ä¸€äº›ã€ä¸€ç§ã€ä¼¼ä¹ã€å‡ ä¹ã€è¿‘ä¹ã€ä»¿ä½›ã€å¯èƒ½ã€å¤§æ¦‚\n- **æ¯”å–»è¯**ï¼šå¦‚åŒã€å®›å¦‚ã€æ°ä¼¼ã€åƒæ˜¯ã€å¥½åƒã€åƒã€å°±åƒã€è‹¥æœ‰è‹¥æ— \n- **å¯¹æ¯”å¥**ï¼š"ä¸æ˜¯...è€Œæ˜¯..."ã€"ä¸å…¶...ä¸å¦‚"ã€"å½¢æˆäº†é²œæ˜çš„å¯¹æ¯”"\n- **å¼ºè°ƒè¯**ï¼š"çŒ›åœ°"ã€"é‡é‡åœ°"ã€"ç‹‚é‡"ã€"æ¿€çƒˆåœ°"ã€"æ¨ä¸å¾—"ã€"ç‹‚å–œ"ã€"ä¸å®¹ç½®ç–‘"\n- **ä¿®é¥°è¯**ï¼š"ä¸æ˜“å¯Ÿè§‰"ã€"éš¾ä»¥å¯Ÿè§‰"ã€"å¸¦ç€xxæ„å‘³"ã€"å¸¦ç€ä¸€ç§"ã€"å……æ»¡äº†æŸç§"ã€"å¹¶æ²¡æœ‰ç«‹åˆ»"\n- **åŠ¨ä½œè¯**ï¼š"æ‰è¿›èº«ä½“"ã€"æŒ‡ç”²æè¿›"ã€"å¼“èµ·"ã€"åå™¬"\n- **"ä¸€"+é‡è¯å¥å¼**ï¼šä¸€æŠ¹å¾®ç¬‘ã€ä¸€ä¸ä¸å®‰ã€ä¸€ç§æ„Ÿè§‰ï¼ˆå…¨éƒ¨åˆ é™¤ï¼‰\n- **ç²¾ç¡®æ•°å­—**ï¼šèº«é«˜168cm/ä¸€ç±³å…­å…«ã€ä½“é‡50kgã€ç½©æ¯Cï¼ˆæ”¹ä¸º"é«˜"ã€"ç˜¦"ã€"ä¸°æ»¡"æˆ–ç›´æ¥åˆ é™¤ï¼‰\n\n#### 2. ç¦æ­¢çš„æå†™å†…å®¹\n- âŒ **çœ¼ç¥/è§†çº¿/å˜´è§’**ï¼šä¸æå†™"çœ¼é‡Œé—ªè¿‡xxx"ã€"å˜´è§’ä¸Šæ‰¬"ã€"è§†çº¿äº¤æ±‡"\n- âŒ **å¿ƒç†çŠ¶æ€**ï¼šä¸æå†™"å¥¹æ„Ÿåˆ°å®³æ€•"ã€"ä»–å†…å¿ƒçŸ›ç›¾"ï¼ˆæ”¹ç”¨å¯¹ç™½æˆ–è¡Œä¸ºå‘ˆç°ï¼‰\n- âŒ **æ°”æ°›**ï¼šä¸æå†™"æ°”æ°›å‡é‡"ã€"ç©ºæ°”å‡å›º"\n- âŒ **åŠ¨ç‰©æ¯”å–»**ï¼šä¸ç”¨"åƒå°å…½"ã€"åƒçŒ«å’ª"ã€"é‡å…½èˆ¬çš„ä½å¼"\n- âŒ **å£°éŸ³æè¿°**ï¼šä¸æå†™"å£°éŸ³æ²™å“‘"ã€"å£°éŸ³é‡Œå¸¦ç€..."ã€"å—“éŸ³å¬èµ·æ¥..."ã€éŸ³é‡/éŸ³é«˜/éŸ³è´¨/é€Ÿåº¦\n- âŒ **å¯¹ç™½è¡¥å……**ï¼šä¸æè¿°å¯¹ç™½çš„è¯­æ°”ã€æ„å›¾ã€åŠŸèƒ½ï¼Œåªå‘ˆç°å¯¹ç™½æœ¬èº«\n\n#### 3. æ‰€æœ‰æ ¼ä¸»è¯­è§„åˆ™\n- âŒ ç¦æ­¢ï¼š"å¥¹çš„å£°éŸ³"ã€"ä»–çš„çœ¼ç¥"ã€"æˆ‘çš„å¿ƒæƒ…"\n- âœ… æ”¹ä¸ºï¼šç›´æ¥ç”¨åè¯æˆ–ä»£è¯ä½œä¸»è¯­ï¼Œæˆ–ç›´æ¥åˆ é™¤\n\n#### 4. åŠ¨ä½œæå†™è§„åˆ™\n- âœ… **åªå‘ˆç°åŠ¨ä½œç»“æœ**ï¼šä¸æ€»ç»“ã€ä¸è¯„ä»·ã€ä¸è§£é‡Šæ„å›¾\n- âŒ é”™è¯¯ï¼š"ä»–æ„¤æ€’åœ°ç ¸äº†æ¯å­"ï¼ˆè¯„ä»·ï¼‰\n- âœ… æ­£ç¡®ï¼š"ä»–ç ¸äº†æ¯å­"ï¼ˆåªå‘ˆç°åŠ¨ä½œï¼‰\n\n#### 5. æƒ…ç»ª/æ„Ÿå—å‘ˆç°è§„åˆ™\n- âœ… **ç”¨å¯¹ç™½æˆ–è¡Œä¸ºå‘ˆç°**ï¼Œä¸ç›´è¿°\n- âŒ é”™è¯¯ï¼š"å¥¹æ„Ÿåˆ°å®³æ€•"\n- âœ… æ­£ç¡®ï¼š"åˆ«è¿‡æ¥ï¼"ï¼ˆå¯¹ç™½ï¼‰æˆ–"å¥¹å¾€åé€€äº†ä¸€æ­¥"ï¼ˆè¡Œä¸ºï¼‰\n\n#### 6. å¯¹ç™½è§„åˆ™\n- âœ… åªç”¨""åŒ…è£¹çš„å°è¯å’Œæ‹Ÿå£°è¯\n- âœ… è¦æœ‰æ—¥å¸¸æ„Ÿå’Œç”Ÿæ´»æ„Ÿï¼Œé¿å…ç¿»è¯‘è…”\n- âŒ ä¸æœ¯è¯­ã€ä¸æ•°æ®ã€ä¸æŠ¥å‘Šã€ä¸åˆ†æ\n\n#### 7. æ•°æ®åŒ–æè¿°è§„åˆ™\n- âŒ ç¦æ­¢ç²¾ç¡®æ•°å­—ï¼šèº«é«˜ï¼ˆ168cmã€ä¸€ç±³å…­å…«ï¼‰ã€ä½“é‡ï¼ˆ50kgï¼‰ã€ç½©æ¯ï¼ˆCç½©æ¯ï¼‰\n- âŒ ç¦æ­¢æœ¯è¯­åŒ–ï¼šæœ¯è¯­ã€ä¸“ä¸šåè¯ã€åˆ†ææ€§æè¿°\n- âœ… æ”¹ä¸ºæ¨¡ç³Šæè¿°ï¼šé«˜ã€çŸ®ã€ç˜¦ã€èƒ–ã€ä¸°æ»¡ç­‰å£è¯­åŒ–è¯æ±‡\n- âœ… æˆ–è€…ç›´æ¥åˆ é™¤ï¼šå¦‚æœæ•°å­—ä¸é‡è¦å°±åˆ æ‰\n\n### ğŸŸ¢ ä¼˜å…ˆçº§3ï¼šå¯ä»¥ä¿ç•™çš„å†…å®¹\n1. **å…·ä½“åŠ¨ä½œæè¿°**ï¼šèµ°ã€åã€ç«™ã€æ‹¿ã€æ”¾ç­‰åŸºæœ¬åŠ¨ä½œ\n2. **ç®€å•æƒ…ç»ªè¯**ï¼šå¼€å¿ƒã€éš¾è¿‡ã€ç”Ÿæ°”ï¼ˆä¸è¦åˆ é™¤ï¼‰\n3. **å¯¹è¯å†…å®¹**ï¼šå®Œæ•´ä¿ç•™æ‰€æœ‰å¯¹è¯\n4. **è®¾å®šä¿¡æ¯**ï¼šäººç‰©èƒŒæ™¯ã€å…³ç³»ã€åœºæ™¯ç­‰æ ¸å¿ƒè®¾å®š\n\n## âš ï¸ ä¸¥ç¦è¿‡åº¦åˆ å‡\n\n**ä¸è¦åšçš„äº‹æƒ…ï¼š**\nâŒ ä¸è¦åˆ é™¤æ•´ä¸ªå¥å­ï¼Œåªåˆ é™¤å…«è‚¡è¯æ±‡\nâŒ ä¸è¦æŠŠäº”æ®µè¯å‹ç¼©æˆä¸‰å¥è¯\nâŒ ä¸è¦åˆ é™¤æ ¸å¿ƒè®¾å®šå’Œé‡è¦ä¿¡æ¯\nâŒ ä¸è¦æŠŠè¯¦ç»†æè¿°å˜æˆç®€ç•¥æ¦‚æ‹¬\nâŒ ä¸è¦åˆ é™¤å¯¹è¯å†…å®¹\n\n**åº”è¯¥åšçš„äº‹æƒ…ï¼š**\nâœ… åªåˆ é™¤/æ›¿æ¢æ˜æ˜¾çš„å…«è‚¡è¯æ±‡\nâœ… **é‡å†™æ¨¡æ¿åŒ–æ¯”å–»**ï¼šç”¨å£è¯­åŒ–ã€è‡ªç„¶çš„è¡¨è¾¾æ›¿æ¢å¥—è¯\nâœ… **è¯´äººè¯**ï¼šä¸è¦ç®€å•åˆ é™¤ï¼Œè€Œæ˜¯ç”¨æ›´è‡ªç„¶çš„è¡¨è¾¾æ–¹å¼æ›¿æ¢\nâœ… **å»æ‰å¯¹ä»—å¼ç»“æ„**ï¼šæŠŠ"æ—¢...åˆ..."æ”¹ä¸ºå£è¯­åŒ–çš„å¹¶åˆ—\nâœ… ä¿æŒåŸæ–‡çš„ä¿¡æ¯é‡å’Œç»“æ„\nâœ… ä¿ç•™æ‰€æœ‰å¯¹è¯å’Œæ ¸å¿ƒè®¾å®š\nâœ… è¾“å‡ºåº”è¯¥å’Œè¾“å…¥é•¿åº¦ç›¸è¿‘ï¼Œä¿¡æ¯é‡ä¸èƒ½å°‘\n\n## ğŸ“– æ–‡ç¬”æå‡æŒ‡å—\n\n**æ ¸å¿ƒåŸåˆ™ï¼šç”¨äººè¯è¯´è¯ï¼Œåˆ«æ–‡å­¦è…”ï¼Œä½†ä¿æŒä¿¡æ¯é‡**\n\n### âœï¸ å¥½æ–‡ç¬”çš„ç‰¹å¾\n1. **å£è¯­åŒ–ã€æ—¥å¸¸åŒ–**ï¼š\n   - âŒ æ–‡å­¦è…”ï¼š"é†‡åšçš„é¦™æ°”æ‰‘é¢è€Œæ¥"\n   - âœ… å£è¯­åŒ–ï¼š"é—»åˆ°é…’å‘³äº†"ã€"æœ‰è‚¡é…’é¦™"\n\n2. **ç®€æ´ç›´æ¥**ï¼š\n   - âŒ å †ç Œï¼š"å¥¹é‚£åŒå¦‚åŒé»‘æ›œçŸ³èˆ¬ç’€ç’¨å¤ºç›®ã€æ·±é‚ƒæ— æ¯”ã€å®›å¦‚æ·±æ¸Šçš„çœ¼çœ¸"\n   - âœ… ç®€æ´ï¼š"å¥¹é»‘è‰²çš„çœ¼ç›å¾ˆæ·±"ã€"é»‘çœ¼ç›ï¼Œçœ‹ä¸å‡ºåœ¨æƒ³ä»€ä¹ˆ"\n\n3. **çœŸå®çš„äººè¯**ï¼š\n   - âŒ åˆ»æ„ï¼š"å¿ƒä¸­æ¶Œèµ·ä¸€è‚¡æ—¢çŸ›ç›¾åˆå¤æ‚çš„æƒ…ç»ªï¼Œä»¿ä½›æ˜¯ææƒ§ä¸æœŸå¾…çš„æ··åˆä½“"\n   - âœ… äººè¯ï¼š"åˆæ€•åˆæœŸå¾…"ã€"å¿ƒé‡ŒçŸ›ç›¾å¾—å¾ˆ"\n\n4. **åŠ¨ä½œè¦å…·ä½“**ï¼š\n   - âŒ æŠ½è±¡ï¼š"å¥¹çš„å£°éŸ³å¦‚åŒé‡å…½èˆ¬çš„ä½å¼"ã€"å¥¹çš„å£°éŸ³å¸¦ç€å‹è¿«æ„Ÿ"\n   - âœ… å…·ä½“ï¼š"å¥¹å‹ä½äº†å£°éŸ³"ã€"å£°éŸ³å¾ˆä½"ã€"å£°éŸ³å“‘äº†"\n\n5. **æ„Ÿå®˜æå†™åˆ«å¤¸å¼ **ï¼š\n   - âŒ å¤¸å¼ ï¼š"ä¸€è‚¡è¯±äººçš„é¦™æ°”"ã€"è‡´å‘½çš„å¸å¼•åŠ›"\n   - âœ… è‡ªç„¶ï¼š"å¥½é—»"ã€"è®©äººæƒ³å¤šé—»ä¸¤ä¸‹"ã€"é¦™å‘³å¾ˆæµ“"\n\n### ğŸ¨ å‚è€ƒé£æ ¼\n- **æµ·æ˜å¨**ï¼šçŸ­å¥ã€æœ‰åŠ›ã€å…‹åˆ¶ã€æ„Ÿå®˜ç»†èŠ‚å‡†ç¡®\n- **æ‘ä¸Šæ˜¥æ ‘**ï¼šå…·ä½“æ„è±¡ã€æ—¥å¸¸åŒ–æ¯”å–»ã€è½»æ¾å™è¿°\n- **ä¼˜è´¨ç½‘æ–‡**ï¼šæµç•…ã€æœ‰èŠ‚å¥æ„Ÿã€ä¸å–å¼„ã€è¯»èµ·æ¥èˆ’æœ\n\n### ğŸ’¡ å®æˆ˜æŠ€å·§\n1. **å»æ‰æ–‡å­¦è…”**ï¼šæŠŠ"è‡´å‘½çš„è¯±æƒ‘"æ”¹æˆ"å¿ä¸ä½æƒ³é è¿‘"ï¼ŒæŠŠ"é†‡åšçš„é¦™æ°”"æ”¹æˆ"é…’é¦™å¾ˆæµ“"\n2. **å»æ‰å¯¹ä»—**ï¼šæŠŠ"æ—¢...åˆ..."æ”¹æˆå£è¯­åŒ–çš„å¹¶åˆ—ï¼š"åˆæ€•åˆæœŸå¾…"ã€"é¦™å‘³æ··åœ¨ä¸€èµ·"\n3. **å»æ‰æ¯”å–»**ï¼šæŠŠ"å¦‚åŒé‡å…½èˆ¬çš„ä½å¼"ç›´æ¥åˆ æ‰ï¼Œæˆ–è€…æ”¹æˆ"å£°éŸ³å¾ˆä½"\n4. **ç”¨äººè¯è¯´è¯**ï¼šæŠŠ"çŸ›ç›¾è€Œæå…·å¸å¼•åŠ›"æ”¹æˆ"è¯´ä¸ä¸Šæ¥ï¼Œä½†å°±æ˜¯æƒ³çœ‹"\n5. **åˆ«å¤ªæ–‡è‰º**ï¼šæŠŠ"å†·æš–äº¤ç»‡çš„æ°”æ¯"æ”¹æˆ"å†·é¦™å’Œé…’å‘³æ··åœ¨ä¸€èµ·"\n\n## ğŸ“‹ åå…«è‚¡ç¤ºä¾‹å¯¹æ¯”\n\n### ç¤ºä¾‹1ï¼šåŸºç¡€å»å…«è‚¡\n\n**è¾“å…¥ï¼ˆåŒ…å«åŸºç¡€å…«è‚¡ï¼‰ï¼š**\nè§’è‰²Aä¼¼ä¹æœ‰äº›å›°æƒ‘ï¼Œçœ¼é‡Œé—ªè¿‡ä¸€ä¸ä¸æ˜“å¯Ÿè§‰çš„ç–‘æƒ‘ï¼Œå¥¹ç”¨ä¸å®¹ç½®ç–‘çš„è¯­æ°”è¯´ï¼š"ä½ æ˜¯è°ï¼Ÿ"å¥¹çš„å£°éŸ³ä½æ²‰è€Œå¯Œæœ‰ç£æ€§ï¼Œå¦‚åŒé‡å…½èˆ¬çš„ä½å¼ã€‚\n\nè§’è‰²Aå‡ºç”Ÿäºè´µæ—å®¶åº­ï¼Œå¥¹æœ‰ç€ä¸€å¤´å¦‚åŒé»‘æ›œçŸ³èˆ¬çš„é•¿å‘ï¼ŒåŒçœ¸å®›å¦‚æ·±é‚ƒçš„æ¹–æ³Šï¼Œèº«é«˜168cmï¼Œç½©æ¯Cã€‚\n\nå¥¹çš„æ€§æ ¼å¹¶ä¸æ˜¯æ¸©æŸ”çš„ï¼Œè€Œæ˜¯å‚²æ…¢ä¸”ç‹‚çƒ­çš„ã€‚å¥¹å–œæ¬¢é˜…è¯»ï¼Œç»å¸¸ä¸€ä¸ªäººå¾…åœ¨å›¾ä¹¦é¦†é‡Œã€‚\n\nå¥¹å¯¹é­”æ³•æœ‰ç€è¿‘ä¹ç‹‚çƒ­çš„è¿½æ±‚ï¼Œä»¿ä½›é‚£æ˜¯å¥¹ç”Ÿå‘½çš„å…¨éƒ¨æ„ä¹‰ã€‚å¥¹çš„å†…å¿ƒæ·±å¤„éšè—ç€å·¨å¤§çš„ææƒ§ã€‚\n\nè¯­æ–™ï¼š"å“¼ï¼Œä½ è¿™ç§å‡¡äººæ€ä¹ˆä¼šç†è§£æˆ‘çš„æƒ³æ³•ã€‚"ï¼ˆå¸¦ç€ä¸å±‘çš„å£å»ï¼‰\n\n**âŒ é”™è¯¯è¾“å‡ºï¼ˆè¿‡åº¦åˆ å‡ï¼‰ï¼š**\nè§’è‰²Aé—®ï¼š"ä½ æ˜¯è°ï¼Ÿ"\nè§’è‰²Aå‡ºç”Ÿäºè´µæ—å®¶åº­ï¼Œæœ‰é»‘è‰²é•¿å‘ã€‚\nè¯­æ–™ï¼š"ä½ ä¸ä¼šç†è§£æˆ‘çš„æƒ³æ³•ã€‚"\n\n**âœ… æ­£ç¡®è¾“å‡ºï¼ˆåº”ç”¨åå…«è‚¡è§„åˆ™ï¼‰ï¼š**\nè§’è‰²Aåœäº†åœã€‚"ä½ æ˜¯è°ï¼Ÿ"\n\nè§’è‰²Aå‡ºç”Ÿäºè´µæ—å®¶åº­ï¼Œé»‘è‰²é•¿å‘ï¼Œé»‘çœ¼ç›ï¼Œä¸ªå­é«˜ï¼Œèƒ¸éƒ¨ä¸°æ»¡ã€‚\n\nè§’è‰²Aå‚²æ…¢ï¼Œå¯¹å¾ˆå¤šäº‹éƒ½å¾ˆçƒ­æƒ…ã€‚å–œæ¬¢é˜…è¯»ï¼Œç»å¸¸ä¸€ä¸ªäººå¾…åœ¨å›¾ä¹¦é¦†ã€‚\n\nè§’è‰²Aå¯¹é­”æ³•å¾ˆç—´è¿·ï¼ŒæŠ•å…¥äº†å¾ˆå¤šæ—¶é—´ç ”ç©¶ã€‚å¥¹æ€•ä¸€äº›ä¸œè¥¿ã€‚\n\nè¯­æ–™ï¼š"å“¼ï¼Œä½ è¿™ç§å‡¡äººæ€ä¹ˆä¼šç†è§£æˆ‘çš„æƒ³æ³•ã€‚"\n\n**æ”¹è¿›è¯´æ˜ï¼š**\n1. "ä¼¼ä¹æœ‰äº›å›°æƒ‘" â†’ "åœäº†åœ"ï¼ˆç”¨è¡Œä¸ºä»£æ›¿å¿ƒç†ï¼‰\n2. "çœ¼é‡Œé—ªè¿‡ä¸€ä¸ä¸æ˜“å¯Ÿè§‰çš„ç–‘æƒ‘" â†’ åˆ é™¤ï¼ˆç¦æ­¢çœ¼ç¥æå†™ï¼‰\n3. "å¥¹çš„å£°éŸ³ä½æ²‰è€Œå¯Œæœ‰ç£æ€§ï¼Œå¦‚åŒé‡å…½èˆ¬çš„ä½å¼" â†’ åˆ é™¤ï¼ˆç¦æ­¢å£°éŸ³æå†™å’ŒåŠ¨ç‰©æ¯”å–»ï¼‰\n4. "å¦‚åŒé»‘æ›œçŸ³èˆ¬"ã€"å®›å¦‚æ·±é‚ƒçš„æ¹–æ³Š" â†’ åˆ é™¤ï¼ˆç¦æ­¢æ˜å–»ï¼‰\n5. "å¥¹çš„æ€§æ ¼å¹¶ä¸æ˜¯...è€Œæ˜¯..." â†’ "è§’è‰²Aå‚²æ…¢"ï¼ˆåˆ é™¤æ‰€æœ‰æ ¼ä¸»è¯­å’Œå¯¹æ¯”å¥ï¼‰\n6. "è¿‘ä¹"ã€"ä»¿ä½›" â†’ åˆ é™¤ï¼ˆç¦æ­¢æ¨¡ç³Šè¯ï¼‰\n7. "èº«é«˜168cm"ã€"ç½©æ¯C" â†’ "ä¸ªå­é«˜"ï¼ˆåˆ é™¤ç²¾ç¡®æ•°å­—ï¼‰\n8. "ï¼ˆå¸¦ç€ä¸å±‘çš„å£å»ï¼‰" â†’ åˆ é™¤ï¼ˆç¦æ­¢å¯¹ç™½è¡¥å……ï¼‰\n\n### ç¤ºä¾‹2ï¼šä¿¡æ¯ç´ æå†™å»å…«è‚¡\n\n**è¾“å…¥ï¼ˆåŒ…å«å¤§é‡å…«è‚¡ï¼‰ï¼š**\nä¸€é˜µæ—¢å†·å†½åˆé†‡åšçš„é¦™æ°”é£˜æ¥ï¼Œæ··åˆç€å†¬æ—¥é›ªæ¾ä¸æ¸©çƒ­ç™½å…°åœ°çš„å‘³é“ï¼ŒçŸ›ç›¾è€Œæå…·å¸å¼•åŠ›ã€‚æµ“éƒè€Œæ»šçƒ«çš„ä¿¡æ¯ç´ æ­£ä»ä»–èº«ä¸Šæºæºä¸æ–­åœ°æ•£å‘å‡ºæ¥ï¼Œé‚£å†°å†·çš„é›ªæ‰æ°”æ¯å·²ç»è¢«é†‡åšçš„ç™½å…°åœ°é…’é¦™å½»åº•åŒ…è£¹ï¼Œå……æ»¡äº†æ¯«æ— é˜²å¤‡çš„ã€è‡´å‘½çš„è¯±æƒ‘ã€‚\n\n**âœ… æ­£ç¡®è¾“å‡ºï¼ˆåº”ç”¨åå…«è‚¡è§„åˆ™ï¼‰ï¼š**\né—»åˆ°é¦™å‘³ï¼Œé›ªæ¾å’Œç™½å…°åœ°æ··åœ¨ä¸€èµ·ã€‚æ»šçƒ«çš„ä¿¡æ¯ç´ ä»ä»–èº«ä¸Šæ•£å‡ºæ¥ï¼Œé›ªæ‰å‘³è¢«é…’é¦™ç›–è¿‡äº†ã€‚\n\n**æ”¹è¿›è¯´æ˜ï¼š**\n1. "æ—¢...åˆ..." â†’ åˆ é™¤ï¼ˆç¦æ­¢å¯¹æ¯”å¥å¼ï¼‰\n2. "çŸ›ç›¾è€Œæå…·å¸å¼•åŠ›" â†’ åˆ é™¤ï¼ˆç¦æ­¢æŠ½è±¡æè¿°ï¼‰\n3. "æµ“éƒè€Œæ»šçƒ«" â†’ "æ»šçƒ«"ï¼ˆåˆ é™¤å†—ä½™å½¢å®¹è¯ï¼‰\n4. "é†‡åš"ã€"å†°å†·" â†’ åˆ é™¤ï¼ˆåˆ é™¤éå¿…è¦å½¢å®¹è¯ï¼‰\n5. "å……æ»¡äº†æ¯«æ— é˜²å¤‡çš„ã€è‡´å‘½çš„è¯±æƒ‘" â†’ åˆ é™¤ï¼ˆç¦æ­¢æŠ½è±¡æè¿°ï¼‰\n6. "ä¸€é˜µ" â†’ "é—»åˆ°"ï¼ˆåˆ é™¤"ä¸€"+é‡è¯å¥å¼ï¼‰\n\n\n## ğŸ¯ è¾“å‡ºè¦æ±‚\n\n1. **ä¿æŒæ®µè½æ•°é‡**ï¼šè¾“å…¥æœ‰å‡ æ®µï¼Œè¾“å‡ºä¹Ÿåº”è¯¥æœ‰å‡ æ®µ\n2. **ä¿æŒä¿¡æ¯é‡**ï¼šæ‰€æœ‰é‡è¦ä¿¡æ¯éƒ½è¦ä¿ç•™ï¼Œä¸è¦è¿‡åº¦åˆ å‡\n3. **ä¸¥æ ¼åº”ç”¨åå…«è‚¡è§„åˆ™**ï¼š\n   - åˆ é™¤æ‰€æœ‰ç¦æ­¢çš„è¯æ±‡ï¼ˆæ¨¡ç³Šè¯ã€æ¯”å–»è¯ã€å¼ºè°ƒè¯ç­‰ï¼‰\n   - åˆ é™¤æ‰€æœ‰ç¦æ­¢çš„æå†™ï¼ˆçœ¼ç¥ã€å£°éŸ³ã€å¿ƒç†ã€æ°”æ°›ç­‰ï¼‰\n   - åˆ é™¤æ‰€æœ‰æ ¼ä¸»è¯­ï¼ˆ"å¥¹çš„"ã€"ä»–çš„"ï¼‰\n   - ç”¨è¡Œä¸ºæˆ–å¯¹ç™½ä»£æ›¿å¿ƒç†æå†™\n   - å¯¹ç™½ä¸åŠ ä»»ä½•è¡¥å……è¯´æ˜\n4. **ä¿æŒè‡ªç„¶**ï¼šåˆ é™¤åçš„æ–‡æœ¬åº”è¯¥è¯»èµ·æ¥è‡ªç„¶æµç•…ï¼Œä¸ç”Ÿç¡¬\n5. **åªåˆ å…«è‚¡è¯**ï¼šåªé’ˆå¯¹æ€§åœ°åˆ é™¤ä¸Šè¿°ç¦ç”¨è¯ï¼Œä¸è¦å¤§èŒƒå›´åˆ å‡\n6. **ç›´æ¥è¾“å‡º**ï¼šä¸è¦æ·»åŠ ä»»ä½•è§£é‡Šæˆ–è¯´æ˜\n\nè¯·æŒ‰ç…§ä»¥ä¸Šæ ‡å‡†æ¸…ç†æ–‡æœ¬ï¼Œ**ç‰¹åˆ«æ³¨æ„ä¸è¦è¿‡åº¦åˆ å‡å†…å®¹**ã€‚'},{role:'user',content:o.value}]};let n;if(c.value)n=await re(e,g);else{const a=(0,l.normalizeApiEndpoint)(t.value.api_endpoint),o=await fetch(a,{method:'POST',headers:{'Content-Type':'application/json',Authorization:`Bearer ${t.value.api_key}`},body:JSON.stringify(e)});if(!o.ok)throw new Error(`HTTP error! status: ${o.status}`);n=(await o.json()).choices[0].message.content.trim(),g.value=100}r.value=n,G(),window.toastr.success('æ–‡æœ¬æ¸…ç†å®Œæˆï¼')}catch(e){console.error('åå…«è‚¡æ¸…ç†å¤±è´¥:',e),window.toastr.error('æ¸…ç†å¤±è´¥ï¼š'+e.message)}finally{s.value=!1,g.value=0}else window.toastr.warning('è¯·è¾“å…¥éœ€è¦æ¸…ç†çš„æ–‡æœ¬')},K=()=>{r.value?(0,d.lW)(r.value,'æ¸…ç†ç»“æœå·²å¤åˆ¶åˆ°å‰ªè´´æ¿'):window.toastr.warning('æ²¡æœ‰å¯å¤åˆ¶çš„å†…å®¹')},X=async()=>{if(u.value.trim())if(r.value)try{m.value=!0,g.value=0,window.toastr.info('AIæ­£åœ¨ä¿®æ”¹...','åå…«è‚¡ä¿®æ”¹',{timeOut:15e3});const e={model:t.value.model,max_tokens:t.value.max_tokens||8e3,temperature:.7,stream:c.value,messages:[{role:'system',content:'ä½ æ˜¯ä¸€ä¸ªæ–‡æœ¬ç¼–è¾‘åŠ©æ‰‹ã€‚æ ¹æ®ç”¨æˆ·çš„ä¿®æ”¹éœ€æ±‚ï¼Œå¯¹æä¾›çš„æ–‡æœ¬è¿›è¡Œä¿®æ”¹ã€‚ç›´æ¥è¾“å‡ºä¿®æ”¹åçš„ç»“æœï¼Œä¸è¦æ·»åŠ ä»»ä½•è§£é‡Šæˆ–è¯´æ˜ã€‚'},{role:'user',content:`å½“å‰æ–‡æœ¬ï¼š\n${r.value}\n\nä¿®æ”¹éœ€æ±‚ï¼š${u.value}`}]};let n;if(c.value)n=await re(e,g);else{const a=(0,l.normalizeApiEndpoint)(t.value.api_endpoint),o=await fetch(a,{method:'POST',headers:{'Content-Type':'application/json',Authorization:`Bearer ${t.value.api_key}`},body:JSON.stringify(e)});if(!o.ok)throw new Error(`HTTP error! status: ${o.status}`);n=(await o.json()).choices[0].message.content.trim(),g.value=100}r.value=n,G(),window.toastr.success('ä¿®æ”¹å®Œæˆï¼')}catch(e){console.error('åå…«è‚¡ä¿®æ”¹å¤±è´¥:',e),window.toastr.error('ä¿®æ”¹å¤±è´¥ï¼š'+e.message)}finally{m.value=!1,g.value=0}else window.toastr.warning('æ²¡æœ‰å¯ä¿®æ”¹çš„å†…å®¹');else window.toastr.warning('è¯·è¾“å…¥ä¿®æ”¹éœ€æ±‚')},Q=()=>{u.value='',G(),window.toastr.success('ä¿®æ”¹éœ€æ±‚å·²æ¸…ç©º')},Z=async()=>{if(f.value.trim())try{h.value=!0,k.value=0,window.toastr.info('AIæ­£åœ¨ç”Ÿæˆè§’è‰²å¡ï¼Œè¯·ç¨å€™...');const e={model:t.value.model||'gpt-3.5-turbo',max_tokens:t.value.max_tokens||16e3,temperature:.8,stream:w.value,messages:[{role:'system',content:'ä½ æ˜¯ä¸€ä¸ªè§’è‰²å¡ç”ŸæˆåŠ©æ‰‹ã€‚è¯·ç³»ç»Ÿæ€§åœ°åˆ›å»ºä¸€ä¸ªå®Œæ•´çš„è§’è‰²å¡ã€‚\n\n**è¾“å‡ºæ ¼å¼è¦æ±‚**ï¼š\n- å¿…é¡»ä½¿ç”¨ YAML æ ¼å¼ï¼Œæ‰€æœ‰å­—æ®µåå’Œå†…å®¹éƒ½ç”¨ä¸­æ–‡\n- ç¡®ä¿è¾“å‡ºå®Œæ•´ï¼Œä¸è¦æˆªæ–­\n- é¿å…AIåˆ»æ¿åŒ–ï¼Œè¦æœ‰å¤šæ ·æ€§å’ŒçœŸå®æ„Ÿ\n- ä¸¥æ ¼é¿å…ä»»ä½•AIæŒ‡ä»¤å¼è¯­è¨€\n\n**è§’è‰²å¡ç»“æ„æ¨¡æ¿**ï¼š\n```yaml\nåŸºç¡€ä¿¡æ¯:\n  å§“å: "å…¨å"\n  å¹´é¾„: å…·ä½“å¹´é¾„\n  å‡ºç”Ÿå¹´æœˆ: "YYYYå¹´MMæœˆ"\n  æ€§åˆ«: "ç”·/å¥³/å…¶ä»–"\n  ç¬¬äºŒæ€§åˆ«: "Alpha/Beta/Omega/æ— "\n  èº«é«˜ä½“é‡: "èº«é«˜ç”¨æ–‡å­—æè¿°ï¼ˆé«˜å¤§/ä¸­ç­‰/å¨‡å°ç­‰ï¼‰ï¼Œä½“é‡ç”¨æ–‡å­—æè¿°ï¼ˆåŒ€ç§°/çº¤ç˜¦/ä¸°æ»¡ç­‰ï¼‰"\n  ä¿¡æ¯ç´ : "æè¿°æ°”å‘³ç‰¹å¾å’Œå˜åŒ–è§„å¾‹ï¼ˆå¦‚é€‚ç”¨ï¼‰"\n  æ€§å–å‘: "å¼‚æ€§æ‹/åŒæ€§æ‹/åŒæ€§æ‹ç­‰"\n  æ‹çˆ±ç»éªŒ: "è¯¦ç»†æè¿°"\n  èº«ä»½èŒä¸š: "å…·ä½“èŒä¸šå’Œç¤¾ä¼šåœ°ä½"\n  æ ‡å¿—æ€§ç‰¹å¾:\n    å¾®ä¿¡æ˜µç§°: "æ˜µç§°"\n    å¤´åƒ: "æè¿°"\n    å…¶ä»–: "å…¶ä»–æ ‡å¿—æ€§ç‰¹å¾"\n\nå¤–è²Œä¸èº«æ:\n  æ•´ä½“èº«å½¢: "é«˜çŸ®èƒ–ç˜¦ã€è‚Œè‚‰ç±»å‹çš„è¯¦ç»†æè¿°"\n  é¢å®¹ç‰¹å¾:\n    å‘å‹: "å‘å‹ã€å‘è‰²ã€å‘è´¨"\n    è‚¤è‰²: "è‚¤è‰²æè¿°"\n    çœ¼ç›: "çœ¼ç›é¢œè‰²å’Œç‰¹å¾"\n    äº”å®˜: "äº”å®˜ç‰¹ç‚¹"\n  ç©¿æ­é£æ ¼: "æ—¥å¸¸ç©¿æ­åå¥½å’Œé£æ ¼"\n  å£°éŸ³ç‰¹å¾: "éŸ³è‰²ã€éŸ³è°ƒã€è¯´è¯èŠ‚å¥"\n  ä¹ æƒ¯æ€§åŠ¨ä½œ: "å¸¸è§çš„å§¿æ€å’Œå°åŠ¨ä½œ"\n\næ€§æ ¼ä¸å¿ƒç†:\n  ä¸»è¦æ€§æ ¼ç‰¹å¾:\n    - ç‰¹è´¨1: "å…·ä½“è¡¨ç°å’Œè¡Œä¸ºæ¨¡å¼"\n    - ç‰¹è´¨2: "å…·ä½“è¡¨ç°å’Œè¡Œä¸ºæ¨¡å¼"\n    - ç‰¹è´¨3: "å…·ä½“è¡¨ç°å’Œè¡Œä¸ºæ¨¡å¼"\n  æ€§æ ¼çš„ä¸¤é¢æ€§: "åœ¨ä¸åŒæƒ…å†µä¸‹å±•ç°çš„ä¸åŒä¾§é¢ï¼ˆä¾‹å¦‚ï¼šå¹³æ—¶æ¸©å’Œä½†è§¦åŠåº•çº¿æ—¶å¼ºç¡¬ï¼‰"\n  æƒ…ç»ªæ¨¡å¼:\n    å¸¸è§æƒ…ç»ª: "æ—¥å¸¸ä¸»è¦æƒ…ç»ªçŠ¶æ€"\n    æƒ…ç»ªè§¦å‘ç‚¹: "ä»€ä¹ˆå®¹æ˜“å¼•å‘æƒ…ç»ªæ³¢åŠ¨"\n    æƒ…ç»ªè¡¨è¾¾æ–¹å¼: "å¦‚ä½•è¡¨ç°å’Œå¤„ç†æƒ…ç»ª"\n  åº”å¯¹å‹åŠ›: "é¢å¯¹å‹åŠ›å’Œå›°å¢ƒæ—¶çš„ååº”å’Œå¤„ç†æ–¹å¼"\n\nå¯¹è¯é£æ ¼:\n  æ—¥å¸¸è¯­æ°”: "ç”¨è¯ä¹ æƒ¯å’Œè¯´è¯ç‰¹ç‚¹"\n  å¯¹ä¸åŒå¯¹è±¡:\n    äº²è¿‘çš„äºº: "è¯´è¯æ–¹å¼"\n    é™Œç”Ÿäºº: "è¯´è¯æ–¹å¼"\n    å·¥ä½œåœºåˆ: "è¯´è¯æ–¹å¼"\n  æƒ…ç»ªå˜åŒ–æ—¶: "æƒ…ç»ªæ¿€åŠ¨/ä½è½æ—¶çš„è¯­è¨€å˜åŒ–"\n  å£å¤´ç¦…: ["å£å¤´ç¦…1", "å£å¤´ç¦…2"]\n\nèƒŒæ™¯ç»å†:\n  å®¶åº­èƒŒæ™¯: "è¯¦ç»†çš„å®¶åº­ç¯å¢ƒå’Œæˆé•¿èƒŒæ™¯"\n  æ•™è‚²ç»å†: "å­¦ä¹ ç»å†"\n  é‡è¦äººç”Ÿäº‹ä»¶: ["äº‹ä»¶1", "äº‹ä»¶2", "äº‹ä»¶3"]\n  å…³é”®è½¬æŠ˜ç‚¹: "æ”¹å˜TAçš„é‡è¦äº‹ä»¶"\n  å½“å‰çŠ¶å†µ: "ç°åœ¨çš„ç”Ÿæ´»çŠ¶æ€"\n  äººç”Ÿç›®æ ‡: "TAæƒ³è¦è¾¾æˆçš„ç›®æ ‡"\n\näººé™…å…³ç³»:\n  å¯¹ä¸»è¦è§’è‰²çš„æ€åº¦: "ä¸{{user}}æˆ–å…¶ä»–é‡è¦è§’è‰²çš„äº’åŠ¨æ¨¡å¼"\n  ç¤¾äº¤åå¥½: "å–œæ¬¢çš„ç¤¾äº¤æ–¹å¼å’Œè¾¹ç•Œ"\n  ç¾¤ä½“è§’è‰²: "åœ¨å›¢é˜Ÿä¸­çš„å®šä½ï¼ˆé¢†å¯¼è€…/åè°ƒè€…/è§‚å¯Ÿè€…ç­‰ï¼‰"\n  å†²çªå¤„ç†: "å¦‚ä½•å¤„ç†çŸ›ç›¾å’Œå†²çª"\n\nè¡Œä¸ºæ¨¡å¼ä¸åŠ¨æœº:\n  å…¸å‹è¡Œä¸º:\n    ä¸»åŠ¨å€¾å‘: "TAå€¾å‘äºä¸»åŠ¨åšä»€ä¹ˆäº‹æƒ…"\n    å›é¿å€¾å‘: "TAä¼šé¿å…æˆ–æ‹’ç»åšä»€ä¹ˆ"\n    ä¹ æƒ¯ååº”: "åœ¨ç‰¹å®šæƒ…å†µä¸‹çš„å…¸å‹ååº”"\n  åº•çº¿ä¸åŸåˆ™: "TAåšå®ˆçš„åŸåˆ™å’Œä¸å¯è§¦ç¢°çš„åº•çº¿"\n  å†…åœ¨åŠ¨æœº:\n    è¡ŒåŠ¨é©±åŠ¨: "æ¨åŠ¨TAè¡ŒåŠ¨çš„å†…åœ¨åŸå› "\n    æ·±å±‚éœ€æ±‚: "TAå†…å¿ƒçœŸæ­£æ¸´æœ›çš„æ˜¯ä»€ä¹ˆ"\n    éšè—æƒ³æ³•: "TAä¸è½»æ˜“è¡¨éœ²çš„çœŸå®æƒ³æ³•"\n  æƒ…ç»ªç®¡ç†:\n    å¤±æ§è¾¹ç•Œ: "ä»€ä¹ˆæƒ…å†µä¸‹ä¼šæƒ…ç»ªå¤±æ§"\n    æ¢å¤æ–¹å¼: "å¦‚ä½•å¹³å¤æƒ…ç»ªå’Œè‡ªæˆ‘è°ƒèŠ‚"\n```\n\nè¯·åŸºäºç”¨æˆ·çš„æè¿°ï¼Œç”Ÿæˆä¸€ä¸ªå®Œæ•´ã€ç«‹ä½“ã€çœŸå®çš„è§’è‰²ã€‚æ³¨æ„ï¼š\n1. èº«é«˜ä½“é‡å¿…é¡»ç”¨æ–‡å­—æè¿°ï¼Œä¸è¦ç”¨æ•°å­—å’Œå•ä½\n2. æ€§æ ¼è¦å±•ç°å¤šé¢æ€§å’Œå¤æ‚æ€§ï¼Œé¿å…å•ä¸€åŒ–å’Œåˆ»æ¿å°è±¡\n3. è¡Œä¸ºæ¨¡å¼è¦ä»è§’è‰²è§†è§’å‡ºå‘ï¼Œæè¿°TAä¼šå¦‚ä½•æ€è€ƒå’Œè¡ŒåŠ¨\n4. æ‰€æœ‰å†…å®¹è¦è¯¦ç»†ä¸°å¯Œï¼Œæœ‰å…·ä½“ä¾‹å­å’Œåœºæ™¯'},{role:'user',content:f.value}]};let n;if(w.value)n=await re(e,k);else{const a=(0,l.normalizeApiEndpoint)(t.value.api_endpoint),o=await fetch(a,{method:'POST',headers:{'Content-Type':'application/json',Authorization:`Bearer ${t.value.api_key}`},body:JSON.stringify(e)});if(!o.ok)throw new Error(`HTTP error! status: ${o.status}`);n=(await o.json()).choices[0].message.content.trim(),k.value=100}x.value=n,G(),window.toastr.success('è§’è‰²å¡ç”Ÿæˆå®Œæˆï¼')}catch(e){console.error('è§’è‰²å¡ç”Ÿæˆå¤±è´¥:',e),window.toastr.error('ç”Ÿæˆå¤±è´¥ï¼š'+e.message)}finally{h.value=!1,k.value=0}else window.toastr.warning('è¯·è¾“å…¥è§’è‰²æè¿°')},ee=()=>{f.value='',x.value='',y.value='',G(),window.toastr.success('å†…å®¹å·²æ¸…ç©º')},ne=()=>{x.value?(0,d.lW)(x.value,'è§’è‰²å¡å·²å¤åˆ¶åˆ°å‰ªè´´æ¿'):window.toastr.warning('æ²¡æœ‰å¯å¤åˆ¶çš„å†…å®¹')},te=()=>{o.value='',r.value='',G(),window.toastr.success('å†…å®¹å·²æ¸…ç©º')},ae=async()=>{if(y.value.trim())if(x.value)try{v.value=!0,k.value=0,window.toastr.info('AIæ­£åœ¨æ ¹æ®ä½ çš„éœ€æ±‚ä¿®æ”¹è§’è‰²å¡ï¼Œè¯·ç¨å€™...');const e={model:t.value.model||'gpt-3.5-turbo',max_tokens:t.value.max_tokens||16e3,temperature:.8,stream:w.value,messages:[{role:'system',content:'ä½ æ˜¯ä¸€ä¸ªè§’è‰²å¡ç¼–è¾‘åŠ©æ‰‹ã€‚ç”¨æˆ·ä¼šæä¾›ä¸€ä¸ªç°æœ‰çš„ YAML æ ¼å¼è§’è‰²å¡å’Œä¿®æ”¹éœ€æ±‚ï¼Œè¯·æ ¹æ®ä¿®æ”¹éœ€æ±‚è°ƒæ•´è§’è‰²å¡å†…å®¹ã€‚\n\n**ä¿®æ”¹åŸåˆ™**ï¼š\n1. å¿…é¡»ä¿æŒ YAML æ ¼å¼ï¼Œæ‰€æœ‰å­—æ®µåå’Œå†…å®¹éƒ½ä½¿ç”¨ä¸­æ–‡\n2. åªä¿®æ”¹ç”¨æˆ·æ˜ç¡®è¦æ±‚ä¿®æ”¹çš„éƒ¨åˆ†\n3. ç¡®ä¿ä¿®æ”¹åçš„å†…å®¹ä¸åŸæœ‰è§’è‰²å¡é£æ ¼ä¸€è‡´\n4. å¦‚æœç”¨æˆ·çš„è¦æ±‚ä¸åŸæœ‰è®¾å®šå†²çªï¼Œä»¥ç”¨æˆ·çš„è¦æ±‚ä¸ºå‡†\n5. è¾“å‡ºå®Œæ•´çš„ä¿®æ”¹åçš„è§’è‰²å¡ï¼Œä¸è¦æˆªæ–­\n6. ä¿æŒåŸæœ‰çš„å­—æ®µç»“æ„ï¼Œé™¤éç”¨æˆ·è¦æ±‚æ·»åŠ æˆ–åˆ é™¤å­—æ®µ\n\n**é‡è¦æ³¨æ„äº‹é¡¹**ï¼š\n- èº«é«˜ä½“é‡å¿…é¡»ç”¨æ–‡å­—æè¿°ï¼ˆé«˜å¤§/ä¸­ç­‰/å¨‡å°/åŒ€ç§°/çº¤ç˜¦ç­‰ï¼‰ï¼Œä¸è¦ç”¨æ•°å­—å’Œå•ä½\n- ä¿æŒæ€§æ ¼çš„å¤šé¢æ€§å’Œå¤æ‚æ€§ï¼Œé¿å…å•ä¸€åŒ–\n- è¡Œä¸ºæ¨¡å¼è¦ä»è§’è‰²è§†è§’å‡ºå‘ï¼Œæè¿°è§’è‰²ä¼šå¦‚ä½•æ€è€ƒå’Œè¡ŒåŠ¨\n- é¿å…AIåˆ»æ¿åŒ–ï¼Œä¿æŒè§’è‰²çš„çœŸå®æ„Ÿå’Œå¤šæ ·æ€§\n\nè¯·è¾“å‡ºå®Œæ•´çš„ YAML æ ¼å¼è§’è‰²å¡ã€‚'},{role:'user',content:`ä»¥ä¸‹æ˜¯ç°æœ‰çš„è§’è‰²å¡ï¼š\n\n${x.value}\n\n---\n\nè¯·æ ¹æ®ä»¥ä¸‹ä¿®æ”¹éœ€æ±‚è°ƒæ•´è§’è‰²å¡ï¼š\n${y.value}`}]};let n;if(w.value)n=await re(e,k);else{const a=(0,l.normalizeApiEndpoint)(t.value.api_endpoint),o=await fetch(a,{method:'POST',headers:{'Content-Type':'application/json',Authorization:`Bearer ${t.value.api_key}`},body:JSON.stringify(e)});if(!o.ok)throw new Error(`HTTP error! status: ${o.status}`);n=(await o.json()).choices[0].message.content.trim(),k.value=100}x.value=n,y.value='',G(),window.toastr.success('è§’è‰²å¡ä¿®æ”¹å®Œæˆï¼')}catch(e){console.error('è§’è‰²å¡ä¿®æ”¹å¤±è´¥:',e),window.toastr.error('ä¿®æ”¹å¤±è´¥ï¼š'+e.message)}finally{v.value=!1,k.value=0}else window.toastr.warning('æ²¡æœ‰å¯ä¿®æ”¹çš„è§’è‰²å¡ï¼Œè¯·å…ˆç”Ÿæˆè§’è‰²å¡');else window.toastr.warning('è¯·è¾“å…¥ä¿®æ”¹éœ€æ±‚')},oe=()=>{y.value='',G(),window.toastr.success('ä¿®æ”¹éœ€æ±‚å·²æ¸…ç©º')},re=async(e,n)=>{const a=(0,l.normalizeApiEndpoint)(t.value.api_endpoint),o=await fetch(a,{method:'POST',headers:{'Content-Type':'application/json',Authorization:`Bearer ${t.value.api_key}`},body:JSON.stringify(e)});if(!o.ok){const e=await o.text();throw new Error(`æµå¼è¯·æ±‚å¤±è´¥ï¼š${o.status} ${o.statusText}\n${e.slice(0,400)}`)}if(!o.body)throw new Error('è¯¥ API æœªè¿”å›å¯è¯»æµï¼Œè¯·å…³é—­æµå¼æ¨¡å¼æˆ–æ£€æŸ¥ç«¯ç‚¹æ”¯æŒæƒ…å†µ');const r=o.body.getReader(),s=new TextDecoder('utf-8');let i='',d=!1,c='';n.value=0;const p=e=>{const t=e.trim();if(!t)return!1;if('data: [DONE]'===t||'[DONE]'===t)return!0;const a=t.startsWith('data:')?t.slice(5).trim():t;if(!a||'[DONE]'===a)return!1;try{const e=JSON.parse(a),t=(o=e,o.choices?.[0]?.delta?.content?o.choices[0].delta.content:o.delta?.text?o.delta.text:'string'==typeof o.content?o.content:'string'==typeof o.text?o.text:'string'==typeof o.response?o.response:null);t&&(c+=t,n.value=Math.min(n.value+2,98))}catch(e){console.warn('æ— æ³•è§£ææµå¼æ•°æ®å—:',a.slice(0,100),e)}var o;return!1};for(;!d;){const{value:e,done:n}=await r.read();if(e){i+=s.decode(e,{stream:!0});const n=i.split('\n');i=n.pop()??'';for(const e of n)if(p(e)){d=!0;break}}n&&(d=!0)}return i&&!d&&p(i),n.value=100,c},se=async()=>{if(A.value.trim())try{E.value=!0,M.value=0,window.toastr.info('AIæ­£åœ¨ç”Ÿæˆä¸–ç•Œä¹¦æ¡ç›®ï¼Œè¯·ç¨å€™...','',{timeOut:15e3});const e={model:t.value.model||'gpt-3.5-turbo',max_tokens:t.value.max_tokens||4e3,temperature:.7,stream:B.value,messages:[{role:'system',content:'ä½ æ˜¯ä¸€ä¸ªä¸–ç•Œä¹¦æ¡ç›®ç”ŸæˆåŠ©æ‰‹ã€‚ç”¨æˆ·ä¼šæè¿°ä»–ä»¬æƒ³è¦çš„ä¸–ç•Œä¹¦æ¡ç›®å†…å®¹ï¼Œä½ éœ€è¦ç”Ÿæˆç¬¦åˆ SillyTavern ä¸–ç•Œä¹¦æ ¼å¼çš„ JSON æ•°æ®ã€‚\n\n**ä¸–ç•Œä¹¦æ¡ç›®çš„ç»“æ„**ï¼š\n```typescript\n{\n  "name": "æ¡ç›®åç§°",\n  "enabled": true,\n  "strategy": {\n    "type": "selective",  // "constant"(è“ç¯-å¸¸é‡) æˆ– "selective"(ç»¿ç¯-å¯é€‰é¡¹)\n    "keys": ["å…³é”®å­—1", "å…³é”®å­—2"],  // ä¸»è¦å…³é”®å­—æ•°ç»„\n    "keys_secondary": {\n      "logic": "and_any",  // "and_any" | "and_all" | "not_all" | "not_any"\n      "keys": []  // æ¬¡è¦å…³é”®å­—æ•°ç»„ï¼Œé€šå¸¸ç•™ç©º\n    },\n    "scan_depth": "same_as_global"  // æˆ–è€…å…·ä½“æ•°å­—å¦‚ 10\n  },\n  "position": {\n    "type": "after_character_definition",  // å¸¸è§: "after_character_definition" | "at_depth"\n    "role": "system",  // "system" | "assistant" | "user"\n    "depth": 4,\n    "order": 100\n  },\n  "content": "æ¡ç›®çš„å®é™…å†…å®¹æ–‡æœ¬",\n  "probability": 100,  // æ¿€æ´»æ¦‚ç‡ï¼Œé€šå¸¸æ˜¯ 100\n  "recursion": {\n    "prevent_incoming": false,\n    "prevent_outgoing": false,\n    "delay_until": null\n  },\n  "effect": {\n    "sticky": null,\n    "cooldown": null,\n    "delay": null\n  }\n}\n```\n\n**ç”ŸæˆåŸåˆ™**ï¼š\n1. **åç§° (name)**ï¼šç®€æ´æ˜ç¡®ï¼Œåæ˜ æ¡ç›®ä¸»é¢˜ï¼ˆå¦‚è§’è‰²åã€åœ°ç‚¹åã€ç‰©å“åï¼‰\n2. **æ¿€æ´»ç­–ç•¥ (strategy.type)**ï¼š\n   - å¦‚æœæ˜¯éœ€è¦æ ¹æ®å…³é”®å­—æ¿€æ´»çš„å†…å®¹ï¼ˆå¦‚è§’è‰²ã€åœ°ç‚¹ã€ç‰©å“ï¼‰ï¼Œä½¿ç”¨ "selective" (ç»¿ç¯)\n   - å¦‚æœæ˜¯åº”è¯¥å§‹ç»ˆç”Ÿæ•ˆçš„è®¾å®šï¼ˆå¦‚ä¸–ç•Œè§‚è§„åˆ™ã€åŸºç¡€è®¾å®šï¼‰ï¼Œä½¿ç”¨ "constant" (è“ç¯)\n3. **å…³é”®å­— (strategy.keys)**ï¼š\n   - æå–ä¸å†…å®¹ç›¸å…³çš„æ ¸å¿ƒå…³é”®å­—\n   - åŒ…å«åç§°ã€åˆ«åã€ç›¸å…³æ¦‚å¿µ\n   - é€šå¸¸ 3-6 ä¸ªå…³é”®å­—\n4. **å†…å®¹ (content)**ï¼š\n   - **åŠ¡å¿…åŒ…å«ç”¨æˆ·æä¾›çš„æ‰€æœ‰è¯¦ç»†ä¿¡æ¯**\n   - ç»“æ„åŒ–ã€ç®€æ´ã€ä¿¡æ¯å¯†åº¦é«˜\n   - ä½¿ç”¨é™ˆè¿°å¼è‚¯å®šè¯­å¥ï¼Œé¿å…å…«è‚¡ä¿®è¾\n   - å¦‚æœç”¨æˆ·æä¾›äº†å…·ä½“è®¾å®šï¼ˆå¹´é¾„ã€æ€§åˆ«ã€èŒä¸šã€å®¶åº­èƒŒæ™¯ç­‰ï¼‰ï¼Œ**å¿…é¡»å…¨éƒ¨ä½“ç°åœ¨ content ä¸­**\n   - å¯ä»¥é€‚å½“è¡¥å……åˆç†çš„ç»†èŠ‚ï¼Œä½†**ä¸èƒ½é—æ¼ç”¨æˆ·æ˜ç¡®æä¾›çš„ä¿¡æ¯**\n5. **ä½ç½® (position.type)**ï¼š\n   - é€šå¸¸ä½¿ç”¨ "after_character_definition"ï¼ˆåœ¨è§’è‰²å®šä¹‰ä¹‹åï¼‰\n   - ç‰¹æ®Šæƒ…å†µå¯ä½¿ç”¨ "at_depth" æŒ‡å®šæ·±åº¦\n6. **å…¶ä»–å­—æ®µä¿æŒé»˜è®¤å€¼å³å¯**\n\n**ç¤ºä¾‹ 1ï¼šè§’è‰²æ¡ç›®**\nç”¨æˆ·æè¿°ï¼š"åˆ›å»ºè§’è‰²ã€æ—æ½œã€‘çš„æ¡ç›®ï¼Œ16å²ï¼Œç”·ï¼Œé«˜ä¸­ç”Ÿï¼Œæ™®é€šå®¶åº­"\nè¾“å‡ºï¼š\n```json\n{\n  "name": "æ—æ½œ",\n  "enabled": true,\n  "strategy": {\n    "type": "selective",\n    "keys": ["æ—æ½œ", "æ—", "æ½œ"],\n    "keys_secondary": { "logic": "and_any", "keys": [] },\n    "scan_depth": "same_as_global"\n  },\n  "position": {\n    "type": "after_character_definition",\n    "role": "system",\n    "depth": 4,\n    "order": 100\n  },\n  "content": "æ—æ½œï¼Œç”·æ€§ï¼Œ16å²ï¼Œç›®å‰å°±è¯»é«˜ä¸­ã€‚å‡ºèº«äºæ™®é€šå®¶åº­ï¼Œå®¶åº­ç»æµçŠ¶å†µä¸­ç­‰ã€‚æ€§æ ¼è¾ƒä¸ºå†…å‘ï¼Œåœ¨å­¦æ ¡æˆç»©ä¸­ç­‰åä¸Šã€‚å¹³æ—¶å–œæ¬¢ç‹¬è‡ªæ€è€ƒï¼Œä¸å¤ªæ“…é•¿ä¸äººäº¤é™…ã€‚",\n  "probability": 100,\n  "recursion": {\n    "prevent_incoming": false,\n    "prevent_outgoing": false,\n    "delay_until": null\n  },\n  "effect": {\n    "sticky": null,\n    "cooldown": null,\n    "delay": null\n  }\n}\n```\n\n**ç¤ºä¾‹ 2ï¼šåœ°ç‚¹æ¡ç›®**\nç”¨æˆ·æè¿°ï¼š"åˆ›å»ºä¸€ä¸ªå…³äºé­”æ³•å­¦é™¢çš„æ¡ç›®ï¼ŒåŒ…å«å­¦é™¢å†å²å’Œè§„åˆ™"\nè¾“å‡ºï¼š\n```json\n{\n  "name": "æ˜Ÿè¾‰é­”æ³•å­¦é™¢",\n  "enabled": true,\n  "strategy": {\n    "type": "selective",\n    "keys": ["æ˜Ÿè¾‰é­”æ³•å­¦é™¢", "é­”æ³•å­¦é™¢", "å­¦é™¢", "æ˜Ÿè¾‰"],\n    "keys_secondary": { "logic": "and_any", "keys": [] },\n    "scan_depth": "same_as_global"\n  },\n  "position": {\n    "type": "after_character_definition",\n    "role": "system",\n    "depth": 4,\n    "order": 100\n  },\n  "content": "æ˜Ÿè¾‰é­”æ³•å­¦é™¢æ˜¯ä¸€æ‰€å†å²æ‚ ä¹…çš„é­”æ³•æ•™è‚²æœºæ„ï¼Œå»ºç«‹äºä¸‰ç™¾å¹´å‰ã€‚å­¦é™¢åè½åœ¨æµ®ç©ºå²›ä¸Šï¼Œå…±æœ‰ä¸ƒåº§é«˜å¡”ï¼Œåˆ†åˆ«å¯¹åº”ä¸ƒå¤§é­”æ³•æµæ´¾ï¼šå…ƒç´ ã€å¿ƒçµã€è½¬åŒ–ã€å¬å”¤ã€é¢„è¨€ã€é˜²æŠ¤ã€å¹»æœ¯ã€‚å­¦é™¢å®è¡Œå­¦åˆ†åˆ¶ï¼Œå­¦ç”Ÿéœ€è¦å®ŒæˆåŸºç¡€è¯¾ç¨‹å’Œä¸“ç²¾è¯¾ç¨‹æ‰èƒ½æ¯•ä¸šã€‚å­¦é™¢è§„åˆ™ä¸¥æ ¼ï¼šç¦æ­¢åœ¨æ•™å­¦åŒºåŸŸæ–½å±•æœªç»è®¸å¯çš„é­”æ³•ï¼Œç¦æ­¢æ“…è‡ªè¿›å…¥ç¦ä¹¦åŒºï¼Œç¦æ­¢ç§ä¸‹å†³æ–—ã€‚",\n  "probability": 100,\n  "recursion": {\n    "prevent_incoming": false,\n    "prevent_outgoing": false,\n    "delay_until": null\n  },\n  "effect": {\n    "sticky": null,\n    "cooldown": null,\n    "delay": null\n  }\n}\n```\n\n**é‡è¦**ï¼š\n- åªè¾“å‡º JSON æ•°æ®ï¼Œä¸è¦æ·»åŠ ä»»ä½•è§£é‡Š\n- ç¡®ä¿ JSON æ ¼å¼æ­£ç¡®ï¼Œå¯ä»¥è¢«è§£æ\n- **content å­—æ®µå¿…é¡»åŒ…å«ç”¨æˆ·æä¾›çš„æ‰€æœ‰è¯¦ç»†ä¿¡æ¯ï¼Œä¸èƒ½é—æ¼**\n- å¦‚æœç”¨æˆ·ç»™å‡ºäº†å¤šä¸ªå±æ€§ï¼ˆå¹´é¾„ã€æ€§åˆ«ã€èŒä¸šç­‰ï¼‰ï¼Œæ¯ä¸ªéƒ½è¦åœ¨ content ä¸­æ˜ç¡®ä½“ç°\n- æ ¹æ®ç”¨æˆ·æè¿°çš„å†…å®¹ç±»å‹ï¼Œæ™ºèƒ½é€‰æ‹© strategy.type'},{role:'user',content:A.value}]};let n;if(B.value)n=await re(e,M);else{const a=(0,l.normalizeApiEndpoint)(t.value.api_endpoint),o=await fetch(a,{method:'POST',headers:{'Content-Type':'application/json',Authorization:`Bearer ${t.value.api_key}`},body:JSON.stringify(e)});if(!o.ok)throw new Error(`HTTP error! status: ${o.status}`);n=(await o.json()).choices[0].message.content.trim(),M.value=100}try{const e=(n.match(/```(?:json)?\s*([\s\S]*?)```/)||[null,n])[1]||n,t=JSON.parse(e);C.value=t,G(),window.toastr.success('ä¸–ç•Œä¹¦æ¡ç›®ç”Ÿæˆå®Œæˆï¼')}catch(e){console.error('JSON è§£æå¤±è´¥:',e),console.log('åŸå§‹å“åº”:',n),window.toastr.error('ç”Ÿæˆçš„å†…å®¹æ ¼å¼é”™è¯¯ï¼Œè¯·é‡è¯•')}}catch(e){console.error('ä¸–ç•Œä¹¦æ¡ç›®ç”Ÿæˆå¤±è´¥:',e),window.toastr.error('ç”Ÿæˆå¤±è´¥ï¼š'+e.message)}finally{E.value=!1,M.value=0}else window.toastr.warning('è¯·è¾“å…¥æ¡ç›®æè¿°')},ie=()=>{A.value='',C.value=null,S.value='',I.value='',G(),window.toastr.success('å†…å®¹å·²æ¸…ç©º')},le=async()=>{if(S.value)if(C.value)try{N.value=!0,window.toastr.info(`æ­£åœ¨æ’å…¥æ¡ç›®åˆ°ã€Œ${S.value}ã€...`),await createWorldbookEntries(S.value,[C.value],{render:'immediate'}),window.toastr.success(`âœ… æ¡ç›®å·²æˆåŠŸæ’å…¥åˆ°ã€Œ${S.value}ã€`)}catch(e){console.error('æ’å…¥æ¡ç›®å¤±è´¥:',e),window.toastr.error('æ’å…¥å¤±è´¥ï¼š'+e.message)}finally{N.value=!1}else window.toastr.warning('æ²¡æœ‰å¯æ’å…¥çš„æ¡ç›®');else window.toastr.warning('è¯·é€‰æ‹©ç›®æ ‡ä¸–ç•Œä¹¦')},de=()=>{if(!C.value)return void window.toastr.warning('æ²¡æœ‰å¯å¤åˆ¶çš„å†…å®¹');const e=JSON.stringify(C.value,null,2);(0,d.lW)(e,'ä¸–ç•Œä¹¦æ¡ç›® JSON å·²å¤åˆ¶åˆ°å‰ªè´´æ¿')},ce=async()=>{if(I.value.trim())if(C.value)try{V.value=!0,M.value=0,window.toastr.info('AIæ­£åœ¨æ ¹æ®ä½ çš„éœ€æ±‚ä¿®æ”¹ä¸–ç•Œä¹¦æ¡ç›®ï¼Œè¯·ç¨å€™...');const e={model:t.value.model||'gpt-3.5-turbo',max_tokens:t.value.max_tokens||4e3,temperature:.7,stream:B.value,messages:[{role:'system',content:'ä½ æ˜¯ä¸€ä¸ªä¸–ç•Œä¹¦æ¡ç›®ç¼–è¾‘åŠ©æ‰‹ã€‚ç”¨æˆ·ä¼šæä¾›ä¸€ä¸ªç°æœ‰çš„ä¸–ç•Œä¹¦æ¡ç›® JSON å’Œä¿®æ”¹éœ€æ±‚ï¼Œè¯·æ ¹æ®ä¿®æ”¹éœ€æ±‚è°ƒæ•´æ¡ç›®å†…å®¹ã€‚\n\n**ä¿®æ”¹åŸåˆ™**ï¼š\n1. å¿…é¡»ä¿æŒ JSON æ ¼å¼æ­£ç¡®\n2. åªä¿®æ”¹ç”¨æˆ·æ˜ç¡®è¦æ±‚ä¿®æ”¹çš„éƒ¨åˆ†\n3. ç¡®ä¿ä¿®æ”¹åçš„å†…å®¹ä¸åŸæœ‰æ¡ç›®é£æ ¼ä¸€è‡´\n4. å¦‚æœç”¨æˆ·çš„è¦æ±‚ä¸åŸæœ‰è®¾å®šå†²çªï¼Œä»¥ç”¨æˆ·çš„è¦æ±‚ä¸ºå‡†\n5. è¾“å‡ºå®Œæ•´çš„ä¿®æ”¹åçš„ JSONï¼Œä¸è¦æˆªæ–­\n6. ä¿æŒåŸæœ‰çš„å­—æ®µç»“æ„ï¼Œé™¤éç”¨æˆ·è¦æ±‚æ·»åŠ æˆ–åˆ é™¤å­—æ®µ\n\n**é‡è¦æ³¨æ„äº‹é¡¹**ï¼š\n- å¦‚æœä¿®æ”¹å†…å®¹ (content)ï¼ŒåŠ¡å¿…åŒ…å«ç”¨æˆ·è¦æ±‚çš„æ‰€æœ‰ä¿¡æ¯\n- å¦‚æœä¿®æ”¹å…³é”®å­— (keys)ï¼Œè¦ç¡®ä¿å…³é”®å­—ä¸å†…å®¹åŒ¹é…\n- ä¿æŒæ¿€æ´»ç­–ç•¥ (strategy.type) çš„åˆç†æ€§\n- åªè¾“å‡º JSON æ•°æ®ï¼Œä¸è¦æ·»åŠ ä»»ä½•è§£é‡Š\n\nè¯·è¾“å‡ºå®Œæ•´çš„ JSON æ ¼å¼ä¸–ç•Œä¹¦æ¡ç›®ã€‚'},{role:'user',content:`ä»¥ä¸‹æ˜¯ç°æœ‰çš„ä¸–ç•Œä¹¦æ¡ç›®ï¼š\n\n${JSON.stringify(C.value,null,2)}\n\n---\n\nè¯·æ ¹æ®ä»¥ä¸‹ä¿®æ”¹éœ€æ±‚è°ƒæ•´æ¡ç›®ï¼š\n${I.value}`}]};let n;if(B.value)n=await re(e,M);else{const a=(0,l.normalizeApiEndpoint)(t.value.api_endpoint),o=await fetch(a,{method:'POST',headers:{'Content-Type':'application/json',Authorization:`Bearer ${t.value.api_key}`},body:JSON.stringify(e)});if(!o.ok)throw new Error(`HTTP error! status: ${o.status}`);n=(await o.json()).choices[0].message.content.trim(),M.value=100}try{const e=(n.match(/```(?:json)?\s*([\s\S]*?)```/)||[null,n])[1]||n,t=JSON.parse(e);C.value=t,I.value='',G(),window.toastr.success('ä¸–ç•Œä¹¦æ¡ç›®ä¿®æ”¹å®Œæˆï¼')}catch(e){console.error('JSON è§£æå¤±è´¥:',e),console.log('åŸå§‹å“åº”:',n),window.toastr.error('ä¿®æ”¹çš„å†…å®¹æ ¼å¼é”™è¯¯ï¼Œè¯·é‡è¯•')}}catch(e){console.error('ä¸–ç•Œä¹¦æ¡ç›®ä¿®æ”¹å¤±è´¥:',e),window.toastr.error('ä¿®æ”¹å¤±è´¥ï¼š'+e.message)}finally{V.value=!1,M.value=0}else window.toastr.warning('æ²¡æœ‰å¯ä¿®æ”¹çš„æ¡ç›®ï¼Œè¯·å…ˆç”Ÿæˆæ¡ç›®');else window.toastr.warning('è¯·è¾“å…¥ä¿®æ”¹éœ€æ±‚')},pe=()=>{I.value='',G(),window.toastr.success('ä¿®æ”¹éœ€æ±‚å·²æ¸…ç©º')},ge=async()=>{if(P.value)try{const e=await getWorldbook(P.value);e&&Array.isArray(e)&&e.length>0?(D.value=e,console.log(`âœ… å·²åŠ è½½ä¸–ç•Œä¹¦ "${P.value}" çš„ ${D.value.length} ä¸ªæ¡ç›®`),window.toastr.success(`å·²åŠ è½½ ${D.value.length} ä¸ªæ¡ç›®`)):(D.value=[],window.toastr.info('è¯¥ä¸–ç•Œä¹¦æ²¡æœ‰æ¡ç›®'))}catch(e){console.error('âŒ åŠ è½½ä¸–ç•Œä¹¦æ¡ç›®å¤±è´¥:',e),window.toastr.error('åŠ è½½å¤±è´¥ï¼š'+e.message),D.value=[]}else D.value=[]},ue=(0,i.computed)(()=>{let e=[...D.value];if(j.value.trim()){const n=j.value.toLowerCase();e=e.filter(e=>{const t=e.name?.toLowerCase().includes(n),a=e.content?.toLowerCase().includes(n),o=e.strategy?.keys?.some(e=>'string'==typeof e?e.toLowerCase().includes(n):e instanceof RegExp&&e.toString().toLowerCase().includes(n));return t||a||o})}return'enabled'===R.value?e=e.filter(e=>e.enabled):'disabled'===R.value&&(e=e.filter(e=>!e.enabled)),e}),me=e=>O.value.get(e)||!1,fe=async()=>{if(L.value.name?.trim())if(H.value)try{const e=await updateWorldbookWith(P.value,e=>{const n=e.findIndex(e=>e.uid===H.value);return-1!==n&&(e[n]={...e[n],...L.value,uid:H.value}),e});D.value=e,F.value=!1,L.value={},H.value=null,window.toastr.success('æ¡ç›®å·²ä¿å­˜')}catch(e){console.error('ä¿å­˜æ¡ç›®å¤±è´¥:',e),window.toastr.error('ä¿å­˜å¤±è´¥ï¼š'+e.message)}else window.toastr.error('æ¡ç›®IDä¸å­˜åœ¨');else window.toastr.warning('æ¡ç›®åç§°ä¸èƒ½ä¸ºç©º')};return(e,n)=>((0,i.openBlock)(),(0,i.createElementBlock)('div',tl,[(0,i.createCommentVNode)(' åå…«è‚¡å·¥å…· '),(0,i.createElementVNode)('div',al,[(0,i.createElementVNode)('div',{class:'section-header',style:{display:'flex','justify-content':'space-between','align-items':'center',padding:'15px 20px',background:'linear-gradient(\n            135deg,\n            rgba(30, 30, 30, 0.95) 0%,\n            rgba(38, 38, 38, 0.9) 50%,\n            rgba(30, 30, 30, 0.95) 100%\n          )','backdrop-filter':'blur(12px)','border-radius':'12px','margin-bottom':'15px',border:'1px solid rgba(255, 255, 255, 0.06)','box-shadow':'0 3px 12px rgba(0, 0, 0, 0.3),\n            inset 0 1px 0 rgba(255, 255, 255, 0.04),\n            inset 0 -1px 0 rgba(0, 0, 0, 0.2)',cursor:'pointer',transition:'all 0.3s ease'},onClick:n[0]||(n[0]=e=>J('antiCliche')),onMouseenter:n[1]||(n[1]=e=>e.currentTarget.style.transform='translateY(-1px)'),onMouseleave:n[2]||(n[2]=e=>e.currentTarget.style.transform='translateY(0)')},[n[51]||(n[51]=(0,i.createElementVNode)('h4',{style:{margin:'0',color:'#fff','font-size':'16px','font-weight':'600',display:'flex','align-items':'center',gap:'10px'}},[(0,i.createElementVNode)('i',{class:'fa-solid fa-broom',style:{color:'#ff6b6b','font-size':'18px'}}),(0,i.createTextVNode)(' åå…«è‚¡å·¥å…· ')],-1)),(0,i.createElementVNode)('i',{class:(0,i.normalizeClass)(W('antiCliche')?'fa-solid fa-chevron-up':'fa-solid fa-chevron-down'),style:{color:'#ccc',transition:'transform 0.3s ease','font-size':'14px'}},null,2)],32),W('antiCliche')?((0,i.openBlock)(),(0,i.createElementBlock)('div',ol,[n[62]||(n[62]=(0,i.createStaticVNode)('<div class="tool-instructions" data-v-14fcd832><p style="margin:0 0 8px 0;color:#ccc;font-size:12px;" data-v-14fcd832><i class="fa-solid fa-info-circle" style="margin-right:6px;color:#17a2b8;" data-v-14fcd832></i> è§’è‰²å¡/ä¸–ç•Œä¹¦/å¼€åœºç™½å…«è‚¡æ¸…ç†å·¥å…·ï¼Œ<strong style="color:#10b981;" data-v-14fcd832>é€‚åº¦æ¸…ç†</strong>æ˜æ˜¾å…«è‚¡ï¼Œä¿æŒåŸæ–‡ä¿¡æ¯é‡ã€‚ </p><p style="margin:0 0 8px 0;color:#ffa500;font-size:11px;background:#1a1a1a;padding:6px;border-radius:4px;border-left:3px solid #ffa500;" data-v-14fcd832> ğŸ¯ <strong data-v-14fcd832>æ¸…ç†é‡ç‚¹</strong>ï¼šæ¨¡ç³Šè¯ï¼ˆä¸€ä¸ã€ä¼¼ä¹ï¼‰ã€åŠ¨ç‰©åŒ–æ¯”å–»ï¼ˆåƒå°å…½ï¼‰ã€å¦å®šå¥å¼ï¼ˆä¸æ˜¯è€Œæ˜¯ï¼‰ã€æç«¯æƒ…ç»ªã€å¤¸å¼ ä¿®è¾ </p><p style="margin:0;color:#10b981;font-size:11px;background:#1a1a1a;padding:6px;border-radius:4px;border-left:3px solid #10b981;" data-v-14fcd832> âœ… <strong data-v-14fcd832>ä¿æŒå†…å®¹</strong>ï¼šæ ¸å¿ƒè®¾å®šã€å¯¹è¯å†…å®¹ã€å…·ä½“åŠ¨ä½œã€é‡è¦ä¿¡æ¯ - è¾“å…¥å‡ æ®µè¾“å‡ºå‡ æ®µï¼ </p></div>',1)),(0,i.createElementVNode)('div',rl,[n[52]||(n[52]=(0,i.createElementVNode)('label',{style:{display:'block','margin-bottom':'8px',color:'#ccc','font-size':'13px','font-weight':'500'}},' è¾“å…¥æ–‡æœ¬ï¼š ',-1)),(0,i.withDirectives)((0,i.createElementVNode)('textarea',{'onUpdate:modelValue':n[3]||(n[3]=e=>o.value=e),placeholder:'è¯·è¾“å…¥éœ€è¦æ¸…ç†çš„æ–‡æœ¬...',style:{width:'100%',height:'120px',padding:'12px',background:'#2a2a2a',border:'1px solid #3a3a3a','border-radius':'6px',color:'#e0e0e0','font-size':'13px',resize:'vertical','font-family':'inherit'}},null,512),[[i.vModelText,o.value]])]),(0,i.createCommentVNode)(' æµå¼ä¼ è¾“å¼€å…³ '),(0,i.createElementVNode)('div',sl,[(0,i.createElementVNode)('label',il,[(0,i.withDirectives)((0,i.createElementVNode)('input',{'onUpdate:modelValue':n[4]||(n[4]=e=>c.value=e),type:'checkbox',style:{cursor:'pointer'}},null,512),[[i.vModelCheckbox,c.value]]),n[53]||(n[53]=(0,i.createTextVNode)(' å¯ç”¨æµå¼ä¼ è¾“ï¼ˆå¯æŸ¥çœ‹æ¸…ç†è¿›åº¦ï¼‰ ',-1))])]),(0,i.createCommentVNode)(' è¿›åº¦æ¡ '),s.value&&g.value>0?((0,i.openBlock)(),(0,i.createElementBlock)('div',ll,[(0,i.createElementVNode)('div',dl,[(0,i.createElementVNode)('div',{class:'progress-fill',style:(0,i.normalizeStyle)({width:g.value+'%',height:'100%',background:'linear-gradient(90deg, #667eea 0%, #764ba2 50%, #667eea 100%)',backgroundSize:'200% 100%',animation:c.value?'progress-slide 2s linear infinite':'none',transition:'width 0.3s ease'})},null,4)]),(0,i.createElementVNode)('div',cl,' æ¸…ç†ä¸­... '+(0,i.toDisplayString)(g.value.toFixed(0))+'% ',1)])):(0,i.createCommentVNode)('v-if',!0),(0,i.createElementVNode)('div',pl,[(0,i.createElementVNode)('button',{class:'process-button',disabled:s.value||!o.value.trim(),style:{padding:'12px 24px',background:'linear-gradient(135deg, #667eea 0%, #764ba2 100%)',border:'none','border-radius':'8px',color:'white','font-size':'13px','font-weight':'600',cursor:'pointer',transition:'all 0.3s ease','box-shadow':'0 3px 12px rgba(102, 126, 234, 0.3)',position:'relative',overflow:'hidden'},onClick:q},[n[54]||(n[54]=(0,i.createElementVNode)('div',{style:{position:'absolute',top:'0',left:'-100%',width:'100%',height:'100%',background:'linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent)',transition:'left 0.5s'},class:'shimmer-effect'},null,-1)),n[55]||(n[55]=(0,i.createElementVNode)('i',{class:'fa-solid fa-magic',style:{'font-size':'14px','margin-right':'6px'}},null,-1)),(0,i.createTextVNode)(' '+(0,i.toDisplayString)(s.value?'å¤„ç†ä¸­...':'å¼€å§‹æ¸…ç†'),1)],8,gl),(0,i.createElementVNode)('button',{class:'clear-button',style:{padding:'12px 24px',background:'linear-gradient(135deg, #ff6b6b 0%, #ee5a24 100%)',border:'none','border-radius':'8px',color:'white','font-size':'13px','font-weight':'600',cursor:'pointer',transition:'all 0.3s ease','box-shadow':'0 3px 12px rgba(255, 107, 107, 0.3)',position:'relative',overflow:'hidden'},onClick:te},[...n[56]||(n[56]=[(0,i.createElementVNode)('div',{style:{position:'absolute',top:'0',left:'-100%',width:'100%',height:'100%',background:'linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent)',transition:'left 0.5s'},class:'shimmer-effect'},null,-1),(0,i.createElementVNode)('i',{class:'fa-solid fa-trash',style:{'font-size':'14px','margin-right':'6px'}},null,-1),(0,i.createTextVNode)(' æ¸…ç©º ',-1)])])]),(0,i.createCommentVNode)(' è¾“å‡ºåŒºåŸŸ '),r.value?((0,i.openBlock)(),(0,i.createElementBlock)('div',ul,[n[61]||(n[61]=(0,i.createElementVNode)('h5',{style:{margin:'0 0 12px 0',color:'#fff','font-size':'14px','font-weight':'600'}},[(0,i.createElementVNode)('i',{class:'fa-solid fa-check-circle',style:{'margin-right':'6px',color:'#28a745'}}),(0,i.createTextVNode)(' æ¸…ç†ç»“æœï¼š ')],-1)),(0,i.createElementVNode)('div',ml,(0,i.toDisplayString)(r.value),1),(0,i.createElementVNode)('div',{class:'output-actions',style:{'margin-top':'12px',display:'flex',gap:'12px'}},[(0,i.createElementVNode)('button',{class:'copy-button',style:{padding:'10px 20px',background:'linear-gradient(135deg, #28a745 0%, #20c997 100%)',border:'none','border-radius':'6px',color:'white','font-size':'13px','font-weight':'600',cursor:'pointer',transition:'all 0.3s ease',display:'flex','align-items':'center',gap:'8px','box-shadow':'0 3px 12px rgba(40, 167, 69, 0.3)',position:'relative',overflow:'hidden'},onClick:K},[...n[57]||(n[57]=[(0,i.createElementVNode)('div',{style:{position:'absolute',top:'0',left:'-100%',width:'100%',height:'100%',background:'linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent)',transition:'left 0.5s'},class:'shimmer-effect'},null,-1),(0,i.createElementVNode)('i',{class:'fa-solid fa-copy',style:{'font-size':'14px'}},null,-1),(0,i.createTextVNode)(' å¤åˆ¶ç»“æœ ',-1)])])]),(0,i.createCommentVNode)(' ä¿®æ”¹åŠŸèƒ½ '),(0,i.createElementVNode)('div',fl,[n[60]||(n[60]=(0,i.createElementVNode)('h5',{style:{margin:'0 0 12px 0',color:'#fff','font-size':'14px','font-weight':'600'}},[(0,i.createElementVNode)('i',{class:'fa-solid fa-wand-magic-sparkles',style:{'margin-right':'6px',color:'#ffc107'}}),(0,i.createTextVNode)(' AI ä¿®æ”¹æ¸…ç†ç»“æœ ')],-1)),(0,i.createElementVNode)('div',xl,[(0,i.withDirectives)((0,i.createElementVNode)('textarea',{'onUpdate:modelValue':n[5]||(n[5]=e=>u.value=e),placeholder:'æè¿°ä½ æƒ³è¦çš„ä¿®æ”¹ï¼Œä¾‹å¦‚ï¼šæŠŠè¿™æ®µè¯æ”¹å¾—æ›´ç®€æ´ä¸€äº›...',style:{width:'100%',height:'80px',padding:'12px',background:'#2a2a2a',border:'1px solid #3a3a3a','border-radius':'6px',color:'#e0e0e0','font-size':'13px',resize:'vertical','font-family':'inherit'}},null,512),[[i.vModelText,u.value]])]),(0,i.createElementVNode)('div',bl,[(0,i.createElementVNode)('button',{disabled:m.value||!u.value.trim(),style:(0,i.normalizeStyle)([{flex:'1',padding:'10px 20px',background:'linear-gradient(135deg, #ffc107 0%, #ff9800 100%)',border:'none','border-radius':'6px',color:'#1a1a1a','font-size':'13px','font-weight':'600',cursor:'pointer',transition:'all 0.3s ease','box-shadow':'0 3px 12px rgba(255, 193, 7, 0.3)',opacity:'1'},{opacity:m.value||!u.value.trim()?.5:1,cursor:m.value||!u.value.trim()?'not-allowed':'pointer'}]),onClick:X},[n[58]||(n[58]=(0,i.createElementVNode)('i',{class:'fa-solid fa-wand-magic-sparkles',style:{'margin-right':'6px'}},null,-1)),(0,i.createTextVNode)(' '+(0,i.toDisplayString)(m.value?'ä¿®æ”¹ä¸­...':'AI ä¿®æ”¹'),1)],12,hl),(0,i.createElementVNode)('button',{disabled:!u.value.trim(),style:(0,i.normalizeStyle)([{padding:'10px 20px',background:'#dc3545',border:'none','border-radius':'6px',color:'white','font-size':'13px','font-weight':'600',cursor:'pointer',transition:'all 0.3s ease'},{opacity:u.value.trim()?1:.5,cursor:u.value.trim()?'pointer':'not-allowed'}]),onClick:Q},[...n[59]||(n[59]=[(0,i.createElementVNode)('i',{class:'fa-solid fa-eraser',style:{'margin-right':'6px'}},null,-1),(0,i.createTextVNode)(' æ¸…ç©ºä¿®æ”¹éœ€æ±‚ ',-1)])],12,yl)])])])):(0,i.createCommentVNode)('v-if',!0)])):(0,i.createCommentVNode)('v-if',!0)]),(0,i.createCommentVNode)(' ä¸–ç•Œä¹¦æ¡ç›®ç”Ÿæˆå·¥å…· '),(0,i.createElementVNode)('div',vl,[(0,i.createElementVNode)('div',{class:'section-header',style:{display:'flex','justify-content':'space-between','align-items':'center',padding:'15px 20px',background:'linear-gradient(\n            135deg,\n            rgba(30, 30, 30, 0.95) 0%,\n            rgba(38, 38, 38, 0.9) 50%,\n            rgba(30, 30, 30, 0.95) 100%\n          )','backdrop-filter':'blur(12px)','border-radius':'12px','margin-bottom':'15px',border:'1px solid rgba(255, 255, 255, 0.06)','box-shadow':'0 3px 12px rgba(0, 0, 0, 0.3),\n            inset 0 1px 0 rgba(255, 255, 255, 0.04),\n            inset 0 -1px 0 rgba(0, 0, 0, 0.2)',cursor:'pointer',transition:'all 0.3s ease'},onClick:n[6]||(n[6]=e=>J('worldbookEntry')),onMouseenter:n[7]||(n[7]=e=>e.currentTarget.style.transform='translateY(-1px)'),onMouseleave:n[8]||(n[8]=e=>e.currentTarget.style.transform='translateY(0)')},[n[63]||(n[63]=(0,i.createElementVNode)('h4',{style:{margin:'0',color:'#fff','font-size':'16px','font-weight':'600',display:'flex','align-items':'center',gap:'10px'}},[(0,i.createElementVNode)('i',{class:'fa-solid fa-book-atlas',style:{color:'#ffc107','font-size':'18px'}}),(0,i.createTextVNode)(' ä¸–ç•Œä¹¦æ¡ç›®ç”Ÿæˆå·¥å…· ')],-1)),(0,i.createElementVNode)('i',{class:(0,i.normalizeClass)(W('worldbookEntry')?'fa-solid fa-chevron-up':'fa-solid fa-chevron-down'),style:{color:'#ccc',transition:'transform 0.3s ease','font-size':'14px'}},null,2)],32),W('worldbookEntry')?((0,i.openBlock)(),(0,i.createElementBlock)('div',wl,[n[85]||(n[85]=(0,i.createElementVNode)('div',{class:'tool-instructions'},[(0,i.createElementVNode)('p',{style:{margin:'0 0 8px 0',color:'#ccc','font-size':'12px'}},[(0,i.createElementVNode)('i',{class:'fa-solid fa-info-circle',style:{'margin-right':'6px',color:'#ffc107'}}),(0,i.createTextVNode)(' è¾“å…¥ä½ æƒ³è¦çš„ä¸–ç•Œä¹¦æ¡ç›®æè¿°ï¼ŒAI å°†è‡ªåŠ¨ç”Ÿæˆç¬¦åˆæ ¼å¼çš„æ¡ç›®ï¼Œå¹¶å¯æ’å…¥åˆ°æŒ‡å®šä¸–ç•Œä¹¦ä¸­ã€‚ ')]),(0,i.createElementVNode)('p',{style:{margin:'0',color:'#4a9eff','font-size':'11px',background:'#1a1a1a',padding:'6px','border-radius':'4px','border-left':'3px solid #ffc107'}},' ğŸ’¡ ç¤ºä¾‹ï¼šã€Œç”Ÿæˆä¸€ä¸ªå…³äºé­”æ³•å­¦é™¢çš„æ¡ç›®ï¼ŒåŒ…å«å­¦é™¢å†å²å’Œè§„åˆ™ã€ã€ã€Œåˆ›å»ºè§’è‰²"è‰¾è‰ä¸"çš„èƒŒæ™¯æ¡ç›®ã€ ')],-1)),(0,i.createElementVNode)('div',kl,[n[64]||(n[64]=(0,i.createElementVNode)('label',{style:{display:'block','margin-bottom':'8px',color:'#ccc','font-size':'13px','font-weight':'500'}},' æ¡ç›®æè¿°ï¼š ',-1)),(0,i.withDirectives)((0,i.createElementVNode)('textarea',{'onUpdate:modelValue':n[9]||(n[9]=e=>A.value=e),placeholder:'è¯·æè¿°ä½ æƒ³è¦ç”Ÿæˆçš„ä¸–ç•Œä¹¦æ¡ç›®å†…å®¹...',style:{width:'100%',height:'120px',padding:'12px',background:'#2a2a2a',border:'1px solid #3a3a3a','border-radius':'6px',color:'#e0e0e0','font-size':'13px',resize:'vertical','font-family':'inherit'}},null,512),[[i.vModelText,A.value]])]),(0,i.createCommentVNode)(' æµå¼ä¼ è¾“å¼€å…³ '),(0,i.createElementVNode)('div',Al,[(0,i.createElementVNode)('label',Cl,[(0,i.withDirectives)((0,i.createElementVNode)('input',{'onUpdate:modelValue':n[10]||(n[10]=e=>B.value=e),type:'checkbox',style:{cursor:'pointer'}},null,512),[[i.vModelCheckbox,B.value]]),n[65]||(n[65]=(0,i.createTextVNode)(' å¯ç”¨æµå¼ä¼ è¾“ï¼ˆå¯æŸ¥çœ‹ç”Ÿæˆè¿›åº¦ï¼‰ ',-1))])]),(0,i.createCommentVNode)(' è¿›åº¦æ¡ '),E.value&&M.value>0?((0,i.openBlock)(),(0,i.createElementBlock)('div',El,[(0,i.createElementVNode)('div',Tl,[(0,i.createElementVNode)('div',{class:'progress-fill',style:(0,i.normalizeStyle)({width:M.value+'%',height:'100%',background:'linear-gradient(90deg, #ffc107 0%, #ff9800 50%, #ffc107 100%)',backgroundSize:'200% 100%',animation:B.value?'progress-slide 2s linear infinite':'none',transition:'width 0.3s ease'})},null,4)]),(0,i.createElementVNode)('div',Sl,' ç”Ÿæˆä¸­... '+(0,i.toDisplayString)(M.value.toFixed(0))+'% ',1)])):(0,i.createCommentVNode)('v-if',!0),(0,i.createElementVNode)('div',Nl,[(0,i.createElementVNode)('button',{class:'generate-button',disabled:E.value||!A.value.trim(),style:{padding:'12px 24px',background:'linear-gradient(135deg, #ffc107 0%, #ff9800 100%)',border:'none','border-radius':'8px',color:'white','font-size':'13px','font-weight':'600',cursor:'pointer',transition:'all 0.3s ease','box-shadow':'0 3px 12px rgba(255, 193, 7, 0.3)',position:'relative',overflow:'hidden'},onClick:se},[n[66]||(n[66]=(0,i.createElementVNode)('div',{style:{position:'absolute',top:'0',left:'-100%',width:'100%',height:'100%',background:'linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent)',transition:'left 0.5s'},class:'shimmer-effect'},null,-1)),n[67]||(n[67]=(0,i.createElementVNode)('i',{class:'fa-solid fa-magic',style:{'font-size':'14px','margin-right':'6px'}},null,-1)),(0,i.createTextVNode)(' '+(0,i.toDisplayString)(E.value?'ç”Ÿæˆä¸­...':'ç”Ÿæˆæ¡ç›®'),1)],8,Il),(0,i.createElementVNode)('button',{class:'clear-button',style:{padding:'12px 24px',background:'linear-gradient(135deg, #ff6b6b 0%, #ee5a24 100%)',border:'none','border-radius':'8px',color:'white','font-size':'13px','font-weight':'600',cursor:'pointer',transition:'all 0.3s ease','box-shadow':'0 3px 12px rgba(255, 107, 107, 0.3)',position:'relative',overflow:'hidden'},onClick:ie},[...n[68]||(n[68]=[(0,i.createElementVNode)('div',{style:{position:'absolute',top:'0',left:'-100%',width:'100%',height:'100%',background:'linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent)',transition:'left 0.5s'},class:'shimmer-effect'},null,-1),(0,i.createElementVNode)('i',{class:'fa-solid fa-trash',style:{'font-size':'14px','margin-right':'6px'}},null,-1),(0,i.createTextVNode)(' æ¸…ç©º ',-1)])])]),(0,i.createCommentVNode)(' è¾“å‡ºåŒºåŸŸ '),C.value?((0,i.openBlock)(),(0,i.createElementBlock)('div',_l,[n[84]||(n[84]=(0,i.createElementVNode)('h5',{style:{margin:'0 0 12px 0',color:'#fff','font-size':'14px','font-weight':'600'}},[(0,i.createElementVNode)('i',{class:'fa-solid fa-check-circle',style:{'margin-right':'6px',color:'#28a745'}}),(0,i.createTextVNode)(' ç”Ÿæˆçš„æ¡ç›®ï¼š ')],-1)),(0,i.createCommentVNode)(' æ¡ç›®é¢„è§ˆ '),(0,i.createElementVNode)('div',Vl,[(0,i.createElementVNode)('div',zl,[n[69]||(n[69]=(0,i.createElementVNode)('label',{style:{color:'#ffc107','font-size':'12px','font-weight':'600',display:'block','margin-bottom':'4px'}},'æ¡ç›®åç§°ï¼š',-1)),(0,i.createElementVNode)('div',Bl,(0,i.toDisplayString)(C.value.name||'æœªå‘½å'),1)]),(0,i.createElementVNode)('div',Ml,[n[70]||(n[70]=(0,i.createElementVNode)('label',{style:{color:'#ffc107','font-size':'12px','font-weight':'600',display:'block','margin-bottom':'4px'}},'ä¸»è¦å…³é”®å­—ï¼š',-1)),(0,i.createElementVNode)('div',Pl,(0,i.toDisplayString)(C.value.strategy?.keys?.join(', ')||'æ— '),1)]),(0,i.createElementVNode)('div',$l,[n[71]||(n[71]=(0,i.createElementVNode)('label',{style:{color:'#ffc107','font-size':'12px','font-weight':'600',display:'block','margin-bottom':'4px'}},'æ¡ç›®å†…å®¹ï¼š',-1)),(0,i.createElementVNode)('div',Dl,(0,i.toDisplayString)(C.value.content),1)]),(0,i.createElementVNode)('div',jl,[n[72]||(n[72]=(0,i.createElementVNode)('label',{style:{color:'#ffc107','font-size':'12px','font-weight':'600',display:'block','margin-bottom':'4px'}},'æ¿€æ´»ç­–ç•¥ï¼š',-1)),(0,i.createElementVNode)('div',Rl,(0,i.toDisplayString)('constant'===C.value.strategy?.type?'ğŸ”µ å¸¸é‡ (è“ç¯)':'selective'===C.value.strategy?.type?'ğŸŸ¢ å¯é€‰é¡¹ (ç»¿ç¯)':'ğŸ”— å‘é‡åŒ–'),1)])]),(0,i.createCommentVNode)(' æ¡ç›®ä¿®æ”¹åŒºåŸŸ '),(0,i.createElementVNode)('div',Ol,[n[77]||(n[77]=(0,i.createStaticVNode)('<h5 style="margin:0 0 12px 0;color:#fff;font-size:14px;font-weight:600;" data-v-14fcd832><i class="fa-solid fa-edit" style="margin-right:6px;color:#ffa500;" data-v-14fcd832></i> ä¿®æ”¹æ¡ç›® </h5><div class="modify-instructions" style="background:#1a1a1a;border:1px solid #3a3a3a;border-radius:6px;padding:10px;margin-bottom:15px;" data-v-14fcd832><p style="margin:0 0 6px 0;color:#ccc;font-size:12px;" data-v-14fcd832><i class="fa-solid fa-lightbulb" style="margin-right:6px;color:#ffa500;" data-v-14fcd832></i> æè¿°ä½ æƒ³è¦ä¿®æ”¹çš„å†…å®¹ï¼ŒAIä¼šæ ¹æ®ä½ çš„éœ€æ±‚è°ƒæ•´æ¡ç›®ã€‚ä¾‹å¦‚ï¼š&quot;å¢åŠ æ›´å¤šç»†èŠ‚&quot;ã€&quot;æ”¹ä¸ºå¥³æ€§è§’è‰²&quot;ã€&quot;æ·»åŠ æŠ€èƒ½è¯´æ˜&quot;ç­‰ã€‚ </p><p style="margin:0;color:#ffa500;font-size:11px;" data-v-14fcd832>âš ï¸ ä¿®æ”¹åä¼šä¿æŒ JSON æ ¼å¼ã€‚</p></div>',2)),(0,i.createElementVNode)('div',Fl,[n[73]||(n[73]=(0,i.createElementVNode)('label',{style:{display:'block','margin-bottom':'8px',color:'#ccc','font-size':'13px','font-weight':'500'}},' ä¿®æ”¹éœ€æ±‚ï¼š ',-1)),(0,i.withDirectives)((0,i.createElementVNode)('textarea',{'onUpdate:modelValue':n[11]||(n[11]=e=>I.value=e),placeholder:'è¯·æè¿°ä½ æƒ³è¦ä¿®æ”¹çš„å†…å®¹...',style:{width:'100%',height:'80px',padding:'12px',background:'#2a2a2a',border:'1px solid #3a3a3a','border-radius':'6px',color:'#e0e0e0','font-size':'13px',resize:'vertical','font-family':'inherit'}},null,512),[[i.vModelText,I.value]])]),(0,i.createCommentVNode)(' ä¿®æ”¹è¿›åº¦æ¡ '),V.value&&M.value>0?((0,i.openBlock)(),(0,i.createElementBlock)('div',Ll,[(0,i.createElementVNode)('div',Hl,[(0,i.createElementVNode)('div',{class:'progress-fill',style:(0,i.normalizeStyle)({width:M.value+'%',height:'100%',background:'linear-gradient(90deg, #ffa500 0%, #ff8c00 50%, #ffa500 100%)',backgroundSize:'200% 100%',animation:B.value?'progress-slide 2s linear infinite':'none',transition:'width 0.3s ease'})},null,4)]),(0,i.createElementVNode)('div',Ul,' ä¿®æ”¹ä¸­... '+(0,i.toDisplayString)(M.value.toFixed(0))+'% ',1)])):(0,i.createCommentVNode)('v-if',!0),(0,i.createElementVNode)('div',Gl,[(0,i.createElementVNode)('button',{class:'modify-button',disabled:V.value||!I.value.trim(),style:{padding:'12px 24px',background:'linear-gradient(135deg, #ffa500 0%, #ff8c00 100%)',border:'none','border-radius':'8px',color:'white','font-size':'13px','font-weight':'600',cursor:'pointer',transition:'all 0.3s ease','box-shadow':'0 3px 12px rgba(255, 165, 0, 0.3)',position:'relative',overflow:'hidden'},onClick:ce},[n[74]||(n[74]=(0,i.createElementVNode)('div',{style:{position:'absolute',top:'0',left:'-100%',width:'100%',height:'100%',background:'linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent)',transition:'left 0.5s'},class:'shimmer-effect'},null,-1)),n[75]||(n[75]=(0,i.createElementVNode)('i',{class:'fa-solid fa-wand-magic-sparkles',style:{'font-size':'14px','margin-right':'6px'}},null,-1)),(0,i.createTextVNode)(' '+(0,i.toDisplayString)(V.value?'ä¿®æ”¹ä¸­...':'AIä¿®æ”¹'),1)],8,Yl),(0,i.createElementVNode)('button',{class:'clear-modify-button',style:{padding:'12px 24px',background:'linear-gradient(135deg, #6c757d 0%, #5a6268 100%)',border:'none','border-radius':'8px',color:'white','font-size':'13px','font-weight':'600',cursor:'pointer',transition:'all 0.3s ease','box-shadow':'0 3px 12px rgba(108, 117, 125, 0.3)',position:'relative',overflow:'hidden'},onClick:pe},[...n[76]||(n[76]=[(0,i.createElementVNode)('div',{style:{position:'absolute',top:'0',left:'-100%',width:'100%',height:'100%',background:'linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent)',transition:'left 0.5s'},class:'shimmer-effect'},null,-1),(0,i.createElementVNode)('i',{class:'fa-solid fa-eraser',style:{'font-size':'14px','margin-right':'6px'}},null,-1),(0,i.createTextVNode)(' æ¸…ç©ºä¿®æ”¹éœ€æ±‚ ',-1)])])])]),(0,i.createCommentVNode)(' ä¸–ç•Œä¹¦é€‰æ‹©å’Œæ’å…¥ '),(0,i.createElementVNode)('div',Jl,[n[83]||(n[83]=(0,i.createElementVNode)('h5',{style:{margin:'0 0 12px 0',color:'#fff','font-size':'14px','font-weight':'600'}},[(0,i.createElementVNode)('i',{class:'fa-solid fa-file-import',style:{'margin-right':'6px',color:'#17a2b8'}}),(0,i.createTextVNode)(' æ’å…¥åˆ°ä¸–ç•Œä¹¦ ')],-1)),(0,i.createElementVNode)('div',Wl,[n[79]||(n[79]=(0,i.createElementVNode)('label',{style:{display:'block','margin-bottom':'8px',color:'#ccc','font-size':'13px','font-weight':'500'}},' é€‰æ‹©ä¸–ç•Œä¹¦ï¼š ',-1)),(0,i.withDirectives)((0,i.createElementVNode)('select',{'onUpdate:modelValue':n[12]||(n[12]=e=>S.value=e),style:{width:'100%',padding:'10px',background:'#2a2a2a',border:'1px solid #3a3a3a','border-radius':'6px',color:'#e0e0e0','font-size':'13px'}},[n[78]||(n[78]=(0,i.createElementVNode)('option',{value:'',disabled:''},'è¯·é€‰æ‹©ä¸–ç•Œä¹¦',-1)),((0,i.openBlock)(!0),(0,i.createElementBlock)(i.Fragment,null,(0,i.renderList)(T.value,e=>((0,i.openBlock)(),(0,i.createElementBlock)('option',{key:e,value:e},(0,i.toDisplayString)(e),9,ql))),128))],512),[[i.vModelSelect,S.value]])]),(0,i.createElementVNode)('div',Kl,[(0,i.createElementVNode)('button',{class:'insert-button',disabled:!S.value||N.value,style:{padding:'10px 20px',background:'linear-gradient(135deg, #28a745 0%, #20c997 100%)',border:'none','border-radius':'6px',color:'white','font-size':'13px','font-weight':'600',cursor:'pointer',transition:'all 0.3s ease',display:'flex','align-items':'center',gap:'8px','box-shadow':'0 3px 12px rgba(40, 167, 69, 0.3)',position:'relative',overflow:'hidden'},onClick:le},[n[80]||(n[80]=(0,i.createElementVNode)('div',{style:{position:'absolute',top:'0',left:'-100%',width:'100%',height:'100%',background:'linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent)',transition:'left 0.5s'},class:'shimmer-effect'},null,-1)),n[81]||(n[81]=(0,i.createElementVNode)('i',{class:'fa-solid fa-plus-circle',style:{'font-size':'14px'}},null,-1)),(0,i.createTextVNode)(' '+(0,i.toDisplayString)(N.value?'æ’å…¥ä¸­...':'æ’å…¥æ¡ç›®'),1)],8,Xl),(0,i.createElementVNode)('button',{class:'copy-button',style:{padding:'10px 20px',background:'linear-gradient(135deg, #17a2b8 0%, #138496 100%)',border:'none','border-radius':'6px',color:'white','font-size':'13px','font-weight':'600',cursor:'pointer',transition:'all 0.3s ease',display:'flex','align-items':'center',gap:'8px','box-shadow':'0 3px 12px rgba(23, 162, 184, 0.3)',position:'relative',overflow:'hidden'},onClick:de},[...n[82]||(n[82]=[(0,i.createElementVNode)('div',{style:{position:'absolute',top:'0',left:'-100%',width:'100%',height:'100%',background:'linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent)',transition:'left 0.5s'},class:'shimmer-effect'},null,-1),(0,i.createElementVNode)('i',{class:'fa-solid fa-copy',style:{'font-size':'14px'}},null,-1),(0,i.createTextVNode)(' å¤åˆ¶ JSON ',-1)])])])])])):(0,i.createCommentVNode)('v-if',!0)])):(0,i.createCommentVNode)('v-if',!0)]),(0,i.createCommentVNode)(' ä¸–ç•Œä¹¦æ¡ç›®æŸ¥çœ‹å™¨ '),(0,i.createElementVNode)('div',Ql,[(0,i.createElementVNode)('div',{class:'section-header viewer-header',style:{display:'flex','justify-content':'space-between','align-items':'center',padding:'15px 20px',background:'linear-gradient(\n            135deg,\n            rgba(30, 30, 30, 0.95) 0%,\n            rgba(38, 38, 38, 0.9) 50%,\n            rgba(30, 30, 30, 0.95) 100%\n          )','backdrop-filter':'blur(12px)','border-radius':'12px','margin-bottom':'15px',border:'1px solid rgba(255, 255, 255, 0.06)','box-shadow':'0 3px 12px rgba(0, 0, 0, 0.3),\n            inset 0 1px 0 rgba(255, 255, 255, 0.04),\n            inset 0 -1px 0 rgba(0, 0, 0, 0.2)',cursor:'pointer',transition:'all 0.3s ease'},onClick:n[13]||(n[13]=e=>J('worldbookViewer')),onMouseenter:n[14]||(n[14]=e=>e.currentTarget.style.transform='translateY(-1px)'),onMouseleave:n[15]||(n[15]=e=>e.currentTarget.style.transform='translateY(0)')},[n[86]||(n[86]=(0,i.createElementVNode)('h4',{style:{margin:'0',color:'#fff','font-size':'16px','font-weight':'600',display:'flex','align-items':'center',gap:'10px'}},[(0,i.createElementVNode)('i',{class:'fa-solid fa-list',style:{color:'#20c997','font-size':'18px'}}),(0,i.createTextVNode)(' ä¸–ç•Œä¹¦æ¡ç›®æŸ¥çœ‹å™¨ ')],-1)),(0,i.createElementVNode)('i',{class:(0,i.normalizeClass)(W('worldbookViewer')?'fa-solid fa-chevron-up':'fa-solid fa-chevron-down'),style:{color:'#888','font-size':'14px',transition:'transform 0.3s ease'}},null,2)],32),W('worldbookViewer')?((0,i.openBlock)(),(0,i.createElementBlock)('div',Zl,[n[97]||(n[97]=(0,i.createElementVNode)('div',{class:'tool-instructions',style:{background:'rgba(32, 201, 151, 0.1)','border-left':'3px solid #20c997',padding:'12px 15px','border-radius':'6px','margin-bottom':'20px'}},[(0,i.createElementVNode)('p',{style:{margin:'0',color:'#a0f0e0','font-size':'13px',display:'flex','align-items':'center',gap:'8px'}},[(0,i.createElementVNode)('i',{class:'fa-solid fa-info-circle',style:{color:'#20c997'}}),(0,i.createTextVNode)(' é€‰æ‹©ä¸€ä¸ªä¸–ç•Œä¹¦ï¼ŒæŸ¥çœ‹å…¶ä¸­æ‰€æœ‰æ¡ç›®çš„è¯¦ç»†ä¿¡æ¯ï¼Œæ”¯æŒæœç´¢å’Œç­›é€‰ã€‚ ')])],-1)),(0,i.createCommentVNode)(' é€‰æ‹©ä¸–ç•Œä¹¦ '),(0,i.createElementVNode)('div',ed,[n[88]||(n[88]=(0,i.createElementVNode)('label',{style:{display:'block','margin-bottom':'10px',color:'#e0e0e0','font-size':'14px','font-weight':'500','letter-spacing':'0.3px'}},' é€‰æ‹©ä¸–ç•Œä¹¦ï¼š ',-1)),(0,i.withDirectives)((0,i.createElementVNode)('select',{'onUpdate:modelValue':n[16]||(n[16]=e=>P.value=e),style:{width:'100%',padding:'12px 15px',background:'#2a2a2a',border:'1px solid rgba(255, 255, 255, 0.1)','border-radius':'8px',color:'#e0e0e0','font-size':'14px',cursor:'pointer',transition:'all 0.3s ease','box-shadow':'inset 0 2px 4px rgba(0, 0, 0, 0.2)'},onChange:ge,onFocus:n[17]||(n[17]=e=>e.target.style.borderColor='#20c997'),onBlur:n[18]||(n[18]=e=>e.target.style.borderColor='rgba(255, 255, 255, 0.1)')},[n[87]||(n[87]=(0,i.createElementVNode)('option',{value:''},'è¯·é€‰æ‹©ä¸–ç•Œä¹¦',-1)),((0,i.openBlock)(!0),(0,i.createElementBlock)(i.Fragment,null,(0,i.renderList)(T.value,e=>((0,i.openBlock)(),(0,i.createElementBlock)('option',{key:e,value:e},(0,i.toDisplayString)(e),9,nd))),128))],544),[[i.vModelSelect,P.value]])]),(0,i.createCommentVNode)(' æœç´¢æ¡ç›® '),P.value?((0,i.openBlock)(),(0,i.createElementBlock)('div',td,[n[89]||(n[89]=(0,i.createElementVNode)('label',{style:{display:'block','margin-bottom':'10px',color:'#e0e0e0','font-size':'14px','font-weight':'500','letter-spacing':'0.3px'}},' æœç´¢æ¡ç›®ï¼š ',-1)),(0,i.withDirectives)((0,i.createElementVNode)('input',{'onUpdate:modelValue':n[19]||(n[19]=e=>j.value=e),type:'text',placeholder:'æœç´¢æ¡ç›®åç§°ã€å…³é”®å­—æˆ–å†…å®¹...',style:{width:'100%',padding:'12px 15px',background:'#2a2a2a',border:'1px solid rgba(255, 255, 255, 0.1)','border-radius':'8px',color:'#e0e0e0','font-size':'14px',transition:'all 0.3s ease','box-shadow':'inset 0 2px 4px rgba(0, 0, 0, 0.2)'},onFocus:n[20]||(n[20]=e=>e.target.style.borderColor='#20c997'),onBlur:n[21]||(n[21]=e=>e.target.style.borderColor='rgba(255, 255, 255, 0.1)')},null,544),[[i.vModelText,j.value]])])):(0,i.createCommentVNode)('v-if',!0),(0,i.createCommentVNode)(' æ’åº '),P.value&&D.value.length>0?((0,i.openBlock)(),(0,i.createElementBlock)('div',ad,[(0,i.createElementVNode)('button',{style:(0,i.normalizeStyle)({padding:'8px 16px',background:'original'===R.value?'#20c997':'#444',border:'none',borderRadius:'6px',color:'white',fontSize:'12px',cursor:'pointer',transition:'all 0.2s'}),onClick:n[22]||(n[22]=e=>R.value='original')},' åŸå§‹é¡ºåº ',4),(0,i.createElementVNode)('button',{style:(0,i.normalizeStyle)({padding:'8px 16px',background:'enabled'===R.value?'#28a745':'#444',border:'none',borderRadius:'6px',color:'white',fontSize:'12px',cursor:'pointer',transition:'all 0.2s'}),onClick:n[23]||(n[23]=e=>R.value='enabled')},' âœ“ å…¨é€‰ ',4),(0,i.createElementVNode)('button',{style:(0,i.normalizeStyle)({padding:'8px 16px',background:'disabled'===R.value?'#dc3545':'#444',border:'none',borderRadius:'6px',color:'white',fontSize:'12px',cursor:'pointer',transition:'all 0.2s'}),onClick:n[24]||(n[24]=e=>R.value='disabled')},' âœ• å–æ¶ˆå…¨é€‰ ',4)])):(0,i.createCommentVNode)('v-if',!0),(0,i.createCommentVNode)(' æ‰¾åˆ°çš„æ¡ç›®ç»Ÿè®¡ '),P.value?((0,i.openBlock)(),(0,i.createElementBlock)('div',od,[(0,i.unref)(ue).length>0?((0,i.openBlock)(),(0,i.createElementBlock)('span',rd,' å…±æ‰¾åˆ° '+(0,i.toDisplayString)((0,i.unref)(ue).length)+' ä¸ªæ¡ç›® ',1)):((0,i.openBlock)(),(0,i.createElementBlock)('span',sd,'æœªæ‰¾åˆ°æ¡ç›®'))])):(0,i.createCommentVNode)('v-if',!0),(0,i.createCommentVNode)(' æ¡ç›®åˆ—è¡¨ '),(0,i.unref)(ue).length>0?((0,i.openBlock)(),(0,i.createElementBlock)('div',id,[((0,i.openBlock)(!0),(0,i.createElementBlock)(i.Fragment,null,(0,i.renderList)((0,i.unref)(ue),(e,t)=>((0,i.openBlock)(),(0,i.createElementBlock)('div',{key:t,style:{background:'#2a2a2a',border:'1px solid #3a3a3a','border-radius':'8px',padding:'15px',transition:'all 0.3s ease'}},[(0,i.createCommentVNode)(' æ¡ç›®å¤´éƒ¨ '),(0,i.createElementVNode)('div',{style:{display:'flex','justify-content':'space-between','align-items':'flex-start',cursor:'pointer','user-select':'none'},onClick:e=>(e=>{const n=O.value.get(e)||!1;O.value.set(e,!n)})(t)},[(0,i.createCommentVNode)(' ä¸‰è¡Œæ ¼å¼æ˜¾ç¤º '),(0,i.createElementVNode)('div',dd,[(0,i.createCommentVNode)(' ç¬¬ä¸€è¡Œï¼šçŠ¶æ€ç¯ + æ¡ç›®åç§° '),(0,i.createElementVNode)('div',cd,['constant'===e.strategy?.type?((0,i.openBlock)(),(0,i.createElementBlock)('span',pd,'ğŸ”µ')):'selective'===e.strategy?.type?((0,i.openBlock)(),(0,i.createElementBlock)('span',gd,'ğŸŸ¢')):((0,i.openBlock)(),(0,i.createElementBlock)('span',ud,'âšª')),(0,i.createElementVNode)('span',md,(0,i.toDisplayString)(e.name||'(æ— åç§°)'),1)]),(0,i.createCommentVNode)(' ç¬¬äºŒè¡Œï¼šå…³é”®è¯ | ä½ç½® | æ·±åº¦ '),(0,i.createElementVNode)('div',fd,[e.strategy?.keys&&e.strategy.keys.length>0?((0,i.openBlock)(),(0,i.createElementBlock)('span',xd,' å…³é”®è¯: '+(0,i.toDisplayString)(e.strategy.keys.map(e=>'string'==typeof e?e:String(e)).join(', ')),1)):((0,i.openBlock)(),(0,i.createElementBlock)('span',bd,'å…³é”®è¯: (æ— )')),e.position?.order&&0!==e.position.order?((0,i.openBlock)(),(0,i.createElementBlock)('span',hd,[n[90]||(n[90]=(0,i.createElementVNode)('span',{style:{color:'#666'}},' | ',-1)),(0,i.createTextVNode)(' é¡ºåº: '+(0,i.toDisplayString)(e.position.order),1)])):(0,i.createCommentVNode)('v-if',!0),'at_depth'===e.position?.type&&e.position.depth&&0!==e.position.depth?((0,i.openBlock)(),(0,i.createElementBlock)('span',yd,[n[91]||(n[91]=(0,i.createElementVNode)('span',{style:{color:'#666'}},' | ',-1)),(0,i.createTextVNode)(' æ·±åº¦: '+(0,i.toDisplayString)(e.position.depth),1)])):(0,i.createCommentVNode)('v-if',!0)]),(0,i.createCommentVNode)(' ç¬¬ä¸‰è¡Œï¼šå†…å®¹é¢„è§ˆ '),(0,i.createElementVNode)('div',vd,(0,i.toDisplayString)(e.content?e.content.length>50?e.content.substring(0,50)+'...':e.content:'(æ— å†…å®¹)'),1)]),(0,i.createElementVNode)('i',{class:(0,i.normalizeClass)(me(t)?'fa-solid fa-chevron-up':'fa-solid fa-chevron-down'),style:{color:'#888','font-size':'12px','margin-top':'2px'}},null,2)],8,ld),(0,i.createCommentVNode)(' æ¡ç›®å†…å®¹ï¼ˆå±•å¼€æ—¶æ˜¾ç¤ºï¼‰ '),me(t)?((0,i.openBlock)(),(0,i.createElementBlock)('div',wd,[(0,i.createCommentVNode)(' è§¦å‘ç­–ç•¥ä¿¡æ¯ '),(0,i.createElementVNode)('div',kd,[n[92]||(n[92]=(0,i.createElementVNode)('span',{style:{color:'#888','font-size':'12px','font-weight':'600',display:'block','margin-bottom':'6px'}},' âš™ï¸ è§¦å‘ç­–ç•¥ï¼š ',-1)),(0,i.createElementVNode)('div',Ad,['constant'===e.strategy?.type?((0,i.openBlock)(),(0,i.createElementBlock)('span',Cd,' ğŸ”µ è“ç¯ï¼ˆå¸¸é‡ï¼‰- æ— éœ€å…³é”®å­—åŒ¹é… ')):'selective'===e.strategy?.type?((0,i.openBlock)(),(0,i.createElementBlock)('span',Ed,' ğŸŸ¢ ç»¿ç¯ï¼ˆå¯é€‰é¡¹ï¼‰- éœ€è¦å…³é”®å­—åŒ¹é… ')):((0,i.openBlock)(),(0,i.createElementBlock)('span',Td,' âšª æœªçŸ¥ç±»å‹ '))])]),(0,i.createCommentVNode)(' å…³é”®å­— '),(0,i.createElementVNode)('div',Sd,[(0,i.createElementVNode)('span',Nd,[n[93]||(n[93]=(0,i.createTextVNode)(' ğŸ”‘ å…³é”®å­—ï¼š ',-1)),'constant'===e.strategy?.type?((0,i.openBlock)(),(0,i.createElementBlock)('span',Id,' (è“ç¯æ¡ç›®é€šå¸¸ä¸éœ€è¦å…³é”®å­—) ')):(0,i.createCommentVNode)('v-if',!0)]),(0,i.createElementVNode)('div',_d,[((0,i.openBlock)(!0),(0,i.createElementBlock)(i.Fragment,null,(0,i.renderList)(e.strategy?.keys||[],(e,n)=>((0,i.openBlock)(),(0,i.createElementBlock)('span',{key:n,style:{padding:'4px 10px',background:'#667eea',color:'white','border-radius':'12px','font-size':'11px'}},(0,i.toDisplayString)('string'==typeof e?e:String(e)),1))),128)),e.strategy?.keys&&0!==e.strategy.keys.length?(0,i.createCommentVNode)('v-if',!0):((0,i.openBlock)(),(0,i.createElementBlock)('span',Vd,(0,i.toDisplayString)('constant'===e.strategy?.type?'(è“ç¯æ¡ç›®æ— éœ€å…³é”®å­—)':'(æ— å…³é”®å­—)'),1))])]),(0,i.createCommentVNode)(' æ¡ç›®å†…å®¹ '),(0,i.createElementVNode)('div',zd,[n[94]||(n[94]=(0,i.createElementVNode)('span',{style:{color:'#888','font-size':'12px','font-weight':'600',display:'block','margin-bottom':'6px'}},' ğŸ“„ æ¡ç›®å†…å®¹ï¼š ',-1)),(0,i.createElementVNode)('div',Bd,(0,i.toDisplayString)(e.content||'(æ— å†…å®¹)'),1)]),(0,i.createCommentVNode)(' æ“ä½œæŒ‰é’® '),(0,i.createElementVNode)('div',Md,[(0,i.createElementVNode)('button',{style:{padding:'8px 16px',background:'#4a9eff',border:'none','border-radius':'6px',color:'white','font-size':'12px',cursor:'pointer',transition:'all 0.2s'},onClick:n=>(e=>{try{L.value={uid:e.uid,name:e.name||'',enabled:e.enabled??!0,content:e.content||'',strategy:{type:e.strategy?.type||'selective',keys:[...e.strategy?.keys||[]],keys_secondary:{logic:e.strategy?.keys_secondary?.logic||'and_any',keys:[...e.strategy?.keys_secondary?.keys||[]]},scan_depth:e.strategy?.scan_depth||'same_as_global'},position:e.position?{type:e.position.type||'before_character_definition',role:e.position.role||'system',depth:e.position.depth??0,order:e.position.order??0}:{type:'before_character_definition',role:'system',depth:0,order:0},probability:e.probability??100,recursion:e.recursion?{prevent_incoming:e.recursion.prevent_incoming??!1,prevent_outgoing:e.recursion.prevent_outgoing??!1,delay_until:e.recursion.delay_until??null}:{prevent_incoming:!1,prevent_outgoing:!1,delay_until:null},effect:e.effect?{sticky:e.effect.sticky??null,cooldown:e.effect.cooldown??null,delay:e.effect.delay??null}:{sticky:null,cooldown:null,delay:null}},H.value=e.uid,F.value=!0}catch(e){console.error('æ‰“å¼€ç¼–è¾‘ç•Œé¢å¤±è´¥:',e),window.toastr.error('æ‰“å¼€ç¼–è¾‘ç•Œé¢å¤±è´¥ï¼š'+e.message)}})(e)},[...n[95]||(n[95]=[(0,i.createElementVNode)('i',{class:'fa-solid fa-edit'},null,-1),(0,i.createTextVNode)(' ç¼–è¾‘ ',-1)])],8,Pd),(0,i.createElementVNode)('button',{style:{padding:'8px 16px',background:'#ff6b6b',border:'none','border-radius':'6px',color:'white','font-size':'12px',cursor:'pointer',transition:'all 0.2s'},onClick:n=>(async e=>{if(confirm(`ç¡®å®šè¦åˆ é™¤æ¡ç›® "${e.name}" å—ï¼Ÿ`))try{const{worldbook:n}=await deleteWorldbookEntries(P.value,n=>n.uid===e.uid);D.value=n,window.toastr.success(`å·²åˆ é™¤æ¡ç›® "${e.name}"`)}catch(e){console.error('åˆ é™¤æ¡ç›®å¤±è´¥:',e),window.toastr.error('åˆ é™¤å¤±è´¥ï¼š'+e.message)}})(e)},[...n[96]||(n[96]=[(0,i.createElementVNode)('i',{class:'fa-solid fa-trash'},null,-1),(0,i.createTextVNode)(' åˆ é™¤ ',-1)])],8,$d)])])):(0,i.createCommentVNode)('v-if',!0)]))),128))])):(0,i.createCommentVNode)('v-if',!0)])):(0,i.createCommentVNode)('v-if',!0)]),(0,i.createCommentVNode)(' ä¸–ç•Œä¹¦æ¡ç›®ç¼–è¾‘å¯¹è¯æ¡† '),F.value?((0,i.openBlock)(),(0,i.createElementBlock)('div',{key:0,style:{position:'fixed',top:'0',left:'0',right:'0',bottom:'0',background:'rgba(0, 0, 0, 0.7)',display:'flex','align-items':'center','justify-content':'center','z-index':'10000','backdrop-filter':'blur(4px)'},onClick:n[44]||(n[44]=(0,i.withModifiers)(e=>F.value=!1,['self']))},[(0,i.createElementVNode)('div',Dd,[(0,i.createElementVNode)('div',jd,[n[99]||(n[99]=(0,i.createElementVNode)('h3',{style:{margin:'0',color:'#fff','font-size':'18px','font-weight':'600'}},[(0,i.createElementVNode)('i',{class:'fa-solid fa-edit',style:{'margin-right':'8px',color:'#4a9eff'}}),(0,i.createTextVNode)(' ç¼–è¾‘ä¸–ç•Œä¹¦æ¡ç›® ')],-1)),(0,i.createElementVNode)('button',{style:{background:'transparent',border:'none',color:'#888','font-size':'20px',cursor:'pointer',padding:'5px 10px',transition:'color 0.2s'},onClick:n[25]||(n[25]=e=>F.value=!1),onMouseenter:n[26]||(n[26]=e=>e.target.style.color='#fff'),onMouseleave:n[27]||(n[27]=e=>e.target.style.color='#888')},[...n[98]||(n[98]=[(0,i.createElementVNode)('i',{class:'fa-solid fa-times'},null,-1)])],32)]),(0,i.createElementVNode)('div',Rd,[(0,i.createCommentVNode)(' æ¡ç›®åç§° '),(0,i.createElementVNode)('div',null,[n[100]||(n[100]=(0,i.createElementVNode)('label',{style:{display:'block','margin-bottom':'8px',color:'#e0e0e0','font-size':'14px','font-weight':'500'}},' æ¡ç›®åç§°ï¼š ',-1)),(0,i.withDirectives)((0,i.createElementVNode)('input',{'onUpdate:modelValue':n[28]||(n[28]=e=>L.value.name=e),type:'text',style:{width:'100%',padding:'12px',background:'#1a1a1a',border:'1px solid rgba(255, 255, 255, 0.1)','border-radius':'8px',color:'#e0e0e0','font-size':'14px'}},null,512),[[i.vModelText,L.value.name]])]),(0,i.createCommentVNode)(' å¯ç”¨çŠ¶æ€ '),(0,i.createElementVNode)('div',Od,[(0,i.withDirectives)((0,i.createElementVNode)('input',{id:'entry-enabled','onUpdate:modelValue':n[29]||(n[29]=e=>L.value.enabled=e),type:'checkbox',style:{width:'18px',height:'18px',cursor:'pointer'}},null,512),[[i.vModelCheckbox,L.value.enabled]]),n[101]||(n[101]=(0,i.createElementVNode)('label',{for:'entry-enabled',style:{color:'#e0e0e0','font-size':'14px',cursor:'pointer'}},' å¯ç”¨æ­¤æ¡ç›® ',-1))]),(0,i.createCommentVNode)(' ä¸»è¦å…³é”®å­— '),(0,i.createElementVNode)('div',null,[n[102]||(n[102]=(0,i.createElementVNode)('label',{style:{display:'block','margin-bottom':'8px',color:'#e0e0e0','font-size':'14px','font-weight':'500'}},' ä¸»è¦å…³é”®å­—ï¼š ',-1)),(0,i.createElementVNode)('input',{value:(L.value.strategy?.keys||[]).map(e=>'string'==typeof e?e:String(e)).join(','),type:'text',placeholder:'ç”¨é€—å·åˆ†éš”ï¼Œå¦‚ï¼šè‰¾è‰å¨…,Aria,ç²¾çµ,{{char}}',style:{width:'100%',padding:'12px',background:'#1a1a1a',border:'1px solid rgba(255, 255, 255, 0.1)','border-radius':'8px',color:'#e0e0e0','font-size':'14px'},onInput:n[30]||(n[30]=e=>{const n=e.target.value.split(',').filter(e=>e.trim()).map(e=>e.trim());L.value.strategy={...L.value.strategy,keys:n,keys_secondary:L.value.strategy?.keys_secondary||{logic:'and_any',keys:[]},scan_depth:L.value.strategy?.scan_depth||'same_as_global',type:L.value.strategy?.type||'selective'}})},null,40,Fd)]),(0,i.createCommentVNode)(' è§¦å‘ç±»å‹ '),(0,i.createElementVNode)('div',null,[n[104]||(n[104]=(0,i.createElementVNode)('label',{style:{display:'block','margin-bottom':'8px',color:'#e0e0e0','font-size':'14px','font-weight':'500'}},' è§¦å‘ç±»å‹ï¼š ',-1)),(0,i.createElementVNode)('select',{value:L.value.strategy?.type||'selective',style:{width:'100%',padding:'12px',background:'#1a1a1a',border:'1px solid rgba(255, 255, 255, 0.1)','border-radius':'8px',color:'#e0e0e0','font-size':'14px',cursor:'pointer'},onChange:n[31]||(n[31]=e=>L.value.strategy={...L.value.strategy,type:e.target.value,keys:L.value.strategy?.keys||[],keys_secondary:L.value.strategy?.keys_secondary||{logic:'and_any',keys:[]},scan_depth:L.value.strategy?.scan_depth||'same_as_global'})},[...n[103]||(n[103]=[(0,i.createElementVNode)('option',{value:'selective'},'ç»¿ç¯ (å¯é€‰é¡¹)',-1),(0,i.createElementVNode)('option',{value:'constant'},'è“ç¯ (å¸¸é‡)',-1)])],40,Ld)]),(0,i.createCommentVNode)(' æ’å…¥ä½ç½® '),(0,i.createElementVNode)('div',null,[n[106]||(n[106]=(0,i.createElementVNode)('label',{style:{display:'block','margin-bottom':'8px',color:'#e0e0e0','font-size':'14px','font-weight':'500'}},' æ’å…¥ä½ç½®ï¼š ',-1)),(0,i.createElementVNode)('select',{value:L.value.position?.type||'before_character_definition',style:{width:'100%',padding:'12px',background:'#1a1a1a',border:'1px solid rgba(255, 255, 255, 0.1)','border-radius':'8px',color:'#e0e0e0','font-size':'14px',cursor:'pointer'},onChange:n[32]||(n[32]=e=>L.value.position={...L.value.position,type:e.target.value,role:L.value.position?.role||'system',depth:L.value.position?.depth||0,order:L.value.position?.order||0})},[...n[105]||(n[105]=[(0,i.createStaticVNode)('<option value="before_character_definition" data-v-14fcd832>è§’è‰²å®šä¹‰ä¹‹å‰</option><option value="after_character_definition" data-v-14fcd832>è§’è‰²å®šä¹‰ä¹‹å</option><option value="before_example_messages" data-v-14fcd832>ç¤ºä¾‹æ¶ˆæ¯ä¹‹å‰</option><option value="after_example_messages" data-v-14fcd832>ç¤ºä¾‹æ¶ˆæ¯ä¹‹å</option><option value="before_author_note" data-v-14fcd832>ä½œè€…æ³¨é‡Šä¹‹å‰</option><option value="after_author_note" data-v-14fcd832>ä½œè€…æ³¨é‡Šä¹‹å</option><option value="at_depth" data-v-14fcd832>æ’å…¥åˆ°æŒ‡å®šæ·±åº¦</option>',7)])],40,Hd)]),(0,i.createCommentVNode)(' æ·±åº¦å’Œé¡ºåº '),(0,i.createElementVNode)('div',Ud,[(0,i.createElementVNode)('div',null,[n[107]||(n[107]=(0,i.createElementVNode)('label',{style:{display:'block','margin-bottom':'8px',color:'#e0e0e0','font-size':'14px','font-weight':'500'}},' æ·±åº¦ï¼š ',-1)),(0,i.createElementVNode)('input',{value:L.value.position?.depth||0,type:'number',style:{width:'100%',padding:'12px',background:'#1a1a1a',border:'1px solid rgba(255, 255, 255, 0.1)','border-radius':'8px',color:'#e0e0e0','font-size':'14px'},onInput:n[33]||(n[33]=e=>L.value.position={...L.value.position,depth:Number(e.target.value)||0,role:L.value.position?.role||'system',order:L.value.position?.order||0,type:L.value.position?.type||'before_character_definition'})},null,40,Gd)]),(0,i.createElementVNode)('div',null,[n[108]||(n[108]=(0,i.createElementVNode)('label',{style:{display:'block','margin-bottom':'8px',color:'#e0e0e0','font-size':'14px','font-weight':'500'}},' é¡ºåºï¼š ',-1)),(0,i.createElementVNode)('input',{value:L.value.position?.order||0,type:'number',style:{width:'100%',padding:'12px',background:'#1a1a1a',border:'1px solid rgba(255, 255, 255, 0.1)','border-radius':'8px',color:'#e0e0e0','font-size':'14px'},onInput:n[34]||(n[34]=e=>L.value.position={...L.value.position,order:Number(e.target.value)||0,type:L.value.position?.type||'before_character_definition',role:L.value.position?.role||'system',depth:L.value.position?.depth||0})},null,40,Yd)])]),(0,i.createCommentVNode)(' é€’å½’è®¾ç½® '),(0,i.createElementVNode)('div',Jd,[n[112]||(n[112]=(0,i.createElementVNode)('label',{style:{display:'block','margin-bottom':'12px',color:'#e0e0e0','font-size':'14px','font-weight':'600'}},' é€’å½’è®¾ç½®ï¼š ',-1)),(0,i.createElementVNode)('div',Wd,[(0,i.createElementVNode)('label',qd,[(0,i.createElementVNode)('input',{type:'checkbox',checked:L.value.recursion?.prevent_incoming||!1,onChange:n[35]||(n[35]=e=>L.value.recursion={...L.value.recursion,prevent_incoming:e.target.checked,prevent_outgoing:L.value.recursion?.prevent_outgoing||!1,delay_until:L.value.recursion?.delay_until||null})},null,40,Kd),n[109]||(n[109]=(0,i.createTextVNode)(' ç¦æ­¢å…¶ä»–æ¡ç›®é€’å½’æ¿€æ´»æœ¬æ¡ç›® ',-1))]),(0,i.createElementVNode)('label',Xd,[(0,i.createElementVNode)('input',{type:'checkbox',checked:L.value.recursion?.prevent_outgoing||!1,onChange:n[36]||(n[36]=e=>L.value.recursion={...L.value.recursion,prevent_outgoing:e.target.checked,prevent_incoming:L.value.recursion?.prevent_incoming||!1,delay_until:L.value.recursion?.delay_until||null})},null,40,Qd),n[110]||(n[110]=(0,i.createTextVNode)(' ç¦æ­¢æœ¬æ¡ç›®é€’å½’æ¿€æ´»å…¶ä»–æ¡ç›® ',-1))]),(0,i.createElementVNode)('div',null,[n[111]||(n[111]=(0,i.createElementVNode)('label',{style:{color:'#ccc','font-size':'13px',display:'block','margin-bottom':'5px'}},' å»¶è¿Ÿåˆ°ç¬¬ n çº§é€’å½’ï¼š ',-1)),(0,i.createElementVNode)('input',{value:L.value.recursion?.delay_until||'',type:'number',placeholder:'ç•™ç©ºè¡¨ç¤ºä¸å»¶è¿Ÿ',style:{width:'100%',padding:'8px',background:'#2a2a2a',border:'1px solid rgba(255, 255, 255, 0.1)','border-radius':'6px',color:'#e0e0e0','font-size':'13px'},onInput:n[37]||(n[37]=e=>L.value.recursion={...L.value.recursion,delay_until:''===e.target.value?null:Number(e.target.value),prevent_incoming:L.value.recursion?.prevent_incoming||!1,prevent_outgoing:L.value.recursion?.prevent_outgoing||!1})},null,40,Zd)])])]),(0,i.createCommentVNode)(' æ¡ç›®å†…å®¹ '),(0,i.createElementVNode)('div',null,[n[113]||(n[113]=(0,i.createElementVNode)('label',{style:{display:'block','margin-bottom':'8px',color:'#e0e0e0','font-size':'14px','font-weight':'500'}},' æ¡ç›®å†…å®¹ï¼š ',-1)),(0,i.withDirectives)((0,i.createElementVNode)('textarea',{'onUpdate:modelValue':n[38]||(n[38]=e=>L.value.content=e),style:{width:'100%','min-height':'200px',padding:'12px',background:'#1a1a1a',border:'1px solid rgba(255, 255, 255, 0.1)','border-radius':'8px',color:'#e0e0e0','font-size':'14px',resize:'vertical','font-family':'inherit'}},null,512),[[i.vModelText,L.value.content]])])]),(0,i.createCommentVNode)(' å¯¹è¯æ¡†æŒ‰é’® '),(0,i.createElementVNode)('div',ec,[(0,i.createElementVNode)('button',{style:{padding:'10px 20px',background:'#444',border:'none','border-radius':'8px',color:'white','font-size':'14px',cursor:'pointer',transition:'all 0.2s'},onClick:n[39]||(n[39]=e=>F.value=!1),onMouseenter:n[40]||(n[40]=e=>e.target.style.background='#555'),onMouseleave:n[41]||(n[41]=e=>e.target.style.background='#444')},' å–æ¶ˆ ',32),(0,i.createElementVNode)('button',{style:{padding:'10px 20px',background:'#4a9eff',border:'none','border-radius':'8px',color:'white','font-size':'14px','font-weight':'600',cursor:'pointer',transition:'all 0.2s'},onClick:fe,onMouseenter:n[42]||(n[42]=e=>e.target.style.background='#5ba8ff'),onMouseleave:n[43]||(n[43]=e=>e.target.style.background='#4a9eff')},[...n[114]||(n[114]=[(0,i.createElementVNode)('i',{class:'fa-solid fa-save',style:{'margin-right':'6px'}},null,-1),(0,i.createTextVNode)(' ä¿å­˜ ',-1)])],32)])])])):(0,i.createCommentVNode)('v-if',!0),(0,i.createCommentVNode)(' è§’è‰²å¡ç”Ÿæˆå·¥å…· '),(0,i.createElementVNode)('div',nc,[(0,i.createElementVNode)('div',{class:'section-header',style:{display:'flex','justify-content':'space-between','align-items':'center',padding:'15px 20px',background:'linear-gradient(\n            135deg,\n            rgba(30, 30, 30, 0.95) 0%,\n            rgba(38, 38, 38, 0.9) 50%,\n            rgba(30, 30, 30, 0.95) 100%\n          )','backdrop-filter':'blur(12px)','border-radius':'12px','margin-bottom':'15px',border:'1px solid rgba(255, 255, 255, 0.06)','box-shadow':'0 3px 12px rgba(0, 0, 0, 0.3),\n            inset 0 1px 0 rgba(255, 255, 255, 0.04),\n            inset 0 -1px 0 rgba(0, 0, 0, 0.2)',cursor:'pointer',transition:'all 0.3s ease'},onClick:n[45]||(n[45]=e=>J('characterCard')),onMouseenter:n[46]||(n[46]=e=>e.currentTarget.style.transform='translateY(-1px)'),onMouseleave:n[47]||(n[47]=e=>e.currentTarget.style.transform='translateY(0)')},[n[115]||(n[115]=(0,i.createElementVNode)('h4',{style:{margin:'0',color:'#fff','font-size':'16px','font-weight':'600',display:'flex','align-items':'center',gap:'10px'}},[(0,i.createElementVNode)('i',{class:'fa-solid fa-user-plus',style:{color:'#17a2b8','font-size':'18px'}}),(0,i.createTextVNode)(' è§’è‰²å¡ç”Ÿæˆå·¥å…· ')],-1)),(0,i.createElementVNode)('i',{class:(0,i.normalizeClass)(W('characterCard')?'fa-solid fa-chevron-up':'fa-solid fa-chevron-down'),style:{color:'#ccc',transition:'transform 0.3s ease','font-size':'14px'}},null,2)],32),W('characterCard')?((0,i.openBlock)(),(0,i.createElementBlock)('div',tc,[n[128]||(n[128]=(0,i.createStaticVNode)('<div class="tool-instructions" data-v-14fcd832><p style="margin:0 0 8px 0;color:#ccc;font-size:12px;" data-v-14fcd832><i class="fa-solid fa-info-circle" style="margin-right:6px;color:#17a2b8;" data-v-14fcd832></i> è¾“å…¥è§’è‰²æè¿°ï¼ŒAIå°†è‡ªåŠ¨ç”Ÿæˆè§’è‰²å¡ï¼ˆYAML æ ¼å¼ï¼Œçº¯ä¸­æ–‡ï¼‰ã€‚ </p><p style="margin:0 0 6px 0;color:#4a9eff;font-size:11px;background:#1a1a1a;padding:6px;border-radius:4px;border-left:3px solid #17a2b8;" data-v-14fcd832> ğŸ’¡ åŒ…å«å†…å®¹ï¼šåŸºç¡€ä¿¡æ¯ã€å¤–è²Œèº«æã€æ ¸å¿ƒæ€§æ ¼ã€å¯¹è¯é£æ ¼ã€èƒŒæ™¯ç»å†ã€äººé™…å…³ç³»ã€æ¼”ç»æŒ‡å¯¼ </p><p style="margin:0 0 6px 0;color:#ffa500;font-size:11px;background:#1a1a1a;padding:6px;border-radius:4px;border-left:3px solid #ffa500;" data-v-14fcd832> âš ï¸ æ³¨æ„ï¼šèº«é«˜ä½“é‡ä½¿ç”¨æ–‡å­—æè¿°ï¼ˆå¦‚&quot;é«˜å¤§åŒ€ç§°&quot;ï¼‰ï¼Œé¿å…AIåˆ»æ¿åŒ–ï¼Œæœ‰æ€§æ ¼å¯¹ç«‹é¢å’Œä¿®å¤æœºåˆ¶ </p></div>',1)),(0,i.createElementVNode)('div',ac,[n[116]||(n[116]=(0,i.createElementVNode)('label',{style:{display:'block','margin-bottom':'8px',color:'#ccc','font-size':'13px','font-weight':'500'}},' è§’è‰²æè¿°ï¼š ',-1)),(0,i.withDirectives)((0,i.createElementVNode)('textarea',{'onUpdate:modelValue':n[48]||(n[48]=e=>f.value=e),placeholder:'è¯·æè¿°è§’è‰²çš„åŸºæœ¬ä¿¡æ¯ï¼Œå¦‚å¤–è§‚ã€æ€§æ ¼ã€èƒŒæ™¯ç­‰...',style:{width:'100%',height:'120px',padding:'12px',background:'#2a2a2a',border:'1px solid #3a3a3a','border-radius':'6px',color:'#e0e0e0','font-size':'13px',resize:'vertical','font-family':'inherit'}},null,512),[[i.vModelText,f.value]])]),(0,i.createCommentVNode)(' æµå¼ä¼ è¾“å¼€å…³ '),(0,i.createElementVNode)('div',oc,[(0,i.createElementVNode)('label',rc,[(0,i.withDirectives)((0,i.createElementVNode)('input',{'onUpdate:modelValue':n[49]||(n[49]=e=>w.value=e),type:'checkbox',style:{cursor:'pointer'}},null,512),[[i.vModelCheckbox,w.value]]),n[117]||(n[117]=(0,i.createTextVNode)(' å¯ç”¨æµå¼ä¼ è¾“ï¼ˆå¯æŸ¥çœ‹ç”Ÿæˆè¿›åº¦ï¼‰ ',-1))])]),(0,i.createCommentVNode)(' è¿›åº¦æ¡ '),h.value&&k.value>0?((0,i.openBlock)(),(0,i.createElementBlock)('div',sc,[(0,i.createElementVNode)('div',ic,[(0,i.createElementVNode)('div',{class:'progress-fill',style:(0,i.normalizeStyle)({width:k.value+'%',height:'100%',background:'linear-gradient(90deg, #17a2b8 0%, #138496 50%, #17a2b8 100%)',backgroundSize:'200% 100%',animation:w.value?'progress-slide 2s linear infinite':'none',transition:'width 0.3s ease'})},null,4)]),(0,i.createElementVNode)('div',lc,' ç”Ÿæˆä¸­... '+(0,i.toDisplayString)(k.value.toFixed(0))+'% ',1)])):(0,i.createCommentVNode)('v-if',!0),(0,i.createElementVNode)('div',dc,[(0,i.createElementVNode)('button',{class:'generate-button',disabled:h.value||!f.value.trim(),style:{padding:'12px 24px',background:'linear-gradient(135deg, #17a2b8 0%, #138496 100%)',border:'none','border-radius':'8px',color:'white','font-size':'13px','font-weight':'600',cursor:'pointer',transition:'all 0.3s ease','box-shadow':'0 3px 12px rgba(23, 162, 184, 0.3)',position:'relative',overflow:'hidden'},onClick:Z},[n[118]||(n[118]=(0,i.createElementVNode)('div',{style:{position:'absolute',top:'0',left:'-100%',width:'100%',height:'100%',background:'linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent)',transition:'left 0.5s'},class:'shimmer-effect'},null,-1)),n[119]||(n[119]=(0,i.createElementVNode)('i',{class:'fa-solid fa-magic',style:{'font-size':'14px','margin-right':'6px'}},null,-1)),(0,i.createTextVNode)(' '+(0,i.toDisplayString)(h.value?'ç”Ÿæˆä¸­...':'ç”Ÿæˆè§’è‰²å¡'),1)],8,cc),(0,i.createElementVNode)('button',{class:'clear-button',style:{padding:'12px 24px',background:'linear-gradient(135deg, #ff6b6b 0%, #ee5a24 100%)',border:'none','border-radius':'8px',color:'white','font-size':'13px','font-weight':'600',cursor:'pointer',transition:'all 0.3s ease','box-shadow':'0 3px 12px rgba(255, 107, 107, 0.3)',position:'relative',overflow:'hidden'},onClick:ee},[...n[120]||(n[120]=[(0,i.createElementVNode)('div',{style:{position:'absolute',top:'0',left:'-100%',width:'100%',height:'100%',background:'linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent)',transition:'left 0.5s'},class:'shimmer-effect'},null,-1),(0,i.createElementVNode)('i',{class:'fa-solid fa-trash',style:{'font-size':'14px','margin-right':'6px'}},null,-1),(0,i.createTextVNode)(' æ¸…ç©º ',-1)])])]),(0,i.createCommentVNode)(' è¾“å‡ºåŒºåŸŸ '),x.value?((0,i.openBlock)(),(0,i.createElementBlock)('div',pc,[n[127]||(n[127]=(0,i.createElementVNode)('h5',{style:{margin:'0 0 12px 0',color:'#fff','font-size':'14px','font-weight':'600'}},[(0,i.createElementVNode)('i',{class:'fa-solid fa-check-circle',style:{'margin-right':'6px',color:'#28a745'}}),(0,i.createTextVNode)(' ç”Ÿæˆçš„è§’è‰²å¡ï¼š ')],-1)),(0,i.createElementVNode)('div',gc,(0,i.toDisplayString)(x.value),1),(0,i.createElementVNode)('div',{class:'output-actions',style:{'margin-top':'12px',display:'flex',gap:'12px'}},[(0,i.createElementVNode)('button',{class:'copy-button',style:{padding:'10px 20px',background:'linear-gradient(135deg, #28a745 0%, #20c997 100%)',border:'none','border-radius':'6px',color:'white','font-size':'13px','font-weight':'600',cursor:'pointer',transition:'all 0.3s ease',display:'flex','align-items':'center',gap:'8px','box-shadow':'0 3px 12px rgba(40, 167, 69, 0.3)',position:'relative',overflow:'hidden'},onClick:ne},[...n[121]||(n[121]=[(0,i.createElementVNode)('div',{style:{position:'absolute',top:'0',left:'-100%',width:'100%',height:'100%',background:'linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent)',transition:'left 0.5s'},class:'shimmer-effect'},null,-1),(0,i.createElementVNode)('i',{class:'fa-solid fa-copy',style:{'font-size':'14px'}},null,-1),(0,i.createTextVNode)(' å¤åˆ¶è§’è‰²å¡ ',-1)])])]),(0,i.createCommentVNode)(' è§’è‰²å¡ä¿®æ”¹åŒºåŸŸ '),(0,i.createElementVNode)('div',uc,[n[126]||(n[126]=(0,i.createStaticVNode)('<h5 style="margin:0 0 12px 0;color:#fff;font-size:14px;font-weight:600;" data-v-14fcd832><i class="fa-solid fa-edit" style="margin-right:6px;color:#ffa500;" data-v-14fcd832></i> ä¿®æ”¹è§’è‰²å¡ </h5><div class="modify-instructions" style="background:#1a1a1a;border:1px solid #3a3a3a;border-radius:6px;padding:10px;margin-bottom:15px;" data-v-14fcd832><p style="margin:0 0 6px 0;color:#ccc;font-size:12px;" data-v-14fcd832><i class="fa-solid fa-lightbulb" style="margin-right:6px;color:#ffa500;" data-v-14fcd832></i> æè¿°ä½ æƒ³è¦ä¿®æ”¹çš„å†…å®¹ï¼ŒAIä¼šæ ¹æ®ä½ çš„éœ€æ±‚è°ƒæ•´è§’è‰²å¡ã€‚ä¾‹å¦‚ï¼š&quot;è®©è§’è‰²æ›´æ´»æ³¼ä¸€äº›&quot;ã€&quot;å¢åŠ é­”æ³•æŠ€èƒ½&quot;ã€&quot;æ”¹ä¸ºå¥³æ€§è§’è‰²&quot;ç­‰ã€‚ </p><p style="margin:0;color:#ffa500;font-size:11px;" data-v-14fcd832>âš ï¸ ä¿®æ”¹åä¼šä¿æŒ YAML æ ¼å¼å’Œä¸­æ–‡å­—æ®µã€‚</p></div>',2)),(0,i.createElementVNode)('div',mc,[n[122]||(n[122]=(0,i.createElementVNode)('label',{style:{display:'block','margin-bottom':'8px',color:'#ccc','font-size':'13px','font-weight':'500'}},' ä¿®æ”¹éœ€æ±‚ï¼š ',-1)),(0,i.withDirectives)((0,i.createElementVNode)('textarea',{'onUpdate:modelValue':n[50]||(n[50]=e=>y.value=e),placeholder:'è¯·æè¿°ä½ æƒ³è¦ä¿®æ”¹çš„å†…å®¹...',style:{width:'100%',height:'80px',padding:'12px',background:'#2a2a2a',border:'1px solid #3a3a3a','border-radius':'6px',color:'#e0e0e0','font-size':'13px',resize:'vertical','font-family':'inherit'}},null,512),[[i.vModelText,y.value]])]),(0,i.createCommentVNode)(' ä¿®æ”¹è¿›åº¦æ¡ '),v.value&&k.value>0?((0,i.openBlock)(),(0,i.createElementBlock)('div',fc,[(0,i.createElementVNode)('div',xc,[(0,i.createElementVNode)('div',{class:'progress-fill',style:(0,i.normalizeStyle)({width:k.value+'%',height:'100%',background:'linear-gradient(90deg, #17a2b8 0%, #138496 50%, #17a2b8 100%)',backgroundSize:'200% 100%',animation:w.value?'progress-slide 2s linear infinite':'none',transition:'width 0.3s ease'})},null,4)]),(0,i.createElementVNode)('div',bc,' ä¿®æ”¹ä¸­... '+(0,i.toDisplayString)(k.value.toFixed(0))+'% ',1)])):(0,i.createCommentVNode)('v-if',!0),(0,i.createElementVNode)('div',hc,[(0,i.createElementVNode)('button',{class:'modify-button',disabled:v.value||!y.value.trim(),style:{padding:'12px 24px',background:'linear-gradient(135deg, #ffa500 0%, #ff8c00 100%)',border:'none','border-radius':'8px',color:'white','font-size':'13px','font-weight':'600',cursor:'pointer',transition:'all 0.3s ease','box-shadow':'0 3px 12px rgba(255, 165, 0, 0.3)',position:'relative',overflow:'hidden'},onClick:ae},[n[123]||(n[123]=(0,i.createElementVNode)('div',{style:{position:'absolute',top:'0',left:'-100%',width:'100%',height:'100%',background:'linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent)',transition:'left 0.5s'},class:'shimmer-effect'},null,-1)),n[124]||(n[124]=(0,i.createElementVNode)('i',{class:'fa-solid fa-wand-magic-sparkles',style:{'font-size':'14px','margin-right':'6px'}},null,-1)),(0,i.createTextVNode)(' '+(0,i.toDisplayString)(v.value?'ä¿®æ”¹ä¸­...':'AIä¿®æ”¹'),1)],8,yc),(0,i.createElementVNode)('button',{class:'clear-modify-button',style:{padding:'12px 24px',background:'linear-gradient(135deg, #6c757d 0%, #5a6268 100%)',border:'none','border-radius':'8px',color:'white','font-size':'13px','font-weight':'600',cursor:'pointer',transition:'all 0.3s ease','box-shadow':'0 3px 12px rgba(108, 117, 125, 0.3)',position:'relative',overflow:'hidden'},onClick:oe},[...n[125]||(n[125]=[(0,i.createElementVNode)('div',{style:{position:'absolute',top:'0',left:'-100%',width:'100%',height:'100%',background:'linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent)',transition:'left 0.5s'},class:'shimmer-effect'},null,-1),(0,i.createElementVNode)('i',{class:'fa-solid fa-eraser',style:{'font-size':'14px','margin-right':'6px'}},null,-1),(0,i.createTextVNode)(' æ¸…ç©ºä¿®æ”¹éœ€æ±‚ ',-1)])])])])])):(0,i.createCommentVNode)('v-if',!0)])):(0,i.createCommentVNode)('v-if',!0)])]))}});s(368);const wc=(0,V.A)(vc,[['__scopeId','data-v-14fcd832']]),kc={class:'memory-panel-container',style:{display:'flex','flex-direction':'column',height:'100%',background:'#1a1a1a',color:'#e0e0e0'}},Ac={class:'panel-header',style:{padding:'15px 20px',background:'#2a2a2a','border-bottom':'1px solid #3a3a3a',display:'flex','justify-content':'space-between','align-items':'center','border-radius':'8px 8px 0 0','flex-shrink':'0'}},Cc={class:'header-left',style:{display:'flex','align-items':'center',gap:'10px'}},Ec={class:'panel-title'},Tc={class:'panel-title-mobile'},Sc={style:{display:'flex',gap:'10px','align-items':'center'}},Nc=['title'],Ic=['title'],_c=['title'],Vc={class:'panel-tabs',style:{display:'flex',background:'#2a2a2a','border-bottom':'1px solid #3a3a3a','flex-shrink':'0'}},zc=['onClick'],Bc={class:'tab-label'},Mc={class:'panel-content',style:{flex:'1','overflow-y':'auto','overflow-x':'hidden',padding:'0','min-height':'0','scrollbar-width':'thin','scrollbar-color':'#4a9eff #2a2a2a'}},Pc=(0,i.defineComponent)({__name:'MainPanel',setup(e){const{t:n,locale:t}=a(),o=(0,i.computed)(()=>t.value),r=(0,i.computed)(()=>[{key:'settings',label:n('tabs.settings'),icon:'fa-solid fa-cog'},{key:'summary',label:n('tabs.history'),icon:'fa-solid fa-list'},{key:'table',label:n('tabs.table'),icon:'fa-solid fa-table'},{key:'greetings',label:n('tabs.greetings'),icon:'fa-solid fa-comments'},{key:'regex',label:n('tabs.regex'),icon:'fa-solid fa-code'},{key:'status',label:n('tabs.state'),icon:'fa-solid fa-chart-bar'},{key:'project',label:n('tabs.projects'),icon:'fa-solid fa-laptop-code'},{key:'tools',label:n('tabs.tools'),icon:'fa-solid fa-tools'},{key:'mvu',label:n('tabs.mvu'),icon:'fa-solid fa-flask'},{key:'help',label:n('tabs.help'),icon:'fa-solid fa-question-circle'}]),s=(0,i.ref)('settings'),l={settings:ms,summary:Pi,table:el,greetings:Ae,status:xi,regex:lr,project:Fo,tools:wc,mvu:Zt,help:It},d=(0,i.computed)(()=>l[s.value]),c=(0,i.computed)(()=>({activeTab:s.value})),p=()=>{const e='zh-CN'===t.value?'en-US':'zh-CN';t.value=e,localStorage.setItem('maomao_tool_locale',e),toastr.success('zh-CN'===e?'å·²åˆ‡æ¢åˆ°ä¸­æ–‡':'Switched to English')},g=()=>{!function(){const e=$('#memoryManagementPanel');if(0===e.length)return;e.fadeOut(200,()=>{(function(){$('#memoryPanelMinimizeIcon').remove();const e=window.innerWidth<=768,n=$(`\n    <div id="memoryPanelMinimizeIcon" style="\n      position: fixed;\n      top: ${e?'15px':'20px'};\n      right: ${e?'15px':'20px'};\n      width: ${e?'50px':'60px'};\n      height: ${e?'50px':'60px'};\n      background: #2a2a2a;\n      border: 2px solid #4a9eff;\n      border-radius: 50%;\n      display: flex;\n      align-items: center;\n      justify-content: center;\n      cursor: pointer;\n      z-index: 999998;\n      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.5);\n      transition: transform 0.2s, box-shadow 0.2s;\n      font-size: ${e?'26px':'32px'};\n    ">\n      ğŸ±\n    </div>\n  `);return n.hover(function(){$(this).css({transform:'scale(1.1)',boxShadow:'0 4px 20px rgba(74, 158, 255, 0.5)'})},function(){$(this).css({transform:'scale(1)',boxShadow:'0 2px 10px rgba(0, 0, 0, 0.5)'})}),n.on('click',()=>{$('#memoryManagementPanel').fadeIn(200),n.fadeOut(200,()=>n.remove())}),n.draggable({containment:'window',scroll:!1,start:function(){$(this).css('transition','none')},stop:function(){$(this).css('transition','')}}),$('body').append(n),n})().hide().fadeIn(200)})}()},u=()=>{$('#memoryManagementPanel').fadeOut(200)};return(e,t)=>((0,i.openBlock)(),(0,i.createElementBlock)('div',kc,[(0,i.createCommentVNode)(' é¢æ¿å¤´éƒ¨ '),(0,i.createElementVNode)('div',Ac,[(0,i.createElementVNode)('div',Cc,[t[0]||(t[0]=(0,i.createElementVNode)('span',{style:{'font-size':'24px'}},'ğŸ±',-1)),(0,i.createElementVNode)('b',Ec,(0,i.toDisplayString)((0,i.unref)(n)('panel.title')),1),(0,i.createElementVNode)('b',Tc,(0,i.toDisplayString)('zh-CN'===o.value?'çŒ«çŒ«çš„å°ç ´çƒ‚':'mzrodyu\'s Tool'),1)]),(0,i.createElementVNode)('div',Sc,[(0,i.createCommentVNode)(' è¯­è¨€åˆ‡æ¢æŒ‰é’® '),(0,i.createElementVNode)('div',{class:'language-button',style:{cursor:'pointer',padding:'5px 10px','border-radius':'4px',transition:'background 0.2s','font-size':'14px',display:'flex','align-items':'center',gap:'5px'},title:'zh-CN'===o.value?'Switch to English':'åˆ‡æ¢åˆ°ä¸­æ–‡',onClick:p},[t[1]||(t[1]=(0,i.createElementVNode)('i',{class:'fa-solid fa-language'},null,-1)),(0,i.createElementVNode)('span',null,(0,i.toDisplayString)('zh-CN'===o.value?'EN':'ä¸­'),1)],8,Nc),(0,i.createElementVNode)('div',{class:'minimize-button',style:{cursor:'pointer',padding:'5px 10px','border-radius':'4px',transition:'background 0.2s'},title:(0,i.unref)(n)('panel.minimize'),onClick:g},[...t[2]||(t[2]=[(0,i.createElementVNode)('i',{class:'fa-solid fa-minus'},null,-1)])],8,Ic),(0,i.createElementVNode)('div',{class:'close-button',style:{cursor:'pointer',padding:'5px 10px','border-radius':'4px',transition:'background 0.2s'},title:'zh-CN'===o.value?'å…³é—­':'Close',onClick:u},[...t[3]||(t[3]=[(0,i.createElementVNode)('i',{class:'fa-solid fa-times'},null,-1)])],8,_c)])]),(0,i.createCommentVNode)(' é¢æ¿æ ‡ç­¾æ  '),(0,i.createElementVNode)('div',Vc,[((0,i.openBlock)(!0),(0,i.createElementBlock)(i.Fragment,null,(0,i.renderList)(r.value,e=>((0,i.openBlock)(),(0,i.createElementBlock)('div',{key:e.key,class:(0,i.normalizeClass)([{'tab-active':s.value===e.key},'tab-item']),style:(0,i.normalizeStyle)({flex:'1',padding:'12px 20px',cursor:'pointer',textAlign:'center',transition:'background 0.2s, color 0.2s',display:'flex',alignItems:'center',justifyContent:'center',gap:'8px',borderBottom:'2px solid transparent',backgroundColor:s.value===e.key?'#1a1a1a':'transparent',color:s.value===e.key?'#4a9eff':'#e0e0e0',borderBottomColor:s.value===e.key?'#4a9eff':'transparent'}),onClick:n=>{return t=e.key,console.log('åˆ‡æ¢æ ‡ç­¾é¡µ:',t),void(s.value=t);var t}},[(0,i.createElementVNode)('i',{class:(0,i.normalizeClass)(e.icon)},null,2),(0,i.createElementVNode)('span',Bc,(0,i.toDisplayString)(e.label),1)],14,zc))),128))]),(0,i.createCommentVNode)(' é¢æ¿å†…å®¹ '),(0,i.createElementVNode)('div',Mc,[((0,i.openBlock)(),(0,i.createBlock)((0,i.resolveDynamicComponent)(d.value),(0,i.mergeProps)({key:s.value},c.value),null,16))])]))}});s(63);const $c=(0,V.A)(Pc,[['__scopeId','data-v-67eefd1a']]),Dc=(0,i.defineComponent)({__name:'æµ®åŠ¨é¢æ¿',setup:e=>(e,n)=>((0,i.openBlock)(),(0,i.createBlock)($c))});$(()=>{if(console.log('æµ®åŠ¨é¢æ¿.ts å¼€å§‹æ‰§è¡Œ'),0===$('#memory-panel-responsive-css').length){const e='\n      <style id="memory-panel-responsive-css">\n        /* æ¡Œé¢ç«¯ï¼ˆæ¨ªå±ï¼‰ï¼šéšè—ç§»åŠ¨ç«¯ä¸“ç”¨æ ‡é¢˜ */\n        .panel-title-mobile {\n          display: none;\n        }\n        \n        /* æ¡Œé¢ç«¯ï¼ˆæ¨ªå±ï¼‰ï¼šæ˜¾ç¤ºå®Œæ•´æ ‡é¢˜ */\n        .panel-title {\n          display: inline;\n        }\n        \n        /* ç§»åŠ¨ç«¯å…¨å±€æ ·å¼ï¼ˆç«–å± portraitï¼‰ */\n        @media (orientation: portrait) {\n          /* ç§»åŠ¨ç«¯ï¼šé¢æ¿å®¹å™¨å…¨å±æ˜¾ç¤º - ä½¿ç”¨æœ€é«˜ä¼˜å…ˆçº§è¦†ç›–å†…è”æ ·å¼ */\n          body #memoryManagementPanel {\n            position: fixed !important;\n            top: 0 !important;\n            left: 0 !important;\n            right: 0 !important;\n            bottom: 0 !important;\n            transform: none !important;\n            width: 100vw !important;\n            max-width: 100vw !important;\n            height: 100vh !important;\n            max-height: 100vh !important;\n            min-width: 100vw !important;\n            min-height: 100vh !important;\n            border-radius: 0 !important;\n            border: none !important;\n            margin: 0 !important;\n            padding: 0 !important;\n          }\n          \n          /* ç§»åŠ¨ç«¯ï¼šéšè—å®Œæ•´æ ‡é¢˜ï¼Œæ˜¾ç¤ºç®€çŸ­æ ‡é¢˜ */\n          .panel-title {\n            display: none !important;\n          }\n          \n          .panel-title-mobile {\n            display: inline !important;\n            font-size: 14px !important;\n          }\n          \n          /* ç§»åŠ¨ç«¯ï¼šéšè—æœ€å°åŒ–æŒ‰é’® */\n          .minimize-button {\n            display: none !important;\n          }\n          \n          /* ç§»åŠ¨ç«¯ï¼šè°ƒæ•´å¤´éƒ¨æ ·å¼ */\n          .panel-header {\n            padding: 10px 12px !important;\n            border-radius: 0 !important;\n          }\n          \n          .panel-header .header-left {\n            gap: 6px !important;\n          }\n          \n          .panel-header .header-left span {\n            font-size: 20px !important;\n          }\n          \n          .panel-header > div:last-child {\n            gap: 6px !important;\n          }\n          \n          .close-button {\n            padding: 4px 8px !important;\n          }\n          \n          /* ç§»åŠ¨ç«¯ï¼šæ ‡ç­¾æ å¯æ¨ªå‘æ»šåŠ¨ */\n          .panel-tabs {\n            overflow-x: auto !important;\n            overflow-y: hidden !important;\n            white-space: nowrap !important;\n            -webkit-overflow-scrolling: touch !important;\n          }\n          \n          .panel-tabs::-webkit-scrollbar {\n            height: 2px !important;\n          }\n          \n          .panel-tabs .tab-item {\n            flex: 0 0 auto !important;\n            padding: 10px 12px !important;\n            font-size: 12px !important;\n            gap: 4px !important;\n            min-width: auto !important;\n          }\n          \n          .panel-tabs .tab-item .tab-label {\n            white-space: nowrap !important;\n          }\n          \n          /* ç§»åŠ¨ç«¯ï¼šå†…å®¹åŒºåŸŸä¼˜åŒ– */\n          .memory-panel-container {\n            font-size: 14px !important;\n          }\n          \n          /* ç§»åŠ¨ç«¯ï¼šé¢æ¿å†…å®¹åŒºåŸŸæ»šåŠ¨ä¼˜åŒ– */\n          .panel-content {\n            overflow-y: auto !important;\n            overflow-x: hidden !important;\n            -webkit-overflow-scrolling: touch !important;\n            height: 100% !important;\n            padding: 12px !important;\n          }\n          \n          /* ç§»åŠ¨ç«¯ï¼šç¡®ä¿æ ‡ç­¾é¡µå†…å®¹ä¸è¶…å‡º */\n          .memory-panel-container .tab-content {\n            max-width: 100vw !important;\n            overflow-x: hidden !important;\n          }\n          \n          /* ç§»åŠ¨ç«¯ï¼šæŒ‰é’®ä¼˜åŒ– */\n          .memory-panel-container button,\n          .memory-panel-container .el-button {\n            padding: 10px 16px !important;\n            font-size: 13px !important;\n            min-height: 44px !important; /* iOSæ¨èçš„æœ€å°è§¦æ‘¸åŒºåŸŸ */\n          }\n          \n          /* ç§»åŠ¨ç«¯ï¼šæŒ‰é’®ç»„å †å ï¼ˆåªé’ˆå¯¹æŒ‰é’®ç»„ï¼Œä¸å½±å“ä¸»å¸ƒå±€ï¼‰ */\n          .memory-panel-container .button-group,\n          .memory-panel-container .project-action-buttons {\n            flex-direction: column !important;\n            gap: 8px !important;\n          }\n          \n          .memory-panel-container .button-group > *,\n          .memory-panel-container .button-group button,\n          .memory-panel-container .project-action-buttons > button {\n            width: 100% !important;\n            margin: 0 !important;\n          }\n          \n          /* ç§»åŠ¨ç«¯ï¼šå¯¹è¯æ¡†å†…çš„æŒ‰é’®å †å  */\n          .memory-panel-container .dialog-actions,\n          .memory-panel-container [style*="justify-content: flex-end"] {\n            flex-direction: column !important;\n            gap: 10px !important;\n          }\n          \n          .memory-panel-container .dialog-actions > button {\n            width: 100% !important;\n          }\n          \n          /* ç§»åŠ¨ç«¯ï¼šè¾“å…¥æ¡†ä¼˜åŒ– */\n          .memory-panel-container input,\n          .memory-panel-container textarea,\n          .memory-panel-container select {\n            font-size: 16px !important; /* é˜²æ­¢iOSè‡ªåŠ¨ç¼©æ”¾ */\n            padding: 12px !important;\n            min-height: 44px !important;\n          }\n          \n          .memory-panel-container textarea {\n            min-height: 120px !important;\n          }\n          \n          /* ç§»åŠ¨ç«¯ï¼šè¡¨å•é¡¹é—´è· */\n          .memory-panel-container .form-group,\n          .memory-panel-container [style*="margin"] {\n            margin-bottom: 16px !important;\n          }\n          \n          /* ç§»åŠ¨ç«¯ï¼šå¡ç‰‡/é¢æ¿å†…è¾¹è· */\n          .memory-panel-container .card,\n          .memory-panel-container .panel,\n          .memory-panel-container .section {\n            padding: 12px !important;\n            margin: 8px 0 !important;\n          }\n          \n          /* ç§»åŠ¨ç«¯ï¼šå­—æ®µç»„ä¼˜åŒ– */\n          .memory-panel-container .field-group,\n          .memory-panel-container [class*="field"] {\n            padding: 8px !important;\n            margin-bottom: 12px !important;\n          }\n          \n          /* ç§»åŠ¨ç«¯ï¼šå·¥å…·åŒºåŸŸä¼˜åŒ– */\n          .memory-panel-container .tool-section,\n          .memory-panel-container .section-content {\n            padding: 12px 8px !important;\n          }\n          \n          /* ç§»åŠ¨ç«¯ï¼šé¢„è§ˆåŒºåŸŸä¼˜åŒ– */\n          .memory-panel-container .preview-container,\n          .memory-panel-container [class*="preview"] {\n            padding: 8px !important;\n            max-width: 100% !important;\n            overflow-x: auto !important;\n          }\n          \n          /* ç§»åŠ¨ç«¯ï¼šæ ‡é¢˜å­—ä½“ */\n          .memory-panel-container h1,\n          .memory-panel-container h2,\n          .memory-panel-container h3,\n          .memory-panel-container h4,\n          .memory-panel-container h5 {\n            font-size: 16px !important;\n            margin-bottom: 12px !important;\n          }\n          \n          /* ç§»åŠ¨ç«¯ï¼šå¯¹è¯æ¡†å…¨å± */\n          .memory-panel-container .modal,\n          .memory-panel-container .dialog {\n            width: 100vw !important;\n            height: 100vh !important;\n            max-width: 100vw !important;\n            max-height: 100vh !important;\n            border-radius: 0 !important;\n            top: 0 !important;\n            left: 0 !important;\n            transform: none !important;\n          }\n          \n          /* ç§»åŠ¨ç«¯ï¼šæ»šåŠ¨æ¡ä¼˜åŒ– */\n          .memory-panel-container ::-webkit-scrollbar {\n            width: 3px !important;\n            height: 3px !important;\n          }\n          \n          /* ç§»åŠ¨ç«¯ï¼šå‡å°å­—æ®µé—´çš„gap */\n          .memory-panel-container [style*="gap: 1"] {\n            gap: 8px !important;\n          }\n          \n          .memory-panel-container [style*="gap: 2"] {\n            gap: 12px !important;\n          }\n          \n          /* ç§»åŠ¨ç«¯ï¼šå·¥å…·åŒºåŸŸæŒ‰é’®ç»„ä¼˜åŒ– */\n          .memory-panel-container .tool-section .button-group {\n            display: flex !important;\n            flex-direction: column !important;\n            width: 100% !important;\n          }\n          \n          /* ç§»åŠ¨ç«¯ï¼šçŠ¶æ€æ ç”Ÿæˆå™¨å­—æ®µä¼˜åŒ–ï¼ˆåªé’ˆå¯¹å­—æ®µï¼Œä¸å½±å“ä¸»å¸ƒå±€ï¼‰ */\n          .memory-panel-container .field-item {\n            flex-direction: column !important;\n            align-items: stretch !important;\n          }\n          \n          .memory-panel-container .field-item > * {\n            width: 100% !important;\n            margin-bottom: 8px !important;\n          }\n          \n          /* ç§»åŠ¨ç«¯ï¼šä¸¤æ å¸ƒå±€æ”¹ä¸ºå•åˆ—ï¼ˆåªé’ˆå¯¹è®¾ç½®é¡¹ï¼Œä¸å½±å“ä¸»å¸ƒå±€ï¼‰ */\n          .memory-panel-container [style*="display: grid"][style*="grid-template-columns: 1fr 1fr"] {\n            grid-template-columns: 1fr !important;\n          }\n          \n          /* ç§»åŠ¨ç«¯ï¼šåˆ é™¤/æ“ä½œæŒ‰é’®ä¼˜åŒ– */\n          .memory-panel-container .delete-button,\n          .memory-panel-container [class*="delete"],\n          .memory-panel-container .action-button {\n            min-width: 44px !important;\n            min-height: 44px !important;\n            padding: 8px !important;\n          }\n          \n          /* ç§»åŠ¨ç«¯ï¼šè¡¨å•labelä¼˜åŒ– */\n          .memory-panel-container label {\n            font-size: 13px !important;\n            margin-bottom: 6px !important;\n            display: block !important;\n          }\n          \n          /* ç§»åŠ¨ç«¯ï¼šé˜²æ­¢å†…å®¹è¶…å‡ºè§†å£ï¼ˆåªé’ˆå¯¹è¡¨å•å…ƒç´ å’Œæ–‡æœ¬ï¼‰ */\n          .memory-panel-container input,\n          .memory-panel-container textarea,\n          .memory-panel-container select,\n          .memory-panel-container button,\n          .memory-panel-container pre,\n          .memory-panel-container code {\n            max-width: 100% !important;\n            word-wrap: break-word !important;\n          }\n          \n          /* ç§»åŠ¨ç«¯ï¼šå­—æ®µæ ‡é¢˜åŒºåŸŸ */\n          .memory-panel-container .section-header {\n            padding: 16px !important;\n            font-size: 14px !important;\n            flex-direction: column !important;\n            align-items: stretch !important;\n            gap: 12px !important;\n          }\n          \n          .memory-panel-container .section-header h3 {\n            font-size: 15px !important;\n            margin-bottom: 0 !important;\n          }\n          \n          /* ç§»åŠ¨ç«¯ï¼šå‡å°‘ä¸å¿…è¦çš„ç©ºç™½ */\n          .memory-panel-container .empty-space,\n          .memory-panel-container [style*="padding: 20px"],\n          .memory-panel-container [style*="padding: 25px"] {\n            padding: 12px !important;\n          }\n        }\n      </style>\n    ';$('head').append(e),console.log('ğŸ“± ç§»åŠ¨ç«¯å“åº”å¼CSSå·²æ³¨å…¥')}setTimeout(()=>{console.log('æµ®åŠ¨é¢æ¿.ts setTimeout å›è°ƒæ‰§è¡Œ');const e=$('#memoryManagementPanel');e.length>0&&(console.log('mzrodyuçŒ«çŒ«çš„å°ç ´çƒ‚æµ®åŠ¨é¢æ¿å·²å­˜åœ¨ï¼Œå¼ºåˆ¶åˆ é™¤å¹¶é‡æ–°åˆ›å»º...'),e.remove(),setTimeout(()=>{console.log('æ—§é¢æ¿å·²åˆ é™¤ï¼Œå¼€å§‹åˆ›å»ºæ–°é¢æ¿...')},100)),console.log('ğŸš€ğŸš€ğŸš€ å¼€å§‹åˆ›å»ºé¢æ¿å®¹å™¨ - æ—¶é—´æˆ³:',(new Date).toISOString());const n=$('\n      <div id="memoryManagementPanel" style="\n        position: fixed;\n        top: 50%;\n        left: 50%;\n        transform: translate(-50%, -50%);\n        width: 95vw;\n        max-width: 1600px;\n        height: 92vh;\n        max-height: 92vh;\n        background: #1a1a1a;\n        border: 1px solid #3a3a3a;\n        border-radius: 8px;\n        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.5);\n        z-index: 999999;\n        display: flex;\n        flex-direction: column;\n        overflow: hidden;\n      ">\n      </div>\n    ');$('body').append(n),console.log('é¢æ¿å®¹å™¨å·²æ·»åŠ åˆ° body, å®¹å™¨å…ƒç´ :',n[0]),console.log('å‡†å¤‡åˆ›å»ºæ–°çš„ Vue åº”ç”¨ï¼Œé¢æ¿å®¹å™¨:',n[0]);const t=(0,i.createApp)(Dc).use((0,p.createPinia)()).use(g);try{t.mount(n[0]),console.log('Vue åº”ç”¨å·²æˆåŠŸæŒ‚è½½'),console.log('Vue å®ä¾‹:',n[0].__vue_app__),console.log('ğŸš€ åˆå§‹åŒ–ç‰ˆæœ¬æ£€æŸ¥å™¨...'),setTimeout(()=>{x(!1)},5e3)}catch(e){console.error('Vue åº”ç”¨æŒ‚è½½å¤±è´¥:',e),console.error('é”™è¯¯è¯¦æƒ…:',JSON.stringify(e,null,2)),console.error('é”™è¯¯å †æ ˆ:',e.stack)}console.log('mzrodyuçŒ«çŒ«çš„å°ç ´çƒ‚æµ®åŠ¨é¢æ¿å·²åˆ›å»ºï¼Œé¢æ¿å…ƒç´ :',n[0])},200)});s(560);$(()=>{setTimeout(()=>{let e=null;try{e=getScriptId?.()}catch(e){console.error('æ— æ³•è·å– script_id:',e)}if(!e)return console.error('æ— æ³•è·å– script_idï¼ŒmzrodyuçŒ«çŒ«çš„å°ç ´çƒ‚è„šæœ¬æ— æ³•æ­£å¸¸å·¥ä½œ'),void window.toastr.error('mzrodyuçŒ«çŒ«çš„å°ç ´çƒ‚è„šæœ¬åˆå§‹åŒ–å¤±è´¥');(0,d.aJ)(e),console.log('mzrodyuçŒ«çŒ«çš„å°ç ´çƒ‚è„šæœ¬å¼€å§‹åˆå§‹åŒ–ï¼Œscript_id:',e),setTimeout(()=>{try{eventOn(tavern_events.CHARACTER_MESSAGE_RENDERED,()=>{console.log('ğŸ“¨ æ”¶åˆ°æ¶ˆæ¯æ¸²æŸ“äº‹ä»¶ï¼Œæ£€æŸ¥è‡ªåŠ¨æ€»ç»“...'),(()=>{try{console.log('ğŸ” å¼€å§‹æ£€æŸ¥è‡ªåŠ¨æ€»ç»“...');const e=(0,l.C)();if(!e||!e.settings)return void console.warn('âŒ æ— æ³•è·å–è®¾ç½®ï¼Œè·³è¿‡è‡ªåŠ¨æ€»ç»“æ£€æŸ¥');const n=e.settings;if('boolean'!=typeof n.auto_summarize_enabled)return void console.warn('âŒ è‡ªåŠ¨æ€»ç»“è®¾ç½®æ— æ•ˆï¼Œè·³è¿‡æ£€æŸ¥');if('number'!=typeof n.summary_interval||n.summary_interval<1)return void console.warn('âŒ æ€»ç»“é—´éš”è®¾ç½®æ— æ•ˆï¼Œè·³è¿‡æ£€æŸ¥');if(console.log('ğŸ“‹ å½“å‰è®¾ç½®:',{auto_summarize_enabled:n.auto_summarize_enabled,summary_interval:n.summary_interval,has_api_key:!!n.api_key}),!n.auto_summarize_enabled)return void console.log('â¸ï¸ è‡ªåŠ¨æ€»ç»“æœªå¯ç”¨');if(!n.api_key)return void console.log('âŒ API Key æœªè®¾ç½®');const t=getLastMessageId(),a=SillyTavern.getCurrentChatId();if(!a)return void console.log('âŒ æ— æ³•è·å–èŠå¤©IDï¼Œè·³è¿‡è‡ªåŠ¨æ€»ç»“æ£€æŸ¥');let o=0;try{const e=getVariables({type:'chat'}),n='auto_summary_start_id';if(console.log('ğŸ” æ£€æŸ¥èŠå¤©å˜é‡:',{current_chat_id:a,chat_vars:e,has_start_id:void 0!==e[n],existing_start_id:e[n]}),void 0!==e[n]&&null!==e[n])o=e[n],console.log(`âœ… ä½¿ç”¨ç°æœ‰èµ·å§‹æ¥¼å±‚: ${o} (èŠå¤©: ${a})`);else{const e=(0,d.Ut)();if(!e)return void console.warn('script_id ä¸ºç©ºï¼Œæ— æ³•æ£€æŸ¥ç°æœ‰æ€»ç»“');const r=getVariables({type:'script',script_id:e}),s=Array.isArray(r?.summary_history)?r.summary_history:[];if(s.length>0){const e=s[0].end_id||0;t>e?(o=e+1,console.log(`ğŸ”„ é‡æ–°åŠ è½½èŠå¤©ï¼ŒåŸºäºç°æœ‰æ€»ç»“è®¾ç½®èµ·å§‹æ¥¼å±‚: ${o} (æœ€åæ€»ç»“ç»“æŸäºç¬¬ ${e} å±‚)`),window.toastr?.info(`é‡æ–°åŠ è½½èŠå¤©ï¼Œèµ·å§‹æ¥¼å±‚è®¾ç½®ä¸ºç¬¬ ${o} å±‚`)):(o=t,console.log(`ğŸ”„ é‡æ–°åŠ è½½èŠå¤©ï¼Œå½“å‰æ¥¼å±‚å·²æ€»ç»“ï¼Œä»å½“å‰æ¥¼å±‚å¼€å§‹: ${t}`),window.toastr?.info(`é‡æ–°åŠ è½½èŠå¤©ï¼Œä»å½“å‰æ¥¼å±‚å¼€å§‹: ${t}`))}else o=0,console.log(`ğŸ†• æ–°èŠå¤©çª—å£ï¼Œè®¾ç½®èµ·å§‹æ¥¼å±‚: 0 (èŠå¤©: ${a}) - ä»AIå¼€åœºç™½å¼€å§‹`),window.toastr?.info('æ–°èŠå¤©çª—å£ï¼Œèµ·å§‹æ¥¼å±‚è®¾ç½®ä¸ºç¬¬ 0 å±‚ï¼ˆAIå¼€åœºç™½ï¼‰');o<0&&(o=0,console.log('âš ï¸ ä¿®æ­£èµ·å§‹æ¥¼å±‚ä¸º0ï¼Œä»AIå¼€åœºç™½å¼€å§‹')),insertOrAssignVariables({[n]:o},{type:'chat'})}}catch(e){console.warn('è·å–è‡ªåŠ¨æ€»ç»“èµ·å§‹æ¥¼å±‚å¤±è´¥ï¼Œä½¿ç”¨å½“å‰æ¥¼å±‚:',e),o=t}console.log(`æ£€æŸ¥è‡ªåŠ¨æ€»ç»“: å½“å‰æ¥¼å±‚=${t}, èµ·å§‹æ¥¼å±‚=${o}, é—´éš”=${n.summary_interval}`);const r=t-o,s=r>=n.summary_interval-1;if(console.log('ğŸ§® è®¡ç®—æ£€æŸ¥:',{last_message_id:t,auto_summary_start_id:o,relative_position:r,summarize_interval:n.summary_interval,should_trigger:s,calculation:`${r} >= ${n.summary_interval-1} (åŒ…å«èµ·å§‹æ¥¼å±‚ï¼Œå…±${r+1}å±‚)`,expected_trigger_at_floor:o+n.summary_interval-1,will_summarize_range:`${o}-${o+n.summary_interval-1}`,floor_explanation:'æ¥¼å±‚ç¼–å·ï¼š0=AIå¼€åœºç™½, 1=ç”¨æˆ·, 2=AI, 3=ç”¨æˆ·...'}),t>=o&&s){const e=o,t=o+n.summary_interval-1;console.log(`ğŸ¯ è§¦å‘è‡ªåŠ¨æ€»ç»“: æ¥¼å±‚ ${e}-${t}`),window.toastr.info(`ğŸ”„ å¼€å§‹è‡ªåŠ¨æ€»ç»“æ¥¼å±‚ ${e}-${t}...`),(0,c.summarizeMessages)(e,t).then(n=>{console.log(`âœ… è‡ªåŠ¨æ€»ç»“å®Œæˆ: æ¥¼å±‚ ${e}-${t}`,n);try{(0,l.l)().addSummary(e,t,n)}catch(e){console.error('æ·»åŠ è‡ªåŠ¨æ€»ç»“åˆ°å†å²å¤±è´¥:',e)}const a=t+1;insertOrAssignVariables({auto_summary_start_id:a},{type:'chat'}),console.log(`ğŸ”„ æ›´æ–°èµ·å§‹æ¥¼å±‚ä¸º: ${a}`),window.toastr.success(`âœ… å·²è‡ªåŠ¨æ€»ç»“ç¬¬ ${e}-${t} æ¥¼ï¼Œä¸‹æ¬¡å°†ä»ç¬¬ ${a} æ¥¼å¼€å§‹`)}).catch(e=>{console.error('âŒ è‡ªåŠ¨æ€»ç»“å¤±è´¥ï¼š',e),window.toastr.error('âŒ è‡ªåŠ¨æ€»ç»“å¤±è´¥ï¼š'+e.message)})}}catch(e){console.error('checkAutoSummarize å‘ç”Ÿé”™è¯¯ï¼š',e)}})()}),eventOn(tavern_events.CHAT_CHANGED,e=>{console.log('ğŸ”„ èŠå¤©åˆ‡æ¢äº‹ä»¶:',e);try{const n=getVariables({type:'chat'}).auto_summary_start_id;null!=n?console.log(`âœ… åˆ‡æ¢åˆ°å·²æœ‰è‡ªåŠ¨æ€»ç»“çš„èŠå¤©: ${e}, èµ·å§‹æ¥¼å±‚: ${n}`):console.log(`ğŸ†• åˆ‡æ¢åˆ°æ–°èŠå¤©: ${e}, ç­‰å¾…ä¸‹ä¸€æ¡æ¶ˆæ¯æ—¶åˆå§‹åŒ–`)}catch(e){console.warn('æ£€æŸ¥èŠå¤©çŠ¶æ€å¤±è´¥:',e)}}),console.log('âœ… äº‹ä»¶ç›‘å¬å™¨å·²æ³¨å†Œ')}catch(e){console.error('âŒ æ³¨å†Œäº‹ä»¶ç›‘å¬å™¨å¤±è´¥:',e)}const e=(0,l.C)();if(e&&e.settings){const n=(0,i.watch)(()=>e.settings.auto_summarize_enabled,(e,n)=>{if(console.log(`ğŸ”„ è‡ªåŠ¨æ€»ç»“è®¾ç½®å˜åŒ–: ${n} -> ${e}`),e&&!n)try{if(!(0,d.Ut)())return void console.warn('script_id ä¸ºç©ºï¼Œæ— æ³•æ£€æŸ¥èµ·å§‹æ¥¼å±‚');const e=getVariables({type:'chat'}).auto_summary_start_id;if(null==e){const e=getLastMessageId();insertOrAssignVariables({auto_summary_start_id:e},{type:'chat'}),console.log(`âœ… é¦–æ¬¡å¼€å¯è‡ªåŠ¨æ€»ç»“ï¼Œèµ·å§‹æ¥¼å±‚è®¾ç½®ä¸º: ${e}`),window.toastr?.info(`è‡ªåŠ¨æ€»ç»“å·²å¼€å¯ï¼Œå°†ä»ç¬¬ ${e} å±‚å¼€å§‹`)}else console.log(`âœ… è‡ªåŠ¨æ€»ç»“å·²å¼€å¯ï¼Œä½¿ç”¨ç°æœ‰èµ·å§‹æ¥¼å±‚: ${e}`),window.toastr?.info(`è‡ªåŠ¨æ€»ç»“å·²å¼€å¯ï¼Œèµ·å§‹æ¥¼å±‚: ${e}`)}catch(e){console.error('âŒ æ£€æŸ¥èµ·å§‹æ¥¼å±‚å¤±è´¥:',e)}},{immediate:!1});$(window).on('pagehide',()=>{n()})}window.toastr.success('mzrodyuçŒ«çŒ«çš„å°ç ´çƒ‚è„šæœ¬å·²åŠ è½½')},200)},100)});
//# sourceMappingURL=index.js.map