import*as n from'https://testingcf.jsdelivr.net/npm/pinia/+esm';import{klona as e}from'https://testingcf.jsdelivr.net/npm/klona/+esm';import{getScriptIdSafe as t}from'https://testingcf.jsdelivr.net/npm/è®°å¿†/utils/+esm';var o={35:(e,t,o)=>{e.exports=(n=>{var e={};return o.d(e,n),e})({createPinia:()=>n.createPinia,defineStore:()=>n.defineStore,storeToRefs:()=>n.storeToRefs})},42:(n,e)=>{e.A=(n,e)=>{const t=n.__vccOpts||n;for(const[n,o]of e)t[n]=o;return t}},54:n=>{n.exports=function(n){var e=[];return e.toString=function(){return this.map(function(e){var t='',o=void 0!==e[5];return e[4]&&(t+='@supports ('.concat(e[4],') {')),e[2]&&(t+='@media '.concat(e[2],' {')),o&&(t+='@layer'.concat(e[5].length>0?' '.concat(e[5]):'',' {')),t+=n(e),o&&(t+='}'),e[2]&&(t+='}'),e[4]&&(t+='}'),t}).join('')},e.i=function(n,t,o,a,r){'string'==typeof n&&(n=[[null,n,void 0]]);var s={};if(o)for(var i=0;i<this.length;i++){var l=this[i][0];null!=l&&(s[l]=!0)}for(var d=0;d<n.length;d++){var c=[].concat(n[d]);o&&s[c[0]]||(void 0!==r&&(void 0===c[5]||(c[1]='@layer'.concat(c[5].length>0?' '.concat(c[5]):'',' {').concat(c[1],'}')),c[5]=r),t&&(c[2]?(c[1]='@media '.concat(c[2],' {').concat(c[1],'}'),c[2]=t):c[2]=t),a&&(c[4]?(c[1]='@supports ('.concat(c[4],') {').concat(c[1],'}'),c[4]=a):c[4]=''.concat(a)),e.push(c))}},e}},55:(n,e,t)=>{t.r(e),t.d(e,{default:()=>i});var o=t(790),a=t.n(o),r=t(54),s=t.n(r)()(a());s.push([n.id,'.table-tab[data-v-0416f1c6]{height:100%;overflow-y:auto;padding:25px !important}.section-header[data-v-0416f1c6]{display:flex;justify-content:space-between;align-items:center;padding:20px 25px !important;border-bottom:1px solid #3a3a3a;margin-bottom:5px}.section-header h3[data-v-0416f1c6]{margin:0;color:#fff;font-size:15px !important;font-weight:bold;display:flex;align-items:center;gap:8px}.count-badge[data-v-0416f1c6]{background:#4a9eff;color:white;padding:4px 8px;border-radius:12px;font-size:12px}.empty-state[data-v-0416f1c6]{text-align:center;padding:40px 20px;color:#888}.empty-state i[data-v-0416f1c6]{font-size:48px;margin-bottom:10px;opacity:0.3}.empty-state p[data-v-0416f1c6]{margin:10px 0;font-size:14px}.empty-state small[data-v-0416f1c6]{color:#666;font-size:12px}.history-list[data-v-0416f1c6]{display:flex;flex-direction:column;gap:10px;padding:15px 20px}.history-item[data-v-0416f1c6]{background:#2a2a2a;border:1px solid #3a3a3a;border-radius:6px;overflow:hidden;transition:border-color 0.2s}.history-item[data-v-0416f1c6]:hover{border-color:#4a4a4a}.history-header[data-v-0416f1c6]{padding:12px 15px;background:#1a1a1a;display:flex;justify-content:space-between;align-items:center;cursor:pointer;-webkit-user-select:none;user-select:none;transition:background 0.2s}.history-header[data-v-0416f1c6]:hover{background:#2a2a2a}.history-info[data-v-0416f1c6]{display:flex;align-items:center;gap:10px;flex:1}.history-number[data-v-0416f1c6]{color:#4a9eff;font-weight:bold}.history-range[data-v-0416f1c6]{color:#888;font-size:12px}.expand-icon[data-v-0416f1c6]{color:#888;font-size:12px}.history-content[data-v-0416f1c6]{padding:15px;background:#2a2a2a}.history-actions[data-v-0416f1c6]{display:flex;gap:8px;margin-bottom:12px;padding-bottom:8px;border-bottom:1px solid #3a3a3a}.mini-button[data-v-0416f1c6]{flex:1;padding:6px 12px;background:#2a2a2a;border:1px solid #3a3a3a;border-radius:4px;color:#e0e0e0;cursor:pointer;font-size:12px;transition:background 0.2s}.mini-button[data-v-0416f1c6]:hover{background:#3a3a3a}.mini-button.delete-button[data-v-0416f1c6]:hover{background:#ff4444;border-color:#ff4444;color:white}.table-display[data-v-0416f1c6]{margin-top:15px;overflow-x:auto;max-height:400px;overflow-y:auto;border-radius:6px;background:#1a1a1a}.table-display table[data-v-0416f1c6]{width:100%;font-size:12px;border-collapse:collapse}.table-display th[data-v-0416f1c6],.table-display td[data-v-0416f1c6]{white-space:nowrap;overflow:hidden;text-overflow:ellipsis;max-width:200px;padding:8px;border:1px solid #444}.table-display th[data-v-0416f1c6]{background:#2a2a2a;font-weight:bold;color:#fff}.table-display td[data-v-0416f1c6]{color:#e0e0e0}.copy-button:hover .shimmer-effect[data-v-0416f1c6],.delete-button:hover .shimmer-effect[data-v-0416f1c6]{left:100%}.copy-button[data-v-0416f1c6]:hover{transform:translateY(-1px);box-shadow:0 5px 15px rgba(40,167,69,0.4)}.delete-button[data-v-0416f1c6]:hover{transform:translateY(-1px);box-shadow:0 5px 15px rgba(255,107,107,0.4)}\n','',{version:3,sources:['webpack://./src/è®°å¿†/components/TableTab.vue'],names:[],mappings:'AAomBA,4BACE,WAAY,CACZ,eAAgB,CAChB,uBACF,CAEA,iCACE,YAAa,CACb,6BAA8B,CAC9B,kBAAmB,CACnB,4BAA6B,CAC7B,+BAAgC,CAChC,iBACF,CAEA,oCACE,QAAS,CACT,UAAW,CACX,yBAA0B,CAC1B,gBAAiB,CACjB,YAAa,CACb,kBAAmB,CACnB,OACF,CAEA,8BACE,kBAAmB,CACnB,WAAY,CACZ,eAAgB,CAChB,kBAAmB,CACnB,cACF,CAEA,8BACE,iBAAkB,CAClB,iBAAkB,CAClB,UACF,CAEA,gCACE,cAAe,CACf,kBAAmB,CACnB,WACF,CAEA,gCACE,aAAc,CACd,cACF,CAEA,oCACE,UAAW,CACX,cACF,CAEA,+BACE,YAAa,CACb,qBAAsB,CACtB,QAAS,CACT,iBACF,CAEA,+BACE,kBAAmB,CACnB,wBAAyB,CACzB,iBAAkB,CAClB,eAAgB,CAChB,4BACF,CAEA,qCACE,oBACF,CAEA,iCACE,iBAAkB,CAClB,kBAAmB,CACnB,YAAa,CACb,6BAA8B,CAC9B,kBAAmB,CACnB,cAAe,CACf,wBAAiB,CAAjB,gBAAiB,CACjB,0BACF,CAEA,uCACE,kBACF,CAEA,+BACE,YAAa,CACb,kBAAmB,CACnB,QAAS,CACT,MACF,CAEA,iCACE,aAAc,CACd,gBACF,CAEA,gCACE,UAAW,CACX,cACF,CAEA,8BACE,UAAW,CACX,cACF,CAEA,kCACE,YAAa,CACb,kBACF,CAEA,kCACE,YAAa,CACb,OAAQ,CACR,kBAAmB,CACnB,kBAAmB,CACnB,+BACF,CAEA,8BACE,MAAO,CACP,gBAAiB,CACjB,kBAAmB,CACnB,wBAAyB,CACzB,iBAAkB,CAClB,aAAc,CACd,cAAe,CACf,cAAe,CACf,0BACF,CAEA,oCACE,kBACF,CAEA,kDACE,kBAAmB,CACnB,oBAAqB,CACrB,WACF,CAEA,gCACE,eAAgB,CAChB,eAAgB,CAChB,gBAAiB,CACjB,eAAgB,CAChB,iBAAkB,CAClB,kBACF,CAEA,sCACE,UAAW,CACX,cAAe,CACf,wBACF,CAEA,sEAEE,kBAAmB,CACnB,eAAgB,CAChB,sBAAuB,CACvB,eAAgB,CAChB,WAAY,CACZ,qBACF,CAEA,mCACE,kBAAmB,CACnB,gBAAiB,CACjB,UACF,CAEA,mCACE,aACF,CAGA,0GAEE,SACF,CAEA,oCACE,0BAA2B,CAC3B,yCACF,CAEA,sCACE,0BAA2B,CAC3B,2CACF',sourcesContent:['<template>\n  <div class="table-tab" style="padding: 25px !important; background: #1a1a1a !important">\n    <div\n      class="section-header"\n      style="\n        display: flex;\n        justify-content: space-between;\n        align-items: center;\n        padding: 20px 25px !important;\n        border-bottom: 1px solid #3a3a3a;\n        margin-bottom: 5px;\n      "\n    >\n      <h3\n        style="\n          margin: 0;\n          color: #fff;\n          font-size: 15px !important;\n          font-weight: bold;\n          display: flex;\n          align-items: center;\n          gap: 8px;\n        "\n      >\n        ğŸ“Š è¡¨æ ¼åˆ†æ\n      </h3>\n      <span\n        v-if="table_history.length > 0"\n        class="count-badge"\n        style="background: #4a9eff; color: white; padding: 4px 8px; border-radius: 12px; font-size: 12px"\n        >{{ table_history.length }} æ¡è®°å½•</span\n      >\n    </div>\n\n    \x3c!-- è¡¨æ ¼å†å²åˆ—è¡¨ --\x3e\n    <div\n      v-if="table_history && table_history.length > 0"\n      class="history-list"\n      style="display: flex; flex-direction: column; gap: 15px; margin-top: 20px"\n    >\n      <div\n        v-for="(item, index) in table_history"\n        :key="index"\n        class="history-item"\n        style="\n          background: #2a2a2a;\n          border: 1px solid #444;\n          border-radius: 8px;\n          padding: 15px;\n          transition: all 0.3s ease;\n        "\n      >\n        <div\n          class="history-header"\n          style="\n            padding: 12px 15px;\n            background: #1a1a1a;\n            display: flex;\n            justify-content: space-between;\n            align-items: center;\n            cursor: pointer;\n            user-select: none;\n            transition: background 0.2s;\n            border-radius: 6px;\n          "\n          @click="toggleTableExpanded(index)"\n        >\n          <div class="history-info" style="display: flex; align-items: center; gap: 10px; flex: 1">\n            <span class="history-number" style="color: #4a9eff; font-weight: bold">#{{ index + 1 }}</span>\n            <span class="history-range" style="color: #888; font-size: 12px"\n              >æ¥¼å±‚ {{ item.start_id }} - {{ item.end_id }}</span\n            >\n          </div>\n          <span class="expand-icon" style="color: #888; font-size: 12px">{{\n            isTableExpanded(index) ? \'â–¼\' : \'â–¶\'\n          }}</span>\n        </div>\n        <div\n          v-if="isTableExpanded(index)"\n          class="history-content"\n          style="padding: 15px; background: #2a2a2a; border-radius: 0 0 6px 6px"\n        >\n          <div\n            class="history-actions"\n            style="\n              display: flex;\n              gap: 10px;\n              margin-bottom: 12px;\n              padding-bottom: 8px;\n              border-bottom: 1px solid #3a3a3a;\n              flex-wrap: wrap;\n            "\n          >\n            <button\n              class="copy-button"\n              style="\n                padding: 8px 16px;\n                background: linear-gradient(135deg, #28a745 0%, #20c997 100%);\n                border: none;\n                border-radius: 6px;\n                color: white;\n                cursor: pointer;\n                font-size: 12px;\n                font-weight: 600;\n                transition: all 0.3s ease;\n                display: flex;\n                align-items: center;\n                gap: 6px;\n                box-shadow: 0 3px 12px rgba(40, 167, 69, 0.3);\n                position: relative;\n                overflow: hidden;\n              "\n              @click="copyTable(item)"\n            >\n              <div\n                style="\n                  position: absolute;\n                  top: 0;\n                  left: -100%;\n                  width: 100%;\n                  height: 100%;\n                  background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);\n                  transition: left 0.5s;\n                "\n                class="shimmer-effect"\n              ></div>\n              <i class="fa-solid fa-copy" style="font-size: 12px"></i> å¤åˆ¶\n            </button>\n            <button\n              class="delete-button"\n              style="\n                padding: 8px 16px;\n                background: linear-gradient(135deg, #ff6b6b 0%, #ee5a52 100%);\n                border: none;\n                border-radius: 6px;\n                color: white;\n                cursor: pointer;\n                font-size: 12px;\n                font-weight: 600;\n                transition: all 0.3s ease;\n                display: flex;\n                align-items: center;\n                gap: 6px;\n                box-shadow: 0 3px 12px rgba(255, 107, 107, 0.3);\n                position: relative;\n                overflow: hidden;\n              "\n              @click="deleteTable(index)"\n            >\n              <div\n                style="\n                  position: absolute;\n                  top: 0;\n                  left: -100%;\n                  width: 100%;\n                  height: 100%;\n                  background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);\n                  transition: left 0.5s;\n                "\n                class="shimmer-effect"\n              ></div>\n              <i class="fa-solid fa-trash" style="font-size: 12px"></i> åˆ é™¤\n            </button>\n          </div>\n          <div class="table-display" style="overflow-x: auto; border-radius: 6px; border: 1px solid #3a3a3a">\n            <table style="width: 100%; border-collapse: collapse; background: #1a1a1a">\n              <thead style="background: #2a2a2a">\n                <tr>\n                  <th\n                    v-for="(header, idx) in item.headers"\n                    :key="idx"\n                    style="\n                      padding: 12px 16px;\n                      text-align: left;\n                      font-weight: bold;\n                      color: #fff;\n                      border-bottom: 2px solid #3a3a3a;\n                      border-right: 1px solid #3a3a3a;\n                    "\n                  >\n                    {{ header }}\n                  </th>\n                </tr>\n              </thead>\n              <tbody>\n                <tr v-for="(row, rowIdx) in item.data" :key="rowIdx" style="border-bottom: 1px solid #3a3a3a">\n                  <td\n                    v-for="(cell, cellIdx) in row"\n                    :key="cellIdx"\n                    style="padding: 10px 16px; color: #e0e0e0; border-right: 1px solid #3a3a3a"\n                  >\n                    {{ cell }}\n                  </td>\n                </tr>\n              </tbody>\n            </table>\n          </div>\n        </div>\n      </div>\n    </div>\n    <div v-else class="empty-state" style="text-align: center; padding: 40px 20px; color: #888">\n      <i class="fa-solid fa-table" style="font-size: 48px; margin-bottom: 10px; opacity: 0.3"></i>\n      <p style="margin: 10px 0; font-size: 16px">è¿˜æ²¡æœ‰è¡¨æ ¼è®°å½•</p>\n      <small style="font-size: 12px; color: #666">ä½¿ç”¨"è®¾ç½®"æ ‡ç­¾é¡µæ‰‹åŠ¨ç”Ÿæˆè¡¨æ ¼</small>\n    </div>\n  </div>\n</template>\n\n<script setup lang="ts">\nimport { ref } from \'vue\';\nimport { getChatIdSafe } from \'../utils\';\n\n// å“åº”å¼æ•°æ®\nconst table_history = ref<Array<{ start_id: number; end_id: number; headers: string[]; data: string[][] }>>([]);\nconst tableExpandedState = ref<Map<number, boolean>>(new Map());\n\n// æ›´æ–°è¡¨æ ¼å†å²çš„å‡½æ•°\nconst refreshTableHistory = () => {\n  try {\n    const chat_id = getChatIdSafe();\n    if (!chat_id) {\n      console.warn(\'æ— æ³•è·å–èŠå¤©IDï¼Œæ¸…ç©ºè¡¨æ ¼å†å²\');\n      table_history.value = [];\n      return;\n    }\n\n    const chat_vars = getVariables({ type: \'chat\' });\n    console.log(\'ä»èŠå¤©å˜é‡è¯»å–çš„æ•°æ®:\', chat_vars);\n    console.log(\'è¡¨æ ¼å†å²æ•°æ®:\', chat_vars.table_history);\n\n    table_history.value = chat_vars.table_history || [];\n    console.log(\'å·²åˆ·æ–°è¡¨æ ¼å†å²ï¼Œå½“å‰èŠå¤©è¡¨æ ¼æ•°:\', table_history.value.length);\n  } catch (e) {\n    console.error(\'åˆ·æ–°è¡¨æ ¼å†å²å¤±è´¥:\', e);\n    table_history.value = [];\n  }\n};\n\n// åˆ‡æ¢è¡¨æ ¼å±•å¼€çŠ¶æ€\nconst toggleTableExpanded = (index: number) => {\n  const current = tableExpandedState.value.get(index) || false;\n  tableExpandedState.value.set(index, !current);\n};\n\nconst isTableExpanded = (index: number) => {\n  return tableExpandedState.value.get(index) || false;\n};\n\n// ç»Ÿä¸€çš„å¤åˆ¶å‡½æ•° - é’ˆå¯¹iframeç¯å¢ƒä¼˜åŒ–\nconst copyToClipboard = async (text: string, successMessage: string = \'å†…å®¹å·²å¤åˆ¶åˆ°å‰ªè´´æ¿\') => {\n  console.log(\'å¼€å§‹å¤åˆ¶ï¼Œæ–‡æœ¬é•¿åº¦:\', text.length);\n\n  try {\n    // åœ¨iframeç¯å¢ƒä¸­ï¼Œä¼˜å…ˆå°è¯•åœ¨çˆ¶çª—å£ä¸­å¤åˆ¶\n    if (window.parent && window.parent !== window) {\n      console.log(\'æ£€æµ‹åˆ°iframeç¯å¢ƒï¼Œå°è¯•åœ¨çˆ¶çª—å£å¤åˆ¶\');\n      const parentSuccess = await tryParentWindowCopy(text);\n      if (parentSuccess) {\n        console.log(\'çˆ¶çª—å£å¤åˆ¶æˆåŠŸ\');\n        window.toastr.success(successMessage);\n        return;\n      }\n    }\n\n    // æ–¹æ³•1: å°è¯•ä½¿ç”¨ç°ä»£çš„ Clipboard APIï¼ˆä»…åœ¨å®‰å…¨ä¸Šä¸‹æ–‡ä¸­ï¼‰\n    if (navigator.clipboard && window.isSecureContext) {\n      console.log(\'ä½¿ç”¨ç°ä»£ Clipboard API\');\n      try {\n        await navigator.clipboard.writeText(text);\n        console.log(\'Clipboard API å¤åˆ¶æˆåŠŸ\');\n        window.toastr.success(successMessage);\n        return;\n      } catch (clipboardErr) {\n        console.warn(\'Clipboard API å¤±è´¥:\', clipboardErr);\n        // ç»§ç»­å°è¯•å…¶ä»–æ–¹æ³•\n      }\n    }\n\n    // æ–¹æ³•2: ä½¿ç”¨ä¼ ç»Ÿçš„ execCommand æ–¹æ³•\n    console.log(\'ä½¿ç”¨ execCommand æ–¹æ³•\');\n    const success = await execCommandCopy(text);\n    if (success) {\n      console.log(\'execCommand å¤åˆ¶æˆåŠŸ\');\n      window.toastr.success(successMessage);\n      return;\n    }\n\n    // æ–¹æ³•3: å¦‚æœéƒ½å¤±è´¥äº†ï¼Œæ˜¾ç¤ºæ–‡æœ¬æ¡†è®©ç”¨æˆ·æ‰‹åŠ¨å¤åˆ¶\n    console.log(\'æ‰€æœ‰è‡ªåŠ¨å¤åˆ¶æ–¹æ³•éƒ½å¤±è´¥ï¼Œæ˜¾ç¤ºæ‰‹åŠ¨å¤åˆ¶ç•Œé¢\');\n    showManualCopyDialog(text);\n  } catch (err) {\n    console.error(\'å¤åˆ¶å¼‚å¸¸:\', err);\n    // å‡ºé”™æ—¶ä¹Ÿæ˜¾ç¤ºæ‰‹åŠ¨å¤åˆ¶ç•Œé¢\n    showManualCopyDialog(text);\n  }\n};\n\n// åœ¨çˆ¶çª—å£ä¸­å°è¯•å¤åˆ¶\nconst tryParentWindowCopy = async (text: string): Promise<boolean> => {\n  return new Promise(resolve => {\n    try {\n      const parentDoc = window.parent.document;\n      const parentBody = window.parent.document.body;\n\n      // åˆ›å»ºä¸€ä¸ªä¸´æ—¶çš„ textarea å…ƒç´ åœ¨çˆ¶çª—å£ä¸­\n      const textarea = parentDoc.createElement(\'textarea\');\n      textarea.value = text;\n      textarea.style.cssText = `\n        position: fixed;\n        left: -9999px;\n        top: -9999px;\n        opacity: 0;\n        pointer-events: none;\n        z-index: -1000;\n      `;\n      textarea.setAttribute(\'readonly\', \'\');\n\n      parentBody.appendChild(textarea);\n\n      // é€‰ä¸­æ–‡æœ¬\n      textarea.focus();\n      textarea.select();\n      textarea.setSelectionRange(0, text.length);\n\n      // å°è¯•å¤åˆ¶\n      const success = parentDoc.execCommand(\'copy\');\n\n      // æ¸…ç†\n      parentBody.removeChild(textarea);\n\n      resolve(success);\n    } catch (err) {\n      console.error(\'çˆ¶çª—å£å¤åˆ¶å¤±è´¥:\', err);\n      resolve(false);\n    }\n  });\n};\n\n// execCommand å¤åˆ¶æ–¹æ³•\nconst execCommandCopy = async (text: string): Promise<boolean> => {\n  return new Promise(resolve => {\n    try {\n      // åˆ›å»ºä¸€ä¸ªä¸´æ—¶çš„ textarea å…ƒç´ \n      const textarea = document.createElement(\'textarea\');\n      textarea.value = text;\n      textarea.style.position = \'fixed\';\n      textarea.style.left = \'-9999px\';\n      textarea.style.top = \'-9999px\';\n      textarea.style.opacity = \'0\';\n      textarea.style.pointerEvents = \'none\';\n      textarea.setAttribute(\'readonly\', \'\');\n\n      document.body.appendChild(textarea);\n\n      // é€‰ä¸­æ–‡æœ¬\n      textarea.select();\n      textarea.setSelectionRange(0, text.length);\n\n      // å°è¯•å¤åˆ¶\n      const success = document.execCommand(\'copy\');\n\n      // æ¸…ç†\n      document.body.removeChild(textarea);\n\n      resolve(success);\n    } catch (err) {\n      console.error(\'execCommand å¤åˆ¶å¤±è´¥:\', err);\n      resolve(false);\n    }\n  });\n};\n\n// æ‰‹åŠ¨å¤åˆ¶å¯¹è¯æ¡† - æ›´å¯é çš„å®ç°\nconst showManualCopyDialog = (text: string) => {\n  console.log(\'æ˜¾ç¤ºæ‰‹åŠ¨å¤åˆ¶å¯¹è¯æ¡†ï¼Œæ–‡æœ¬é•¿åº¦:\', text.length);\n\n  try {\n    // ä½¿ç”¨çˆ¶çª—å£çš„documentæ¥åˆ›å»ºå…ƒç´ \n    const parentDoc = window.parent.document;\n    const parentBody = window.parent.document.body;\n\n    // ç§»é™¤å¯èƒ½å­˜åœ¨çš„æ—§å¯¹è¯æ¡†\n    const existingOverlay = parentDoc.getElementById(\'manual-copy-overlay\');\n    if (existingOverlay) {\n      parentBody.removeChild(existingOverlay);\n    }\n\n    // åˆ›å»ºé®ç½©å±‚\n    const overlay = parentDoc.createElement(\'div\');\n    overlay.id = \'manual-copy-overlay\';\n    overlay.style.cssText = `\n      position: fixed;\n      top: 0;\n      left: 0;\n      right: 0;\n      bottom: 0;\n      background: rgba(0, 0, 0, 0.95);\n      z-index: 999999;\n      display: flex;\n      align-items: center;\n      justify-content: center;\n      font-family: -apple-system, BlinkMacSystemFont, \'Segoe UI\', Roboto, sans-serif;\n    `;\n\n    // åˆ›å»ºä¸»å®¹å™¨\n    const container = parentDoc.createElement(\'div\');\n    container.style.cssText = `\n      background: #2a2a2a;\n      border: 2px solid #4a9eff;\n      border-radius: 12px;\n      padding: 25px;\n      max-width: 900px;\n      width: 95%;\n      max-height: 85vh;\n      display: flex;\n      flex-direction: column;\n      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);\n    `;\n\n    // åˆ›å»ºæ ‡é¢˜\n    const header = parentDoc.createElement(\'div\');\n    header.innerHTML = `\n      <h3 style="margin: 0 0 15px 0; color: #4a9eff; text-align: center; font-size: 18px; font-weight: 600;">\n        ğŸ“‹ æ‰‹åŠ¨å¤åˆ¶è¡¨æ ¼å†…å®¹\n      </h3>\n      <div style="background: #1a1a1a; border: 1px solid #444; border-radius: 6px; padding: 12px; margin-bottom: 15px;">\n        <p style="margin: 0 0 8px 0; color: #e0e0e0; font-size: 14px;">\n          <strong>æ“ä½œæ­¥éª¤ï¼š</strong>\n        </p>\n        <ol style="margin: 0; padding-left: 20px; color: #ccc; font-size: 13px; line-height: 1.6;">\n          <li>ç‚¹å‡»ä¸‹æ–¹æ–‡æœ¬æ¡†</li>\n          <li>æŒ‰ <kbd style="background: #444; padding: 2px 6px; border-radius: 3px; color: #fff;">Ctrl+A</kbd> å…¨é€‰æ–‡æœ¬</li>\n          <li>æŒ‰ <kbd style="background: #444; padding: 2px 6px; border-radius: 3px; color: #fff;">Ctrl+C</kbd> å¤åˆ¶åˆ°å‰ªè´´æ¿</li>\n          <li>ç‚¹å‡»"å…³é—­"æŒ‰é’®æˆ–æŒ‰ <kbd style="background: #444; padding: 2px 6px; border-radius: 3px; color: #fff;">Esc</kbd> å…³é—­å¯¹è¯æ¡†</li>\n        </ol>\n      </div>\n    `;\n\n    // åˆ›å»ºæ–‡æœ¬æ¡†\n    const textarea = parentDoc.createElement(\'textarea\');\n    textarea.value = text;\n    textarea.style.cssText = `\n      width: 100%;\n      height: 400px;\n      background: #1a1a1a;\n      border: 2px solid #444;\n      border-radius: 6px;\n      padding: 15px;\n      color: #e0e0e0;\n      font-family: \'Courier New\', \'Consolas\', monospace;\n      font-size: 13px;\n      line-height: 1.5;\n      resize: vertical;\n      white-space: pre-wrap;\n      word-wrap: break-word;\n      outline: none;\n      margin-bottom: 20px;\n      box-sizing: border-box;\n    `;\n\n    // åˆ›å»ºæŒ‰é’®å®¹å™¨\n    const buttonContainer = parentDoc.createElement(\'div\');\n    buttonContainer.style.cssText = `\n      display: flex;\n      gap: 12px;\n      justify-content: center;\n      align-items: center;\n    `;\n\n    // åˆ›å»ºå…³é—­æŒ‰é’®\n    const closeButton = parentDoc.createElement(\'button\');\n    closeButton.textContent = \'å…³é—­\';\n    closeButton.style.cssText = `\n      background: #4a9eff;\n      color: white;\n      border: none;\n      padding: 12px 24px;\n      border-radius: 6px;\n      cursor: pointer;\n      font-size: 14px;\n      font-weight: 500;\n      transition: background 0.2s;\n    `;\n    closeButton.onmouseover = () => {\n      closeButton.style.background = \'#5ba8ff\';\n    };\n    closeButton.onmouseout = () => {\n      closeButton.style.background = \'#4a9eff\';\n    };\n\n    // åˆ›å»ºå¤åˆ¶æŒ‰é’®ï¼ˆå¤‡ç”¨ï¼‰\n    const copyButton = parentDoc.createElement(\'button\');\n    copyButton.textContent = \'å°è¯•è‡ªåŠ¨å¤åˆ¶\';\n    copyButton.style.cssText = `\n      background: #28a745;\n      color: white;\n      border: none;\n      padding: 12px 24px;\n      border-radius: 6px;\n      cursor: pointer;\n      font-size: 14px;\n      font-weight: 500;\n      transition: background 0.2s;\n    `;\n    copyButton.onmouseover = () => {\n      copyButton.style.background = \'#218838\';\n    };\n    copyButton.onmouseout = () => {\n      copyButton.style.background = \'#28a745\';\n    };\n\n    // ç»„è£…å…ƒç´ \n    buttonContainer.appendChild(copyButton);\n    buttonContainer.appendChild(closeButton);\n\n    container.appendChild(header);\n    container.appendChild(textarea);\n    container.appendChild(buttonContainer);\n    overlay.appendChild(container);\n\n    // æ·»åŠ åˆ°é¡µé¢\n    parentBody.appendChild(overlay);\n\n    // äº‹ä»¶å¤„ç†\n    closeButton.onclick = () => {\n      console.log(\'å…³é—­æŒ‰é’®è¢«ç‚¹å‡»\');\n      parentBody.removeChild(overlay);\n    };\n\n    copyButton.onclick = async () => {\n      console.log(\'å°è¯•è‡ªåŠ¨å¤åˆ¶æŒ‰é’®è¢«ç‚¹å‡»\');\n      try {\n        // é€‰ä¸­æ–‡æœ¬\n        textarea.focus();\n        textarea.select();\n\n        // å°è¯•å¤åˆ¶\n        const success = document.execCommand(\'copy\');\n        if (success) {\n          window.toastr.success(\'è‡ªåŠ¨å¤åˆ¶æˆåŠŸï¼\');\n          parentBody.removeChild(overlay);\n        } else {\n          window.toastr.warning(\'è‡ªåŠ¨å¤åˆ¶å¤±è´¥ï¼Œè¯·æ‰‹åŠ¨å¤åˆ¶\');\n        }\n      } catch (err) {\n        console.error(\'è‡ªåŠ¨å¤åˆ¶å¤±è´¥:\', err);\n        window.toastr.warning(\'è‡ªåŠ¨å¤åˆ¶å¤±è´¥ï¼Œè¯·æ‰‹åŠ¨å¤åˆ¶\');\n      }\n    };\n\n    // ç‚¹å‡»èƒŒæ™¯å…³é—­\n    overlay.onclick = e => {\n      if (e.target === overlay) {\n        console.log(\'ç‚¹å‡»èƒŒæ™¯å…³é—­\');\n        parentBody.removeChild(overlay);\n      }\n    };\n\n    // é”®ç›˜äº‹ä»¶å¤„ç†\n    const handleKeyDown = (e: KeyboardEvent) => {\n      if (e.key === \'Escape\') {\n        console.log(\'æŒ‰ESCé”®å…³é—­\');\n        parentBody.removeChild(overlay);\n        parentDoc.removeEventListener(\'keydown\', handleKeyDown);\n      }\n    };\n    parentDoc.addEventListener(\'keydown\', handleKeyDown);\n\n    // è‡ªåŠ¨é€‰ä¸­æ–‡æœ¬\n    setTimeout(() => {\n      console.log(\'è‡ªåŠ¨é€‰ä¸­æ–‡æœ¬\');\n      textarea.focus();\n      textarea.select();\n    }, 200);\n\n    // æ˜¾ç¤ºæˆåŠŸæ¶ˆæ¯\n    window.toastr.info(\'æ‰‹åŠ¨å¤åˆ¶å¯¹è¯æ¡†å·²æ‰“å¼€ï¼Œè¯·æŒ‰ç…§æç¤ºæ“ä½œ\');\n  } catch (err) {\n    console.error(\'åˆ›å»ºæ‰‹åŠ¨å¤åˆ¶å¯¹è¯æ¡†å¤±è´¥:\', err);\n    window.toastr.error(\'æ— æ³•æ˜¾ç¤ºå¤åˆ¶å¯¹è¯æ¡†ï¼Œè¯·æ£€æŸ¥æµè§ˆå™¨æƒé™\');\n  }\n};\n\n// å¤åˆ¶è¡¨æ ¼ - ä½¿ç”¨ç»Ÿä¸€çš„å¤åˆ¶å‡½æ•°\nconst copyTable = (tableItem: { headers: string[]; data: string[][] }) => {\n  try {\n    // åˆ›å»ºè¡¨æ ¼çš„TSVæ ¼å¼\n    const tsv = [tableItem.headers.join(\'\\t\'), ...tableItem.data.map(row => row.join(\'\\t\'))].join(\'\\n\');\n    copyToClipboard(tsv, \'è¡¨æ ¼å·²å¤åˆ¶åˆ°å‰ªè´´æ¿\');\n  } catch (error) {\n    console.error(\'å¤åˆ¶è¡¨æ ¼å¤±è´¥:\', error);\n    window.toastr.error(\'å¤åˆ¶å¤±è´¥ï¼Œè¯·æ‰‹åŠ¨å¤åˆ¶\');\n  }\n};\n\n// åˆ é™¤è¡¨æ ¼\nconst deleteTable = (index: number) => {\n  if (confirm(\'ç¡®å®šè¦åˆ é™¤è¿™ä¸ªè¡¨æ ¼å—ï¼Ÿ\')) {\n    table_history.value.splice(index, 1);\n    const chat_id = getChatIdSafe();\n    if (chat_id) {\n      insertOrAssignVariables({ table_history: table_history.value }, { type: \'chat\' });\n      window.toastr.success(\'è¡¨æ ¼å·²åˆ é™¤\');\n    }\n  }\n};\n\n// åˆå§‹åŒ–\nrefreshTableHistory();\n<\/script>\n\n<style scoped>\n.table-tab {\n  height: 100%;\n  overflow-y: auto;\n  padding: 25px !important;\n}\n\n.section-header {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  padding: 20px 25px !important;\n  border-bottom: 1px solid #3a3a3a;\n  margin-bottom: 5px;\n}\n\n.section-header h3 {\n  margin: 0;\n  color: #fff;\n  font-size: 15px !important;\n  font-weight: bold;\n  display: flex;\n  align-items: center;\n  gap: 8px;\n}\n\n.count-badge {\n  background: #4a9eff;\n  color: white;\n  padding: 4px 8px;\n  border-radius: 12px;\n  font-size: 12px;\n}\n\n.empty-state {\n  text-align: center;\n  padding: 40px 20px;\n  color: #888;\n}\n\n.empty-state i {\n  font-size: 48px;\n  margin-bottom: 10px;\n  opacity: 0.3;\n}\n\n.empty-state p {\n  margin: 10px 0;\n  font-size: 14px;\n}\n\n.empty-state small {\n  color: #666;\n  font-size: 12px;\n}\n\n.history-list {\n  display: flex;\n  flex-direction: column;\n  gap: 10px;\n  padding: 15px 20px;\n}\n\n.history-item {\n  background: #2a2a2a;\n  border: 1px solid #3a3a3a;\n  border-radius: 6px;\n  overflow: hidden;\n  transition: border-color 0.2s;\n}\n\n.history-item:hover {\n  border-color: #4a4a4a;\n}\n\n.history-header {\n  padding: 12px 15px;\n  background: #1a1a1a;\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  cursor: pointer;\n  user-select: none;\n  transition: background 0.2s;\n}\n\n.history-header:hover {\n  background: #2a2a2a;\n}\n\n.history-info {\n  display: flex;\n  align-items: center;\n  gap: 10px;\n  flex: 1;\n}\n\n.history-number {\n  color: #4a9eff;\n  font-weight: bold;\n}\n\n.history-range {\n  color: #888;\n  font-size: 12px;\n}\n\n.expand-icon {\n  color: #888;\n  font-size: 12px;\n}\n\n.history-content {\n  padding: 15px;\n  background: #2a2a2a;\n}\n\n.history-actions {\n  display: flex;\n  gap: 8px;\n  margin-bottom: 12px;\n  padding-bottom: 8px;\n  border-bottom: 1px solid #3a3a3a;\n}\n\n.mini-button {\n  flex: 1;\n  padding: 6px 12px;\n  background: #2a2a2a;\n  border: 1px solid #3a3a3a;\n  border-radius: 4px;\n  color: #e0e0e0;\n  cursor: pointer;\n  font-size: 12px;\n  transition: background 0.2s;\n}\n\n.mini-button:hover {\n  background: #3a3a3a;\n}\n\n.mini-button.delete-button:hover {\n  background: #ff4444;\n  border-color: #ff4444;\n  color: white;\n}\n\n.table-display {\n  margin-top: 15px;\n  overflow-x: auto;\n  max-height: 400px;\n  overflow-y: auto;\n  border-radius: 6px;\n  background: #1a1a1a;\n}\n\n.table-display table {\n  width: 100%;\n  font-size: 12px;\n  border-collapse: collapse;\n}\n\n.table-display th,\n.table-display td {\n  white-space: nowrap;\n  overflow: hidden;\n  text-overflow: ellipsis;\n  max-width: 200px;\n  padding: 8px;\n  border: 1px solid #444;\n}\n\n.table-display th {\n  background: #2a2a2a;\n  font-weight: bold;\n  color: #fff;\n}\n\n.table-display td {\n  color: #e0e0e0;\n}\n\n/* ç¾åŒ–æŒ‰é’®çš„æ‚¬åœæ•ˆæœ */\n.copy-button:hover .shimmer-effect,\n.delete-button:hover .shimmer-effect {\n  left: 100%;\n}\n\n.copy-button:hover {\n  transform: translateY(-1px);\n  box-shadow: 0 5px 15px rgba(40, 167, 69, 0.4);\n}\n\n.delete-button:hover {\n  transform: translateY(-1px);\n  box-shadow: 0 5px 15px rgba(255, 107, 107, 0.4);\n}\n</style>\n'],sourceRoot:''}]);const i=s},61:n=>{n.exports=Vue},86:(n,e,t)=>{t.r(e),t.d(e,{default:()=>i});var o=t(790),a=t.n(o),r=t(54),s=t.n(r)()(a());s.push([n.id,'.summary-tab[data-v-97028022]{height:100%;overflow-y:auto;padding:25px !important}.section-header[data-v-97028022]{display:flex;justify-content:space-between;align-items:center;padding:20px 25px !important;border-bottom:1px solid #3a3a3a;margin-bottom:5px}.section-header h3[data-v-97028022]{margin:0;color:#fff;font-size:15px !important;font-weight:bold;display:flex;align-items:center;gap:8px}.header-actions[data-v-97028022]{display:flex;align-items:center;gap:10px}.count-badge[data-v-97028022]{background:#4a9eff;color:white;padding:4px 8px;border-radius:12px;font-size:12px}.empty-state[data-v-97028022]{text-align:center;padding:40px 20px;color:#888}.empty-state i[data-v-97028022]{font-size:48px;margin-bottom:10px;opacity:0.3}.empty-state p[data-v-97028022]{margin:10px 0;font-size:14px}.empty-state small[data-v-97028022]{color:#666;font-size:12px}.history-list[data-v-97028022]{display:flex;flex-direction:column;gap:10px;padding:15px 20px}.history-item[data-v-97028022]{background:#2a2a2a;border:1px solid #3a3a3a;border-radius:6px;overflow:hidden;transition:border-color 0.2s}.history-item[data-v-97028022]:hover{border-color:#4a4a4a}.history-header[data-v-97028022]{padding:12px 15px;background:#1a1a1a;display:flex;justify-content:space-between;align-items:center;cursor:pointer;-webkit-user-select:none;user-select:none;transition:background 0.2s}.history-header[data-v-97028022]:hover{background:#2a2a2a}.history-info[data-v-97028022]{display:flex;align-items:center;gap:10px;flex:1}.history-number[data-v-97028022]{color:#4a9eff;font-weight:bold}.history-range[data-v-97028022]{color:#888;font-size:12px}.expand-icon[data-v-97028022]{color:#888;font-size:12px}.history-content[data-v-97028022]{padding:15px;background:#2a2a2a}.history-actions[data-v-97028022]{display:flex;gap:8px;margin-bottom:12px;padding-bottom:8px;border-bottom:1px solid #3a3a3a}.mini-button[data-v-97028022]{flex:1;padding:6px 12px;background:#2a2a2a;border:1px solid #3a3a3a;border-radius:4px;color:#e0e0e0;cursor:pointer;font-size:12px;transition:background 0.2s}.mini-button[data-v-97028022]:hover{background:#3a3a3a}.mini-button.delete-button[data-v-97028022]:hover{background:#ff4444;border-color:#ff4444;color:white}.mini-button.worldbook-button[data-v-97028022]{background:#28a745;color:white;border-color:#28a745}.mini-button.worldbook-button[data-v-97028022]:hover{background:#218838;border-color:#218838;color:white}.mini-button.create-worldbook-button[data-v-97028022]{background:#17a2b8;color:white;border-color:#17a2b8}.mini-button.create-worldbook-button[data-v-97028022]:hover{background:#138496;border-color:#138496;color:white}.mini-button.refresh-button[data-v-97028022]{background:#6c757d;color:white;border-color:#6c757d}.mini-button.refresh-button[data-v-97028022]:hover{background:#5a6268;border-color:#5a6268;color:white}.mini-button.debug-button[data-v-97028022]{background:#ffc107;color:#000;border-color:#ffb300}.mini-button.debug-button[data-v-97028022]:hover{background:#e0a800;border-color:#d39e00;color:#000}.history-text[data-v-97028022]{white-space:pre-wrap;word-wrap:break-word;line-height:1.6;max-height:400px;overflow-y:auto}\n','',{version:3,sources:['webpack://./src/è®°å¿†/components/SummaryTab.vue'],names:[],mappings:'AAqlCA,8BACE,WAAY,CACZ,eAAgB,CAChB,uBACF,CAEA,iCACE,YAAa,CACb,6BAA8B,CAC9B,kBAAmB,CACnB,4BAA6B,CAC7B,+BAAgC,CAChC,iBACF,CAEA,oCACE,QAAS,CACT,UAAW,CACX,yBAA0B,CAC1B,gBAAiB,CACjB,YAAa,CACb,kBAAmB,CACnB,OACF,CAEA,iCACE,YAAa,CACb,kBAAmB,CACnB,QACF,CAEA,8BACE,kBAAmB,CACnB,WAAY,CACZ,eAAgB,CAChB,kBAAmB,CACnB,cACF,CAEA,8BACE,iBAAkB,CAClB,iBAAkB,CAClB,UACF,CAEA,gCACE,cAAe,CACf,kBAAmB,CACnB,WACF,CAEA,gCACE,aAAc,CACd,cACF,CAEA,oCACE,UAAW,CACX,cACF,CAEA,+BACE,YAAa,CACb,qBAAsB,CACtB,QAAS,CACT,iBACF,CAEA,+BACE,kBAAmB,CACnB,wBAAyB,CACzB,iBAAkB,CAClB,eAAgB,CAChB,4BACF,CAEA,qCACE,oBACF,CAEA,iCACE,iBAAkB,CAClB,kBAAmB,CACnB,YAAa,CACb,6BAA8B,CAC9B,kBAAmB,CACnB,cAAe,CACf,wBAAiB,CAAjB,gBAAiB,CACjB,0BACF,CAEA,uCACE,kBACF,CAEA,+BACE,YAAa,CACb,kBAAmB,CACnB,QAAS,CACT,MACF,CAEA,iCACE,aAAc,CACd,gBACF,CAEA,gCACE,UAAW,CACX,cACF,CAEA,8BACE,UAAW,CACX,cACF,CAEA,kCACE,YAAa,CACb,kBACF,CAEA,kCACE,YAAa,CACb,OAAQ,CACR,kBAAmB,CACnB,kBAAmB,CACnB,+BACF,CAEA,8BACE,MAAO,CACP,gBAAiB,CACjB,kBAAmB,CACnB,wBAAyB,CACzB,iBAAkB,CAClB,aAAc,CACd,cAAe,CACf,cAAe,CACf,0BACF,CAEA,oCACE,kBACF,CAEA,kDACE,kBAAmB,CACnB,oBAAqB,CACrB,WACF,CAEA,+CACE,kBAAmB,CACnB,WAAY,CACZ,oBACF,CAEA,qDACE,kBAAmB,CACnB,oBAAqB,CACrB,WACF,CAEA,sDACE,kBAAmB,CACnB,WAAY,CACZ,oBACF,CAEA,4DACE,kBAAmB,CACnB,oBAAqB,CACrB,WACF,CAEA,6CACE,kBAAmB,CACnB,WAAY,CACZ,oBACF,CAEA,mDACE,kBAAmB,CACnB,oBAAqB,CACrB,WACF,CAEA,2CACE,kBAAmB,CACnB,UAAW,CACX,oBACF,CAEA,iDACE,kBAAmB,CACnB,oBAAqB,CACrB,UACF,CAEA,+BACE,oBAAqB,CACrB,oBAAqB,CACrB,eAAgB,CAChB,gBAAiB,CACjB,eACF',sourcesContent:['<template>\n  <div class="summary-tab" style="padding: 25px !important; background: #1a1a1a !important">\n    <div\n      class="section-header"\n      style="\n        display: flex;\n        justify-content: space-between;\n        align-items: center;\n        padding: 20px 25px !important;\n        border-bottom: 1px solid #3a3a3a;\n        margin-bottom: 5px;\n      "\n    >\n      <h3\n        style="\n          margin: 0;\n          color: #fff;\n          font-size: 15px !important;\n          font-weight: bold;\n          display: flex;\n          align-items: center;\n          gap: 8px;\n        "\n      >\n        ğŸ“ å†å²æ€»ç»“è®°å½•\n      </h3>\n      <div class="header-actions" style="display: flex; align-items: center; gap: 10px">\n        <span\n          v-if="summary_history.length > 0"\n          class="count-badge"\n          style="background: #4a9eff; color: white; padding: 4px 8px; border-radius: 12px; font-size: 12px"\n          >{{ summary_history.length }} æ¡è®°å½•</span\n        >\n        <button\n          class="mini-button refresh-button"\n          style="\n            padding: 6px 12px;\n            background: #2a2a2a;\n            border: 1px solid #3a3a3a;\n            border-radius: 4px;\n            color: #e0e0e0;\n            cursor: pointer;\n            font-size: 12px;\n            transition: all 0.2s;\n            display: flex;\n            align-items: center;\n            gap: 6px;\n          "\n          @click="handleRefreshData"\n        >\n          <i class="fa-solid fa-refresh"></i> åˆ·æ–°æ•°æ®\n        </button>\n        <button\n          class="mini-button create-worldbook-button"\n          style="\n            padding: 6px 12px;\n            background: #51cf66;\n            border: 1px solid #40c057;\n            border-radius: 4px;\n            color: white;\n            cursor: pointer;\n            font-size: 12px;\n            transition: all 0.2s;\n            display: flex;\n            align-items: center;\n            gap: 6px;\n          "\n          @click="createSummaryWorldbook"\n        >\n          <i class="fa-solid fa-plus"></i> åˆ›å»ºæ€»ç»“ä¸–ç•Œä¹¦\n        </button>\n        <button\n          class="mini-button debug-button"\n          style="\n            padding: 6px 12px;\n            background: #ffc107;\n            border: 1px solid #ffb300;\n            border-radius: 4px;\n            color: #000;\n            cursor: pointer;\n            font-size: 12px;\n            transition: all 0.2s;\n            display: flex;\n            align-items: center;\n            gap: 6px;\n          "\n          @click="showDebugPanel"\n        >\n          <i class="fa-solid fa-bug"></i> è°ƒè¯•å·¥å…·\n        </button>\n      </div>\n    </div>\n\n    <div\n      v-if="summary_history && summary_history.length > 0"\n      class="history-list"\n      style="display: flex; flex-direction: column; gap: 15px; margin-top: 20px"\n    >\n      <div\n        v-for="(item, index) in summary_history"\n        :key="index"\n        class="history-item"\n        style="\n          background: #2a2a2a;\n          border: 1px solid #444;\n          border-radius: 8px;\n          padding: 15px;\n          transition: all 0.3s ease;\n        "\n      >\n        <div\n          class="history-header"\n          style="\n            padding: 12px 15px;\n            background: #1a1a1a;\n            display: flex;\n            justify-content: space-between;\n            align-items: center;\n            cursor: pointer;\n            user-select: none;\n            transition: background 0.2s;\n            border-radius: 6px;\n          "\n          @click="toggleExpanded(index)"\n        >\n          <div class="history-info" style="display: flex; align-items: center; gap: 10px; flex: 1">\n            <span class="history-number" style="color: #4a9eff; font-weight: bold">#{{ index + 1 }}</span>\n            <span class="history-range" style="color: #888; font-size: 12px"\n              >æ¥¼å±‚ {{ item.start_id }} - {{ item.end_id }}</span\n            >\n          </div>\n          <span class="expand-icon" style="color: #888; font-size: 12px">{{ isExpanded(index) ? \'â–¼\' : \'â–¶\' }}</span>\n        </div>\n        <div\n          v-if="isExpanded(index)"\n          class="history-content"\n          style="padding: 15px; background: #2a2a2a; border-radius: 0 0 6px 6px"\n        >\n          <div\n            class="history-actions"\n            style="display: flex; gap: 8px; margin-bottom: 12px; padding-bottom: 8px; border-bottom: 1px solid #3a3a3a"\n          >\n            <button\n              class="mini-button"\n              style="\n                flex: 1;\n                padding: 6px 12px;\n                background: #2a2a2a;\n                border: 1px solid #3a3a3a;\n                border-radius: 4px;\n                color: #e0e0e0;\n                cursor: pointer;\n                font-size: 12px;\n                transition: background 0.2s;\n                display: flex;\n                align-items: center;\n                justify-content: center;\n                gap: 6px;\n              "\n              @click="copySummary(item.content)"\n            >\n              <i class="fa-solid fa-copy"></i> å¤åˆ¶\n            </button>\n            <button\n              class="mini-button worldbook-button"\n              style="\n                flex: 1;\n                padding: 6px 12px;\n                background: #4a9eff;\n                border: 1px solid #5aaeff;\n                border-radius: 4px;\n                color: white;\n                cursor: pointer;\n                font-size: 12px;\n                transition: all 0.2s;\n                display: flex;\n                align-items: center;\n                justify-content: center;\n                gap: 6px;\n              "\n              @click="bindToWorldbook(item.content, index)"\n            >\n              <i class="fa-solid fa-book"></i> ç»‘å®šåˆ°ä¸–ç•Œä¹¦\n            </button>\n            <button\n              class="mini-button delete-button"\n              style="\n                flex: 1;\n                padding: 6px 12px;\n                background: #ff6b6b;\n                border: 1px solid #ff5252;\n                border-radius: 4px;\n                color: white;\n                cursor: pointer;\n                font-size: 12px;\n                transition: all 0.2s;\n                display: flex;\n                align-items: center;\n                justify-content: center;\n                gap: 6px;\n              "\n              @click="deleteSummary(index)"\n            >\n              <i class="fa-solid fa-trash"></i> åˆ é™¤\n            </button>\n          </div>\n          <div\n            class="history-text"\n            style="\n              font-family: \'Courier New\', monospace;\n              font-size: 13px;\n              line-height: 1.6;\n              color: #e0e0e0;\n              white-space: pre-wrap;\n              word-wrap: break-word;\n              user-select: text;\n              cursor: text;\n            "\n          >\n            {{ item.content }}\n          </div>\n        </div>\n      </div>\n    </div>\n    <div v-else class="empty-state" style="text-align: center; padding: 40px 20px; color: #888">\n      <i class="fa-solid fa-inbox" style="font-size: 48px; margin-bottom: 10px; opacity: 0.3"></i>\n      <p style="margin: 10px 0; font-size: 16px">è¿˜æ²¡æœ‰æ€»ç»“è®°å½•</p>\n      <small style="font-size: 12px; color: #666">ä½¿ç”¨"è®¾ç½®"æ ‡ç­¾é¡µæ‰‹åŠ¨åˆ›å»ºæ€»ç»“</small>\n    </div>\n  </div>\n</template>\n\n<script setup lang="ts">\nimport { ref } from \'vue\';\nimport { useSummaryHistoryStore } from \'../settings\';\nimport { getChatIdSafe } from \'../utils\';\n\nconst historyStore = useSummaryHistoryStore();\n\n// å“åº”å¼æ•°æ®\nconst summary_history = ref<Array<{ start_id: number; end_id: number; content: string }>>([]);\nconst expandedState = ref<Map<number, boolean>>(new Map());\n\n// æ›´æ–°æ€»ç»“å†å²çš„å‡½æ•°\nconst refreshSummaryHistory = () => {\n  try {\n    summary_history.value = historyStore.getSummaryHistory();\n    console.log(\'å·²åˆ·æ–°æ€»ç»“å†å²ï¼Œå½“å‰èŠå¤©è®°å½•æ•°:\', summary_history.value.length);\n  } catch (e) {\n    console.error(\'åˆ·æ–°æ€»ç»“å†å²å¤±è´¥:\', e);\n    summary_history.value = [];\n  }\n};\n\n// åˆ‡æ¢å±•å¼€çŠ¶æ€\nconst toggleExpanded = (index: number) => {\n  const current = expandedState.value.get(index) || false;\n  expandedState.value.set(index, !current);\n};\n\nconst isExpanded = (index: number) => {\n  return expandedState.value.get(index) || false;\n};\n\n// å¤„ç†åˆ·æ–°æ•°æ®æŒ‰é’®\nconst handleRefreshData = async () => {\n  console.log(\'åˆ·æ–°æ•°æ®æŒ‰é’®è¢«ç‚¹å‡»\');\n  try {\n    await refreshSummaryHistory();\n    window.toastr.success(\'æ•°æ®å·²åˆ·æ–°\');\n  } catch (error) {\n    console.error(\'åˆ·æ–°æ•°æ®å¤±è´¥:\', error);\n    window.toastr.error(\'åˆ·æ–°æ•°æ®å¤±è´¥: \' + (error as Error).message);\n  }\n};\n\n// ç»Ÿä¸€çš„å¤åˆ¶å‡½æ•° - é’ˆå¯¹iframeç¯å¢ƒä¼˜åŒ–\nconst copyToClipboard = async (text: string, successMessage: string = \'å†…å®¹å·²å¤åˆ¶åˆ°å‰ªè´´æ¿\') => {\n  console.log(\'å¼€å§‹å¤åˆ¶ï¼Œæ–‡æœ¬é•¿åº¦:\', text.length);\n\n  try {\n    // åœ¨iframeç¯å¢ƒä¸­ï¼Œä¼˜å…ˆå°è¯•åœ¨çˆ¶çª—å£ä¸­å¤åˆ¶\n    if (window.parent && window.parent !== window) {\n      console.log(\'æ£€æµ‹åˆ°iframeç¯å¢ƒï¼Œå°è¯•åœ¨çˆ¶çª—å£å¤åˆ¶\');\n      const parentSuccess = await tryParentWindowCopy(text);\n      if (parentSuccess) {\n        console.log(\'çˆ¶çª—å£å¤åˆ¶æˆåŠŸ\');\n        window.toastr.success(successMessage);\n        return;\n      }\n    }\n\n    // æ–¹æ³•1: å°è¯•ä½¿ç”¨ç°ä»£çš„ Clipboard APIï¼ˆä»…åœ¨å®‰å…¨ä¸Šä¸‹æ–‡ä¸­ï¼‰\n    if (navigator.clipboard && window.isSecureContext) {\n      console.log(\'ä½¿ç”¨ç°ä»£ Clipboard API\');\n      try {\n        await navigator.clipboard.writeText(text);\n        console.log(\'Clipboard API å¤åˆ¶æˆåŠŸ\');\n        window.toastr.success(successMessage);\n        return;\n      } catch (clipboardErr) {\n        console.warn(\'Clipboard API å¤±è´¥:\', clipboardErr);\n        // ç»§ç»­å°è¯•å…¶ä»–æ–¹æ³•\n      }\n    }\n\n    // æ–¹æ³•2: ä½¿ç”¨ä¼ ç»Ÿçš„ execCommand æ–¹æ³•\n    console.log(\'ä½¿ç”¨ execCommand æ–¹æ³•\');\n    const success = await execCommandCopy(text);\n    if (success) {\n      console.log(\'execCommand å¤åˆ¶æˆåŠŸ\');\n      window.toastr.success(successMessage);\n      return;\n    }\n\n    // æ–¹æ³•3: å¦‚æœéƒ½å¤±è´¥äº†ï¼Œæ˜¾ç¤ºæ–‡æœ¬æ¡†è®©ç”¨æˆ·æ‰‹åŠ¨å¤åˆ¶\n    console.log(\'æ‰€æœ‰è‡ªåŠ¨å¤åˆ¶æ–¹æ³•éƒ½å¤±è´¥ï¼Œæ˜¾ç¤ºæ‰‹åŠ¨å¤åˆ¶ç•Œé¢\');\n    showManualCopyDialog(text);\n  } catch (err) {\n    console.error(\'å¤åˆ¶å¼‚å¸¸:\', err);\n    // å‡ºé”™æ—¶ä¹Ÿæ˜¾ç¤ºæ‰‹åŠ¨å¤åˆ¶ç•Œé¢\n    showManualCopyDialog(text);\n  }\n};\n\n// åœ¨çˆ¶çª—å£ä¸­å°è¯•å¤åˆ¶\nconst tryParentWindowCopy = async (text: string): Promise<boolean> => {\n  return new Promise(resolve => {\n    try {\n      const parentDoc = window.parent.document;\n      const parentBody = window.parent.document.body;\n\n      // åˆ›å»ºä¸€ä¸ªä¸´æ—¶çš„ textarea å…ƒç´ åœ¨çˆ¶çª—å£ä¸­\n      const textarea = parentDoc.createElement(\'textarea\');\n      textarea.value = text;\n      textarea.style.cssText = `\n        position: fixed;\n        left: -9999px;\n        top: -9999px;\n        opacity: 0;\n        pointer-events: none;\n        z-index: -1000;\n      `;\n      textarea.setAttribute(\'readonly\', \'\');\n\n      parentBody.appendChild(textarea);\n\n      // é€‰ä¸­æ–‡æœ¬\n      textarea.focus();\n      textarea.select();\n      textarea.setSelectionRange(0, text.length);\n\n      // å°è¯•å¤åˆ¶\n      const success = parentDoc.execCommand(\'copy\');\n\n      // æ¸…ç†\n      parentBody.removeChild(textarea);\n\n      resolve(success);\n    } catch (err) {\n      console.error(\'çˆ¶çª—å£å¤åˆ¶å¤±è´¥:\', err);\n      resolve(false);\n    }\n  });\n};\n\n// execCommand å¤åˆ¶æ–¹æ³•\nconst execCommandCopy = async (text: string): Promise<boolean> => {\n  return new Promise(resolve => {\n    try {\n      // åˆ›å»ºä¸€ä¸ªä¸´æ—¶çš„ textarea å…ƒç´ \n      const textarea = document.createElement(\'textarea\');\n      textarea.value = text;\n      textarea.style.position = \'fixed\';\n      textarea.style.left = \'-9999px\';\n      textarea.style.top = \'-9999px\';\n      textarea.style.opacity = \'0\';\n      textarea.style.pointerEvents = \'none\';\n      textarea.setAttribute(\'readonly\', \'\');\n\n      document.body.appendChild(textarea);\n\n      // é€‰ä¸­æ–‡æœ¬\n      textarea.select();\n      textarea.setSelectionRange(0, text.length);\n\n      // å°è¯•å¤åˆ¶\n      const success = document.execCommand(\'copy\');\n\n      // æ¸…ç†\n      document.body.removeChild(textarea);\n\n      resolve(success);\n    } catch (err) {\n      console.error(\'execCommand å¤åˆ¶å¤±è´¥:\', err);\n      resolve(false);\n    }\n  });\n};\n\n// æ‰‹åŠ¨å¤åˆ¶å¯¹è¯æ¡† - æ›´å¯é çš„å®ç°\nconst showManualCopyDialog = (text: string) => {\n  console.log(\'æ˜¾ç¤ºæ‰‹åŠ¨å¤åˆ¶å¯¹è¯æ¡†ï¼Œæ–‡æœ¬é•¿åº¦:\', text.length);\n\n  try {\n    // ä½¿ç”¨çˆ¶çª—å£çš„documentæ¥åˆ›å»ºå…ƒç´ \n    const parentDoc = window.parent.document;\n    const parentBody = window.parent.document.body;\n\n    // ç§»é™¤å¯èƒ½å­˜åœ¨çš„æ—§å¯¹è¯æ¡†\n    const existingOverlay = parentDoc.getElementById(\'manual-copy-overlay\');\n    if (existingOverlay) {\n      parentBody.removeChild(existingOverlay);\n    }\n\n    // åˆ›å»ºé®ç½©å±‚\n    const overlay = parentDoc.createElement(\'div\');\n    overlay.id = \'manual-copy-overlay\';\n    overlay.style.cssText = `\n      position: fixed;\n      top: 0;\n      left: 0;\n      right: 0;\n      bottom: 0;\n      background: rgba(0, 0, 0, 0.95);\n      z-index: 999999;\n      display: flex;\n      align-items: center;\n      justify-content: center;\n      font-family: -apple-system, BlinkMacSystemFont, \'Segoe UI\', Roboto, sans-serif;\n    `;\n\n    // åˆ›å»ºä¸»å®¹å™¨\n    const container = parentDoc.createElement(\'div\');\n    container.style.cssText = `\n      background: #2a2a2a;\n      border: 2px solid #4a9eff;\n      border-radius: 12px;\n      padding: 25px;\n      max-width: 900px;\n      width: 95%;\n      max-height: 85vh;\n      display: flex;\n      flex-direction: column;\n      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);\n    `;\n\n    // åˆ›å»ºæ ‡é¢˜\n    const header = parentDoc.createElement(\'div\');\n    header.innerHTML = `\n      <h3 style="margin: 0 0 15px 0; color: #4a9eff; text-align: center; font-size: 18px; font-weight: 600;">\n        ğŸ“‹ æ‰‹åŠ¨å¤åˆ¶æ€»ç»“å†…å®¹\n      </h3>\n      <div style="background: #1a1a1a; border: 1px solid #444; border-radius: 6px; padding: 12px; margin-bottom: 15px;">\n        <p style="margin: 0 0 8px 0; color: #e0e0e0; font-size: 14px;">\n          <strong>æ“ä½œæ­¥éª¤ï¼š</strong>\n        </p>\n        <ol style="margin: 0; padding-left: 20px; color: #ccc; font-size: 13px; line-height: 1.6;">\n          <li>ç‚¹å‡»ä¸‹æ–¹æ–‡æœ¬æ¡†</li>\n          <li>æŒ‰ <kbd style="background: #444; padding: 2px 6px; border-radius: 3px; color: #fff;">Ctrl+A</kbd> å…¨é€‰æ–‡æœ¬</li>\n          <li>æŒ‰ <kbd style="background: #444; padding: 2px 6px; border-radius: 3px; color: #fff;">Ctrl+C</kbd> å¤åˆ¶åˆ°å‰ªè´´æ¿</li>\n          <li>ç‚¹å‡»"å…³é—­"æŒ‰é’®æˆ–æŒ‰ <kbd style="background: #444; padding: 2px 6px; border-radius: 3px; color: #fff;">Esc</kbd> å…³é—­å¯¹è¯æ¡†</li>\n        </ol>\n      </div>\n    `;\n\n    // åˆ›å»ºæ–‡æœ¬æ¡†\n    const textarea = parentDoc.createElement(\'textarea\');\n    textarea.value = text;\n    textarea.style.cssText = `\n      width: 100%;\n      height: 400px;\n      background: #1a1a1a;\n      border: 2px solid #444;\n      border-radius: 6px;\n      padding: 15px;\n      color: #e0e0e0;\n      font-family: \'Courier New\', \'Consolas\', monospace;\n      font-size: 13px;\n      line-height: 1.5;\n      resize: vertical;\n      white-space: pre-wrap;\n      word-wrap: break-word;\n      outline: none;\n      margin-bottom: 20px;\n      box-sizing: border-box;\n    `;\n\n    // åˆ›å»ºæŒ‰é’®å®¹å™¨\n    const buttonContainer = parentDoc.createElement(\'div\');\n    buttonContainer.style.cssText = `\n      display: flex;\n      gap: 12px;\n      justify-content: center;\n      align-items: center;\n    `;\n\n    // åˆ›å»ºå…³é—­æŒ‰é’®\n    const closeButton = parentDoc.createElement(\'button\');\n    closeButton.textContent = \'å…³é—­\';\n    closeButton.style.cssText = `\n      background: #4a9eff;\n      color: white;\n      border: none;\n      padding: 12px 24px;\n      border-radius: 6px;\n      cursor: pointer;\n      font-size: 14px;\n      font-weight: 500;\n      transition: background 0.2s;\n    `;\n    closeButton.onmouseover = () => {\n      closeButton.style.background = \'#5ba8ff\';\n    };\n    closeButton.onmouseout = () => {\n      closeButton.style.background = \'#4a9eff\';\n    };\n\n    // åˆ›å»ºå¤åˆ¶æŒ‰é’®ï¼ˆå¤‡ç”¨ï¼‰\n    const copyButton = parentDoc.createElement(\'button\');\n    copyButton.textContent = \'å°è¯•è‡ªåŠ¨å¤åˆ¶\';\n    copyButton.style.cssText = `\n      background: #28a745;\n      color: white;\n      border: none;\n      padding: 12px 24px;\n      border-radius: 6px;\n      cursor: pointer;\n      font-size: 14px;\n      font-weight: 500;\n      transition: background 0.2s;\n    `;\n    copyButton.onmouseover = () => {\n      copyButton.style.background = \'#218838\';\n    };\n    copyButton.onmouseout = () => {\n      copyButton.style.background = \'#28a745\';\n    };\n\n    // ç»„è£…å…ƒç´ \n    buttonContainer.appendChild(copyButton);\n    buttonContainer.appendChild(closeButton);\n\n    container.appendChild(header);\n    container.appendChild(textarea);\n    container.appendChild(buttonContainer);\n    overlay.appendChild(container);\n\n    // æ·»åŠ åˆ°é¡µé¢\n    parentBody.appendChild(overlay);\n\n    // äº‹ä»¶å¤„ç†\n    closeButton.onclick = () => {\n      console.log(\'å…³é—­æŒ‰é’®è¢«ç‚¹å‡»\');\n      parentBody.removeChild(overlay);\n    };\n\n    copyButton.onclick = async () => {\n      console.log(\'å°è¯•è‡ªåŠ¨å¤åˆ¶æŒ‰é’®è¢«ç‚¹å‡»\');\n      try {\n        // é€‰ä¸­æ–‡æœ¬\n        textarea.focus();\n        textarea.select();\n\n        // å°è¯•å¤åˆ¶\n        const success = document.execCommand(\'copy\');\n        if (success) {\n          window.toastr.success(\'è‡ªåŠ¨å¤åˆ¶æˆåŠŸï¼\');\n          parentBody.removeChild(overlay);\n        } else {\n          window.toastr.warning(\'è‡ªåŠ¨å¤åˆ¶å¤±è´¥ï¼Œè¯·æ‰‹åŠ¨å¤åˆ¶\');\n        }\n      } catch (err) {\n        console.error(\'è‡ªåŠ¨å¤åˆ¶å¤±è´¥:\', err);\n        window.toastr.warning(\'è‡ªåŠ¨å¤åˆ¶å¤±è´¥ï¼Œè¯·æ‰‹åŠ¨å¤åˆ¶\');\n      }\n    };\n\n    // ç‚¹å‡»èƒŒæ™¯å…³é—­\n    overlay.onclick = e => {\n      if (e.target === overlay) {\n        console.log(\'ç‚¹å‡»èƒŒæ™¯å…³é—­\');\n        parentBody.removeChild(overlay);\n      }\n    };\n\n    // é”®ç›˜äº‹ä»¶å¤„ç†\n    const handleKeyDown = (e: KeyboardEvent) => {\n      if (e.key === \'Escape\') {\n        console.log(\'æŒ‰ESCé”®å…³é—­\');\n        parentBody.removeChild(overlay);\n        parentDoc.removeEventListener(\'keydown\', handleKeyDown);\n      }\n    };\n    parentDoc.addEventListener(\'keydown\', handleKeyDown);\n\n    // è‡ªåŠ¨é€‰ä¸­æ–‡æœ¬\n    setTimeout(() => {\n      console.log(\'è‡ªåŠ¨é€‰ä¸­æ–‡æœ¬\');\n      textarea.focus();\n      textarea.select();\n    }, 200);\n\n    // æ˜¾ç¤ºæˆåŠŸæ¶ˆæ¯\n    window.toastr.info(\'æ‰‹åŠ¨å¤åˆ¶å¯¹è¯æ¡†å·²æ‰“å¼€ï¼Œè¯·æŒ‰ç…§æç¤ºæ“ä½œ\');\n  } catch (err) {\n    console.error(\'åˆ›å»ºæ‰‹åŠ¨å¤åˆ¶å¯¹è¯æ¡†å¤±è´¥:\', err);\n    window.toastr.error(\'æ— æ³•æ˜¾ç¤ºå¤åˆ¶å¯¹è¯æ¡†ï¼Œè¯·æ£€æŸ¥æµè§ˆå™¨æƒé™\');\n  }\n};\n\n// å¤åˆ¶æ€»ç»“ - ä½¿ç”¨ç»Ÿä¸€çš„å¤åˆ¶å‡½æ•°\nconst copySummary = (content: string) => {\n  copyToClipboard(content, \'æ€»ç»“å·²å¤åˆ¶åˆ°å‰ªè´´æ¿\');\n};\n\n// åˆ é™¤æ€»ç»“\nconst deleteSummary = (index: number) => {\n  if (confirm(\'ç¡®å®šè¦åˆ é™¤è¿™æ¡æ€»ç»“å—ï¼Ÿ\')) {\n    try {\n      const chat_id = getChatIdSafe();\n      if (!chat_id) {\n        window.toastr.error(\'æ— æ³•è·å–å½“å‰èŠå¤©ä¿¡æ¯\');\n        return;\n      }\n\n      summary_history.value.splice(index, 1);\n      insertOrAssignVariables({ summary_history: summary_history.value }, { type: \'chat\' });\n      window.toastr.success(\'æ€»ç»“å·²åˆ é™¤\');\n    } catch (error) {\n      console.error(\'åˆ é™¤æ€»ç»“å¤±è´¥:\', error);\n      window.toastr.error(\'åˆ é™¤æ€»ç»“å¤±è´¥\');\n    }\n  }\n};\n\n// åˆ›å»ºæ€»ç»“ä¸–ç•Œä¹¦\nconst createSummaryWorldbook = async () => {\n  try {\n    // è·å–å½“å‰è§’è‰²å¡ä¿¡æ¯\n    let characterName = \'æœªçŸ¥è§’è‰²\';\n    try {\n      const currentCharacter = getCharData(\'current\');\n      if (currentCharacter && currentCharacter.name) {\n        characterName = currentCharacter.name;\n        // æ¸…ç†è§’è‰²åä¸­çš„ç‰¹æ®Šå­—ç¬¦ï¼Œé¿å…æ–‡ä»¶åé—®é¢˜\n        characterName = characterName.replace(/[<>:"/\\\\|?*]/g, \'_\').trim();\n      }\n    } catch (charError) {\n      console.warn(\'è·å–è§’è‰²ä¿¡æ¯å¤±è´¥:\', charError);\n    }\n\n    // ç”ŸæˆåŒ…å«è§’è‰²åå’Œæ—¥æœŸçš„ä¸–ç•Œä¹¦åç§°\n    const dateStr = new Date().toISOString().slice(0, 10);\n    const worldbookName = `æ€»ç»“_${characterName}_${dateStr}`;\n\n    console.log(\'å‡†å¤‡åˆ›å»ºä¸–ç•Œä¹¦:\', worldbookName);\n\n    const existingWorldbooks = getWorldbookNames();\n    if (existingWorldbooks.includes(worldbookName)) {\n      window.toastr.warning(`ä¸–ç•Œä¹¦ "${worldbookName}" å·²å­˜åœ¨`);\n      return;\n    }\n\n    await createWorldbook(worldbookName, []);\n\n    try {\n      await rebindChatWorldbook(\'current\', worldbookName);\n      window.toastr.success(`å·²åˆ›å»ºæ€»ç»“ä¸–ç•Œä¹¦ "${worldbookName}" å¹¶ç»‘å®šåˆ°å½“å‰èŠå¤©`);\n    } catch (bindError) {\n      console.warn(\'ç»‘å®šåˆ°èŠå¤©å¤±è´¥:\', bindError);\n      window.toastr.success(`å·²åˆ›å»ºæ€»ç»“ä¸–ç•Œä¹¦ "${worldbookName}"ï¼Œè¯·æ‰‹åŠ¨åœ¨èŠå¤©çŸ¥è¯†ä¹¦ä¸­ç»‘å®š`);\n    }\n  } catch (error) {\n    console.error(\'åˆ›å»ºæ€»ç»“ä¸–ç•Œä¹¦å¤±è´¥:\', error);\n    window.toastr.error(\'åˆ›å»ºæ€»ç»“ä¸–ç•Œä¹¦å¤±è´¥: \' + (error as Error).message);\n  }\n};\n\n// ç»‘å®šæ€»ç»“åˆ°ä¸–ç•Œä¹¦\nconst bindToWorldbook = async (content: string, summaryIndex: number) => {\n  try {\n    const worldbookNames = getWorldbookNames();\n    if (worldbookNames.length === 0) {\n      window.toastr.warning(\'æ²¡æœ‰å¯ç”¨çš„ä¸–ç•Œä¹¦ï¼Œè¯·å…ˆåˆ›å»ºæ€»ç»“ä¸–ç•Œä¹¦\');\n      return;\n    }\n\n    const selectedWorldbook =\n      worldbookNames.length === 1 ? worldbookNames[0] : await promptForWorldbook(worldbookNames);\n    if (!selectedWorldbook) {\n      return;\n    }\n\n    const entryName = `æ€»ç»“_${summaryIndex + 1}_${new Date().toLocaleDateString()}`;\n    const newEntry = {\n      name: entryName,\n      enabled: true,\n      strategy: {\n        type: \'constant\' as const,\n        keys: [],\n        keys_secondary: { logic: \'and_any\' as const, keys: [] },\n        scan_depth: \'same_as_global\' as const,\n      },\n      position: {\n        type: \'before_character_definition\' as const,\n        role: \'system\' as const,\n        depth: 1,\n      },\n      content: content,\n      comment: `è‡ªåŠ¨ç”Ÿæˆçš„æ€»ç»“æ¡ç›® - æ¥¼å±‚èŒƒå›´: ${summary_history.value[summaryIndex]?.start_id || \'?\'} - ${summary_history.value[summaryIndex]?.end_id || \'?\'}`,\n      insertion_order: 0,\n      case_sensitive: false,\n      name_is_regex: false,\n      keys_are_regex: false,\n      selective_logic: \'and\',\n      secondary_keys_logic: \'and\',\n      activation_threshold: 0,\n      disabled: false,\n      order: 0,\n      group: \'\',\n      local_id: 0,\n      depth_entries: [],\n      depth_entries_all: false,\n      search_range: 0,\n      force_activation: false,\n      disable: false,\n      exclude_recursion: false,\n      hidden: false,\n      priority: 0,\n      comment_is_regex: false,\n      content_is_regex: false,\n      secondary_keys_are_regex: false,\n      keys_secondary_are_regex: false,\n      uid: Date.now(),\n    };\n\n    await createWorldbookEntries(selectedWorldbook, [newEntry]);\n    window.toastr.success(`æ€»ç»“å·²ç»‘å®šåˆ°ä¸–ç•Œä¹¦: ${selectedWorldbook}`);\n  } catch (error) {\n    console.error(\'ç»‘å®šåˆ°ä¸–ç•Œä¹¦å¤±è´¥:\', error);\n    window.toastr.error(\'ç»‘å®šåˆ°ä¸–ç•Œä¹¦å¤±è´¥: \' + (error as Error).message);\n  }\n};\n\n// è®©ç”¨æˆ·é€‰æ‹©ä¸–ç•Œä¹¦çš„è¾…åŠ©å‡½æ•°\nconst promptForWorldbook = async (worldbookNames: string[]): Promise<string | null> => {\n  return new Promise<string | null>(resolve => {\n    const dialog = $(`\n      <div style="\n        position: fixed;\n        top: 50%;\n        left: 50%;\n        transform: translate(-50%, -50%);\n        background: #2a2a2a;\n        border: 1px solid #3a3a3a;\n        border-radius: 8px;\n        padding: 20px;\n        z-index: 1000000;\n        min-width: 300px;\n      ">\n        <h3 style="margin: 0 0 15px 0; color: #e0e0e0;">é€‰æ‹©ä¸–ç•Œä¹¦</h3>\n        <div style="margin-bottom: 15px;">\n          ${worldbookNames\n            .map(\n              name => `\n            <label style="display: block; margin: 5px 0; color: #e0e0e0;">\n              <input type="radio" name="worldbook" value="${name}" style="margin-right: 8px;">\n              ${name}\n            </label>\n          `,\n            )\n            .join(\'\')}\n        </div>\n        <div style="text-align: right;">\n          <button id="cancelWorldbook" style="\n            background: #666;\n            color: white;\n            border: none;\n            padding: 8px 16px;\n            border-radius: 4px;\n            margin-right: 10px;\n            cursor: pointer;\n          ">å–æ¶ˆ</button>\n          <button id="confirmWorldbook" style="\n            background: #4a9eff;\n            color: white;\n            border: none;\n            padding: 8px 16px;\n            border-radius: 4px;\n            cursor: pointer;\n          ">ç¡®å®š</button>\n        </div>\n      </div>\n    `);\n\n    const overlay = $(`\n      <div style="\n        position: fixed;\n        top: 0;\n        left: 0;\n        width: 100%;\n        height: 100%;\n        background: rgba(0, 0, 0, 0.5);\n        z-index: 999999;\n      "></div>\n    `);\n\n    $(\'body\').append(overlay).append(dialog);\n\n    $(\'#cancelWorldbook\').on(\'click\', () => {\n      overlay.remove();\n      dialog.remove();\n      resolve(null);\n    });\n\n    $(\'#confirmWorldbook\').on(\'click\', () => {\n      const selected = $(\'input[name="worldbook"]:checked\').val() as string;\n      overlay.remove();\n      dialog.remove();\n      resolve(selected || null);\n    });\n\n    $(\'input[name="worldbook"]:first\').prop(\'checked\', true);\n  });\n};\n\n// æ˜¾ç¤ºè°ƒè¯•é¢æ¿\nconst showDebugPanel = () => {\n  try {\n    // ä½¿ç”¨çˆ¶çª—å£çš„documentæ¥åˆ›å»ºå…ƒç´ \n    const parentDoc = window.parent.document;\n    const parentBody = window.parent.document.body;\n\n    // ç§»é™¤å¯èƒ½å­˜åœ¨çš„æ—§å¯¹è¯æ¡†\n    const existingOverlay = parentDoc.getElementById(\'debug-panel-overlay\');\n    if (existingOverlay) {\n      parentBody.removeChild(existingOverlay);\n    }\n\n    // åˆ›å»ºé®ç½©å±‚\n    const overlay = parentDoc.createElement(\'div\');\n    overlay.id = \'debug-panel-overlay\';\n    overlay.style.cssText = `\n      position: fixed;\n      top: 0;\n      left: 0;\n      right: 0;\n      bottom: 0;\n      background: rgba(0, 0, 0, 0.95);\n      z-index: 999999;\n      display: flex;\n      align-items: center;\n      justify-content: center;\n      font-family: -apple-system, BlinkMacSystemFont, \'Segoe UI\', Roboto, sans-serif;\n    `;\n\n    // åˆ›å»ºä¸»å®¹å™¨\n    const container = parentDoc.createElement(\'div\');\n    container.style.cssText = `\n      background: #2a2a2a;\n      border: 2px solid #ffc107;\n      border-radius: 12px;\n      padding: 25px;\n      max-width: 800px;\n      width: 95%;\n      max-height: 85vh;\n      display: flex;\n      flex-direction: column;\n      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);\n    `;\n\n    // åˆ›å»ºæ ‡é¢˜\n    const header = parentDoc.createElement(\'div\');\n    header.innerHTML = `\n      <h3 style="margin: 0 0 15px 0; color: #ffc107; text-align: center; font-size: 18px; font-weight: 600;">\n        ğŸ› è‡ªåŠ¨æ€»ç»“è°ƒè¯•å·¥å…·\n      </h3>\n      <div style="background: #1a1a1a; border: 1px solid #444; border-radius: 6px; padding: 12px; margin-bottom: 15px;">\n        <p style="margin: 0 0 8px 0; color: #e0e0e0; font-size: 14px;">\n          <strong>è°ƒè¯•åŠŸèƒ½ï¼š</strong>\n        </p>\n        <ul style="margin: 0; padding-left: 20px; color: #ccc; font-size: 13px; line-height: 1.6;">\n          <li>æµ‹è¯•è‡ªåŠ¨æ€»ç»“æµç¨‹</li>\n          <li>åŒæ­¥localStorageæ•°æ®åˆ°é…’é¦†åŠ©æ‰‹å˜é‡</li>\n          <li>æ£€æŸ¥å½“å‰æ¥¼å±‚çŠ¶æ€</li>\n          <li>éªŒè¯è§¦å‘æ¡ä»¶è®¡ç®—</li>\n        </ul>\n      </div>\n    `;\n\n    // åˆ›å»ºæŒ‰é’®å®¹å™¨\n    const buttonContainer = parentDoc.createElement(\'div\');\n    buttonContainer.style.cssText = `\n      display: grid;\n      grid-template-columns: 1fr 1fr;\n      gap: 12px;\n      margin-bottom: 20px;\n    `;\n\n    // åˆ›å»ºæŒ‰é’®\n    const buttons = [\n      { id: \'testComplete\', text: \'ğŸ§ª æµ‹è¯•å®Œæ•´æµç¨‹\', color: \'#4a9eff\' },\n      { id: \'syncData\', text: \'ğŸ”„ åŒæ­¥æ•°æ®\', color: \'#28a745\' },\n      { id: \'checkFloor\', text: \'ğŸ” æ£€æŸ¥æ¥¼å±‚\', color: \'#17a2b8\' },\n      { id: \'testCalculation\', text: \'ğŸ§® éªŒè¯è®¡ç®—\', color: \'#6f42c1\' },\n      { id: \'showStatus\', text: \'ğŸ“Š æ˜¾ç¤ºçŠ¶æ€\', color: \'#fd7e14\' },\n      { id: \'resetStartId\', text: \'ğŸ”„ é‡ç½®èµ·å§‹æ¥¼å±‚\', color: \'#dc3545\' },\n    ];\n\n    buttons.forEach(button => {\n      const btn = parentDoc.createElement(\'button\');\n      btn.id = button.id;\n      btn.textContent = button.text;\n      btn.style.cssText = `\n        background: ${button.color};\n        color: white;\n        border: none;\n        padding: 12px 16px;\n        border-radius: 6px;\n        cursor: pointer;\n        font-size: 13px;\n        font-weight: 500;\n        transition: background 0.2s;\n      `;\n      btn.onmouseover = () => {\n        btn.style.opacity = \'0.8\';\n      };\n      btn.onmouseout = () => {\n        btn.style.opacity = \'1\';\n      };\n      buttonContainer.appendChild(btn);\n    });\n\n    // åˆ›å»ºè¾“å‡ºåŒºåŸŸ\n    const outputArea = parentDoc.createElement(\'div\');\n    outputArea.id = \'debug-output\';\n    outputArea.style.cssText = `\n      background: #1a1a1a;\n      border: 1px solid #444;\n      border-radius: 6px;\n      padding: 15px;\n      height: 200px;\n      overflow-y: auto;\n      font-family: \'Courier New\', \'Consolas\', monospace;\n      font-size: 12px;\n      color: #e0e0e0;\n      white-space: pre-wrap;\n      margin-bottom: 20px;\n    `;\n    outputArea.textContent = \'ç‚¹å‡»ä¸Šæ–¹æŒ‰é’®å¼€å§‹è°ƒè¯•...\\n\';\n\n    // åˆ›å»ºå…³é—­æŒ‰é’®\n    const closeButton = parentDoc.createElement(\'button\');\n    closeButton.textContent = \'å…³é—­\';\n    closeButton.style.cssText = `\n      background: #6c757d;\n      color: white;\n      border: none;\n      padding: 12px 24px;\n      border-radius: 6px;\n      cursor: pointer;\n      font-size: 14px;\n      font-weight: 500;\n      transition: background 0.2s;\n      align-self: center;\n    `;\n\n    // ç»„è£…å…ƒç´ \n    container.appendChild(header);\n    container.appendChild(buttonContainer);\n    container.appendChild(outputArea);\n    container.appendChild(closeButton);\n\n    overlay.appendChild(container);\n    parentBody.appendChild(overlay);\n\n    // æ·»åŠ æ—¥å¿—å‡½æ•°\n    const log = (message: string) => {\n      const output = parentDoc.getElementById(\'debug-output\');\n      if (output) {\n        output.textContent += message + \'\\n\';\n        output.scrollTop = output.scrollHeight;\n      }\n    };\n\n    // äº‹ä»¶å¤„ç†\n    closeButton.onclick = () => {\n      parentBody.removeChild(overlay);\n    };\n\n    // æµ‹è¯•å®Œæ•´æµç¨‹\n    parentDoc.getElementById(\'testComplete\')?.addEventListener(\'click\', () => {\n      log(\'ğŸ§ª å¼€å§‹æµ‹è¯•å®Œæ•´è‡ªåŠ¨æ€»ç»“æµç¨‹...\');\n      try {\n        if ((window as any).testCompleteAutoSummary) {\n          (window as any).testCompleteAutoSummary();\n          log(\'âœ… æµ‹è¯•å‡½æ•°å·²æ‰§è¡Œï¼Œè¯·æŸ¥çœ‹æ§åˆ¶å°è¾“å‡º\');\n        } else {\n          log(\'âŒ æµ‹è¯•å‡½æ•°ä¸å¯ç”¨\');\n        }\n      } catch (error) {\n        log(\'âŒ æµ‹è¯•å¤±è´¥: \' + (error as Error).message);\n      }\n    });\n\n    // åŒæ­¥æ•°æ®\n    parentDoc.getElementById(\'syncData\')?.addEventListener(\'click\', () => {\n      log(\'ğŸ”„ å¼€å§‹åŒæ­¥æ•°æ®...\');\n      try {\n        if ((window as any).syncAutoSummaryData) {\n          (window as any).syncAutoSummaryData();\n          log(\'âœ… åŒæ­¥å‡½æ•°å·²æ‰§è¡Œï¼Œè¯·æŸ¥çœ‹æ§åˆ¶å°è¾“å‡º\');\n        } else {\n          log(\'âŒ åŒæ­¥å‡½æ•°ä¸å¯ç”¨\');\n        }\n      } catch (error) {\n        log(\'âŒ åŒæ­¥å¤±è´¥: \' + (error as Error).message);\n      }\n    });\n\n    // æ£€æŸ¥æ¥¼å±‚\n    parentDoc.getElementById(\'checkFloor\')?.addEventListener(\'click\', () => {\n      log(\'ğŸ” å¼€å§‹æ£€æŸ¥æ¥¼å±‚...\');\n      try {\n        if ((window as any).checkCurrentFloor) {\n          (window as any).checkCurrentFloor();\n          log(\'âœ… æ¥¼å±‚æ£€æŸ¥å‡½æ•°å·²æ‰§è¡Œï¼Œè¯·æŸ¥çœ‹æ§åˆ¶å°è¾“å‡º\');\n        } else {\n          log(\'âŒ æ¥¼å±‚æ£€æŸ¥å‡½æ•°ä¸å¯ç”¨\');\n        }\n      } catch (error) {\n        log(\'âŒ æ¥¼å±‚æ£€æŸ¥å¤±è´¥: \' + (error as Error).message);\n      }\n    });\n\n    // éªŒè¯è®¡ç®—\n    parentDoc.getElementById(\'testCalculation\')?.addEventListener(\'click\', () => {\n      log(\'ğŸ§® å¼€å§‹éªŒè¯è®¡ç®—...\');\n      try {\n        if ((window as any).testFloorCalculation) {\n          (window as any).testFloorCalculation();\n          log(\'âœ… è®¡ç®—éªŒè¯å‡½æ•°å·²æ‰§è¡Œï¼Œè¯·æŸ¥çœ‹æ§åˆ¶å°è¾“å‡º\');\n        } else {\n          log(\'âŒ è®¡ç®—éªŒè¯å‡½æ•°ä¸å¯ç”¨\');\n        }\n      } catch (error) {\n        log(\'âŒ è®¡ç®—éªŒè¯å¤±è´¥: \' + (error as Error).message);\n      }\n    });\n\n    // æ˜¾ç¤ºçŠ¶æ€\n    parentDoc.getElementById(\'showStatus\')?.addEventListener(\'click\', () => {\n      log(\'ğŸ“Š å¼€å§‹æ˜¾ç¤ºçŠ¶æ€...\');\n      try {\n        if ((window as any).checkAutoSummaryStatus) {\n          (window as any).checkAutoSummaryStatus();\n          log(\'âœ… çŠ¶æ€æ£€æŸ¥å‡½æ•°å·²æ‰§è¡Œï¼Œè¯·æŸ¥çœ‹æ§åˆ¶å°è¾“å‡º\');\n        } else {\n          log(\'âŒ çŠ¶æ€æ£€æŸ¥å‡½æ•°ä¸å¯ç”¨\');\n        }\n      } catch (error) {\n        log(\'âŒ çŠ¶æ€æ£€æŸ¥å¤±è´¥: \' + (error as Error).message);\n      }\n    });\n\n    // é‡ç½®èµ·å§‹æ¥¼å±‚\n    parentDoc.getElementById(\'resetStartId\')?.addEventListener(\'click\', () => {\n      log(\'ğŸ”„ å¼€å§‹é‡ç½®èµ·å§‹æ¥¼å±‚...\');\n      try {\n        if ((window as any).smartResetChat) {\n          (window as any).smartResetChat();\n          log(\'âœ… é‡ç½®å‡½æ•°å·²æ‰§è¡Œï¼Œè¯·æŸ¥çœ‹æ§åˆ¶å°è¾“å‡º\');\n        } else {\n          log(\'âŒ é‡ç½®å‡½æ•°ä¸å¯ç”¨\');\n        }\n      } catch (error) {\n        log(\'âŒ é‡ç½®å¤±è´¥: \' + (error as Error).message);\n      }\n    });\n\n    // ç‚¹å‡»èƒŒæ™¯å…³é—­\n    overlay.onclick = e => {\n      if (e.target === overlay) {\n        parentBody.removeChild(overlay);\n      }\n    };\n\n    // é”®ç›˜äº‹ä»¶å¤„ç†\n    const handleKeyDown = (e: KeyboardEvent) => {\n      if (e.key === \'Escape\') {\n        parentBody.removeChild(overlay);\n        parentDoc.removeEventListener(\'keydown\', handleKeyDown);\n      }\n    };\n    parentDoc.addEventListener(\'keydown\', handleKeyDown);\n\n    window.toastr?.info(\'è°ƒè¯•é¢æ¿å·²æ‰“å¼€\');\n  } catch (err) {\n    console.error(\'åˆ›å»ºè°ƒè¯•é¢æ¿å¤±è´¥:\', err);\n    window.toastr?.error(\'æ— æ³•æ˜¾ç¤ºè°ƒè¯•é¢æ¿ï¼Œè¯·æ£€æŸ¥æµè§ˆå™¨æƒé™\');\n  }\n};\n\n// åˆå§‹åŒ–\nrefreshSummaryHistory();\n<\/script>\n\n<style scoped>\n.summary-tab {\n  height: 100%;\n  overflow-y: auto;\n  padding: 25px !important;\n}\n\n.section-header {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  padding: 20px 25px !important;\n  border-bottom: 1px solid #3a3a3a;\n  margin-bottom: 5px;\n}\n\n.section-header h3 {\n  margin: 0;\n  color: #fff;\n  font-size: 15px !important;\n  font-weight: bold;\n  display: flex;\n  align-items: center;\n  gap: 8px;\n}\n\n.header-actions {\n  display: flex;\n  align-items: center;\n  gap: 10px;\n}\n\n.count-badge {\n  background: #4a9eff;\n  color: white;\n  padding: 4px 8px;\n  border-radius: 12px;\n  font-size: 12px;\n}\n\n.empty-state {\n  text-align: center;\n  padding: 40px 20px;\n  color: #888;\n}\n\n.empty-state i {\n  font-size: 48px;\n  margin-bottom: 10px;\n  opacity: 0.3;\n}\n\n.empty-state p {\n  margin: 10px 0;\n  font-size: 14px;\n}\n\n.empty-state small {\n  color: #666;\n  font-size: 12px;\n}\n\n.history-list {\n  display: flex;\n  flex-direction: column;\n  gap: 10px;\n  padding: 15px 20px;\n}\n\n.history-item {\n  background: #2a2a2a;\n  border: 1px solid #3a3a3a;\n  border-radius: 6px;\n  overflow: hidden;\n  transition: border-color 0.2s;\n}\n\n.history-item:hover {\n  border-color: #4a4a4a;\n}\n\n.history-header {\n  padding: 12px 15px;\n  background: #1a1a1a;\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  cursor: pointer;\n  user-select: none;\n  transition: background 0.2s;\n}\n\n.history-header:hover {\n  background: #2a2a2a;\n}\n\n.history-info {\n  display: flex;\n  align-items: center;\n  gap: 10px;\n  flex: 1;\n}\n\n.history-number {\n  color: #4a9eff;\n  font-weight: bold;\n}\n\n.history-range {\n  color: #888;\n  font-size: 12px;\n}\n\n.expand-icon {\n  color: #888;\n  font-size: 12px;\n}\n\n.history-content {\n  padding: 15px;\n  background: #2a2a2a;\n}\n\n.history-actions {\n  display: flex;\n  gap: 8px;\n  margin-bottom: 12px;\n  padding-bottom: 8px;\n  border-bottom: 1px solid #3a3a3a;\n}\n\n.mini-button {\n  flex: 1;\n  padding: 6px 12px;\n  background: #2a2a2a;\n  border: 1px solid #3a3a3a;\n  border-radius: 4px;\n  color: #e0e0e0;\n  cursor: pointer;\n  font-size: 12px;\n  transition: background 0.2s;\n}\n\n.mini-button:hover {\n  background: #3a3a3a;\n}\n\n.mini-button.delete-button:hover {\n  background: #ff4444;\n  border-color: #ff4444;\n  color: white;\n}\n\n.mini-button.worldbook-button {\n  background: #28a745;\n  color: white;\n  border-color: #28a745;\n}\n\n.mini-button.worldbook-button:hover {\n  background: #218838;\n  border-color: #218838;\n  color: white;\n}\n\n.mini-button.create-worldbook-button {\n  background: #17a2b8;\n  color: white;\n  border-color: #17a2b8;\n}\n\n.mini-button.create-worldbook-button:hover {\n  background: #138496;\n  border-color: #138496;\n  color: white;\n}\n\n.mini-button.refresh-button {\n  background: #6c757d;\n  color: white;\n  border-color: #6c757d;\n}\n\n.mini-button.refresh-button:hover {\n  background: #5a6268;\n  border-color: #5a6268;\n  color: white;\n}\n\n.mini-button.debug-button {\n  background: #ffc107;\n  color: #000;\n  border-color: #ffb300;\n}\n\n.mini-button.debug-button:hover {\n  background: #e0a800;\n  border-color: #d39e00;\n  color: #000;\n}\n\n.history-text {\n  white-space: pre-wrap;\n  word-wrap: break-word;\n  line-height: 1.6;\n  max-height: 400px;\n  overflow-y: auto;\n}\n</style>\n'],sourceRoot:''}]);const i=s},162:(n,e,t)=>{var o=t(55);o.__esModule&&(o=o.default),'string'==typeof o&&(o=[[n.id,o,'']]),o.locals&&(n.exports=o.locals);(0,t(424).A)('1ebe0c94',o,!1,{ssrId:!0})},193:(n,e,t)=>{t.d(e,{Ut:()=>a,aJ:()=>r,pA:()=>s});let o=null;function a(){if(!o)try{'function'==typeof getScriptId&&(o=getScriptId())}catch(n){console.warn('è·å– script_id å¤±è´¥:',n)}return o}function r(n){o=n}function s(){try{if('function'==typeof window.getChatId)return window.getChatId();if(void 0!==window.SillyTavern&&window.SillyTavern.getCurrentChatId)return window.SillyTavern.getCurrentChatId()}catch(n){console.warn('è·å– chat_id å¤±è´¥:',n)}return null}},241:(n,e,t)=>{t.r(e),t.d(e,{default:()=>i});var o=t(790),a=t.n(o),r=t(54),s=t.n(r)()(a());s.push([n.id,'.memory-panel-container[data-v-4ef9901c]{display:flex;flex-direction:column;height:100%;background:#1a1a1a;color:#e0e0e0}.panel-header[data-v-4ef9901c]{padding:15px 20px;background:#2a2a2a;border-bottom:1px solid #3a3a3a;display:flex;justify-content:space-between;align-items:center;border-radius:8px 8px 0 0}.header-left[data-v-4ef9901c]{display:flex;align-items:center;gap:10px}.close-button[data-v-4ef9901c]{cursor:pointer;padding:5px 10px;border-radius:4px;transition:background 0.2s}.close-button[data-v-4ef9901c]:hover{background:rgba(255,255,255,0.1)}.panel-tabs[data-v-4ef9901c]{display:flex;background:#2a2a2a;border-bottom:1px solid #3a3a3a}.tab-item[data-v-4ef9901c]{flex:1;padding:12px 20px;cursor:pointer;text-align:center;transition:background 0.2s,color 0.2s;display:flex;align-items:center;justify-content:center;gap:8px;border-bottom:2px solid transparent}.tab-item[data-v-4ef9901c]:hover{background:rgba(255,255,255,0.05)}.tab-item.tab-active[data-v-4ef9901c]{background:#1a1a1a;color:#4a9eff;border-bottom-color:#4a9eff}.panel-content[data-v-4ef9901c]{flex:1;overflow-y:auto;overflow-x:hidden;padding:0;min-height:0;scrollbar-width:thin;scrollbar-color:#4a9eff #2a2a2a}.panel-content[data-v-4ef9901c]::-webkit-scrollbar{width:8px}.panel-content[data-v-4ef9901c]::-webkit-scrollbar-track{background:#2a2a2a;border-radius:4px}.panel-content[data-v-4ef9901c]::-webkit-scrollbar-thumb{background:#4a9eff;border-radius:4px}.panel-content[data-v-4ef9901c]::-webkit-scrollbar-thumb:hover{background:#5ba8ff}.panel-content[data-v-4ef9901c]{scrollbar-width:thin !important;scrollbar-color:#4a9eff #2a2a2a !important}.panel-content[data-v-4ef9901c]::-webkit-scrollbar{width:8px !important;display:block !important}.panel-content[data-v-4ef9901c]::-webkit-scrollbar-track{background:#2a2a2a !important;border-radius:4px !important}.panel-content[data-v-4ef9901c]::-webkit-scrollbar-thumb{background:#4a9eff !important;border-radius:4px !important}.panel-content[data-v-4ef9901c]::-webkit-scrollbar-thumb:hover{background:#5ba8ff !important}\n','',{version:3,sources:['webpack://./src/è®°å¿†/components/MainPanel.vue'],names:[],mappings:'AAgIA,yCACE,YAAa,CACb,qBAAsB,CACtB,WAAY,CACZ,kBAAmB,CACnB,aACF,CAEA,+BACE,iBAAkB,CAClB,kBAAmB,CACnB,+BAAgC,CAChC,YAAa,CACb,6BAA8B,CAC9B,kBAAmB,CACnB,yBACF,CAEA,8BACE,YAAa,CACb,kBAAmB,CACnB,QACF,CAEA,+BACE,cAAe,CACf,gBAAiB,CACjB,iBAAkB,CAClB,0BACF,CAEA,qCACE,gCACF,CAEA,6BACE,YAAa,CACb,kBAAmB,CACnB,+BACF,CAEA,2BACE,MAAO,CACP,iBAAkB,CAClB,cAAe,CACf,iBAAkB,CAClB,qCAEY,CACZ,YAAa,CACb,kBAAmB,CACnB,sBAAuB,CACvB,OAAQ,CACR,mCACF,CAEA,iCACE,iCACF,CAEA,sCACE,kBAAmB,CACnB,aAAc,CACd,2BACF,CAEA,gCACE,MAAO,CACP,eAAgB,CAChB,iBAAkB,CAClB,SAAU,CACV,YAAa,CACb,oBAAqB,CACrB,+BACF,CAEA,mDACE,SACF,CAEA,yDACE,kBAAmB,CACnB,iBACF,CAEA,yDACE,kBAAmB,CACnB,iBACF,CAEA,+DACE,kBACF,CAGA,gCACE,+BAAgC,CAChC,0CACF,CAEA,mDACE,oBAAqB,CACrB,wBACF,CAEA,yDACE,6BAA8B,CAC9B,4BACF,CAEA,yDACE,6BAA8B,CAC9B,4BACF,CAEA,+DACE,6BACF',sourcesContent:['<template>\n  <div\n    class="memory-panel-container"\n    style="display: flex; flex-direction: column; height: 100%; background: #1a1a1a; color: #e0e0e0"\n  >\n    \x3c!-- é¢æ¿å¤´éƒ¨ --\x3e\n    <div\n      class="panel-header"\n      style="\n        padding: 15px 20px;\n        background: #2a2a2a;\n        border-bottom: 1px solid #3a3a3a;\n        display: flex;\n        justify-content: space-between;\n        align-items: center;\n        border-radius: 8px 8px 0 0;\n        flex-shrink: 0;\n      "\n    >\n      <div class="header-left" style="display: flex; align-items: center; gap: 10px">\n        <span style="font-size: 24px">ğŸ±</span>\n        <b>mzrodyuçŒ«çŒ«çš„å°ç ´çƒ‚</b>\n      </div>\n      <div\n        class="close-button"\n        style="cursor: pointer; padding: 5px 10px; border-radius: 4px; transition: background 0.2s"\n        @click="closePanel"\n      >\n        <i class="fa-solid fa-times"></i>\n      </div>\n    </div>\n\n    \x3c!-- é¢æ¿æ ‡ç­¾æ  --\x3e\n    <div\n      class="panel-tabs"\n      style="display: flex; background: #2a2a2a; border-bottom: 1px solid #3a3a3a; flex-shrink: 0"\n    >\n      <div\n        v-for="tab in tabs"\n        :key="tab.key"\n        :class="{ \'tab-active\': activeTab === tab.key }"\n        class="tab-item"\n        :style="{\n          flex: \'1\',\n          padding: \'12px 20px\',\n          cursor: \'pointer\',\n          textAlign: \'center\',\n          transition: \'background 0.2s, color 0.2s\',\n          display: \'flex\',\n          alignItems: \'center\',\n          justifyContent: \'center\',\n          gap: \'8px\',\n          borderBottom: \'2px solid transparent\',\n          backgroundColor: activeTab === tab.key ? \'#1a1a1a\' : \'transparent\',\n          color: activeTab === tab.key ? \'#4a9eff\' : \'#e0e0e0\',\n          borderBottomColor: activeTab === tab.key ? \'#4a9eff\' : \'transparent\',\n        }"\n        @click="switchTab(tab.key)"\n      >\n        <i :class="tab.icon"></i>\n        {{ tab.label }}\n      </div>\n    </div>\n\n    \x3c!-- é¢æ¿å†…å®¹ --\x3e\n    <div\n      class="panel-content"\n      style="\n        flex: 1;\n        overflow-y: auto;\n        overflow-x: hidden;\n        padding: 0;\n        min-height: 0;\n        scrollbar-width: thin;\n        scrollbar-color: #4a9eff #2a2a2a;\n      "\n    >\n      <component :is="currentComponent" :key="activeTab" v-bind="componentProps" />\n    </div>\n  </div>\n</template>\n\n<script setup lang="ts">\nimport { computed, ref } from \'vue\';\nimport SettingsTab from \'./SettingsTab.vue\';\nimport SummaryTab from \'./SummaryTab.vue\';\nimport TableTab from \'./TableTab.vue\';\nimport ToolsTab from \'./ToolsTab.vue\';\n\n// æ ‡ç­¾é¡µé…ç½®\nconst tabs = [\n  { key: \'summary\', label: \'å†å²æ€»ç»“\', icon: \'fa-solid fa-list\' },\n  { key: \'table\', label: \'è¡¨æ ¼\', icon: \'fa-solid fa-table\' },\n  { key: \'settings\', label: \'è®¾ç½®\', icon: \'fa-solid fa-cog\' },\n  { key: \'tools\', label: \'å·¥å…·æ¨¡æ¿\', icon: \'fa-solid fa-tools\' },\n];\n\nconst activeTab = ref<\'summary\' | \'table\' | \'settings\' | \'tools\'>(\'settings\');\n\n// ç»„ä»¶æ˜ å°„\nconst componentMap = {\n  summary: SummaryTab,\n  table: TableTab,\n  settings: SettingsTab,\n  tools: ToolsTab,\n};\n\n// å½“å‰ç»„ä»¶\nconst currentComponent = computed(() => componentMap[activeTab.value]);\n\n// ç»„ä»¶å±æ€§\nconst componentProps = computed(() => ({\n  activeTab: activeTab.value,\n}));\n\n// åˆ‡æ¢æ ‡ç­¾é¡µ\nconst switchTab = (tabKey: string) => {\n  console.log(\'åˆ‡æ¢æ ‡ç­¾é¡µ:\', tabKey);\n  activeTab.value = tabKey as any;\n};\n\n// å…³é—­é¢æ¿\nconst closePanel = () => {\n  $(\'#memoryManagementPanel\').fadeOut(200);\n};\n<\/script>\n\n<style scoped>\n.memory-panel-container {\n  display: flex;\n  flex-direction: column;\n  height: 100%;\n  background: #1a1a1a;\n  color: #e0e0e0;\n}\n\n.panel-header {\n  padding: 15px 20px;\n  background: #2a2a2a;\n  border-bottom: 1px solid #3a3a3a;\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  border-radius: 8px 8px 0 0;\n}\n\n.header-left {\n  display: flex;\n  align-items: center;\n  gap: 10px;\n}\n\n.close-button {\n  cursor: pointer;\n  padding: 5px 10px;\n  border-radius: 4px;\n  transition: background 0.2s;\n}\n\n.close-button:hover {\n  background: rgba(255, 255, 255, 0.1);\n}\n\n.panel-tabs {\n  display: flex;\n  background: #2a2a2a;\n  border-bottom: 1px solid #3a3a3a;\n}\n\n.tab-item {\n  flex: 1;\n  padding: 12px 20px;\n  cursor: pointer;\n  text-align: center;\n  transition:\n    background 0.2s,\n    color 0.2s;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  gap: 8px;\n  border-bottom: 2px solid transparent;\n}\n\n.tab-item:hover {\n  background: rgba(255, 255, 255, 0.05);\n}\n\n.tab-item.tab-active {\n  background: #1a1a1a;\n  color: #4a9eff;\n  border-bottom-color: #4a9eff;\n}\n\n.panel-content {\n  flex: 1;\n  overflow-y: auto;\n  overflow-x: hidden;\n  padding: 0;\n  min-height: 0;\n  scrollbar-width: thin;\n  scrollbar-color: #4a9eff #2a2a2a;\n}\n\n.panel-content::-webkit-scrollbar {\n  width: 8px;\n}\n\n.panel-content::-webkit-scrollbar-track {\n  background: #2a2a2a;\n  border-radius: 4px;\n}\n\n.panel-content::-webkit-scrollbar-thumb {\n  background: #4a9eff;\n  border-radius: 4px;\n}\n\n.panel-content::-webkit-scrollbar-thumb:hover {\n  background: #5ba8ff;\n}\n\n/* ç¡®ä¿æ»šåŠ¨æ¡å§‹ç»ˆæ˜¾ç¤º */\n.panel-content {\n  scrollbar-width: thin !important;\n  scrollbar-color: #4a9eff #2a2a2a !important;\n}\n\n.panel-content::-webkit-scrollbar {\n  width: 8px !important;\n  display: block !important;\n}\n\n.panel-content::-webkit-scrollbar-track {\n  background: #2a2a2a !important;\n  border-radius: 4px !important;\n}\n\n.panel-content::-webkit-scrollbar-thumb {\n  background: #4a9eff !important;\n  border-radius: 4px !important;\n}\n\n.panel-content::-webkit-scrollbar-thumb:hover {\n  background: #5ba8ff !important;\n}\n</style>\n'],sourceRoot:''}]);const i=s},254:(n,e,t)=>{t.r(e),t.d(e,{default:()=>i});var o=t(790),a=t.n(o),r=t(54),s=t.n(r)()(a());s.push([n.id,'.tools-tab[data-v-0c833396]{height:100%;overflow-y:auto;padding:25px !important}.section-header[data-v-0c833396]{display:flex;align-items:center;justify-content:space-between;padding:15px 20px;background:linear-gradient(135deg,#2a2a2a 0%,#3a3a3a 100%);border-radius:8px;cursor:pointer;transition:all 0.3s ease;margin-bottom:15px;border:1px solid #3a3a3a}.section-header[data-v-0c833396]:hover{background:linear-gradient(135deg,#3a3a3a 0%,#4a4a4a 100%);transform:translateY(-1px);box-shadow:0 4px 12px rgba(0,0,0,0.3)}.tool-content[data-v-0c833396]{background:#1e1e1e;border:1px solid #3a3a3a;border-radius:8px;padding:20px;margin-bottom:20px}.tool-instructions[data-v-0c833396]{background:#1a1a1a;border:1px solid #3a3a3a;border-radius:6px;padding:12px;color:#ccc;font-size:12px;margin-bottom:15px}.form-group[data-v-0c833396]{margin-bottom:15px}.button-group[data-v-0c833396]{display:flex;gap:12px;margin-bottom:20px}.output-section[data-v-0c833396]{margin-top:20px}.output-content[data-v-0c833396]{background:#1e1e1e;border:1px solid #3a3a3a;border-radius:6px;padding:15px;color:#e0e0e0;font-size:13px;line-height:1.6;white-space:pre-wrap;word-wrap:break-word;max-height:300px;overflow-y:auto}.output-actions[data-v-0c833396]{margin-top:12px;display:flex;gap:12px}.process-button[data-v-0c833396],.clear-button[data-v-0c833396],.generate-button[data-v-0c833396],.copy-button[data-v-0c833396]{position:relative;overflow:hidden;transition:all 0.3s ease}.process-button[data-v-0c833396]:hover:not(:disabled),.clear-button[data-v-0c833396]:hover:not(:disabled),.generate-button[data-v-0c833396]:hover:not(:disabled),.copy-button[data-v-0c833396]:hover{transform:translateY(-2px);box-shadow:0 6px 20px rgba(0,0,0,0.3)}.copy-button[data-v-0c833396]:hover{background:#218838 !important}.tool-instructions[data-v-0c833396]{background:#1a1a1a;border:1px solid #3a3a3a;border-radius:6px;padding:12px;color:#ccc;font-size:12px;margin-bottom:15px}.process-button:hover:not(:disabled) .shimmer-effect[data-v-0c833396],.clear-button:hover:not(:disabled) .shimmer-effect[data-v-0c833396],.generate-button:hover:not(:disabled) .shimmer-effect[data-v-0c833396],.copy-button:hover .shimmer-effect[data-v-0c833396]{left:100%}.process-button[data-v-0c833396]:hover:not(:disabled){transform:translateY(-2px);box-shadow:0 6px 20px rgba(102,126,234,0.4)}.clear-button[data-v-0c833396]:hover:not(:disabled){transform:translateY(-2px);box-shadow:0 6px 20px rgba(255,107,107,0.4)}.generate-button[data-v-0c833396]:hover:not(:disabled){transform:translateY(-2px);box-shadow:0 6px 20px rgba(23,162,184,0.4)}.copy-button[data-v-0c833396]:hover{transform:translateY(-1px);box-shadow:0 5px 15px rgba(40,167,69,0.4)}.process-button[data-v-0c833396]:disabled,.clear-button[data-v-0c833396]:disabled,.generate-button[data-v-0c833396]:disabled{opacity:0.6;cursor:not-allowed;transform:none}.process-button[data-v-0c833396]:disabled:hover,.clear-button[data-v-0c833396]:disabled:hover,.generate-button[data-v-0c833396]:disabled:hover{transform:none;box-shadow:none}.output-content[data-v-0c833396]::-webkit-scrollbar{width:6px}.output-content[data-v-0c833396]::-webkit-scrollbar-track{background:#1a1a1a;border-radius:3px}.output-content[data-v-0c833396]::-webkit-scrollbar-thumb{background:#3a3a3a;border-radius:3px}.output-content[data-v-0c833396]::-webkit-scrollbar-thumb:hover{background:#4a4a4a}@media (max-width:768px){.button-group[data-v-0c833396]{flex-direction:column}.output-actions[data-v-0c833396]{flex-direction:column}}\n','',{version:3,sources:['webpack://./src/è®°å¿†/components/ToolsTab.vue'],names:[],mappings:'AA62CA,4BACE,WAAY,CACZ,eAAgB,CAChB,uBACF,CAEA,iCACE,YAAa,CACb,kBAAmB,CACnB,6BAA8B,CAC9B,iBAAkB,CAClB,0DAA6D,CAC7D,iBAAkB,CAClB,cAAe,CACf,wBAAyB,CACzB,kBAAmB,CACnB,wBACF,CAEA,uCACE,0DAA6D,CAC7D,0BAA2B,CAC3B,qCACF,CAEA,+BACE,kBAAmB,CACnB,wBAAyB,CACzB,iBAAkB,CAClB,YAAa,CACb,kBACF,CAEA,oCACE,kBAAmB,CACnB,wBAAyB,CACzB,iBAAkB,CAClB,YAAa,CACb,UAAW,CACX,cAAe,CACf,kBACF,CAEA,6BACE,kBACF,CAEA,+BACE,YAAa,CACb,QAAS,CACT,kBACF,CAEA,iCACE,eACF,CAEA,iCACE,kBAAmB,CACnB,wBAAyB,CACzB,iBAAkB,CAClB,YAAa,CACb,aAAc,CACd,cAAe,CACf,eAAgB,CAChB,oBAAqB,CACrB,oBAAqB,CACrB,gBAAiB,CACjB,eACF,CAEA,iCACE,eAAgB,CAChB,YAAa,CACb,QACF,CAGA,gIAIE,iBAAkB,CAClB,eAAgB,CAChB,wBACF,CAEA,qMAIE,0BAA2B,CAC3B,qCACF,CAEA,oCACE,6BACF,CAEA,oCACE,kBAAmB,CACnB,wBAAyB,CACzB,iBAAkB,CAClB,YAAa,CACb,UAAW,CACX,cAAe,CACf,kBACF,CAGA,qQAIE,SACF,CAEA,sDACE,0BAA2B,CAC3B,2CACF,CAEA,oDACE,0BAA2B,CAC3B,2CACF,CAEA,uDACE,0BAA2B,CAC3B,0CACF,CAEA,oCACE,0BAA2B,CAC3B,yCACF,CAEA,6HAGE,WAAY,CACZ,kBAAmB,CACnB,cACF,CAEA,+IAGE,cAAe,CACf,eACF,CAGA,oDACE,SACF,CAEA,0DACE,kBAAmB,CACnB,iBACF,CAEA,0DACE,kBAAmB,CACnB,iBACF,CAEA,gEACE,kBACF,CAGA,yBACE,+BACE,qBACF,CAEA,iCACE,qBACF,CACF',sourcesContent:['<template>\n  <div class="tools-tab" style="padding: 25px !important; background: #1a1a1a !important">\n    \x3c!-- åå…«è‚¡å·¥å…· --\x3e\n    <div class="tool-section">\n      <div class="section-header" @click="toggleToolExpanded(\'antiCliche\')">\n        <h4 style="margin: 0; color: #fff; font-size: 16px; font-weight: 600">\n          <i class="fa-solid fa-broom" style="margin-right: 8px; color: #ff6b6b"></i>\n          åå…«è‚¡å·¥å…·\n        </h4>\n        <i\n          :class="isToolExpanded(\'antiCliche\') ? \'fa-solid fa-chevron-up\' : \'fa-solid fa-chevron-down\'"\n          style="color: #ccc; transition: transform 0.3s ease"\n        ></i>\n      </div>\n\n      <div v-if="isToolExpanded(\'antiCliche\')" class="tool-content">\n        <div class="tool-instructions">\n          <p style="margin: 0 0 8px 0; color: #ccc; font-size: 12px">\n            <i class="fa-solid fa-info-circle" style="margin-right: 6px; color: #17a2b8"></i>\n            è§’è‰²å¡/ä¸–ç•Œä¹¦/å¼€åœºç™½å…«è‚¡æ¸…ç†å·¥å…·ï¼Œç³»ç»ŸåŒ–æ‰§è¡Œ9ä¸ªæ­¥éª¤ï¼Œæ¸…é™¤200+ç¦ç”¨è¯ã€‚\n          </p>\n          <p\n            style="\n              margin: 0;\n              color: #ffa500;\n              font-size: 11px;\n              background: #1a1a1a;\n              padding: 6px;\n              border-radius: 4px;\n              border-left: 3px solid #ffa500;\n            "\n          >\n            âš¡ æ¸…ç†å†…å®¹ï¼šæ¨¡ç³Šè¯ã€åŠ¨ç‰©åŒ–æ¯”å–»ã€è¯­æ°”å£°éŸ³ã€å¾®è¡¨æƒ…ã€å¦å®šå¥å¼ã€ç»æœ›/ç¥åŒ–å€¾å‘ã€NSFWæ€§ç‹‚é‡ç­‰\n          </p>\n        </div>\n\n        <div class="form-group" style="margin: 15px 0">\n          <label style="display: block; margin-bottom: 8px; color: #ccc; font-size: 13px; font-weight: 500">\n            è¾“å…¥æ–‡æœ¬ï¼š\n          </label>\n          <textarea\n            v-model="antiClicheInput"\n            placeholder="è¯·è¾“å…¥éœ€è¦æ¸…ç†çš„æ–‡æœ¬..."\n            style="\n              width: 100%;\n              height: 120px;\n              padding: 12px;\n              background: #2a2a2a;\n              border: 1px solid #3a3a3a;\n              border-radius: 6px;\n              color: #e0e0e0;\n              font-size: 13px;\n              resize: vertical;\n              font-family: inherit;\n            "\n          ></textarea>\n        </div>\n\n        <div class="button-group" style="display: flex; gap: 12px; margin-bottom: 20px">\n          <button\n            class="process-button"\n            :disabled="isProcessingAntiCliche || !antiClicheInput.trim()"\n            style="\n              padding: 12px 24px;\n              background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);\n              border: none;\n              border-radius: 8px;\n              color: white;\n              font-size: 13px;\n              font-weight: 600;\n              cursor: pointer;\n              transition: all 0.3s ease;\n              box-shadow: 0 3px 12px rgba(102, 126, 234, 0.3);\n              position: relative;\n              overflow: hidden;\n            "\n            @click="handleAntiClicheProcess"\n          >\n            <div\n              style="\n                position: absolute;\n                top: 0;\n                left: -100%;\n                width: 100%;\n                height: 100%;\n                background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);\n                transition: left 0.5s;\n              "\n              class="shimmer-effect"\n            ></div>\n            <i class="fa-solid fa-magic" style="font-size: 14px; margin-right: 6px"></i>\n            {{ isProcessingAntiCliche ? \'å¤„ç†ä¸­...\' : \'å¼€å§‹æ¸…ç†\' }}\n          </button>\n\n          <button\n            class="clear-button"\n            style="\n              padding: 12px 24px;\n              background: linear-gradient(135deg, #ff6b6b 0%, #ee5a24 100%);\n              border: none;\n              border-radius: 8px;\n              color: white;\n              font-size: 13px;\n              font-weight: 600;\n              cursor: pointer;\n              transition: all 0.3s ease;\n              box-shadow: 0 3px 12px rgba(255, 107, 107, 0.3);\n              position: relative;\n              overflow: hidden;\n            "\n            @click="clearAntiClicheForm"\n          >\n            <div\n              style="\n                position: absolute;\n                top: 0;\n                left: -100%;\n                width: 100%;\n                height: 100%;\n                background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);\n                transition: left 0.5s;\n              "\n              class="shimmer-effect"\n            ></div>\n            <i class="fa-solid fa-trash" style="font-size: 14px; margin-right: 6px"></i>\n            æ¸…ç©º\n          </button>\n        </div>\n\n        \x3c!-- è¾“å‡ºåŒºåŸŸ --\x3e\n        <div v-if="antiClicheOutput" class="output-section">\n          <h5 style="margin: 0 0 12px 0; color: #fff; font-size: 14px; font-weight: 600">\n            <i class="fa-solid fa-check-circle" style="margin-right: 6px; color: #28a745"></i>\n            æ¸…ç†ç»“æœï¼š\n          </h5>\n          <div\n            class="output-content"\n            style="\n              background: #1e1e1e;\n              border: 1px solid #3a3a3a;\n              border-radius: 6px;\n              padding: 15px;\n              color: #e0e0e0;\n              font-size: 13px;\n              line-height: 1.6;\n              white-space: pre-wrap;\n              word-wrap: break-word;\n              max-height: 300px;\n              overflow-y: auto;\n            "\n          >\n            {{ antiClicheOutput }}\n          </div>\n\n          <div class="output-actions" style="margin-top: 12px; display: flex; gap: 12px">\n            <button\n              class="copy-button"\n              style="\n                padding: 10px 20px;\n                background: linear-gradient(135deg, #28a745 0%, #20c997 100%);\n                border: none;\n                border-radius: 6px;\n                color: white;\n                font-size: 13px;\n                font-weight: 600;\n                cursor: pointer;\n                transition: all 0.3s ease;\n                display: flex;\n                align-items: center;\n                gap: 8px;\n                box-shadow: 0 3px 12px rgba(40, 167, 69, 0.3);\n                position: relative;\n                overflow: hidden;\n              "\n              @click="copyAntiClicheResult"\n            >\n              <div\n                style="\n                  position: absolute;\n                  top: 0;\n                  left: -100%;\n                  width: 100%;\n                  height: 100%;\n                  background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);\n                  transition: left 0.5s;\n                "\n                class="shimmer-effect"\n              ></div>\n              <i class="fa-solid fa-copy" style="font-size: 14px"></i> å¤åˆ¶ç»“æœ\n            </button>\n          </div>\n        </div>\n      </div>\n    </div>\n\n    \x3c!-- è§’è‰²å¡ç”Ÿæˆå·¥å…· --\x3e\n    <div class="tool-section">\n      <div class="section-header" @click="toggleToolExpanded(\'characterCard\')">\n        <h4 style="margin: 0; color: #fff; font-size: 16px; font-weight: 600">\n          <i class="fa-solid fa-user-plus" style="margin-right: 8px; color: #17a2b8"></i>\n          è§’è‰²å¡ç”Ÿæˆå·¥å…·\n        </h4>\n        <i\n          :class="isToolExpanded(\'characterCard\') ? \'fa-solid fa-chevron-up\' : \'fa-solid fa-chevron-down\'"\n          style="color: #ccc; transition: transform 0.3s ease"\n        ></i>\n      </div>\n\n      <div v-if="isToolExpanded(\'characterCard\')" class="tool-content">\n        <div class="tool-instructions">\n          <p style="margin: 0 0 8px 0; color: #ccc; font-size: 12px">\n            <i class="fa-solid fa-info-circle" style="margin-right: 6px; color: #17a2b8"></i>\n            è¾“å…¥è§’è‰²æè¿°ï¼ŒAIå°†è‡ªåŠ¨ç”Ÿæˆè§’è‰²å¡ï¼ˆYAML æ ¼å¼ï¼Œçº¯ä¸­æ–‡ï¼‰ã€‚\n          </p>\n          <p\n            style="\n              margin: 0 0 6px 0;\n              color: #4a9eff;\n              font-size: 11px;\n              background: #1a1a1a;\n              padding: 6px;\n              border-radius: 4px;\n              border-left: 3px solid #17a2b8;\n            "\n          >\n            ğŸ’¡ åŒ…å«å†…å®¹ï¼šåŸºç¡€ä¿¡æ¯ã€å¤–è²Œèº«æã€æ ¸å¿ƒæ€§æ ¼ã€å¯¹è¯é£æ ¼ã€èƒŒæ™¯ç»å†ã€äººé™…å…³ç³»ã€æ¼”ç»æŒ‡å¯¼\n          </p>\n          <p\n            style="\n              margin: 0 0 6px 0;\n              color: #ffa500;\n              font-size: 11px;\n              background: #1a1a1a;\n              padding: 6px;\n              border-radius: 4px;\n              border-left: 3px solid #ffa500;\n            "\n          >\n            âš ï¸ æ³¨æ„ï¼šèº«é«˜ä½“é‡ä½¿ç”¨æ–‡å­—æè¿°ï¼ˆå¦‚"é«˜å¤§åŒ€ç§°"ï¼‰ï¼Œé¿å…AIåˆ»æ¿åŒ–ï¼Œæœ‰æ€§æ ¼å¯¹ç«‹é¢å’Œä¿®å¤æœºåˆ¶\n          </p>\n        </div>\n\n        <div class="form-group" style="margin: 15px 0">\n          <label style="display: block; margin-bottom: 8px; color: #ccc; font-size: 13px; font-weight: 500">\n            è§’è‰²æè¿°ï¼š\n          </label>\n          <textarea\n            v-model="characterDescription"\n            placeholder="è¯·æè¿°è§’è‰²çš„åŸºæœ¬ä¿¡æ¯ï¼Œå¦‚å¤–è§‚ã€æ€§æ ¼ã€èƒŒæ™¯ç­‰..."\n            style="\n              width: 100%;\n              height: 120px;\n              padding: 12px;\n              background: #2a2a2a;\n              border: 1px solid #3a3a3a;\n              border-radius: 6px;\n              color: #e0e0e0;\n              font-size: 13px;\n              resize: vertical;\n              font-family: inherit;\n            "\n          ></textarea>\n        </div>\n\n        <div class="button-group" style="display: flex; gap: 12px; margin-bottom: 20px">\n          <button\n            class="generate-button"\n            :disabled="isGeneratingCharacter || !characterDescription.trim()"\n            style="\n              padding: 12px 24px;\n              background: linear-gradient(135deg, #17a2b8 0%, #138496 100%);\n              border: none;\n              border-radius: 8px;\n              color: white;\n              font-size: 13px;\n              font-weight: 600;\n              cursor: pointer;\n              transition: all 0.3s ease;\n              box-shadow: 0 3px 12px rgba(23, 162, 184, 0.3);\n              position: relative;\n              overflow: hidden;\n            "\n            @click="handleGenerateCharacterCard"\n          >\n            <div\n              style="\n                position: absolute;\n                top: 0;\n                left: -100%;\n                width: 100%;\n                height: 100%;\n                background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);\n                transition: left 0.5s;\n              "\n              class="shimmer-effect"\n            ></div>\n            <i class="fa-solid fa-magic" style="font-size: 14px; margin-right: 6px"></i>\n            {{ isGeneratingCharacter ? \'ç”Ÿæˆä¸­...\' : \'ç”Ÿæˆè§’è‰²å¡\' }}\n          </button>\n\n          <button\n            class="clear-button"\n            style="\n              padding: 12px 24px;\n              background: linear-gradient(135deg, #ff6b6b 0%, #ee5a24 100%);\n              border: none;\n              border-radius: 8px;\n              color: white;\n              font-size: 13px;\n              font-weight: 600;\n              cursor: pointer;\n              transition: all 0.3s ease;\n              box-shadow: 0 3px 12px rgba(255, 107, 107, 0.3);\n              position: relative;\n              overflow: hidden;\n            "\n            @click="clearCharacterForm"\n          >\n            <div\n              style="\n                position: absolute;\n                top: 0;\n                left: -100%;\n                width: 100%;\n                height: 100%;\n                background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);\n                transition: left 0.5s;\n              "\n              class="shimmer-effect"\n            ></div>\n            <i class="fa-solid fa-trash" style="font-size: 14px; margin-right: 6px"></i>\n            æ¸…ç©º\n          </button>\n        </div>\n\n        \x3c!-- è¾“å‡ºåŒºåŸŸ --\x3e\n        <div v-if="characterCardOutput" class="output-section">\n          <h5 style="margin: 0 0 12px 0; color: #fff; font-size: 14px; font-weight: 600">\n            <i class="fa-solid fa-check-circle" style="margin-right: 6px; color: #28a745"></i>\n            ç”Ÿæˆçš„è§’è‰²å¡ï¼š\n          </h5>\n          <div\n            class="output-content"\n            style="\n              background: #1e1e1e;\n              border: 1px solid #3a3a3a;\n              border-radius: 6px;\n              padding: 15px;\n              color: #e0e0e0;\n              font-size: 13px;\n              line-height: 1.6;\n              white-space: pre-wrap;\n              word-wrap: break-word;\n              max-height: 300px;\n              overflow-y: auto;\n            "\n          >\n            {{ characterCardOutput }}\n          </div>\n\n          <div class="output-actions" style="margin-top: 12px; display: flex; gap: 12px">\n            <button\n              class="copy-button"\n              style="\n                padding: 10px 20px;\n                background: linear-gradient(135deg, #28a745 0%, #20c997 100%);\n                border: none;\n                border-radius: 6px;\n                color: white;\n                font-size: 13px;\n                font-weight: 600;\n                cursor: pointer;\n                transition: all 0.3s ease;\n                display: flex;\n                align-items: center;\n                gap: 8px;\n                box-shadow: 0 3px 12px rgba(40, 167, 69, 0.3);\n                position: relative;\n                overflow: hidden;\n              "\n              @click="copyCharacterCard"\n            >\n              <div\n                style="\n                  position: absolute;\n                  top: 0;\n                  left: -100%;\n                  width: 100%;\n                  height: 100%;\n                  background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);\n                  transition: left 0.5s;\n                "\n                class="shimmer-effect"\n              ></div>\n              <i class="fa-solid fa-copy" style="font-size: 14px"></i> å¤åˆ¶è§’è‰²å¡\n            </button>\n          </div>\n\n          \x3c!-- è§’è‰²å¡ä¿®æ”¹åŒºåŸŸ --\x3e\n          <div class="modify-section" style="margin-top: 25px; border-top: 2px dashed #3a3a3a; padding-top: 20px">\n            <h5 style="margin: 0 0 12px 0; color: #fff; font-size: 14px; font-weight: 600">\n              <i class="fa-solid fa-edit" style="margin-right: 6px; color: #ffa500"></i>\n              ä¿®æ”¹è§’è‰²å¡\n            </h5>\n            <div\n              class="modify-instructions"\n              style="\n                background: #1a1a1a;\n                border: 1px solid #3a3a3a;\n                border-radius: 6px;\n                padding: 10px;\n                margin-bottom: 15px;\n              "\n            >\n              <p style="margin: 0 0 6px 0; color: #ccc; font-size: 12px">\n                <i class="fa-solid fa-lightbulb" style="margin-right: 6px; color: #ffa500"></i>\n                æè¿°ä½ æƒ³è¦ä¿®æ”¹çš„å†…å®¹ï¼ŒAIä¼šæ ¹æ®ä½ çš„éœ€æ±‚è°ƒæ•´è§’è‰²å¡ã€‚ä¾‹å¦‚ï¼š"è®©è§’è‰²æ›´æ´»æ³¼ä¸€äº›"ã€"å¢åŠ é­”æ³•æŠ€èƒ½"ã€"æ”¹ä¸ºå¥³æ€§è§’è‰²"ç­‰ã€‚\n              </p>\n              <p style="margin: 0; color: #ffa500; font-size: 11px">âš ï¸ ä¿®æ”¹åä¼šä¿æŒ YAML æ ¼å¼å’Œä¸­æ–‡å­—æ®µã€‚</p>\n            </div>\n\n            <div class="form-group" style="margin: 15px 0">\n              <label style="display: block; margin-bottom: 8px; color: #ccc; font-size: 13px; font-weight: 500">\n                ä¿®æ”¹éœ€æ±‚ï¼š\n              </label>\n              <textarea\n                v-model="modifyRequest"\n                placeholder="è¯·æè¿°ä½ æƒ³è¦ä¿®æ”¹çš„å†…å®¹..."\n                style="\n                  width: 100%;\n                  height: 80px;\n                  padding: 12px;\n                  background: #2a2a2a;\n                  border: 1px solid #3a3a3a;\n                  border-radius: 6px;\n                  color: #e0e0e0;\n                  font-size: 13px;\n                  resize: vertical;\n                  font-family: inherit;\n                "\n              ></textarea>\n            </div>\n\n            <div class="button-group" style="display: flex; gap: 12px; margin-bottom: 15px">\n              <button\n                class="modify-button"\n                :disabled="isModifyingCharacter || !modifyRequest.trim()"\n                style="\n                  padding: 12px 24px;\n                  background: linear-gradient(135deg, #ffa500 0%, #ff8c00 100%);\n                  border: none;\n                  border-radius: 8px;\n                  color: white;\n                  font-size: 13px;\n                  font-weight: 600;\n                  cursor: pointer;\n                  transition: all 0.3s ease;\n                  box-shadow: 0 3px 12px rgba(255, 165, 0, 0.3);\n                  position: relative;\n                  overflow: hidden;\n                "\n                @click="handleModifyCharacterCard"\n              >\n                <div\n                  style="\n                    position: absolute;\n                    top: 0;\n                    left: -100%;\n                    width: 100%;\n                    height: 100%;\n                    background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);\n                    transition: left 0.5s;\n                  "\n                  class="shimmer-effect"\n                ></div>\n                <i class="fa-solid fa-wand-magic-sparkles" style="font-size: 14px; margin-right: 6px"></i>\n                {{ isModifyingCharacter ? \'ä¿®æ”¹ä¸­...\' : \'AIä¿®æ”¹\' }}\n              </button>\n\n              <button\n                class="clear-modify-button"\n                style="\n                  padding: 12px 24px;\n                  background: linear-gradient(135deg, #6c757d 0%, #5a6268 100%);\n                  border: none;\n                  border-radius: 8px;\n                  color: white;\n                  font-size: 13px;\n                  font-weight: 600;\n                  cursor: pointer;\n                  transition: all 0.3s ease;\n                  box-shadow: 0 3px 12px rgba(108, 117, 125, 0.3);\n                  position: relative;\n                  overflow: hidden;\n                "\n                @click="clearModifyRequest"\n              >\n                <div\n                  style="\n                    position: absolute;\n                    top: 0;\n                    left: -100%;\n                    width: 100%;\n                    height: 100%;\n                    background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);\n                    transition: left 0.5s;\n                  "\n                  class="shimmer-effect"\n                ></div>\n                <i class="fa-solid fa-eraser" style="font-size: 14px; margin-right: 6px"></i>\n                æ¸…ç©ºä¿®æ”¹éœ€æ±‚\n              </button>\n            </div>\n          </div>\n        </div>\n      </div>\n    </div>\n  </div>\n</template>\n\n<script setup lang="ts">\nimport { debounce } from \'lodash\';\nimport { storeToRefs } from \'pinia\';\nimport { onMounted, ref, watch } from \'vue\';\nimport { getScriptIdSafe } from \'è®°å¿†/utils\';\nimport { useSettingsStore } from \'../settings\';\n\nconst settingsStore = useSettingsStore();\nconst { settings } = storeToRefs(settingsStore);\n\n// å“åº”å¼æ•°æ®\nconst toolExpandedState = ref(new Map<string, boolean>());\nconst antiClicheInput = ref(\'\');\nconst antiClicheOutput = ref(\'\');\nconst isProcessingAntiCliche = ref(false);\nconst characterDescription = ref(\'\');\nconst characterCardOutput = ref(\'\');\nconst isGeneratingCharacter = ref(false);\nconst modifyRequest = ref(\'\');\nconst isModifyingCharacter = ref(false);\n\n// æ ‡å¿—ä½ï¼šæ˜¯å¦å·²å®Œæˆåˆå§‹åŠ è½½ï¼ˆé¿å…åŠ è½½æ—¶è§¦å‘ä¿å­˜ï¼‰\nconst isDataLoaded = ref(false);\n\n// ä»é…’é¦†å˜é‡åŠ è½½å·¥å…·æ•°æ®\nconst loadToolsData = () => {\n  try {\n    isDataLoaded.value = false; // åŠ è½½æœŸé—´æš‚åœè‡ªåŠ¨ä¿å­˜\n    const script_id = getScriptIdSafe();\n    if (!script_id) {\n      console.warn(\'âš ï¸ script_id ä¸ºç©ºï¼Œæ— æ³•åŠ è½½æ•°æ®\');\n      isDataLoaded.value = true;\n      return;\n    }\n    const savedData = getVariables({ type: \'script\', script_id });\n\n    console.log(\'ğŸ“¥ åŠ è½½å·¥å…·æ•°æ®:\', savedData);\n\n    // åŠ è½½åå…«è‚¡æ•°æ®\n    if (savedData.tools_antiCliche) {\n      antiClicheInput.value = savedData.tools_antiCliche.input || \'\';\n      antiClicheOutput.value = savedData.tools_antiCliche.output || \'\';\n      console.log(\'âœ… å·²æ¢å¤åå…«è‚¡æ•°æ®:\', {\n        input: antiClicheInput.value.substring(0, 50),\n        output: antiClicheOutput.value.substring(0, 50),\n      });\n    }\n\n    // åŠ è½½è§’è‰²å¡æ•°æ®\n    if (savedData.tools_characterCard) {\n      characterDescription.value = savedData.tools_characterCard.description || \'\';\n      characterCardOutput.value = savedData.tools_characterCard.output || \'\';\n      modifyRequest.value = savedData.tools_characterCard.modifyRequest || \'\';\n      console.log(\'âœ… å·²æ¢å¤è§’è‰²å¡æ•°æ®:\', {\n        description: characterDescription.value.substring(0, 50),\n        output: characterCardOutput.value.substring(0, 50),\n        modifyRequest: modifyRequest.value.substring(0, 50),\n      });\n    }\n\n    // åŠ è½½å±•å¼€çŠ¶æ€\n    if (savedData.tools_expandedState) {\n      toolExpandedState.value = new Map(Object.entries(savedData.tools_expandedState));\n      console.log(\'âœ… å·²æ¢å¤å±•å¼€çŠ¶æ€:\', Object.fromEntries(toolExpandedState.value));\n    }\n\n    // å»¶è¿Ÿå¯ç”¨è‡ªåŠ¨ä¿å­˜ï¼Œé¿å…åŠ è½½æ—¶è§¦å‘\n    setTimeout(() => {\n      isDataLoaded.value = true;\n      console.log(\'âœ… æ•°æ®åŠ è½½å®Œæˆï¼Œå¯ç”¨è‡ªåŠ¨ä¿å­˜\');\n    }, 100);\n  } catch (error) {\n    console.error(\'âŒ åŠ è½½å·¥å…·æ•°æ®å¤±è´¥:\', error);\n    isDataLoaded.value = true;\n  }\n};\n\n// ä¿å­˜å·¥å…·æ•°æ®åˆ°é…’é¦†å˜é‡\nconst saveToolsDataImmediate = () => {\n  // åªæœ‰åœ¨æ•°æ®åŠ è½½å®Œæˆåæ‰ä¿å­˜\n  if (!isDataLoaded.value) {\n    console.log(\'â¸ï¸ è·³è¿‡ä¿å­˜ï¼šæ•°æ®å°šæœªåŠ è½½å®Œæˆ\');\n    return;\n  }\n\n  try {\n    const script_id = getScriptIdSafe();\n    if (!script_id) {\n      console.warn(\'âš ï¸ script_id ä¸ºç©ºï¼Œæ— æ³•ä¿å­˜æ•°æ®\');\n      return;\n    }\n\n    const dataToSave = {\n      tools_antiCliche: {\n        input: antiClicheInput.value,\n        output: antiClicheOutput.value,\n      },\n      tools_characterCard: {\n        description: characterDescription.value,\n        output: characterCardOutput.value,\n        modifyRequest: modifyRequest.value,\n      },\n      tools_expandedState: Object.fromEntries(toolExpandedState.value),\n    };\n\n    insertOrAssignVariables(dataToSave, { type: \'script\', script_id });\n    console.log(\'ğŸ’¾ å·¥å…·æ•°æ®å·²ä¿å­˜:\', {\n      antiCliche_input_length: antiClicheInput.value.length,\n      antiCliche_output_length: antiClicheOutput.value.length,\n      character_desc_length: characterDescription.value.length,\n      character_output_length: characterCardOutput.value.length,\n    });\n  } catch (error) {\n    console.error(\'âŒ ä¿å­˜å·¥å…·æ•°æ®å¤±è´¥:\', error);\n  }\n};\n\n// ä½¿ç”¨é˜²æŠ–æ¥é¿å…é¢‘ç¹ä¿å­˜ï¼ˆå‡å°‘åˆ°300msï¼Œæ›´å¿«å“åº”ï¼‰\nconst saveToolsData = debounce(saveToolsDataImmediate, 300);\n\n// ç›‘å¬æ•°æ®å˜åŒ–å¹¶è‡ªåŠ¨ä¿å­˜\nwatch(\n  [antiClicheInput, antiClicheOutput, characterDescription, characterCardOutput, modifyRequest, toolExpandedState],\n  () => {\n    if (isDataLoaded.value) {\n      console.log(\'ğŸ“ æ•°æ®å˜åŒ–ï¼Œè§¦å‘ä¿å­˜...\');\n      saveToolsData();\n    }\n  },\n  { deep: true },\n);\n\n// ç»„ä»¶æŒ‚è½½æ—¶åŠ è½½æ•°æ®\nonMounted(() => {\n  console.log(\'ğŸ”§ ToolsTab ç»„ä»¶å·²æŒ‚è½½ï¼ŒåŠ è½½æ•°æ®...\');\n  loadToolsData();\n});\n\n// ç»„ä»¶å¸è½½å‰ä¿å­˜æ•°æ®\nonBeforeUnmount(() => {\n  console.log(\'ğŸ”„ ToolsTab ç»„ä»¶å³å°†å¸è½½ï¼Œä¿å­˜æ•°æ®...\');\n  // å–æ¶ˆé˜²æŠ–ï¼Œç«‹å³ä¿å­˜\n  saveToolsData.cancel();\n  saveToolsDataImmediate();\n});\n\n// åˆ‡æ¢å·¥å…·å±•å¼€çŠ¶æ€\nconst toggleToolExpanded = (toolName: string) => {\n  console.log(\'toggleToolExpanded è¢«è°ƒç”¨ï¼Œå·¥å…·åç§°:\', toolName);\n  const current = toolExpandedState.value.get(toolName) || false;\n  console.log(\'å½“å‰å±•å¼€çŠ¶æ€:\', current);\n  toolExpandedState.value.set(toolName, !current);\n  console.log(\'æ–°çš„å±•å¼€çŠ¶æ€:\', !current);\n};\n\n// æ£€æŸ¥å·¥å…·æ˜¯å¦å±•å¼€\nconst isToolExpanded = (toolName: string) => {\n  return toolExpandedState.value.get(toolName) || false;\n};\n\n// ç»Ÿä¸€çš„å¤åˆ¶å‡½æ•° - é’ˆå¯¹iframeç¯å¢ƒä¼˜åŒ–\nconst copyToClipboard = async (text: string, successMessage: string) => {\n  console.log(\'ğŸ” å¼€å§‹å¤åˆ¶ï¼Œæ–‡æœ¬é•¿åº¦:\', text.length);\n  console.log(\'ğŸ” æ˜¯å¦åœ¨iframeä¸­:\', window.parent !== window);\n\n  // æ–¹æ³•1ï¼šä¼˜å…ˆåœ¨çˆ¶çª—å£ä¸­å¤åˆ¶ï¼ˆæœ€å¯é çš„æ–¹æ³•ï¼‰\n  if (window.parent && window.parent !== window) {\n    console.log(\'ğŸ” å°è¯•åœ¨çˆ¶çª—å£ä¸­å¤åˆ¶...\');\n    const parentSuccess = tryParentWindowCopy(text);\n    if (parentSuccess) {\n      console.log(\'âœ… çˆ¶çª—å£å¤åˆ¶æˆåŠŸ\');\n      window.toastr.success(successMessage);\n      return;\n    } else {\n      console.warn(\'âš ï¸ çˆ¶çª—å£å¤åˆ¶å¤±è´¥\');\n    }\n  }\n\n  // æ–¹æ³•2ï¼šå°è¯• execCommand åœ¨å½“å‰çª—å£\n  try {\n    console.log(\'ğŸ” å°è¯• execCommand å¤åˆ¶...\');\n    const success = execCommandCopy(text);\n    if (success) {\n      console.log(\'âœ… execCommand å¤åˆ¶æˆåŠŸ\');\n      window.toastr.success(successMessage);\n      return;\n    } else {\n      console.warn(\'âš ï¸ execCommand å¤åˆ¶å¤±è´¥\');\n    }\n  } catch (error) {\n    console.warn(\'âŒ execCommand å¤åˆ¶å¼‚å¸¸:\', error);\n  }\n\n  // æ–¹æ³•3ï¼šå°è¯•ç°ä»£ Clipboard API\n  try {\n    if (navigator.clipboard && window.isSecureContext) {\n      console.log(\'ğŸ” å°è¯• Clipboard API å¤åˆ¶...\');\n      await navigator.clipboard.writeText(text);\n\n      // éªŒè¯æ˜¯å¦çœŸçš„å¤åˆ¶æˆåŠŸ\n      const clipboardContent = await navigator.clipboard.readText();\n      if (clipboardContent === text) {\n        console.log(\'âœ… Clipboard API å¤åˆ¶æˆåŠŸï¼ˆå·²éªŒè¯ï¼‰\');\n        window.toastr.success(successMessage);\n        return;\n      } else {\n        console.warn(\'âš ï¸ Clipboard API å¤åˆ¶åéªŒè¯å¤±è´¥\');\n      }\n    }\n  } catch (error) {\n    console.warn(\'âŒ Clipboard API å¤±è´¥:\', error);\n  }\n\n  // æ‰€æœ‰æ–¹æ³•éƒ½å¤±è´¥ï¼Œæ˜¾ç¤ºæ‰‹åŠ¨å¤åˆ¶å¯¹è¯æ¡†\n  console.log(\'âš ï¸ æ‰€æœ‰è‡ªåŠ¨å¤åˆ¶æ–¹æ³•éƒ½å¤±è´¥ï¼Œæ˜¾ç¤ºæ‰‹åŠ¨å¤åˆ¶å¯¹è¯æ¡†\');\n  showManualCopyDialog(text);\n};\n\n// åœ¨çˆ¶çª—å£ä¸­å°è¯•å¤åˆ¶\nconst tryParentWindowCopy = (text: string): boolean => {\n  try {\n    if (window.parent && window.parent !== window) {\n      console.log(\'  ğŸ“ åœ¨çˆ¶çª—å£åˆ›å»ºä¸´æ—¶textarea...\');\n\n      // åœ¨çˆ¶çª—å£ä¸­åˆ›å»ºä¸´æ—¶å…ƒç´ å¹¶å¤åˆ¶\n      const parentDoc = window.parent.document;\n      const tempTextArea = parentDoc.createElement(\'textarea\');\n      tempTextArea.value = text;\n\n      // è®¾ç½®æ ·å¼ä½¿å…¶ä¸å¯è§ä½†ä»ç„¶å¯é€‰ä¸­\n      tempTextArea.style.cssText = `\n        position: fixed !important;\n        left: -9999px !important;\n        top: -9999px !important;\n        width: 1px !important;\n        height: 1px !important;\n        opacity: 0 !important;\n        pointer-events: none !important;\n      `;\n      tempTextArea.setAttribute(\'readonly\', \'\');\n\n      parentDoc.body.appendChild(tempTextArea);\n      console.log(\'  ğŸ“ Textareaå·²æ·»åŠ åˆ°çˆ¶çª—å£\');\n\n      // èšç„¦å¹¶é€‰ä¸­æ–‡æœ¬\n      tempTextArea.focus();\n      tempTextArea.select();\n      tempTextArea.setSelectionRange(0, text.length);\n      console.log(\'  ğŸ“ æ–‡æœ¬å·²é€‰ä¸­\');\n\n      // å°è¯•å¤åˆ¶\n      const success = parentDoc.execCommand(\'copy\');\n      console.log(\'  ğŸ“ execCommandç»“æœ:\', success);\n\n      // æ¸…ç†\n      parentDoc.body.removeChild(tempTextArea);\n      console.log(\'  ğŸ“ Textareaå·²æ¸…ç†\');\n\n      return success;\n    }\n  } catch (error) {\n    console.error(\'âŒ çˆ¶çª—å£å¤åˆ¶å¼‚å¸¸:\', error);\n  }\n  return false;\n};\n\n// execCommand å¤åˆ¶æ–¹æ³•\nconst execCommandCopy = (text: string): boolean => {\n  try {\n    console.log(\'  ğŸ“ åœ¨å½“å‰çª—å£åˆ›å»ºä¸´æ—¶textarea...\');\n\n    // åˆ›å»ºä¸´æ—¶æ–‡æœ¬åŒºåŸŸ\n    const textArea = document.createElement(\'textarea\');\n    textArea.value = text;\n\n    // è®¾ç½®æ ·å¼\n    textArea.style.cssText = `\n      position: fixed !important;\n      left: -9999px !important;\n      top: -9999px !important;\n      width: 1px !important;\n      height: 1px !important;\n      opacity: 0 !important;\n      pointer-events: none !important;\n    `;\n    textArea.setAttribute(\'readonly\', \'\');\n\n    document.body.appendChild(textArea);\n    console.log(\'  ğŸ“ Textareaå·²æ·»åŠ åˆ°å½“å‰çª—å£\');\n\n    // èšç„¦å¹¶é€‰ä¸­\n    textArea.focus();\n    textArea.select();\n    textArea.setSelectionRange(0, text.length);\n    console.log(\'  ğŸ“ æ–‡æœ¬å·²é€‰ä¸­\');\n\n    // å°è¯•å¤åˆ¶\n    const success = document.execCommand(\'copy\');\n    console.log(\'  ğŸ“ execCommandç»“æœ:\', success);\n\n    // æ¸…ç†\n    document.body.removeChild(textArea);\n    console.log(\'  ğŸ“ Textareaå·²æ¸…ç†\');\n\n    return success;\n  } catch (error) {\n    console.error(\'âŒ execCommand å¤åˆ¶å¼‚å¸¸:\', error);\n    return false;\n  }\n};\n\n// æ‰‹åŠ¨å¤åˆ¶å¯¹è¯æ¡† - æ›´å¯é çš„å®ç°\nconst showManualCopyDialog = (text: string) => {\n  try {\n    console.log(\'ğŸ“‹ æ˜¾ç¤ºæ‰‹åŠ¨å¤åˆ¶å¯¹è¯æ¡†\');\n\n    // å°è¯•åœ¨çˆ¶çª—å£ä¸­åˆ›å»ºå¯¹è¯æ¡†ï¼ˆæ›´å¯é ï¼‰\n    const targetDoc = window.parent && window.parent !== window ? window.parent.document : document;\n    const targetBody = targetDoc.body;\n\n    console.log(\'ğŸ“‹ ç›®æ ‡æ–‡æ¡£:\', targetDoc === window.parent.document ? \'çˆ¶çª—å£\' : \'å½“å‰çª—å£\');\n\n    // ç§»é™¤å¯èƒ½å­˜åœ¨çš„æ—§å¯¹è¯æ¡†\n    const existingModal = targetDoc.getElementById(\'manual-copy-modal-tools\');\n    if (existingModal) {\n      targetBody.removeChild(existingModal);\n    }\n\n    // åˆ›å»ºæ¨¡æ€å¯¹è¯æ¡†\n    const modal = targetDoc.createElement(\'div\');\n    modal.id = \'manual-copy-modal-tools\';\n    modal.style.cssText = `\n      position: fixed;\n      top: 0;\n      left: 0;\n      width: 100%;\n      height: 100%;\n      background: rgba(0, 0, 0, 0.9);\n      z-index: 999999;\n      display: flex;\n      align-items: center;\n      justify-content: center;\n      font-family: -apple-system, BlinkMacSystemFont, \'Segoe UI\', Roboto, sans-serif;\n    `;\n\n    const dialog = targetDoc.createElement(\'div\');\n    dialog.style.cssText = `\n      background: #2a2a2a;\n      border: 2px solid #ffa500;\n      border-radius: 12px;\n      padding: 25px;\n      max-width: 700px;\n      width: 90%;\n      max-height: 80vh;\n      display: flex;\n      flex-direction: column;\n      box-shadow: 0 10px 40px rgba(0, 0, 0, 0.8);\n    `;\n\n    dialog.innerHTML = `\n      <h3 style="margin: 0 0 15px 0; color: #ffa500; font-size: 18px; font-weight: 600;">\n        <i class="fa-solid fa-copy" style="margin-right: 8px;"></i>\n        æ‰‹åŠ¨å¤åˆ¶å†…å®¹\n      </h3>\n      <div style="background: #1a1a1a; border: 1px solid #3a3a3a; border-radius: 6px; padding: 12px; margin-bottom: 15px;">\n        <p style="margin: 0; color: #e0e0e0; font-size: 14px; line-height: 1.6;">\n          âš ï¸ è‡ªåŠ¨å¤åˆ¶åŠŸèƒ½åœ¨å½“å‰ç¯å¢ƒä¸‹ä¸å¯ç”¨ï¼Œè¯·æ‰‹åŠ¨å¤åˆ¶ä»¥ä¸‹å†…å®¹ï¼š\n        </p>\n        <ol style="margin: 8px 0 0 20px; padding: 0; color: #ccc; font-size: 13px;">\n          <li>ç‚¹å‡»ä¸‹æ–¹æ–‡æœ¬æ¡†é€‰ä¸­å†…å®¹</li>\n          <li>æŒ‰ <kbd style="background: #444; padding: 2px 6px; border-radius: 3px;">Ctrl+A</kbd> å…¨é€‰</li>\n          <li>æŒ‰ <kbd style="background: #444; padding: 2px 6px; border-radius: 3px;">Ctrl+C</kbd> å¤åˆ¶</li>\n        </ol>\n      </div>\n      <textarea\n        readonly\n        id="copyTextarea"\n        style="\n          width: 100%;\n          height: 300px;\n          background: #1a1a1a;\n          border: 2px solid #3a3a3a;\n          border-radius: 6px;\n          padding: 12px;\n          color: #e0e0e0;\n          font-size: 13px;\n          font-family: \'Courier New\', Consolas, monospace;\n          resize: vertical;\n          margin-bottom: 15px;\n          box-sizing: border-box;\n        "\n      >${text}</textarea>\n      <div style="display: flex; gap: 12px; justify-content: flex-end;">\n        <button id="manualCopyBtn" style="\n          padding: 10px 20px;\n          background: #28a745;\n          border: none;\n          border-radius: 6px;\n          color: white;\n          font-size: 14px;\n          font-weight: 600;\n          cursor: pointer;\n          transition: background 0.2s;\n        ">å°è¯•è‡ªåŠ¨å¤åˆ¶</button>\n        <button id="closeBtn" style="\n          padding: 10px 20px;\n          background: #6c757d;\n          border: none;\n          border-radius: 6px;\n          color: white;\n          font-size: 14px;\n          font-weight: 600;\n          cursor: pointer;\n          transition: background 0.2s;\n        ">å…³é—­</button>\n      </div>\n    `;\n\n    modal.appendChild(dialog);\n    targetBody.appendChild(modal);\n    console.log(\'ğŸ“‹ å¯¹è¯æ¡†å·²æ·»åŠ åˆ°DOM\');\n\n    // è‡ªåŠ¨é€‰ä¸­æ–‡æœ¬\n    const textarea = dialog.querySelector(\'#copyTextarea\') as HTMLTextAreaElement;\n    setTimeout(() => {\n      textarea.focus();\n      textarea.select();\n      console.log(\'ğŸ“‹ æ–‡æœ¬å·²è‡ªåŠ¨é€‰ä¸­\');\n    }, 100);\n\n    // ç»‘å®šäº‹ä»¶\n    const copyBtn = dialog.querySelector(\'#manualCopyBtn\') as HTMLButtonElement;\n    const closeBtn = dialog.querySelector(\'#closeBtn\') as HTMLButtonElement;\n\n    copyBtn.onmouseover = () => (copyBtn.style.background = \'#218838\');\n    copyBtn.onmouseout = () => (copyBtn.style.background = \'#28a745\');\n    closeBtn.onmouseover = () => (closeBtn.style.background = \'#5a6268\');\n    closeBtn.onmouseout = () => (closeBtn.style.background = \'#6c757d\');\n\n    copyBtn.onclick = () => {\n      try {\n        console.log(\'ğŸ“‹ å°è¯•é€šè¿‡æŒ‰é’®å¤åˆ¶...\');\n        textarea.focus();\n        textarea.select();\n        const success = targetDoc.execCommand(\'copy\');\n        console.log(\'ğŸ“‹ å¤åˆ¶ç»“æœ:\', success);\n\n        if (success) {\n          window.toastr.success(\'å¤åˆ¶æˆåŠŸï¼\');\n          targetBody.removeChild(modal);\n        } else {\n          window.toastr.warning(\'è‡ªåŠ¨å¤åˆ¶å¤±è´¥ï¼Œè¯·æ‰‹åŠ¨æŒ‰ Ctrl+C å¤åˆ¶\');\n        }\n      } catch (error) {\n        console.error(\'ğŸ“‹ å¤åˆ¶å¼‚å¸¸:\', error);\n        window.toastr.warning(\'è‡ªåŠ¨å¤åˆ¶å¤±è´¥ï¼Œè¯·æ‰‹åŠ¨æŒ‰ Ctrl+C å¤åˆ¶\');\n      }\n    };\n\n    closeBtn.onclick = () => {\n      console.log(\'ğŸ“‹ å…³é—­å¯¹è¯æ¡†\');\n      targetBody.removeChild(modal);\n    };\n\n    // ç‚¹å‡»èƒŒæ™¯å…³é—­\n    modal.onclick = e => {\n      if (e.target === modal) {\n        console.log(\'ğŸ“‹ ç‚¹å‡»èƒŒæ™¯å…³é—­\');\n        targetBody.removeChild(modal);\n      }\n    };\n\n    // ESCé”®å…³é—­\n    const handleEsc = (e: KeyboardEvent) => {\n      if (e.key === \'Escape\') {\n        console.log(\'ğŸ“‹ æŒ‰ESCå…³é—­\');\n        targetBody.removeChild(modal);\n        targetDoc.removeEventListener(\'keydown\', handleEsc);\n      }\n    };\n    targetDoc.addEventListener(\'keydown\', handleEsc);\n\n    window.toastr.info(\'å·²æ‰“å¼€æ‰‹åŠ¨å¤åˆ¶å¯¹è¯æ¡†ï¼Œè¯·æŒ‰ç…§æç¤ºæ“ä½œ\', \'\', { timeOut: 3000 });\n  } catch (error) {\n    console.error(\'âŒ æ˜¾ç¤ºå¤åˆ¶å¯¹è¯æ¡†å¤±è´¥:\', error);\n    window.toastr.error(\'æ— æ³•æ˜¾ç¤ºå¤åˆ¶å¯¹è¯æ¡†ï¼š\' + (error as Error).message);\n  }\n};\n\n// åå…«è‚¡å·¥å…·å¤„ç†å‡½æ•°\nconst handleAntiClicheProcess = async () => {\n  if (!antiClicheInput.value.trim()) {\n    window.toastr.warning(\'è¯·è¾“å…¥éœ€è¦æ¸…ç†çš„æ–‡æœ¬\');\n    return;\n  }\n\n  try {\n    isProcessingAntiCliche.value = true;\n    window.toastr.info(\'AIæ­£åœ¨åˆ†ææ–‡æœ¬...\', \'åå…«è‚¡æ¸…ç†\', { timeOut: 15000 });\n\n    const response = await fetch(settings.value.api_endpoint, {\n      method: \'POST\',\n      headers: {\n        \'Content-Type\': \'application/json\',\n        Authorization: `Bearer ${settings.value.api_key}`,\n      },\n      body: JSON.stringify({\n        model: settings.value.model,\n        messages: [\n          {\n            role: \'system\',\n            content: `ä½ æ˜¯ä¸€ä¸ªæ–‡æœ¬ç¼–è¾‘åŠ©æ‰‹ï¼Œè´Ÿè´£ç³»ç»Ÿæ€§åœ°æ¸…ç†è§’è‰²å¡ã€ä¸–ç•Œä¹¦å’Œå¼€åœºç™½ä¸­çš„å…«è‚¡è¡¨è¿°ã€‚è¯·æŒ‰ç…§ä»¥ä¸‹ä¹ä¸ªæ­¥éª¤ä¸¥æ ¼æ‰§è¡Œï¼š\n\n## ç¬¬ä¸€æ­¥ï¼šå»é™¤æ¨¡ç³Šè¯å’Œç±»æ¯”è¯\nåˆ é™¤ï¼šä¼¼ä¹ã€å‡ ä¹ã€è¿‘ä¹ã€å¥½åƒã€ä»¿ä½›ã€å¦‚åŒã€å®›å¦‚ã€æ°ä¼¼ã€ä¸€ä¸ã€ä¸€æŠ¹ã€ä¸€ä¸ä¸ã€ä¸€èˆ¬ã€ä¸æ˜“å¯Ÿè§‰ã€è‹¥æœ‰è‹¥æ— \n\n## ç¬¬äºŒæ­¥ï¼šå»é™¤å…«è‚¡æ¯”å–»è¯\n- åˆ é™¤æ‰€æœ‰åŠ¨ç‰©åŒ–æ¯”å–»ï¼šåƒå°å…”å­ä¸€æ ·ã€åƒå°å…½ä¸€æ ·ã€åƒçŒ«å’ªä¸€æ ·ã€é‡å…½ã€å°å…½ã€å¹¼å…½ã€ä½å¼ã€å˜¶å¼\n- åˆ é™¤æŠ•çŸ³ç±»æ¯”å–»ï¼šæŠ•çŸ³å…¥æ°´ã€çŸ³å¤´è½åœ°ç­‰\n- ç›´æ¥æè¿°åŠ¨ä½œå’ŒçŠ¶æ€ï¼Œä¸ä½¿ç”¨æ¯”å–»\n\n## ç¬¬ä¸‰æ­¥ï¼šå»é™¤è¯­æ°”å£°éŸ³æè¿°\nåˆ é™¤ï¼šå¸¦ç€xxxçš„å£å»/è¯­æ°”ã€å£°éŸ³æ¯”å¯’å†°æ›´å†°å†·ã€ç”¨ä¸å®¹ç½®ç–‘çš„è¯­æ°”ã€æ¯ä¸ªå­—éƒ½å¸¦ç€xxxã€æ²™å“‘çš„å£°éŸ³ã€ä»»ä½•å£°éŸ³è´¨æ„Ÿæè¿°\n**åŸåˆ™ï¼šå®Œå…¨ä¸æå†™è¯­æ°”ï¼Œç”±å¯¹è¯å†…å®¹æœ¬èº«å‡¸æ˜¾äººè®¾**\n\n## ç¬¬å››æ­¥ï¼šå»é™¤å¾®è¡¨æƒ…å’Œå¾®åŠ¨ä½œ\nåˆ é™¤ï¼šæµéœ²å‡ºxxxç¥è‰²ã€çœ¼é‡Œæ¼¾èµ·/é—ªè¿‡xxxã€å˜´è§’ä¸Šæ‰¬/ç¿˜èµ·å¼§åº¦ã€éœ²å‡ºä¸€ä¸å¾®ç¬‘ã€æŒ‡å°–æ³›ç™½ã€ä¸‹æ„è¯†/æ— æ„è¯†çš„åŠ¨ä½œã€ç‹¡é» ã€ç”œè…»ç­‰è¡¨æƒ…\n**æ›¿ä»£ï¼šå¦‚éœ€å°åŠ¨ä½œï¼Œç”¨"ä¹ æƒ¯æ€§åœ°"è€Œé"ä¸‹æ„è¯†"**\n\n## ç¬¬äº”æ­¥ï¼šå»é™¤"ä¸æ˜¯â€¦â€¦è€Œæ˜¯â€¦â€¦"å¥å¼\næ¸…ç†æ‰€æœ‰å¦å®šè½¬æŠ˜å¥ï¼Œç›´æ¥å†™"è€Œæ˜¯"åé¢çš„å†…å®¹\n\n## ç¬¬å…­æ­¥ï¼šä¿®æ”¹å¤–è²Œæè¿°\n- ç³è‰²ç§»å…¥å¯¹è¯ç”±è§’è‰²è‡ªè¿°\n- å¥³æ€§ç½©æ¯æ”¹ä¸º"èƒ¸éƒ¨å¹³å¦/ä¸°æ»¡"ç­‰æè¿°\n- ç²¾ç¡®èº«é«˜æ”¹ä¸º"é«˜ä¸€ç±³å…«"ç­‰æè¿°æ€§è¯­è¨€\n- åˆ é™¤ä¸‰ç»´å°ºå¯¸æ•°æ®\n\n## ç¬¬ä¸ƒæ­¥ï¼šé‡å†™è¯­æ–™å’Œæ€§æ ¼æè¿°\n- è¯­æ–™åªç”¨çº¯å¯¹è¯ï¼Œä¸é™„åŠ è¡¨æƒ…åŠ¨ä½œç¥æ€\n- é€šè¿‡å…·ä½“è¡Œä¸ºååº”ä½“ç°æ€§æ ¼ï¼Œé¿å…æ€§æ ¼æ ‡ç­¾\n- ç”¨é™ˆè¿°å¼è‚¯å®šå‹æè¿°ï¼Œä¸åŠ ä¿®è¾\n\n## ç¬¬å…«æ­¥ï¼šé˜²æ­¢ç»æœ›/ç¥åŒ–/æŒæ§å€¾å‘\n- åˆ é™¤æç«¯æƒ…ç»ªè¯ï¼šæå¤§çš„ææƒ§ã€éå¸¸å®³æ€•ã€æåº¦ç¾è€»ã€æåº¦ä¸å®‰\n- åˆ é™¤è´Ÿé¢çŠ¶æ€è¯ï¼šç•ç¼©ã€ç©ºç™½ã€ä¸€å¡ä¸€å¡ã€æœºæ¢°åŒ–ã€åƒµç¡¬\n- ä¸å†™è§’è‰²å¿ƒç†ååº”å’Œå†…å¿ƒæƒ³æ³•\n- ä¸å†™userçš„å¿ƒç†ååº”ï¼Œä¸ç¥åŒ–è§’è‰²\n\n## ç¬¬ä¹æ­¥ï¼šNSFWéƒ¨åˆ†é˜²æ€§ç‹‚é‡\n- åˆ é™¤ï¼šå–œæ¬¢ç²—æš´/åŠ é€Ÿã€å–œæ¬¢æ€§å¿«æ„Ÿã€ç–¼ç—›ç—›è‹¦ç›¸å…³\n- åˆ é™¤ï¼šæ’•ç¢ã€æ’•è£‚ã€ç ´ç¢ã€ç»ã€ç»ç¼ ã€ç¢¾ã€ç¢¾ç£¨ã€ç ”ç£¨ã€æ”«ã€å°–å«ã€é«˜äº¢ã€å‘œå’½ã€ç”Ÿç†æ€§æ³ªæ°´ã€ç”¬é“ã€å¼“èµ·ã€ç­é¡¶çš„å¿«æ„Ÿã€ç»†ç¢\n- é¿å…æ€§å™¨å®˜å°ºå¯¸å¤¸å¼ æè¿°\n\n## å®Œæ•´ç¦ç”¨è¯åˆ—è¡¨ï¼ˆå¿…é¡»åˆ é™¤ï¼‰ï¼š\næ¨¡ç³Šè¯ï¼šä¸€ä¸ã€ä¸€æŠ¹ã€ä¼¼ä¹ã€å‡ ä¹ã€è¿‘ä¹ã€ä»¿ä½›ã€å¦‚åŒã€å®›å¦‚ã€æ°ä¼¼ã€ä¸æ˜“å¯Ÿè§‰ã€è‹¥æœ‰è‹¥æ— \nåŠ¨ç‰©åŒ–ï¼šé‡å…½ã€å°å…½ã€å¹¼å…½ã€åƒå°å…”å­ã€åƒçŒ«å’ªã€ä½å¼ã€å˜¶å¼ã€å—æƒŠçš„å°å…½\næƒ…ç»ªè¯ï¼šç‹¡é» ã€ç”œè…»ã€ç–¯ç‹‚ã€æˆè°‘ã€æ¼æ€’ã€å›°æƒ‘ã€ææƒ§ã€ç»æœ›ã€å´‡æ‹œã€ç‹‚çƒ­ã€ç©ºæ´ã€æ¯«æ— ç”Ÿæ°”ã€è‡ªå˜²ã€è‹¦æ¶©ã€å†°å†·ã€æš§æ˜§ã€è™”è¯š\nåŠ¨ä½œè¯ï¼šé—ªè¿‡ã€é—ªç€ã€å‘ç™½ã€æ’•ç¢ã€æ’•è£‚ã€å¼§åº¦ã€ç ´ç¢ã€ç»ã€å°–å«ã€å‘œå’½ã€æ²™å“‘ã€ç¢¾ã€ç ”ç£¨ã€æ”«ã€å¼“èµ·ã€ç»†ç¢ã€æŒ‡èŠ‚å‘ç™½ã€æ— æ„è¯†çš„ã€ä¸‹æ„è¯†ã€èœ·ç¼©ã€ç—‰æŒ›ã€åƒµä½ã€æ¥åœ¨åŸåœ°ã€é¢¤æŠ–ã€å®äº†ä¸‹æ¥ã€ç´§æ¡ã€æ”¥ä½ã€å‹¾ä½ã€ç»åœ¨ä¸€èµ·ã€å‹å¾—å–˜ä¸è¿‡æ°”ã€æ·¹æ²¡ã€å‡»å®ã€åˆ’å¼€ã€åˆºç ´ã€åå™¬\nç”Ÿç†è¯ï¼šç”Ÿç†æ€§æ³ªæ°´ã€ç”¬é“ã€ç­é¡¶çš„å¿«æ„Ÿã€æš–æµæ¶Œä¸Šå¿ƒå¤´ã€å¦‚å å†°çªŸã€æµ‘èº«å†°å†·ã€æ‰‹è„šå†°å‡‰ã€å¤§è„‘ä¸€ç‰‡ç©ºç™½ã€å—¡å—¡ä½œå“ã€å‘¼å¸ä¸€æ»ã€å€’å¸ä¸€å£å‡‰æ°”ã€èº«ä½“åƒµç¡¬ã€å¦‚é­é›·å‡»ã€ç»†å¯†çš„æ±—ç \næ¯”å–»ç±»ï¼šçŸ³å­æŠ•å…¥æ¹–ä¸­ã€æ³›èµ·æ¶Ÿæ¼ªã€é’ˆæ‰ç ´æ°”çƒã€æ‰‹æœ¯åˆ€åˆ’å¼€ã€å—æƒŠå°å…½ã€æçº¿æœ¨å¶ã€å‘½è¿çš„é½¿è½®ã€å›å¿†æ½®æ°´ã€é˜³å…‰æ–‘é©³ã€å…‰å½±ã€åƒæ ¹é’ˆä¸€æ ·æ‰è¿›\nå£°éŸ³ç±»ï¼šæ²™å“‘ã€ç£æ€§ã€æ·±æ²‰ã€é“¶é“ƒèˆ¬æ¸…è„†ã€å£°éŸ³é‡Œä¸å¸¦ä¸€ä¸æ¸©åº¦ã€ä½æ²‰è€Œå¯Œæœ‰ç£æ€§ã€ç»†è‹¥èšŠå‘\næŠ½è±¡è¯ï¼šå¿ƒæ¹–ã€å¤äº•ã€æ·±æ¸Šã€è°·åº•ã€æ—¶é—´é™æ­¢ã€ç©ºæ°”å‡å›ºã€åœ£ç‰©ã€è™”è¯šã€å®›è‹¥ç¥æ˜ã€æ¶é­”ã€çŒ®ç¥­ã€ä»ªå¼ã€å®¡åˆ¤ã€å¾æœã€æ”¯é…ã€å æœ‰ã€å‡å›ºã€é™·å…¥ã€æœ¨è®·ã€æ¯å¤©ç­åœ°ã€é“ºå¤©ç›–åœ°ã€æ·¬æ¯’åˆ€å­ã€ç©¿äº‘è£‚çŸ³ã€æ°¤æ°²ã€æœ‰æ¯’è—¤è”“ã€æ‰å…¥éª¨è¡€\nå¦å®šå¥å¼ï¼šä¸æ˜¯è€Œæ˜¯ã€å¹¶ä¸å­˜åœ¨\nç¨‹åº¦è¯ï¼šé“ºå¤©ç›–åœ°ã€ç‹‚é£æš´é›¨ã€æ¯å¤©ç­åœ°ã€å……æ»¡äº†xxxã€ä¸å®¹è´¨ç–‘ã€ä¸å®¹é”™è¾¨ã€ä¸å®¹æŠ—æ‹’ã€éšæ—¶ã€ç«‹åˆ»ã€ç¬é—´ã€é¡·åˆ»é—´\n\n**é‡è¦åŸåˆ™ï¼š**\n1. ç›´æ¥åˆ é™¤ç¦ç”¨è¯ï¼Œä¸è¦æ›¿æ¢ä¸ºåŒä¹‰è¯\n2. ç”¨å…·ä½“è¡Œä¸ºæ›¿ä»£æŠ½è±¡æƒ…ç»ªå’Œå¿ƒç†æå†™\n3. ä¿æŒåŸæ–‡æ ¸å¿ƒæ„æ€ï¼Œä½†è¡¨è¾¾æ–¹å¼è¦å½»åº•æ”¹å˜\n4. è¯­æ–™å¿…é¡»æ˜¯çº¯å¯¹è¯ï¼Œä¸å¸¦ä»»ä½•åŠ¨ä½œè¡¨æƒ…\n5. å¤–è²Œå’Œæ€§æ ¼ç”¨é™ˆè¿°å¼è‚¯å®šæè¿°ï¼Œä¸ç”¨ä¿®è¾\n\nè¯·ä¸¥æ ¼æŒ‰ç…§ä»¥ä¸Šæ ‡å‡†æ¸…ç†æ–‡æœ¬ï¼Œç›´æ¥è¾“å‡ºæ¸…ç†åçš„ç»“æœï¼Œä¸è¦æ·»åŠ ä»»ä½•è§£é‡Šæˆ–è¯´æ˜ã€‚`,\n          },\n          {\n            role: \'user\',\n            content: antiClicheInput.value,\n          },\n        ],\n        max_tokens: settings.value.max_tokens || 8000,\n        temperature: 0.7,\n      }),\n    });\n\n    if (!response.ok) {\n      throw new Error(`HTTP error! status: ${response.status}`);\n    }\n\n    const data = await response.json();\n    antiClicheOutput.value = data.choices[0].message.content.trim();\n    saveToolsDataImmediate(); // ç«‹å³ä¿å­˜ç»“æœ\n\n    window.toastr.success(\'æ–‡æœ¬æ¸…ç†å®Œæˆï¼\');\n  } catch (error) {\n    console.error(\'åå…«è‚¡æ¸…ç†å¤±è´¥:\', error);\n    window.toastr.error(\'æ¸…ç†å¤±è´¥ï¼š\' + (error as Error).message);\n  } finally {\n    isProcessingAntiCliche.value = false;\n  }\n};\n\nconst copyAntiClicheResult = () => {\n  if (!antiClicheOutput.value) {\n    window.toastr.warning(\'æ²¡æœ‰å¯å¤åˆ¶çš„å†…å®¹\');\n    return;\n  }\n\n  // ä½¿ç”¨ç»Ÿä¸€çš„å¤åˆ¶å‡½æ•°\n  copyToClipboard(antiClicheOutput.value, \'æ¸…ç†ç»“æœå·²å¤åˆ¶åˆ°å‰ªè´´æ¿\');\n};\n\n// è§’è‰²å¡ç”Ÿæˆå·¥å…·ç›¸å…³å‡½æ•°\nconst handleGenerateCharacterCard = async () => {\n  if (!characterDescription.value.trim()) {\n    window.toastr.warning(\'è¯·è¾“å…¥è§’è‰²æè¿°\');\n    return;\n  }\n\n  try {\n    isGeneratingCharacter.value = true;\n    window.toastr.info(\'AIæ­£åœ¨ç”Ÿæˆè§’è‰²å¡ï¼Œè¯·ç¨å€™...\');\n\n    const response = await fetch(settings.value.api_endpoint, {\n      method: \'POST\',\n      headers: {\n        \'Content-Type\': \'application/json\',\n        Authorization: `Bearer ${settings.value.api_key}`,\n      },\n      body: JSON.stringify({\n        model: settings.value.model || \'gpt-3.5-turbo\',\n        max_tokens: settings.value.max_tokens || 16000,\n        temperature: 0.8,\n        messages: [\n          {\n            role: \'system\',\n            content: `ä½ æ˜¯ä¸€ä¸ªè§’è‰²å¡ç”ŸæˆåŠ©æ‰‹ã€‚è¯·ç³»ç»Ÿæ€§åœ°åˆ›å»ºä¸€ä¸ªå®Œæ•´çš„è§’è‰²å¡ã€‚\n\n**è¾“å‡ºæ ¼å¼è¦æ±‚**ï¼š\n- å¿…é¡»ä½¿ç”¨ YAML æ ¼å¼ï¼Œæ‰€æœ‰å­—æ®µåå’Œå†…å®¹éƒ½ç”¨ä¸­æ–‡\n- ç¡®ä¿è¾“å‡ºå®Œæ•´ï¼Œä¸è¦æˆªæ–­\n- é¿å…AIåˆ»æ¿åŒ–ï¼Œè¦æœ‰å¤šæ ·æ€§å’ŒçœŸå®æ„Ÿ\n- ä¸¥æ ¼é¿å…ä»»ä½•AIæŒ‡ä»¤å¼è¯­è¨€\n\n**è§’è‰²å¡ç»“æ„æ¨¡æ¿**ï¼š\n\\`\\`\\`yaml\nåŸºç¡€ä¿¡æ¯:\n  å§“å: "å…¨å"\n  å¹´é¾„: å…·ä½“å¹´é¾„\n  å‡ºç”Ÿå¹´æœˆ: "YYYYå¹´MMæœˆ"\n  æ€§åˆ«: "ç”·/å¥³/å…¶ä»–"\n  ç¬¬äºŒæ€§åˆ«: "Alpha/Beta/Omega/æ— "\n  èº«é«˜ä½“é‡: "èº«é«˜ç”¨æ–‡å­—æè¿°ï¼ˆé«˜å¤§/ä¸­ç­‰/å¨‡å°ç­‰ï¼‰ï¼Œä½“é‡ç”¨æ–‡å­—æè¿°ï¼ˆåŒ€ç§°/çº¤ç˜¦/ä¸°æ»¡ç­‰ï¼‰"\n  ä¿¡æ¯ç´ : "æè¿°æ°”å‘³ç‰¹å¾å’Œå˜åŒ–è§„å¾‹ï¼ˆå¦‚é€‚ç”¨ï¼‰"\n  æ€§å–å‘: "å¼‚æ€§æ‹/åŒæ€§æ‹/åŒæ€§æ‹ç­‰"\n  æ‹çˆ±ç»éªŒ: "è¯¦ç»†æè¿°"\n  èº«ä»½èŒä¸š: "å…·ä½“èŒä¸šå’Œç¤¾ä¼šåœ°ä½"\n  æ ‡å¿—æ€§ç‰¹å¾:\n    å¾®ä¿¡æ˜µç§°: "æ˜µç§°"\n    å¤´åƒ: "æè¿°"\n    å…¶ä»–: "å…¶ä»–æ ‡å¿—æ€§ç‰¹å¾"\n\nå¤–è²Œä¸èº«æ:\n  æ•´ä½“èº«å½¢: "é«˜çŸ®èƒ–ç˜¦ã€è‚Œè‚‰ç±»å‹çš„è¯¦ç»†æè¿°"\n  é¢å®¹ç‰¹å¾:\n    å‘å‹: "å‘å‹ã€å‘è‰²ã€å‘è´¨"\n    è‚¤è‰²: "è‚¤è‰²æè¿°"\n    çœ¼ç›: "çœ¼ç›é¢œè‰²å’Œç‰¹å¾"\n    äº”å®˜: "äº”å®˜ç‰¹ç‚¹"\n  ç©¿æ­é£æ ¼: "æ—¥å¸¸ç©¿æ­åå¥½å’Œé£æ ¼"\n  å£°éŸ³ç‰¹å¾: "éŸ³è‰²ã€éŸ³è°ƒã€è¯´è¯èŠ‚å¥"\n  ä¹ æƒ¯æ€§åŠ¨ä½œ: "å¸¸è§çš„å§¿æ€å’Œå°åŠ¨ä½œ"\n\næ€§æ ¼ä¸å¿ƒç†:\n  ä¸»è¦æ€§æ ¼ç‰¹å¾:\n    - ç‰¹è´¨1: "å…·ä½“è¡¨ç°å’Œè¡Œä¸ºæ¨¡å¼"\n    - ç‰¹è´¨2: "å…·ä½“è¡¨ç°å’Œè¡Œä¸ºæ¨¡å¼"\n    - ç‰¹è´¨3: "å…·ä½“è¡¨ç°å’Œè¡Œä¸ºæ¨¡å¼"\n  æ€§æ ¼çš„ä¸¤é¢æ€§: "åœ¨ä¸åŒæƒ…å†µä¸‹å±•ç°çš„ä¸åŒä¾§é¢ï¼ˆä¾‹å¦‚ï¼šå¹³æ—¶æ¸©å’Œä½†è§¦åŠåº•çº¿æ—¶å¼ºç¡¬ï¼‰"\n  æƒ…ç»ªæ¨¡å¼:\n    å¸¸è§æƒ…ç»ª: "æ—¥å¸¸ä¸»è¦æƒ…ç»ªçŠ¶æ€"\n    æƒ…ç»ªè§¦å‘ç‚¹: "ä»€ä¹ˆå®¹æ˜“å¼•å‘æƒ…ç»ªæ³¢åŠ¨"\n    æƒ…ç»ªè¡¨è¾¾æ–¹å¼: "å¦‚ä½•è¡¨ç°å’Œå¤„ç†æƒ…ç»ª"\n  åº”å¯¹å‹åŠ›: "é¢å¯¹å‹åŠ›å’Œå›°å¢ƒæ—¶çš„ååº”å’Œå¤„ç†æ–¹å¼"\n\nå¯¹è¯é£æ ¼:\n  æ—¥å¸¸è¯­æ°”: "ç”¨è¯ä¹ æƒ¯å’Œè¯´è¯ç‰¹ç‚¹"\n  å¯¹ä¸åŒå¯¹è±¡:\n    äº²è¿‘çš„äºº: "è¯´è¯æ–¹å¼"\n    é™Œç”Ÿäºº: "è¯´è¯æ–¹å¼"\n    å·¥ä½œåœºåˆ: "è¯´è¯æ–¹å¼"\n  æƒ…ç»ªå˜åŒ–æ—¶: "æƒ…ç»ªæ¿€åŠ¨/ä½è½æ—¶çš„è¯­è¨€å˜åŒ–"\n  å£å¤´ç¦…: ["å£å¤´ç¦…1", "å£å¤´ç¦…2"]\n\nèƒŒæ™¯ç»å†:\n  å®¶åº­èƒŒæ™¯: "è¯¦ç»†çš„å®¶åº­ç¯å¢ƒå’Œæˆé•¿èƒŒæ™¯"\n  æ•™è‚²ç»å†: "å­¦ä¹ ç»å†"\n  é‡è¦äººç”Ÿäº‹ä»¶: ["äº‹ä»¶1", "äº‹ä»¶2", "äº‹ä»¶3"]\n  å…³é”®è½¬æŠ˜ç‚¹: "æ”¹å˜TAçš„é‡è¦äº‹ä»¶"\n  å½“å‰çŠ¶å†µ: "ç°åœ¨çš„ç”Ÿæ´»çŠ¶æ€"\n  äººç”Ÿç›®æ ‡: "TAæƒ³è¦è¾¾æˆçš„ç›®æ ‡"\n\näººé™…å…³ç³»:\n  å¯¹ä¸»è¦è§’è‰²çš„æ€åº¦: "ä¸{{user}}æˆ–å…¶ä»–é‡è¦è§’è‰²çš„äº’åŠ¨æ¨¡å¼"\n  ç¤¾äº¤åå¥½: "å–œæ¬¢çš„ç¤¾äº¤æ–¹å¼å’Œè¾¹ç•Œ"\n  ç¾¤ä½“è§’è‰²: "åœ¨å›¢é˜Ÿä¸­çš„å®šä½ï¼ˆé¢†å¯¼è€…/åè°ƒè€…/è§‚å¯Ÿè€…ç­‰ï¼‰"\n  å†²çªå¤„ç†: "å¦‚ä½•å¤„ç†çŸ›ç›¾å’Œå†²çª"\n\nè¡Œä¸ºæ¨¡å¼ä¸åŠ¨æœº:\n  å…¸å‹è¡Œä¸º:\n    ä¸»åŠ¨å€¾å‘: "TAå€¾å‘äºä¸»åŠ¨åšä»€ä¹ˆäº‹æƒ…"\n    å›é¿å€¾å‘: "TAä¼šé¿å…æˆ–æ‹’ç»åšä»€ä¹ˆ"\n    ä¹ æƒ¯ååº”: "åœ¨ç‰¹å®šæƒ…å†µä¸‹çš„å…¸å‹ååº”"\n  åº•çº¿ä¸åŸåˆ™: "TAåšå®ˆçš„åŸåˆ™å’Œä¸å¯è§¦ç¢°çš„åº•çº¿"\n  å†…åœ¨åŠ¨æœº:\n    è¡ŒåŠ¨é©±åŠ¨: "æ¨åŠ¨TAè¡ŒåŠ¨çš„å†…åœ¨åŸå› "\n    æ·±å±‚éœ€æ±‚: "TAå†…å¿ƒçœŸæ­£æ¸´æœ›çš„æ˜¯ä»€ä¹ˆ"\n    éšè—æƒ³æ³•: "TAä¸è½»æ˜“è¡¨éœ²çš„çœŸå®æƒ³æ³•"\n  æƒ…ç»ªç®¡ç†:\n    å¤±æ§è¾¹ç•Œ: "ä»€ä¹ˆæƒ…å†µä¸‹ä¼šæƒ…ç»ªå¤±æ§"\n    æ¢å¤æ–¹å¼: "å¦‚ä½•å¹³å¤æƒ…ç»ªå’Œè‡ªæˆ‘è°ƒèŠ‚"\n\\`\\`\\`\n\nè¯·åŸºäºç”¨æˆ·çš„æè¿°ï¼Œç”Ÿæˆä¸€ä¸ªå®Œæ•´ã€ç«‹ä½“ã€çœŸå®çš„è§’è‰²ã€‚æ³¨æ„ï¼š\n1. èº«é«˜ä½“é‡å¿…é¡»ç”¨æ–‡å­—æè¿°ï¼Œä¸è¦ç”¨æ•°å­—å’Œå•ä½\n2. æ€§æ ¼è¦å±•ç°å¤šé¢æ€§å’Œå¤æ‚æ€§ï¼Œé¿å…å•ä¸€åŒ–å’Œåˆ»æ¿å°è±¡\n3. è¡Œä¸ºæ¨¡å¼è¦ä»è§’è‰²è§†è§’å‡ºå‘ï¼Œæè¿°TAä¼šå¦‚ä½•æ€è€ƒå’Œè¡ŒåŠ¨\n4. æ‰€æœ‰å†…å®¹è¦è¯¦ç»†ä¸°å¯Œï¼Œæœ‰å…·ä½“ä¾‹å­å’Œåœºæ™¯`,\n          },\n          {\n            role: \'user\',\n            content: characterDescription.value,\n          },\n        ],\n      }),\n    });\n\n    if (!response.ok) {\n      throw new Error(`HTTP error! status: ${response.status}`);\n    }\n\n    const data = await response.json();\n    characterCardOutput.value = data.choices[0].message.content.trim();\n    saveToolsDataImmediate(); // ç«‹å³ä¿å­˜ç»“æœ\n\n    window.toastr.success(\'è§’è‰²å¡ç”Ÿæˆå®Œæˆï¼\');\n  } catch (error) {\n    console.error(\'è§’è‰²å¡ç”Ÿæˆå¤±è´¥:\', error);\n    window.toastr.error(\'ç”Ÿæˆå¤±è´¥ï¼š\' + (error as Error).message);\n  } finally {\n    isGeneratingCharacter.value = false;\n  }\n};\n\nconst clearCharacterForm = () => {\n  characterDescription.value = \'\';\n  characterCardOutput.value = \'\';\n  modifyRequest.value = \'\';\n  saveToolsDataImmediate(); // ç«‹å³ä¿å­˜\n  window.toastr.success(\'å†…å®¹å·²æ¸…ç©º\');\n};\n\nconst copyCharacterCard = () => {\n  if (!characterCardOutput.value) {\n    window.toastr.warning(\'æ²¡æœ‰å¯å¤åˆ¶çš„å†…å®¹\');\n    return;\n  }\n\n  // ä½¿ç”¨ç»Ÿä¸€çš„å¤åˆ¶å‡½æ•°\n  copyToClipboard(characterCardOutput.value, \'è§’è‰²å¡å·²å¤åˆ¶åˆ°å‰ªè´´æ¿\');\n};\n\n// æ¸…ç©ºåå…«è‚¡è¡¨å•\nconst clearAntiClicheForm = () => {\n  antiClicheInput.value = \'\';\n  antiClicheOutput.value = \'\';\n  saveToolsDataImmediate(); // ç«‹å³ä¿å­˜\n  window.toastr.success(\'å†…å®¹å·²æ¸…ç©º\');\n};\n\n// ä¿®æ”¹è§’è‰²å¡\nconst handleModifyCharacterCard = async () => {\n  if (!modifyRequest.value.trim()) {\n    window.toastr.warning(\'è¯·è¾“å…¥ä¿®æ”¹éœ€æ±‚\');\n    return;\n  }\n\n  if (!characterCardOutput.value) {\n    window.toastr.warning(\'æ²¡æœ‰å¯ä¿®æ”¹çš„è§’è‰²å¡ï¼Œè¯·å…ˆç”Ÿæˆè§’è‰²å¡\');\n    return;\n  }\n\n  try {\n    isModifyingCharacter.value = true;\n    window.toastr.info(\'AIæ­£åœ¨æ ¹æ®ä½ çš„éœ€æ±‚ä¿®æ”¹è§’è‰²å¡ï¼Œè¯·ç¨å€™...\');\n\n    const response = await fetch(settings.value.api_endpoint, {\n      method: \'POST\',\n      headers: {\n        \'Content-Type\': \'application/json\',\n        Authorization: `Bearer ${settings.value.api_key}`,\n      },\n      body: JSON.stringify({\n        model: settings.value.model || \'gpt-3.5-turbo\',\n        max_tokens: settings.value.max_tokens || 16000,\n        temperature: 0.8,\n        messages: [\n          {\n            role: \'system\',\n            content: `ä½ æ˜¯ä¸€ä¸ªè§’è‰²å¡ç¼–è¾‘åŠ©æ‰‹ã€‚ç”¨æˆ·ä¼šæä¾›ä¸€ä¸ªç°æœ‰çš„ YAML æ ¼å¼è§’è‰²å¡å’Œä¿®æ”¹éœ€æ±‚ï¼Œè¯·æ ¹æ®ä¿®æ”¹éœ€æ±‚è°ƒæ•´è§’è‰²å¡å†…å®¹ã€‚\n\n**ä¿®æ”¹åŸåˆ™**ï¼š\n1. å¿…é¡»ä¿æŒ YAML æ ¼å¼ï¼Œæ‰€æœ‰å­—æ®µåå’Œå†…å®¹éƒ½ä½¿ç”¨ä¸­æ–‡\n2. åªä¿®æ”¹ç”¨æˆ·æ˜ç¡®è¦æ±‚ä¿®æ”¹çš„éƒ¨åˆ†\n3. ç¡®ä¿ä¿®æ”¹åçš„å†…å®¹ä¸åŸæœ‰è§’è‰²å¡é£æ ¼ä¸€è‡´\n4. å¦‚æœç”¨æˆ·çš„è¦æ±‚ä¸åŸæœ‰è®¾å®šå†²çªï¼Œä»¥ç”¨æˆ·çš„è¦æ±‚ä¸ºå‡†\n5. è¾“å‡ºå®Œæ•´çš„ä¿®æ”¹åçš„è§’è‰²å¡ï¼Œä¸è¦æˆªæ–­\n6. ä¿æŒåŸæœ‰çš„å­—æ®µç»“æ„ï¼Œé™¤éç”¨æˆ·è¦æ±‚æ·»åŠ æˆ–åˆ é™¤å­—æ®µ\n\n**é‡è¦æ³¨æ„äº‹é¡¹**ï¼š\n- èº«é«˜ä½“é‡å¿…é¡»ç”¨æ–‡å­—æè¿°ï¼ˆé«˜å¤§/ä¸­ç­‰/å¨‡å°/åŒ€ç§°/çº¤ç˜¦ç­‰ï¼‰ï¼Œä¸è¦ç”¨æ•°å­—å’Œå•ä½\n- ä¿æŒæ€§æ ¼çš„å¤šé¢æ€§å’Œå¤æ‚æ€§ï¼Œé¿å…å•ä¸€åŒ–\n- è¡Œä¸ºæ¨¡å¼è¦ä»è§’è‰²è§†è§’å‡ºå‘ï¼Œæè¿°è§’è‰²ä¼šå¦‚ä½•æ€è€ƒå’Œè¡ŒåŠ¨\n- é¿å…AIåˆ»æ¿åŒ–ï¼Œä¿æŒè§’è‰²çš„çœŸå®æ„Ÿå’Œå¤šæ ·æ€§\n\nè¯·è¾“å‡ºå®Œæ•´çš„ YAML æ ¼å¼è§’è‰²å¡ã€‚`,\n          },\n          {\n            role: \'user\',\n            content: `ä»¥ä¸‹æ˜¯ç°æœ‰çš„è§’è‰²å¡ï¼š\n\n${characterCardOutput.value}\n\n---\n\nè¯·æ ¹æ®ä»¥ä¸‹ä¿®æ”¹éœ€æ±‚è°ƒæ•´è§’è‰²å¡ï¼š\n${modifyRequest.value}`,\n          },\n        ],\n      }),\n    });\n\n    if (!response.ok) {\n      throw new Error(`HTTP error! status: ${response.status}`);\n    }\n\n    const data = await response.json();\n    characterCardOutput.value = data.choices[0].message.content.trim();\n    modifyRequest.value = \'\'; // æ¸…ç©ºä¿®æ”¹éœ€æ±‚\n    saveToolsDataImmediate(); // ç«‹å³ä¿å­˜ç»“æœ\n\n    window.toastr.success(\'è§’è‰²å¡ä¿®æ”¹å®Œæˆï¼\');\n  } catch (error) {\n    console.error(\'è§’è‰²å¡ä¿®æ”¹å¤±è´¥:\', error);\n    window.toastr.error(\'ä¿®æ”¹å¤±è´¥ï¼š\' + (error as Error).message);\n  } finally {\n    isModifyingCharacter.value = false;\n  }\n};\n\n// æ¸…ç©ºä¿®æ”¹éœ€æ±‚\nconst clearModifyRequest = () => {\n  modifyRequest.value = \'\';\n  saveToolsDataImmediate(); // ç«‹å³ä¿å­˜\n  window.toastr.success(\'ä¿®æ”¹éœ€æ±‚å·²æ¸…ç©º\');\n};\n<\/script>\n\n<style scoped>\n.tools-tab {\n  height: 100%;\n  overflow-y: auto;\n  padding: 25px !important;\n}\n\n.section-header {\n  display: flex;\n  align-items: center;\n  justify-content: space-between;\n  padding: 15px 20px;\n  background: linear-gradient(135deg, #2a2a2a 0%, #3a3a3a 100%);\n  border-radius: 8px;\n  cursor: pointer;\n  transition: all 0.3s ease;\n  margin-bottom: 15px;\n  border: 1px solid #3a3a3a;\n}\n\n.section-header:hover {\n  background: linear-gradient(135deg, #3a3a3a 0%, #4a4a4a 100%);\n  transform: translateY(-1px);\n  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);\n}\n\n.tool-content {\n  background: #1e1e1e;\n  border: 1px solid #3a3a3a;\n  border-radius: 8px;\n  padding: 20px;\n  margin-bottom: 20px;\n}\n\n.tool-instructions {\n  background: #1a1a1a;\n  border: 1px solid #3a3a3a;\n  border-radius: 6px;\n  padding: 12px;\n  color: #ccc;\n  font-size: 12px;\n  margin-bottom: 15px;\n}\n\n.form-group {\n  margin-bottom: 15px;\n}\n\n.button-group {\n  display: flex;\n  gap: 12px;\n  margin-bottom: 20px;\n}\n\n.output-section {\n  margin-top: 20px;\n}\n\n.output-content {\n  background: #1e1e1e;\n  border: 1px solid #3a3a3a;\n  border-radius: 6px;\n  padding: 15px;\n  color: #e0e0e0;\n  font-size: 13px;\n  line-height: 1.6;\n  white-space: pre-wrap;\n  word-wrap: break-word;\n  max-height: 300px;\n  overflow-y: auto;\n}\n\n.output-actions {\n  margin-top: 12px;\n  display: flex;\n  gap: 12px;\n}\n\n/* æŒ‰é’®æ ·å¼ */\n.process-button,\n.clear-button,\n.generate-button,\n.copy-button {\n  position: relative;\n  overflow: hidden;\n  transition: all 0.3s ease;\n}\n\n.process-button:hover:not(:disabled),\n.clear-button:hover:not(:disabled),\n.generate-button:hover:not(:disabled),\n.copy-button:hover {\n  transform: translateY(-2px);\n  box-shadow: 0 6px 20px rgba(0, 0, 0, 0.3);\n}\n\n.copy-button:hover {\n  background: #218838 !important;\n}\n\n.tool-instructions {\n  background: #1a1a1a;\n  border: 1px solid #3a3a3a;\n  border-radius: 6px;\n  padding: 12px;\n  color: #ccc;\n  font-size: 12px;\n  margin-bottom: 15px;\n}\n\n/* ç¾åŒ–æŒ‰é’®çš„æ‚¬åœæ•ˆæœ */\n.process-button:hover:not(:disabled) .shimmer-effect,\n.clear-button:hover:not(:disabled) .shimmer-effect,\n.generate-button:hover:not(:disabled) .shimmer-effect,\n.copy-button:hover .shimmer-effect {\n  left: 100%;\n}\n\n.process-button:hover:not(:disabled) {\n  transform: translateY(-2px);\n  box-shadow: 0 6px 20px rgba(102, 126, 234, 0.4);\n}\n\n.clear-button:hover:not(:disabled) {\n  transform: translateY(-2px);\n  box-shadow: 0 6px 20px rgba(255, 107, 107, 0.4);\n}\n\n.generate-button:hover:not(:disabled) {\n  transform: translateY(-2px);\n  box-shadow: 0 6px 20px rgba(23, 162, 184, 0.4);\n}\n\n.copy-button:hover {\n  transform: translateY(-1px);\n  box-shadow: 0 5px 15px rgba(40, 167, 69, 0.4);\n}\n\n.process-button:disabled,\n.clear-button:disabled,\n.generate-button:disabled {\n  opacity: 0.6;\n  cursor: not-allowed;\n  transform: none;\n}\n\n.process-button:disabled:hover,\n.clear-button:disabled:hover,\n.generate-button:disabled:hover {\n  transform: none;\n  box-shadow: none;\n}\n\n/* æ»šåŠ¨æ¡æ ·å¼ */\n.output-content::-webkit-scrollbar {\n  width: 6px;\n}\n\n.output-content::-webkit-scrollbar-track {\n  background: #1a1a1a;\n  border-radius: 3px;\n}\n\n.output-content::-webkit-scrollbar-thumb {\n  background: #3a3a3a;\n  border-radius: 3px;\n}\n\n.output-content::-webkit-scrollbar-thumb:hover {\n  background: #4a4a4a;\n}\n\n/* å“åº”å¼è®¾è®¡ */\n@media (max-width: 768px) {\n  .button-group {\n    flex-direction: column;\n  }\n\n  .output-actions {\n    flex-direction: column;\n  }\n}\n</style>\n'],sourceRoot:''}]);const i=s},424:(n,e,t)=>{function o(n,e){for(var t=[],o={},a=0;a<e.length;a++){var r=e[a],s=r[0],i={id:n+':'+a,css:r[1],media:r[2],sourceMap:r[3]};o[s]?o[s].parts.push(i):t.push(o[s]={id:s,parts:[i]})}return t}t.d(e,{A:()=>m});var a='undefined'!=typeof document;if('undefined'!=typeof DEBUG&&DEBUG&&!a)throw new Error('vue-style-loader cannot be used in a non-browser environment. Use { target: \'node\' } in your Webpack config to indicate a server-rendering environment.');var r={},s=a&&(document.head||document.getElementsByTagName('head')[0]),i=null,l=0,d=!1,c=function(){},p=null,g='data-vue-ssr-id',u='undefined'!=typeof navigator&&/msie [6-9]\b/.test(navigator.userAgent.toLowerCase());function m(n,e,t,a){d=t,p=a||{};var s=o(n,e);return x(s),function(e){for(var t=[],a=0;a<s.length;a++){var i=s[a];(l=r[i.id]).refs--,t.push(l)}e?x(s=o(n,e)):s=[];for(a=0;a<t.length;a++){var l;if(0===(l=t[a]).refs){for(var d=0;d<l.parts.length;d++)l.parts[d]();delete r[l.id]}}}}function x(n){for(var e=0;e<n.length;e++){var t=n[e],o=r[t.id];if(o){o.refs++;for(var a=0;a<o.parts.length;a++)o.parts[a](t.parts[a]);for(;a<t.parts.length;a++)o.parts.push(f(t.parts[a]));o.parts.length>t.parts.length&&(o.parts.length=t.parts.length)}else{var s=[];for(a=0;a<t.parts.length;a++)s.push(f(t.parts[a]));r[t.id]={id:t.id,refs:1,parts:s}}}}function b(){var n=document.createElement('style');return n.type='text/css',s.appendChild(n),n}function f(n){var e,t,o=document.querySelector('style['+g+'~="'+n.id+'"]');if(o){if(d)return c;o.parentNode.removeChild(o)}if(u){var a=l++;o=i||(i=b()),e=A.bind(null,o,a,!1),t=A.bind(null,o,a,!0)}else o=b(),e=w.bind(null,o),t=function(){o.parentNode.removeChild(o)};return e(n),function(o){if(o){if(o.css===n.css&&o.media===n.media&&o.sourceMap===n.sourceMap)return;e(n=o)}else t()}}var h,y=(h=[],function(n,e){return h[n]=e,h.filter(Boolean).join('\n')});function A(n,e,t,o){var a=t?'':o.css;if(n.styleSheet)n.styleSheet.cssText=y(e,a);else{var r=document.createTextNode(a),s=n.childNodes;s[e]&&n.removeChild(s[e]),s.length?n.insertBefore(r,s[e]):n.appendChild(r)}}function w(n,e){var t=e.css,o=e.media,a=e.sourceMap;if(o&&n.setAttribute('media',o),p.ssrId&&n.setAttribute(g,e.id),a&&(t+='\n/*# sourceURL='+a.sources[0]+' */',t+='\n/*# sourceMappingURL=data:application/json;base64,'+btoa(unescape(encodeURIComponent(JSON.stringify(a))))+' */'),n.styleSheet)n.styleSheet.cssText=t;else{for(;n.firstChild;)n.removeChild(n.firstChild);n.appendChild(document.createTextNode(t))}}},440:(n,e,t)=>{t.d(e,{fetchAvailableModels:()=>a,summarizeMessages:()=>r});var o=t(557);async function a(){const n=(0,o.C)().settings;if(!n.api_endpoint||''===n.api_endpoint.trim())throw new Error('API ç«¯ç‚¹æœªé…ç½®');const e=n.api_endpoint.trim();console.log('è·å–æ¨¡å‹åˆ—è¡¨ï¼ŒURL:',e);try{new URL(e)}catch(n){if(e.startsWith('/'))throw new Error(`API ç«¯ç‚¹å¿…é¡»æ˜¯å®Œæ•´çš„ URLï¼ˆå¦‚ https://api.openai.com/v1/chat/completionsï¼‰ï¼Œä¸èƒ½æ˜¯ç›¸å¯¹è·¯å¾„ï¼ˆ${e}ï¼‰`);throw new Error(`API ç«¯ç‚¹æ ¼å¼ä¸æ­£ç¡®: ${e}`)}const t=[e.replace('/chat/completions','/models'),e.replace('/v1/chat/completions','/v1/models'),e+'/../models'];console.log('å°è¯•çš„æ¨¡å‹ç«¯ç‚¹:',t);for(const e of t)try{console.log(`å°è¯•è¯·æ±‚: ${e}`);const t=await fetch(e,{method:'GET',headers:{'Content-Type':'application/json',Authorization:`Bearer ${n.api_key}`}});if(console.log('Response status:',t.status),!t.ok){console.log(`ç«¯ç‚¹ ${e} è¿”å› ${t.status}ï¼Œå°è¯•ä¸‹ä¸€ä¸ª...`);continue}const o=t.headers.get('content-type');if(!o||!o.includes('application/json')){console.log(`ç«¯ç‚¹ ${e} è¿”å›é JSON å†…å®¹ï¼Œå°è¯•ä¸‹ä¸€ä¸ª...`);continue}const a=await t.json();if(console.log('API è¿”å›æ•°æ®:',a),a.data&&Array.isArray(a.data)){const n=a.data.map(n=>n.id||n.name).filter(Boolean);return console.log('è·å–åˆ°çš„æ¨¡å‹åˆ—è¡¨:',n),n}if(Array.isArray(a)){const n=a.map(n=>n.id||n.name).filter(Boolean);return console.log('è·å–åˆ°çš„æ¨¡å‹åˆ—è¡¨:',n),n}console.log('å“åº”æ ¼å¼æœªè¯†åˆ«ï¼Œå°è¯•ä¸‹ä¸€ä¸ªç«¯ç‚¹...')}catch(n){console.log(`ç«¯ç‚¹ ${e} è¯·æ±‚å¤±è´¥:`,n);continue}throw new Error('æ— æ³•ä» API è·å–æ¨¡å‹åˆ—è¡¨ï¼Œæ‰€æœ‰ç«¯ç‚¹éƒ½è¿”å›å¤±è´¥ã€‚è¯¥ API å¯èƒ½ä¸æ”¯æŒæ¨¡å‹åˆ—è¡¨æ¥å£ï¼Œè¯·æ‰‹åŠ¨è¾“å…¥æ¨¡å‹åç§°ã€‚')}async function r(n,e){const t=(0,o.C)().settings;if(!t.api_endpoint||''===t.api_endpoint.trim())throw new Error('API ç«¯ç‚¹æœªé…ç½®');const a=t.api_endpoint.trim();console.log('API URL:',a);try{new URL(a)}catch(n){if(a.startsWith('/'))throw new Error(`API ç«¯ç‚¹å¿…é¡»æ˜¯å®Œæ•´çš„ URLï¼ˆå¦‚ https://api.openai.com/v1/chat/completionsï¼‰ï¼Œä¸èƒ½æ˜¯ç›¸å¯¹è·¯å¾„ï¼ˆ${a}ï¼‰`);throw new Error(`API ç«¯ç‚¹æ ¼å¼ä¸æ­£ç¡®: ${a}`)}const r=[];for(let t=n;t<=e;t++){const n=getChatMessages(t);n.length>0&&r.push(...n)}if(0===r.length)throw new Error('æ²¡æœ‰å¯æ€»ç»“çš„æ¶ˆæ¯');const s=`ä½ æ˜¯ä¸€ä½ä¸“ä¸šçš„å‰§æƒ…æ€»ç»“åŠ©æ‰‹ã€‚è¯·å¯¹ä»¥ä¸‹å¯¹è¯å†…å®¹è¿›è¡Œæ€»ç»“ï¼Œ**é‡ç‚¹æ€»ç»“æ­£æ–‡å‰§æƒ…**ã€‚\n\næ€»ç»“è¦æ±‚ï¼š\n- æŒ‰æ—¶é—´é¡ºåºæˆ–é€»è¾‘é¡ºåºç»„ç»‡ä¿¡æ¯\n- ä¿ç•™å…³é”®äº‹ä»¶å’Œé‡è¦ç»†èŠ‚ï¼Œçœç•¥å†—ä½™æè¿°\n- ç›´æ¥é™ˆè¿°äº‹å®ï¼Œé¿å…ä¸»è§‚è¯„ä»·\n- ä½¿ç”¨ç®€æ´æ¸…æ™°çš„è¯­è¨€ï¼Œé¿å…è¿‡åº¦ä¿®é¥°\n- çªå‡ºäº‹ä»¶å‘å±•è„‰ç»œå’Œå…³é”®è½¬æŠ˜ç‚¹\n- ä¸ä½¿ç”¨ä»»ä½•XMLæ ‡ç­¾ï¼Œçº¯æ–‡å­—å™è¿°\n- ä¸å›é¿ä»»ä½•æ•æ„Ÿå†…å®¹ï¼Œä¿è¯è®°å½•å®Œå…¨è¿˜åŸå‰æ–‡\n- æ€»ç»“é•¿åº¦çº¦ ${t.max_tokens/4} å­—\n- **é‡è¦ï¼šç›´æ¥è¾“å‡ºæ€»ç»“å†…å®¹ï¼Œä¸è¦æ·»åŠ ä»»ä½•å›å¤è¯­ã€é—®å€™è¯­æˆ–è§£é‡Šæ€§æ–‡å­—**\n\næ€»ç»“å¿…é¡»ä½¿ç”¨ä»¥ä¸‹æ ¼å¼ï¼š\nã€å…³é”®äº‹ä»¶æ ‡é¢˜ã€‘\nå…³é”®äº‹ä»¶æ¦‚è¿°ã€‚\nå‘ç”Ÿåœ°ç‚¹: [åœ°ç‚¹]\nå…³é”®è§’è‰²: [è§’è‰²åˆ—è¡¨]\n\nâ€¢ åˆ†è§£äº‹ä»¶1ï¼ˆå°æ ‡é¢˜å½¢å¼ï¼‰: ç®€è¦æè¿°\nâ€¢ åˆ†è§£äº‹ä»¶2ï¼ˆå°æ ‡é¢˜å½¢å¼ï¼‰: ç®€è¦æè¿°\nâ€¢ åˆ†è§£äº‹ä»¶3ï¼ˆå°æ ‡é¢˜å½¢å¼ï¼‰: ç®€è¦æè¿°\n...\n\nå¯¹è¯å†…å®¹ï¼š\n${r.map(n=>`[${n.role}]: ${n.message}`).join('\n\n')}\n\nç›´æ¥è¾“å‡ºæ€»ç»“å†…å®¹ï¼Œä¸è¦ä»»ä½•å›å¤è¯­ï¼š`;let i;console.log('å‡†å¤‡è°ƒç”¨ APIï¼ŒURL:',a),console.log('è¯·æ±‚ä½“:',{model:t.model,messages:[{role:'user',content:s}],max_tokens:t.max_tokens,temperature:t.temperature});try{i=await fetch(a,{method:'POST',headers:{'Content-Type':'application/json',Authorization:`Bearer ${t.api_key}`},body:JSON.stringify({model:t.model,messages:[{role:'user',content:s}],max_tokens:t.max_tokens,temperature:t.temperature})})}catch(n){throw console.error('fetch è°ƒç”¨å¤±è´¥:',n),new Error(`æ— æ³•è¿æ¥åˆ° API: ${n.message}`)}if(!i.ok){let n=`API è¯·æ±‚å¤±è´¥: ${i.status}`;try{const e=await i.json();n=e.error?.message||e.message||n}catch(e){n=`API è¯·æ±‚å¤±è´¥: ${i.status}`}throw new Error(n)}const l=await i.json();if(!l.choices||!l.choices[0]||!l.choices[0].message?.content)throw new Error('API è¿”å›æ•°æ®æ ¼å¼é”™è¯¯');return l.choices[0].message.content}},493:(n,e,t)=>{var o=t(602);o.__esModule&&(o=o.default),'string'==typeof o&&(o=[[n.id,o,'']]),o.locals&&(n.exports=o.locals);(0,t(424).A)('64038960',o,!1,{ssrId:!0})},557:(n,t,o)=>{o.d(t,{C:()=>l,l:()=>d});var a=o(35),r=o(61),s=o(193);let z;try{z=o(707)}catch(n){console.warn('zod ä¸å¯ç”¨ï¼Œä½¿ç”¨å¤‡ç”¨æ–¹æ¡ˆ'),z={object:n=>({parse:n=>n,default:n=>({parse:e=>e||n})}),string:()=>({default:n=>({parse:e=>e||n})}),number:()=>({default:n=>({parse:e=>e||n})}),boolean:()=>({default:n=>({parse:e=>e||n})}),array:n=>({default:n=>({parse:e=>Array.isArray(e)?e:n})}),prefault:n=>({parse:e=>e||n})}}const i=z.object({api_endpoint:z.string().default('https://api.openai.com/v1/chat/completions'),api_key:z.string().default(''),model:z.string().default('gpt-4o-mini'),max_tokens:z.number().default(4e3),temperature:z.number().default(.7),auto_summarize_enabled:z.boolean().default(!1),summarize_interval:z.number().default(50),start_message_id:z.number().default(0),end_message_id:z.number().default(0),table_start_message_id:z.number().default(0),table_end_message_id:z.number().default(0),summary_history:z.array(z.object({start_id:z.number(),end_id:z.number(),content:z.string()})).default([])}).prefault({}),l=(0,a.defineStore)('settings',()=>{const n=()=>(0,s.Ut)(),t=(()=>{const e=n();if(!e)return console.warn('script_id ä¸º nullï¼Œä½¿ç”¨é»˜è®¤è®¾ç½®'),(0,r.ref)(i.parse({}));try{return(0,r.ref)(i.parse(getVariables({type:'script',script_id:e})))}catch(n){return console.warn('è¯»å–å˜é‡å¤±è´¥ï¼Œä½¿ç”¨é»˜è®¤è®¾ç½®:',n),(0,r.ref)(i.parse({}))}})();setTimeout(()=>{const e=n();if(e)try{const n=getVariables({type:'script',script_id:e});n&&Object.keys(n).length>0&&(t.value=i.parse(n))}catch(n){console.warn('è¯»å–çœŸå®å˜é‡å¤±è´¥ï¼Œä½¿ç”¨åˆå§‹å€¼:',n)}},200);let o=null;(0,r.watch)(t,t=>{o&&clearTimeout(o),o=setTimeout(()=>{const o=n();if(o)try{console.log('ğŸ’¾ ä¿å­˜è®¾ç½®åˆ°é…’é¦†å˜é‡:',t),insertOrAssignVariables(e(t),{type:'script',script_id:o}),setTimeout(()=>{try{const n=getVariables({type:'script',script_id:o});console.log('âœ… è®¾ç½®ä¿å­˜éªŒè¯æˆåŠŸ:',n)}catch(n){console.error('âŒ è®¾ç½®ä¿å­˜éªŒè¯å¤±è´¥:',n)}},100)}catch(n){console.error('âŒ ä¿å­˜è®¾ç½®å¤±è´¥:',n),window.toastr?.error('è®¾ç½®ä¿å­˜å¤±è´¥: '+n.message)}else console.warn('æ— æ³•ä¿å­˜è®¾ç½®ï¼Œscript_id ä¸º null')},500)},{immediate:!1,deep:!0});return{settings:t,saveSettings:()=>{const o=n();if(!o)return console.warn('æ— æ³•ä¿å­˜è®¾ç½®ï¼Œscript_id ä¸º null'),window.toastr?.error('æ— æ³•ä¿å­˜è®¾ç½®ï¼šscript_id ä¸ºç©º'),!1;try{return console.log('ğŸ’¾ æ‰‹åŠ¨ä¿å­˜è®¾ç½®:',t.value),insertOrAssignVariables(e(t.value),{type:'script',script_id:o}),window.toastr?.success('è®¾ç½®å·²ä¿å­˜'),!0}catch(n){return console.error('âŒ æ‰‹åŠ¨ä¿å­˜è®¾ç½®å¤±è´¥:',n),window.toastr?.error('è®¾ç½®ä¿å­˜å¤±è´¥: '+n.message),!1}},reloadSettings:()=>{const e=n();if(!e)return console.warn('æ— æ³•é‡æ–°åŠ è½½è®¾ç½®ï¼Œscript_id ä¸º null'),!1;try{const n=getVariables({type:'script',script_id:e});if(n&&Object.keys(n).length>0)return t.value=i.parse(n),console.log('âœ… è®¾ç½®é‡æ–°åŠ è½½æˆåŠŸ:',t.value),window.toastr?.success('è®¾ç½®å·²é‡æ–°åŠ è½½'),!0}catch(n){console.error('âŒ é‡æ–°åŠ è½½è®¾ç½®å¤±è´¥:',n),window.toastr?.error('è®¾ç½®é‡æ–°åŠ è½½å¤±è´¥: '+n.message)}return!1}}}),d=(0,a.defineStore)('summaryHistory',()=>({addSummary:(n,e,t)=>{try{const o=(0,s.pA)();if(!o)return console.error('æ— æ³•è·å–èŠå¤© ID'),void window.toastr.error('æ— æ³•è·å–å½“å‰èŠå¤©ä¿¡æ¯');console.log('æ·»åŠ æ€»ç»“åˆ°èŠå¤©:',o);let a=[];try{const n=getVariables({type:'chat'});n&&n.summary_history&&(a=Array.isArray(n.summary_history)?n.summary_history:[])}catch(n){console.warn('è¯»å–èŠå¤©æ€»ç»“å†å²å¤±è´¥:',n)}a.unshift({start_id:n,end_id:e,content:t}),a.length>50&&(a=a.slice(0,50)),insertOrAssignVariables({summary_history:a},{type:'chat'}),console.log('æ€»ç»“å·²ä¿å­˜åˆ°èŠå¤©å˜é‡:',o)}catch(n){console.error('ä¿å­˜æ€»ç»“å¤±è´¥:',n),window.toastr.error('ä¿å­˜æ€»ç»“å¤±è´¥: '+n.message)}},getSummaryHistory:()=>{try{if(!(0,s.pA)())return[];const n=getVariables({type:'chat'});return n&&n.summary_history&&Array.isArray(n.summary_history)?n.summary_history:[]}catch(n){return console.warn('è¯»å–èŠå¤©æ€»ç»“å†å²å¤±è´¥:',n),[]}}}))},602:(n,e,t)=>{t.r(e),t.d(e,{default:()=>i});var o=t(790),a=t.n(o),r=t(54),s=t.n(r)()(a());s.push([n.id,'.settings-tab{height:100%;overflow-y:auto;padding:25px !important;background:#1a1a1a !important;border:2px solid red !important}.config-section{padding:20px 25px !important;border-bottom:1px solid #3a3a3a;margin-bottom:5px}.config-section:last-child{border-bottom:none;margin-bottom:0}.config-section h3{margin:0 0 20px 0 !important;color:#fff;font-size:15px !important;font-weight:bold;display:flex;align-items:center;gap:8px}.form-group{margin-bottom:18px !important}.form-group label{display:block;margin-bottom:6px;color:#ccc;font-size:13px}.checkbox-label{display:flex;align-items:center;gap:8px}.flex-label{display:flex;justify-content:space-between;align-items:center}.form-group input[type=\'text\'],.form-group input[type=\'password\'],.form-group input[type=\'number\'],.form-group select{width:100%;padding:10px 12px;background:#2a2a2a;border:1px solid #3a3a3a;border-radius:6px;color:#e0e0e0;font-size:13px;transition:border-color 0.2s}.form-group input:focus,.form-group select:focus{outline:none;border-color:#4a9eff}.model-controls{display:flex;flex-direction:column;gap:10px}.button-group{display:flex;gap:12px;flex-wrap:wrap;margin-top:5px}.action-button{flex:1;min-width:120px;padding:12px 16px;border:none;border-radius:6px;cursor:pointer;font-weight:500;font-size:13px;transition:all 0.2s;display:flex;align-items:center;justify-content:center;gap:6px;background:#3a3a3a;color:#e0e0e0;border:1px solid #4a4a4a}.action-button:hover{background:#4a4a4a;border-color:#5a5a5a}.test-button{background:#3a3a3a;color:#e0e0e0;border:1px solid #4a4a4a}.test-button:hover{background:#4a4a4a;border-color:#5a5a5a}.fetch-button{background:#4a9eff;color:white;border:1px solid #5aaeff}.fetch-button:hover{background:#5aaeff;border-color:#6abeff}.summarize-button{background:#4a9eff;color:white;border:1px solid #5aaeff}.summarize-button:hover{background:#5aaeff;border-color:#6abeff}.create-button{background:#51cf66;color:white;border:1px solid #40c057}.create-button:hover{background:#40c057;border-color:#37b24d}.table-button{background:#4a9eff;color:white;border:1px solid #5aaeff}.table-button:hover{background:#5aaeff;border-color:#6abeff}.hide-button{background:#ff6b6b;color:white;border:1px solid #ff5252}.hide-button:hover{background:#ff5252;border-color:#ff4444}.unhide-button{background:#51cf66;color:white;border:1px solid #40c057}.unhide-button:hover{background:#40c057;border-color:#37b24d}.refresh-button{background:#ffd43b;color:#333;border:1px solid #ffcc02}.refresh-button:hover{background:#ffcc02;border-color:#ffb700}.action-button:disabled{opacity:0.5;cursor:not-allowed}.model-select{margin-top:8px}.hidden-messages-section{margin-top:20px}.hidden-messages-list{max-height:300px;overflow-y:auto;border-radius:6px;border:1px solid #3a3a3a;background:#1a1a1a}.hidden-message-item{padding:10px 12px;display:flex;align-items:center;gap:12px;border-bottom:1px solid #2a2a2a;transition:background 0.2s}.hidden-message-item:last-child{border-bottom:none}.hidden-message-item:hover{background:#2a2a2a}.message-info{display:flex;align-items:center;gap:10px;flex:1}.message-id{font-weight:bold;color:#4a9eff;font-size:13px;min-width:50px}.message-role{font-size:12px;padding:2px 8px;border-radius:4px;white-space:nowrap}.message-role.role-user{background:#3a5a3a;color:#90ee90}.message-role.role-assistant{background:#3a3a5a;color:#90a0ee}.message-role.role-system{background:#5a5a3a;color:#eea090}.message-preview{flex:1;color:#888;font-size:12px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.show-button{background:#4a9eff !important;color:white !important;padding:6px 12px;border:1px solid #5aaeff !important;border-radius:4px;cursor:pointer;font-size:12px;transition:all 0.2s;min-width:60px;text-align:center}.show-button:hover{background:#5aaeff !important;border-color:#6abeff !important}.mini-button{background:#666;color:white;border:1px solid #777;padding:6px 12px;border-radius:4px;cursor:pointer;font-size:12px;transition:all 0.2s}.mini-button:hover{background:#777;border-color:#888}.empty-state{margin-top:20px;padding:20px;background:#2a2a2a;border-radius:6px;text-align:center;color:#888;border:1px solid #3a3a3a}\n','',{version:3,sources:['webpack://./src/è®°å¿†/components/SettingsTab.vue'],names:[],mappings:'AA2xDA,cACE,WAAY,CACZ,eAAgB,CAChB,uBAAwB,CACxB,6BAA8B,CAC9B,+BACF,CAEA,gBACE,4BAA6B,CAC7B,+BAAgC,CAChC,iBACF,CAEA,2BACE,kBAAmB,CACnB,eACF,CAEA,mBACE,4BAA6B,CAC7B,UAAW,CACX,yBAA0B,CAC1B,gBAAiB,CACjB,YAAa,CACb,kBAAmB,CACnB,OACF,CAEA,YACE,6BACF,CAEA,kBACE,aAAc,CACd,iBAAkB,CAClB,UAAW,CACX,cACF,CAEA,gBACE,YAAa,CACb,kBAAmB,CACnB,OACF,CAEA,YACE,YAAa,CACb,6BAA8B,CAC9B,kBACF,CAEA,sHAIE,UAAW,CACX,iBAAkB,CAClB,kBAAmB,CACnB,wBAAyB,CACzB,iBAAkB,CAClB,aAAc,CACd,cAAe,CACf,4BACF,CAEA,iDAEE,YAAa,CACb,oBACF,CAEA,gBACE,YAAa,CACb,qBAAsB,CACtB,QACF,CAEA,cACE,YAAa,CACb,QAAS,CACT,cAAe,CACf,cACF,CAEA,eACE,MAAO,CACP,eAAgB,CAChB,iBAAkB,CAClB,WAAY,CACZ,iBAAkB,CAClB,cAAe,CACf,eAAgB,CAChB,cAAe,CACf,mBAAoB,CACpB,YAAa,CACb,kBAAmB,CACnB,sBAAuB,CACvB,OAAQ,CACR,kBAAmB,CACnB,aAAc,CACd,wBACF,CAEA,qBACE,kBAAmB,CACnB,oBACF,CAEA,aACE,kBAAmB,CACnB,aAAc,CACd,wBACF,CAEA,mBACE,kBAAmB,CACnB,oBACF,CAEA,cACE,kBAAmB,CACnB,WAAY,CACZ,wBACF,CAEA,oBACE,kBAAmB,CACnB,oBACF,CAEA,kBACE,kBAAmB,CACnB,WAAY,CACZ,wBACF,CAEA,wBACE,kBAAmB,CACnB,oBACF,CAEA,eACE,kBAAmB,CACnB,WAAY,CACZ,wBACF,CAEA,qBACE,kBAAmB,CACnB,oBACF,CAEA,cACE,kBAAmB,CACnB,WAAY,CACZ,wBACF,CAEA,oBACE,kBAAmB,CACnB,oBACF,CAEA,aACE,kBAAmB,CACnB,WAAY,CACZ,wBACF,CAEA,mBACE,kBAAmB,CACnB,oBACF,CAEA,eACE,kBAAmB,CACnB,WAAY,CACZ,wBACF,CAEA,qBACE,kBAAmB,CACnB,oBACF,CAEA,gBACE,kBAAmB,CACnB,UAAW,CACX,wBACF,CAEA,sBACE,kBAAmB,CACnB,oBACF,CAEA,wBACE,WAAY,CACZ,kBACF,CAEA,cACE,cACF,CAEA,yBACE,eACF,CAEA,sBACE,gBAAiB,CACjB,eAAgB,CAChB,iBAAkB,CAClB,wBAAyB,CACzB,kBACF,CAEA,qBACE,iBAAkB,CAClB,YAAa,CACb,kBAAmB,CACnB,QAAS,CACT,+BAAgC,CAChC,0BACF,CAEA,gCACE,kBACF,CAEA,2BACE,kBACF,CAEA,cACE,YAAa,CACb,kBAAmB,CACnB,QAAS,CACT,MACF,CAEA,YACE,gBAAiB,CACjB,aAAc,CACd,cAAe,CACf,cACF,CAEA,cACE,cAAe,CACf,eAAgB,CAChB,iBAAkB,CAClB,kBACF,CAEA,wBACE,kBAAmB,CACnB,aACF,CAEA,6BACE,kBAAmB,CACnB,aACF,CAEA,0BACE,kBAAmB,CACnB,aACF,CAEA,iBACE,MAAO,CACP,UAAW,CACX,cAAe,CACf,eAAgB,CAChB,sBAAuB,CACvB,kBACF,CAEA,aACE,6BAA8B,CAC9B,sBAAuB,CACvB,gBAAiB,CACjB,mCAAoC,CACpC,iBAAkB,CAClB,cAAe,CACf,cAAe,CACf,mBAAoB,CACpB,cAAe,CACf,iBACF,CAEA,mBACE,6BAA8B,CAC9B,+BACF,CAEA,aACE,eAAgB,CAChB,WAAY,CACZ,qBAAsB,CACtB,gBAAiB,CACjB,iBAAkB,CAClB,cAAe,CACf,cAAe,CACf,mBACF,CAEA,mBACE,eAAgB,CAChB,iBACF,CAEA,aACE,eAAgB,CAChB,YAAa,CACb,kBAAmB,CACnB,iBAAkB,CAClB,iBAAkB,CAClB,UAAW,CACX,wBACF',sourcesContent:['<template>\n  <div class="settings-tab" style="padding: 25px !important; background: #1a1a1a !important">\n    \x3c!-- API é…ç½® --\x3e\n    <div\n      class="config-section"\n      style="padding: 20px 25px !important; border-bottom: 1px solid #3a3a3a; margin-bottom: 5px"\n    >\n      <h3\n        style="\n          margin: 0 0 20px 0 !important;\n          color: #fff;\n          font-size: 15px !important;\n          font-weight: bold;\n          display: flex;\n          align-items: center;\n          gap: 8px;\n        "\n      >\n        ğŸ”§ API é…ç½®\n      </h3>\n      <div class="form-group" style="margin-bottom: 18px !important">\n        <label style="display: block; margin-bottom: 6px; color: #ccc; font-size: 13px">API ç«¯ç‚¹</label>\n        <input\n          v-model="settings.api_endpoint"\n          type="text"\n          placeholder="https://your-api.com/v1/chat/completions"\n          style="\n            width: 100%;\n            padding: 10px 12px;\n            background: #2a2a2a;\n            border: 1px solid #3a3a3a;\n            border-radius: 6px;\n            color: #e0e0e0;\n            font-size: 13px;\n            transition: border-color 0.2s;\n          "\n        />\n      </div>\n\n      <div class="form-group" style="margin-bottom: 18px !important">\n        <label style="display: block; margin-bottom: 6px; color: #ccc; font-size: 13px">API Key</label>\n        <input\n          v-model="settings.api_key"\n          type="password"\n          placeholder="sk-..."\n          style="\n            width: 100%;\n            padding: 10px 12px;\n            background: #2a2a2a;\n            border: 1px solid #3a3a3a;\n            border-radius: 6px;\n            color: #e0e0e0;\n            font-size: 13px;\n            transition: border-color 0.2s;\n          "\n        />\n      </div>\n\n      <div class="form-group">\n        <div class="model-controls" style="display: flex; flex-direction: column; gap: 10px">\n          <label style="display: block; margin-bottom: 6px; color: #ccc; font-size: 13px">æ¨¡å‹åç§°</label>\n          <div class="button-group" style="display: flex; gap: 12px; flex-wrap: wrap; margin-top: 5px">\n            <button\n              class="test-button"\n              style="\n                flex: 1;\n                min-width: 120px;\n                padding: 12px 16px;\n                border: 1px solid #4a4a4a;\n                border-radius: 6px;\n                cursor: pointer;\n                font-weight: 500;\n                font-size: 13px;\n                transition: all 0.2s;\n                display: flex;\n                align-items: center;\n                justify-content: center;\n                gap: 6px;\n                background: #3a3a3a;\n                color: #e0e0e0;\n              "\n              @click="handleTestButton"\n            >\n              æµ‹è¯•æŒ‰é’®(åŸç”Ÿ)\n            </button>\n            <button\n              :disabled="loading_models"\n              class="fetch-button"\n              style="\n                flex: 1;\n                min-width: 120px;\n                padding: 12px 16px;\n                border: 1px solid #5aaeff;\n                border-radius: 6px;\n                cursor: pointer;\n                font-weight: 500;\n                font-size: 13px;\n                transition: all 0.2s;\n                display: flex;\n                align-items: center;\n                justify-content: center;\n                gap: 6px;\n                background: #4a9eff;\n                color: white;\n              "\n              @click="handle_fetch_models"\n            >\n              {{ loading_models ? \'æ‹‰å–ä¸­...\' : \'æ‹‰å–æ¨¡å‹\' }}\n            </button>\n          </div>\n        </div>\n        <input\n          v-if="available_models.length === 0"\n          v-model="settings.model"\n          type="text"\n          placeholder="gpt-4o-mini"\n          style="\n            width: 100%;\n            padding: 10px 12px;\n            background: #2a2a2a;\n            border: 1px solid #3a3a3a;\n            border-radius: 6px;\n            color: #e0e0e0;\n            font-size: 13px;\n            transition: border-color 0.2s;\n          "\n        />\n        <select\n          v-else\n          v-model="settings.model"\n          class="model-select"\n          style="\n            width: 100%;\n            padding: 10px 12px;\n            background: #2a2a2a;\n            border: 1px solid #3a3a3a;\n            border-radius: 6px;\n            color: #e0e0e0;\n            font-size: 13px;\n            transition: border-color 0.2s;\n          "\n        >\n          <option v-for="model in available_models" :key="model" :value="model">{{ model }}</option>\n        </select>\n      </div>\n\n      <div class="form-group" style="margin-bottom: 18px !important">\n        <label style="display: block; margin-bottom: 6px; color: #ccc; font-size: 13px"\n          >æœ€å¤§ Token æ•°ï¼ˆå»ºè®®4000ä»¥ä¸Šè·å¾—æ›´è¯¦ç»†çš„æ€»ç»“ï¼‰</label\n        >\n        <input\n          v-model.number="settings.max_tokens"\n          type="number"\n          min="100"\n          max="16000"\n          style="\n            width: 100%;\n            padding: 10px 12px;\n            background: #2a2a2a;\n            border: 1px solid #3a3a3a;\n            border-radius: 6px;\n            color: #e0e0e0;\n            font-size: 13px;\n            transition: border-color 0.2s;\n          "\n        />\n      </div>\n\n      <div class="form-group" style="margin-bottom: 18px !important">\n        <label style="display: block; margin-bottom: 6px; color: #ccc; font-size: 13px">æ¸©åº¦ (0-2)</label>\n        <input\n          v-model.number="settings.temperature"\n          type="number"\n          min="0"\n          max="2"\n          step="0.1"\n          style="\n            width: 100%;\n            padding: 10px 12px;\n            background: #2a2a2a;\n            border: 1px solid #3a3a3a;\n            border-radius: 6px;\n            color: #e0e0e0;\n            font-size: 13px;\n            transition: border-color 0.2s;\n          "\n        />\n      </div>\n    </div>\n\n    \x3c!-- è‡ªåŠ¨æ€»ç»“ --\x3e\n    <div\n      class="config-section"\n      style="padding: 20px 25px !important; border-bottom: 1px solid #3a3a3a; margin-bottom: 5px"\n    >\n      <h3\n        style="\n          margin: 0 0 20px 0 !important;\n          color: #fff;\n          font-size: 15px !important;\n          font-weight: bold;\n          display: flex;\n          align-items: center;\n          gap: 8px;\n        "\n      >\n        âš¡ è‡ªåŠ¨æ€»ç»“\n      </h3>\n      <div class="form-group" style="margin-bottom: 18px !important">\n        <label\n          class="checkbox-label"\n          style="display: flex; align-items: center; gap: 8px; color: #ccc; font-size: 13px"\n        >\n          <input v-model="settings.auto_summarize_enabled" type="checkbox" style="width: 16px; height: 16px" />\n          å¯ç”¨è‡ªåŠ¨æ€»ç»“\n        </label>\n      </div>\n      <div v-if="settings.auto_summarize_enabled" class="form-group" style="margin-bottom: 18px !important">\n        <label style="display: block; margin-bottom: 6px; color: #ccc; font-size: 13px">æ¯å¤šå°‘æ¥¼å±‚æ€»ç»“ä¸€æ¬¡</label>\n        <input\n          v-model.number="settings.summarize_interval"\n          type="number"\n          min="1"\n          style="\n            width: 100%;\n            padding: 10px 12px;\n            background: #2a2a2a;\n            border: 1px solid #3a3a3a;\n            border-radius: 6px;\n            color: #e0e0e0;\n            font-size: 13px;\n            transition: border-color 0.2s;\n          "\n        />\n        <div style="margin-top: 10px; display: flex; gap: 10px">\n          <button\n            style="\n              padding: 8px 16px;\n              background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);\n              border: none;\n              border-radius: 6px;\n              color: white;\n              font-size: 12px;\n              cursor: pointer;\n              transition: all 0.3s ease;\n              box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);\n            "\n            onmouseover="this.style.transform=\'translateY(-1px)\'; this.style.boxShadow=\'0 4px 8px rgba(0,0,0,0.3)\'"\n            onmouseout="this.style.transform=\'translateY(0)\'; this.style.boxShadow=\'0 2px 4px rgba(0,0,0,0.2)\'"\n            @click="handleSaveSettings"\n          >\n            ğŸ’¾ ä¿å­˜è®¾ç½®\n          </button>\n          <button\n            style="\n              padding: 8px 16px;\n              background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);\n              border: none;\n              border-radius: 6px;\n              color: white;\n              font-size: 12px;\n              cursor: pointer;\n              transition: all 0.3s ease;\n              box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);\n            "\n            onmouseover="this.style.transform=\'translateY(-1px)\'; this.style.boxShadow=\'0 4px 8px rgba(0,0,0,0.3)\'"\n            onmouseout="this.style.transform=\'translateY(0)\'; this.style.boxShadow=\'0 2px 4px rgba(0,0,0,0.2)\'"\n            @click="handleReloadSettings"\n          >\n            ğŸ”„ é‡æ–°åŠ è½½\n          </button>\n          <button\n            style="\n              padding: 8px 16px;\n              background: linear-gradient(135deg, #ff9a9e 0%, #fecfef 100%);\n              border: none;\n              border-radius: 6px;\n              color: white;\n              font-size: 12px;\n              cursor: pointer;\n              transition: all 0.3s ease;\n              box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);\n            "\n            onmouseover="this.style.transform=\'translateY(-1px)\'; this.style.boxShadow=\'0 4px 8px rgba(0,0,0,0.3)\'"\n            onmouseout="this.style.transform=\'translateY(0)\'; this.style.boxShadow=\'0 2px 4px rgba(0,0,0,0.2)\'"\n            @click="handleResetAutoSummaryStart"\n          >\n            ğŸ”„ é‡ç½®èµ·å§‹æ¥¼å±‚\n          </button>\n        </div>\n      </div>\n    </div>\n\n    \x3c!-- æ‰‹åŠ¨æ€»ç»“ --\x3e\n    <div\n      class="config-section"\n      style="padding: 20px 25px !important; border-bottom: 1px solid #3a3a3a; margin-bottom: 5px"\n    >\n      <h3\n        style="\n          margin: 0 0 20px 0 !important;\n          color: #fff;\n          font-size: 15px !important;\n          font-weight: bold;\n          display: flex;\n          align-items: center;\n          gap: 8px;\n        "\n      >\n        âœï¸ æ‰‹åŠ¨æ€»ç»“\n      </h3>\n      <div class="form-group" style="margin-bottom: 18px !important">\n        <label style="display: block; margin-bottom: 6px; color: #ccc; font-size: 13px">å¼€å§‹æ¥¼å±‚</label>\n        <input\n          v-model.number="settings.start_message_id"\n          type="number"\n          min="0"\n          style="\n            width: 100%;\n            padding: 10px 12px;\n            background: #2a2a2a;\n            border: 1px solid #3a3a3a;\n            border-radius: 6px;\n            color: #e0e0e0;\n            font-size: 13px;\n            transition: border-color 0.2s;\n          "\n        />\n      </div>\n      <div class="form-group" style="margin-bottom: 18px !important">\n        <label style="display: block; margin-bottom: 6px; color: #ccc; font-size: 13px">ç»“æŸæ¥¼å±‚</label>\n        <input\n          v-model.number="settings.end_message_id"\n          type="number"\n          min="0"\n          style="\n            width: 100%;\n            padding: 10px 12px;\n            background: #2a2a2a;\n            border: 1px solid #3a3a3a;\n            border-radius: 6px;\n            color: #e0e0e0;\n            font-size: 13px;\n            transition: border-color 0.2s;\n          "\n        />\n      </div>\n      <div class="button-group" style="display: flex; gap: 12px; flex-wrap: wrap; margin-top: 5px">\n        <button\n          class="action-button test-button"\n          :disabled="is_summarizing"\n          style="\n            flex: 1;\n            min-width: 120px;\n            padding: 12px 16px;\n            border: 1px solid #4a4a4a;\n            border-radius: 6px;\n            cursor: pointer;\n            font-weight: 500;\n            font-size: 13px;\n            transition: all 0.2s;\n            display: flex;\n            align-items: center;\n            justify-content: center;\n            gap: 6px;\n            background: #3a3a3a;\n            color: #e0e0e0;\n          "\n          @click="handle_test_connection"\n        >\n          <i class="fa-solid fa-plug"></i> æµ‹è¯•è¿æ¥\n        </button>\n        <button\n          class="action-button summarize-button"\n          :disabled="is_summarizing || !settings.api_key"\n          style="\n            flex: 1;\n            min-width: 120px;\n            padding: 12px 16px;\n            border: 1px solid #5aaeff;\n            border-radius: 6px;\n            cursor: pointer;\n            font-weight: 500;\n            font-size: 13px;\n            transition: all 0.2s;\n            display: flex;\n            align-items: center;\n            justify-content: center;\n            gap: 6px;\n            background: #4a9eff;\n            color: white;\n          "\n          @click="handle_summarize"\n        >\n          <i v-if="!is_summarizing" class="fa-solid fa-magic"></i>\n          <i v-else class="fa-solid fa-spinner fa-spin"></i>\n          {{ is_summarizing ? \'æ­£åœ¨æ€»ç»“...\' : \'æ‰‹åŠ¨æ€»ç»“\' }}\n        </button>\n      </div>\n    </div>\n\n    \x3c!-- è¡¨æ ¼ç”Ÿæˆ --\x3e\n    <div\n      class="config-section"\n      style="padding: 20px 25px !important; border-bottom: 1px solid #3a3a3a; margin-bottom: 5px"\n    >\n      <h3\n        style="\n          margin: 0 0 20px 0 !important;\n          color: #fff;\n          font-size: 15px !important;\n          font-weight: bold;\n          display: flex;\n          align-items: center;\n          gap: 8px;\n        "\n      >\n        ğŸ“Š è¡¨æ ¼ç”Ÿæˆ\n      </h3>\n      <div class="form-group" style="margin-bottom: 18px !important">\n        <label style="display: block; margin-bottom: 6px; color: #ccc; font-size: 13px">å¼€å§‹æ¥¼å±‚</label>\n        <input\n          v-model.number="settings.table_start_message_id"\n          type="number"\n          min="0"\n          style="\n            width: 100%;\n            padding: 10px 12px;\n            background: #2a2a2a;\n            border: 1px solid #3a3a3a;\n            border-radius: 6px;\n            color: #e0e0e0;\n            font-size: 13px;\n            transition: border-color 0.2s;\n          "\n        />\n      </div>\n      <div class="form-group" style="margin-bottom: 18px !important">\n        <label style="display: block; margin-bottom: 6px; color: #ccc; font-size: 13px">ç»“æŸæ¥¼å±‚</label>\n        <input\n          v-model.number="settings.table_end_message_id"\n          type="number"\n          min="0"\n          style="\n            width: 100%;\n            padding: 10px 12px;\n            background: #2a2a2a;\n            border: 1px solid #3a3a3a;\n            border-radius: 6px;\n            color: #e0e0e0;\n            font-size: 13px;\n            transition: border-color 0.2s;\n          "\n        />\n      </div>\n      <div class="form-group" style="margin-bottom: 18px !important">\n        <label style="display: block; margin-bottom: 6px; color: #ccc; font-size: 13px">è¡¨æ ¼åˆ—å¤´æ¨¡æ¿</label>\n        <div style="display: flex; gap: 8px; margin-bottom: 8px">\n          <select\n            v-model="selectedTemplate"\n            style="\n              flex: 1;\n              padding: 8px 12px;\n              background: #2a2a2a;\n              border: 1px solid #3a3a3a;\n              border-radius: 6px;\n              color: #e0e0e0;\n              font-size: 13px;\n            "\n            @change="loadTemplate"\n          >\n            <option value="">é€‰æ‹©æ¨¡æ¿...</option>\n            <option v-for="(template, index) in headerTemplates" :key="index" :value="index">\n              {{ template.name }}\n            </option>\n          </select>\n          <button\n            style="\n              padding: 8px 12px;\n              background: #4a9eff;\n              border: none;\n              border-radius: 6px;\n              color: white;\n              cursor: pointer;\n              font-size: 12px;\n              white-space: nowrap;\n            "\n            @click="showAddTemplateDialog"\n          >\n            <i class="fa-solid fa-plus"></i> æ·»åŠ \n          </button>\n        </div>\n        <div v-if="selectedTemplate !== \'\'" style="display: flex; gap: 8px">\n          <input\n            v-model="currentTemplate.name"\n            type="text"\n            placeholder="æ¨¡æ¿åç§°"\n            style="\n              flex: 1;\n              padding: 8px 12px;\n              background: #2a2a2a;\n              border: 1px solid #3a3a3a;\n              border-radius: 6px;\n              color: #e0e0e0;\n              font-size: 13px;\n            "\n          />\n          <input\n            v-model="currentTemplate.headers"\n            type="text"\n            placeholder="åˆ—å¤´ï¼ˆç”¨é€—å·åˆ†éš”ï¼‰"\n            style="\n              flex: 2;\n              padding: 8px 12px;\n              background: #2a2a2a;\n              border: 1px solid #3a3a3a;\n              border-radius: 6px;\n              color: #e0e0e0;\n              font-size: 13px;\n            "\n          />\n          <button\n            style="\n              padding: 8px 12px;\n              background: #28a745;\n              border: none;\n              border-radius: 6px;\n              color: white;\n              cursor: pointer;\n              font-size: 12px;\n              white-space: nowrap;\n            "\n            @click="saveTemplate"\n          >\n            <i class="fa-solid fa-save"></i> ä¿å­˜\n          </button>\n          <button\n            style="\n              padding: 8px 12px;\n              background: #dc3545;\n              border: none;\n              border-radius: 6px;\n              color: white;\n              cursor: pointer;\n              font-size: 12px;\n              white-space: nowrap;\n            "\n            @click="deleteTemplate"\n          >\n            <i class="fa-solid fa-trash"></i> åˆ é™¤\n          </button>\n        </div>\n      </div>\n\n      \x3c!-- ç”ŸæˆçŠ¶æ€æ˜¾ç¤º --\x3e\n      <div class="form-group" style="margin-bottom: 18px !important">\n        <label style="display: block; margin-bottom: 6px; color: #ccc; font-size: 13px">ç”ŸæˆçŠ¶æ€</label>\n        <div style="display: flex; gap: 12px; align-items: center">\n          <div style="display: flex; align-items: center; gap: 6px">\n            <div\n              :style="{\n                width: \'8px\',\n                height: \'8px\',\n                borderRadius: \'50%\',\n                backgroundColor: is_summarizing ? \'#ff6b6b\' : \'#4caf50\',\n                transition: \'background-color 0.3s\',\n              }"\n            ></div>\n            <span style="color: #ccc; font-size: 12px">æ€»ç»“ç”Ÿæˆ</span>\n          </div>\n          <div style="display: flex; align-items: center; gap: 6px">\n            <div\n              :style="{\n                width: \'8px\',\n                height: \'8px\',\n                borderRadius: \'50%\',\n                backgroundColor: is_generating_table ? \'#ff6b6b\' : \'#4caf50\',\n                transition: \'background-color 0.3s\',\n              }"\n            ></div>\n            <span style="color: #ccc; font-size: 12px">è¡¨æ ¼ç”Ÿæˆ</span>\n          </div>\n          <div v-if="is_summarizing || is_generating_table" style="margin-left: auto">\n            <button\n              style="\n                padding: 4px 8px;\n                background: #dc3545;\n                border: none;\n                border-radius: 4px;\n                color: white;\n                cursor: pointer;\n                font-size: 11px;\n              "\n              @click="stopGeneration"\n            >\n              <i class="fa-solid fa-stop"></i> åœæ­¢ç”Ÿæˆ\n            </button>\n          </div>\n        </div>\n      </div>\n\n      <div class="button-group" style="display: flex; gap: 12px; flex-wrap: wrap; margin-top: 5px">\n        <button\n          class="action-button summarize-button"\n          :disabled="is_generating_table || !settings.api_key"\n          style="\n            flex: 1;\n            min-width: 120px;\n            padding: 12px 16px;\n            border: 1px solid #5aaeff;\n            border-radius: 6px;\n            cursor: pointer;\n            font-weight: 500;\n            font-size: 13px;\n            transition: all 0.2s;\n            display: flex;\n            align-items: center;\n            justify-content: center;\n            gap: 6px;\n            background: #4a9eff;\n            color: white;\n          "\n          @click="handle_generate_table"\n        >\n          <i v-if="!is_generating_table" class="fa-solid fa-robot"></i>\n          <i v-else class="fa-solid fa-spinner fa-spin"></i>\n          {{ is_generating_table ? \'AIå¡«å……ä¸­...\' : \'AIå¡«å……è¡¨æ ¼\' }}\n        </button>\n        <button\n          class="action-button create-button"\n          style="\n            flex: 1;\n            min-width: 120px;\n            padding: 12px 16px;\n            border: 1px solid #40c057;\n            border-radius: 6px;\n            cursor: pointer;\n            font-weight: 500;\n            font-size: 13px;\n            transition: all 0.2s;\n            display: flex;\n            align-items: center;\n            justify-content: center;\n            gap: 6px;\n            background: #51cf66;\n            color: white;\n          "\n          @click="handle_create_table"\n        >\n          <i class="fa-solid fa-plus"></i> åˆ›å»ºç©ºè¡¨æ ¼\n        </button>\n      </div>\n    </div>\n\n    \x3c!-- æ¥¼å±‚ç®¡ç† --\x3e\n    <div\n      class="config-section"\n      style="padding: 20px 25px !important; border-bottom: 1px solid #3a3a3a; margin-bottom: 5px"\n    >\n      <h3\n        style="\n          margin: 0 0 20px 0 !important;\n          color: #fff;\n          font-size: 15px !important;\n          font-weight: bold;\n          display: flex;\n          align-items: center;\n          gap: 8px;\n        "\n      >\n        ğŸ”§ æ¥¼å±‚ç®¡ç†\n      </h3>\n      <div class="form-group" style="margin-bottom: 18px !important">\n        <label style="display: block; margin-bottom: 6px; color: #ccc; font-size: 13px"\n          >éšè—æ¥¼å±‚èŒƒå›´ï¼ˆå¦‚ï¼š1-10 æˆ–å•ä¸ªæ¥¼å±‚å¦‚ï¼š5ï¼‰</label\n        >\n        <input\n          v-model="hide_range"\n          type="text"\n          placeholder="1-10"\n          style="\n            width: 100%;\n            padding: 10px 12px;\n            background: #2a2a2a;\n            border: 1px solid #3a3a3a;\n            border-radius: 6px;\n            color: #e0e0e0;\n            font-size: 13px;\n            transition: border-color 0.2s;\n          "\n        />\n      </div>\n      <div class="button-group" style="display: flex; gap: 12px; flex-wrap: wrap; margin-top: 5px">\n        <button\n          class="action-button"\n          style="\n            flex: 1;\n            min-width: 120px;\n            padding: 12px 16px;\n            border: 1px solid #ff5252;\n            border-radius: 6px;\n            cursor: pointer;\n            font-weight: 500;\n            font-size: 13px;\n            transition: all 0.2s;\n            display: flex;\n            align-items: center;\n            justify-content: center;\n            gap: 6px;\n            background: #ff6b6b;\n            color: white;\n          "\n          @click="handle_hide_messages"\n        >\n          <i class="fa-solid fa-eye-slash"></i> éšè—æ¥¼å±‚\n        </button>\n        <button\n          class="action-button"\n          style="\n            flex: 1;\n            min-width: 120px;\n            padding: 12px 16px;\n            border: 1px solid #40c057;\n            border-radius: 6px;\n            cursor: pointer;\n            font-weight: 500;\n            font-size: 13px;\n            transition: all 0.2s;\n            display: flex;\n            align-items: center;\n            justify-content: center;\n            gap: 6px;\n            background: #51cf66;\n            color: white;\n          "\n          :disabled="!hide_range.trim()"\n          @click="handle_show_messages"\n        >\n          <i class="fa-solid fa-eye"></i> æ˜¾ç¤ºæ¥¼å±‚\n        </button>\n        <button\n          class="action-button"\n          style="\n            flex: 1;\n            min-width: 120px;\n            padding: 12px 16px;\n            border: 1px solid #ffcc02;\n            border-radius: 6px;\n            cursor: pointer;\n            font-weight: 500;\n            font-size: 13px;\n            transition: all 0.2s;\n            display: flex;\n            align-items: center;\n            justify-content: center;\n            gap: 6px;\n            background: #ffd43b;\n            color: #333;\n          "\n          @click="() => handle_refresh_hidden(true)"\n        >\n          <i class="fa-solid fa-refresh"></i> åˆ·æ–°\n        </button>\n      </div>\n\n      \x3c!-- æ˜¾ç¤ºéšè—çš„æ¥¼å±‚åˆ—è¡¨ --\x3e\n      <div v-if="hidden_messages.length > 0" class="hidden-messages-section">\n        <div class="form-group">\n          <label class="flex-label">\n            <span>å·²éšè—çš„æ¥¼å±‚ ({{ hidden_messages.length }} ä¸ª)</span>\n            <button class="mini-button" @click="hidden_display_expanded = !hidden_display_expanded">\n              {{ hidden_display_expanded ? \'æ”¶èµ·\' : \'å±•å¼€\' }}\n            </button>\n          </label>\n        </div>\n        <div v-if="hidden_display_expanded" class="hidden-messages-list">\n          <div v-for="msg in hidden_messages" :key="msg.message_id" class="hidden-message-item">\n            <div class="message-info">\n              <span class="message-id">#{{ msg.message_id }}</span>\n              <span class="message-role" :class="\'role-\' + msg.role">\n                {{ msg.role === \'user\' ? \'ğŸ‘¤\' : msg.role === \'assistant\' ? \'ğŸ¤–\' : \'âš™ï¸\' }}\n                {{ msg.name }}\n              </span>\n              <span class="message-preview">\n                {{ msg.message.substring(0, 50) }}{{ msg.message.length > 50 ? \'...\' : \'\' }}\n              </span>\n            </div>\n            <button class="show-button" @click="() => handle_unhide_single(msg.message_id)">æ˜¾ç¤º</button>\n          </div>\n        </div>\n      </div>\n      <div v-else class="empty-state">æš‚æ— éšè—çš„æ¥¼å±‚</div>\n    </div>\n  </div>\n</template>\n\n<script setup lang="ts">\nimport { storeToRefs } from \'pinia\';\nimport { onMounted, ref } from \'vue\';\nimport { useSettingsStore } from \'../settings\';\nimport { getChatIdSafe, getScriptIdSafe } from \'../utils\';\n\nconst settingsStore = useSettingsStore();\nconst { settings } = storeToRefs(settingsStore);\n\n// å¯¼å…¥é…’é¦†APIå‡½æ•°\n// setChatMessages æ˜¯å…¨å±€å‡½æ•°ï¼Œä¸éœ€è¦å¯¼å…¥\n\n// è§£ææ¥¼å±‚èŒƒå›´çš„è¾…åŠ©å‡½æ•°\nconst parseMessageRange = (range: string): number[] => {\n  if (!range.trim()) return [];\n\n  const messageIds: number[] = [];\n  const parts = range.split(\',\');\n\n  for (const part of parts) {\n    const trimmed = part.trim();\n    if (!trimmed) continue;\n\n    if (trimmed.includes(\'-\')) {\n      // å¤„ç†èŒƒå›´ï¼Œå¦‚ "1-10"\n      const [start, end] = trimmed.split(\'-\').map(s => parseInt(s.trim()));\n      if (!isNaN(start) && !isNaN(end) && start >= 0 && end >= 0) {\n        for (let i = start; i <= end; i++) {\n          messageIds.push(i);\n        }\n      }\n    } else {\n      // å¤„ç†å•ä¸ªæ¥¼å±‚ï¼Œå¦‚ "5" æˆ– "0"\n      const id = parseInt(trimmed);\n      if (!isNaN(id) && id >= 0) {\n        messageIds.push(id);\n      }\n    }\n  }\n\n  return messageIds;\n};\n\n// å“åº”å¼æ•°æ®\nconst available_models = ref<string[]>([]);\nconst loading_models = ref(false);\nconst hide_range = ref<string>(\'\');\nconst hidden_messages = ref<Array<{ message_id: number; name: string; role: string; message: string }>>([]);\nconst hidden_display_expanded = ref(false);\n\n// æŒä¹…åŒ–ç”ŸæˆçŠ¶æ€\nconst is_summarizing = ref(false);\nconst is_generating_table = ref(false);\n\n// è¡¨æ ¼åˆ—å¤´æ¨¡æ¿ç›¸å…³\nconst headerTemplates = ref<Array<{ name: string; headers: string }>>([]);\nconst selectedTemplate = ref<string>(\'\');\nconst currentTemplate = ref<{ name: string; headers: string }>({ name: \'\', headers: \'\' });\n\n// ç”ŸæˆçŠ¶æ€ç®¡ç†\nconst loadGenerationStatus = () => {\n  try {\n    const scriptId = getScriptIdSafe();\n    if (!scriptId) {\n      console.warn(\'script_id ä¸ºç©ºï¼Œæ— æ³•åŠ è½½ç”ŸæˆçŠ¶æ€\');\n      return;\n    }\n    const scriptVars = getVariables({ type: \'script\', script_id: scriptId });\n    is_summarizing.value = scriptVars.is_summarizing || false;\n    is_generating_table.value = scriptVars.is_generating_table || false;\n    console.log(\'å·²åŠ è½½ç”ŸæˆçŠ¶æ€:\', { summarizing: is_summarizing.value, generating_table: is_generating_table.value });\n  } catch (error) {\n    console.error(\'åŠ è½½ç”ŸæˆçŠ¶æ€å¤±è´¥:\', error);\n    is_summarizing.value = false;\n    is_generating_table.value = false;\n  }\n};\n\nconst saveGenerationStatus = () => {\n  try {\n    const scriptId = getScriptIdSafe();\n    if (!scriptId) {\n      console.warn(\'script_id ä¸ºç©ºï¼Œæ— æ³•ä¿å­˜ç”ŸæˆçŠ¶æ€\');\n      return;\n    }\n    insertOrAssignVariables(\n      {\n        is_summarizing: is_summarizing.value,\n        is_generating_table: is_generating_table.value,\n      },\n      { type: \'script\', script_id: scriptId },\n    );\n    console.log(\'å·²ä¿å­˜ç”ŸæˆçŠ¶æ€\');\n  } catch (error) {\n    console.error(\'ä¿å­˜ç”ŸæˆçŠ¶æ€å¤±è´¥:\', error);\n  }\n};\n\nconst stopGeneration = () => {\n  if (is_summarizing.value || is_generating_table.value) {\n    is_summarizing.value = false;\n    is_generating_table.value = false;\n    saveGenerationStatus();\n    window.toastr.info(\'å·²åœæ­¢æ‰€æœ‰ç”Ÿæˆä»»åŠ¡\');\n  }\n};\n\n// è¡¨æ ¼åˆ—å¤´æ¨¡æ¿ç®¡ç†\nconst loadHeaderTemplates = () => {\n  try {\n    const scriptId = getScriptIdSafe();\n    if (!scriptId) {\n      console.warn(\'script_id ä¸ºç©ºï¼Œæ— æ³•åŠ è½½åˆ—å¤´æ¨¡æ¿\');\n      return;\n    }\n    const scriptVars = getVariables({ type: \'script\', script_id: scriptId });\n    // å…¼å®¹ header_templates å¯èƒ½ä¸º nullã€undefinedã€å­—ç¬¦ä¸²ç­‰ç±»å‹\n    let templates = scriptVars.header_templates;\n    // å°† nullã€undefined æˆ–ä¸ä¸ºæ•°ç»„çš„æƒ…å†µéƒ½å½’ä¸º []\n    if (!Array.isArray(templates)) {\n      templates = [];\n    }\n    headerTemplates.value = templates;\n    console.log(\'å·²åŠ è½½åˆ—å¤´æ¨¡æ¿:\', headerTemplates.value.length, \'ä¸ª\');\n  } catch (error) {\n    console.error(\'åŠ è½½åˆ—å¤´æ¨¡æ¿å¤±è´¥:\', error);\n    headerTemplates.value = [];\n  }\n};\n\nconst saveHeaderTemplates = () => {\n  try {\n    const scriptId = getScriptIdSafe();\n    if (!scriptId) {\n      console.warn(\'script_id ä¸ºç©ºï¼Œæ— æ³•ä¿å­˜åˆ—å¤´æ¨¡æ¿\');\n      return;\n    }\n    insertOrAssignVariables({ header_templates: headerTemplates.value }, { type: \'script\', script_id: scriptId });\n    console.log(\'å·²ä¿å­˜åˆ—å¤´æ¨¡æ¿\');\n  } catch (error) {\n    console.error(\'ä¿å­˜åˆ—å¤´æ¨¡æ¿å¤±è´¥:\', error);\n  }\n};\n\nconst loadTemplate = () => {\n  if (selectedTemplate.value !== \'\') {\n    const index = parseInt(selectedTemplate.value);\n    if (index >= 0 && index < headerTemplates.value.length) {\n      currentTemplate.value = { ...headerTemplates.value[index] };\n    }\n  }\n};\n\nconst showAddTemplateDialog = () => {\n  const name = window.prompt(\'è¯·è¾“å…¥æ¨¡æ¿åç§°ï¼š\');\n  if (name && name.trim()) {\n    const headers = window.prompt(\'è¯·è¾“å…¥åˆ—å¤´ï¼ˆç”¨é€—å·åˆ†éš”ï¼‰ï¼š\');\n    if (headers && headers.trim()) {\n      headerTemplates.value.push({ name: name.trim(), headers: headers.trim() });\n      saveHeaderTemplates();\n      selectedTemplate.value = (headerTemplates.value.length - 1).toString();\n      loadTemplate();\n      window.toastr.success(\'æ¨¡æ¿æ·»åŠ æˆåŠŸ\');\n    }\n  }\n};\n\nconst saveTemplate = () => {\n  if (selectedTemplate.value !== \'\' && currentTemplate.value.name.trim() && currentTemplate.value.headers.trim()) {\n    const index = parseInt(selectedTemplate.value);\n    if (index >= 0 && index < headerTemplates.value.length) {\n      headerTemplates.value[index] = { ...currentTemplate.value };\n      saveHeaderTemplates();\n      window.toastr.success(\'æ¨¡æ¿ä¿å­˜æˆåŠŸ\');\n    }\n  } else {\n    window.toastr.warning(\'è¯·å¡«å†™æ¨¡æ¿åç§°å’Œåˆ—å¤´\');\n  }\n};\n\nconst deleteTemplate = () => {\n  if (selectedTemplate.value !== \'\') {\n    if (confirm(\'ç¡®å®šè¦åˆ é™¤è¿™ä¸ªæ¨¡æ¿å—ï¼Ÿ\')) {\n      const index = parseInt(selectedTemplate.value);\n      if (index >= 0 && index < headerTemplates.value.length) {\n        headerTemplates.value.splice(index, 1);\n        saveHeaderTemplates();\n        selectedTemplate.value = \'\';\n        currentTemplate.value = { name: \'\', headers: \'\' };\n        window.toastr.success(\'æ¨¡æ¿åˆ é™¤æˆåŠŸ\');\n      }\n    }\n  }\n};\n\n// ä»é…’é¦†å˜é‡åŠ è½½éšè—æ¥¼å±‚æ•°æ®\nconst loadHiddenMessages = () => {\n  try {\n    const scriptId = getScriptIdSafe();\n    if (!scriptId) {\n      console.warn(\'script_id ä¸ºç©ºï¼Œæ— æ³•åŠ è½½éšè—æ¥¼å±‚æ•°æ®\');\n      return;\n    }\n    console.log(\'è„šæœ¬ID:\', scriptId);\n\n    const saved = getVariables({ type: \'script\', script_id: scriptId });\n    console.log(\'ä»é…’é¦†å˜é‡åŠ è½½çš„æ•°æ®:\', saved);\n    console.log(\'æ£€æŸ¥ hidden_messages å­—æ®µ:\', saved?.hidden_messages);\n\n    if (saved && saved.hidden_messages) {\n      hidden_messages.value = saved.hidden_messages;\n      console.log(\'æˆåŠŸåŠ è½½éšè—æ¥¼å±‚æ•°æ®:\', hidden_messages.value.length, \'ä¸ª\');\n    } else {\n      console.log(\'æ²¡æœ‰æ‰¾åˆ°éšè—æ¥¼å±‚æ•°æ®ï¼Œå°è¯•å…¶ä»–å­—æ®µå...\');\n      // å°è¯•å…¶ä»–å¯èƒ½çš„å­—æ®µå\n      const possibleFields = [\'hiddenMessages\', \'hidden_floors\', \'hiddenFloors\', \'floor_data\'];\n      for (const field of possibleFields) {\n        if (saved && saved[field]) {\n          console.log(`æ‰¾åˆ°å­—æ®µ ${field}:`, saved[field]);\n          hidden_messages.value = saved[field];\n          break;\n        }\n      }\n    }\n  } catch (error) {\n    console.error(\'åŠ è½½éšè—æ¥¼å±‚æ•°æ®å¤±è´¥:\', error);\n  }\n};\n\n// ä¿å­˜éšè—æ¥¼å±‚æ•°æ®åˆ°é…’é¦†å˜é‡\nconst saveHiddenMessages = () => {\n  try {\n    const scriptId = getScriptIdSafe();\n    if (!scriptId) {\n      console.warn(\'script_id ä¸ºç©ºï¼Œæ— æ³•ä¿å­˜éšè—æ¥¼å±‚æ•°æ®\');\n      return;\n    }\n    console.log(\'ä¿å­˜åˆ°è„šæœ¬ID:\', scriptId);\n    console.log(\'è¦ä¿å­˜çš„æ•°æ®:\', hidden_messages.value);\n\n    const dataToSave = {\n      hidden_messages: hidden_messages.value,\n    };\n    console.log(\'å‡†å¤‡ä¿å­˜çš„æ•°æ®å¯¹è±¡:\', dataToSave);\n\n    insertOrAssignVariables(dataToSave, { type: \'script\', script_id: scriptId });\n    console.log(\'æˆåŠŸä¿å­˜éšè—æ¥¼å±‚æ•°æ®:\', hidden_messages.value.length, \'ä¸ª\');\n\n    // éªŒè¯ä¿å­˜æ˜¯å¦æˆåŠŸ\n    setTimeout(() => {\n      const saved = getVariables({ type: \'script\', script_id: scriptId });\n      console.log(\'éªŒè¯ä¿å­˜ç»“æœ:\', saved);\n      console.log(\'éªŒè¯ hidden_messages å­—æ®µ:\', saved?.hidden_messages);\n    }, 100);\n  } catch (error) {\n    console.error(\'ä¿å­˜éšè—æ¥¼å±‚æ•°æ®å¤±è´¥:\', error);\n  }\n};\n\n// ç»„ä»¶æŒ‚è½½æ—¶åŠ è½½æ•°æ®\nonMounted(() => {\n  console.log(\'SettingsTab ç»„ä»¶å·²æŒ‚è½½ï¼Œå¼€å§‹åŠ è½½æ•°æ®\');\n  loadHiddenMessages();\n  loadHeaderTemplates();\n  loadGenerationStatus();\n});\n\n// æµ‹è¯•æŒ‰é’®å¤„ç†å‡½æ•°\nconst handleTestButton = () => {\n  console.log(\'åŸç”Ÿç‚¹å‡» - Vueäº‹ä»¶ç»‘å®šå·¥ä½œæ­£å¸¸\');\n  window.toastr.success(\'Vueäº‹ä»¶ç»‘å®šå·¥ä½œæ­£å¸¸ï¼\');\n};\n\n// è®¾ç½®ç®¡ç†å‡½æ•°\nconst handleSaveSettings = () => {\n  console.log(\'ğŸ’¾ æ‰‹åŠ¨ä¿å­˜è®¾ç½®...\');\n  const success = settingsStore.saveSettings();\n  if (success) {\n    console.log(\'âœ… è®¾ç½®ä¿å­˜æˆåŠŸ\');\n  } else {\n    console.error(\'âŒ è®¾ç½®ä¿å­˜å¤±è´¥\');\n  }\n};\n\nconst handleReloadSettings = () => {\n  console.log(\'ğŸ”„ é‡æ–°åŠ è½½è®¾ç½®...\');\n  const success = settingsStore.reloadSettings();\n  if (success) {\n    console.log(\'âœ… è®¾ç½®é‡æ–°åŠ è½½æˆåŠŸ\');\n  } else {\n    console.error(\'âŒ è®¾ç½®é‡æ–°åŠ è½½å¤±è´¥\');\n  }\n};\n\nconst handleResetAutoSummaryStart = () => {\n  console.log(\'ğŸ”„ é‡ç½®è‡ªåŠ¨æ€»ç»“èµ·å§‹æ¥¼å±‚...\');\n  try {\n    // è°ƒç”¨å…¨å±€å‡½æ•°\n    if (typeof (window as any).resetAutoSummaryStart === \'function\') {\n      (window as any).resetAutoSummaryStart();\n    } else {\n      window.toastr.error(\'é‡ç½®å‡½æ•°ä¸å¯ç”¨ï¼Œè¯·åˆ·æ–°é¡µé¢åé‡è¯•\');\n    }\n  } catch (error) {\n    console.error(\'âŒ é‡ç½®èµ·å§‹æ¥¼å±‚å¤±è´¥:\', error);\n    window.toastr.error(\'é‡ç½®å¤±è´¥: \' + (error as Error).message);\n  }\n};\n\n// å…¶ä»–å¤„ç†å‡½æ•°ï¼ˆè¿™é‡Œéœ€è¦ä»åŸç»„ä»¶ä¸­å¤åˆ¶ç›¸åº”çš„é€»è¾‘ï¼‰\nconst handle_fetch_models = async () => {\n  if (loading_models.value) return;\n\n  try {\n    loading_models.value = true;\n    console.log(\'å¼€å§‹æ‹‰å–æ¨¡å‹...\');\n\n    // éªŒè¯ API é…ç½®\n    if (!settings.value.api_endpoint || !settings.value.api_key) {\n      window.toastr.warning(\'è¯·å…ˆé…ç½® API ç«¯ç‚¹å’Œ API Key\');\n      return;\n    }\n\n    // è°ƒç”¨æ‹‰å–æ¨¡å‹å‡½æ•°\n    const { fetchAvailableModels } = await import(\'../æ€»ç»“åŠŸèƒ½\');\n    const models = await fetchAvailableModels();\n\n    console.log(\'è·å–åˆ°çš„æ¨¡å‹åˆ—è¡¨:\', models);\n\n    if (models.length > 0) {\n      // æ›´æ–°æ¨¡å‹åˆ—è¡¨\n      available_models.value = models;\n      window.toastr.success(`æˆåŠŸè·å– ${models.length} ä¸ªæ¨¡å‹`);\n\n      // å¦‚æœæœ‰æ¨¡å‹ï¼Œè‡ªåŠ¨é€‰æ‹©ç¬¬ä¸€ä¸ª\n      if (!settings.value.model && models[0]) {\n        settings.value.model = models[0];\n      }\n    } else {\n      window.toastr.warning(\'æœªæ‰¾åˆ°å¯ç”¨æ¨¡å‹\');\n    }\n  } catch (error) {\n    console.error(\'æ‹‰å–æ¨¡å‹å¤±è´¥:\', error);\n    window.toastr.error(\'æ‹‰å–æ¨¡å‹å¤±è´¥: \' + (error as Error).message);\n  } finally {\n    loading_models.value = false;\n  }\n};\n\nconst handle_test_connection = async () => {\n  try {\n    console.log(\'æµ‹è¯•è¿æ¥...\');\n\n    // éªŒè¯ API é…ç½®\n    if (!settings.value.api_endpoint || !settings.value.api_key) {\n      window.toastr.warning(\'è¯·å…ˆé…ç½® API ç«¯ç‚¹å’Œ API Key\');\n      return;\n    }\n\n    // ç®€å•çš„è¿æ¥æµ‹è¯•\n    const response = await fetch(settings.value.api_endpoint, {\n      method: \'POST\',\n      headers: {\n        \'Content-Type\': \'application/json\',\n        Authorization: `Bearer ${settings.value.api_key}`,\n      },\n      body: JSON.stringify({\n        model: settings.value.model || \'gpt-3.5-turbo\',\n        messages: [{ role: \'user\', content: \'test\' }],\n        max_tokens: 1,\n      }),\n    });\n\n    if (response.ok) {\n      window.toastr.success(\'è¿æ¥æµ‹è¯•æˆåŠŸï¼\');\n    } else {\n      window.toastr.error(\'è¿æ¥æµ‹è¯•å¤±è´¥ï¼š\' + response.status);\n    }\n  } catch (error) {\n    console.error(\'è¿æ¥æµ‹è¯•å¤±è´¥:\', error);\n    window.toastr.error(\'è¿æ¥æµ‹è¯•å¤±è´¥: \' + (error as Error).message);\n  }\n};\n\nconst handle_summarize = async () => {\n  try {\n    if (is_summarizing.value) return;\n\n    console.log(\'å¼€å§‹æ‰‹åŠ¨æ€»ç»“...\');\n    is_summarizing.value = true;\n    saveGenerationStatus();\n\n    // éªŒè¯ API é…ç½®\n    if (!settings.value.api_endpoint || !settings.value.api_key) {\n      window.toastr.warning(\'è¯·å…ˆé…ç½® API ç«¯ç‚¹å’Œ API Key\');\n      return;\n    }\n\n    // è·å–å½“å‰èŠå¤©çš„æ¶ˆæ¯\n    let chatMessages;\n    try {\n      const lastMessageId = getLastMessageId();\n      console.log(\'æœ€æ–°æ¶ˆæ¯ID:\', lastMessageId);\n      chatMessages = getChatMessages(`0-${lastMessageId}`, { hide_state: \'all\' });\n      console.log(\'è·å–åˆ°çš„æ¶ˆæ¯æ•°é‡:\', chatMessages.length);\n    } catch (error) {\n      console.error(\'è·å–èŠå¤©æ¶ˆæ¯å¤±è´¥:\', error);\n      window.toastr.error(\'è·å–èŠå¤©æ¶ˆæ¯å¤±è´¥: \' + (error as Error).message);\n      return;\n    }\n\n    if (!chatMessages || chatMessages.length === 0) {\n      window.toastr.warning(\'å½“å‰èŠå¤©æ²¡æœ‰æ¶ˆæ¯\');\n      return;\n    }\n\n    // è°ƒç”¨æ€»ç»“åŠŸèƒ½\n    const { summarizeMessages } = await import(\'../æ€»ç»“åŠŸèƒ½\');\n    const summary = await summarizeMessages(0, chatMessages.length);\n\n    console.log(\'æ€»ç»“å®Œæˆ:\', summary);\n\n    // ä¿å­˜æ€»ç»“ç»“æœåˆ°è„šæœ¬å˜é‡\n    const scriptId = getScriptIdSafe();\n    if (scriptId) {\n      insertOrAssignVariables({ last_summary: summary }, { type: \'script\', script_id: scriptId });\n    }\n\n    window.toastr.success(\'æ€»ç»“å®Œæˆï¼\');\n  } catch (error) {\n    console.error(\'æ€»ç»“å¤±è´¥:\', error);\n    window.toastr.error(\'æ€»ç»“å¤±è´¥: \' + (error as Error).message);\n  } finally {\n    is_summarizing.value = false;\n    saveGenerationStatus();\n  }\n};\n\nconst handle_generate_table = async () => {\n  try {\n    if (is_generating_table.value) return;\n\n    console.log(\'å¼€å§‹ç”Ÿæˆè¡¨æ ¼...\');\n    is_generating_table.value = true;\n    saveGenerationStatus();\n\n    // éªŒè¯ API é…ç½®\n    if (!settings.value.api_endpoint || !settings.value.api_key) {\n      window.toastr.warning(\'è¯·å…ˆé…ç½® API ç«¯ç‚¹å’Œ API Key\');\n      return;\n    }\n\n    // éªŒè¯è¡¨æ ¼å‚æ•°\n    if (!settings.value.table_start_message_id || !settings.value.table_end_message_id) {\n      window.toastr.warning(\'è¯·è®¾ç½®å¼€å§‹æ¥¼å±‚å’Œç»“æŸæ¥¼å±‚\');\n      return;\n    }\n\n    // è®©ç”¨æˆ·è¾“å…¥è¡¨æ ¼åˆ—å¤´ï¼ˆä¼˜å…ˆä½¿ç”¨æ¨¡æ¿ï¼‰\n    let headersInput: string | null = null;\n\n    if (currentTemplate.value.headers.trim()) {\n      // å¦‚æœå½“å‰æœ‰é€‰ä¸­çš„æ¨¡æ¿ï¼Œè¯¢é—®æ˜¯å¦ä½¿ç”¨\n      const useTemplate = confirm(\n        `æ˜¯å¦ä½¿ç”¨æ¨¡æ¿"${currentTemplate.value.name}"çš„åˆ—å¤´ï¼Ÿ\\nåˆ—å¤´ï¼š${currentTemplate.value.headers}`,\n      );\n      if (useTemplate) {\n        headersInput = currentTemplate.value.headers;\n      }\n    }\n\n    if (!headersInput) {\n      // å¦‚æœæ²¡æœ‰ä½¿ç”¨æ¨¡æ¿ï¼Œè®©ç”¨æˆ·æ‰‹åŠ¨è¾“å…¥\n      headersInput = window.prompt(\'è¯·è¾“å…¥è¡¨æ ¼åˆ—å¤´ï¼ˆç”¨é€—å·åˆ†éš”ï¼Œå¦‚ï¼šæ—¶é—´,äº‹ä»¶,åœ°ç‚¹,äººç‰©ï¼‰ï¼š\');\n    }\n\n    if (!headersInput || !headersInput.trim()) {\n      window.toastr.warning(\'è¯·è®¾ç½®è¡¨æ ¼åˆ—å¤´\');\n      return;\n    }\n\n    const headers: string[] = headersInput\n      .split(\',\')\n      .map((h: string) => h.trim())\n      .filter((h: string) => h);\n\n    if (headers.length === 0) {\n      window.toastr.warning(\'è¯·è®¾ç½®æœ‰æ•ˆçš„è¡¨æ ¼åˆ—å¤´\');\n      return;\n    }\n\n    // è·å–æŒ‡å®šèŒƒå›´çš„æ¶ˆæ¯\n    let chatMessages;\n    try {\n      const messageRange = `${settings.value.table_start_message_id}-${settings.value.table_end_message_id}`;\n      console.log(\'è·å–æ¶ˆæ¯èŒƒå›´:\', messageRange);\n      chatMessages = getChatMessages(messageRange, { hide_state: \'all\' });\n      console.log(\'è·å–åˆ°çš„æ¶ˆæ¯æ•°é‡:\', chatMessages.length);\n    } catch (error) {\n      console.error(\'è·å–èŠå¤©æ¶ˆæ¯å¤±è´¥:\', error);\n      window.toastr.error(\'è·å–èŠå¤©æ¶ˆæ¯å¤±è´¥: \' + (error as Error).message);\n      return;\n    }\n\n    if (!chatMessages || chatMessages.length === 0) {\n      window.toastr.warning(\'æŒ‡å®šèŒƒå›´å†…æ²¡æœ‰æ¶ˆæ¯\');\n      return;\n    }\n\n    // å‡†å¤‡AIè¯·æ±‚æ•°æ®\n    const messagesText = chatMessages\n      .map(msg => {\n        const role = msg.role === \'user\' ? \'ç”¨æˆ·\' : \'AI\';\n        return `${role}: ${msg.message}`;\n      })\n      .join(\'\\n\\n\');\n\n    const aiPrompt = `è¯·æ ¹æ®ä»¥ä¸‹èŠå¤©å†…å®¹ï¼Œç”Ÿæˆè¡¨æ ¼æ•°æ®ã€‚è¡¨æ ¼åˆ—å¤´ä¸ºï¼š${headers.join(\', \')}\n\nèŠå¤©å†…å®¹ï¼š\n${messagesText}\n\n**é‡è¦è¦æ±‚**ï¼š\n1. æ ¹æ®èŠå¤©å†…å®¹æå–ç›¸å…³ä¿¡æ¯å¡«å…¥è¡¨æ ¼\n2. ä¸¥æ ¼æŒ‰ç…§æä¾›çš„åˆ—å¤´é¡ºåºç”Ÿæˆæ•°æ®ï¼š${headers.join(\', \')}\n3. æ¯è¡Œæ•°æ®åº”è¯¥æ˜¯æœ‰æ„ä¹‰çš„ç›¸å…³ä¿¡æ¯\n4. å¦‚æœæŸä¸ªå­—æ®µæ²¡æœ‰ç›¸å…³ä¿¡æ¯ï¼Œå¡«å†™"æ— "æˆ–"-"\n5. å¿…é¡»è¿”å›çº¯JSONæ ¼å¼ï¼Œä¸è¦æ·»åŠ ä»»ä½•markdownæ ‡è®°æˆ–å…¶ä»–æ–‡å­—è¯´æ˜\n6. åªè¿”å›dataæ•°ç»„å³å¯ï¼Œheadersæˆ‘å·²ç»æœ‰äº†\n\n**è¾“å‡ºæ ¼å¼ï¼ˆåªè¿”å›è¿™ä¸ªJSONï¼Œä¸è¦å…¶ä»–å†…å®¹ï¼‰**ï¼š\n{\n  "data": [\n    ["æ•°æ®1", "æ•°æ®2", "æ•°æ®3"],\n    ["æ•°æ®4", "æ•°æ®5", "æ•°æ®6"]\n  ]\n}\n\næ³¨æ„ï¼šdataæ•°ç»„ä¸­æ¯ä¸ªå­æ•°ç»„çš„é•¿åº¦å¿…é¡»ç­‰äº${headers.length}ï¼Œå¯¹åº”åˆ—å¤´ï¼š${headers.join(\', \')}`;\n\n    console.log(\'å‘é€AIè¯·æ±‚...\');\n    window.toastr.info(\'æ­£åœ¨AIåˆ†æèŠå¤©å†…å®¹å¹¶ç”Ÿæˆè¡¨æ ¼...\');\n\n    // è°ƒç”¨AIç”Ÿæˆè¡¨æ ¼\n    const response = await fetch(settings.value.api_endpoint, {\n      method: \'POST\',\n      headers: {\n        \'Content-Type\': \'application/json\',\n        Authorization: `Bearer ${settings.value.api_key}`,\n      },\n      body: JSON.stringify({\n        model: settings.value.model,\n        messages: [\n          {\n            role: \'user\',\n            content: aiPrompt,\n          },\n        ],\n        max_tokens: settings.value.max_tokens,\n        temperature: settings.value.temperature,\n      }),\n    });\n\n    if (!response.ok) {\n      throw new Error(`APIè¯·æ±‚å¤±è´¥: ${response.status} ${response.statusText}`);\n    }\n\n    const result = await response.json();\n    console.log(\'AIå“åº”:\', result);\n\n    if (!result.choices || !result.choices[0] || !result.choices[0].message) {\n      throw new Error(\'AIå“åº”æ ¼å¼é”™è¯¯\');\n    }\n\n    const aiResponse = result.choices[0].message.content;\n    console.log(\'AIè¿”å›å†…å®¹:\', aiResponse);\n\n    // è§£æAIè¿”å›çš„JSON\n    let aiTableData;\n    try {\n      // å°è¯•æå–JSONéƒ¨åˆ†ï¼ˆç§»é™¤å¯èƒ½çš„markdownä»£ç å—æ ‡è®°ï¼‰\n      let jsonText = aiResponse.trim();\n\n      // ç§»é™¤markdownä»£ç å—\n      jsonText = jsonText\n        .replace(/^```json\\s*/i, \'\')\n        .replace(/^```\\s*/, \'\')\n        .replace(/```\\s*$/, \'\');\n\n      // æå–JSONå¯¹è±¡\n      const jsonMatch = jsonText.match(/\\{[\\s\\S]*\\}/);\n      if (jsonMatch) {\n        aiTableData = JSON.parse(jsonMatch[0]);\n      } else {\n        throw new Error(\'æ— æ³•æ‰¾åˆ°JSONæ ¼å¼çš„è¡¨æ ¼æ•°æ®\');\n      }\n    } catch (parseError) {\n      console.error(\'è§£æAIå“åº”å¤±è´¥:\', parseError);\n      console.log(\'AIåŸå§‹å“åº”:\', aiResponse);\n      window.toastr.error(\'AIè¿”å›çš„æ•°æ®æ ¼å¼ä¸æ­£ç¡®ï¼Œè¯·é‡è¯•\');\n      return;\n    }\n\n    // éªŒè¯è¡¨æ ¼æ•°æ®\n    if (!aiTableData.data || !Array.isArray(aiTableData.data)) {\n      window.toastr.error(\'AIè¿”å›çš„è¡¨æ ¼æ•°æ®æ ¼å¼ä¸æ­£ç¡®ï¼šç¼ºå°‘dataæ•°ç»„\');\n      return;\n    }\n\n    // éªŒè¯æ¯è¡Œæ•°æ®çš„åˆ—æ•°æ˜¯å¦æ­£ç¡®\n    for (let i = 0; i < aiTableData.data.length; i++) {\n      if (!Array.isArray(aiTableData.data[i])) {\n        window.toastr.error(`ç¬¬${i + 1}è¡Œæ•°æ®æ ¼å¼é”™è¯¯ï¼šä¸æ˜¯æ•°ç»„`);\n        return;\n      }\n      if (aiTableData.data[i].length !== headers.length) {\n        window.toastr.error(`ç¬¬${i + 1}è¡Œæ•°æ®åˆ—æ•°ä¸åŒ¹é…ï¼šæœŸæœ›${headers.length}åˆ—ï¼Œå®é™…${aiTableData.data[i].length}åˆ—`);\n        console.log(`æœŸæœ›åˆ—å¤´:`, headers);\n        console.log(`å®é™…æ•°æ®:`, aiTableData.data[i]);\n        return;\n      }\n    }\n\n    // ç»„è£…å®Œæ•´çš„è¡¨æ ¼æ•°æ®ï¼ˆä½¿ç”¨ç”¨æˆ·æä¾›çš„headersï¼‰\n    const tableData = {\n      headers: headers,\n      data: aiTableData.data,\n    };\n\n    // ä¿å­˜è¡¨æ ¼åˆ°èŠå¤©å˜é‡\n    const chat_id = getChatIdSafe();\n    if (chat_id) {\n      const chat_vars = getVariables({ type: \'chat\' });\n      const table_history = chat_vars.table_history || [];\n\n      table_history.push({\n        start_id: settings.value.table_start_message_id,\n        end_id: settings.value.table_end_message_id,\n        headers: tableData.headers,\n        data: tableData.data,\n      });\n\n      insertOrAssignVariables({ table_history }, { type: \'chat\' });\n\n      window.toastr.success(`è¡¨æ ¼ç”ŸæˆæˆåŠŸï¼å…±${tableData.data.length}è¡Œæ•°æ®`);\n      console.log(\'è¡¨æ ¼å·²ä¿å­˜åˆ°èŠå¤©å˜é‡:\', table_history);\n    } else {\n      window.toastr.warning(\'æ— æ³•è·å–èŠå¤©IDï¼Œè¡¨æ ¼ç”Ÿæˆå¤±è´¥\');\n    }\n  } catch (error) {\n    console.error(\'ç”Ÿæˆè¡¨æ ¼å¤±è´¥:\', error);\n    window.toastr.error(\'ç”Ÿæˆè¡¨æ ¼å¤±è´¥: \' + (error as Error).message);\n  } finally {\n    is_generating_table.value = false;\n    saveGenerationStatus();\n  }\n};\n\nconst handle_create_table = () => {\n  try {\n    // éªŒè¯è¡¨æ ¼å‚æ•°\n    if (!settings.value.table_start_message_id || !settings.value.table_end_message_id) {\n      window.toastr.warning(\'è¯·è®¾ç½®å¼€å§‹æ¥¼å±‚å’Œç»“æŸæ¥¼å±‚\');\n      return;\n    }\n\n    // è®©ç”¨æˆ·è¾“å…¥è¡¨æ ¼åˆ—å¤´\n    const headersInput: string | null = window.prompt(\'è¯·è¾“å…¥è¡¨æ ¼åˆ—å¤´ï¼ˆç”¨é€—å·åˆ†éš”ï¼Œå¦‚ï¼šæ—¶é—´,äº‹ä»¶,åœ°ç‚¹,äººç‰©ï¼‰ï¼š\');\n    if (!headersInput || !headersInput.trim()) {\n      window.toastr.warning(\'è¯·è®¾ç½®è¡¨æ ¼åˆ—å¤´\');\n      return;\n    }\n\n    // è§£æåˆ—å¤´\n    const headers: string[] = headersInput\n      .split(\',\')\n      .map((h: string) => h.trim())\n      .filter((h: string) => h);\n\n    if (headers.length === 0) {\n      window.toastr.warning(\'è¯·è®¾ç½®æœ‰æ•ˆçš„è¡¨æ ¼åˆ—å¤´\');\n      return;\n    }\n\n    // åˆ›å»ºç©ºè¡¨æ ¼æ•°æ®\n    const emptyTableData = {\n      start_id: settings.value.table_start_message_id,\n      end_id: settings.value.table_end_message_id,\n      headers: headers,\n      data: [], // ç©ºæ•°æ®ï¼Œç”¨æˆ·å¯ä»¥æ‰‹åŠ¨å¡«å……\n    };\n\n    // ä¿å­˜è¡¨æ ¼åˆ°èŠå¤©å˜é‡\n    const chat_id = getChatIdSafe();\n    if (chat_id) {\n      const chat_vars = getVariables({ type: \'chat\' });\n      const table_history = chat_vars.table_history || [];\n\n      table_history.push(emptyTableData);\n      insertOrAssignVariables({ table_history }, { type: \'chat\' });\n\n      window.toastr.success(`ç©ºè¡¨æ ¼åˆ›å»ºæˆåŠŸï¼åˆ—å¤´ï¼š${headers.join(\', \')}`);\n      console.log(\'ç©ºè¡¨æ ¼å·²ä¿å­˜åˆ°èŠå¤©å˜é‡:\', emptyTableData);\n    } else {\n      window.toastr.warning(\'æ— æ³•è·å–èŠå¤©IDï¼Œè¡¨æ ¼åˆ›å»ºå¤±è´¥\');\n    }\n  } catch (error) {\n    console.error(\'åˆ›å»ºè¡¨æ ¼å¤±è´¥:\', error);\n    window.toastr.error(\'åˆ›å»ºè¡¨æ ¼å¤±è´¥: \' + (error as Error).message);\n  }\n};\n\nconst handle_hide_messages = async () => {\n  try {\n    console.log(\'éšè—æ¥¼å±‚...\');\n\n    if (!hide_range.value.trim()) {\n      window.toastr.warning(\'è¯·è¾“å…¥è¦éšè—çš„æ¥¼å±‚èŒƒå›´\');\n      return;\n    }\n\n    // è§£ææ¥¼å±‚èŒƒå›´\n    const ranges = hide_range.value.split(\',\').map(range => range.trim());\n    const messageIds: number[] = [];\n\n    for (const range of ranges) {\n      if (range.includes(\'-\')) {\n        // èŒƒå›´æ ¼å¼ï¼š1-10\n        const [start, end] = range.split(\'-\').map(Number);\n        if (start && end && start <= end) {\n          for (let i = start; i <= end; i++) {\n            messageIds.push(i);\n          }\n        }\n      } else {\n        // å•ä¸ªæ¥¼å±‚ï¼š5\n        const id = Number(range);\n        if (id) {\n          messageIds.push(id);\n        }\n      }\n    }\n\n    if (messageIds.length === 0) {\n      window.toastr.warning(\'è¯·è¾“å…¥æœ‰æ•ˆçš„æ¥¼å±‚èŒƒå›´\');\n      return;\n    }\n\n    // è·å–å½“å‰èŠå¤©çš„æ¶ˆæ¯\n    let chatMessages;\n    try {\n      const lastMessageId = getLastMessageId();\n      console.log(\'æœ€æ–°æ¶ˆæ¯ID:\', lastMessageId);\n      chatMessages = getChatMessages(`0-${lastMessageId}`, { hide_state: \'all\' });\n      console.log(\'è·å–åˆ°çš„æ¶ˆæ¯æ•°é‡:\', chatMessages.length);\n    } catch (error) {\n      console.error(\'è·å–èŠå¤©æ¶ˆæ¯å¤±è´¥:\', error);\n      window.toastr.error(\'è·å–èŠå¤©æ¶ˆæ¯å¤±è´¥: \' + (error as Error).message);\n      return;\n    }\n\n    if (!chatMessages || chatMessages.length === 0) {\n      window.toastr.warning(\'å½“å‰èŠå¤©æ²¡æœ‰æ¶ˆæ¯\');\n      return;\n    }\n\n    // éšè—æŒ‡å®šçš„æ¥¼å±‚\n    let hiddenCount = 0;\n    const messagesToHide = [];\n\n    for (const messageId of messageIds) {\n      const message = chatMessages.find(msg => msg.message_id === messageId);\n      if (message) {\n        // å‡†å¤‡è¦éšè—çš„æ¶ˆæ¯æ•°æ®\n        messagesToHide.push({\n          message_id: messageId,\n          is_hidden: true,\n        });\n\n        // æ·»åŠ åˆ°éšè—åˆ—è¡¨\n        hidden_messages.value.push({\n          message_id: messageId,\n          name: message.name || \'Unknown\',\n          role: message.role || \'user\',\n          message: message.message || \'\',\n        });\n        hiddenCount++;\n      }\n    }\n\n    // è°ƒç”¨é…’é¦†APIçœŸæ­£éšè—æ¥¼å±‚\n    if (messagesToHide.length > 0) {\n      try {\n        console.log(\'å‡†å¤‡è°ƒç”¨ slash å‘½ä»¤éšè—æ¥¼å±‚:\', messageIds);\n\n        // ä½¿ç”¨ slash å‘½ä»¤éšè—æ¥¼å±‚\n        for (const messageId of messageIds) {\n          try {\n            await triggerSlash(`/hide ${messageId}`);\n            console.log(`æˆåŠŸéšè—æ¥¼å±‚ ${messageId}`);\n          } catch (error) {\n            console.error(`éšè—æ¥¼å±‚ ${messageId} å¤±è´¥:`, error);\n          }\n        }\n\n        window.toastr.success(\'æ¥¼å±‚å·²çœŸæ­£éšè—\');\n      } catch (error) {\n        console.error(\'è°ƒç”¨éšè—APIå¤±è´¥:\', error);\n        window.toastr.error(\'éšè—æ¥¼å±‚APIè°ƒç”¨å¤±è´¥: \' + (error as Error).message);\n      }\n    }\n\n    if (hiddenCount > 0) {\n      // ä¿å­˜åˆ°é…’é¦†å˜é‡\n      saveHiddenMessages();\n      window.toastr.success(`æˆåŠŸéšè— ${hiddenCount} ä¸ªæ¥¼å±‚`);\n      hide_range.value = \'\'; // æ¸…ç©ºè¾“å…¥æ¡†\n    } else {\n      window.toastr.warning(\'æœªæ‰¾åˆ°è¦éšè—çš„æ¥¼å±‚\');\n    }\n  } catch (error) {\n    console.error(\'éšè—æ¥¼å±‚å¤±è´¥:\', error);\n    window.toastr.error(\'éšè—æ¥¼å±‚å¤±è´¥: \' + (error as Error).message);\n  }\n};\n\nconst handle_show_messages = async () => {\n  try {\n    console.log(\'æ˜¾ç¤ºæŒ‡å®šæ¥¼å±‚...\');\n\n    if (!hide_range.value.trim()) {\n      window.toastr.warning(\'è¯·è¾“å…¥è¦æ˜¾ç¤ºçš„æ¥¼å±‚èŒƒå›´\');\n      return;\n    }\n\n    // è§£ææ¥¼å±‚èŒƒå›´\n    const messageIds = parseMessageRange(hide_range.value.trim());\n    if (messageIds.length === 0) {\n      window.toastr.warning(\'è¯·è¾“å…¥æœ‰æ•ˆçš„æ¥¼å±‚èŒƒå›´\');\n      return;\n    }\n\n    // è·å–å½“å‰èŠå¤©çš„æ¶ˆæ¯\n    let chatMessages;\n    try {\n      const lastMessageId = getLastMessageId();\n      console.log(\'æœ€æ–°æ¶ˆæ¯ID:\', lastMessageId);\n      chatMessages = getChatMessages(`0-${lastMessageId}`, { hide_state: \'all\' });\n      console.log(\'è·å–åˆ°çš„æ¶ˆæ¯æ•°é‡:\', chatMessages.length);\n    } catch (error) {\n      console.error(\'è·å–èŠå¤©æ¶ˆæ¯å¤±è´¥:\', error);\n      window.toastr.error(\'è·å–èŠå¤©æ¶ˆæ¯å¤±è´¥: \' + (error as Error).message);\n      return;\n    }\n\n    if (!chatMessages || chatMessages.length === 0) {\n      window.toastr.warning(\'å½“å‰èŠå¤©æ²¡æœ‰æ¶ˆæ¯\');\n      return;\n    }\n\n    // å‡†å¤‡è¦æ˜¾ç¤ºçš„æ¶ˆæ¯æ•°æ®\n    const messagesToShow = [];\n    let shownCount = 0;\n\n    for (const messageId of messageIds) {\n      const message = chatMessages.find(msg => msg.message_id === messageId);\n      if (message) {\n        messagesToShow.push({\n          message_id: messageId,\n          is_hidden: false,\n        });\n        shownCount++;\n      }\n    }\n\n    if (messagesToShow.length === 0) {\n      window.toastr.warning(\'æœªæ‰¾åˆ°è¦æ˜¾ç¤ºçš„æ¥¼å±‚\');\n      return;\n    }\n\n    // è°ƒç”¨é…’é¦†APIçœŸæ­£æ˜¾ç¤ºæ¥¼å±‚\n    try {\n      // ä½¿ç”¨ slash å‘½ä»¤æ˜¾ç¤ºæ¥¼å±‚\n      for (const messageId of messageIds) {\n        try {\n          await triggerSlash(`/unhide ${messageId}`);\n          console.log(`æˆåŠŸæ˜¾ç¤ºæ¥¼å±‚ ${messageId}`);\n        } catch (error) {\n          console.error(`æ˜¾ç¤ºæ¥¼å±‚ ${messageId} å¤±è´¥:`, error);\n        }\n      }\n    } catch (error) {\n      console.error(\'è°ƒç”¨æ˜¾ç¤ºAPIå¤±è´¥:\', error);\n      window.toastr.error(\'æ˜¾ç¤ºæ¥¼å±‚APIè°ƒç”¨å¤±è´¥: \' + (error as Error).message);\n      return;\n    }\n\n    // ä»éšè—åˆ—è¡¨ä¸­ç§»é™¤å·²æ˜¾ç¤ºçš„æ¥¼å±‚\n    hidden_messages.value = hidden_messages.value.filter(hiddenMsg => !messageIds.includes(hiddenMsg.message_id));\n\n    // ä¿å­˜åˆ°é…’é¦†å˜é‡\n    saveHiddenMessages();\n\n    window.toastr.success(`æˆåŠŸæ˜¾ç¤º ${shownCount} ä¸ªæ¥¼å±‚`);\n    hide_range.value = \'\'; // æ¸…ç©ºè¾“å…¥æ¡†\n  } catch (error) {\n    console.error(\'æ˜¾ç¤ºæ¥¼å±‚å¤±è´¥:\', error);\n    window.toastr.error(\'æ˜¾ç¤ºæ¥¼å±‚å¤±è´¥: \' + (error as Error).message);\n  }\n};\n\nconst handle_refresh_hidden = async (showToast: boolean = false) => {\n  try {\n    console.log(\'åˆ·æ–°éšè—æ¥¼å±‚\', showToast);\n\n    // å…ˆåŠ è½½éšè—æ¥¼å±‚æ•°æ®ï¼ˆå¦‚æœè¿˜æ²¡æœ‰åŠ è½½çš„è¯ï¼‰\n    if (hidden_messages.value.length === 0) {\n      console.log(\'éšè—æ¥¼å±‚åˆ—è¡¨ä¸ºç©ºï¼Œå…ˆåŠ è½½æ•°æ®...\');\n      loadHiddenMessages();\n    }\n\n    // è·å–å½“å‰èŠå¤©çš„æ¶ˆæ¯\n    let chatMessages;\n    try {\n      const lastMessageId = getLastMessageId();\n      console.log(\'æœ€æ–°æ¶ˆæ¯ID:\', lastMessageId);\n      chatMessages = getChatMessages(`0-${lastMessageId}`, { hide_state: \'all\' });\n      console.log(\'è·å–åˆ°çš„æ¶ˆæ¯æ•°é‡:\', chatMessages.length);\n    } catch (error) {\n      console.error(\'è·å–èŠå¤©æ¶ˆæ¯å¤±è´¥:\', error);\n      if (showToast) {\n        window.toastr.error(\'è·å–èŠå¤©æ¶ˆæ¯å¤±è´¥: \' + (error as Error).message);\n      }\n      return;\n    }\n\n    if (!chatMessages || chatMessages.length === 0) {\n      if (showToast) {\n        window.toastr.warning(\'å½“å‰èŠå¤©æ²¡æœ‰æ¶ˆæ¯\');\n      }\n      return;\n    }\n\n    // é‡æ–°éªŒè¯éšè—åˆ—è¡¨ä¸­çš„æ¥¼å±‚æ˜¯å¦ä»ç„¶å­˜åœ¨\n    const validHiddenMessages = [];\n    let removedCount = 0;\n\n    for (const hiddenMsg of hidden_messages.value) {\n      const message = chatMessages.find(msg => msg.message_id === hiddenMsg.message_id);\n      if (message) {\n        // æ›´æ–°æ¶ˆæ¯å†…å®¹ï¼ˆå¯èƒ½å·²ç»æ”¹å˜ï¼‰\n        validHiddenMessages.push({\n          message_id: hiddenMsg.message_id,\n          name: message.name || hiddenMsg.name,\n          role: message.role || hiddenMsg.role,\n          message: message.message || hiddenMsg.message,\n        });\n      } else {\n        // æ¥¼å±‚ä¸å­˜åœ¨äº†ï¼Œä»éšè—åˆ—è¡¨ä¸­ç§»é™¤\n        removedCount++;\n      }\n    }\n\n    // æ›´æ–°éšè—åˆ—è¡¨\n    hidden_messages.value = validHiddenMessages;\n\n    // ä¿å­˜æ›´æ–°åçš„æ•°æ®åˆ°é…’é¦†å˜é‡\n    saveHiddenMessages();\n\n    if (showToast) {\n      if (removedCount > 0) {\n        window.toastr.success(`åˆ·æ–°å®Œæˆï¼Œç§»é™¤äº† ${removedCount} ä¸ªä¸å­˜åœ¨çš„æ¥¼å±‚`);\n      } else {\n        window.toastr.success(\'åˆ·æ–°å®Œæˆï¼Œæ‰€æœ‰éšè—æ¥¼å±‚ä»ç„¶æœ‰æ•ˆ\');\n      }\n    }\n\n    console.log(`åˆ·æ–°å®Œæˆï¼š${validHiddenMessages.length} ä¸ªæœ‰æ•ˆéšè—æ¥¼å±‚ï¼Œ${removedCount} ä¸ªå·²ç§»é™¤`);\n  } catch (error) {\n    console.error(\'åˆ·æ–°éšè—æ¥¼å±‚å¤±è´¥:\', error);\n    if (showToast) {\n      window.toastr.error(\'åˆ·æ–°éšè—æ¥¼å±‚å¤±è´¥: \' + (error as Error).message);\n    }\n  }\n};\n\nconst handle_unhide_single = async (messageId: number) => {\n  try {\n    console.log(\'æ˜¾ç¤ºå•ä¸ªæ¥¼å±‚\', messageId);\n\n    // æ£€æŸ¥æ¥¼å±‚æ˜¯å¦åœ¨éšè—åˆ—è¡¨ä¸­\n    const index = hidden_messages.value.findIndex(msg => msg.message_id === messageId);\n    if (index === -1) {\n      window.toastr.warning(`æ¥¼å±‚ #${messageId} ä¸åœ¨éšè—åˆ—è¡¨ä¸­`);\n      return;\n    }\n\n    // è°ƒç”¨é…’é¦†APIçœŸæ­£æ˜¾ç¤ºæ¥¼å±‚\n    try {\n      // ä½¿ç”¨ slash å‘½ä»¤æ˜¾ç¤ºæ¥¼å±‚\n      await triggerSlash(`/unhide ${messageId}`);\n      console.log(\'æˆåŠŸæ˜¾ç¤ºæ¥¼å±‚:\', messageId);\n    } catch (error) {\n      console.error(\'è°ƒç”¨æ˜¾ç¤ºAPIå¤±è´¥:\', error);\n      window.toastr.warning(\'æ˜¾ç¤ºæ¥¼å±‚APIè°ƒç”¨å¤±è´¥\');\n      return;\n    }\n\n    // ä»éšè—åˆ—è¡¨ä¸­ç§»é™¤æŒ‡å®šçš„æ¥¼å±‚\n    hidden_messages.value.splice(index, 1);\n\n    // ä¿å­˜åˆ°é…’é¦†å˜é‡\n    saveHiddenMessages();\n\n    window.toastr.success(`å·²æ˜¾ç¤ºæ¥¼å±‚ #${messageId}`);\n  } catch (error) {\n    console.error(\'æ˜¾ç¤ºå•ä¸ªæ¥¼å±‚å¤±è´¥:\', error);\n    window.toastr.error(\'æ˜¾ç¤ºå•ä¸ªæ¥¼å±‚å¤±è´¥: \' + (error as Error).message);\n  }\n};\n<\/script>\n\n<style>\n.settings-tab {\n  height: 100%;\n  overflow-y: auto;\n  padding: 25px !important;\n  background: #1a1a1a !important;\n  border: 2px solid red !important;\n}\n\n.config-section {\n  padding: 20px 25px !important;\n  border-bottom: 1px solid #3a3a3a;\n  margin-bottom: 5px;\n}\n\n.config-section:last-child {\n  border-bottom: none;\n  margin-bottom: 0;\n}\n\n.config-section h3 {\n  margin: 0 0 20px 0 !important;\n  color: #fff;\n  font-size: 15px !important;\n  font-weight: bold;\n  display: flex;\n  align-items: center;\n  gap: 8px;\n}\n\n.form-group {\n  margin-bottom: 18px !important;\n}\n\n.form-group label {\n  display: block;\n  margin-bottom: 6px;\n  color: #ccc;\n  font-size: 13px;\n}\n\n.checkbox-label {\n  display: flex;\n  align-items: center;\n  gap: 8px;\n}\n\n.flex-label {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n}\n\n.form-group input[type=\'text\'],\n.form-group input[type=\'password\'],\n.form-group input[type=\'number\'],\n.form-group select {\n  width: 100%;\n  padding: 10px 12px;\n  background: #2a2a2a;\n  border: 1px solid #3a3a3a;\n  border-radius: 6px;\n  color: #e0e0e0;\n  font-size: 13px;\n  transition: border-color 0.2s;\n}\n\n.form-group input:focus,\n.form-group select:focus {\n  outline: none;\n  border-color: #4a9eff;\n}\n\n.model-controls {\n  display: flex;\n  flex-direction: column;\n  gap: 10px;\n}\n\n.button-group {\n  display: flex;\n  gap: 12px;\n  flex-wrap: wrap;\n  margin-top: 5px;\n}\n\n.action-button {\n  flex: 1;\n  min-width: 120px;\n  padding: 12px 16px;\n  border: none;\n  border-radius: 6px;\n  cursor: pointer;\n  font-weight: 500;\n  font-size: 13px;\n  transition: all 0.2s;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  gap: 6px;\n  background: #3a3a3a;\n  color: #e0e0e0;\n  border: 1px solid #4a4a4a;\n}\n\n.action-button:hover {\n  background: #4a4a4a;\n  border-color: #5a5a5a;\n}\n\n.test-button {\n  background: #3a3a3a;\n  color: #e0e0e0;\n  border: 1px solid #4a4a4a;\n}\n\n.test-button:hover {\n  background: #4a4a4a;\n  border-color: #5a5a5a;\n}\n\n.fetch-button {\n  background: #4a9eff;\n  color: white;\n  border: 1px solid #5aaeff;\n}\n\n.fetch-button:hover {\n  background: #5aaeff;\n  border-color: #6abeff;\n}\n\n.summarize-button {\n  background: #4a9eff;\n  color: white;\n  border: 1px solid #5aaeff;\n}\n\n.summarize-button:hover {\n  background: #5aaeff;\n  border-color: #6abeff;\n}\n\n.create-button {\n  background: #51cf66;\n  color: white;\n  border: 1px solid #40c057;\n}\n\n.create-button:hover {\n  background: #40c057;\n  border-color: #37b24d;\n}\n\n.table-button {\n  background: #4a9eff;\n  color: white;\n  border: 1px solid #5aaeff;\n}\n\n.table-button:hover {\n  background: #5aaeff;\n  border-color: #6abeff;\n}\n\n.hide-button {\n  background: #ff6b6b;\n  color: white;\n  border: 1px solid #ff5252;\n}\n\n.hide-button:hover {\n  background: #ff5252;\n  border-color: #ff4444;\n}\n\n.unhide-button {\n  background: #51cf66;\n  color: white;\n  border: 1px solid #40c057;\n}\n\n.unhide-button:hover {\n  background: #40c057;\n  border-color: #37b24d;\n}\n\n.refresh-button {\n  background: #ffd43b;\n  color: #333;\n  border: 1px solid #ffcc02;\n}\n\n.refresh-button:hover {\n  background: #ffcc02;\n  border-color: #ffb700;\n}\n\n.action-button:disabled {\n  opacity: 0.5;\n  cursor: not-allowed;\n}\n\n.model-select {\n  margin-top: 8px;\n}\n\n.hidden-messages-section {\n  margin-top: 20px;\n}\n\n.hidden-messages-list {\n  max-height: 300px;\n  overflow-y: auto;\n  border-radius: 6px;\n  border: 1px solid #3a3a3a;\n  background: #1a1a1a;\n}\n\n.hidden-message-item {\n  padding: 10px 12px;\n  display: flex;\n  align-items: center;\n  gap: 12px;\n  border-bottom: 1px solid #2a2a2a;\n  transition: background 0.2s;\n}\n\n.hidden-message-item:last-child {\n  border-bottom: none;\n}\n\n.hidden-message-item:hover {\n  background: #2a2a2a;\n}\n\n.message-info {\n  display: flex;\n  align-items: center;\n  gap: 10px;\n  flex: 1;\n}\n\n.message-id {\n  font-weight: bold;\n  color: #4a9eff;\n  font-size: 13px;\n  min-width: 50px;\n}\n\n.message-role {\n  font-size: 12px;\n  padding: 2px 8px;\n  border-radius: 4px;\n  white-space: nowrap;\n}\n\n.message-role.role-user {\n  background: #3a5a3a;\n  color: #90ee90;\n}\n\n.message-role.role-assistant {\n  background: #3a3a5a;\n  color: #90a0ee;\n}\n\n.message-role.role-system {\n  background: #5a5a3a;\n  color: #eea090;\n}\n\n.message-preview {\n  flex: 1;\n  color: #888;\n  font-size: 12px;\n  overflow: hidden;\n  text-overflow: ellipsis;\n  white-space: nowrap;\n}\n\n.show-button {\n  background: #4a9eff !important;\n  color: white !important;\n  padding: 6px 12px;\n  border: 1px solid #5aaeff !important;\n  border-radius: 4px;\n  cursor: pointer;\n  font-size: 12px;\n  transition: all 0.2s;\n  min-width: 60px;\n  text-align: center;\n}\n\n.show-button:hover {\n  background: #5aaeff !important;\n  border-color: #6abeff !important;\n}\n\n.mini-button {\n  background: #666;\n  color: white;\n  border: 1px solid #777;\n  padding: 6px 12px;\n  border-radius: 4px;\n  cursor: pointer;\n  font-size: 12px;\n  transition: all 0.2s;\n}\n\n.mini-button:hover {\n  background: #777;\n  border-color: #888;\n}\n\n.empty-state {\n  margin-top: 20px;\n  padding: 20px;\n  background: #2a2a2a;\n  border-radius: 6px;\n  text-align: center;\n  color: #888;\n  border: 1px solid #3a3a3a;\n}\n</style>\n'],sourceRoot:''}]);const i=s},603:(n,e,t)=>{var o=t(86);o.__esModule&&(o=o.default),'string'==typeof o&&(o=[[n.id,o,'']]),o.locals&&(n.exports=o.locals);(0,t(424).A)('3047f235',o,!1,{ssrId:!0})},608:()=>{$(()=>{setTimeout(()=>{let n=!1;const e=()=>{if(!n){n=!0;try{const t=['#top-bar','#top-settings-holder','#topBar','.topBar','#navbar','.navbar','header','.header','#header','.top_header','.navigation'];let o=$(),a='';for(const n of t){const e=$(n);if(e.length>0){o=e,a=n,console.log(`æ‰¾åˆ°å¯¼èˆªæ : ${n}`);break}}if(0===o.length)return console.log('æœªæ‰¾åˆ°å¯¼èˆªæ ï¼Œ500msåé‡è¯•...'),void setTimeout(e,500);console.log(`ä½¿ç”¨å¯¼èˆªæ : ${a}`);const r=$('#memoryNavButton');r.length>0&&(console.log('mzrodyuçŒ«çŒ«çš„å°ç ´çƒ‚å¯¼èˆªæŒ‰é’®å·²å­˜åœ¨ï¼Œç§»é™¤åé‡æ–°æ·»åŠ '),r.remove());let s=o;if('#top-bar'===a){const n=$('#top-settings-holder');n.length>0&&(s=n,console.log('ä½¿ç”¨ top-settings-holder ä½œä¸ºå®¹å™¨'))}const i=$('<div id="memoryNavButton" class="interactable" style="\n            padding: 8px;\n            display: inline-flex;\n            align-items: center;\n            justify-content: center;\n            cursor: pointer;\n            color: inherit;\n            border-radius: 4px;\n            transition: background 0.2s;\n            position: relative;\n          " title="mzrodyuçŒ«çŒ«çš„å°ç ´çƒ‚">\n            <span style="font-size: 24px">ğŸ±</span>\n          </div>');if(console.log('ç›®æ ‡å®¹å™¨ç±»å‹:',s[0]?.id||'æœªæŒ‡å®š'),console.log('ç›®æ ‡å®¹å™¨HTML:',s[0]?.outerHTML?.substring(0,300)),'top-settings-holder'===s[0]?.id){console.log('æ·»åŠ åˆ° top-settings-holder æœ€å‰é¢');const n=s.children().first();n.length>0?i.insertBefore(n):s.prepend(i)}else console.log('æ·»åŠ åˆ°å®¹å™¨å‰é¢'),s.prepend(i);i.on('click',function(n){n.preventDefault(),n.stopPropagation(),console.log('ç‚¹å‡»mzrodyuçŒ«çŒ«çš„å°ç ´çƒ‚å¯¼èˆªæŒ‰é’®');const e=$('#memoryManagementPanel');e.length>0?e.is(':visible')?e.fadeOut(200):e.fadeIn(200):toastr.error('æµ®åŠ¨é¢æ¿æœªåŠ è½½')}),i.on('mouseenter',function(){$(this).css('background','rgba(255, 255, 255, 0.1)')}).on('mouseleave',function(){$(this).css('background','transparent')}),console.log('mzrodyuçŒ«çŒ«çš„å°ç ´çƒ‚å¯¼èˆªæŒ‰é’®å·²æ·»åŠ åˆ°:',s[0]?.id||'å®¹å™¨'),console.log('æŒ‰é’®ä½ç½®:',i[0]?.parentElement?.children?.[0]?.className||'å·²æ·»åŠ '),console.log('æŒ‰é’®å…ƒç´ :',i[0]),console.log('é¢æ¿å®¹å™¨é•¿åº¦:',$('#memoryManagementPanel').length),n=!1}catch(t){console.error('æ·»åŠ å¯¼èˆªæŒ‰é’®å¤±è´¥:',t),n=!1,setTimeout(e,500)}}};if(e(),setInterval(()=>{0!==$('#memoryNavButton').length||n||(console.log('æ£€æµ‹åˆ°æŒ‰é’®æ¶ˆå¤±ï¼Œé‡æ–°æ·»åŠ ...'),e())},2e3),'function'==typeof eventOn)try{eventOn(tavern_events.CHAT_CHANGED,()=>{console.log('èŠå¤©å˜åŒ–ï¼Œæ£€æŸ¥æŒ‰é’®...'),setTimeout(()=>{0!==$('#memoryNavButton').length||n||(console.log('èŠå¤©å˜åŒ–åæŒ‰é’®æ¶ˆå¤±ï¼Œé‡æ–°æ·»åŠ ...'),e())},500)})}catch(n){console.log('æ— æ³•ç›‘å¬äº‹ä»¶:',n)}},300)})},707:n=>{if('undefined'==typeof z){var e=new Error('Cannot find module \'z\'');throw e.code='MODULE_NOT_FOUND',e}n.exports=z},790:n=>{n.exports=function(n){var e=n[1],t=n[3];if(!t)return e;if('function'==typeof btoa){var o=btoa(unescape(encodeURIComponent(JSON.stringify(t)))),a='sourceMappingURL=data:application/json;charset=utf-8;base64,'.concat(o),r='/*# '.concat(a,' */');return[e].concat([r]).join('\n')}return[e].join('\n')}},915:(n,e,t)=>{var o=t(254);o.__esModule&&(o=o.default),'string'==typeof o&&(o=[[n.id,o,'']]),o.locals&&(n.exports=o.locals);(0,t(424).A)('d1fca550',o,!1,{ssrId:!0})},942:(n,e,t)=>{var o=t(241);o.__esModule&&(o=o.default),'string'==typeof o&&(o=[[n.id,o,'']]),o.locals&&(n.exports=o.locals);(0,t(424).A)('32c597c2',o,!1,{ssrId:!0})}},a={};function r(n){var e=a[n];if(void 0!==e)return e.exports;var t=a[n]={id:n,exports:{}};return o[n](t,t.exports,r),t.exports}r.n=n=>{var e=n&&n.__esModule?()=>n.default:()=>n;return r.d(e,{a:e}),e},r.d=(n,e)=>{for(var t in e)r.o(e,t)&&!r.o(n,t)&&Object.defineProperty(n,t,{enumerable:!0,get:e[t]})},r.o=(n,e)=>Object.prototype.hasOwnProperty.call(n,e),r.r=n=>{'undefined'!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(n,Symbol.toStringTag,{value:'Module'}),Object.defineProperty(n,'__esModule',{value:!0})};var s=r(61),i=r(557),l=r(193),d=r(440),c=r(35);const p={class:'settings-tab',style:{padding:'25px !important',background:'#1a1a1a !important'}},g={class:'config-section',style:{padding:'20px 25px !important','border-bottom':'1px solid #3a3a3a','margin-bottom':'5px'}},u={class:'form-group',style:{'margin-bottom':'18px !important'}},m={class:'form-group',style:{'margin-bottom':'18px !important'}},x={class:'form-group'},b={class:'model-controls',style:{display:'flex','flex-direction':'column',gap:'10px'}},f={class:'button-group',style:{display:'flex',gap:'12px','flex-wrap':'wrap','margin-top':'5px'}},h=['disabled'],y=['value'],A={class:'form-group',style:{'margin-bottom':'18px !important'}},w={class:'form-group',style:{'margin-bottom':'18px !important'}},C={class:'config-section',style:{padding:'20px 25px !important','border-bottom':'1px solid #3a3a3a','margin-bottom':'5px'}},v={class:'form-group',style:{'margin-bottom':'18px !important'}},k={class:'checkbox-label',style:{display:'flex','align-items':'center',gap:'8px',color:'#ccc','font-size':'13px'}},B={key:0,class:'form-group',style:{'margin-bottom':'18px !important'}},E={class:'config-section',style:{padding:'20px 25px !important','border-bottom':'1px solid #3a3a3a','margin-bottom':'5px'}},T={class:'form-group',style:{'margin-bottom':'18px !important'}},I={class:'form-group',style:{'margin-bottom':'18px !important'}},S={class:'button-group',style:{display:'flex',gap:'12px','flex-wrap':'wrap','margin-top':'5px'}},N=['disabled'],V=['disabled'],D={key:0,class:'fa-solid fa-magic'},M={key:1,class:'fa-solid fa-spinner fa-spin'},F={class:'config-section',style:{padding:'20px 25px !important','border-bottom':'1px solid #3a3a3a','margin-bottom':'5px'}},j={class:'form-group',style:{'margin-bottom':'18px !important'}},P={class:'form-group',style:{'margin-bottom':'18px !important'}},O={class:'form-group',style:{'margin-bottom':'18px !important'}},Y={style:{display:'flex',gap:'8px','margin-bottom':'8px'}},L=['value'],R={key:0,style:{display:'flex',gap:'8px'}},U={class:'form-group',style:{'margin-bottom':'18px !important'}},W={style:{display:'flex',gap:'12px','align-items':'center'}},q={style:{display:'flex','align-items':'center',gap:'6px'}},H={style:{display:'flex','align-items':'center',gap:'6px'}},G={key:0,style:{'margin-left':'auto'}},J={class:'button-group',style:{display:'flex',gap:'12px','flex-wrap':'wrap','margin-top':'5px'}},K=['disabled'],Z={key:0,class:'fa-solid fa-robot'},Q={key:1,class:'fa-solid fa-spinner fa-spin'},X={class:'config-section',style:{padding:'20px 25px !important','border-bottom':'1px solid #3a3a3a','margin-bottom':'5px'}},nn={class:'form-group',style:{'margin-bottom':'18px !important'}},en={class:'button-group',style:{display:'flex',gap:'12px','flex-wrap':'wrap','margin-top':'5px'}},tn=['disabled'],on={key:0,class:'hidden-messages-section'},an={class:'form-group'},rn={class:'flex-label'},sn={key:0,class:'hidden-messages-list'},ln={class:'message-info'},dn={class:'message-id'},cn={class:'message-preview'},pn=['onClick'],gn={key:1,class:'empty-state'},un=(0,s.defineComponent)({__name:'SettingsTab',setup(n){const e=(0,i.C)(),{settings:t}=(0,c.storeToRefs)(e),o=(0,s.ref)([]),a=(0,s.ref)(!1),d=(0,s.ref)(''),un=(0,s.ref)([]),mn=(0,s.ref)(!1),xn=(0,s.ref)(!1),bn=(0,s.ref)(!1),fn=(0,s.ref)([]),hn=(0,s.ref)(''),yn=(0,s.ref)({name:'',headers:''}),An=()=>{try{const n=(0,l.Ut)();if(!n)return void console.warn('script_id ä¸ºç©ºï¼Œæ— æ³•ä¿å­˜ç”ŸæˆçŠ¶æ€');insertOrAssignVariables({is_summarizing:xn.value,is_generating_table:bn.value},{type:'script',script_id:n}),console.log('å·²ä¿å­˜ç”ŸæˆçŠ¶æ€')}catch(n){console.error('ä¿å­˜ç”ŸæˆçŠ¶æ€å¤±è´¥:',n)}},wn=()=>{(xn.value||bn.value)&&(xn.value=!1,bn.value=!1,An(),window.toastr.info('å·²åœæ­¢æ‰€æœ‰ç”Ÿæˆä»»åŠ¡'))},Cn=()=>{try{const n=(0,l.Ut)();if(!n)return void console.warn('script_id ä¸ºç©ºï¼Œæ— æ³•ä¿å­˜åˆ—å¤´æ¨¡æ¿');insertOrAssignVariables({header_templates:fn.value},{type:'script',script_id:n}),console.log('å·²ä¿å­˜åˆ—å¤´æ¨¡æ¿')}catch(n){console.error('ä¿å­˜åˆ—å¤´æ¨¡æ¿å¤±è´¥:',n)}},vn=()=>{if(''!==hn.value){const n=parseInt(hn.value);n>=0&&n<fn.value.length&&(yn.value={...fn.value[n]})}},kn=()=>{const n=window.prompt('è¯·è¾“å…¥æ¨¡æ¿åç§°ï¼š');if(n&&n.trim()){const e=window.prompt('è¯·è¾“å…¥åˆ—å¤´ï¼ˆç”¨é€—å·åˆ†éš”ï¼‰ï¼š');e&&e.trim()&&(fn.value.push({name:n.trim(),headers:e.trim()}),Cn(),hn.value=(fn.value.length-1).toString(),vn(),window.toastr.success('æ¨¡æ¿æ·»åŠ æˆåŠŸ'))}},Bn=()=>{if(''!==hn.value&&yn.value.name.trim()&&yn.value.headers.trim()){const n=parseInt(hn.value);n>=0&&n<fn.value.length&&(fn.value[n]={...yn.value},Cn(),window.toastr.success('æ¨¡æ¿ä¿å­˜æˆåŠŸ'))}else window.toastr.warning('è¯·å¡«å†™æ¨¡æ¿åç§°å’Œåˆ—å¤´')},_n=()=>{if(''!==hn.value&&confirm('ç¡®å®šè¦åˆ é™¤è¿™ä¸ªæ¨¡æ¿å—ï¼Ÿ')){const n=parseInt(hn.value);n>=0&&n<fn.value.length&&(fn.value.splice(n,1),Cn(),hn.value='',yn.value={name:'',headers:''},window.toastr.success('æ¨¡æ¿åˆ é™¤æˆåŠŸ'))}},En=()=>{try{const n=(0,l.Ut)();if(!n)return void console.warn('script_id ä¸ºç©ºï¼Œæ— æ³•åŠ è½½éšè—æ¥¼å±‚æ•°æ®');console.log('è„šæœ¬ID:',n);const e=getVariables({type:'script',script_id:n});if(console.log('ä»é…’é¦†å˜é‡åŠ è½½çš„æ•°æ®:',e),console.log('æ£€æŸ¥ hidden_messages å­—æ®µ:',e?.hidden_messages),e&&e.hidden_messages)un.value=e.hidden_messages,console.log('æˆåŠŸåŠ è½½éšè—æ¥¼å±‚æ•°æ®:',un.value.length,'ä¸ª');else{console.log('æ²¡æœ‰æ‰¾åˆ°éšè—æ¥¼å±‚æ•°æ®ï¼Œå°è¯•å…¶ä»–å­—æ®µå...');const n=['hiddenMessages','hidden_floors','hiddenFloors','floor_data'];for(const t of n)if(e&&e[t]){console.log(`æ‰¾åˆ°å­—æ®µ ${t}:`,e[t]),un.value=e[t];break}}}catch(n){console.error('åŠ è½½éšè—æ¥¼å±‚æ•°æ®å¤±è´¥:',n)}},zn=()=>{try{const n=(0,l.Ut)();if(!n)return void console.warn('script_id ä¸ºç©ºï¼Œæ— æ³•ä¿å­˜éšè—æ¥¼å±‚æ•°æ®');console.log('ä¿å­˜åˆ°è„šæœ¬ID:',n),console.log('è¦ä¿å­˜çš„æ•°æ®:',un.value);const e={hidden_messages:un.value};console.log('å‡†å¤‡ä¿å­˜çš„æ•°æ®å¯¹è±¡:',e),insertOrAssignVariables(e,{type:'script',script_id:n}),console.log('æˆåŠŸä¿å­˜éšè—æ¥¼å±‚æ•°æ®:',un.value.length,'ä¸ª'),setTimeout(()=>{const e=getVariables({type:'script',script_id:n});console.log('éªŒè¯ä¿å­˜ç»“æœ:',e),console.log('éªŒè¯ hidden_messages å­—æ®µ:',e?.hidden_messages)},100)}catch(n){console.error('ä¿å­˜éšè—æ¥¼å±‚æ•°æ®å¤±è´¥:',n)}};(0,s.onMounted)(()=>{console.log('SettingsTab ç»„ä»¶å·²æŒ‚è½½ï¼Œå¼€å§‹åŠ è½½æ•°æ®'),En(),(()=>{try{const n=(0,l.Ut)();if(!n)return void console.warn('script_id ä¸ºç©ºï¼Œæ— æ³•åŠ è½½åˆ—å¤´æ¨¡æ¿');let e=getVariables({type:'script',script_id:n}).header_templates;Array.isArray(e)||(e=[]),fn.value=e,console.log('å·²åŠ è½½åˆ—å¤´æ¨¡æ¿:',fn.value.length,'ä¸ª')}catch(n){console.error('åŠ è½½åˆ—å¤´æ¨¡æ¿å¤±è´¥:',n),fn.value=[]}})(),(()=>{try{const n=(0,l.Ut)();if(!n)return void console.warn('script_id ä¸ºç©ºï¼Œæ— æ³•åŠ è½½ç”ŸæˆçŠ¶æ€');const e=getVariables({type:'script',script_id:n});xn.value=e.is_summarizing||!1,bn.value=e.is_generating_table||!1,console.log('å·²åŠ è½½ç”ŸæˆçŠ¶æ€:',{summarizing:xn.value,generating_table:bn.value})}catch(n){console.error('åŠ è½½ç”ŸæˆçŠ¶æ€å¤±è´¥:',n),xn.value=!1,bn.value=!1}})()});const Tn=()=>{console.log('åŸç”Ÿç‚¹å‡» - Vueäº‹ä»¶ç»‘å®šå·¥ä½œæ­£å¸¸'),window.toastr.success('Vueäº‹ä»¶ç»‘å®šå·¥ä½œæ­£å¸¸ï¼')},In=()=>{console.log('ğŸ’¾ æ‰‹åŠ¨ä¿å­˜è®¾ç½®...');e.saveSettings()?console.log('âœ… è®¾ç½®ä¿å­˜æˆåŠŸ'):console.error('âŒ è®¾ç½®ä¿å­˜å¤±è´¥')},Sn=()=>{console.log('ğŸ”„ é‡æ–°åŠ è½½è®¾ç½®...');e.reloadSettings()?console.log('âœ… è®¾ç½®é‡æ–°åŠ è½½æˆåŠŸ'):console.error('âŒ è®¾ç½®é‡æ–°åŠ è½½å¤±è´¥')},Nn=()=>{console.log('ğŸ”„ é‡ç½®è‡ªåŠ¨æ€»ç»“èµ·å§‹æ¥¼å±‚...');try{'function'==typeof window.resetAutoSummaryStart?window.resetAutoSummaryStart():window.toastr.error('é‡ç½®å‡½æ•°ä¸å¯ç”¨ï¼Œè¯·åˆ·æ–°é¡µé¢åé‡è¯•')}catch(n){console.error('âŒ é‡ç½®èµ·å§‹æ¥¼å±‚å¤±è´¥:',n),window.toastr.error('é‡ç½®å¤±è´¥: '+n.message)}},Vn=async()=>{if(!a.value)try{if(a.value=!0,console.log('å¼€å§‹æ‹‰å–æ¨¡å‹...'),!t.value.api_endpoint||!t.value.api_key)return void window.toastr.warning('è¯·å…ˆé…ç½® API ç«¯ç‚¹å’Œ API Key');const{fetchAvailableModels:n}=await Promise.resolve().then(r.bind(r,440)),e=await n();console.log('è·å–åˆ°çš„æ¨¡å‹åˆ—è¡¨:',e),e.length>0?(o.value=e,window.toastr.success(`æˆåŠŸè·å– ${e.length} ä¸ªæ¨¡å‹`),!t.value.model&&e[0]&&(t.value.model=e[0])):window.toastr.warning('æœªæ‰¾åˆ°å¯ç”¨æ¨¡å‹')}catch(n){console.error('æ‹‰å–æ¨¡å‹å¤±è´¥:',n),window.toastr.error('æ‹‰å–æ¨¡å‹å¤±è´¥: '+n.message)}finally{a.value=!1}},Dn=async()=>{try{if(console.log('æµ‹è¯•è¿æ¥...'),!t.value.api_endpoint||!t.value.api_key)return void window.toastr.warning('è¯·å…ˆé…ç½® API ç«¯ç‚¹å’Œ API Key');const n=await fetch(t.value.api_endpoint,{method:'POST',headers:{'Content-Type':'application/json',Authorization:`Bearer ${t.value.api_key}`},body:JSON.stringify({model:t.value.model||'gpt-3.5-turbo',messages:[{role:'user',content:'test'}],max_tokens:1})});n.ok?window.toastr.success('è¿æ¥æµ‹è¯•æˆåŠŸï¼'):window.toastr.error('è¿æ¥æµ‹è¯•å¤±è´¥ï¼š'+n.status)}catch(n){console.error('è¿æ¥æµ‹è¯•å¤±è´¥:',n),window.toastr.error('è¿æ¥æµ‹è¯•å¤±è´¥: '+n.message)}},$n=async()=>{try{if(xn.value)return;if(console.log('å¼€å§‹æ‰‹åŠ¨æ€»ç»“...'),xn.value=!0,An(),!t.value.api_endpoint||!t.value.api_key)return void window.toastr.warning('è¯·å…ˆé…ç½® API ç«¯ç‚¹å’Œ API Key');let n;try{const e=getLastMessageId();console.log('æœ€æ–°æ¶ˆæ¯ID:',e),n=getChatMessages(`0-${e}`,{hide_state:'all'}),console.log('è·å–åˆ°çš„æ¶ˆæ¯æ•°é‡:',n.length)}catch(n){return console.error('è·å–èŠå¤©æ¶ˆæ¯å¤±è´¥:',n),void window.toastr.error('è·å–èŠå¤©æ¶ˆæ¯å¤±è´¥: '+n.message)}if(!n||0===n.length)return void window.toastr.warning('å½“å‰èŠå¤©æ²¡æœ‰æ¶ˆæ¯');const{summarizeMessages:e}=await Promise.resolve().then(r.bind(r,440)),o=await e(0,n.length);console.log('æ€»ç»“å®Œæˆ:',o);const a=(0,l.Ut)();a&&insertOrAssignVariables({last_summary:o},{type:'script',script_id:a}),window.toastr.success('æ€»ç»“å®Œæˆï¼')}catch(n){console.error('æ€»ç»“å¤±è´¥:',n),window.toastr.error('æ€»ç»“å¤±è´¥: '+n.message)}finally{xn.value=!1,An()}},Mn=async()=>{try{if(bn.value)return;if(console.log('å¼€å§‹ç”Ÿæˆè¡¨æ ¼...'),bn.value=!0,An(),!t.value.api_endpoint||!t.value.api_key)return void window.toastr.warning('è¯·å…ˆé…ç½® API ç«¯ç‚¹å’Œ API Key');if(!t.value.table_start_message_id||!t.value.table_end_message_id)return void window.toastr.warning('è¯·è®¾ç½®å¼€å§‹æ¥¼å±‚å’Œç»“æŸæ¥¼å±‚');let n=null;if(yn.value.headers.trim()){confirm(`æ˜¯å¦ä½¿ç”¨æ¨¡æ¿"${yn.value.name}"çš„åˆ—å¤´ï¼Ÿ\nåˆ—å¤´ï¼š${yn.value.headers}`)&&(n=yn.value.headers)}if(n||(n=window.prompt('è¯·è¾“å…¥è¡¨æ ¼åˆ—å¤´ï¼ˆç”¨é€—å·åˆ†éš”ï¼Œå¦‚ï¼šæ—¶é—´,äº‹ä»¶,åœ°ç‚¹,äººç‰©ï¼‰ï¼š')),!n||!n.trim())return void window.toastr.warning('è¯·è®¾ç½®è¡¨æ ¼åˆ—å¤´');const e=n.split(',').map(n=>n.trim()).filter(n=>n);if(0===e.length)return void window.toastr.warning('è¯·è®¾ç½®æœ‰æ•ˆçš„è¡¨æ ¼åˆ—å¤´');let o;try{const n=`${t.value.table_start_message_id}-${t.value.table_end_message_id}`;console.log('è·å–æ¶ˆæ¯èŒƒå›´:',n),o=getChatMessages(n,{hide_state:'all'}),console.log('è·å–åˆ°çš„æ¶ˆæ¯æ•°é‡:',o.length)}catch(n){return console.error('è·å–èŠå¤©æ¶ˆæ¯å¤±è´¥:',n),void window.toastr.error('è·å–èŠå¤©æ¶ˆæ¯å¤±è´¥: '+n.message)}if(!o||0===o.length)return void window.toastr.warning('æŒ‡å®šèŒƒå›´å†…æ²¡æœ‰æ¶ˆæ¯');const a=o.map(n=>`${'user'===n.role?'ç”¨æˆ·':'AI'}: ${n.message}`).join('\n\n'),r=`è¯·æ ¹æ®ä»¥ä¸‹èŠå¤©å†…å®¹ï¼Œç”Ÿæˆè¡¨æ ¼æ•°æ®ã€‚è¡¨æ ¼åˆ—å¤´ä¸ºï¼š${e.join(', ')}\n\nèŠå¤©å†…å®¹ï¼š\n${a}\n\n**é‡è¦è¦æ±‚**ï¼š\n1. æ ¹æ®èŠå¤©å†…å®¹æå–ç›¸å…³ä¿¡æ¯å¡«å…¥è¡¨æ ¼\n2. ä¸¥æ ¼æŒ‰ç…§æä¾›çš„åˆ—å¤´é¡ºåºç”Ÿæˆæ•°æ®ï¼š${e.join(', ')}\n3. æ¯è¡Œæ•°æ®åº”è¯¥æ˜¯æœ‰æ„ä¹‰çš„ç›¸å…³ä¿¡æ¯\n4. å¦‚æœæŸä¸ªå­—æ®µæ²¡æœ‰ç›¸å…³ä¿¡æ¯ï¼Œå¡«å†™"æ— "æˆ–"-"\n5. å¿…é¡»è¿”å›çº¯JSONæ ¼å¼ï¼Œä¸è¦æ·»åŠ ä»»ä½•markdownæ ‡è®°æˆ–å…¶ä»–æ–‡å­—è¯´æ˜\n6. åªè¿”å›dataæ•°ç»„å³å¯ï¼Œheadersæˆ‘å·²ç»æœ‰äº†\n\n**è¾“å‡ºæ ¼å¼ï¼ˆåªè¿”å›è¿™ä¸ªJSONï¼Œä¸è¦å…¶ä»–å†…å®¹ï¼‰**ï¼š\n{\n  "data": [\n    ["æ•°æ®1", "æ•°æ®2", "æ•°æ®3"],\n    ["æ•°æ®4", "æ•°æ®5", "æ•°æ®6"]\n  ]\n}\n\næ³¨æ„ï¼šdataæ•°ç»„ä¸­æ¯ä¸ªå­æ•°ç»„çš„é•¿åº¦å¿…é¡»ç­‰äº${e.length}ï¼Œå¯¹åº”åˆ—å¤´ï¼š${e.join(', ')}`;console.log('å‘é€AIè¯·æ±‚...'),window.toastr.info('æ­£åœ¨AIåˆ†æèŠå¤©å†…å®¹å¹¶ç”Ÿæˆè¡¨æ ¼...');const s=await fetch(t.value.api_endpoint,{method:'POST',headers:{'Content-Type':'application/json',Authorization:`Bearer ${t.value.api_key}`},body:JSON.stringify({model:t.value.model,messages:[{role:'user',content:r}],max_tokens:t.value.max_tokens,temperature:t.value.temperature})});if(!s.ok)throw new Error(`APIè¯·æ±‚å¤±è´¥: ${s.status} ${s.statusText}`);const i=await s.json();if(console.log('AIå“åº”:',i),!i.choices||!i.choices[0]||!i.choices[0].message)throw new Error('AIå“åº”æ ¼å¼é”™è¯¯');const d=i.choices[0].message.content;let c;console.log('AIè¿”å›å†…å®¹:',d);try{let n=d.trim();n=n.replace(/^```json\s*/i,'').replace(/^```\s*/,'').replace(/```\s*$/,'');const e=n.match(/\{[\s\S]*\}/);if(!e)throw new Error('æ— æ³•æ‰¾åˆ°JSONæ ¼å¼çš„è¡¨æ ¼æ•°æ®');c=JSON.parse(e[0])}catch(n){return console.error('è§£æAIå“åº”å¤±è´¥:',n),console.log('AIåŸå§‹å“åº”:',d),void window.toastr.error('AIè¿”å›çš„æ•°æ®æ ¼å¼ä¸æ­£ç¡®ï¼Œè¯·é‡è¯•')}if(!c.data||!Array.isArray(c.data))return void window.toastr.error('AIè¿”å›çš„è¡¨æ ¼æ•°æ®æ ¼å¼ä¸æ­£ç¡®ï¼šç¼ºå°‘dataæ•°ç»„');for(let n=0;n<c.data.length;n++){if(!Array.isArray(c.data[n]))return void window.toastr.error(`ç¬¬${n+1}è¡Œæ•°æ®æ ¼å¼é”™è¯¯ï¼šä¸æ˜¯æ•°ç»„`);if(c.data[n].length!==e.length)return window.toastr.error(`ç¬¬${n+1}è¡Œæ•°æ®åˆ—æ•°ä¸åŒ¹é…ï¼šæœŸæœ›${e.length}åˆ—ï¼Œå®é™…${c.data[n].length}åˆ—`),console.log('æœŸæœ›åˆ—å¤´:',e),void console.log('å®é™…æ•°æ®:',c.data[n])}const p={headers:e,data:c.data};if((0,l.pA)()){const n=getVariables({type:'chat'}).table_history||[];n.push({start_id:t.value.table_start_message_id,end_id:t.value.table_end_message_id,headers:p.headers,data:p.data}),insertOrAssignVariables({table_history:n},{type:'chat'}),window.toastr.success(`è¡¨æ ¼ç”ŸæˆæˆåŠŸï¼å…±${p.data.length}è¡Œæ•°æ®`),console.log('è¡¨æ ¼å·²ä¿å­˜åˆ°èŠå¤©å˜é‡:',n)}else window.toastr.warning('æ— æ³•è·å–èŠå¤©IDï¼Œè¡¨æ ¼ç”Ÿæˆå¤±è´¥')}catch(n){console.error('ç”Ÿæˆè¡¨æ ¼å¤±è´¥:',n),window.toastr.error('ç”Ÿæˆè¡¨æ ¼å¤±è´¥: '+n.message)}finally{bn.value=!1,An()}},Fn=()=>{try{if(!t.value.table_start_message_id||!t.value.table_end_message_id)return void window.toastr.warning('è¯·è®¾ç½®å¼€å§‹æ¥¼å±‚å’Œç»“æŸæ¥¼å±‚');const n=window.prompt('è¯·è¾“å…¥è¡¨æ ¼åˆ—å¤´ï¼ˆç”¨é€—å·åˆ†éš”ï¼Œå¦‚ï¼šæ—¶é—´,äº‹ä»¶,åœ°ç‚¹,äººç‰©ï¼‰ï¼š');if(!n||!n.trim())return void window.toastr.warning('è¯·è®¾ç½®è¡¨æ ¼åˆ—å¤´');const e=n.split(',').map(n=>n.trim()).filter(n=>n);if(0===e.length)return void window.toastr.warning('è¯·è®¾ç½®æœ‰æ•ˆçš„è¡¨æ ¼åˆ—å¤´');const o={start_id:t.value.table_start_message_id,end_id:t.value.table_end_message_id,headers:e,data:[]};if((0,l.pA)()){const n=getVariables({type:'chat'}).table_history||[];n.push(o),insertOrAssignVariables({table_history:n},{type:'chat'}),window.toastr.success(`ç©ºè¡¨æ ¼åˆ›å»ºæˆåŠŸï¼åˆ—å¤´ï¼š${e.join(', ')}`),console.log('ç©ºè¡¨æ ¼å·²ä¿å­˜åˆ°èŠå¤©å˜é‡:',o)}else window.toastr.warning('æ— æ³•è·å–èŠå¤©IDï¼Œè¡¨æ ¼åˆ›å»ºå¤±è´¥')}catch(n){console.error('åˆ›å»ºè¡¨æ ¼å¤±è´¥:',n),window.toastr.error('åˆ›å»ºè¡¨æ ¼å¤±è´¥: '+n.message)}},jn=async()=>{try{if(console.log('éšè—æ¥¼å±‚...'),!d.value.trim())return void window.toastr.warning('è¯·è¾“å…¥è¦éšè—çš„æ¥¼å±‚èŒƒå›´');const n=d.value.split(',').map(n=>n.trim()),e=[];for(const t of n)if(t.includes('-')){const[n,o]=t.split('-').map(Number);if(n&&o&&n<=o)for(let t=n;t<=o;t++)e.push(t)}else{const n=Number(t);n&&e.push(n)}if(0===e.length)return void window.toastr.warning('è¯·è¾“å…¥æœ‰æ•ˆçš„æ¥¼å±‚èŒƒå›´');let t;try{const n=getLastMessageId();console.log('æœ€æ–°æ¶ˆæ¯ID:',n),t=getChatMessages(`0-${n}`,{hide_state:'all'}),console.log('è·å–åˆ°çš„æ¶ˆæ¯æ•°é‡:',t.length)}catch(n){return console.error('è·å–èŠå¤©æ¶ˆæ¯å¤±è´¥:',n),void window.toastr.error('è·å–èŠå¤©æ¶ˆæ¯å¤±è´¥: '+n.message)}if(!t||0===t.length)return void window.toastr.warning('å½“å‰èŠå¤©æ²¡æœ‰æ¶ˆæ¯');let o=0;const a=[];for(const n of e){const e=t.find(e=>e.message_id===n);e&&(a.push({message_id:n,is_hidden:!0}),un.value.push({message_id:n,name:e.name||'Unknown',role:e.role||'user',message:e.message||''}),o++)}if(a.length>0)try{console.log('å‡†å¤‡è°ƒç”¨ slash å‘½ä»¤éšè—æ¥¼å±‚:',e);for(const n of e)try{await triggerSlash(`/hide ${n}`),console.log(`æˆåŠŸéšè—æ¥¼å±‚ ${n}`)}catch(e){console.error(`éšè—æ¥¼å±‚ ${n} å¤±è´¥:`,e)}window.toastr.success('æ¥¼å±‚å·²çœŸæ­£éšè—')}catch(n){console.error('è°ƒç”¨éšè—APIå¤±è´¥:',n),window.toastr.error('éšè—æ¥¼å±‚APIè°ƒç”¨å¤±è´¥: '+n.message)}o>0?(zn(),window.toastr.success(`æˆåŠŸéšè— ${o} ä¸ªæ¥¼å±‚`),d.value=''):window.toastr.warning('æœªæ‰¾åˆ°è¦éšè—çš„æ¥¼å±‚')}catch(n){console.error('éšè—æ¥¼å±‚å¤±è´¥:',n),window.toastr.error('éšè—æ¥¼å±‚å¤±è´¥: '+n.message)}},Pn=async()=>{try{if(console.log('æ˜¾ç¤ºæŒ‡å®šæ¥¼å±‚...'),!d.value.trim())return void window.toastr.warning('è¯·è¾“å…¥è¦æ˜¾ç¤ºçš„æ¥¼å±‚èŒƒå›´');const n=(n=>{if(!n.trim())return[];const e=[],t=n.split(',');for(const n of t){const t=n.trim();if(t)if(t.includes('-')){const[n,o]=t.split('-').map(n=>parseInt(n.trim()));if(!isNaN(n)&&!isNaN(o)&&n>=0&&o>=0)for(let t=n;t<=o;t++)e.push(t)}else{const n=parseInt(t);!isNaN(n)&&n>=0&&e.push(n)}}return e})(d.value.trim());if(0===n.length)return void window.toastr.warning('è¯·è¾“å…¥æœ‰æ•ˆçš„æ¥¼å±‚èŒƒå›´');let e;try{const n=getLastMessageId();console.log('æœ€æ–°æ¶ˆæ¯ID:',n),e=getChatMessages(`0-${n}`,{hide_state:'all'}),console.log('è·å–åˆ°çš„æ¶ˆæ¯æ•°é‡:',e.length)}catch(n){return console.error('è·å–èŠå¤©æ¶ˆæ¯å¤±è´¥:',n),void window.toastr.error('è·å–èŠå¤©æ¶ˆæ¯å¤±è´¥: '+n.message)}if(!e||0===e.length)return void window.toastr.warning('å½“å‰èŠå¤©æ²¡æœ‰æ¶ˆæ¯');const t=[];let o=0;for(const a of n){e.find(n=>n.message_id===a)&&(t.push({message_id:a,is_hidden:!1}),o++)}if(0===t.length)return void window.toastr.warning('æœªæ‰¾åˆ°è¦æ˜¾ç¤ºçš„æ¥¼å±‚');try{for(const e of n)try{await triggerSlash(`/unhide ${e}`),console.log(`æˆåŠŸæ˜¾ç¤ºæ¥¼å±‚ ${e}`)}catch(n){console.error(`æ˜¾ç¤ºæ¥¼å±‚ ${e} å¤±è´¥:`,n)}}catch(n){return console.error('è°ƒç”¨æ˜¾ç¤ºAPIå¤±è´¥:',n),void window.toastr.error('æ˜¾ç¤ºæ¥¼å±‚APIè°ƒç”¨å¤±è´¥: '+n.message)}un.value=un.value.filter(e=>!n.includes(e.message_id)),zn(),window.toastr.success(`æˆåŠŸæ˜¾ç¤º ${o} ä¸ªæ¥¼å±‚`),d.value=''}catch(n){console.error('æ˜¾ç¤ºæ¥¼å±‚å¤±è´¥:',n),window.toastr.error('æ˜¾ç¤ºæ¥¼å±‚å¤±è´¥: '+n.message)}};return(n,e)=>((0,s.openBlock)(),(0,s.createElementBlock)('div',p,[(0,s.createCommentVNode)(' API é…ç½® '),(0,s.createElementVNode)('div',g,[e[23]||(e[23]=(0,s.createElementVNode)('h3',{style:{margin:'0 0 20px 0 !important',color:'#fff','font-size':'15px !important','font-weight':'bold',display:'flex','align-items':'center',gap:'8px'}},' ğŸ”§ API é…ç½® ',-1)),(0,s.createElementVNode)('div',u,[e[18]||(e[18]=(0,s.createElementVNode)('label',{style:{display:'block','margin-bottom':'6px',color:'#ccc','font-size':'13px'}},'API ç«¯ç‚¹',-1)),(0,s.withDirectives)((0,s.createElementVNode)('input',{'onUpdate:modelValue':e[0]||(e[0]=n=>(0,s.unref)(t).api_endpoint=n),type:'text',placeholder:'https://your-api.com/v1/chat/completions',style:{width:'100%',padding:'10px 12px',background:'#2a2a2a',border:'1px solid #3a3a3a','border-radius':'6px',color:'#e0e0e0','font-size':'13px',transition:'border-color 0.2s'}},null,512),[[s.vModelText,(0,s.unref)(t).api_endpoint]])]),(0,s.createElementVNode)('div',m,[e[19]||(e[19]=(0,s.createElementVNode)('label',{style:{display:'block','margin-bottom':'6px',color:'#ccc','font-size':'13px'}},'API Key',-1)),(0,s.withDirectives)((0,s.createElementVNode)('input',{'onUpdate:modelValue':e[1]||(e[1]=n=>(0,s.unref)(t).api_key=n),type:'password',placeholder:'sk-...',style:{width:'100%',padding:'10px 12px',background:'#2a2a2a',border:'1px solid #3a3a3a','border-radius':'6px',color:'#e0e0e0','font-size':'13px',transition:'border-color 0.2s'}},null,512),[[s.vModelText,(0,s.unref)(t).api_key]])]),(0,s.createElementVNode)('div',x,[(0,s.createElementVNode)('div',b,[e[20]||(e[20]=(0,s.createElementVNode)('label',{style:{display:'block','margin-bottom':'6px',color:'#ccc','font-size':'13px'}},'æ¨¡å‹åç§°',-1)),(0,s.createElementVNode)('div',f,[(0,s.createElementVNode)('button',{class:'test-button',style:{flex:'1','min-width':'120px',padding:'12px 16px',border:'1px solid #4a4a4a','border-radius':'6px',cursor:'pointer','font-weight':'500','font-size':'13px',transition:'all 0.2s',display:'flex','align-items':'center','justify-content':'center',gap:'6px',background:'#3a3a3a',color:'#e0e0e0'},onClick:Tn},' æµ‹è¯•æŒ‰é’®(åŸç”Ÿ) '),(0,s.createElementVNode)('button',{disabled:a.value,class:'fetch-button',style:{flex:'1','min-width':'120px',padding:'12px 16px',border:'1px solid #5aaeff','border-radius':'6px',cursor:'pointer','font-weight':'500','font-size':'13px',transition:'all 0.2s',display:'flex','align-items':'center','justify-content':'center',gap:'6px',background:'#4a9eff',color:'white'},onClick:Vn},(0,s.toDisplayString)(a.value?'æ‹‰å–ä¸­...':'æ‹‰å–æ¨¡å‹'),9,h)])]),0===o.value.length?(0,s.withDirectives)(((0,s.openBlock)(),(0,s.createElementBlock)('input',{key:0,'onUpdate:modelValue':e[2]||(e[2]=n=>(0,s.unref)(t).model=n),type:'text',placeholder:'gpt-4o-mini',style:{width:'100%',padding:'10px 12px',background:'#2a2a2a',border:'1px solid #3a3a3a','border-radius':'6px',color:'#e0e0e0','font-size':'13px',transition:'border-color 0.2s'}},null,512)),[[s.vModelText,(0,s.unref)(t).model]]):(0,s.withDirectives)(((0,s.openBlock)(),(0,s.createElementBlock)('select',{key:1,'onUpdate:modelValue':e[3]||(e[3]=n=>(0,s.unref)(t).model=n),class:'model-select',style:{width:'100%',padding:'10px 12px',background:'#2a2a2a',border:'1px solid #3a3a3a','border-radius':'6px',color:'#e0e0e0','font-size':'13px',transition:'border-color 0.2s'}},[((0,s.openBlock)(!0),(0,s.createElementBlock)(s.Fragment,null,(0,s.renderList)(o.value,n=>((0,s.openBlock)(),(0,s.createElementBlock)('option',{key:n,value:n},(0,s.toDisplayString)(n),9,y))),128))],512)),[[s.vModelSelect,(0,s.unref)(t).model]])]),(0,s.createElementVNode)('div',A,[e[21]||(e[21]=(0,s.createElementVNode)('label',{style:{display:'block','margin-bottom':'6px',color:'#ccc','font-size':'13px'}},'æœ€å¤§ Token æ•°ï¼ˆå»ºè®®4000ä»¥ä¸Šè·å¾—æ›´è¯¦ç»†çš„æ€»ç»“ï¼‰',-1)),(0,s.withDirectives)((0,s.createElementVNode)('input',{'onUpdate:modelValue':e[4]||(e[4]=n=>(0,s.unref)(t).max_tokens=n),type:'number',min:'100',max:'16000',style:{width:'100%',padding:'10px 12px',background:'#2a2a2a',border:'1px solid #3a3a3a','border-radius':'6px',color:'#e0e0e0','font-size':'13px',transition:'border-color 0.2s'}},null,512),[[s.vModelText,(0,s.unref)(t).max_tokens,void 0,{number:!0}]])]),(0,s.createElementVNode)('div',w,[e[22]||(e[22]=(0,s.createElementVNode)('label',{style:{display:'block','margin-bottom':'6px',color:'#ccc','font-size':'13px'}},'æ¸©åº¦ (0-2)',-1)),(0,s.withDirectives)((0,s.createElementVNode)('input',{'onUpdate:modelValue':e[5]||(e[5]=n=>(0,s.unref)(t).temperature=n),type:'number',min:'0',max:'2',step:'0.1',style:{width:'100%',padding:'10px 12px',background:'#2a2a2a',border:'1px solid #3a3a3a','border-radius':'6px',color:'#e0e0e0','font-size':'13px',transition:'border-color 0.2s'}},null,512),[[s.vModelText,(0,s.unref)(t).temperature,void 0,{number:!0}]])])]),(0,s.createCommentVNode)(' è‡ªåŠ¨æ€»ç»“ '),(0,s.createElementVNode)('div',C,[e[26]||(e[26]=(0,s.createElementVNode)('h3',{style:{margin:'0 0 20px 0 !important',color:'#fff','font-size':'15px !important','font-weight':'bold',display:'flex','align-items':'center',gap:'8px'}},' âš¡ è‡ªåŠ¨æ€»ç»“ ',-1)),(0,s.createElementVNode)('div',v,[(0,s.createElementVNode)('label',k,[(0,s.withDirectives)((0,s.createElementVNode)('input',{'onUpdate:modelValue':e[6]||(e[6]=n=>(0,s.unref)(t).auto_summarize_enabled=n),type:'checkbox',style:{width:'16px',height:'16px'}},null,512),[[s.vModelCheckbox,(0,s.unref)(t).auto_summarize_enabled]]),e[24]||(e[24]=(0,s.createTextVNode)(' å¯ç”¨è‡ªåŠ¨æ€»ç»“ ',-1))])]),(0,s.unref)(t).auto_summarize_enabled?((0,s.openBlock)(),(0,s.createElementBlock)('div',B,[e[25]||(e[25]=(0,s.createElementVNode)('label',{style:{display:'block','margin-bottom':'6px',color:'#ccc','font-size':'13px'}},'æ¯å¤šå°‘æ¥¼å±‚æ€»ç»“ä¸€æ¬¡',-1)),(0,s.withDirectives)((0,s.createElementVNode)('input',{'onUpdate:modelValue':e[7]||(e[7]=n=>(0,s.unref)(t).summarize_interval=n),type:'number',min:'1',style:{width:'100%',padding:'10px 12px',background:'#2a2a2a',border:'1px solid #3a3a3a','border-radius':'6px',color:'#e0e0e0','font-size':'13px',transition:'border-color 0.2s'}},null,512),[[s.vModelText,(0,s.unref)(t).summarize_interval,void 0,{number:!0}]]),(0,s.createElementVNode)('div',{style:{'margin-top':'10px',display:'flex',gap:'10px'}},[(0,s.createElementVNode)('button',{style:{padding:'8px 16px',background:'linear-gradient(135deg, #667eea 0%, #764ba2 100%)',border:'none','border-radius':'6px',color:'white','font-size':'12px',cursor:'pointer',transition:'all 0.3s ease','box-shadow':'0 2px 4px rgba(0, 0, 0, 0.2)'},onmouseover:'this.style.transform=\'translateY(-1px)\'; this.style.boxShadow=\'0 4px 8px rgba(0,0,0,0.3)\'',onmouseout:'this.style.transform=\'translateY(0)\'; this.style.boxShadow=\'0 2px 4px rgba(0,0,0,0.2)\'',onClick:In},' ğŸ’¾ ä¿å­˜è®¾ç½® '),(0,s.createElementVNode)('button',{style:{padding:'8px 16px',background:'linear-gradient(135deg, #f093fb 0%, #f5576c 100%)',border:'none','border-radius':'6px',color:'white','font-size':'12px',cursor:'pointer',transition:'all 0.3s ease','box-shadow':'0 2px 4px rgba(0, 0, 0, 0.2)'},onmouseover:'this.style.transform=\'translateY(-1px)\'; this.style.boxShadow=\'0 4px 8px rgba(0,0,0,0.3)\'',onmouseout:'this.style.transform=\'translateY(0)\'; this.style.boxShadow=\'0 2px 4px rgba(0,0,0,0.2)\'',onClick:Sn},' ğŸ”„ é‡æ–°åŠ è½½ '),(0,s.createElementVNode)('button',{style:{padding:'8px 16px',background:'linear-gradient(135deg, #ff9a9e 0%, #fecfef 100%)',border:'none','border-radius':'6px',color:'white','font-size':'12px',cursor:'pointer',transition:'all 0.3s ease','box-shadow':'0 2px 4px rgba(0, 0, 0, 0.2)'},onmouseover:'this.style.transform=\'translateY(-1px)\'; this.style.boxShadow=\'0 4px 8px rgba(0,0,0,0.3)\'',onmouseout:'this.style.transform=\'translateY(0)\'; this.style.boxShadow=\'0 2px 4px rgba(0,0,0,0.2)\'',onClick:Nn},' ğŸ”„ é‡ç½®èµ·å§‹æ¥¼å±‚ ')])])):(0,s.createCommentVNode)('v-if',!0)]),(0,s.createCommentVNode)(' æ‰‹åŠ¨æ€»ç»“ '),(0,s.createElementVNode)('div',E,[e[30]||(e[30]=(0,s.createElementVNode)('h3',{style:{margin:'0 0 20px 0 !important',color:'#fff','font-size':'15px !important','font-weight':'bold',display:'flex','align-items':'center',gap:'8px'}},' âœï¸ æ‰‹åŠ¨æ€»ç»“ ',-1)),(0,s.createElementVNode)('div',T,[e[27]||(e[27]=(0,s.createElementVNode)('label',{style:{display:'block','margin-bottom':'6px',color:'#ccc','font-size':'13px'}},'å¼€å§‹æ¥¼å±‚',-1)),(0,s.withDirectives)((0,s.createElementVNode)('input',{'onUpdate:modelValue':e[8]||(e[8]=n=>(0,s.unref)(t).start_message_id=n),type:'number',min:'0',style:{width:'100%',padding:'10px 12px',background:'#2a2a2a',border:'1px solid #3a3a3a','border-radius':'6px',color:'#e0e0e0','font-size':'13px',transition:'border-color 0.2s'}},null,512),[[s.vModelText,(0,s.unref)(t).start_message_id,void 0,{number:!0}]])]),(0,s.createElementVNode)('div',I,[e[28]||(e[28]=(0,s.createElementVNode)('label',{style:{display:'block','margin-bottom':'6px',color:'#ccc','font-size':'13px'}},'ç»“æŸæ¥¼å±‚',-1)),(0,s.withDirectives)((0,s.createElementVNode)('input',{'onUpdate:modelValue':e[9]||(e[9]=n=>(0,s.unref)(t).end_message_id=n),type:'number',min:'0',style:{width:'100%',padding:'10px 12px',background:'#2a2a2a',border:'1px solid #3a3a3a','border-radius':'6px',color:'#e0e0e0','font-size':'13px',transition:'border-color 0.2s'}},null,512),[[s.vModelText,(0,s.unref)(t).end_message_id,void 0,{number:!0}]])]),(0,s.createElementVNode)('div',S,[(0,s.createElementVNode)('button',{class:'action-button test-button',disabled:xn.value,style:{flex:'1','min-width':'120px',padding:'12px 16px',border:'1px solid #4a4a4a','border-radius':'6px',cursor:'pointer','font-weight':'500','font-size':'13px',transition:'all 0.2s',display:'flex','align-items':'center','justify-content':'center',gap:'6px',background:'#3a3a3a',color:'#e0e0e0'},onClick:Dn},[...e[29]||(e[29]=[(0,s.createElementVNode)('i',{class:'fa-solid fa-plug'},null,-1),(0,s.createTextVNode)(' æµ‹è¯•è¿æ¥ ',-1)])],8,N),(0,s.createElementVNode)('button',{class:'action-button summarize-button',disabled:xn.value||!(0,s.unref)(t).api_key,style:{flex:'1','min-width':'120px',padding:'12px 16px',border:'1px solid #5aaeff','border-radius':'6px',cursor:'pointer','font-weight':'500','font-size':'13px',transition:'all 0.2s',display:'flex','align-items':'center','justify-content':'center',gap:'6px',background:'#4a9eff',color:'white'},onClick:$n},[xn.value?((0,s.openBlock)(),(0,s.createElementBlock)('i',M)):((0,s.openBlock)(),(0,s.createElementBlock)('i',D)),(0,s.createTextVNode)(' '+(0,s.toDisplayString)(xn.value?'æ­£åœ¨æ€»ç»“...':'æ‰‹åŠ¨æ€»ç»“'),1)],8,V)])]),(0,s.createCommentVNode)(' è¡¨æ ¼ç”Ÿæˆ '),(0,s.createElementVNode)('div',F,[e[43]||(e[43]=(0,s.createElementVNode)('h3',{style:{margin:'0 0 20px 0 !important',color:'#fff','font-size':'15px !important','font-weight':'bold',display:'flex','align-items':'center',gap:'8px'}},' ğŸ“Š è¡¨æ ¼ç”Ÿæˆ ',-1)),(0,s.createElementVNode)('div',j,[e[31]||(e[31]=(0,s.createElementVNode)('label',{style:{display:'block','margin-bottom':'6px',color:'#ccc','font-size':'13px'}},'å¼€å§‹æ¥¼å±‚',-1)),(0,s.withDirectives)((0,s.createElementVNode)('input',{'onUpdate:modelValue':e[10]||(e[10]=n=>(0,s.unref)(t).table_start_message_id=n),type:'number',min:'0',style:{width:'100%',padding:'10px 12px',background:'#2a2a2a',border:'1px solid #3a3a3a','border-radius':'6px',color:'#e0e0e0','font-size':'13px',transition:'border-color 0.2s'}},null,512),[[s.vModelText,(0,s.unref)(t).table_start_message_id,void 0,{number:!0}]])]),(0,s.createElementVNode)('div',P,[e[32]||(e[32]=(0,s.createElementVNode)('label',{style:{display:'block','margin-bottom':'6px',color:'#ccc','font-size':'13px'}},'ç»“æŸæ¥¼å±‚',-1)),(0,s.withDirectives)((0,s.createElementVNode)('input',{'onUpdate:modelValue':e[11]||(e[11]=n=>(0,s.unref)(t).table_end_message_id=n),type:'number',min:'0',style:{width:'100%',padding:'10px 12px',background:'#2a2a2a',border:'1px solid #3a3a3a','border-radius':'6px',color:'#e0e0e0','font-size':'13px',transition:'border-color 0.2s'}},null,512),[[s.vModelText,(0,s.unref)(t).table_end_message_id,void 0,{number:!0}]])]),(0,s.createElementVNode)('div',O,[e[37]||(e[37]=(0,s.createElementVNode)('label',{style:{display:'block','margin-bottom':'6px',color:'#ccc','font-size':'13px'}},'è¡¨æ ¼åˆ—å¤´æ¨¡æ¿',-1)),(0,s.createElementVNode)('div',Y,[(0,s.withDirectives)((0,s.createElementVNode)('select',{'onUpdate:modelValue':e[12]||(e[12]=n=>hn.value=n),style:{flex:'1',padding:'8px 12px',background:'#2a2a2a',border:'1px solid #3a3a3a','border-radius':'6px',color:'#e0e0e0','font-size':'13px'},onChange:vn},[e[33]||(e[33]=(0,s.createElementVNode)('option',{value:''},'é€‰æ‹©æ¨¡æ¿...',-1)),((0,s.openBlock)(!0),(0,s.createElementBlock)(s.Fragment,null,(0,s.renderList)(fn.value,(n,e)=>((0,s.openBlock)(),(0,s.createElementBlock)('option',{key:e,value:e},(0,s.toDisplayString)(n.name),9,L))),128))],544),[[s.vModelSelect,hn.value]]),(0,s.createElementVNode)('button',{style:{padding:'8px 12px',background:'#4a9eff',border:'none','border-radius':'6px',color:'white',cursor:'pointer','font-size':'12px','white-space':'nowrap'},onClick:kn},[...e[34]||(e[34]=[(0,s.createElementVNode)('i',{class:'fa-solid fa-plus'},null,-1),(0,s.createTextVNode)(' æ·»åŠ  ',-1)])])]),''!==hn.value?((0,s.openBlock)(),(0,s.createElementBlock)('div',R,[(0,s.withDirectives)((0,s.createElementVNode)('input',{'onUpdate:modelValue':e[13]||(e[13]=n=>yn.value.name=n),type:'text',placeholder:'æ¨¡æ¿åç§°',style:{flex:'1',padding:'8px 12px',background:'#2a2a2a',border:'1px solid #3a3a3a','border-radius':'6px',color:'#e0e0e0','font-size':'13px'}},null,512),[[s.vModelText,yn.value.name]]),(0,s.withDirectives)((0,s.createElementVNode)('input',{'onUpdate:modelValue':e[14]||(e[14]=n=>yn.value.headers=n),type:'text',placeholder:'åˆ—å¤´ï¼ˆç”¨é€—å·åˆ†éš”ï¼‰',style:{flex:'2',padding:'8px 12px',background:'#2a2a2a',border:'1px solid #3a3a3a','border-radius':'6px',color:'#e0e0e0','font-size':'13px'}},null,512),[[s.vModelText,yn.value.headers]]),(0,s.createElementVNode)('button',{style:{padding:'8px 12px',background:'#28a745',border:'none','border-radius':'6px',color:'white',cursor:'pointer','font-size':'12px','white-space':'nowrap'},onClick:Bn},[...e[35]||(e[35]=[(0,s.createElementVNode)('i',{class:'fa-solid fa-save'},null,-1),(0,s.createTextVNode)(' ä¿å­˜ ',-1)])]),(0,s.createElementVNode)('button',{style:{padding:'8px 12px',background:'#dc3545',border:'none','border-radius':'6px',color:'white',cursor:'pointer','font-size':'12px','white-space':'nowrap'},onClick:_n},[...e[36]||(e[36]=[(0,s.createElementVNode)('i',{class:'fa-solid fa-trash'},null,-1),(0,s.createTextVNode)(' åˆ é™¤ ',-1)])])])):(0,s.createCommentVNode)('v-if',!0)]),(0,s.createCommentVNode)(' ç”ŸæˆçŠ¶æ€æ˜¾ç¤º '),(0,s.createElementVNode)('div',U,[e[41]||(e[41]=(0,s.createElementVNode)('label',{style:{display:'block','margin-bottom':'6px',color:'#ccc','font-size':'13px'}},'ç”ŸæˆçŠ¶æ€',-1)),(0,s.createElementVNode)('div',W,[(0,s.createElementVNode)('div',q,[(0,s.createElementVNode)('div',{style:(0,s.normalizeStyle)({width:'8px',height:'8px',borderRadius:'50%',backgroundColor:xn.value?'#ff6b6b':'#4caf50',transition:'background-color 0.3s'})},null,4),e[38]||(e[38]=(0,s.createElementVNode)('span',{style:{color:'#ccc','font-size':'12px'}},'æ€»ç»“ç”Ÿæˆ',-1))]),(0,s.createElementVNode)('div',H,[(0,s.createElementVNode)('div',{style:(0,s.normalizeStyle)({width:'8px',height:'8px',borderRadius:'50%',backgroundColor:bn.value?'#ff6b6b':'#4caf50',transition:'background-color 0.3s'})},null,4),e[39]||(e[39]=(0,s.createElementVNode)('span',{style:{color:'#ccc','font-size':'12px'}},'è¡¨æ ¼ç”Ÿæˆ',-1))]),xn.value||bn.value?((0,s.openBlock)(),(0,s.createElementBlock)('div',G,[(0,s.createElementVNode)('button',{style:{padding:'4px 8px',background:'#dc3545',border:'none','border-radius':'4px',color:'white',cursor:'pointer','font-size':'11px'},onClick:wn},[...e[40]||(e[40]=[(0,s.createElementVNode)('i',{class:'fa-solid fa-stop'},null,-1),(0,s.createTextVNode)(' åœæ­¢ç”Ÿæˆ ',-1)])])])):(0,s.createCommentVNode)('v-if',!0)])]),(0,s.createElementVNode)('div',J,[(0,s.createElementVNode)('button',{class:'action-button summarize-button',disabled:bn.value||!(0,s.unref)(t).api_key,style:{flex:'1','min-width':'120px',padding:'12px 16px',border:'1px solid #5aaeff','border-radius':'6px',cursor:'pointer','font-weight':'500','font-size':'13px',transition:'all 0.2s',display:'flex','align-items':'center','justify-content':'center',gap:'6px',background:'#4a9eff',color:'white'},onClick:Mn},[bn.value?((0,s.openBlock)(),(0,s.createElementBlock)('i',Q)):((0,s.openBlock)(),(0,s.createElementBlock)('i',Z)),(0,s.createTextVNode)(' '+(0,s.toDisplayString)(bn.value?'AIå¡«å……ä¸­...':'AIå¡«å……è¡¨æ ¼'),1)],8,K),(0,s.createElementVNode)('button',{class:'action-button create-button',style:{flex:'1','min-width':'120px',padding:'12px 16px',border:'1px solid #40c057','border-radius':'6px',cursor:'pointer','font-weight':'500','font-size':'13px',transition:'all 0.2s',display:'flex','align-items':'center','justify-content':'center',gap:'6px',background:'#51cf66',color:'white'},onClick:Fn},[...e[42]||(e[42]=[(0,s.createElementVNode)('i',{class:'fa-solid fa-plus'},null,-1),(0,s.createTextVNode)(' åˆ›å»ºç©ºè¡¨æ ¼ ',-1)])])])]),(0,s.createCommentVNode)(' æ¥¼å±‚ç®¡ç† '),(0,s.createElementVNode)('div',X,[e[48]||(e[48]=(0,s.createElementVNode)('h3',{style:{margin:'0 0 20px 0 !important',color:'#fff','font-size':'15px !important','font-weight':'bold',display:'flex','align-items':'center',gap:'8px'}},' ğŸ”§ æ¥¼å±‚ç®¡ç† ',-1)),(0,s.createElementVNode)('div',nn,[e[44]||(e[44]=(0,s.createElementVNode)('label',{style:{display:'block','margin-bottom':'6px',color:'#ccc','font-size':'13px'}},'éšè—æ¥¼å±‚èŒƒå›´ï¼ˆå¦‚ï¼š1-10 æˆ–å•ä¸ªæ¥¼å±‚å¦‚ï¼š5ï¼‰',-1)),(0,s.withDirectives)((0,s.createElementVNode)('input',{'onUpdate:modelValue':e[15]||(e[15]=n=>d.value=n),type:'text',placeholder:'1-10',style:{width:'100%',padding:'10px 12px',background:'#2a2a2a',border:'1px solid #3a3a3a','border-radius':'6px',color:'#e0e0e0','font-size':'13px',transition:'border-color 0.2s'}},null,512),[[s.vModelText,d.value]])]),(0,s.createElementVNode)('div',en,[(0,s.createElementVNode)('button',{class:'action-button',style:{flex:'1','min-width':'120px',padding:'12px 16px',border:'1px solid #ff5252','border-radius':'6px',cursor:'pointer','font-weight':'500','font-size':'13px',transition:'all 0.2s',display:'flex','align-items':'center','justify-content':'center',gap:'6px',background:'#ff6b6b',color:'white'},onClick:jn},[...e[45]||(e[45]=[(0,s.createElementVNode)('i',{class:'fa-solid fa-eye-slash'},null,-1),(0,s.createTextVNode)(' éšè—æ¥¼å±‚ ',-1)])]),(0,s.createElementVNode)('button',{class:'action-button',style:{flex:'1','min-width':'120px',padding:'12px 16px',border:'1px solid #40c057','border-radius':'6px',cursor:'pointer','font-weight':'500','font-size':'13px',transition:'all 0.2s',display:'flex','align-items':'center','justify-content':'center',gap:'6px',background:'#51cf66',color:'white'},disabled:!d.value.trim(),onClick:Pn},[...e[46]||(e[46]=[(0,s.createElementVNode)('i',{class:'fa-solid fa-eye'},null,-1),(0,s.createTextVNode)(' æ˜¾ç¤ºæ¥¼å±‚ ',-1)])],8,tn),(0,s.createElementVNode)('button',{class:'action-button',style:{flex:'1','min-width':'120px',padding:'12px 16px',border:'1px solid #ffcc02','border-radius':'6px',cursor:'pointer','font-weight':'500','font-size':'13px',transition:'all 0.2s',display:'flex','align-items':'center','justify-content':'center',gap:'6px',background:'#ffd43b',color:'#333'},onClick:e[16]||(e[16]=()=>(async(n=!1)=>{try{let e;console.log('åˆ·æ–°éšè—æ¥¼å±‚',n),0===un.value.length&&(console.log('éšè—æ¥¼å±‚åˆ—è¡¨ä¸ºç©ºï¼Œå…ˆåŠ è½½æ•°æ®...'),En());try{const n=getLastMessageId();console.log('æœ€æ–°æ¶ˆæ¯ID:',n),e=getChatMessages(`0-${n}`,{hide_state:'all'}),console.log('è·å–åˆ°çš„æ¶ˆæ¯æ•°é‡:',e.length)}catch(e){return console.error('è·å–èŠå¤©æ¶ˆæ¯å¤±è´¥:',e),void(n&&window.toastr.error('è·å–èŠå¤©æ¶ˆæ¯å¤±è´¥: '+e.message))}if(!e||0===e.length)return void(n&&window.toastr.warning('å½“å‰èŠå¤©æ²¡æœ‰æ¶ˆæ¯'));const t=[];let o=0;for(const n of un.value){const a=e.find(e=>e.message_id===n.message_id);a?t.push({message_id:n.message_id,name:a.name||n.name,role:a.role||n.role,message:a.message||n.message}):o++}un.value=t,zn(),n&&(o>0?window.toastr.success(`åˆ·æ–°å®Œæˆï¼Œç§»é™¤äº† ${o} ä¸ªä¸å­˜åœ¨çš„æ¥¼å±‚`):window.toastr.success('åˆ·æ–°å®Œæˆï¼Œæ‰€æœ‰éšè—æ¥¼å±‚ä»ç„¶æœ‰æ•ˆ')),console.log(`åˆ·æ–°å®Œæˆï¼š${t.length} ä¸ªæœ‰æ•ˆéšè—æ¥¼å±‚ï¼Œ${o} ä¸ªå·²ç§»é™¤`)}catch(e){console.error('åˆ·æ–°éšè—æ¥¼å±‚å¤±è´¥:',e),n&&window.toastr.error('åˆ·æ–°éšè—æ¥¼å±‚å¤±è´¥: '+e.message)}})(!0))},[...e[47]||(e[47]=[(0,s.createElementVNode)('i',{class:'fa-solid fa-refresh'},null,-1),(0,s.createTextVNode)(' åˆ·æ–° ',-1)])])]),(0,s.createCommentVNode)(' æ˜¾ç¤ºéšè—çš„æ¥¼å±‚åˆ—è¡¨ '),un.value.length>0?((0,s.openBlock)(),(0,s.createElementBlock)('div',on,[(0,s.createElementVNode)('div',an,[(0,s.createElementVNode)('label',rn,[(0,s.createElementVNode)('span',null,'å·²éšè—çš„æ¥¼å±‚ ('+(0,s.toDisplayString)(un.value.length)+' ä¸ª)',1),(0,s.createElementVNode)('button',{class:'mini-button',onClick:e[17]||(e[17]=n=>mn.value=!mn.value)},(0,s.toDisplayString)(mn.value?'æ”¶èµ·':'å±•å¼€'),1)])]),mn.value?((0,s.openBlock)(),(0,s.createElementBlock)('div',sn,[((0,s.openBlock)(!0),(0,s.createElementBlock)(s.Fragment,null,(0,s.renderList)(un.value,n=>((0,s.openBlock)(),(0,s.createElementBlock)('div',{key:n.message_id,class:'hidden-message-item'},[(0,s.createElementVNode)('div',ln,[(0,s.createElementVNode)('span',dn,'#'+(0,s.toDisplayString)(n.message_id),1),(0,s.createElementVNode)('span',{class:(0,s.normalizeClass)(['message-role','role-'+n.role])},(0,s.toDisplayString)('user'===n.role?'ğŸ‘¤':'assistant'===n.role?'ğŸ¤–':'âš™ï¸')+' '+(0,s.toDisplayString)(n.name),3),(0,s.createElementVNode)('span',cn,(0,s.toDisplayString)(n.message.substring(0,50))+(0,s.toDisplayString)(n.message.length>50?'...':''),1)]),(0,s.createElementVNode)('button',{class:'show-button',onClick:()=>(async n=>{try{console.log('æ˜¾ç¤ºå•ä¸ªæ¥¼å±‚',n);const e=un.value.findIndex(e=>e.message_id===n);if(-1===e)return void window.toastr.warning(`æ¥¼å±‚ #${n} ä¸åœ¨éšè—åˆ—è¡¨ä¸­`);try{await triggerSlash(`/unhide ${n}`),console.log('æˆåŠŸæ˜¾ç¤ºæ¥¼å±‚:',n)}catch(n){return console.error('è°ƒç”¨æ˜¾ç¤ºAPIå¤±è´¥:',n),void window.toastr.warning('æ˜¾ç¤ºæ¥¼å±‚APIè°ƒç”¨å¤±è´¥')}un.value.splice(e,1),zn(),window.toastr.success(`å·²æ˜¾ç¤ºæ¥¼å±‚ #${n}`)}catch(n){console.error('æ˜¾ç¤ºå•ä¸ªæ¥¼å±‚å¤±è´¥:',n),window.toastr.error('æ˜¾ç¤ºå•ä¸ªæ¥¼å±‚å¤±è´¥: '+n.message)}})(n.message_id)},'æ˜¾ç¤º',8,pn)]))),128))])):(0,s.createCommentVNode)('v-if',!0)])):((0,s.openBlock)(),(0,s.createElementBlock)('div',gn,'æš‚æ— éšè—çš„æ¥¼å±‚'))])]))}});r(493);const mn=un,xn={class:'summary-tab',style:{padding:'25px !important',background:'#1a1a1a !important'}},bn={class:'section-header',style:{display:'flex','justify-content':'space-between','align-items':'center',padding:'20px 25px !important','border-bottom':'1px solid #3a3a3a','margin-bottom':'5px'}},fn={class:'header-actions',style:{display:'flex','align-items':'center',gap:'10px'}},hn={key:0,class:'count-badge',style:{background:'#4a9eff',color:'white',padding:'4px 8px','border-radius':'12px','font-size':'12px'}},yn={key:0,class:'history-list',style:{display:'flex','flex-direction':'column',gap:'15px','margin-top':'20px'}},An=['onClick'],wn={class:'history-info',style:{display:'flex','align-items':'center',gap:'10px',flex:'1'}},Cn={class:'history-number',style:{color:'#4a9eff','font-weight':'bold'}},vn={class:'history-range',style:{color:'#888','font-size':'12px'}},kn={class:'expand-icon',style:{color:'#888','font-size':'12px'}},Bn={key:0,class:'history-content',style:{padding:'15px',background:'#2a2a2a','border-radius':'0 0 6px 6px'}},_n={class:'history-actions',style:{display:'flex',gap:'8px','margin-bottom':'12px','padding-bottom':'8px','border-bottom':'1px solid #3a3a3a'}},En=['onClick'],zn=['onClick'],Tn=['onClick'],In={class:'history-text',style:{'font-family':'\'Courier New\', monospace','font-size':'13px','line-height':'1.6',color:'#e0e0e0','white-space':'pre-wrap','word-wrap':'break-word','user-select':'text',cursor:'text'}},Sn={key:1,class:'empty-state',style:{'text-align':'center',padding:'40px 20px',color:'#888'}},Nn=(0,s.defineComponent)({__name:'SummaryTab',setup(n){const e=(0,i.l)(),t=(0,s.ref)([]),o=(0,s.ref)(new Map),a=()=>{try{t.value=e.getSummaryHistory(),console.log('å·²åˆ·æ–°æ€»ç»“å†å²ï¼Œå½“å‰èŠå¤©è®°å½•æ•°:',t.value.length)}catch(n){console.error('åˆ·æ–°æ€»ç»“å†å²å¤±è´¥:',n),t.value=[]}},r=n=>o.value.get(n)||!1,d=async()=>{console.log('åˆ·æ–°æ•°æ®æŒ‰é’®è¢«ç‚¹å‡»');try{await a(),window.toastr.success('æ•°æ®å·²åˆ·æ–°')}catch(n){console.error('åˆ·æ–°æ•°æ®å¤±è´¥:',n),window.toastr.error('åˆ·æ–°æ•°æ®å¤±è´¥: '+n.message)}},c=async n=>new Promise(e=>{try{const t=window.parent.document,o=window.parent.document.body,a=t.createElement('textarea');a.value=n,a.style.cssText='\n        position: fixed;\n        left: -9999px;\n        top: -9999px;\n        opacity: 0;\n        pointer-events: none;\n        z-index: -1000;\n      ',a.setAttribute('readonly',''),o.appendChild(a),a.focus(),a.select(),a.setSelectionRange(0,n.length);const r=t.execCommand('copy');o.removeChild(a),e(r)}catch(n){console.error('çˆ¶çª—å£å¤åˆ¶å¤±è´¥:',n),e(!1)}}),p=async n=>new Promise(e=>{try{const t=document.createElement('textarea');t.value=n,t.style.position='fixed',t.style.left='-9999px',t.style.top='-9999px',t.style.opacity='0',t.style.pointerEvents='none',t.setAttribute('readonly',''),document.body.appendChild(t),t.select(),t.setSelectionRange(0,n.length);const o=document.execCommand('copy');document.body.removeChild(t),e(o)}catch(n){console.error('execCommand å¤åˆ¶å¤±è´¥:',n),e(!1)}}),g=n=>{console.log('æ˜¾ç¤ºæ‰‹åŠ¨å¤åˆ¶å¯¹è¯æ¡†ï¼Œæ–‡æœ¬é•¿åº¦:',n.length);try{const e=window.parent.document,t=window.parent.document.body,o=e.getElementById('manual-copy-overlay');o&&t.removeChild(o);const a=e.createElement('div');a.id='manual-copy-overlay',a.style.cssText='\n      position: fixed;\n      top: 0;\n      left: 0;\n      right: 0;\n      bottom: 0;\n      background: rgba(0, 0, 0, 0.95);\n      z-index: 999999;\n      display: flex;\n      align-items: center;\n      justify-content: center;\n      font-family: -apple-system, BlinkMacSystemFont, \'Segoe UI\', Roboto, sans-serif;\n    ';const r=e.createElement('div');r.style.cssText='\n      background: #2a2a2a;\n      border: 2px solid #4a9eff;\n      border-radius: 12px;\n      padding: 25px;\n      max-width: 900px;\n      width: 95%;\n      max-height: 85vh;\n      display: flex;\n      flex-direction: column;\n      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);\n    ';const s=e.createElement('div');s.innerHTML='\n      <h3 style="margin: 0 0 15px 0; color: #4a9eff; text-align: center; font-size: 18px; font-weight: 600;">\n        ğŸ“‹ æ‰‹åŠ¨å¤åˆ¶æ€»ç»“å†…å®¹\n      </h3>\n      <div style="background: #1a1a1a; border: 1px solid #444; border-radius: 6px; padding: 12px; margin-bottom: 15px;">\n        <p style="margin: 0 0 8px 0; color: #e0e0e0; font-size: 14px;">\n          <strong>æ“ä½œæ­¥éª¤ï¼š</strong>\n        </p>\n        <ol style="margin: 0; padding-left: 20px; color: #ccc; font-size: 13px; line-height: 1.6;">\n          <li>ç‚¹å‡»ä¸‹æ–¹æ–‡æœ¬æ¡†</li>\n          <li>æŒ‰ <kbd style="background: #444; padding: 2px 6px; border-radius: 3px; color: #fff;">Ctrl+A</kbd> å…¨é€‰æ–‡æœ¬</li>\n          <li>æŒ‰ <kbd style="background: #444; padding: 2px 6px; border-radius: 3px; color: #fff;">Ctrl+C</kbd> å¤åˆ¶åˆ°å‰ªè´´æ¿</li>\n          <li>ç‚¹å‡»"å…³é—­"æŒ‰é’®æˆ–æŒ‰ <kbd style="background: #444; padding: 2px 6px; border-radius: 3px; color: #fff;">Esc</kbd> å…³é—­å¯¹è¯æ¡†</li>\n        </ol>\n      </div>\n    ';const i=e.createElement('textarea');i.value=n,i.style.cssText='\n      width: 100%;\n      height: 400px;\n      background: #1a1a1a;\n      border: 2px solid #444;\n      border-radius: 6px;\n      padding: 15px;\n      color: #e0e0e0;\n      font-family: \'Courier New\', \'Consolas\', monospace;\n      font-size: 13px;\n      line-height: 1.5;\n      resize: vertical;\n      white-space: pre-wrap;\n      word-wrap: break-word;\n      outline: none;\n      margin-bottom: 20px;\n      box-sizing: border-box;\n    ';const l=e.createElement('div');l.style.cssText='\n      display: flex;\n      gap: 12px;\n      justify-content: center;\n      align-items: center;\n    ';const d=e.createElement('button');d.textContent='å…³é—­',d.style.cssText='\n      background: #4a9eff;\n      color: white;\n      border: none;\n      padding: 12px 24px;\n      border-radius: 6px;\n      cursor: pointer;\n      font-size: 14px;\n      font-weight: 500;\n      transition: background 0.2s;\n    ',d.onmouseover=()=>{d.style.background='#5ba8ff'},d.onmouseout=()=>{d.style.background='#4a9eff'};const c=e.createElement('button');c.textContent='å°è¯•è‡ªåŠ¨å¤åˆ¶',c.style.cssText='\n      background: #28a745;\n      color: white;\n      border: none;\n      padding: 12px 24px;\n      border-radius: 6px;\n      cursor: pointer;\n      font-size: 14px;\n      font-weight: 500;\n      transition: background 0.2s;\n    ',c.onmouseover=()=>{c.style.background='#218838'},c.onmouseout=()=>{c.style.background='#28a745'},l.appendChild(c),l.appendChild(d),r.appendChild(s),r.appendChild(i),r.appendChild(l),a.appendChild(r),t.appendChild(a),d.onclick=()=>{console.log('å…³é—­æŒ‰é’®è¢«ç‚¹å‡»'),t.removeChild(a)},c.onclick=async()=>{console.log('å°è¯•è‡ªåŠ¨å¤åˆ¶æŒ‰é’®è¢«ç‚¹å‡»');try{i.focus(),i.select();document.execCommand('copy')?(window.toastr.success('è‡ªåŠ¨å¤åˆ¶æˆåŠŸï¼'),t.removeChild(a)):window.toastr.warning('è‡ªåŠ¨å¤åˆ¶å¤±è´¥ï¼Œè¯·æ‰‹åŠ¨å¤åˆ¶')}catch(n){console.error('è‡ªåŠ¨å¤åˆ¶å¤±è´¥:',n),window.toastr.warning('è‡ªåŠ¨å¤åˆ¶å¤±è´¥ï¼Œè¯·æ‰‹åŠ¨å¤åˆ¶')}},a.onclick=n=>{n.target===a&&(console.log('ç‚¹å‡»èƒŒæ™¯å…³é—­'),t.removeChild(a))};const p=n=>{'Escape'===n.key&&(console.log('æŒ‰ESCé”®å…³é—­'),t.removeChild(a),e.removeEventListener('keydown',p))};e.addEventListener('keydown',p),setTimeout(()=>{console.log('è‡ªåŠ¨é€‰ä¸­æ–‡æœ¬'),i.focus(),i.select()},200),window.toastr.info('æ‰‹åŠ¨å¤åˆ¶å¯¹è¯æ¡†å·²æ‰“å¼€ï¼Œè¯·æŒ‰ç…§æç¤ºæ“ä½œ')}catch(n){console.error('åˆ›å»ºæ‰‹åŠ¨å¤åˆ¶å¯¹è¯æ¡†å¤±è´¥:',n),window.toastr.error('æ— æ³•æ˜¾ç¤ºå¤åˆ¶å¯¹è¯æ¡†ï¼Œè¯·æ£€æŸ¥æµè§ˆå™¨æƒé™')}},u=n=>{(async(n,e='å†…å®¹å·²å¤åˆ¶åˆ°å‰ªè´´æ¿')=>{console.log('å¼€å§‹å¤åˆ¶ï¼Œæ–‡æœ¬é•¿åº¦:',n.length);try{if(window.parent&&window.parent!==window&&(console.log('æ£€æµ‹åˆ°iframeç¯å¢ƒï¼Œå°è¯•åœ¨çˆ¶çª—å£å¤åˆ¶'),await c(n)))return console.log('çˆ¶çª—å£å¤åˆ¶æˆåŠŸ'),void window.toastr.success(e);if(navigator.clipboard&&window.isSecureContext){console.log('ä½¿ç”¨ç°ä»£ Clipboard API');try{return await navigator.clipboard.writeText(n),console.log('Clipboard API å¤åˆ¶æˆåŠŸ'),void window.toastr.success(e)}catch(n){console.warn('Clipboard API å¤±è´¥:',n)}}if(console.log('ä½¿ç”¨ execCommand æ–¹æ³•'),await p(n))return console.log('execCommand å¤åˆ¶æˆåŠŸ'),void window.toastr.success(e);console.log('æ‰€æœ‰è‡ªåŠ¨å¤åˆ¶æ–¹æ³•éƒ½å¤±è´¥ï¼Œæ˜¾ç¤ºæ‰‹åŠ¨å¤åˆ¶ç•Œé¢'),g(n)}catch(e){console.error('å¤åˆ¶å¼‚å¸¸:',e),g(n)}})(n,'æ€»ç»“å·²å¤åˆ¶åˆ°å‰ªè´´æ¿')},m=async()=>{try{let n='æœªçŸ¥è§’è‰²';try{const e=getCharData('current');e&&e.name&&(n=e.name,n=n.replace(/[<>:"/\\|?*]/g,'_').trim())}catch(n){console.warn('è·å–è§’è‰²ä¿¡æ¯å¤±è´¥:',n)}const e=`æ€»ç»“_${n}_${(new Date).toISOString().slice(0,10)}`;console.log('å‡†å¤‡åˆ›å»ºä¸–ç•Œä¹¦:',e);if(getWorldbookNames().includes(e))return void window.toastr.warning(`ä¸–ç•Œä¹¦ "${e}" å·²å­˜åœ¨`);await createWorldbook(e,[]);try{await rebindChatWorldbook('current',e),window.toastr.success(`å·²åˆ›å»ºæ€»ç»“ä¸–ç•Œä¹¦ "${e}" å¹¶ç»‘å®šåˆ°å½“å‰èŠå¤©`)}catch(n){console.warn('ç»‘å®šåˆ°èŠå¤©å¤±è´¥:',n),window.toastr.success(`å·²åˆ›å»ºæ€»ç»“ä¸–ç•Œä¹¦ "${e}"ï¼Œè¯·æ‰‹åŠ¨åœ¨èŠå¤©çŸ¥è¯†ä¹¦ä¸­ç»‘å®š`)}}catch(n){console.error('åˆ›å»ºæ€»ç»“ä¸–ç•Œä¹¦å¤±è´¥:',n),window.toastr.error('åˆ›å»ºæ€»ç»“ä¸–ç•Œä¹¦å¤±è´¥: '+n.message)}},x=async n=>new Promise(e=>{const t=$(`\n      <div style="\n        position: fixed;\n        top: 50%;\n        left: 50%;\n        transform: translate(-50%, -50%);\n        background: #2a2a2a;\n        border: 1px solid #3a3a3a;\n        border-radius: 8px;\n        padding: 20px;\n        z-index: 1000000;\n        min-width: 300px;\n      ">\n        <h3 style="margin: 0 0 15px 0; color: #e0e0e0;">é€‰æ‹©ä¸–ç•Œä¹¦</h3>\n        <div style="margin-bottom: 15px;">\n          ${n.map(n=>`\n            <label style="display: block; margin: 5px 0; color: #e0e0e0;">\n              <input type="radio" name="worldbook" value="${n}" style="margin-right: 8px;">\n              ${n}\n            </label>\n          `).join('')}\n        </div>\n        <div style="text-align: right;">\n          <button id="cancelWorldbook" style="\n            background: #666;\n            color: white;\n            border: none;\n            padding: 8px 16px;\n            border-radius: 4px;\n            margin-right: 10px;\n            cursor: pointer;\n          ">å–æ¶ˆ</button>\n          <button id="confirmWorldbook" style="\n            background: #4a9eff;\n            color: white;\n            border: none;\n            padding: 8px 16px;\n            border-radius: 4px;\n            cursor: pointer;\n          ">ç¡®å®š</button>\n        </div>\n      </div>\n    `),o=$('\n      <div style="\n        position: fixed;\n        top: 0;\n        left: 0;\n        width: 100%;\n        height: 100%;\n        background: rgba(0, 0, 0, 0.5);\n        z-index: 999999;\n      "></div>\n    ');$('body').append(o).append(t),$('#cancelWorldbook').on('click',()=>{o.remove(),t.remove(),e(null)}),$('#confirmWorldbook').on('click',()=>{const n=$('input[name="worldbook"]:checked').val();o.remove(),t.remove(),e(n||null)}),$('input[name="worldbook"]:first').prop('checked',!0)}),b=()=>{try{const n=window.parent.document,e=window.parent.document.body,t=n.getElementById('debug-panel-overlay');t&&e.removeChild(t);const o=n.createElement('div');o.id='debug-panel-overlay',o.style.cssText='\n      position: fixed;\n      top: 0;\n      left: 0;\n      right: 0;\n      bottom: 0;\n      background: rgba(0, 0, 0, 0.95);\n      z-index: 999999;\n      display: flex;\n      align-items: center;\n      justify-content: center;\n      font-family: -apple-system, BlinkMacSystemFont, \'Segoe UI\', Roboto, sans-serif;\n    ';const a=n.createElement('div');a.style.cssText='\n      background: #2a2a2a;\n      border: 2px solid #ffc107;\n      border-radius: 12px;\n      padding: 25px;\n      max-width: 800px;\n      width: 95%;\n      max-height: 85vh;\n      display: flex;\n      flex-direction: column;\n      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);\n    ';const r=n.createElement('div');r.innerHTML='\n      <h3 style="margin: 0 0 15px 0; color: #ffc107; text-align: center; font-size: 18px; font-weight: 600;">\n        ğŸ› è‡ªåŠ¨æ€»ç»“è°ƒè¯•å·¥å…·\n      </h3>\n      <div style="background: #1a1a1a; border: 1px solid #444; border-radius: 6px; padding: 12px; margin-bottom: 15px;">\n        <p style="margin: 0 0 8px 0; color: #e0e0e0; font-size: 14px;">\n          <strong>è°ƒè¯•åŠŸèƒ½ï¼š</strong>\n        </p>\n        <ul style="margin: 0; padding-left: 20px; color: #ccc; font-size: 13px; line-height: 1.6;">\n          <li>æµ‹è¯•è‡ªåŠ¨æ€»ç»“æµç¨‹</li>\n          <li>åŒæ­¥localStorageæ•°æ®åˆ°é…’é¦†åŠ©æ‰‹å˜é‡</li>\n          <li>æ£€æŸ¥å½“å‰æ¥¼å±‚çŠ¶æ€</li>\n          <li>éªŒè¯è§¦å‘æ¡ä»¶è®¡ç®—</li>\n        </ul>\n      </div>\n    ';const s=n.createElement('div');s.style.cssText='\n      display: grid;\n      grid-template-columns: 1fr 1fr;\n      gap: 12px;\n      margin-bottom: 20px;\n    ';[{id:'testComplete',text:'ğŸ§ª æµ‹è¯•å®Œæ•´æµç¨‹',color:'#4a9eff'},{id:'syncData',text:'ğŸ”„ åŒæ­¥æ•°æ®',color:'#28a745'},{id:'checkFloor',text:'ğŸ” æ£€æŸ¥æ¥¼å±‚',color:'#17a2b8'},{id:'testCalculation',text:'ğŸ§® éªŒè¯è®¡ç®—',color:'#6f42c1'},{id:'showStatus',text:'ğŸ“Š æ˜¾ç¤ºçŠ¶æ€',color:'#fd7e14'},{id:'resetStartId',text:'ğŸ”„ é‡ç½®èµ·å§‹æ¥¼å±‚',color:'#dc3545'}].forEach(e=>{const t=n.createElement('button');t.id=e.id,t.textContent=e.text,t.style.cssText=`\n        background: ${e.color};\n        color: white;\n        border: none;\n        padding: 12px 16px;\n        border-radius: 6px;\n        cursor: pointer;\n        font-size: 13px;\n        font-weight: 500;\n        transition: background 0.2s;\n      `,t.onmouseover=()=>{t.style.opacity='0.8'},t.onmouseout=()=>{t.style.opacity='1'},s.appendChild(t)});const i=n.createElement('div');i.id='debug-output',i.style.cssText='\n      background: #1a1a1a;\n      border: 1px solid #444;\n      border-radius: 6px;\n      padding: 15px;\n      height: 200px;\n      overflow-y: auto;\n      font-family: \'Courier New\', \'Consolas\', monospace;\n      font-size: 12px;\n      color: #e0e0e0;\n      white-space: pre-wrap;\n      margin-bottom: 20px;\n    ',i.textContent='ç‚¹å‡»ä¸Šæ–¹æŒ‰é’®å¼€å§‹è°ƒè¯•...\n';const l=n.createElement('button');l.textContent='å…³é—­',l.style.cssText='\n      background: #6c757d;\n      color: white;\n      border: none;\n      padding: 12px 24px;\n      border-radius: 6px;\n      cursor: pointer;\n      font-size: 14px;\n      font-weight: 500;\n      transition: background 0.2s;\n      align-self: center;\n    ',a.appendChild(r),a.appendChild(s),a.appendChild(i),a.appendChild(l),o.appendChild(a),e.appendChild(o);const d=e=>{const t=n.getElementById('debug-output');t&&(t.textContent+=e+'\n',t.scrollTop=t.scrollHeight)};l.onclick=()=>{e.removeChild(o)},n.getElementById('testComplete')?.addEventListener('click',()=>{d('ğŸ§ª å¼€å§‹æµ‹è¯•å®Œæ•´è‡ªåŠ¨æ€»ç»“æµç¨‹...');try{window.testCompleteAutoSummary?(window.testCompleteAutoSummary(),d('âœ… æµ‹è¯•å‡½æ•°å·²æ‰§è¡Œï¼Œè¯·æŸ¥çœ‹æ§åˆ¶å°è¾“å‡º')):d('âŒ æµ‹è¯•å‡½æ•°ä¸å¯ç”¨')}catch(n){d('âŒ æµ‹è¯•å¤±è´¥: '+n.message)}}),n.getElementById('syncData')?.addEventListener('click',()=>{d('ğŸ”„ å¼€å§‹åŒæ­¥æ•°æ®...');try{window.syncAutoSummaryData?(window.syncAutoSummaryData(),d('âœ… åŒæ­¥å‡½æ•°å·²æ‰§è¡Œï¼Œè¯·æŸ¥çœ‹æ§åˆ¶å°è¾“å‡º')):d('âŒ åŒæ­¥å‡½æ•°ä¸å¯ç”¨')}catch(n){d('âŒ åŒæ­¥å¤±è´¥: '+n.message)}}),n.getElementById('checkFloor')?.addEventListener('click',()=>{d('ğŸ” å¼€å§‹æ£€æŸ¥æ¥¼å±‚...');try{window.checkCurrentFloor?(window.checkCurrentFloor(),d('âœ… æ¥¼å±‚æ£€æŸ¥å‡½æ•°å·²æ‰§è¡Œï¼Œè¯·æŸ¥çœ‹æ§åˆ¶å°è¾“å‡º')):d('âŒ æ¥¼å±‚æ£€æŸ¥å‡½æ•°ä¸å¯ç”¨')}catch(n){d('âŒ æ¥¼å±‚æ£€æŸ¥å¤±è´¥: '+n.message)}}),n.getElementById('testCalculation')?.addEventListener('click',()=>{d('ğŸ§® å¼€å§‹éªŒè¯è®¡ç®—...');try{window.testFloorCalculation?(window.testFloorCalculation(),d('âœ… è®¡ç®—éªŒè¯å‡½æ•°å·²æ‰§è¡Œï¼Œè¯·æŸ¥çœ‹æ§åˆ¶å°è¾“å‡º')):d('âŒ è®¡ç®—éªŒè¯å‡½æ•°ä¸å¯ç”¨')}catch(n){d('âŒ è®¡ç®—éªŒè¯å¤±è´¥: '+n.message)}}),n.getElementById('showStatus')?.addEventListener('click',()=>{d('ğŸ“Š å¼€å§‹æ˜¾ç¤ºçŠ¶æ€...');try{window.checkAutoSummaryStatus?(window.checkAutoSummaryStatus(),d('âœ… çŠ¶æ€æ£€æŸ¥å‡½æ•°å·²æ‰§è¡Œï¼Œè¯·æŸ¥çœ‹æ§åˆ¶å°è¾“å‡º')):d('âŒ çŠ¶æ€æ£€æŸ¥å‡½æ•°ä¸å¯ç”¨')}catch(n){d('âŒ çŠ¶æ€æ£€æŸ¥å¤±è´¥: '+n.message)}}),n.getElementById('resetStartId')?.addEventListener('click',()=>{d('ğŸ”„ å¼€å§‹é‡ç½®èµ·å§‹æ¥¼å±‚...');try{window.smartResetChat?(window.smartResetChat(),d('âœ… é‡ç½®å‡½æ•°å·²æ‰§è¡Œï¼Œè¯·æŸ¥çœ‹æ§åˆ¶å°è¾“å‡º')):d('âŒ é‡ç½®å‡½æ•°ä¸å¯ç”¨')}catch(n){d('âŒ é‡ç½®å¤±è´¥: '+n.message)}}),o.onclick=n=>{n.target===o&&e.removeChild(o)};const c=t=>{'Escape'===t.key&&(e.removeChild(o),n.removeEventListener('keydown',c))};n.addEventListener('keydown',c),window.toastr?.info('è°ƒè¯•é¢æ¿å·²æ‰“å¼€')}catch(n){console.error('åˆ›å»ºè°ƒè¯•é¢æ¿å¤±è´¥:',n),window.toastr?.error('æ— æ³•æ˜¾ç¤ºè°ƒè¯•é¢æ¿ï¼Œè¯·æ£€æŸ¥æµè§ˆå™¨æƒé™')}};return a(),(n,e)=>((0,s.openBlock)(),(0,s.createElementBlock)('div',xn,[(0,s.createElementVNode)('div',bn,[e[3]||(e[3]=(0,s.createElementVNode)('h3',{style:{margin:'0',color:'#fff','font-size':'15px !important','font-weight':'bold',display:'flex','align-items':'center',gap:'8px'}},' ğŸ“ å†å²æ€»ç»“è®°å½• ',-1)),(0,s.createElementVNode)('div',fn,[t.value.length>0?((0,s.openBlock)(),(0,s.createElementBlock)('span',hn,(0,s.toDisplayString)(t.value.length)+' æ¡è®°å½•',1)):(0,s.createCommentVNode)('v-if',!0),(0,s.createElementVNode)('button',{class:'mini-button refresh-button',style:{padding:'6px 12px',background:'#2a2a2a',border:'1px solid #3a3a3a','border-radius':'4px',color:'#e0e0e0',cursor:'pointer','font-size':'12px',transition:'all 0.2s',display:'flex','align-items':'center',gap:'6px'},onClick:d},[...e[0]||(e[0]=[(0,s.createElementVNode)('i',{class:'fa-solid fa-refresh'},null,-1),(0,s.createTextVNode)(' åˆ·æ–°æ•°æ® ',-1)])]),(0,s.createElementVNode)('button',{class:'mini-button create-worldbook-button',style:{padding:'6px 12px',background:'#51cf66',border:'1px solid #40c057','border-radius':'4px',color:'white',cursor:'pointer','font-size':'12px',transition:'all 0.2s',display:'flex','align-items':'center',gap:'6px'},onClick:m},[...e[1]||(e[1]=[(0,s.createElementVNode)('i',{class:'fa-solid fa-plus'},null,-1),(0,s.createTextVNode)(' åˆ›å»ºæ€»ç»“ä¸–ç•Œä¹¦ ',-1)])]),(0,s.createElementVNode)('button',{class:'mini-button debug-button',style:{padding:'6px 12px',background:'#ffc107',border:'1px solid #ffb300','border-radius':'4px',color:'#000',cursor:'pointer','font-size':'12px',transition:'all 0.2s',display:'flex','align-items':'center',gap:'6px'},onClick:b},[...e[2]||(e[2]=[(0,s.createElementVNode)('i',{class:'fa-solid fa-bug'},null,-1),(0,s.createTextVNode)(' è°ƒè¯•å·¥å…· ',-1)])])])]),t.value&&t.value.length>0?((0,s.openBlock)(),(0,s.createElementBlock)('div',yn,[((0,s.openBlock)(!0),(0,s.createElementBlock)(s.Fragment,null,(0,s.renderList)(t.value,(n,a)=>((0,s.openBlock)(),(0,s.createElementBlock)('div',{key:a,class:'history-item',style:{background:'#2a2a2a',border:'1px solid #444','border-radius':'8px',padding:'15px',transition:'all 0.3s ease'}},[(0,s.createElementVNode)('div',{class:'history-header',style:{padding:'12px 15px',background:'#1a1a1a',display:'flex','justify-content':'space-between','align-items':'center',cursor:'pointer','user-select':'none',transition:'background 0.2s','border-radius':'6px'},onClick:n=>(n=>{const e=o.value.get(n)||!1;o.value.set(n,!e)})(a)},[(0,s.createElementVNode)('div',wn,[(0,s.createElementVNode)('span',Cn,'#'+(0,s.toDisplayString)(a+1),1),(0,s.createElementVNode)('span',vn,'æ¥¼å±‚ '+(0,s.toDisplayString)(n.start_id)+' - '+(0,s.toDisplayString)(n.end_id),1)]),(0,s.createElementVNode)('span',kn,(0,s.toDisplayString)(r(a)?'â–¼':'â–¶'),1)],8,An),r(a)?((0,s.openBlock)(),(0,s.createElementBlock)('div',Bn,[(0,s.createElementVNode)('div',_n,[(0,s.createElementVNode)('button',{class:'mini-button',style:{flex:'1',padding:'6px 12px',background:'#2a2a2a',border:'1px solid #3a3a3a','border-radius':'4px',color:'#e0e0e0',cursor:'pointer','font-size':'12px',transition:'background 0.2s',display:'flex','align-items':'center','justify-content':'center',gap:'6px'},onClick:e=>u(n.content)},[...e[4]||(e[4]=[(0,s.createElementVNode)('i',{class:'fa-solid fa-copy'},null,-1),(0,s.createTextVNode)(' å¤åˆ¶ ',-1)])],8,En),(0,s.createElementVNode)('button',{class:'mini-button worldbook-button',style:{flex:'1',padding:'6px 12px',background:'#4a9eff',border:'1px solid #5aaeff','border-radius':'4px',color:'white',cursor:'pointer','font-size':'12px',transition:'all 0.2s',display:'flex','align-items':'center','justify-content':'center',gap:'6px'},onClick:e=>(async(n,e)=>{try{const o=getWorldbookNames();if(0===o.length)return void window.toastr.warning('æ²¡æœ‰å¯ç”¨çš„ä¸–ç•Œä¹¦ï¼Œè¯·å…ˆåˆ›å»ºæ€»ç»“ä¸–ç•Œä¹¦');const a=1===o.length?o[0]:await x(o);if(!a)return;const r={name:`æ€»ç»“_${e+1}_${(new Date).toLocaleDateString()}`,enabled:!0,strategy:{type:'constant',keys:[],keys_secondary:{logic:'and_any',keys:[]},scan_depth:'same_as_global'},position:{type:'before_character_definition',role:'system',depth:1},content:n,comment:`è‡ªåŠ¨ç”Ÿæˆçš„æ€»ç»“æ¡ç›® - æ¥¼å±‚èŒƒå›´: ${t.value[e]?.start_id||'?'} - ${t.value[e]?.end_id||'?'}`,insertion_order:0,case_sensitive:!1,name_is_regex:!1,keys_are_regex:!1,selective_logic:'and',secondary_keys_logic:'and',activation_threshold:0,disabled:!1,order:0,group:'',local_id:0,depth_entries:[],depth_entries_all:!1,search_range:0,force_activation:!1,disable:!1,exclude_recursion:!1,hidden:!1,priority:0,comment_is_regex:!1,content_is_regex:!1,secondary_keys_are_regex:!1,keys_secondary_are_regex:!1,uid:Date.now()};await createWorldbookEntries(a,[r]),window.toastr.success(`æ€»ç»“å·²ç»‘å®šåˆ°ä¸–ç•Œä¹¦: ${a}`)}catch(n){console.error('ç»‘å®šåˆ°ä¸–ç•Œä¹¦å¤±è´¥:',n),window.toastr.error('ç»‘å®šåˆ°ä¸–ç•Œä¹¦å¤±è´¥: '+n.message)}})(n.content,a)},[...e[5]||(e[5]=[(0,s.createElementVNode)('i',{class:'fa-solid fa-book'},null,-1),(0,s.createTextVNode)(' ç»‘å®šåˆ°ä¸–ç•Œä¹¦ ',-1)])],8,zn),(0,s.createElementVNode)('button',{class:'mini-button delete-button',style:{flex:'1',padding:'6px 12px',background:'#ff6b6b',border:'1px solid #ff5252','border-radius':'4px',color:'white',cursor:'pointer','font-size':'12px',transition:'all 0.2s',display:'flex','align-items':'center','justify-content':'center',gap:'6px'},onClick:n=>(n=>{if(confirm('ç¡®å®šè¦åˆ é™¤è¿™æ¡æ€»ç»“å—ï¼Ÿ'))try{if(!(0,l.pA)())return void window.toastr.error('æ— æ³•è·å–å½“å‰èŠå¤©ä¿¡æ¯');t.value.splice(n,1),insertOrAssignVariables({summary_history:t.value},{type:'chat'}),window.toastr.success('æ€»ç»“å·²åˆ é™¤')}catch(n){console.error('åˆ é™¤æ€»ç»“å¤±è´¥:',n),window.toastr.error('åˆ é™¤æ€»ç»“å¤±è´¥')}})(a)},[...e[6]||(e[6]=[(0,s.createElementVNode)('i',{class:'fa-solid fa-trash'},null,-1),(0,s.createTextVNode)(' åˆ é™¤ ',-1)])],8,Tn)]),(0,s.createElementVNode)('div',In,(0,s.toDisplayString)(n.content),1)])):(0,s.createCommentVNode)('v-if',!0)]))),128))])):((0,s.openBlock)(),(0,s.createElementBlock)('div',Sn,[...e[7]||(e[7]=[(0,s.createElementVNode)('i',{class:'fa-solid fa-inbox',style:{'font-size':'48px','margin-bottom':'10px',opacity:'0.3'}},null,-1),(0,s.createElementVNode)('p',{style:{margin:'10px 0','font-size':'16px'}},'è¿˜æ²¡æœ‰æ€»ç»“è®°å½•',-1),(0,s.createElementVNode)('small',{style:{'font-size':'12px',color:'#666'}},'ä½¿ç”¨"è®¾ç½®"æ ‡ç­¾é¡µæ‰‹åŠ¨åˆ›å»ºæ€»ç»“',-1)])]))]))}});r(603);var Vn=r(42);const Dn=(0,Vn.A)(Nn,[['__scopeId','data-v-97028022']]),$n={class:'table-tab',style:{padding:'25px !important',background:'#1a1a1a !important'}},Mn={class:'section-header',style:{display:'flex','justify-content':'space-between','align-items':'center',padding:'20px 25px !important','border-bottom':'1px solid #3a3a3a','margin-bottom':'5px'}},Fn={key:0,class:'count-badge',style:{background:'#4a9eff',color:'white',padding:'4px 8px','border-radius':'12px','font-size':'12px'}},jn={key:0,class:'history-list',style:{display:'flex','flex-direction':'column',gap:'15px','margin-top':'20px'}},Pn=['onClick'],On={class:'history-info',style:{display:'flex','align-items':'center',gap:'10px',flex:'1'}},Yn={class:'history-number',style:{color:'#4a9eff','font-weight':'bold'}},Ln={class:'history-range',style:{color:'#888','font-size':'12px'}},Rn={class:'expand-icon',style:{color:'#888','font-size':'12px'}},Un={key:0,class:'history-content',style:{padding:'15px',background:'#2a2a2a','border-radius':'0 0 6px 6px'}},Wn={class:'history-actions',style:{display:'flex',gap:'10px','margin-bottom':'12px','padding-bottom':'8px','border-bottom':'1px solid #3a3a3a','flex-wrap':'wrap'}},qn=['onClick'],Hn=['onClick'],Gn={class:'table-display',style:{'overflow-x':'auto','border-radius':'6px',border:'1px solid #3a3a3a'}},Jn={style:{width:'100%','border-collapse':'collapse',background:'#1a1a1a'}},Kn={style:{background:'#2a2a2a'}},Zn={key:1,class:'empty-state',style:{'text-align':'center',padding:'40px 20px',color:'#888'}},Qn=(0,s.defineComponent)({__name:'TableTab',setup(n){const e=(0,s.ref)([]),t=(0,s.ref)(new Map),o=n=>t.value.get(n)||!1,a=async n=>new Promise(e=>{try{const t=window.parent.document,o=window.parent.document.body,a=t.createElement('textarea');a.value=n,a.style.cssText='\n        position: fixed;\n        left: -9999px;\n        top: -9999px;\n        opacity: 0;\n        pointer-events: none;\n        z-index: -1000;\n      ',a.setAttribute('readonly',''),o.appendChild(a),a.focus(),a.select(),a.setSelectionRange(0,n.length);const r=t.execCommand('copy');o.removeChild(a),e(r)}catch(n){console.error('çˆ¶çª—å£å¤åˆ¶å¤±è´¥:',n),e(!1)}}),r=async n=>new Promise(e=>{try{const t=document.createElement('textarea');t.value=n,t.style.position='fixed',t.style.left='-9999px',t.style.top='-9999px',t.style.opacity='0',t.style.pointerEvents='none',t.setAttribute('readonly',''),document.body.appendChild(t),t.select(),t.setSelectionRange(0,n.length);const o=document.execCommand('copy');document.body.removeChild(t),e(o)}catch(n){console.error('execCommand å¤åˆ¶å¤±è´¥:',n),e(!1)}}),i=n=>{console.log('æ˜¾ç¤ºæ‰‹åŠ¨å¤åˆ¶å¯¹è¯æ¡†ï¼Œæ–‡æœ¬é•¿åº¦:',n.length);try{const e=window.parent.document,t=window.parent.document.body,o=e.getElementById('manual-copy-overlay');o&&t.removeChild(o);const a=e.createElement('div');a.id='manual-copy-overlay',a.style.cssText='\n      position: fixed;\n      top: 0;\n      left: 0;\n      right: 0;\n      bottom: 0;\n      background: rgba(0, 0, 0, 0.95);\n      z-index: 999999;\n      display: flex;\n      align-items: center;\n      justify-content: center;\n      font-family: -apple-system, BlinkMacSystemFont, \'Segoe UI\', Roboto, sans-serif;\n    ';const r=e.createElement('div');r.style.cssText='\n      background: #2a2a2a;\n      border: 2px solid #4a9eff;\n      border-radius: 12px;\n      padding: 25px;\n      max-width: 900px;\n      width: 95%;\n      max-height: 85vh;\n      display: flex;\n      flex-direction: column;\n      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);\n    ';const s=e.createElement('div');s.innerHTML='\n      <h3 style="margin: 0 0 15px 0; color: #4a9eff; text-align: center; font-size: 18px; font-weight: 600;">\n        ğŸ“‹ æ‰‹åŠ¨å¤åˆ¶è¡¨æ ¼å†…å®¹\n      </h3>\n      <div style="background: #1a1a1a; border: 1px solid #444; border-radius: 6px; padding: 12px; margin-bottom: 15px;">\n        <p style="margin: 0 0 8px 0; color: #e0e0e0; font-size: 14px;">\n          <strong>æ“ä½œæ­¥éª¤ï¼š</strong>\n        </p>\n        <ol style="margin: 0; padding-left: 20px; color: #ccc; font-size: 13px; line-height: 1.6;">\n          <li>ç‚¹å‡»ä¸‹æ–¹æ–‡æœ¬æ¡†</li>\n          <li>æŒ‰ <kbd style="background: #444; padding: 2px 6px; border-radius: 3px; color: #fff;">Ctrl+A</kbd> å…¨é€‰æ–‡æœ¬</li>\n          <li>æŒ‰ <kbd style="background: #444; padding: 2px 6px; border-radius: 3px; color: #fff;">Ctrl+C</kbd> å¤åˆ¶åˆ°å‰ªè´´æ¿</li>\n          <li>ç‚¹å‡»"å…³é—­"æŒ‰é’®æˆ–æŒ‰ <kbd style="background: #444; padding: 2px 6px; border-radius: 3px; color: #fff;">Esc</kbd> å…³é—­å¯¹è¯æ¡†</li>\n        </ol>\n      </div>\n    ';const i=e.createElement('textarea');i.value=n,i.style.cssText='\n      width: 100%;\n      height: 400px;\n      background: #1a1a1a;\n      border: 2px solid #444;\n      border-radius: 6px;\n      padding: 15px;\n      color: #e0e0e0;\n      font-family: \'Courier New\', \'Consolas\', monospace;\n      font-size: 13px;\n      line-height: 1.5;\n      resize: vertical;\n      white-space: pre-wrap;\n      word-wrap: break-word;\n      outline: none;\n      margin-bottom: 20px;\n      box-sizing: border-box;\n    ';const l=e.createElement('div');l.style.cssText='\n      display: flex;\n      gap: 12px;\n      justify-content: center;\n      align-items: center;\n    ';const d=e.createElement('button');d.textContent='å…³é—­',d.style.cssText='\n      background: #4a9eff;\n      color: white;\n      border: none;\n      padding: 12px 24px;\n      border-radius: 6px;\n      cursor: pointer;\n      font-size: 14px;\n      font-weight: 500;\n      transition: background 0.2s;\n    ',d.onmouseover=()=>{d.style.background='#5ba8ff'},d.onmouseout=()=>{d.style.background='#4a9eff'};const c=e.createElement('button');c.textContent='å°è¯•è‡ªåŠ¨å¤åˆ¶',c.style.cssText='\n      background: #28a745;\n      color: white;\n      border: none;\n      padding: 12px 24px;\n      border-radius: 6px;\n      cursor: pointer;\n      font-size: 14px;\n      font-weight: 500;\n      transition: background 0.2s;\n    ',c.onmouseover=()=>{c.style.background='#218838'},c.onmouseout=()=>{c.style.background='#28a745'},l.appendChild(c),l.appendChild(d),r.appendChild(s),r.appendChild(i),r.appendChild(l),a.appendChild(r),t.appendChild(a),d.onclick=()=>{console.log('å…³é—­æŒ‰é’®è¢«ç‚¹å‡»'),t.removeChild(a)},c.onclick=async()=>{console.log('å°è¯•è‡ªåŠ¨å¤åˆ¶æŒ‰é’®è¢«ç‚¹å‡»');try{i.focus(),i.select();document.execCommand('copy')?(window.toastr.success('è‡ªåŠ¨å¤åˆ¶æˆåŠŸï¼'),t.removeChild(a)):window.toastr.warning('è‡ªåŠ¨å¤åˆ¶å¤±è´¥ï¼Œè¯·æ‰‹åŠ¨å¤åˆ¶')}catch(n){console.error('è‡ªåŠ¨å¤åˆ¶å¤±è´¥:',n),window.toastr.warning('è‡ªåŠ¨å¤åˆ¶å¤±è´¥ï¼Œè¯·æ‰‹åŠ¨å¤åˆ¶')}},a.onclick=n=>{n.target===a&&(console.log('ç‚¹å‡»èƒŒæ™¯å…³é—­'),t.removeChild(a))};const p=n=>{'Escape'===n.key&&(console.log('æŒ‰ESCé”®å…³é—­'),t.removeChild(a),e.removeEventListener('keydown',p))};e.addEventListener('keydown',p),setTimeout(()=>{console.log('è‡ªåŠ¨é€‰ä¸­æ–‡æœ¬'),i.focus(),i.select()},200),window.toastr.info('æ‰‹åŠ¨å¤åˆ¶å¯¹è¯æ¡†å·²æ‰“å¼€ï¼Œè¯·æŒ‰ç…§æç¤ºæ“ä½œ')}catch(n){console.error('åˆ›å»ºæ‰‹åŠ¨å¤åˆ¶å¯¹è¯æ¡†å¤±è´¥:',n),window.toastr.error('æ— æ³•æ˜¾ç¤ºå¤åˆ¶å¯¹è¯æ¡†ï¼Œè¯·æ£€æŸ¥æµè§ˆå™¨æƒé™')}},d=n=>{try{(async(n,e='å†…å®¹å·²å¤åˆ¶åˆ°å‰ªè´´æ¿')=>{console.log('å¼€å§‹å¤åˆ¶ï¼Œæ–‡æœ¬é•¿åº¦:',n.length);try{if(window.parent&&window.parent!==window&&(console.log('æ£€æµ‹åˆ°iframeç¯å¢ƒï¼Œå°è¯•åœ¨çˆ¶çª—å£å¤åˆ¶'),await a(n)))return console.log('çˆ¶çª—å£å¤åˆ¶æˆåŠŸ'),void window.toastr.success(e);if(navigator.clipboard&&window.isSecureContext){console.log('ä½¿ç”¨ç°ä»£ Clipboard API');try{return await navigator.clipboard.writeText(n),console.log('Clipboard API å¤åˆ¶æˆåŠŸ'),void window.toastr.success(e)}catch(n){console.warn('Clipboard API å¤±è´¥:',n)}}if(console.log('ä½¿ç”¨ execCommand æ–¹æ³•'),await r(n))return console.log('execCommand å¤åˆ¶æˆåŠŸ'),void window.toastr.success(e);console.log('æ‰€æœ‰è‡ªåŠ¨å¤åˆ¶æ–¹æ³•éƒ½å¤±è´¥ï¼Œæ˜¾ç¤ºæ‰‹åŠ¨å¤åˆ¶ç•Œé¢'),i(n)}catch(e){console.error('å¤åˆ¶å¼‚å¸¸:',e),i(n)}})([n.headers.join('\t'),...n.data.map(n=>n.join('\t'))].join('\n'),'è¡¨æ ¼å·²å¤åˆ¶åˆ°å‰ªè´´æ¿')}catch(n){console.error('å¤åˆ¶è¡¨æ ¼å¤±è´¥:',n),window.toastr.error('å¤åˆ¶å¤±è´¥ï¼Œè¯·æ‰‹åŠ¨å¤åˆ¶')}};return(()=>{try{if(!(0,l.pA)())return console.warn('æ— æ³•è·å–èŠå¤©IDï¼Œæ¸…ç©ºè¡¨æ ¼å†å²'),void(e.value=[]);const n=getVariables({type:'chat'});console.log('ä»èŠå¤©å˜é‡è¯»å–çš„æ•°æ®:',n),console.log('è¡¨æ ¼å†å²æ•°æ®:',n.table_history),e.value=n.table_history||[],console.log('å·²åˆ·æ–°è¡¨æ ¼å†å²ï¼Œå½“å‰èŠå¤©è¡¨æ ¼æ•°:',e.value.length)}catch(n){console.error('åˆ·æ–°è¡¨æ ¼å†å²å¤±è´¥:',n),e.value=[]}})(),(n,a)=>((0,s.openBlock)(),(0,s.createElementBlock)('div',$n,[(0,s.createElementVNode)('div',Mn,[a[0]||(a[0]=(0,s.createElementVNode)('h3',{style:{margin:'0',color:'#fff','font-size':'15px !important','font-weight':'bold',display:'flex','align-items':'center',gap:'8px'}},' ğŸ“Š è¡¨æ ¼åˆ†æ ',-1)),e.value.length>0?((0,s.openBlock)(),(0,s.createElementBlock)('span',Fn,(0,s.toDisplayString)(e.value.length)+' æ¡è®°å½•',1)):(0,s.createCommentVNode)('v-if',!0)]),(0,s.createCommentVNode)(' è¡¨æ ¼å†å²åˆ—è¡¨ '),e.value&&e.value.length>0?((0,s.openBlock)(),(0,s.createElementBlock)('div',jn,[((0,s.openBlock)(!0),(0,s.createElementBlock)(s.Fragment,null,(0,s.renderList)(e.value,(n,r)=>((0,s.openBlock)(),(0,s.createElementBlock)('div',{key:r,class:'history-item',style:{background:'#2a2a2a',border:'1px solid #444','border-radius':'8px',padding:'15px',transition:'all 0.3s ease'}},[(0,s.createElementVNode)('div',{class:'history-header',style:{padding:'12px 15px',background:'#1a1a1a',display:'flex','justify-content':'space-between','align-items':'center',cursor:'pointer','user-select':'none',transition:'background 0.2s','border-radius':'6px'},onClick:n=>(n=>{const e=t.value.get(n)||!1;t.value.set(n,!e)})(r)},[(0,s.createElementVNode)('div',On,[(0,s.createElementVNode)('span',Yn,'#'+(0,s.toDisplayString)(r+1),1),(0,s.createElementVNode)('span',Ln,'æ¥¼å±‚ '+(0,s.toDisplayString)(n.start_id)+' - '+(0,s.toDisplayString)(n.end_id),1)]),(0,s.createElementVNode)('span',Rn,(0,s.toDisplayString)(o(r)?'â–¼':'â–¶'),1)],8,Pn),o(r)?((0,s.openBlock)(),(0,s.createElementBlock)('div',Un,[(0,s.createElementVNode)('div',Wn,[(0,s.createElementVNode)('button',{class:'copy-button',style:{padding:'8px 16px',background:'linear-gradient(135deg, #28a745 0%, #20c997 100%)',border:'none','border-radius':'6px',color:'white',cursor:'pointer','font-size':'12px','font-weight':'600',transition:'all 0.3s ease',display:'flex','align-items':'center',gap:'6px','box-shadow':'0 3px 12px rgba(40, 167, 69, 0.3)',position:'relative',overflow:'hidden'},onClick:e=>d(n)},[...a[1]||(a[1]=[(0,s.createElementVNode)('div',{style:{position:'absolute',top:'0',left:'-100%',width:'100%',height:'100%',background:'linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent)',transition:'left 0.5s'},class:'shimmer-effect'},null,-1),(0,s.createElementVNode)('i',{class:'fa-solid fa-copy',style:{'font-size':'12px'}},null,-1),(0,s.createTextVNode)(' å¤åˆ¶ ',-1)])],8,qn),(0,s.createElementVNode)('button',{class:'delete-button',style:{padding:'8px 16px',background:'linear-gradient(135deg, #ff6b6b 0%, #ee5a52 100%)',border:'none','border-radius':'6px',color:'white',cursor:'pointer','font-size':'12px','font-weight':'600',transition:'all 0.3s ease',display:'flex','align-items':'center',gap:'6px','box-shadow':'0 3px 12px rgba(255, 107, 107, 0.3)',position:'relative',overflow:'hidden'},onClick:n=>(n=>{confirm('ç¡®å®šè¦åˆ é™¤è¿™ä¸ªè¡¨æ ¼å—ï¼Ÿ')&&(e.value.splice(n,1),(0,l.pA)()&&(insertOrAssignVariables({table_history:e.value},{type:'chat'}),window.toastr.success('è¡¨æ ¼å·²åˆ é™¤')))})(r)},[...a[2]||(a[2]=[(0,s.createElementVNode)('div',{style:{position:'absolute',top:'0',left:'-100%',width:'100%',height:'100%',background:'linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent)',transition:'left 0.5s'},class:'shimmer-effect'},null,-1),(0,s.createElementVNode)('i',{class:'fa-solid fa-trash',style:{'font-size':'12px'}},null,-1),(0,s.createTextVNode)(' åˆ é™¤ ',-1)])],8,Hn)]),(0,s.createElementVNode)('div',Gn,[(0,s.createElementVNode)('table',Jn,[(0,s.createElementVNode)('thead',Kn,[(0,s.createElementVNode)('tr',null,[((0,s.openBlock)(!0),(0,s.createElementBlock)(s.Fragment,null,(0,s.renderList)(n.headers,(n,e)=>((0,s.openBlock)(),(0,s.createElementBlock)('th',{key:e,style:{padding:'12px 16px','text-align':'left','font-weight':'bold',color:'#fff','border-bottom':'2px solid #3a3a3a','border-right':'1px solid #3a3a3a'}},(0,s.toDisplayString)(n),1))),128))])]),(0,s.createElementVNode)('tbody',null,[((0,s.openBlock)(!0),(0,s.createElementBlock)(s.Fragment,null,(0,s.renderList)(n.data,(n,e)=>((0,s.openBlock)(),(0,s.createElementBlock)('tr',{key:e,style:{'border-bottom':'1px solid #3a3a3a'}},[((0,s.openBlock)(!0),(0,s.createElementBlock)(s.Fragment,null,(0,s.renderList)(n,(n,e)=>((0,s.openBlock)(),(0,s.createElementBlock)('td',{key:e,style:{padding:'10px 16px',color:'#e0e0e0','border-right':'1px solid #3a3a3a'}},(0,s.toDisplayString)(n),1))),128))]))),128))])])])])):(0,s.createCommentVNode)('v-if',!0)]))),128))])):((0,s.openBlock)(),(0,s.createElementBlock)('div',Zn,[...a[3]||(a[3]=[(0,s.createElementVNode)('i',{class:'fa-solid fa-table',style:{'font-size':'48px','margin-bottom':'10px',opacity:'0.3'}},null,-1),(0,s.createElementVNode)('p',{style:{margin:'10px 0','font-size':'16px'}},'è¿˜æ²¡æœ‰è¡¨æ ¼è®°å½•',-1),(0,s.createElementVNode)('small',{style:{'font-size':'12px',color:'#666'}},'ä½¿ç”¨"è®¾ç½®"æ ‡ç­¾é¡µæ‰‹åŠ¨ç”Ÿæˆè¡¨æ ¼',-1)])]))]))}});r(162);const Xn=(0,Vn.A)(Qn,[['__scopeId','data-v-0416f1c6']]),ne=_,ee={class:'tools-tab',style:{padding:'25px !important',background:'#1a1a1a !important'}},te={class:'tool-section'},oe={key:0,class:'tool-content'},ae={class:'form-group',style:{margin:'15px 0'}},re={class:'button-group',style:{display:'flex',gap:'12px','margin-bottom':'20px'}},se=['disabled'],ie={key:0,class:'output-section'},le={class:'output-content',style:{background:'#1e1e1e',border:'1px solid #3a3a3a','border-radius':'6px',padding:'15px',color:'#e0e0e0','font-size':'13px','line-height':'1.6','white-space':'pre-wrap','word-wrap':'break-word','max-height':'300px','overflow-y':'auto'}},de={class:'tool-section'},ce={key:0,class:'tool-content'},pe={class:'form-group',style:{margin:'15px 0'}},ge={class:'button-group',style:{display:'flex',gap:'12px','margin-bottom':'20px'}},ue=['disabled'],me={key:0,class:'output-section'},xe={class:'output-content',style:{background:'#1e1e1e',border:'1px solid #3a3a3a','border-radius':'6px',padding:'15px',color:'#e0e0e0','font-size':'13px','line-height':'1.6','white-space':'pre-wrap','word-wrap':'break-word','max-height':'300px','overflow-y':'auto'}},be={class:'modify-section',style:{'margin-top':'25px','border-top':'2px dashed #3a3a3a','padding-top':'20px'}},fe={class:'form-group',style:{margin:'15px 0'}},he={class:'button-group',style:{display:'flex',gap:'12px','margin-bottom':'15px'}},ye=['disabled'],Ae=(0,s.defineComponent)({__name:'ToolsTab',setup(n){const e=(0,i.C)(),{settings:o}=(0,c.storeToRefs)(e),a=(0,s.ref)(new Map),r=(0,s.ref)(''),l=(0,s.ref)(''),d=(0,s.ref)(!1),p=(0,s.ref)(''),g=(0,s.ref)(''),u=(0,s.ref)(!1),m=(0,s.ref)(''),x=(0,s.ref)(!1),b=(0,s.ref)(!1),f=()=>{if(b.value)try{const n=t();if(!n)return void console.warn('âš ï¸ script_id ä¸ºç©ºï¼Œæ— æ³•ä¿å­˜æ•°æ®');const e={tools_antiCliche:{input:r.value,output:l.value},tools_characterCard:{description:p.value,output:g.value,modifyRequest:m.value},tools_expandedState:Object.fromEntries(a.value)};insertOrAssignVariables(e,{type:'script',script_id:n}),console.log('ğŸ’¾ å·¥å…·æ•°æ®å·²ä¿å­˜:',{antiCliche_input_length:r.value.length,antiCliche_output_length:l.value.length,character_desc_length:p.value.length,character_output_length:g.value.length})}catch(n){console.error('âŒ ä¿å­˜å·¥å…·æ•°æ®å¤±è´¥:',n)}else console.log('â¸ï¸ è·³è¿‡ä¿å­˜ï¼šæ•°æ®å°šæœªåŠ è½½å®Œæˆ')},h=(0,ne.debounce)(f,300);(0,s.watch)([r,l,p,g,m,a],()=>{b.value&&(console.log('ğŸ“ æ•°æ®å˜åŒ–ï¼Œè§¦å‘ä¿å­˜...'),h())},{deep:!0}),(0,s.onMounted)(()=>{console.log('ğŸ”§ ToolsTab ç»„ä»¶å·²æŒ‚è½½ï¼ŒåŠ è½½æ•°æ®...'),(()=>{try{b.value=!1;const n=t();if(!n)return console.warn('âš ï¸ script_id ä¸ºç©ºï¼Œæ— æ³•åŠ è½½æ•°æ®'),void(b.value=!0);const e=getVariables({type:'script',script_id:n});console.log('ğŸ“¥ åŠ è½½å·¥å…·æ•°æ®:',e),e.tools_antiCliche&&(r.value=e.tools_antiCliche.input||'',l.value=e.tools_antiCliche.output||'',console.log('âœ… å·²æ¢å¤åå…«è‚¡æ•°æ®:',{input:r.value.substring(0,50),output:l.value.substring(0,50)})),e.tools_characterCard&&(p.value=e.tools_characterCard.description||'',g.value=e.tools_characterCard.output||'',m.value=e.tools_characterCard.modifyRequest||'',console.log('âœ… å·²æ¢å¤è§’è‰²å¡æ•°æ®:',{description:p.value.substring(0,50),output:g.value.substring(0,50),modifyRequest:m.value.substring(0,50)})),e.tools_expandedState&&(a.value=new Map(Object.entries(e.tools_expandedState)),console.log('âœ… å·²æ¢å¤å±•å¼€çŠ¶æ€:',Object.fromEntries(a.value))),setTimeout(()=>{b.value=!0,console.log('âœ… æ•°æ®åŠ è½½å®Œæˆï¼Œå¯ç”¨è‡ªåŠ¨ä¿å­˜')},100)}catch(n){console.error('âŒ åŠ è½½å·¥å…·æ•°æ®å¤±è´¥:',n),b.value=!0}})()}),(0,s.onBeforeUnmount)(()=>{console.log('ğŸ”„ ToolsTab ç»„ä»¶å³å°†å¸è½½ï¼Œä¿å­˜æ•°æ®...'),h.cancel(),f()});const y=n=>{console.log('toggleToolExpanded è¢«è°ƒç”¨ï¼Œå·¥å…·åç§°:',n);const e=a.value.get(n)||!1;console.log('å½“å‰å±•å¼€çŠ¶æ€:',e),a.value.set(n,!e),console.log('æ–°çš„å±•å¼€çŠ¶æ€:',!e)},A=n=>a.value.get(n)||!1,w=async(n,e)=>{if(console.log('ğŸ” å¼€å§‹å¤åˆ¶ï¼Œæ–‡æœ¬é•¿åº¦:',n.length),console.log('ğŸ” æ˜¯å¦åœ¨iframeä¸­:',window.parent!==window),window.parent&&window.parent!==window){console.log('ğŸ” å°è¯•åœ¨çˆ¶çª—å£ä¸­å¤åˆ¶...');if(C(n))return console.log('âœ… çˆ¶çª—å£å¤åˆ¶æˆåŠŸ'),void window.toastr.success(e);console.warn('âš ï¸ çˆ¶çª—å£å¤åˆ¶å¤±è´¥')}try{console.log('ğŸ” å°è¯• execCommand å¤åˆ¶...');if(v(n))return console.log('âœ… execCommand å¤åˆ¶æˆåŠŸ'),void window.toastr.success(e);console.warn('âš ï¸ execCommand å¤åˆ¶å¤±è´¥')}catch(n){console.warn('âŒ execCommand å¤åˆ¶å¼‚å¸¸:',n)}try{if(navigator.clipboard&&window.isSecureContext){console.log('ğŸ” å°è¯• Clipboard API å¤åˆ¶...'),await navigator.clipboard.writeText(n);if(await navigator.clipboard.readText()===n)return console.log('âœ… Clipboard API å¤åˆ¶æˆåŠŸï¼ˆå·²éªŒè¯ï¼‰'),void window.toastr.success(e);console.warn('âš ï¸ Clipboard API å¤åˆ¶åéªŒè¯å¤±è´¥')}}catch(n){console.warn('âŒ Clipboard API å¤±è´¥:',n)}console.log('âš ï¸ æ‰€æœ‰è‡ªåŠ¨å¤åˆ¶æ–¹æ³•éƒ½å¤±è´¥ï¼Œæ˜¾ç¤ºæ‰‹åŠ¨å¤åˆ¶å¯¹è¯æ¡†'),k(n)},C=n=>{try{if(window.parent&&window.parent!==window){console.log('  ğŸ“ åœ¨çˆ¶çª—å£åˆ›å»ºä¸´æ—¶textarea...');const e=window.parent.document,t=e.createElement('textarea');t.value=n,t.style.cssText='\n        position: fixed !important;\n        left: -9999px !important;\n        top: -9999px !important;\n        width: 1px !important;\n        height: 1px !important;\n        opacity: 0 !important;\n        pointer-events: none !important;\n      ',t.setAttribute('readonly',''),e.body.appendChild(t),console.log('  ğŸ“ Textareaå·²æ·»åŠ åˆ°çˆ¶çª—å£'),t.focus(),t.select(),t.setSelectionRange(0,n.length),console.log('  ğŸ“ æ–‡æœ¬å·²é€‰ä¸­');const o=e.execCommand('copy');return console.log('  ğŸ“ execCommandç»“æœ:',o),e.body.removeChild(t),console.log('  ğŸ“ Textareaå·²æ¸…ç†'),o}}catch(n){console.error('âŒ çˆ¶çª—å£å¤åˆ¶å¼‚å¸¸:',n)}return!1},v=n=>{try{console.log('  ğŸ“ åœ¨å½“å‰çª—å£åˆ›å»ºä¸´æ—¶textarea...');const e=document.createElement('textarea');e.value=n,e.style.cssText='\n      position: fixed !important;\n      left: -9999px !important;\n      top: -9999px !important;\n      width: 1px !important;\n      height: 1px !important;\n      opacity: 0 !important;\n      pointer-events: none !important;\n    ',e.setAttribute('readonly',''),document.body.appendChild(e),console.log('  ğŸ“ Textareaå·²æ·»åŠ åˆ°å½“å‰çª—å£'),e.focus(),e.select(),e.setSelectionRange(0,n.length),console.log('  ğŸ“ æ–‡æœ¬å·²é€‰ä¸­');const t=document.execCommand('copy');return console.log('  ğŸ“ execCommandç»“æœ:',t),document.body.removeChild(e),console.log('  ğŸ“ Textareaå·²æ¸…ç†'),t}catch(n){return console.error('âŒ execCommand å¤åˆ¶å¼‚å¸¸:',n),!1}},k=n=>{try{console.log('ğŸ“‹ æ˜¾ç¤ºæ‰‹åŠ¨å¤åˆ¶å¯¹è¯æ¡†');const e=window.parent&&window.parent!==window?window.parent.document:document,t=e.body;console.log('ğŸ“‹ ç›®æ ‡æ–‡æ¡£:',e===window.parent.document?'çˆ¶çª—å£':'å½“å‰çª—å£');const o=e.getElementById('manual-copy-modal-tools');o&&t.removeChild(o);const a=e.createElement('div');a.id='manual-copy-modal-tools',a.style.cssText='\n      position: fixed;\n      top: 0;\n      left: 0;\n      width: 100%;\n      height: 100%;\n      background: rgba(0, 0, 0, 0.9);\n      z-index: 999999;\n      display: flex;\n      align-items: center;\n      justify-content: center;\n      font-family: -apple-system, BlinkMacSystemFont, \'Segoe UI\', Roboto, sans-serif;\n    ';const r=e.createElement('div');r.style.cssText='\n      background: #2a2a2a;\n      border: 2px solid #ffa500;\n      border-radius: 12px;\n      padding: 25px;\n      max-width: 700px;\n      width: 90%;\n      max-height: 80vh;\n      display: flex;\n      flex-direction: column;\n      box-shadow: 0 10px 40px rgba(0, 0, 0, 0.8);\n    ',r.innerHTML=`\n      <h3 style="margin: 0 0 15px 0; color: #ffa500; font-size: 18px; font-weight: 600;">\n        <i class="fa-solid fa-copy" style="margin-right: 8px;"></i>\n        æ‰‹åŠ¨å¤åˆ¶å†…å®¹\n      </h3>\n      <div style="background: #1a1a1a; border: 1px solid #3a3a3a; border-radius: 6px; padding: 12px; margin-bottom: 15px;">\n        <p style="margin: 0; color: #e0e0e0; font-size: 14px; line-height: 1.6;">\n          âš ï¸ è‡ªåŠ¨å¤åˆ¶åŠŸèƒ½åœ¨å½“å‰ç¯å¢ƒä¸‹ä¸å¯ç”¨ï¼Œè¯·æ‰‹åŠ¨å¤åˆ¶ä»¥ä¸‹å†…å®¹ï¼š\n        </p>\n        <ol style="margin: 8px 0 0 20px; padding: 0; color: #ccc; font-size: 13px;">\n          <li>ç‚¹å‡»ä¸‹æ–¹æ–‡æœ¬æ¡†é€‰ä¸­å†…å®¹</li>\n          <li>æŒ‰ <kbd style="background: #444; padding: 2px 6px; border-radius: 3px;">Ctrl+A</kbd> å…¨é€‰</li>\n          <li>æŒ‰ <kbd style="background: #444; padding: 2px 6px; border-radius: 3px;">Ctrl+C</kbd> å¤åˆ¶</li>\n        </ol>\n      </div>\n      <textarea\n        readonly\n        id="copyTextarea"\n        style="\n          width: 100%;\n          height: 300px;\n          background: #1a1a1a;\n          border: 2px solid #3a3a3a;\n          border-radius: 6px;\n          padding: 12px;\n          color: #e0e0e0;\n          font-size: 13px;\n          font-family: 'Courier New', Consolas, monospace;\n          resize: vertical;\n          margin-bottom: 15px;\n          box-sizing: border-box;\n        "\n      >${n}</textarea>\n      <div style="display: flex; gap: 12px; justify-content: flex-end;">\n        <button id="manualCopyBtn" style="\n          padding: 10px 20px;\n          background: #28a745;\n          border: none;\n          border-radius: 6px;\n          color: white;\n          font-size: 14px;\n          font-weight: 600;\n          cursor: pointer;\n          transition: background 0.2s;\n        ">å°è¯•è‡ªåŠ¨å¤åˆ¶</button>\n        <button id="closeBtn" style="\n          padding: 10px 20px;\n          background: #6c757d;\n          border: none;\n          border-radius: 6px;\n          color: white;\n          font-size: 14px;\n          font-weight: 600;\n          cursor: pointer;\n          transition: background 0.2s;\n        ">å…³é—­</button>\n      </div>\n    `,a.appendChild(r),t.appendChild(a),console.log('ğŸ“‹ å¯¹è¯æ¡†å·²æ·»åŠ åˆ°DOM');const s=r.querySelector('#copyTextarea');setTimeout(()=>{s.focus(),s.select(),console.log('ğŸ“‹ æ–‡æœ¬å·²è‡ªåŠ¨é€‰ä¸­')},100);const i=r.querySelector('#manualCopyBtn'),l=r.querySelector('#closeBtn');i.onmouseover=()=>i.style.background='#218838',i.onmouseout=()=>i.style.background='#28a745',l.onmouseover=()=>l.style.background='#5a6268',l.onmouseout=()=>l.style.background='#6c757d',i.onclick=()=>{try{console.log('ğŸ“‹ å°è¯•é€šè¿‡æŒ‰é’®å¤åˆ¶...'),s.focus(),s.select();const n=e.execCommand('copy');console.log('ğŸ“‹ å¤åˆ¶ç»“æœ:',n),n?(window.toastr.success('å¤åˆ¶æˆåŠŸï¼'),t.removeChild(a)):window.toastr.warning('è‡ªåŠ¨å¤åˆ¶å¤±è´¥ï¼Œè¯·æ‰‹åŠ¨æŒ‰ Ctrl+C å¤åˆ¶')}catch(n){console.error('ğŸ“‹ å¤åˆ¶å¼‚å¸¸:',n),window.toastr.warning('è‡ªåŠ¨å¤åˆ¶å¤±è´¥ï¼Œè¯·æ‰‹åŠ¨æŒ‰ Ctrl+C å¤åˆ¶')}},l.onclick=()=>{console.log('ğŸ“‹ å…³é—­å¯¹è¯æ¡†'),t.removeChild(a)},a.onclick=n=>{n.target===a&&(console.log('ğŸ“‹ ç‚¹å‡»èƒŒæ™¯å…³é—­'),t.removeChild(a))};const d=n=>{'Escape'===n.key&&(console.log('ğŸ“‹ æŒ‰ESCå…³é—­'),t.removeChild(a),e.removeEventListener('keydown',d))};e.addEventListener('keydown',d),window.toastr.info('å·²æ‰“å¼€æ‰‹åŠ¨å¤åˆ¶å¯¹è¯æ¡†ï¼Œè¯·æŒ‰ç…§æç¤ºæ“ä½œ','',{timeOut:3e3})}catch(n){console.error('âŒ æ˜¾ç¤ºå¤åˆ¶å¯¹è¯æ¡†å¤±è´¥:',n),window.toastr.error('æ— æ³•æ˜¾ç¤ºå¤åˆ¶å¯¹è¯æ¡†ï¼š'+n.message)}},B=async()=>{if(r.value.trim())try{d.value=!0,window.toastr.info('AIæ­£åœ¨åˆ†ææ–‡æœ¬...','åå…«è‚¡æ¸…ç†',{timeOut:15e3});const n=await fetch(o.value.api_endpoint,{method:'POST',headers:{'Content-Type':'application/json',Authorization:`Bearer ${o.value.api_key}`},body:JSON.stringify({model:o.value.model,messages:[{role:'system',content:'ä½ æ˜¯ä¸€ä¸ªæ–‡æœ¬ç¼–è¾‘åŠ©æ‰‹ï¼Œè´Ÿè´£ç³»ç»Ÿæ€§åœ°æ¸…ç†è§’è‰²å¡ã€ä¸–ç•Œä¹¦å’Œå¼€åœºç™½ä¸­çš„å…«è‚¡è¡¨è¿°ã€‚è¯·æŒ‰ç…§ä»¥ä¸‹ä¹ä¸ªæ­¥éª¤ä¸¥æ ¼æ‰§è¡Œï¼š\n\n## ç¬¬ä¸€æ­¥ï¼šå»é™¤æ¨¡ç³Šè¯å’Œç±»æ¯”è¯\nåˆ é™¤ï¼šä¼¼ä¹ã€å‡ ä¹ã€è¿‘ä¹ã€å¥½åƒã€ä»¿ä½›ã€å¦‚åŒã€å®›å¦‚ã€æ°ä¼¼ã€ä¸€ä¸ã€ä¸€æŠ¹ã€ä¸€ä¸ä¸ã€ä¸€èˆ¬ã€ä¸æ˜“å¯Ÿè§‰ã€è‹¥æœ‰è‹¥æ— \n\n## ç¬¬äºŒæ­¥ï¼šå»é™¤å…«è‚¡æ¯”å–»è¯\n- åˆ é™¤æ‰€æœ‰åŠ¨ç‰©åŒ–æ¯”å–»ï¼šåƒå°å…”å­ä¸€æ ·ã€åƒå°å…½ä¸€æ ·ã€åƒçŒ«å’ªä¸€æ ·ã€é‡å…½ã€å°å…½ã€å¹¼å…½ã€ä½å¼ã€å˜¶å¼\n- åˆ é™¤æŠ•çŸ³ç±»æ¯”å–»ï¼šæŠ•çŸ³å…¥æ°´ã€çŸ³å¤´è½åœ°ç­‰\n- ç›´æ¥æè¿°åŠ¨ä½œå’ŒçŠ¶æ€ï¼Œä¸ä½¿ç”¨æ¯”å–»\n\n## ç¬¬ä¸‰æ­¥ï¼šå»é™¤è¯­æ°”å£°éŸ³æè¿°\nåˆ é™¤ï¼šå¸¦ç€xxxçš„å£å»/è¯­æ°”ã€å£°éŸ³æ¯”å¯’å†°æ›´å†°å†·ã€ç”¨ä¸å®¹ç½®ç–‘çš„è¯­æ°”ã€æ¯ä¸ªå­—éƒ½å¸¦ç€xxxã€æ²™å“‘çš„å£°éŸ³ã€ä»»ä½•å£°éŸ³è´¨æ„Ÿæè¿°\n**åŸåˆ™ï¼šå®Œå…¨ä¸æå†™è¯­æ°”ï¼Œç”±å¯¹è¯å†…å®¹æœ¬èº«å‡¸æ˜¾äººè®¾**\n\n## ç¬¬å››æ­¥ï¼šå»é™¤å¾®è¡¨æƒ…å’Œå¾®åŠ¨ä½œ\nåˆ é™¤ï¼šæµéœ²å‡ºxxxç¥è‰²ã€çœ¼é‡Œæ¼¾èµ·/é—ªè¿‡xxxã€å˜´è§’ä¸Šæ‰¬/ç¿˜èµ·å¼§åº¦ã€éœ²å‡ºä¸€ä¸å¾®ç¬‘ã€æŒ‡å°–æ³›ç™½ã€ä¸‹æ„è¯†/æ— æ„è¯†çš„åŠ¨ä½œã€ç‹¡é» ã€ç”œè…»ç­‰è¡¨æƒ…\n**æ›¿ä»£ï¼šå¦‚éœ€å°åŠ¨ä½œï¼Œç”¨"ä¹ æƒ¯æ€§åœ°"è€Œé"ä¸‹æ„è¯†"**\n\n## ç¬¬äº”æ­¥ï¼šå»é™¤"ä¸æ˜¯â€¦â€¦è€Œæ˜¯â€¦â€¦"å¥å¼\næ¸…ç†æ‰€æœ‰å¦å®šè½¬æŠ˜å¥ï¼Œç›´æ¥å†™"è€Œæ˜¯"åé¢çš„å†…å®¹\n\n## ç¬¬å…­æ­¥ï¼šä¿®æ”¹å¤–è²Œæè¿°\n- ç³è‰²ç§»å…¥å¯¹è¯ç”±è§’è‰²è‡ªè¿°\n- å¥³æ€§ç½©æ¯æ”¹ä¸º"èƒ¸éƒ¨å¹³å¦/ä¸°æ»¡"ç­‰æè¿°\n- ç²¾ç¡®èº«é«˜æ”¹ä¸º"é«˜ä¸€ç±³å…«"ç­‰æè¿°æ€§è¯­è¨€\n- åˆ é™¤ä¸‰ç»´å°ºå¯¸æ•°æ®\n\n## ç¬¬ä¸ƒæ­¥ï¼šé‡å†™è¯­æ–™å’Œæ€§æ ¼æè¿°\n- è¯­æ–™åªç”¨çº¯å¯¹è¯ï¼Œä¸é™„åŠ è¡¨æƒ…åŠ¨ä½œç¥æ€\n- é€šè¿‡å…·ä½“è¡Œä¸ºååº”ä½“ç°æ€§æ ¼ï¼Œé¿å…æ€§æ ¼æ ‡ç­¾\n- ç”¨é™ˆè¿°å¼è‚¯å®šå‹æè¿°ï¼Œä¸åŠ ä¿®è¾\n\n## ç¬¬å…«æ­¥ï¼šé˜²æ­¢ç»æœ›/ç¥åŒ–/æŒæ§å€¾å‘\n- åˆ é™¤æç«¯æƒ…ç»ªè¯ï¼šæå¤§çš„ææƒ§ã€éå¸¸å®³æ€•ã€æåº¦ç¾è€»ã€æåº¦ä¸å®‰\n- åˆ é™¤è´Ÿé¢çŠ¶æ€è¯ï¼šç•ç¼©ã€ç©ºç™½ã€ä¸€å¡ä¸€å¡ã€æœºæ¢°åŒ–ã€åƒµç¡¬\n- ä¸å†™è§’è‰²å¿ƒç†ååº”å’Œå†…å¿ƒæƒ³æ³•\n- ä¸å†™userçš„å¿ƒç†ååº”ï¼Œä¸ç¥åŒ–è§’è‰²\n\n## ç¬¬ä¹æ­¥ï¼šNSFWéƒ¨åˆ†é˜²æ€§ç‹‚é‡\n- åˆ é™¤ï¼šå–œæ¬¢ç²—æš´/åŠ é€Ÿã€å–œæ¬¢æ€§å¿«æ„Ÿã€ç–¼ç—›ç—›è‹¦ç›¸å…³\n- åˆ é™¤ï¼šæ’•ç¢ã€æ’•è£‚ã€ç ´ç¢ã€ç»ã€ç»ç¼ ã€ç¢¾ã€ç¢¾ç£¨ã€ç ”ç£¨ã€æ”«ã€å°–å«ã€é«˜äº¢ã€å‘œå’½ã€ç”Ÿç†æ€§æ³ªæ°´ã€ç”¬é“ã€å¼“èµ·ã€ç­é¡¶çš„å¿«æ„Ÿã€ç»†ç¢\n- é¿å…æ€§å™¨å®˜å°ºå¯¸å¤¸å¼ æè¿°\n\n## å®Œæ•´ç¦ç”¨è¯åˆ—è¡¨ï¼ˆå¿…é¡»åˆ é™¤ï¼‰ï¼š\næ¨¡ç³Šè¯ï¼šä¸€ä¸ã€ä¸€æŠ¹ã€ä¼¼ä¹ã€å‡ ä¹ã€è¿‘ä¹ã€ä»¿ä½›ã€å¦‚åŒã€å®›å¦‚ã€æ°ä¼¼ã€ä¸æ˜“å¯Ÿè§‰ã€è‹¥æœ‰è‹¥æ— \nåŠ¨ç‰©åŒ–ï¼šé‡å…½ã€å°å…½ã€å¹¼å…½ã€åƒå°å…”å­ã€åƒçŒ«å’ªã€ä½å¼ã€å˜¶å¼ã€å—æƒŠçš„å°å…½\næƒ…ç»ªè¯ï¼šç‹¡é» ã€ç”œè…»ã€ç–¯ç‹‚ã€æˆè°‘ã€æ¼æ€’ã€å›°æƒ‘ã€ææƒ§ã€ç»æœ›ã€å´‡æ‹œã€ç‹‚çƒ­ã€ç©ºæ´ã€æ¯«æ— ç”Ÿæ°”ã€è‡ªå˜²ã€è‹¦æ¶©ã€å†°å†·ã€æš§æ˜§ã€è™”è¯š\nåŠ¨ä½œè¯ï¼šé—ªè¿‡ã€é—ªç€ã€å‘ç™½ã€æ’•ç¢ã€æ’•è£‚ã€å¼§åº¦ã€ç ´ç¢ã€ç»ã€å°–å«ã€å‘œå’½ã€æ²™å“‘ã€ç¢¾ã€ç ”ç£¨ã€æ”«ã€å¼“èµ·ã€ç»†ç¢ã€æŒ‡èŠ‚å‘ç™½ã€æ— æ„è¯†çš„ã€ä¸‹æ„è¯†ã€èœ·ç¼©ã€ç—‰æŒ›ã€åƒµä½ã€æ¥åœ¨åŸåœ°ã€é¢¤æŠ–ã€å®äº†ä¸‹æ¥ã€ç´§æ¡ã€æ”¥ä½ã€å‹¾ä½ã€ç»åœ¨ä¸€èµ·ã€å‹å¾—å–˜ä¸è¿‡æ°”ã€æ·¹æ²¡ã€å‡»å®ã€åˆ’å¼€ã€åˆºç ´ã€åå™¬\nç”Ÿç†è¯ï¼šç”Ÿç†æ€§æ³ªæ°´ã€ç”¬é“ã€ç­é¡¶çš„å¿«æ„Ÿã€æš–æµæ¶Œä¸Šå¿ƒå¤´ã€å¦‚å å†°çªŸã€æµ‘èº«å†°å†·ã€æ‰‹è„šå†°å‡‰ã€å¤§è„‘ä¸€ç‰‡ç©ºç™½ã€å—¡å—¡ä½œå“ã€å‘¼å¸ä¸€æ»ã€å€’å¸ä¸€å£å‡‰æ°”ã€èº«ä½“åƒµç¡¬ã€å¦‚é­é›·å‡»ã€ç»†å¯†çš„æ±—ç \næ¯”å–»ç±»ï¼šçŸ³å­æŠ•å…¥æ¹–ä¸­ã€æ³›èµ·æ¶Ÿæ¼ªã€é’ˆæ‰ç ´æ°”çƒã€æ‰‹æœ¯åˆ€åˆ’å¼€ã€å—æƒŠå°å…½ã€æçº¿æœ¨å¶ã€å‘½è¿çš„é½¿è½®ã€å›å¿†æ½®æ°´ã€é˜³å…‰æ–‘é©³ã€å…‰å½±ã€åƒæ ¹é’ˆä¸€æ ·æ‰è¿›\nå£°éŸ³ç±»ï¼šæ²™å“‘ã€ç£æ€§ã€æ·±æ²‰ã€é“¶é“ƒèˆ¬æ¸…è„†ã€å£°éŸ³é‡Œä¸å¸¦ä¸€ä¸æ¸©åº¦ã€ä½æ²‰è€Œå¯Œæœ‰ç£æ€§ã€ç»†è‹¥èšŠå‘\næŠ½è±¡è¯ï¼šå¿ƒæ¹–ã€å¤äº•ã€æ·±æ¸Šã€è°·åº•ã€æ—¶é—´é™æ­¢ã€ç©ºæ°”å‡å›ºã€åœ£ç‰©ã€è™”è¯šã€å®›è‹¥ç¥æ˜ã€æ¶é­”ã€çŒ®ç¥­ã€ä»ªå¼ã€å®¡åˆ¤ã€å¾æœã€æ”¯é…ã€å æœ‰ã€å‡å›ºã€é™·å…¥ã€æœ¨è®·ã€æ¯å¤©ç­åœ°ã€é“ºå¤©ç›–åœ°ã€æ·¬æ¯’åˆ€å­ã€ç©¿äº‘è£‚çŸ³ã€æ°¤æ°²ã€æœ‰æ¯’è—¤è”“ã€æ‰å…¥éª¨è¡€\nå¦å®šå¥å¼ï¼šä¸æ˜¯è€Œæ˜¯ã€å¹¶ä¸å­˜åœ¨\nç¨‹åº¦è¯ï¼šé“ºå¤©ç›–åœ°ã€ç‹‚é£æš´é›¨ã€æ¯å¤©ç­åœ°ã€å……æ»¡äº†xxxã€ä¸å®¹è´¨ç–‘ã€ä¸å®¹é”™è¾¨ã€ä¸å®¹æŠ—æ‹’ã€éšæ—¶ã€ç«‹åˆ»ã€ç¬é—´ã€é¡·åˆ»é—´\n\n**é‡è¦åŸåˆ™ï¼š**\n1. ç›´æ¥åˆ é™¤ç¦ç”¨è¯ï¼Œä¸è¦æ›¿æ¢ä¸ºåŒä¹‰è¯\n2. ç”¨å…·ä½“è¡Œä¸ºæ›¿ä»£æŠ½è±¡æƒ…ç»ªå’Œå¿ƒç†æå†™\n3. ä¿æŒåŸæ–‡æ ¸å¿ƒæ„æ€ï¼Œä½†è¡¨è¾¾æ–¹å¼è¦å½»åº•æ”¹å˜\n4. è¯­æ–™å¿…é¡»æ˜¯çº¯å¯¹è¯ï¼Œä¸å¸¦ä»»ä½•åŠ¨ä½œè¡¨æƒ…\n5. å¤–è²Œå’Œæ€§æ ¼ç”¨é™ˆè¿°å¼è‚¯å®šæè¿°ï¼Œä¸ç”¨ä¿®è¾\n\nè¯·ä¸¥æ ¼æŒ‰ç…§ä»¥ä¸Šæ ‡å‡†æ¸…ç†æ–‡æœ¬ï¼Œç›´æ¥è¾“å‡ºæ¸…ç†åçš„ç»“æœï¼Œä¸è¦æ·»åŠ ä»»ä½•è§£é‡Šæˆ–è¯´æ˜ã€‚'},{role:'user',content:r.value}],max_tokens:o.value.max_tokens||8e3,temperature:.7})});if(!n.ok)throw new Error(`HTTP error! status: ${n.status}`);const e=await n.json();l.value=e.choices[0].message.content.trim(),f(),window.toastr.success('æ–‡æœ¬æ¸…ç†å®Œæˆï¼')}catch(n){console.error('åå…«è‚¡æ¸…ç†å¤±è´¥:',n),window.toastr.error('æ¸…ç†å¤±è´¥ï¼š'+n.message)}finally{d.value=!1}else window.toastr.warning('è¯·è¾“å…¥éœ€è¦æ¸…ç†çš„æ–‡æœ¬')},E=()=>{l.value?w(l.value,'æ¸…ç†ç»“æœå·²å¤åˆ¶åˆ°å‰ªè´´æ¿'):window.toastr.warning('æ²¡æœ‰å¯å¤åˆ¶çš„å†…å®¹')},T=async()=>{if(p.value.trim())try{u.value=!0,window.toastr.info('AIæ­£åœ¨ç”Ÿæˆè§’è‰²å¡ï¼Œè¯·ç¨å€™...');const n=await fetch(o.value.api_endpoint,{method:'POST',headers:{'Content-Type':'application/json',Authorization:`Bearer ${o.value.api_key}`},body:JSON.stringify({model:o.value.model||'gpt-3.5-turbo',max_tokens:o.value.max_tokens||16e3,temperature:.8,messages:[{role:'system',content:'ä½ æ˜¯ä¸€ä¸ªè§’è‰²å¡ç”ŸæˆåŠ©æ‰‹ã€‚è¯·ç³»ç»Ÿæ€§åœ°åˆ›å»ºä¸€ä¸ªå®Œæ•´çš„è§’è‰²å¡ã€‚\n\n**è¾“å‡ºæ ¼å¼è¦æ±‚**ï¼š\n- å¿…é¡»ä½¿ç”¨ YAML æ ¼å¼ï¼Œæ‰€æœ‰å­—æ®µåå’Œå†…å®¹éƒ½ç”¨ä¸­æ–‡\n- ç¡®ä¿è¾“å‡ºå®Œæ•´ï¼Œä¸è¦æˆªæ–­\n- é¿å…AIåˆ»æ¿åŒ–ï¼Œè¦æœ‰å¤šæ ·æ€§å’ŒçœŸå®æ„Ÿ\n- ä¸¥æ ¼é¿å…ä»»ä½•AIæŒ‡ä»¤å¼è¯­è¨€\n\n**è§’è‰²å¡ç»“æ„æ¨¡æ¿**ï¼š\n```yaml\nåŸºç¡€ä¿¡æ¯:\n  å§“å: "å…¨å"\n  å¹´é¾„: å…·ä½“å¹´é¾„\n  å‡ºç”Ÿå¹´æœˆ: "YYYYå¹´MMæœˆ"\n  æ€§åˆ«: "ç”·/å¥³/å…¶ä»–"\n  ç¬¬äºŒæ€§åˆ«: "Alpha/Beta/Omega/æ— "\n  èº«é«˜ä½“é‡: "èº«é«˜ç”¨æ–‡å­—æè¿°ï¼ˆé«˜å¤§/ä¸­ç­‰/å¨‡å°ç­‰ï¼‰ï¼Œä½“é‡ç”¨æ–‡å­—æè¿°ï¼ˆåŒ€ç§°/çº¤ç˜¦/ä¸°æ»¡ç­‰ï¼‰"\n  ä¿¡æ¯ç´ : "æè¿°æ°”å‘³ç‰¹å¾å’Œå˜åŒ–è§„å¾‹ï¼ˆå¦‚é€‚ç”¨ï¼‰"\n  æ€§å–å‘: "å¼‚æ€§æ‹/åŒæ€§æ‹/åŒæ€§æ‹ç­‰"\n  æ‹çˆ±ç»éªŒ: "è¯¦ç»†æè¿°"\n  èº«ä»½èŒä¸š: "å…·ä½“èŒä¸šå’Œç¤¾ä¼šåœ°ä½"\n  æ ‡å¿—æ€§ç‰¹å¾:\n    å¾®ä¿¡æ˜µç§°: "æ˜µç§°"\n    å¤´åƒ: "æè¿°"\n    å…¶ä»–: "å…¶ä»–æ ‡å¿—æ€§ç‰¹å¾"\n\nå¤–è²Œä¸èº«æ:\n  æ•´ä½“èº«å½¢: "é«˜çŸ®èƒ–ç˜¦ã€è‚Œè‚‰ç±»å‹çš„è¯¦ç»†æè¿°"\n  é¢å®¹ç‰¹å¾:\n    å‘å‹: "å‘å‹ã€å‘è‰²ã€å‘è´¨"\n    è‚¤è‰²: "è‚¤è‰²æè¿°"\n    çœ¼ç›: "çœ¼ç›é¢œè‰²å’Œç‰¹å¾"\n    äº”å®˜: "äº”å®˜ç‰¹ç‚¹"\n  ç©¿æ­é£æ ¼: "æ—¥å¸¸ç©¿æ­åå¥½å’Œé£æ ¼"\n  å£°éŸ³ç‰¹å¾: "éŸ³è‰²ã€éŸ³è°ƒã€è¯´è¯èŠ‚å¥"\n  ä¹ æƒ¯æ€§åŠ¨ä½œ: "å¸¸è§çš„å§¿æ€å’Œå°åŠ¨ä½œ"\n\næ€§æ ¼ä¸å¿ƒç†:\n  ä¸»è¦æ€§æ ¼ç‰¹å¾:\n    - ç‰¹è´¨1: "å…·ä½“è¡¨ç°å’Œè¡Œä¸ºæ¨¡å¼"\n    - ç‰¹è´¨2: "å…·ä½“è¡¨ç°å’Œè¡Œä¸ºæ¨¡å¼"\n    - ç‰¹è´¨3: "å…·ä½“è¡¨ç°å’Œè¡Œä¸ºæ¨¡å¼"\n  æ€§æ ¼çš„ä¸¤é¢æ€§: "åœ¨ä¸åŒæƒ…å†µä¸‹å±•ç°çš„ä¸åŒä¾§é¢ï¼ˆä¾‹å¦‚ï¼šå¹³æ—¶æ¸©å’Œä½†è§¦åŠåº•çº¿æ—¶å¼ºç¡¬ï¼‰"\n  æƒ…ç»ªæ¨¡å¼:\n    å¸¸è§æƒ…ç»ª: "æ—¥å¸¸ä¸»è¦æƒ…ç»ªçŠ¶æ€"\n    æƒ…ç»ªè§¦å‘ç‚¹: "ä»€ä¹ˆå®¹æ˜“å¼•å‘æƒ…ç»ªæ³¢åŠ¨"\n    æƒ…ç»ªè¡¨è¾¾æ–¹å¼: "å¦‚ä½•è¡¨ç°å’Œå¤„ç†æƒ…ç»ª"\n  åº”å¯¹å‹åŠ›: "é¢å¯¹å‹åŠ›å’Œå›°å¢ƒæ—¶çš„ååº”å’Œå¤„ç†æ–¹å¼"\n\nå¯¹è¯é£æ ¼:\n  æ—¥å¸¸è¯­æ°”: "ç”¨è¯ä¹ æƒ¯å’Œè¯´è¯ç‰¹ç‚¹"\n  å¯¹ä¸åŒå¯¹è±¡:\n    äº²è¿‘çš„äºº: "è¯´è¯æ–¹å¼"\n    é™Œç”Ÿäºº: "è¯´è¯æ–¹å¼"\n    å·¥ä½œåœºåˆ: "è¯´è¯æ–¹å¼"\n  æƒ…ç»ªå˜åŒ–æ—¶: "æƒ…ç»ªæ¿€åŠ¨/ä½è½æ—¶çš„è¯­è¨€å˜åŒ–"\n  å£å¤´ç¦…: ["å£å¤´ç¦…1", "å£å¤´ç¦…2"]\n\nèƒŒæ™¯ç»å†:\n  å®¶åº­èƒŒæ™¯: "è¯¦ç»†çš„å®¶åº­ç¯å¢ƒå’Œæˆé•¿èƒŒæ™¯"\n  æ•™è‚²ç»å†: "å­¦ä¹ ç»å†"\n  é‡è¦äººç”Ÿäº‹ä»¶: ["äº‹ä»¶1", "äº‹ä»¶2", "äº‹ä»¶3"]\n  å…³é”®è½¬æŠ˜ç‚¹: "æ”¹å˜TAçš„é‡è¦äº‹ä»¶"\n  å½“å‰çŠ¶å†µ: "ç°åœ¨çš„ç”Ÿæ´»çŠ¶æ€"\n  äººç”Ÿç›®æ ‡: "TAæƒ³è¦è¾¾æˆçš„ç›®æ ‡"\n\näººé™…å…³ç³»:\n  å¯¹ä¸»è¦è§’è‰²çš„æ€åº¦: "ä¸{{user}}æˆ–å…¶ä»–é‡è¦è§’è‰²çš„äº’åŠ¨æ¨¡å¼"\n  ç¤¾äº¤åå¥½: "å–œæ¬¢çš„ç¤¾äº¤æ–¹å¼å’Œè¾¹ç•Œ"\n  ç¾¤ä½“è§’è‰²: "åœ¨å›¢é˜Ÿä¸­çš„å®šä½ï¼ˆé¢†å¯¼è€…/åè°ƒè€…/è§‚å¯Ÿè€…ç­‰ï¼‰"\n  å†²çªå¤„ç†: "å¦‚ä½•å¤„ç†çŸ›ç›¾å’Œå†²çª"\n\nè¡Œä¸ºæ¨¡å¼ä¸åŠ¨æœº:\n  å…¸å‹è¡Œä¸º:\n    ä¸»åŠ¨å€¾å‘: "TAå€¾å‘äºä¸»åŠ¨åšä»€ä¹ˆäº‹æƒ…"\n    å›é¿å€¾å‘: "TAä¼šé¿å…æˆ–æ‹’ç»åšä»€ä¹ˆ"\n    ä¹ æƒ¯ååº”: "åœ¨ç‰¹å®šæƒ…å†µä¸‹çš„å…¸å‹ååº”"\n  åº•çº¿ä¸åŸåˆ™: "TAåšå®ˆçš„åŸåˆ™å’Œä¸å¯è§¦ç¢°çš„åº•çº¿"\n  å†…åœ¨åŠ¨æœº:\n    è¡ŒåŠ¨é©±åŠ¨: "æ¨åŠ¨TAè¡ŒåŠ¨çš„å†…åœ¨åŸå› "\n    æ·±å±‚éœ€æ±‚: "TAå†…å¿ƒçœŸæ­£æ¸´æœ›çš„æ˜¯ä»€ä¹ˆ"\n    éšè—æƒ³æ³•: "TAä¸è½»æ˜“è¡¨éœ²çš„çœŸå®æƒ³æ³•"\n  æƒ…ç»ªç®¡ç†:\n    å¤±æ§è¾¹ç•Œ: "ä»€ä¹ˆæƒ…å†µä¸‹ä¼šæƒ…ç»ªå¤±æ§"\n    æ¢å¤æ–¹å¼: "å¦‚ä½•å¹³å¤æƒ…ç»ªå’Œè‡ªæˆ‘è°ƒèŠ‚"\n```\n\nè¯·åŸºäºç”¨æˆ·çš„æè¿°ï¼Œç”Ÿæˆä¸€ä¸ªå®Œæ•´ã€ç«‹ä½“ã€çœŸå®çš„è§’è‰²ã€‚æ³¨æ„ï¼š\n1. èº«é«˜ä½“é‡å¿…é¡»ç”¨æ–‡å­—æè¿°ï¼Œä¸è¦ç”¨æ•°å­—å’Œå•ä½\n2. æ€§æ ¼è¦å±•ç°å¤šé¢æ€§å’Œå¤æ‚æ€§ï¼Œé¿å…å•ä¸€åŒ–å’Œåˆ»æ¿å°è±¡\n3. è¡Œä¸ºæ¨¡å¼è¦ä»è§’è‰²è§†è§’å‡ºå‘ï¼Œæè¿°TAä¼šå¦‚ä½•æ€è€ƒå’Œè¡ŒåŠ¨\n4. æ‰€æœ‰å†…å®¹è¦è¯¦ç»†ä¸°å¯Œï¼Œæœ‰å…·ä½“ä¾‹å­å’Œåœºæ™¯'},{role:'user',content:p.value}]})});if(!n.ok)throw new Error(`HTTP error! status: ${n.status}`);const e=await n.json();g.value=e.choices[0].message.content.trim(),f(),window.toastr.success('è§’è‰²å¡ç”Ÿæˆå®Œæˆï¼')}catch(n){console.error('è§’è‰²å¡ç”Ÿæˆå¤±è´¥:',n),window.toastr.error('ç”Ÿæˆå¤±è´¥ï¼š'+n.message)}finally{u.value=!1}else window.toastr.warning('è¯·è¾“å…¥è§’è‰²æè¿°')},I=()=>{p.value='',g.value='',m.value='',f(),window.toastr.success('å†…å®¹å·²æ¸…ç©º')},S=()=>{g.value?w(g.value,'è§’è‰²å¡å·²å¤åˆ¶åˆ°å‰ªè´´æ¿'):window.toastr.warning('æ²¡æœ‰å¯å¤åˆ¶çš„å†…å®¹')},N=()=>{r.value='',l.value='',f(),window.toastr.success('å†…å®¹å·²æ¸…ç©º')},V=async()=>{if(m.value.trim())if(g.value)try{x.value=!0,window.toastr.info('AIæ­£åœ¨æ ¹æ®ä½ çš„éœ€æ±‚ä¿®æ”¹è§’è‰²å¡ï¼Œè¯·ç¨å€™...');const n=await fetch(o.value.api_endpoint,{method:'POST',headers:{'Content-Type':'application/json',Authorization:`Bearer ${o.value.api_key}`},body:JSON.stringify({model:o.value.model||'gpt-3.5-turbo',max_tokens:o.value.max_tokens||16e3,temperature:.8,messages:[{role:'system',content:'ä½ æ˜¯ä¸€ä¸ªè§’è‰²å¡ç¼–è¾‘åŠ©æ‰‹ã€‚ç”¨æˆ·ä¼šæä¾›ä¸€ä¸ªç°æœ‰çš„ YAML æ ¼å¼è§’è‰²å¡å’Œä¿®æ”¹éœ€æ±‚ï¼Œè¯·æ ¹æ®ä¿®æ”¹éœ€æ±‚è°ƒæ•´è§’è‰²å¡å†…å®¹ã€‚\n\n**ä¿®æ”¹åŸåˆ™**ï¼š\n1. å¿…é¡»ä¿æŒ YAML æ ¼å¼ï¼Œæ‰€æœ‰å­—æ®µåå’Œå†…å®¹éƒ½ä½¿ç”¨ä¸­æ–‡\n2. åªä¿®æ”¹ç”¨æˆ·æ˜ç¡®è¦æ±‚ä¿®æ”¹çš„éƒ¨åˆ†\n3. ç¡®ä¿ä¿®æ”¹åçš„å†…å®¹ä¸åŸæœ‰è§’è‰²å¡é£æ ¼ä¸€è‡´\n4. å¦‚æœç”¨æˆ·çš„è¦æ±‚ä¸åŸæœ‰è®¾å®šå†²çªï¼Œä»¥ç”¨æˆ·çš„è¦æ±‚ä¸ºå‡†\n5. è¾“å‡ºå®Œæ•´çš„ä¿®æ”¹åçš„è§’è‰²å¡ï¼Œä¸è¦æˆªæ–­\n6. ä¿æŒåŸæœ‰çš„å­—æ®µç»“æ„ï¼Œé™¤éç”¨æˆ·è¦æ±‚æ·»åŠ æˆ–åˆ é™¤å­—æ®µ\n\n**é‡è¦æ³¨æ„äº‹é¡¹**ï¼š\n- èº«é«˜ä½“é‡å¿…é¡»ç”¨æ–‡å­—æè¿°ï¼ˆé«˜å¤§/ä¸­ç­‰/å¨‡å°/åŒ€ç§°/çº¤ç˜¦ç­‰ï¼‰ï¼Œä¸è¦ç”¨æ•°å­—å’Œå•ä½\n- ä¿æŒæ€§æ ¼çš„å¤šé¢æ€§å’Œå¤æ‚æ€§ï¼Œé¿å…å•ä¸€åŒ–\n- è¡Œä¸ºæ¨¡å¼è¦ä»è§’è‰²è§†è§’å‡ºå‘ï¼Œæè¿°è§’è‰²ä¼šå¦‚ä½•æ€è€ƒå’Œè¡ŒåŠ¨\n- é¿å…AIåˆ»æ¿åŒ–ï¼Œä¿æŒè§’è‰²çš„çœŸå®æ„Ÿå’Œå¤šæ ·æ€§\n\nè¯·è¾“å‡ºå®Œæ•´çš„ YAML æ ¼å¼è§’è‰²å¡ã€‚'},{role:'user',content:`ä»¥ä¸‹æ˜¯ç°æœ‰çš„è§’è‰²å¡ï¼š\n\n${g.value}\n\n---\n\nè¯·æ ¹æ®ä»¥ä¸‹ä¿®æ”¹éœ€æ±‚è°ƒæ•´è§’è‰²å¡ï¼š\n${m.value}`}]})});if(!n.ok)throw new Error(`HTTP error! status: ${n.status}`);const e=await n.json();g.value=e.choices[0].message.content.trim(),m.value='',f(),window.toastr.success('è§’è‰²å¡ä¿®æ”¹å®Œæˆï¼')}catch(n){console.error('è§’è‰²å¡ä¿®æ”¹å¤±è´¥:',n),window.toastr.error('ä¿®æ”¹å¤±è´¥ï¼š'+n.message)}finally{x.value=!1}else window.toastr.warning('æ²¡æœ‰å¯ä¿®æ”¹çš„è§’è‰²å¡ï¼Œè¯·å…ˆç”Ÿæˆè§’è‰²å¡');else window.toastr.warning('è¯·è¾“å…¥ä¿®æ”¹éœ€æ±‚')},D=()=>{m.value='',f(),window.toastr.success('ä¿®æ”¹éœ€æ±‚å·²æ¸…ç©º')};return(n,e)=>((0,s.openBlock)(),(0,s.createElementBlock)('div',ee,[(0,s.createCommentVNode)(' åå…«è‚¡å·¥å…· '),(0,s.createElementVNode)('div',te,[(0,s.createElementVNode)('div',{class:'section-header',onClick:e[0]||(e[0]=n=>y('antiCliche'))},[e[5]||(e[5]=(0,s.createElementVNode)('h4',{style:{margin:'0',color:'#fff','font-size':'16px','font-weight':'600'}},[(0,s.createElementVNode)('i',{class:'fa-solid fa-broom',style:{'margin-right':'8px',color:'#ff6b6b'}}),(0,s.createTextVNode)(' åå…«è‚¡å·¥å…· ')],-1)),(0,s.createElementVNode)('i',{class:(0,s.normalizeClass)(A('antiCliche')?'fa-solid fa-chevron-up':'fa-solid fa-chevron-down'),style:{color:'#ccc',transition:'transform 0.3s ease'}},null,2)]),A('antiCliche')?((0,s.openBlock)(),(0,s.createElementBlock)('div',oe,[e[12]||(e[12]=(0,s.createElementVNode)('div',{class:'tool-instructions'},[(0,s.createElementVNode)('p',{style:{margin:'0 0 8px 0',color:'#ccc','font-size':'12px'}},[(0,s.createElementVNode)('i',{class:'fa-solid fa-info-circle',style:{'margin-right':'6px',color:'#17a2b8'}}),(0,s.createTextVNode)(' è§’è‰²å¡/ä¸–ç•Œä¹¦/å¼€åœºç™½å…«è‚¡æ¸…ç†å·¥å…·ï¼Œç³»ç»ŸåŒ–æ‰§è¡Œ9ä¸ªæ­¥éª¤ï¼Œæ¸…é™¤200+ç¦ç”¨è¯ã€‚ ')]),(0,s.createElementVNode)('p',{style:{margin:'0',color:'#ffa500','font-size':'11px',background:'#1a1a1a',padding:'6px','border-radius':'4px','border-left':'3px solid #ffa500'}},' âš¡ æ¸…ç†å†…å®¹ï¼šæ¨¡ç³Šè¯ã€åŠ¨ç‰©åŒ–æ¯”å–»ã€è¯­æ°”å£°éŸ³ã€å¾®è¡¨æƒ…ã€å¦å®šå¥å¼ã€ç»æœ›/ç¥åŒ–å€¾å‘ã€NSFWæ€§ç‹‚é‡ç­‰ ')],-1)),(0,s.createElementVNode)('div',ae,[e[6]||(e[6]=(0,s.createElementVNode)('label',{style:{display:'block','margin-bottom':'8px',color:'#ccc','font-size':'13px','font-weight':'500'}},' è¾“å…¥æ–‡æœ¬ï¼š ',-1)),(0,s.withDirectives)((0,s.createElementVNode)('textarea',{'onUpdate:modelValue':e[1]||(e[1]=n=>r.value=n),placeholder:'è¯·è¾“å…¥éœ€è¦æ¸…ç†çš„æ–‡æœ¬...',style:{width:'100%',height:'120px',padding:'12px',background:'#2a2a2a',border:'1px solid #3a3a3a','border-radius':'6px',color:'#e0e0e0','font-size':'13px',resize:'vertical','font-family':'inherit'}},null,512),[[s.vModelText,r.value]])]),(0,s.createElementVNode)('div',re,[(0,s.createElementVNode)('button',{class:'process-button',disabled:d.value||!r.value.trim(),style:{padding:'12px 24px',background:'linear-gradient(135deg, #667eea 0%, #764ba2 100%)',border:'none','border-radius':'8px',color:'white','font-size':'13px','font-weight':'600',cursor:'pointer',transition:'all 0.3s ease','box-shadow':'0 3px 12px rgba(102, 126, 234, 0.3)',position:'relative',overflow:'hidden'},onClick:B},[e[7]||(e[7]=(0,s.createElementVNode)('div',{style:{position:'absolute',top:'0',left:'-100%',width:'100%',height:'100%',background:'linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent)',transition:'left 0.5s'},class:'shimmer-effect'},null,-1)),e[8]||(e[8]=(0,s.createElementVNode)('i',{class:'fa-solid fa-magic',style:{'font-size':'14px','margin-right':'6px'}},null,-1)),(0,s.createTextVNode)(' '+(0,s.toDisplayString)(d.value?'å¤„ç†ä¸­...':'å¼€å§‹æ¸…ç†'),1)],8,se),(0,s.createElementVNode)('button',{class:'clear-button',style:{padding:'12px 24px',background:'linear-gradient(135deg, #ff6b6b 0%, #ee5a24 100%)',border:'none','border-radius':'8px',color:'white','font-size':'13px','font-weight':'600',cursor:'pointer',transition:'all 0.3s ease','box-shadow':'0 3px 12px rgba(255, 107, 107, 0.3)',position:'relative',overflow:'hidden'},onClick:N},[...e[9]||(e[9]=[(0,s.createElementVNode)('div',{style:{position:'absolute',top:'0',left:'-100%',width:'100%',height:'100%',background:'linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent)',transition:'left 0.5s'},class:'shimmer-effect'},null,-1),(0,s.createElementVNode)('i',{class:'fa-solid fa-trash',style:{'font-size':'14px','margin-right':'6px'}},null,-1),(0,s.createTextVNode)(' æ¸…ç©º ',-1)])])]),(0,s.createCommentVNode)(' è¾“å‡ºåŒºåŸŸ '),l.value?((0,s.openBlock)(),(0,s.createElementBlock)('div',ie,[e[11]||(e[11]=(0,s.createElementVNode)('h5',{style:{margin:'0 0 12px 0',color:'#fff','font-size':'14px','font-weight':'600'}},[(0,s.createElementVNode)('i',{class:'fa-solid fa-check-circle',style:{'margin-right':'6px',color:'#28a745'}}),(0,s.createTextVNode)(' æ¸…ç†ç»“æœï¼š ')],-1)),(0,s.createElementVNode)('div',le,(0,s.toDisplayString)(l.value),1),(0,s.createElementVNode)('div',{class:'output-actions',style:{'margin-top':'12px',display:'flex',gap:'12px'}},[(0,s.createElementVNode)('button',{class:'copy-button',style:{padding:'10px 20px',background:'linear-gradient(135deg, #28a745 0%, #20c997 100%)',border:'none','border-radius':'6px',color:'white','font-size':'13px','font-weight':'600',cursor:'pointer',transition:'all 0.3s ease',display:'flex','align-items':'center',gap:'8px','box-shadow':'0 3px 12px rgba(40, 167, 69, 0.3)',position:'relative',overflow:'hidden'},onClick:E},[...e[10]||(e[10]=[(0,s.createElementVNode)('div',{style:{position:'absolute',top:'0',left:'-100%',width:'100%',height:'100%',background:'linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent)',transition:'left 0.5s'},class:'shimmer-effect'},null,-1),(0,s.createElementVNode)('i',{class:'fa-solid fa-copy',style:{'font-size':'14px'}},null,-1),(0,s.createTextVNode)(' å¤åˆ¶ç»“æœ ',-1)])])])])):(0,s.createCommentVNode)('v-if',!0)])):(0,s.createCommentVNode)('v-if',!0)]),(0,s.createCommentVNode)(' è§’è‰²å¡ç”Ÿæˆå·¥å…· '),(0,s.createElementVNode)('div',de,[(0,s.createElementVNode)('div',{class:'section-header',onClick:e[2]||(e[2]=n=>y('characterCard'))},[e[13]||(e[13]=(0,s.createElementVNode)('h4',{style:{margin:'0',color:'#fff','font-size':'16px','font-weight':'600'}},[(0,s.createElementVNode)('i',{class:'fa-solid fa-user-plus',style:{'margin-right':'8px',color:'#17a2b8'}}),(0,s.createTextVNode)(' è§’è‰²å¡ç”Ÿæˆå·¥å…· ')],-1)),(0,s.createElementVNode)('i',{class:(0,s.normalizeClass)(A('characterCard')?'fa-solid fa-chevron-up':'fa-solid fa-chevron-down'),style:{color:'#ccc',transition:'transform 0.3s ease'}},null,2)]),A('characterCard')?((0,s.openBlock)(),(0,s.createElementBlock)('div',ce,[e[25]||(e[25]=(0,s.createStaticVNode)('<div class="tool-instructions" data-v-0c833396><p style="margin:0 0 8px 0;color:#ccc;font-size:12px;" data-v-0c833396><i class="fa-solid fa-info-circle" style="margin-right:6px;color:#17a2b8;" data-v-0c833396></i> è¾“å…¥è§’è‰²æè¿°ï¼ŒAIå°†è‡ªåŠ¨ç”Ÿæˆè§’è‰²å¡ï¼ˆYAML æ ¼å¼ï¼Œçº¯ä¸­æ–‡ï¼‰ã€‚ </p><p style="margin:0 0 6px 0;color:#4a9eff;font-size:11px;background:#1a1a1a;padding:6px;border-radius:4px;border-left:3px solid #17a2b8;" data-v-0c833396> ğŸ’¡ åŒ…å«å†…å®¹ï¼šåŸºç¡€ä¿¡æ¯ã€å¤–è²Œèº«æã€æ ¸å¿ƒæ€§æ ¼ã€å¯¹è¯é£æ ¼ã€èƒŒæ™¯ç»å†ã€äººé™…å…³ç³»ã€æ¼”ç»æŒ‡å¯¼ </p><p style="margin:0 0 6px 0;color:#ffa500;font-size:11px;background:#1a1a1a;padding:6px;border-radius:4px;border-left:3px solid #ffa500;" data-v-0c833396> âš ï¸ æ³¨æ„ï¼šèº«é«˜ä½“é‡ä½¿ç”¨æ–‡å­—æè¿°ï¼ˆå¦‚&quot;é«˜å¤§åŒ€ç§°&quot;ï¼‰ï¼Œé¿å…AIåˆ»æ¿åŒ–ï¼Œæœ‰æ€§æ ¼å¯¹ç«‹é¢å’Œä¿®å¤æœºåˆ¶ </p></div>',1)),(0,s.createElementVNode)('div',pe,[e[14]||(e[14]=(0,s.createElementVNode)('label',{style:{display:'block','margin-bottom':'8px',color:'#ccc','font-size':'13px','font-weight':'500'}},' è§’è‰²æè¿°ï¼š ',-1)),(0,s.withDirectives)((0,s.createElementVNode)('textarea',{'onUpdate:modelValue':e[3]||(e[3]=n=>p.value=n),placeholder:'è¯·æè¿°è§’è‰²çš„åŸºæœ¬ä¿¡æ¯ï¼Œå¦‚å¤–è§‚ã€æ€§æ ¼ã€èƒŒæ™¯ç­‰...',style:{width:'100%',height:'120px',padding:'12px',background:'#2a2a2a',border:'1px solid #3a3a3a','border-radius':'6px',color:'#e0e0e0','font-size':'13px',resize:'vertical','font-family':'inherit'}},null,512),[[s.vModelText,p.value]])]),(0,s.createElementVNode)('div',ge,[(0,s.createElementVNode)('button',{class:'generate-button',disabled:u.value||!p.value.trim(),style:{padding:'12px 24px',background:'linear-gradient(135deg, #17a2b8 0%, #138496 100%)',border:'none','border-radius':'8px',color:'white','font-size':'13px','font-weight':'600',cursor:'pointer',transition:'all 0.3s ease','box-shadow':'0 3px 12px rgba(23, 162, 184, 0.3)',position:'relative',overflow:'hidden'},onClick:T},[e[15]||(e[15]=(0,s.createElementVNode)('div',{style:{position:'absolute',top:'0',left:'-100%',width:'100%',height:'100%',background:'linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent)',transition:'left 0.5s'},class:'shimmer-effect'},null,-1)),e[16]||(e[16]=(0,s.createElementVNode)('i',{class:'fa-solid fa-magic',style:{'font-size':'14px','margin-right':'6px'}},null,-1)),(0,s.createTextVNode)(' '+(0,s.toDisplayString)(u.value?'ç”Ÿæˆä¸­...':'ç”Ÿæˆè§’è‰²å¡'),1)],8,ue),(0,s.createElementVNode)('button',{class:'clear-button',style:{padding:'12px 24px',background:'linear-gradient(135deg, #ff6b6b 0%, #ee5a24 100%)',border:'none','border-radius':'8px',color:'white','font-size':'13px','font-weight':'600',cursor:'pointer',transition:'all 0.3s ease','box-shadow':'0 3px 12px rgba(255, 107, 107, 0.3)',position:'relative',overflow:'hidden'},onClick:I},[...e[17]||(e[17]=[(0,s.createElementVNode)('div',{style:{position:'absolute',top:'0',left:'-100%',width:'100%',height:'100%',background:'linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent)',transition:'left 0.5s'},class:'shimmer-effect'},null,-1),(0,s.createElementVNode)('i',{class:'fa-solid fa-trash',style:{'font-size':'14px','margin-right':'6px'}},null,-1),(0,s.createTextVNode)(' æ¸…ç©º ',-1)])])]),(0,s.createCommentVNode)(' è¾“å‡ºåŒºåŸŸ '),g.value?((0,s.openBlock)(),(0,s.createElementBlock)('div',me,[e[24]||(e[24]=(0,s.createElementVNode)('h5',{style:{margin:'0 0 12px 0',color:'#fff','font-size':'14px','font-weight':'600'}},[(0,s.createElementVNode)('i',{class:'fa-solid fa-check-circle',style:{'margin-right':'6px',color:'#28a745'}}),(0,s.createTextVNode)(' ç”Ÿæˆçš„è§’è‰²å¡ï¼š ')],-1)),(0,s.createElementVNode)('div',xe,(0,s.toDisplayString)(g.value),1),(0,s.createElementVNode)('div',{class:'output-actions',style:{'margin-top':'12px',display:'flex',gap:'12px'}},[(0,s.createElementVNode)('button',{class:'copy-button',style:{padding:'10px 20px',background:'linear-gradient(135deg, #28a745 0%, #20c997 100%)',border:'none','border-radius':'6px',color:'white','font-size':'13px','font-weight':'600',cursor:'pointer',transition:'all 0.3s ease',display:'flex','align-items':'center',gap:'8px','box-shadow':'0 3px 12px rgba(40, 167, 69, 0.3)',position:'relative',overflow:'hidden'},onClick:S},[...e[18]||(e[18]=[(0,s.createElementVNode)('div',{style:{position:'absolute',top:'0',left:'-100%',width:'100%',height:'100%',background:'linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent)',transition:'left 0.5s'},class:'shimmer-effect'},null,-1),(0,s.createElementVNode)('i',{class:'fa-solid fa-copy',style:{'font-size':'14px'}},null,-1),(0,s.createTextVNode)(' å¤åˆ¶è§’è‰²å¡ ',-1)])])]),(0,s.createCommentVNode)(' è§’è‰²å¡ä¿®æ”¹åŒºåŸŸ '),(0,s.createElementVNode)('div',be,[e[23]||(e[23]=(0,s.createStaticVNode)('<h5 style="margin:0 0 12px 0;color:#fff;font-size:14px;font-weight:600;" data-v-0c833396><i class="fa-solid fa-edit" style="margin-right:6px;color:#ffa500;" data-v-0c833396></i> ä¿®æ”¹è§’è‰²å¡ </h5><div class="modify-instructions" style="background:#1a1a1a;border:1px solid #3a3a3a;border-radius:6px;padding:10px;margin-bottom:15px;" data-v-0c833396><p style="margin:0 0 6px 0;color:#ccc;font-size:12px;" data-v-0c833396><i class="fa-solid fa-lightbulb" style="margin-right:6px;color:#ffa500;" data-v-0c833396></i> æè¿°ä½ æƒ³è¦ä¿®æ”¹çš„å†…å®¹ï¼ŒAIä¼šæ ¹æ®ä½ çš„éœ€æ±‚è°ƒæ•´è§’è‰²å¡ã€‚ä¾‹å¦‚ï¼š&quot;è®©è§’è‰²æ›´æ´»æ³¼ä¸€äº›&quot;ã€&quot;å¢åŠ é­”æ³•æŠ€èƒ½&quot;ã€&quot;æ”¹ä¸ºå¥³æ€§è§’è‰²&quot;ç­‰ã€‚ </p><p style="margin:0;color:#ffa500;font-size:11px;" data-v-0c833396>âš ï¸ ä¿®æ”¹åä¼šä¿æŒ YAML æ ¼å¼å’Œä¸­æ–‡å­—æ®µã€‚</p></div>',2)),(0,s.createElementVNode)('div',fe,[e[19]||(e[19]=(0,s.createElementVNode)('label',{style:{display:'block','margin-bottom':'8px',color:'#ccc','font-size':'13px','font-weight':'500'}},' ä¿®æ”¹éœ€æ±‚ï¼š ',-1)),(0,s.withDirectives)((0,s.createElementVNode)('textarea',{'onUpdate:modelValue':e[4]||(e[4]=n=>m.value=n),placeholder:'è¯·æè¿°ä½ æƒ³è¦ä¿®æ”¹çš„å†…å®¹...',style:{width:'100%',height:'80px',padding:'12px',background:'#2a2a2a',border:'1px solid #3a3a3a','border-radius':'6px',color:'#e0e0e0','font-size':'13px',resize:'vertical','font-family':'inherit'}},null,512),[[s.vModelText,m.value]])]),(0,s.createElementVNode)('div',he,[(0,s.createElementVNode)('button',{class:'modify-button',disabled:x.value||!m.value.trim(),style:{padding:'12px 24px',background:'linear-gradient(135deg, #ffa500 0%, #ff8c00 100%)',border:'none','border-radius':'8px',color:'white','font-size':'13px','font-weight':'600',cursor:'pointer',transition:'all 0.3s ease','box-shadow':'0 3px 12px rgba(255, 165, 0, 0.3)',position:'relative',overflow:'hidden'},onClick:V},[e[20]||(e[20]=(0,s.createElementVNode)('div',{style:{position:'absolute',top:'0',left:'-100%',width:'100%',height:'100%',background:'linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent)',transition:'left 0.5s'},class:'shimmer-effect'},null,-1)),e[21]||(e[21]=(0,s.createElementVNode)('i',{class:'fa-solid fa-wand-magic-sparkles',style:{'font-size':'14px','margin-right':'6px'}},null,-1)),(0,s.createTextVNode)(' '+(0,s.toDisplayString)(x.value?'ä¿®æ”¹ä¸­...':'AIä¿®æ”¹'),1)],8,ye),(0,s.createElementVNode)('button',{class:'clear-modify-button',style:{padding:'12px 24px',background:'linear-gradient(135deg, #6c757d 0%, #5a6268 100%)',border:'none','border-radius':'8px',color:'white','font-size':'13px','font-weight':'600',cursor:'pointer',transition:'all 0.3s ease','box-shadow':'0 3px 12px rgba(108, 117, 125, 0.3)',position:'relative',overflow:'hidden'},onClick:D},[...e[22]||(e[22]=[(0,s.createElementVNode)('div',{style:{position:'absolute',top:'0',left:'-100%',width:'100%',height:'100%',background:'linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent)',transition:'left 0.5s'},class:'shimmer-effect'},null,-1),(0,s.createElementVNode)('i',{class:'fa-solid fa-eraser',style:{'font-size':'14px','margin-right':'6px'}},null,-1),(0,s.createTextVNode)(' æ¸…ç©ºä¿®æ”¹éœ€æ±‚ ',-1)])])])])])):(0,s.createCommentVNode)('v-if',!0)])):(0,s.createCommentVNode)('v-if',!0)])]))}});r(915);const we=(0,Vn.A)(Ae,[['__scopeId','data-v-0c833396']]),Ce={class:'memory-panel-container',style:{display:'flex','flex-direction':'column',height:'100%',background:'#1a1a1a',color:'#e0e0e0'}},ve={class:'panel-tabs',style:{display:'flex',background:'#2a2a2a','border-bottom':'1px solid #3a3a3a','flex-shrink':'0'}},ke=['onClick'],Be={class:'panel-content',style:{flex:'1','overflow-y':'auto','overflow-x':'hidden',padding:'0','min-height':'0','scrollbar-width':'thin','scrollbar-color':'#4a9eff #2a2a2a'}},_e=(0,s.defineComponent)({__name:'MainPanel',setup(n){const e=[{key:'summary',label:'å†å²æ€»ç»“',icon:'fa-solid fa-list'},{key:'table',label:'è¡¨æ ¼',icon:'fa-solid fa-table'},{key:'settings',label:'è®¾ç½®',icon:'fa-solid fa-cog'},{key:'tools',label:'å·¥å…·æ¨¡æ¿',icon:'fa-solid fa-tools'}],t=(0,s.ref)('settings'),o={summary:Dn,table:Xn,settings:mn,tools:we},a=(0,s.computed)(()=>o[t.value]),r=(0,s.computed)(()=>({activeTab:t.value})),i=()=>{$('#memoryManagementPanel').fadeOut(200)};return(n,o)=>((0,s.openBlock)(),(0,s.createElementBlock)('div',Ce,[(0,s.createCommentVNode)(' é¢æ¿å¤´éƒ¨ '),(0,s.createElementVNode)('div',{class:'panel-header',style:{padding:'15px 20px',background:'#2a2a2a','border-bottom':'1px solid #3a3a3a',display:'flex','justify-content':'space-between','align-items':'center','border-radius':'8px 8px 0 0','flex-shrink':'0'}},[o[1]||(o[1]=(0,s.createElementVNode)('div',{class:'header-left',style:{display:'flex','align-items':'center',gap:'10px'}},[(0,s.createElementVNode)('span',{style:{'font-size':'24px'}},'ğŸ±'),(0,s.createElementVNode)('b',null,'mzrodyuçŒ«çŒ«çš„å°ç ´çƒ‚')],-1)),(0,s.createElementVNode)('div',{class:'close-button',style:{cursor:'pointer',padding:'5px 10px','border-radius':'4px',transition:'background 0.2s'},onClick:i},[...o[0]||(o[0]=[(0,s.createElementVNode)('i',{class:'fa-solid fa-times'},null,-1)])])]),(0,s.createCommentVNode)(' é¢æ¿æ ‡ç­¾æ  '),(0,s.createElementVNode)('div',ve,[((0,s.openBlock)(),(0,s.createElementBlock)(s.Fragment,null,(0,s.renderList)(e,n=>(0,s.createElementVNode)('div',{key:n.key,class:(0,s.normalizeClass)([{'tab-active':t.value===n.key},'tab-item']),style:(0,s.normalizeStyle)({flex:'1',padding:'12px 20px',cursor:'pointer',textAlign:'center',transition:'background 0.2s, color 0.2s',display:'flex',alignItems:'center',justifyContent:'center',gap:'8px',borderBottom:'2px solid transparent',backgroundColor:t.value===n.key?'#1a1a1a':'transparent',color:t.value===n.key?'#4a9eff':'#e0e0e0',borderBottomColor:t.value===n.key?'#4a9eff':'transparent'}),onClick:e=>{return o=n.key,console.log('åˆ‡æ¢æ ‡ç­¾é¡µ:',o),void(t.value=o);var o}},[(0,s.createElementVNode)('i',{class:(0,s.normalizeClass)(n.icon)},null,2),(0,s.createTextVNode)(' '+(0,s.toDisplayString)(n.label),1)],14,ke)),64))]),(0,s.createCommentVNode)(' é¢æ¿å†…å®¹ '),(0,s.createElementVNode)('div',Be,[((0,s.openBlock)(),(0,s.createBlock)((0,s.resolveDynamicComponent)(a.value),(0,s.mergeProps)({key:t.value},r.value),null,16))])]))}});r(942);const Ee=(0,Vn.A)(_e,[['__scopeId','data-v-4ef9901c']]),ze=(0,s.defineComponent)({__name:'æµ®åŠ¨é¢æ¿',setup:n=>(n,e)=>((0,s.openBlock)(),(0,s.createBlock)(Ee))});$(()=>{console.log('æµ®åŠ¨é¢æ¿.ts å¼€å§‹æ‰§è¡Œ'),setTimeout(()=>{console.log('æµ®åŠ¨é¢æ¿.ts setTimeout å›è°ƒæ‰§è¡Œ');const n=$('#memoryManagementPanel');n.length>0&&(console.log('mzrodyuçŒ«çŒ«çš„å°ç ´çƒ‚æµ®åŠ¨é¢æ¿å·²å­˜åœ¨ï¼Œå¼ºåˆ¶åˆ é™¤å¹¶é‡æ–°åˆ›å»º...'),n.remove(),setTimeout(()=>{console.log('æ—§é¢æ¿å·²åˆ é™¤ï¼Œå¼€å§‹åˆ›å»ºæ–°é¢æ¿...')},100)),console.log('ğŸš€ğŸš€ğŸš€ å¼€å§‹åˆ›å»ºé¢æ¿å®¹å™¨ - æ—¶é—´æˆ³:',(new Date).toISOString());const e=$('\n      <div id="memoryManagementPanel" style="\n        position: fixed;\n        top: 50%;\n        left: 50%;\n        transform: translate(-50%, -50%);\n        width: 90vw;\n        max-width: 1200px;\n        height: 80vh;\n        max-height: 80vh;\n        background: #1a1a1a;\n        border: 1px solid #3a3a3a;\n        border-radius: 8px;\n        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.5);\n        z-index: 999999;\n        display: flex;\n        flex-direction: column;\n        overflow: hidden;\n      ">\n      </div>\n    ');$('body').append(e),console.log('é¢æ¿å®¹å™¨å·²æ·»åŠ åˆ° body, å®¹å™¨å…ƒç´ :',e[0]),console.log('å‡†å¤‡åˆ›å»ºæ–°çš„ Vue åº”ç”¨ï¼Œé¢æ¿å®¹å™¨:',e[0]);const t=(0,s.createApp)(ze).use((0,c.createPinia)());try{t.mount(e[0]),console.log('Vue åº”ç”¨å·²æˆåŠŸæŒ‚è½½'),console.log('Vue å®ä¾‹:',e[0].__vue_app__)}catch(n){console.error('Vue åº”ç”¨æŒ‚è½½å¤±è´¥:',n),console.error('é”™è¯¯è¯¦æƒ…:',JSON.stringify(n,null,2)),console.error('é”™è¯¯å †æ ˆ:',n.stack)}console.log('mzrodyuçŒ«çŒ«çš„å°ç ´çƒ‚æµ®åŠ¨é¢æ¿å·²åˆ›å»ºï¼Œé¢æ¿å…ƒç´ :',e[0])},200)});r(608);$(()=>{setTimeout(()=>{let n=null;try{n=getScriptId?.()}catch(n){console.error('æ— æ³•è·å– script_id:',n)}if(!n)return console.error('æ— æ³•è·å– script_idï¼ŒmzrodyuçŒ«çŒ«çš„å°ç ´çƒ‚è„šæœ¬æ— æ³•æ­£å¸¸å·¥ä½œ'),void window.toastr.error('mzrodyuçŒ«çŒ«çš„å°ç ´çƒ‚è„šæœ¬åˆå§‹åŒ–å¤±è´¥');(0,l.aJ)(n),console.log('mzrodyuçŒ«çŒ«çš„å°ç ´çƒ‚è„šæœ¬å¼€å§‹åˆå§‹åŒ–ï¼Œscript_id:',n),setTimeout(()=>{const n=()=>{try{console.log('ğŸ” å¼€å§‹æ£€æŸ¥è‡ªåŠ¨æ€»ç»“...');const n=(0,i.C)();if(!n||!n.settings)return void console.warn('âŒ æ— æ³•è·å–è®¾ç½®ï¼Œè·³è¿‡è‡ªåŠ¨æ€»ç»“æ£€æŸ¥');const e=n.settings;if('boolean'!=typeof e.auto_summarize_enabled)return void console.warn('âŒ è‡ªåŠ¨æ€»ç»“è®¾ç½®æ— æ•ˆï¼Œè·³è¿‡æ£€æŸ¥');if('number'!=typeof e.summarize_interval||e.summarize_interval<1)return void console.warn('âŒ æ€»ç»“é—´éš”è®¾ç½®æ— æ•ˆï¼Œè·³è¿‡æ£€æŸ¥');if(console.log('ğŸ“‹ å½“å‰è®¾ç½®:',{auto_summarize_enabled:e.auto_summarize_enabled,summarize_interval:e.summarize_interval,has_api_key:!!e.api_key}),!e.auto_summarize_enabled)return void console.log('â¸ï¸ è‡ªåŠ¨æ€»ç»“æœªå¯ç”¨');if(!e.api_key)return void console.log('âŒ API Key æœªè®¾ç½®');const t=getLastMessageId(),o=SillyTavern.getCurrentChatId();if(!o)return void console.log('âŒ æ— æ³•è·å–èŠå¤©IDï¼Œè·³è¿‡è‡ªåŠ¨æ€»ç»“æ£€æŸ¥');let a=0;try{const n=getVariables({type:'chat'}),e='auto_summary_start_id';if(console.log('ğŸ” æ£€æŸ¥èŠå¤©å˜é‡:',{current_chat_id:o,chat_vars:n,has_start_id:void 0!==n[e],existing_start_id:n[e]}),void 0!==n[e]&&null!==n[e])a=n[e],console.log(`âœ… ä½¿ç”¨ç°æœ‰èµ·å§‹æ¥¼å±‚: ${a} (èŠå¤©: ${o})`);else{const n=(0,l.Ut)();if(!n)return void console.warn('script_id ä¸ºç©ºï¼Œæ— æ³•æ£€æŸ¥ç°æœ‰æ€»ç»“');const r=getVariables({type:'script',script_id:n}),s=Array.isArray(r?.summary_history)?r.summary_history:[];if(s.length>0){const n=s[0].end_id||0;t>n?(a=n+1,console.log(`ğŸ”„ é‡æ–°åŠ è½½èŠå¤©ï¼ŒåŸºäºç°æœ‰æ€»ç»“è®¾ç½®èµ·å§‹æ¥¼å±‚: ${a} (æœ€åæ€»ç»“ç»“æŸäºç¬¬ ${n} å±‚)`),window.toastr?.info(`é‡æ–°åŠ è½½èŠå¤©ï¼Œèµ·å§‹æ¥¼å±‚è®¾ç½®ä¸ºç¬¬ ${a} å±‚`)):(a=t,console.log(`ğŸ”„ é‡æ–°åŠ è½½èŠå¤©ï¼Œå½“å‰æ¥¼å±‚å·²æ€»ç»“ï¼Œä»å½“å‰æ¥¼å±‚å¼€å§‹: ${t}`),window.toastr?.info(`é‡æ–°åŠ è½½èŠå¤©ï¼Œä»å½“å‰æ¥¼å±‚å¼€å§‹: ${t}`))}else a=0,console.log(`ğŸ†• æ–°èŠå¤©çª—å£ï¼Œè®¾ç½®èµ·å§‹æ¥¼å±‚: 0 (èŠå¤©: ${o}) - ä»AIå¼€åœºç™½å¼€å§‹`),window.toastr?.info('æ–°èŠå¤©çª—å£ï¼Œèµ·å§‹æ¥¼å±‚è®¾ç½®ä¸ºç¬¬ 0 å±‚ï¼ˆAIå¼€åœºç™½ï¼‰');a<0&&(a=0,console.log('âš ï¸ ä¿®æ­£èµ·å§‹æ¥¼å±‚ä¸º0ï¼Œä»AIå¼€åœºç™½å¼€å§‹')),insertOrAssignVariables({[e]:a},{type:'chat'})}}catch(n){console.warn('è·å–è‡ªåŠ¨æ€»ç»“èµ·å§‹æ¥¼å±‚å¤±è´¥ï¼Œä½¿ç”¨å½“å‰æ¥¼å±‚:',n),a=t}console.log(`æ£€æŸ¥è‡ªåŠ¨æ€»ç»“: å½“å‰æ¥¼å±‚=${t}, èµ·å§‹æ¥¼å±‚=${a}, é—´éš”=${e.summarize_interval}`);const r=t-a,s=r>=e.summarize_interval-1;if(console.log('ğŸ§® è®¡ç®—æ£€æŸ¥:',{last_message_id:t,auto_summary_start_id:a,relative_position:r,summarize_interval:e.summarize_interval,should_trigger:s,calculation:`${r} >= ${e.summarize_interval-1} (åŒ…å«èµ·å§‹æ¥¼å±‚ï¼Œå…±${r+1}å±‚)`,expected_trigger_at_floor:a+e.summarize_interval-1,will_summarize_range:`${a}-${a+e.summarize_interval-1}`,floor_explanation:'æ¥¼å±‚ç¼–å·ï¼š0=AIå¼€åœºç™½, 1=ç”¨æˆ·, 2=AI, 3=ç”¨æˆ·...'}),t>=a&&s){const n=a,t=a+e.summarize_interval-1;console.log(`ğŸ¯ è§¦å‘è‡ªåŠ¨æ€»ç»“: æ¥¼å±‚ ${n}-${t}`),window.toastr.info(`ğŸ”„ å¼€å§‹è‡ªåŠ¨æ€»ç»“æ¥¼å±‚ ${n}-${t}...`),(0,d.summarizeMessages)(n,t).then(e=>{console.log(`âœ… è‡ªåŠ¨æ€»ç»“å®Œæˆ: æ¥¼å±‚ ${n}-${t}`,e);try{(0,i.l)().addSummary(n,t,e)}catch(n){console.error('æ·»åŠ è‡ªåŠ¨æ€»ç»“åˆ°å†å²å¤±è´¥:',n)}const o=t+1;insertOrAssignVariables({auto_summary_start_id:o},{type:'chat'}),console.log(`ğŸ”„ æ›´æ–°èµ·å§‹æ¥¼å±‚ä¸º: ${o}`),window.toastr.success(`âœ… å·²è‡ªåŠ¨æ€»ç»“ç¬¬ ${n}-${t} æ¥¼ï¼Œä¸‹æ¬¡å°†ä»ç¬¬ ${o} æ¥¼å¼€å§‹`)}).catch(n=>{console.error('âŒ è‡ªåŠ¨æ€»ç»“å¤±è´¥ï¼š',n),window.toastr.error('âŒ è‡ªåŠ¨æ€»ç»“å¤±è´¥ï¼š'+n.message)})}}catch(n){console.error('checkAutoSummarize å‘ç”Ÿé”™è¯¯ï¼š',n)}};try{eventOn(tavern_events.CHARACTER_MESSAGE_RENDERED,()=>{console.log('ğŸ“¨ æ”¶åˆ°æ¶ˆæ¯æ¸²æŸ“äº‹ä»¶ï¼Œæ£€æŸ¥è‡ªåŠ¨æ€»ç»“...'),n()}),eventOn(tavern_events.CHAT_CHANGED,n=>{console.log('ğŸ”„ èŠå¤©åˆ‡æ¢äº‹ä»¶:',n);try{const e=getVariables({type:'chat'}).auto_summary_start_id;null!=e?console.log(`âœ… åˆ‡æ¢åˆ°å·²æœ‰è‡ªåŠ¨æ€»ç»“çš„èŠå¤©: ${n}, èµ·å§‹æ¥¼å±‚: ${e}`):console.log(`ğŸ†• åˆ‡æ¢åˆ°æ–°èŠå¤©: ${n}, ç­‰å¾…ä¸‹ä¸€æ¡æ¶ˆæ¯æ—¶åˆå§‹åŒ–`)}catch(n){console.warn('æ£€æŸ¥èŠå¤©çŠ¶æ€å¤±è´¥:',n)}}),console.log('âœ… äº‹ä»¶ç›‘å¬å™¨å·²æ³¨å†Œ'),window.testCompleteAutoSummary=()=>{try{console.log('ğŸ§ª æµ‹è¯•å®Œæ•´çš„è‡ªåŠ¨æ€»ç»“æµç¨‹...');const n=getLastMessageId();console.log('å½“å‰æ¥¼å±‚:',n);const e=getVariables({type:'chat'}).auto_summary_start_id;console.log('ä¿å­˜çš„èµ·å§‹æ¥¼å±‚:',e);const t=(0,l.Ut)();if(!t)return void console.warn('script_id ä¸ºç©ºï¼Œæ— æ³•æ£€æŸ¥ä¿å­˜çš„æ€»ç»“æ•°æ®');const o=getVariables({type:'script',script_id:t}),a=o?.summary_history?.[0];a&&console.log('ä¿å­˜çš„æ€»ç»“æ•°æ®:',a);const r=parseInt(e)||0,s=5,i=n-r,d=i>=s-1&&i%s===s-1;console.log('è§¦å‘æ¡ä»¶æµ‹è¯•:',{current_floor:n,start_id:r,relative_position:i,summarize_interval:s,should_trigger:d,next_trigger_floor:r+s-1,floor_explanation:'æ¥¼å±‚ç¼–å·ï¼š0=AIå¼€åœºç™½, 1=ç”¨æˆ·, 2=AI, 3=ç”¨æˆ·...'}),console.log('æ€»ç»“å†å²:',o?.summary_history),console.log('âœ… è‡ªåŠ¨æ€»ç»“åŠŸèƒ½æµ‹è¯•å®Œæˆ')}catch(n){console.error('âŒ æµ‹è¯•å¤±è´¥:',n)}},window.checkCurrentFloor=()=>{try{const n=getLastMessageId(),e=getVariables({type:'chat'}).auto_summary_start_id||0,t=5,o=n-e,a=o>=t-1&&o%t===t-1;console.log('ğŸ” å½“å‰æ¥¼å±‚æ£€æŸ¥:',{last_message_id:n,auto_summary_start_id:e,relative_position:o,summarize_interval:t,should_trigger:a,calculation:`${o} >= ${t-1} && (${o} + 1) % ${t} = ${(o+1)%t}`}),window.toastr?.info(`å½“å‰æ¥¼å±‚${n}: ç›¸å¯¹ä½ç½®=${o}, è§¦å‘=${a}`)}catch(n){console.error('âŒ å½“å‰æ¥¼å±‚æ£€æŸ¥å¤±è´¥:',n),window.toastr?.error('æ£€æŸ¥å¤±è´¥: '+n.message)}},window.testFloorCalculation=()=>{try{const n=getLastMessageId(),e=getVariables({type:'chat'}).auto_summary_start_id||0,t=5;console.log('ğŸ§® æ¥¼å±‚è®¡ç®—éªŒè¯:',{last_message_id:n,auto_summary_start_id:e,summarize_interval:t}),console.log('æ¥¼å±‚ç¼–å·è¯´æ˜ï¼š0=AIå¼€åœºç™½, 1=ç”¨æˆ·, 2=AI, 3=ç”¨æˆ·...');for(let n=0;n<=15;n++){const o=n-e,a=o>=t-1&&(o+1)%t===0,r=e,s=n,i=0===n?'AIå¼€åœºç™½':n%2==1?'ç”¨æˆ·':'AI';console.log(`æ¥¼å±‚ ${n}(${i}): ç›¸å¯¹ä½ç½®=${o}, è§¦å‘=${a}, æ€»ç»“èŒƒå›´=${r}-${s}, è®¡ç®—=${o} % ${t} = ${o%t} (æœŸæœ›: ${t-1})`)}window.toastr?.info('æ¥¼å±‚è®¡ç®—éªŒè¯å®Œæˆï¼Œè¯·æŸ¥çœ‹æ§åˆ¶å°')}catch(n){console.error('âŒ æ¥¼å±‚è®¡ç®—éªŒè¯å¤±è´¥:',n),window.toastr?.error('éªŒè¯å¤±è´¥: '+n.message)}},console.log('âœ… è°ƒè¯•å‡½æ•°å·²æ³¨å†Œ'),setTimeout(()=>{window.autoDetectOldWindow()},1e3)}catch(n){console.error('âŒ æ³¨å†Œäº‹ä»¶ç›‘å¬å™¨å¤±è´¥:',n)}window.testAutoSummarize=n,window.syncAutoSummaryData=()=>{try{console.log('ğŸ”„ å¼€å§‹åŒæ­¥è‡ªåŠ¨æ€»ç»“æ•°æ®...');const n=localStorage.getItem('auto_summary_start_id'),e=localStorage.getItem('last_summary');if(console.log('localStorageæ•°æ®:',{saved_start_id:n,saved_summary:e?JSON.parse(e):null}),n&&(insertOrAssignVariables({auto_summary_start_id:parseInt(n)},{type:'chat'}),console.log(`âœ… å·²åŒæ­¥èµ·å§‹æ¥¼å±‚: ${n}`)),e)try{const n=JSON.parse(e),t=(0,l.Ut)();if(!t)return void console.warn('script_id ä¸ºç©ºï¼Œæ— æ³•å¤„ç†æ€»ç»“æ•°æ®');const o=getVariables({type:'script',script_id:t}),a=o?.summary_history||[];if(a.some(e=>e.start_id===n.start_id&&e.end_id===n.end_id))console.log('âš ï¸ æ€»ç»“æ•°æ®å·²å­˜åœ¨ï¼Œè·³è¿‡åŒæ­¥');else{const e=[{start_id:n.start_id,end_id:n.end_id,content:n.summary,timestamp:n.timestamp},...a];insertOrAssignVariables({summary_history:e},{type:'script',script_id:t}),console.log(`âœ… å·²åŒæ­¥æ€»ç»“æ•°æ®: æ¥¼å±‚ ${n.start_id}-${n.end_id}`)}}catch(n){console.error('è§£ææ€»ç»“æ•°æ®å¤±è´¥:',n)}window.toastr?.success('æ•°æ®åŒæ­¥å®Œæˆ'),console.log('âœ… è‡ªåŠ¨æ€»ç»“æ•°æ®åŒæ­¥å®Œæˆ')}catch(n){console.error('âŒ åŒæ­¥æ•°æ®å¤±è´¥:',n),window.toastr?.error('åŒæ­¥å¤±è´¥: '+n.message)}},window.autoDetectOldWindow=()=>{try{const n=SillyTavern.getCurrentChatId(),e=getLastMessageId(),t=getVariables({type:'chat'});return(void 0===t.auto_summary_start_id||null===t.auto_summary_start_id)&&e>0?(console.log(`ğŸ” æ£€æµ‹åˆ°è€çª—å£: èŠå¤©ID=${n}, æ¥¼å±‚æ•°=${e}`),window.handleOldWindow()):(console.log(`âœ… å½“å‰èŠå¤©çŠ¶æ€æ­£å¸¸: èŠå¤©ID=${n}, æ¥¼å±‚æ•°=${e}`),null)}catch(n){return console.error('âŒ è‡ªåŠ¨æ£€æµ‹è€çª—å£å¤±è´¥:',n),null}},window.smartResetChat=()=>{try{insertOrAssignVariables({auto_summary_start_id:null},{type:'chat'}),console.log('ğŸ”„ å·²é‡ç½®å½“å‰èŠå¤©çŠ¶æ€ï¼Œä¸‹æ¬¡æ¶ˆæ¯æ—¶å°†é‡æ–°æ™ºèƒ½è®¾ç½®'),window.toastr?.success('å·²é‡ç½®å½“å‰èŠå¤©çŠ¶æ€')}catch(n){console.error('âŒ é‡ç½®èŠå¤©çŠ¶æ€å¤±è´¥:',n),window.toastr?.error('é‡ç½®å¤±è´¥: '+n.message)}},window.fixStartId=()=>{try{const n=SillyTavern.getCurrentChatId(),e=getLastMessageId(),t=getVariables({type:'chat'}).auto_summary_start_id;if(console.log('ğŸ”§ ä¿®å¤èµ·å§‹æ¥¼å±‚:',{current_chat_id:n,last_message_id:e,current_start_id:t}),0===t||null==t){const n=e;insertOrAssignVariables({auto_summary_start_id:n},{type:'chat'}),console.log(`âœ… å·²ä¿®å¤èµ·å§‹æ¥¼å±‚: ${n}`),window.toastr?.success(`å·²ä¿®å¤èµ·å§‹æ¥¼å±‚: ${n}`)}else console.log(`âœ… èµ·å§‹æ¥¼å±‚æ­£å¸¸: ${t}`),window.toastr?.info(`èµ·å§‹æ¥¼å±‚æ­£å¸¸: ${t}`)}catch(n){console.error('âŒ ä¿®å¤èµ·å§‹æ¥¼å±‚å¤±è´¥:',n),window.toastr?.error('ä¿®å¤å¤±è´¥: '+n.message)}},window.checkMemoryUIConflict=()=>{try{const n=window.MemoryUI,e=(0,i.C)();console.log('ğŸ” æ£€æŸ¥MemoryUIå†²çª:',{memoryUI_exists:!!n,memoryUI_autoSummarizeEnabled:n?.autoSummarizeEnabled,our_auto_summarize_enabled:e.settings.auto_summarize_enabled,our_summarize_interval:e.settings.summarize_interval}),n&&void 0!==n.autoSummarizeEnabled?(console.log('âš ï¸ æ£€æµ‹åˆ°MemoryUIæ’ä»¶ï¼Œå¯èƒ½å­˜åœ¨å†²çª'),window.toastr?.warning('æ£€æµ‹åˆ°MemoryUIæ’ä»¶ï¼Œå»ºè®®å…³é—­å…¶è‡ªåŠ¨æ€»ç»“åŠŸèƒ½ä»¥é¿å…å†²çª')):(console.log('âœ… æœªæ£€æµ‹åˆ°MemoryUIå†²çª'),window.toastr?.info('æœªæ£€æµ‹åˆ°MemoryUIå†²çª'))}catch(n){console.error('âŒ æ£€æŸ¥MemoryUIå†²çªå¤±è´¥:',n),window.toastr?.error('æ£€æŸ¥å¤±è´¥: '+n.message)}},window.testFloorCalculation=()=>{try{const n=getLastMessageId(),e=getVariables({type:'chat'}).auto_summary_start_id||0,t=5;console.log('ğŸ§® æ¥¼å±‚è®¡ç®—éªŒè¯:',{last_message_id:n,auto_summary_start_id:e,summarize_interval:t});for(let n=0;n<=15;n++){const o=n-e,a=o>=t-1&&o%t===t-1,r=e,s=n;console.log(`æ¥¼å±‚ ${n}: ç›¸å¯¹ä½ç½®=${o}, è§¦å‘=${a}, æ€»ç»“èŒƒå›´=${r}-${s}`)}window.toastr?.info('æ¥¼å±‚è®¡ç®—éªŒè¯å®Œæˆï¼Œè¯·æŸ¥çœ‹æ§åˆ¶å°')}catch(n){console.error('âŒ æ¥¼å±‚è®¡ç®—éªŒè¯å¤±è´¥:',n),window.toastr?.error('éªŒè¯å¤±è´¥: '+n.message)}},window.resetAutoSummaryStart=()=>{try{const n=getScriptId(),e=SillyTavern.getCurrentChatId(),t=getLastMessageId();if(!e)return void window.toastr?.error('æ— æ³•è·å–èŠå¤©ID');const o=getVariables({type:'script',script_id:n}).auto_summary_data||{};o[e]=t,insertOrAssignVariables({auto_summary_data:o},{type:'script',script_id:n}),console.log(`âœ… æ‰‹åŠ¨é‡ç½®èµ·å§‹æ¥¼å±‚ä¸º: ${t} (èŠå¤©: ${e})`),window.toastr?.success(`èµ·å§‹æ¥¼å±‚å·²é‡ç½®ä¸ºç¬¬ ${t} å±‚`)}catch(n){console.error('âŒ é‡ç½®èµ·å§‹æ¥¼å±‚å¤±è´¥:',n),window.toastr?.error('é‡ç½®å¤±è´¥: '+n.message)}},window.clearCurrentChatData=()=>{try{insertOrAssignVariables({auto_summary_start_id:null},{type:'chat'}),console.log('ğŸ—‘ï¸ å·²æ¸…ç†å½“å‰èŠå¤©æ•°æ®'),window.toastr?.success('å½“å‰èŠå¤©æ•°æ®å·²æ¸…ç†')}catch(n){console.error('âŒ æ¸…ç†èŠå¤©æ•°æ®å¤±è´¥:',n),window.toastr?.error('æ¸…ç†å¤±è´¥: '+n.message)}},window.watchChatId=()=>{let n=SillyTavern.getCurrentChatId();console.log('ğŸ” å¼€å§‹ç›‘æ§èŠå¤©IDå˜åŒ–ï¼Œå½“å‰ID:',n);const e=setInterval(()=>{const e=SillyTavern.getCurrentChatId();e!==n&&(console.log('ğŸ”„ èŠå¤©IDå˜åŒ–:',n,'->',e),n=e)},1e3);return()=>{clearInterval(e),console.log('â¹ï¸ åœæ­¢ç›‘æ§èŠå¤©IDå˜åŒ–')}},window.showCurrentChatData=()=>{try{const n=SillyTavern.getCurrentChatId(),e=getVariables({type:'chat'});return console.log('ğŸ“Š å½“å‰èŠå¤©æ•°æ®:',{current_chat_id:n,chat_vars:e,auto_summary_start_id:e.auto_summary_start_id}),window.toastr?.info(`å·²è¾“å‡ºå½“å‰èŠå¤©æ•°æ®åˆ°æ§åˆ¶å°ï¼ŒèŠå¤©ID: ${n}`),e}catch(n){return console.error('âŒ æŸ¥çœ‹èŠå¤©æ•°æ®å¤±è´¥:',n),window.toastr?.error('æŸ¥çœ‹å¤±è´¥: '+n.message),null}},window.handleOldWindow=()=>{try{const n=SillyTavern.getCurrentChatId(),e=getLastMessageId(),t=getVariables({type:'chat'}),o=getScriptId(),a=getVariables({type:'script',script_id:o}),r=a?.summary_history||[];if(console.log('ğŸ” è€çª—å£åˆ†æ:',{current_chat_id:n,last_message_id:e,chat_has_start_id:void 0!==t.auto_summary_start_id,existing_summaries_count:r.length,last_summary_end:r.length>0?r[0].end_id:'none'}),void 0===t.auto_summary_start_id||null===t.auto_summary_start_id){let n=e;if(r.length>0){const t=r[0].end_id||0;e>t?(n=t+1,console.log(`ğŸ”„ è€çª—å£æ™ºèƒ½è®¾ç½®: ä»ç¬¬ ${n} å±‚å¼€å§‹ (æœ€åæ€»ç»“ç»“æŸäºç¬¬ ${t} å±‚)`)):console.log(`ğŸ”„ è€çª—å£æ™ºèƒ½è®¾ç½®: ä»å½“å‰æ¥¼å±‚å¼€å§‹ ${e} (å½“å‰æ¥¼å±‚å·²æ€»ç»“)`)}else console.log(`ğŸ†• è€çª—å£æ™ºèƒ½è®¾ç½®: ä»å½“å‰æ¥¼å±‚å¼€å§‹ ${e} (æ— ç°æœ‰æ€»ç»“)`);insertOrAssignVariables({auto_summary_start_id:n},{type:'chat'}),window.toastr?.info(`è€çª—å£å·²åˆå§‹åŒ–ï¼Œèµ·å§‹æ¥¼å±‚: ${n}`)}else console.log(`âœ… è€çª—å£å·²æœ‰èµ·å§‹æ¥¼å±‚: ${t.auto_summary_start_id}`),window.toastr?.info(`è€çª—å£å·²æœ‰èµ·å§‹æ¥¼å±‚: ${t.auto_summary_start_id}`);return{chat_id:n,last_message_id:e,auto_summary_start_id:t.auto_summary_start_id,existing_summaries:r.length}}catch(n){return console.error('âŒ å¤„ç†è€çª—å£å¤±è´¥:',n),window.toastr?.error('å¤„ç†å¤±è´¥: '+n.message),null}},window.checkAutoSummaryStatus=()=>{try{const n=(0,i.C)();if(!n||!n.settings)return console.warn('âŒ æ— æ³•è·å–è®¾ç½®'),null;const e=n.settings,t=getScriptId(),o=SillyTavern.getCurrentChatId(),a=getVariables({type:'script',script_id:t}),r=getLastMessageId(),s=a.auto_summary_data||{},l=s[o]||0,d=r-l+1,c=d%e.summarize_interval===0,p={current_chat_id:o,last_message_id:r,auto_summary_start_id:l,relative_position:d,summarize_interval:e.summarize_interval,should_trigger:c,calculation:`${d} % ${e.summarize_interval} = ${d%e.summarize_interval}`,auto_summarize_enabled:e.auto_summarize_enabled,api_key_set:!!e.api_key,all_chat_data:s};return console.log('ğŸ” è‡ªåŠ¨æ€»ç»“çŠ¶æ€:',p),window.toastr?.info('çŠ¶æ€å·²è¾“å‡ºåˆ°æ§åˆ¶å°'),p}catch(n){return console.error('âŒ æ£€æŸ¥çŠ¶æ€å¤±è´¥:',n),window.toastr?.error('æ£€æŸ¥å¤±è´¥: '+n.message),null}};const e=(0,i.C)();if(e&&e.settings){const n=(0,s.watch)(()=>e.settings.auto_summarize_enabled,(n,e)=>{if(console.log(`ğŸ”„ è‡ªåŠ¨æ€»ç»“è®¾ç½®å˜åŒ–: ${e} -> ${n}`),n&&!e)try{const n=(0,l.Ut)();if(!n)return void console.warn('script_id ä¸ºç©ºï¼Œæ— æ³•æ£€æŸ¥èµ·å§‹æ¥¼å±‚');const e=getVariables({type:'script',script_id:n}).auto_summary_start_id;if(null==e){const e=getLastMessageId();insertOrAssignVariables({auto_summary_start_id:e},{type:'script',script_id:n}),console.log(`âœ… é¦–æ¬¡å¼€å¯è‡ªåŠ¨æ€»ç»“ï¼Œèµ·å§‹æ¥¼å±‚è®¾ç½®ä¸º: ${e}`),window.toastr?.info(`è‡ªåŠ¨æ€»ç»“å·²å¼€å¯ï¼Œå°†ä»ç¬¬ ${e} å±‚å¼€å§‹`)}else console.log(`âœ… è‡ªåŠ¨æ€»ç»“å·²å¼€å¯ï¼Œä½¿ç”¨ç°æœ‰èµ·å§‹æ¥¼å±‚: ${e}`),window.toastr?.info(`è‡ªåŠ¨æ€»ç»“å·²å¼€å¯ï¼Œèµ·å§‹æ¥¼å±‚: ${e}`)}catch(n){console.error('âŒ æ£€æŸ¥èµ·å§‹æ¥¼å±‚å¤±è´¥:',n)}},{immediate:!1});$(window).on('pagehide',()=>{n()})}window.toastr.success('mzrodyuçŒ«çŒ«çš„å°ç ´çƒ‚è„šæœ¬å·²åŠ è½½')},200)},100)});
//# sourceMappingURL=index.js.map